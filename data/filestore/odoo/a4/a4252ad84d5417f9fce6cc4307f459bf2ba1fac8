
/* /base/static/src/js/res_config_settings.js defined in bundle 'web.assets_backend' */
odoo.define('base.settings',function(require){"use strict";var BasicModel=require('web.BasicModel');var core=require('web.core');var FormView=require('web.FormView');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var view_registry=require('web.view_registry');const Dialog=require('web.Dialog');var QWeb=core.qweb;var _t=core._t;var BaseSettingRenderer=FormRenderer.extend({events:_.extend({},FormRenderer.prototype.events,{'click .tab':'_onSettingTabClick','keyup .searchInput':'_onKeyUpSearch',}),init:function(){this._super.apply(this,arguments);this.activeView=false;this.activeTab=false;},confirmChange:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(!self.$(".o_dirty_warning").length){self.$('.o_statusbar_buttons').append($('<span/>',{text:_t("Unsaved changes"),class:'text-muted ml-2 o_dirty_warning'}))}});},on_attach_callback:function(){this._super.apply(this,arguments);this.searchInput.focus();},displayTranslationAlert:function(){},_initModules:function(){var self=this;this.modules=[];_.each(this.$('.app_settings_block'),function(settingView,index){var group=!$(settingView).hasClass('o_invisible_modifier');var isNotApp=$(settingView).hasClass('o_not_app');if(group&&!isNotApp){var data=$(settingView).data();data.string=$(settingView).attr('string')||data.string;self.modules.push({key:data.key,string:data.string,imgurl:self._getAppIconUrl(data.key),});}else{$(settingView).remove();}});},_initSearch:function(){this.searchInput=this.$('.searchInput');if(this.searchText){this.searchInput.val(this.searchText);this._onKeyUpSearch();}else{this.searchText="";}},_currentAppIndex:function(){var self=this;var index=_.findIndex(this.modules,function(module){return module.key===self.activeSettingTab;});return index;},_getAppIconUrl:function(module){return module==="general_settings"?"/base/static/description/settings.png":"/"+module+"/static/description/icon.png";},_getSearchHeader:function(imgurl,string){return $(QWeb.render('BaseSetting.SearchHeader',{imgurl:imgurl,string:string}));},_moveToTab:function(index){this.currentIndex=!index||index===-1?0:(index===this.modules.length?index-1:index);if(this.currentIndex!==-1){if(this.activeView){this.activeView.addClass("o_hidden");}
if(this.activeTab){this.activeTab.removeClass("selected");}
var view=this.modules[this.currentIndex].settingView;var tab=this.$(".tab[data-key='"+this.modules[this.currentIndex].key+"']");view.removeClass("o_hidden");this.activeView=view;this.activeTab=tab;tab.addClass("selected");}},_onSettingTabClick:function(event){this.searchInput.focus();if(this.searchText.length>0){this.searchInput.val('');this.searchText="";this._searchSetting();}
var settingKey=this.$(event.currentTarget).data('key');this._moveToTab(_.findIndex(this.modules,function(m){return m.key===settingKey;}));},_onKeyUpSearch:function(event){this.searchText=this.searchInput.val();this.activeTab.removeClass('selected');this._searchSetting();},_resetSearch:function(){this.searchInput.val("");_.each(this.modules,function(module){module.settingView.addClass('o_hidden');module.settingView.find('.o_setting_box').removeClass('o_hidden');module.settingView.find('h2').removeClass('o_hidden');module.settingView.find('.settingSearchHeader').addClass('o_hidden');module.settingView.find('.o_settings_container').addClass('mt16').removeClass('mb-0');});this.activeTab.removeClass('o_hidden').addClass('selected');this.activeView.removeClass('o_hidden');},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self._initModules();self._renderLeftPanel();self._initSearch();});},_renderLeftPanel:function(){var self=this;_.each(this.modules,function(module){module.settingView=self.$('.app_settings_block[data-key="'+module.key+'"]');module.settingView.addClass("o_hidden");module.settingView.prepend(self._getSearchHeader(module.imgurl,module.string));});this._renderTabs();this._moveToTab(this.currentIndex||this._currentAppIndex());},_renderTabs:function(){var tabs=$(QWeb.render('BaseSetting.Tabs',{tabItems:this.modules}));tabs.appendTo(this.$(".settings_tab"));},_searchSetting:function(){var self=this;this.count=0;_.each(this.modules,function(module){self.inVisibleCount=0;module.settingView.find('.o_setting_box').addClass('o_hidden');module.settingView.find('h2').addClass('o_hidden');module.settingView.find('.settingSearchHeader').addClass('o_hidden');module.settingView.find('.o_settings_container').removeClass('mt16').addClass('mb-0');var resultSetting=module.settingView.find(".o_form_label:containsTextLike('"+self.searchText+"')");if(resultSetting.length>0){resultSetting.each(function(){var settingBox=$(this).closest('.o_setting_box');if(!settingBox.hasClass('o_invisible_modifier')){settingBox.removeClass('o_hidden');$(this).html(self._wordHighlighter($(this).html(),self.searchText));}else{self.inVisibleCount++;}});if(self.inVisibleCount!==resultSetting.length){module.settingView.find('.settingSearchHeader').removeClass('o_hidden');module.settingView.removeClass('o_hidden');}}else{++self.count;}});this.count===_.size(this.modules)?this.$('.notFound').removeClass('o_hidden'):this.$('.notFound').addClass('o_hidden');if(this.searchText.length===0){this._resetSearch();}},_wordHighlighter:function(text,word){if(text.indexOf('highlighter')!==-1){text=text.replace('<span class="highlighter">',"");text=text.replace("</span>","");}
var match=text.search(new RegExp(word,"i"));word=text.substring(match,match+word.length);var highlightedWord="<span class='highlighter'>"+word+'</span>';return text.replace(word,highlightedWord);},});var BaseSettingController=FormController.extend({custom_events:_.extend({},FormController.prototype.custom_events,{button_clicked:'_onButtonClicked',}),init:function(){this._super.apply(this,arguments);this.disableAutofocus=true;this.renderer.activeSettingTab=this.initialState.context.module;this.discardingDef=null;},willRestore:function(){this.mode='edit';},canBeRemoved:function(){return this.discardChanges(undefined,{noAbandon:true,readonlyIfRealDiscard:true,});},canBeDiscarded:function(recordId){if(this.discardingDef){return this.discardingDef;}
if(!this.isDirty(recordId)){return Promise.resolve(false);}
const message=_t('Would you like to save your changes?');this.discardingDef=new Promise((resolve,reject)=>{const reset=()=>{this._enableButtons();this.discardingDef=null;};const cancel=()=>{reject();reset();};const dialog=Dialog.confirm(this,message,{title:_t('Unsaved changes'),buttons:[{text:_t('Save'),classes:'btn-primary',click:async()=>{this._disableButtons();try{await this.saveRecord(recordId,{stayInEdit:true,});const record=this.model.get(recordId);this.trigger_up('execute_action',{action_data:{context:record.getContext({additionalContext:{},}),name:"execute",type:"object",},env:{context:record.getContext(),currentID:record.data.id,model:record.model,resIDs:record.res_ids,},on_success(){resolve(false);dialog.close();},on_fail(){cancel();dialog.close();},});}catch(e){cancel();dialog.close();}},},{text:_t('Discard'),close:true,click:()=>{resolve(true);reset();},},{text:_t('Stay Here'),close:true,click:cancel,}],});dialog.on('closed',this.discardingDef,cancel);});return this.discardingDef;},_onButtonClicked:function(ev){var self=this;if(ev.data.attrs.name!=='execute'&&ev.data.attrs.name!=='cancel'){var recordID=ev.data.recordID;var _super=this._super;var args=arguments;this._discardChanges(recordID,{noAbandon:true}).then(function(){_super.apply(self,args);});}else{this._super.apply(this,arguments);}},_onBeforeUnload:function(){},});const BaseSettingsModel=BasicModel.extend({save(recordID,options){const savePoint=options&&options.savePoint;return this._super.apply(this,arguments).then(result=>{if(!savePoint&&this.localData[recordID].model==='res.config.settings'){delete this.localData[recordID].res_id;}
return result;});},});var BaseSettingView=FormView.extend({jsLibs:[],config:_.extend({},FormView.prototype.config,{Model:BaseSettingsModel,Renderer:BaseSettingRenderer,Controller:BaseSettingController,}),});view_registry.add('base_settings',BaseSettingView);return{Model:BaseSettingsModel,Renderer:BaseSettingRenderer,Controller:BaseSettingController,};});;

/* /web/static/src/core/assets.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/assets',async function(require){'use strict';let __exports={};const{useEnv,onWillStart}=owl.hooks;const{memoize}=require("@web/core/utils/functions");const{browser}=require("@web/core/browser/browser");class AssetsLoadingError extends Error{}
const loadJS=memoize(function loadJS(url){if(document.querySelector(`script[src="${url}"]`)){return Promise.resolve();}
const scriptEl=document.createElement("script");scriptEl.type="text/javascript";scriptEl.src=url;document.head.appendChild(scriptEl);return new Promise((resolve,reject)=>{scriptEl.addEventListener("load",resolve);scriptEl.addEventListener("error",()=>{reject(new AssetsLoadingError(`The loading of ${url} failed`));});});});const loadCSS=memoize(function loadCSS(url){if(document.querySelector(`link[href="${url}"]`)){return Promise.resolve();}
const linkEl=document.createElement("link");linkEl.type="text/css";linkEl.rel="stylesheet";linkEl.href=url;document.head.appendChild(linkEl);return new Promise(function(resolve,reject){linkEl.addEventListener("load",resolve);linkEl.addEventListener("error",()=>{reject(new AssetsLoadingError(`The loading of ${url} failed`));});});});const loadBundleTemplates=__exports.loadBundleTemplates=memoize(async function loadBundleTemplates(name){const bundleURL=`/web/webclient/qweb/${Date.now()}?bundle=${name}`;const templates=await(await browser.fetch(bundleURL)).text();return processTemplates(templates);});const bundlesCache={};async function loadBundle(name,options){const{templates}=options;if(!bundlesCache[name]){bundlesCache[name]={name};}
if(templates&&!bundlesCache[name].templates){bundlesCache[name].templates=loadBundleTemplates(name);}
const entries=await Promise.all(Object.keys(options).map(async(key)=>[key,await bundlesCache[name][key]]));return Object.fromEntries(entries);}
__exports.processTemplates=processTemplates;function processTemplates(templates){const doc=new DOMParser().parseFromString(templates,"text/xml");for(const template of[...doc.querySelector("templates").children]){if(template.hasAttribute("owl")){template.removeAttribute("owl");}else{template.remove();}}
return doc;}
const loadPublicAsset=__exports.loadPublicAsset=memoize(async function loadPublicAsset(xmlid,orm){const xml=await orm.call("ir.ui.view","render_public_asset",[xmlid]);const doc=new DOMParser().parseFromString(`<xml>${xml}</xml>`,"text/xml");return loadAssets({cssLibs:[...doc.querySelectorAll("link[href]")].map((node)=>node.getAttribute("href")),jsLibs:[...doc.querySelectorAll("script[src]")].map((node)=>node.getAttribute("src")),});});__exports.loadAssets=loadAssets;async function loadAssets(assets){const proms=[];const loadedAssets={};if("bundles"in assets){const bundles=Object.entries(assets.bundles);const bundlesProm=Promise.all(bundles.map(async([name,options])=>[name,await loadBundle(name,options)])).then((loadedBundles)=>{loadedAssets.bundles=Object.fromEntries(loadedBundles);});proms.push(bundlesProm);}
if("jsLibs"in assets){proms.push(Promise.all(assets.jsLibs.map(loadJS)));}
if("cssLibs"in assets){proms.push(Promise.all(assets.cssLibs.map(loadCSS)));}
await Promise.all(proms);return loadedAssets;}
__exports.useAssets=useAssets;function useAssets(assets){const env=useEnv();onWillStart(async()=>{const loadedAssets=await loadAssets(assets);const{bundles}=loadedAssets;if(bundles){const templateDocs=Object.values(bundles).map(({templates})=>templates);for(const xmlDoc of templateDocs){for(const template of[...xmlDoc.querySelector("templates").children]){if(template.getAttribute("t-name")in env.qweb.templates){template.remove();}}
env.qweb.addTemplates(xmlDoc);}}});}
return __exports;});;

/* /web/static/src/core/browser/browser.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/browser/browser',async function(require){'use strict';let __exports={};let sessionStorage=window.sessionStorage;let localStorage=owl.browser.localStorage;try{localStorage.setItem("__localStorage__","true");localStorage.removeItem("__localStorage__");}catch(e){localStorage=makeRAMLocalStorage();sessionStorage=makeRAMLocalStorage();}
const browser=__exports.browser=Object.assign({},owl.browser,{addEventListener:window.addEventListener.bind(window),removeEventListener:window.removeEventListener.bind(window),requestAnimationFrame:window.requestAnimationFrame.bind(window),cancelAnimationFrame:window.cancelAnimationFrame.bind(window),console:window.console,history:window.history,navigator:navigator,open:window.open.bind(window),XMLHttpRequest:window.XMLHttpRequest,localStorage,sessionStorage,});Object.defineProperty(browser,"location",{set(val){window.location=val;},get(){return window.location;},configurable:true,});__exports.makeRAMLocalStorage=makeRAMLocalStorage;function makeRAMLocalStorage(){let store={};return{setItem(key,value){store[key]=value;},getItem(key){return store[key];},clear(){store={};},removeItem(key){delete store[key];},get length(){return Object.keys(store).length;},key(){return"";},};}
return __exports;});;

/* /web/static/src/core/browser/cookie_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/browser/cookie_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const COOKIE_TTL=24*60*60*365;function parseCookieString(str){const cookie={};const parts=str.split("; ");for(let part of parts){const[key,value]=part.split("=");cookie[key]=value||"";}
return cookie;}
function cookieToString(key,value,ttl=COOKIE_TTL){let fullCookie=[];if(value!==undefined){fullCookie.push(`${key}=${value}`);}
fullCookie=fullCookie.concat(["path=/",`max-age=${ttl}`]);return fullCookie.join(";");}
function makeCookieService(){function getCurrent(){return parseCookieString(document.cookie);}
let cookie=getCurrent();function setCookie(key,value,ttl){document.cookie=cookieToString(key,value,ttl);cookie=getCurrent();}
return{get current(){return cookie;},setCookie,deleteCookie(key){setCookie(key,"kill",0);},};}
const cookieService=__exports.cookieService={start(){return makeCookieService();},};registry.category("services").add("cookie",cookieService);return __exports;});;

/* /web/static/src/core/browser/feature_detection.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/browser/feature_detection',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");__exports.isBrowserChrome=isBrowserChrome;function isBrowserChrome(){return browser.navigator.userAgent.includes("Chrome");}
__exports.isAndroid=isAndroid;function isAndroid(){return/Android/i.test(browser.navigator.userAgent);}
__exports.isIOS=isIOS;function isIOS(){return/(iPad|iPhone|iPod)/i.test(browser.navigator.userAgent)||(browser.navigator.platform==='MacIntel'&&maxTouchPoints()>1);}
__exports.isOtherMobileOS=isOtherMobileOS;function isOtherMobileOS(){return/(webOS|BlackBerry|Windows Phone)/i.test(browser.navigator.userAgent);}
__exports.isMacOS=isMacOS;function isMacOS(){return Boolean(browser.navigator.userAgent.match(/Mac/i));}
__exports.isMobileOS=isMobileOS;function isMobileOS(){return isAndroid()||isIOS()||isOtherMobileOS();}
__exports.isIosApp=isIosApp;function isIosApp(){return/OdooMobile \(iOS\)/i.test(browser.navigator.userAgent);}
__exports.hasTouch=hasTouch;function hasTouch(){return"ontouchstart"in window||"onmsgesturechange"in window;}
__exports.maxTouchPoints=maxTouchPoints;function maxTouchPoints(){return browser.navigator.maxTouchPoints||1;}
return __exports;});;

/* /web/static/src/core/browser/router_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/browser/router_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{shallowEqual}=require("@web/core/utils/objects");const{objectToUrlEncodedString}=require("@web/core/utils/urls");const{browser}=require("@web/core/browser/browser");function cast(value){return!value||isNaN(value)?value:Number(value);}
function parseString(str){const parts=str.split("&");const result={};for(let part of parts){const[key,value]=part.split("=");const decoded=decodeURIComponent(value||"");result[key]=cast(decoded);}
return result;}
function applyLocking(lockedKeys,hash,currentHash,options={}){const newHash={};for(const key in hash){if("lock"in options){options.lock?lockedKeys.add(key):lockedKeys.delete(key);}else if(lockedKeys.has(key)){continue;}
newHash[key]=hash[key];}
for(const key in currentHash){if(lockedKeys.has(key)&&!(key in newHash)){newHash[key]=currentHash[key];}}
return newHash;}
function computeNewRoute(hash,replace,currentRoute){if(!replace){hash=Object.assign({},currentRoute.hash,hash);}
hash=sanitizeHash(hash);if(!shallowEqual(currentRoute.hash,hash)){return Object.assign({},currentRoute,{hash});}
return false;}
function sanitizeHash(hash){return Object.fromEntries(Object.entries(hash).filter(([,v])=>v!==undefined).map(([k,v])=>[k,cast(v)]));}
__exports.parseHash=parseHash;function parseHash(hash){return hash&&hash!=="#"?parseString(hash.slice(1)):{};}
__exports.parseSearchQuery=parseSearchQuery;function parseSearchQuery(search){return search?parseString(search.slice(1)):{};}
__exports.routeToUrl=routeToUrl;function routeToUrl(route){const search=objectToUrlEncodedString(route.search);const hash=objectToUrlEncodedString(route.hash);return route.pathname+(search?"?"+search:"")+(hash?"#"+hash:"");}
async function redirect(env,url,wait=false){if(wait){await new Promise((resolve)=>{const waitForServer=(delay)=>{browser.setTimeout(async()=>{env.services.rpc("/web/webclient/version_info",{}).then(resolve).catch(()=>waitForServer(250));},delay);};waitForServer(1000);});}
browser.location.assign(url);}
function getRoute(urlObj){const{pathname,search,hash}=urlObj;const searchQuery=parseSearchQuery(search);const hashQuery=parseHash(hash);return{pathname,search:searchQuery,hash:hashQuery};}
function makeRouter(env){const bus=env.bus;const lockedKeys=new Set();let current=getRoute(browser.location);let pushTimeout;browser.addEventListener("hashchange",(ev)=>{browser.clearTimeout(pushTimeout);const loc=new URL(ev.newURL);current=getRoute(loc);bus.trigger("ROUTE_CHANGE");});function makeDebouncedPush(mode){let allPushArgs=[];function doPush(){const replace=allPushArgs.some(([,options])=>options&&options.replace);const newHash=allPushArgs.reduce((finalHash,[hash,options])=>{hash=applyLocking(lockedKeys,hash,current.hash,options);if(finalHash){hash=applyLocking(lockedKeys,hash,finalHash,options);}
return Object.assign(finalHash||{},hash);},null);const newRoute=computeNewRoute(newHash,replace,current);if(!newRoute){return;}
const url=browser.location.origin+routeToUrl(newRoute);if(mode==="push"){browser.history.pushState({},"",url);}else{browser.history.replaceState({},"",url);}
current=getRoute(browser.location);}
return function pushOrReplaceState(hash,options){allPushArgs.push([hash,options]);browser.clearTimeout(pushTimeout);pushTimeout=browser.setTimeout(()=>{doPush();pushTimeout=null;allPushArgs=[];});};}
return{get current(){return current;},pushState:makeDebouncedPush("push"),replaceState:makeDebouncedPush("replace"),redirect:(url,wait)=>redirect(env,url,wait),cancelPushes:()=>browser.clearTimeout(pushTimeout),};}
const routerService=__exports.routerService={start(env){return makeRouter(env);},};__exports.objectToQuery=objectToQuery;function objectToQuery(obj){const query={};Object.entries(obj).forEach(([k,v])=>{query[k]=v?String(v):v;});return query;}
registry.category("services").add("router",routerService);return __exports;});;

/* /web/static/src/core/browser/title_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/browser/title_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const titleService=__exports.titleService={start(){const titleParts={};function getParts(){return Object.assign({},titleParts);}
function setParts(parts){for(const key in parts){const val=parts[key];if(!val){delete titleParts[key];}else{titleParts[key]=val;}}
document.title=Object.values(titleParts).join(" - ");}
return{get current(){return document.title;},getParts,setParts,};},};registry.category("services").add("title",titleService);return __exports;});;

/* /web/static/src/core/checkbox/checkbox.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/checkbox/checkbox',async function(require){'use strict';let __exports={};const{Component,QWeb}=owl;const CheckBox=__exports.CheckBox=class CheckBox extends Component{setup(){this.id=`checkbox-comp-${CheckBox.nextId++}`;}}
CheckBox.template="web.CheckBox";CheckBox.nextId=1;QWeb.registerComponent("CheckBox",CheckBox);return __exports;});;

/* /web/static/src/core/commands/command_category.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/commands/command_category',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const commandCategoryRegistry=registry.category("command_categories");commandCategoryRegistry.add("app",{},{sequence:10}).add("smart_action",{},{sequence:15}).add("actions",{},{sequence:30}).add("navbar",{},{sequence:40}).add("default",{},{sequence:100}).add("debug",{},{sequence:110});return __exports;});;

/* /web/static/src/core/commands/command_hook.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/commands/command_hook',async function(require){'use strict';let __exports={};const{useEffect,useService}=require("@web/core/utils/hooks");__exports.useCommand=useCommand;function useCommand(name,action,options={}){const commandService=useService("command");useEffect(()=>commandService.add(name,action,options),()=>[]);}
return __exports;});;

/* /web/static/src/core/commands/command_palette.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/commands/command_palette',async function(require){'use strict';let __exports={};const{useAutofocus,useService}=require("@web/core/utils/hooks");const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{KeepLast}=require("@web/core/utils/concurrency");const{scrollTo}=require("@web/core/utils/scrolling");const{fuzzyLookup}=require("@web/core/utils/search");const{debounce}=require("@web/core/utils/timing");const{_lt}=require("@web/core/l10n/translation");const{Component,hooks}=owl;const{useState}=hooks;const DEFAULT_PLACEHOLDER=_lt("Search...");const DEFAULT_EMPTY_MESSAGE=_lt("No results found");const FUZZY_NAMESPACES=["default"];function commandsWithinCategory(categoryName,categories){return(cmd)=>{const inCurrentCategory=categoryName===cmd.category;const fallbackCategory=categoryName==="default"&&!categories.includes(cmd.category);return inCurrentCategory||fallbackCategory;};}
const DefaultCommandItem=__exports.DefaultCommandItem=class DefaultCommandItem extends Component{}
DefaultCommandItem.template="web.DefaultCommandItem";const CommandPalette=__exports.CommandPalette=class CommandPalette extends Component{setup(){this.keyId=1;this.keepLast=new KeepLast();this.DefaultCommandItem=DefaultCommandItem;this.activeElement=useService("ui").activeElement;const onDebouncedSearchInput=debounce.apply(this,[this.onSearchInput,200]);this.onDebouncedSearchInput=(...args)=>{this.inputPromise=onDebouncedSearchInput.apply(this,args).catch(()=>{this.inputPromise=null;});};useAutofocus();useHotkey("Enter",()=>this.executeSelectedCommand(),{bypassEditableProtection:true});useHotkey("ArrowUp",()=>this.selectCommandAndScrollTo("PREV"),{bypassEditableProtection:true,allowRepeat:true,});useHotkey("ArrowDown",()=>this.selectCommandAndScrollTo("NEXT"),{bypassEditableProtection:true,allowRepeat:true,});this.state=useState({commands:[],});this.setCommandPaletteConfig(this.props.config);}
get commandsByCategory(){const categories=[];for(const category of this.categoryKeys){const commands=this.state.commands.filter(commandsWithinCategory(category,this.categoryKeys));if(commands.length){categories.push({commands,keyId:category,});}}
return categories;}
setCommandPaletteConfig(config){const result={default:[]};for(const provider of config.providers){const namespace=provider.namespace||"default";if(namespace in result){result[namespace].push(provider);}else{result[namespace]=[provider];}}
this.categoriesByNamespace=config.categoriesByNamespace;this.emptyMessageByNamespace=config.emptyMessageByNamespace||{};this.providersByNamespace=result;this.state.footerTemplate=config.footerTemplate;this.state.placeholder=config.placeholder||DEFAULT_PLACEHOLDER.toString();const namespace=config.namespace||"default";this.setCommands(namespace,{activeElement:this.activeElement,searchValue:"",});this.state.searchValue=namespace==="default"?"":namespace;}
async setCommands(namespace,options={}){this.categoryKeys=["default"];const proms=this.providersByNamespace[namespace].map((provider)=>{const{provide}=provider;const result=provide(this.env,options);return result;});let commands=(await this.keepLast.add(Promise.all(proms))).flat();if(options.searchValue&&FUZZY_NAMESPACES.includes(namespace)){commands=fuzzyLookup(options.searchValue,commands,(c)=>c.name);}else{if(this.categoriesByNamespace&&this.categoriesByNamespace[namespace]){let commandsSorted=[];this.categoryKeys=this.categoriesByNamespace[namespace];if(!this.categoryKeys.includes("default")){this.categoryKeys.push("default");}
for(const category of this.categoryKeys){commandsSorted=commandsSorted.concat(commands.filter(commandsWithinCategory(category,this.categoryKeys)));}
commands=commandsSorted;}}
this.state.commands=commands.map((command)=>({...command,keyId:this.keyId++,}));this.selectCommand(this.state.commands.length?0:-1);this.mouseSelectionActive=false;this.state.emptyMessage=this.emptyMessageByNamespace[namespace]||DEFAULT_EMPTY_MESSAGE.toString();}
selectCommand(index){if(index===-1||index>=this.state.commands.length){this.state.selectedCommand=null;return;}
this.state.selectedCommand=this.state.commands[index];}
selectCommandAndScrollTo(type){this.mouseSelectionActive=false;const index=this.state.commands.indexOf(this.state.selectedCommand);if(index===-1){return;}
let nextIndex;if(type==="NEXT"){nextIndex=index<this.state.commands.length-1?index+1:0;}else if(type==="PREV"){nextIndex=index>0?index-1:this.state.commands.length-1;}
this.selectCommand(nextIndex);const listbox=this.el.querySelector(".o_command_palette_listbox");const command=listbox.querySelector(`#o_command_${nextIndex}`);scrollTo(command,{scrollable:listbox});}
onCommandClicked(index){this.selectCommand(index);this.executeSelectedCommand();}
async executeCommand(command){const config=await command.action();if(config){this.setCommandPaletteConfig(config);}else{this.props.closeMe();}}
async executeSelectedCommand(){await this.inputPromise;if(this.state.selectedCommand){this.executeCommand(this.state.selectedCommand);}}
onCommandMouseEnter(index){if(this.mouseSelectionActive){this.selectCommand(index);}else{this.mouseSelectionActive=true;}}
async onSearchInput(ev){this.state.searchValue=ev.target.value;let searchValue=this.state.searchValue;let namespace="default";if(searchValue.length&&searchValue[0]in this.providersByNamespace){namespace=searchValue[0];searchValue=searchValue.slice(1);}
await this.setCommands(namespace,{searchValue,activeElement:this.activeElement,});}}
CommandPalette.template="web.CommandPalette";return __exports;});;

/* /web/static/src/core/commands/command_palette_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/commands/command_palette_dialog',async function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{CommandPalette}=require("@web/core/commands/command_palette");const{hooks}=owl;const{useExternalListener}=hooks;const CommandPaletteDialog=__exports.CommandPaletteDialog=class CommandPaletteDialog extends Dialog{setup(){super.setup();useExternalListener(window,"mousedown",this.onWindowMouseDown);}
onWindowMouseDown(ev){const element=ev.target.parentElement;const gotClickedInside=this.modalRef.el.contains(element);if(!gotClickedInside){this.close();}}}
CommandPaletteDialog.renderHeader=false;CommandPaletteDialog.renderFooter=false;CommandPaletteDialog.size="modal-md";CommandPaletteDialog.contentClass="o_command_palette";CommandPaletteDialog.bodyTemplate="web.CommandPaletteDialogBody";CommandPaletteDialog.components=Object.assign({},Dialog.components,{CommandPalette});return __exports;});;

/* /web/static/src/core/commands/command_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/commands/command_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{CommandPaletteDialog}=require("@web/core/commands/command_palette_dialog");const{xml}=owl.tags;const commandCategoryRegistry=registry.category("command_categories");const commandEmptyMessageRegistry=registry.category("command_empty_list");const commandProviderRegistry=registry.category("command_provider");const footerTemplate=xml`
<span>
    <span class='o_promote'>TIP</span> — search for <span class='o_promote'>@</span>users, <span class='o_promote'>#</span>channels, and <span class='o_promote'>/</span>menus
</span>
`;const commandService=__exports.commandService={dependencies:["dialog","hotkey","ui"],start(env,{dialog,hotkey:hotkeyService,ui}){const registeredCommands=new Map();let nextToken=0;let isPaletteOpened=false;hotkeyService.add("control+k",openMainPalette,{bypassEditableProtection:true,global:true,});function openMainPalette(){const categoriesByNamespace={};commandCategoryRegistry.getEntries().forEach(([category,el])=>{const namespace=el.namespace?el.namespace:"default";if(namespace in categoriesByNamespace){categoriesByNamespace[namespace].push(category);}else{categoriesByNamespace[namespace]=[category];}});const emptyMessageByNamespace={};commandEmptyMessageRegistry.getEntries().forEach(([key,message])=>{emptyMessageByNamespace[key]=message.toString();});const config={categoriesByNamespace,emptyMessageByNamespace,footerTemplate,placeholder:env._t("Search for a command..."),providers:commandProviderRegistry.getAll(),};return openPalette(config);}
function openPalette(config){if(isPaletteOpened){return config;}
isPaletteOpened=true;dialog.add(CommandPaletteDialog,{config,},{onClose:()=>{isPaletteOpened=false;},});}
function registerCommand(command,options){if(!command.name||!command.action||typeof command.action!=="function"){throw new Error("A Command must have a name and an action function.");}
const registration=Object.assign({},command,options);if(registration.hotkey){registration.removeHotkey=hotkeyService.add(registration.hotkey,registration.action,{activeElement:registration.activeElement,global:registration.global,});}
const token=nextToken++;registeredCommands.set(token,registration);if(!options.activeElement){Promise.resolve().then(()=>{registration.activeElement=ui.activeElement;});}
return token;}
function unregisterCommand(token){const cmd=registeredCommands.get(token);if(cmd&&cmd.removeHotkey){cmd.removeHotkey();}
registeredCommands.delete(token);}
return{add(name,action,options={}){const token=registerCommand({name,action},options);return()=>{unregisterCommand(token);};},getCommands(activeElement){return[...registeredCommands.values()].filter((command)=>command.activeElement===activeElement||command.global);},openPalette,};},};registry.category("services").add("command",commandService);return __exports;});;

/* /web/static/src/core/commands/default_providers.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/commands/default_providers',async function(require){'use strict';let __exports={};const{isMacOS}=require("@web/core/browser/feature_detection");const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{_lt}=require("@web/core/l10n/translation");const{registry}=require("@web/core/registry");const{capitalize}=require("@web/core/utils/strings");const{getVisibleElements}=require("@web/core/utils/ui");const{DefaultCommandItem}=require("@web/core/commands/command_palette");const{Component}=owl;const HotkeyCommandItem=__exports.HotkeyCommandItem=class HotkeyCommandItem extends Component{setup(){useHotkey(this.props.hotkey,()=>{this.trigger("execute-command");});}
getKeysToPress(command){const{hotkey}=command;let result=hotkey.split("+");if(isMacOS()){result=result.map((x)=>x.replace("control","command")).map((x)=>x.replace("alt","control"));}
return result.map((key)=>key.toUpperCase());}}
HotkeyCommandItem.template="web.HotkeyCommandItem";const commandEmptyMessageRegistry=registry.category("command_empty_list");commandEmptyMessageRegistry.add("default",_lt("No commands found"));const commandCategoryRegistry=registry.category("command_categories");const commandProviderRegistry=registry.category("command_provider");commandProviderRegistry.add("command",{provide:(env,options={})=>{const commands=env.services.command.getCommands(options.activeElement).map((cmd)=>{cmd.category=commandCategoryRegistry.contains(cmd.category)?cmd.category:"default";return cmd;});return commands.map((command)=>({Component:command.hotkey?HotkeyCommandItem:DefaultCommandItem,action:command.action,category:command.category,name:command.name,props:{hotkey:command.hotkey,hotkeyOptions:command.hotkeyOptions,},}));},});commandProviderRegistry.add("data-hotkeys",{provide:(env,options={})=>{const commands=[];const overlayModifier=registry.category("services").get("hotkey").overlayModifier;for(const el of getVisibleElements(options.activeElement,"[data-hotkey]:not(:disabled)")){const closest=el.closest("[data-command-category]");const category=closest?closest.dataset.commandCategory:"default";const description=el.title||el.dataset.originalTitle||el.placeholder||(el.innerText&&`${el.innerText.slice(0, 50)}${el.innerText.length > 50 ? "..." : ""}`)||env._t("no description provided");commands.push({Component:HotkeyCommandItem,action:()=>{el.focus();el.click();},category,name:capitalize(description.trim().toLowerCase()),props:{hotkey:`${overlayModifier}+${el.dataset.hotkey}`,},});}
return commands;},});return __exports;});;

/* /web/static/src/core/confirmation_dialog/confirmation_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/confirmation_dialog/confirmation_dialog',async function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{_lt}=require("@web/core/l10n/translation");const ConfirmationDialog=__exports.ConfirmationDialog=class ConfirmationDialog extends Dialog{setup(){super.setup();this.title=this.props.title;}
_cancel(){if(this.props.cancel){this.props.cancel();}
this.close();}
_confirm(){if(this.props.confirm){this.props.confirm();}
this.close();}}
ConfirmationDialog.props={title:{validate:(m)=>{return(typeof m==="string"||(typeof m==="object"&&typeof m.toString==="function"));},},body:String,confirm:{type:Function,optional:true},cancel:{type:Function,optional:true},close:Function,};ConfirmationDialog.defaultProps={title:_lt("Confirmation"),};ConfirmationDialog.bodyTemplate="web.ConfirmationDialogBody";ConfirmationDialog.footerTemplate="web.ConfirmationDialogFooter";ConfirmationDialog.size="modal-md";const AlertDialog=__exports.AlertDialog=class AlertDialog extends ConfirmationDialog{setup(){super.setup();if("contentClass"in this.props){this.contentClass=this.props.contentClass;}}}
AlertDialog.size="modal-sm";AlertDialog.props=Object.assign(Object.create(ConfirmationDialog.props),{contentClass:{type:String,optional:true},});AlertDialog.defaultProps={title:_lt("Alert"),};return __exports;});;

/* /web/static/src/core/context.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/context',async function(require){'use strict';let __exports={};const{evaluateExpr}=require("@web/core/py_js/py");__exports.makeContext=makeContext;function makeContext(contexts,initialEvaluationContext){const evaluationContext=Object.assign({},initialEvaluationContext);const context={};for(let ctx of contexts){if(ctx!==""){ctx=typeof ctx==="string"?evaluateExpr(ctx,evaluationContext):ctx;Object.assign(context,ctx);Object.assign(evaluationContext,context);}}
return context;}
return __exports;});;

/* /web/static/src/core/datepicker/datepicker.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/datepicker/datepicker',async function(require){'use strict';let __exports={};const{localization}=require("@web/core/l10n/localization");const{registry}=require("@web/core/registry");const{useAutofocus}=require("@web/core/utils/hooks");const{Component,hooks}=owl;const{DateTime}=luxon;const{useExternalListener,useRef,useState}=hooks;const formatters=registry.category("formatters");const parsers=registry.category("parsers");let datePickerId=0;const luxonDateToMomentDate=(date)=>{return window.moment(String(date));};const luxonFormatToMomentFormat=(format)=>{return format.replace(/[dy]/g,(x)=>x.toUpperCase());};const DatePicker=__exports.DatePicker=class DatePicker extends Component{setup(){this.inputRef=useRef("input");this.state=useState({warning:false});this.datePickerId=`o_datepicker_${datePickerId++}`;this.initFormat();this.setDate(this.props);useAutofocus();useExternalListener(window,"scroll",this.onWindowScroll);}
mounted(){window.$(this.el).on("show.datetimepicker",()=>this.inputRef.el.select());window.$(this.el).on("hide.datetimepicker",()=>this.onDateChange());window.$(this.el).on("error.datetimepicker",()=>false);this.bootstrapDateTimePicker(this.props);this.updateInput();}
willUpdateProps(nextProps){const pickerParams={};for(const prop in nextProps){if(this.props[prop]!==nextProps[prop]){pickerParams[prop]=nextProps[prop];if(prop==="date"){this.setDate(nextProps);this.updateInput();}}}
this.bootstrapDateTimePicker(pickerParams);}
willUnmount(){window.$(this.el).off();this.bootstrapDateTimePicker("destroy");}
get options(){return{format:this.props.format,locale:this.props.locale||this.date.locale,timezone:this.isLocal,};}
initFormat(){this.defaultFormat=localization.dateFormat;this.format=formatters.get("date");this.parse=parsers.get("date");this.isLocal=false;}
setDate({date,locale}){this.date=locale?date.setLocale(locale):date;}
updateInput(){try{this.inputRef.el.value=this.format(this.date,this.options);}catch(err){}}
bootstrapDateTimePicker(commandOrParams){if(typeof commandOrParams==="object"){const format=luxonFormatToMomentFormat(this.props.format||this.defaultFormat);const params={...commandOrParams,format};if(!params.locale&&commandOrParams.date){params.locale=commandOrParams.date.locale;}
for(const prop in params){if(params[prop]instanceof DateTime){const luxonDate=params[prop];const momentDate=luxonDateToMomentDate(luxonDate);params[prop]=momentDate;}}
commandOrParams=params;}
window.$(this.el).datetimepicker(commandOrParams);}
onInputClick(){this.bootstrapDateTimePicker("toggle");}
onDateChange(){try{const date=this.parse(this.inputRef.el.value,this.options);if(!date.equals(this.props.date)){this.state.warning=date>DateTime.local();this.trigger("datetime-changed",{date});}}catch(err){this.updateInput();}}
onWindowScroll(ev){if(ev.target!==this.inputRef.el){this.bootstrapDateTimePicker("hide");}}}
DatePicker.defaultProps={calendarWeeks:true,icons:{clear:"fa fa-delete",close:"fa fa-check primary",date:"fa fa-calendar",down:"fa fa-chevron-down",next:"fa fa-chevron-right",previous:"fa fa-chevron-left",time:"fa fa-clock-o",today:"fa fa-calendar-check-o",up:"fa fa-chevron-up",},maxDate:DateTime.fromObject({year:9999,month:12,day:31}),minDate:DateTime.fromObject({year:1000}),useCurrent:false,widgetParent:"body",};DatePicker.props={date:DateTime,warn_future:{type:Boolean,optional:true},buttons:{type:Object,shape:{showClear:Boolean,showClose:Boolean,showToday:Boolean,},optional:true,},calendarWeeks:Boolean,format:{type:String,optional:true},icons:{type:Object,shape:{clear:String,close:String,date:String,down:String,next:String,previous:String,time:String,today:String,up:String,},},keyBinds:{validate:(kb)=>typeof kb==="object"||kb===null,optional:true},locale:{type:String,optional:true},maxDate:DateTime,minDate:DateTime,readonly:{type:Boolean,optional:true},useCurrent:Boolean,widgetParent:String,};DatePicker.template="web.DatePicker";const DateTimePicker=__exports.DateTimePicker=class DateTimePicker extends DatePicker{initFormat(){this.defaultFormat=localization.dateTimeFormat;this.format=formatters.get("datetime");this.parse=parsers.get("datetime");this.isLocal=true;}}
DateTimePicker.defaultProps={...DatePicker.defaultProps,buttons:{showClear:false,showClose:true,showToday:false,},};return __exports;});;

/* /web/static/src/core/debug/debug_context.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/debug/debug_context',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{memoize}=require("@web/core/utils/functions");const{useEffect}=require("@web/core/utils/hooks");const{useEnv,useSubEnv}=owl.hooks;const debugRegistry=registry.category("debug");const getAccessRights=memoize(async function getAccessRights(orm){const rightsToCheck={"ir.ui.view":"write","ir.rule":"read","ir.model.access":"read",};const proms=Object.entries(rightsToCheck).map(([model,operation])=>{return orm.call(model,"check_access_rights",[],{operation,raise_exception:false,});});const[canEditView,canSeeRecordRules,canSeeModelAccess]=await Promise.all(proms);const accessRights={canEditView,canSeeRecordRules,canSeeModelAccess};return accessRights;});class DebugContext{constructor(env,defaultCategories){this.orm=env.services.orm;this.categories=new Map(defaultCategories.map((cat)=>[cat,[{}]]));}
activateCategory(category,context){const contexts=this.categories.get(category)||new Set();contexts.add(context);this.categories.set(category,contexts);return()=>{contexts.delete(context);if(contexts.size===0){this.categories.delete(category);}};}
async getItems(env){const accessRights=await getAccessRights(this.orm);return[...this.categories.entries()].flatMap(([category,contexts])=>{return debugRegistry.category(category).getAll().map((factory)=>factory(Object.assign({env,accessRights},...contexts)));}).filter(Boolean).sort((x,y)=>{const xSeq=x.sequence||1000;const ySeq=y.sequence||1000;return xSeq-ySeq;});}}
const debugContextSymbol=Symbol("debugContext");__exports.createDebugContext=createDebugContext;function createDebugContext(env,{categories=[]}={}){return{[debugContextSymbol]:new DebugContext(env,categories)};}
__exports.useOwnDebugContext=useOwnDebugContext;function useOwnDebugContext({categories=[]}={}){useSubEnv(createDebugContext(useEnv(),{categories}));}
__exports.useEnvDebugContext=useEnvDebugContext;function useEnvDebugContext(){const debugContext=useEnv()[debugContextSymbol];if(!debugContext){throw new Error("There is no debug context available in the current environment.");}
return debugContext;}
__exports.useDebugCategory=useDebugCategory;function useDebugCategory(category,context={}){const env=useEnv();if(env.debug){const debugContext=useEnvDebugContext();useEffect(()=>debugContext.activateCategory(category,context),()=>[]);}}
return __exports;});;

/* /web/static/src/core/debug/debug_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/debug/debug_menu',async function(require){'use strict';let __exports={};const{DebugMenuBasic}=require("@web/core/debug/debug_menu_basic");const{useCommand}=require("@web/core/commands/command_hook");const{useService}=require("@web/core/utils/hooks");const{useEnvDebugContext}=require("@web/core/debug/debug_context");const DebugMenu=__exports.DebugMenu=class DebugMenu extends DebugMenuBasic{setup(){super.setup();const debugContext=useEnvDebugContext();this.command=useService("command");useCommand(this.env._t("Debug tools..."),async()=>{const items=await debugContext.getItems(this.env);let index=0;const defaultCategories=items.filter((item)=>item.type==="separator").map(()=>(index+=1));const provider={async provide(){const categories=[...defaultCategories];let category=categories.shift();const result=[];items.forEach((item)=>{if(item.type==="item"){result.push({name:item.description.toString(),action:item.callback,category,});}else if(item.type==="separator"){category=categories.shift();}});return result;},};const commandPaletteConfig={categoriesByNamespace:{default:defaultCategories,},emptyMessageByNamespace:{default:this.env._t("No commands found")},placeholder:this.env._t("Choose a debug command..."),providers:[provider],};return this.command.openPalette(commandPaletteConfig);},{category:"debug",});}}
return __exports;});;

/* /web/static/src/core/debug/debug_menu_basic.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/debug/debug_menu_basic',async function(require){'use strict';let __exports={};const{useEnvDebugContext}=require("@web/core/debug/debug_context");const{Component}=owl;const DebugMenuBasic=__exports.DebugMenuBasic=class DebugMenuBasic extends Component{setup(){const debugContext=useEnvDebugContext();this.getElements=async()=>{this.elements=await debugContext.getItems(this.env);};}}
DebugMenuBasic.template="web.DebugMenu";return __exports;});;

/* /web/static/src/core/debug/debug_menu_items.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/debug/debug_menu_items',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{routeToUrl}=require("@web/core/browser/router_service");const{registry}=require("@web/core/registry");function activateAssetsDebugging({env}){return{type:"item",description:env._t("Activate Assets Debugging"),callback:()=>{browser.location.search="?debug=assets";},sequence:410,};}
function activateTestsAssetsDebugging({env}){return{type:"item",description:env._t("Activate Tests Assets Debugging"),callback:()=>{browser.location.search="?debug=assets,tests";},sequence:420,};}
__exports.regenerateAssets=regenerateAssets;function regenerateAssets({env}){return{type:"item",description:env._t("Regenerate Assets Bundles"),callback:async()=>{const domain=["&",["res_model","=","ir.ui.view"],"|",["name","=like","%.assets_%.css"],["name","=like","%.assets_%.js"],];const ids=await env.services.orm.search("ir.attachment",domain);await env.services.orm.unlink("ir.attachment",ids);browser.location.reload();},sequence:430,};}
function becomeSuperuser({env}){const becomeSuperuserURL=browser.location.origin+"/web/become";return{type:"item",description:env._t("Become Superuser"),hide:!env.services.user.isAdmin,href:becomeSuperuserURL,callback:()=>{browser.open(becomeSuperuserURL,"_self");},sequence:440,};}
function leaveDebugMode({env}){return{type:"item",description:env._t("Leave the Developer Tools"),callback:()=>{const route=env.services.router.current;route.search.debug="";browser.location.href=browser.location.origin+routeToUrl(route);},sequence:450,};}
registry.category("debug").category("default").add("activateAssetsDebugging",activateAssetsDebugging).add("regenerateAssets",regenerateAssets).add("becomeSuperuser",becomeSuperuser).add("leaveDebugMode",leaveDebugMode).add("activateTestsAssetsDebugging",activateTestsAssetsDebugging);return __exports;});;

/* /web/static/src/core/debug/debug_providers.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/debug/debug_providers',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{browser}=require("@web/core/browser/browser");const{routeToUrl}=require("@web/core/browser/router_service");const commandProviderRegistry=registry.category("command_provider");commandProviderRegistry.add("debug",{provide:(env,options)=>{const result=[];if(env.debug){result.push({action(){const route=env.services.router.current;route.search.debug="";browser.location.href=browser.location.origin+routeToUrl(route);},category:"debug",name:env._t("Deactivate debug mode"),});}else{if(options.searchValue.toLowerCase()==="debug"){result.push({action(){browser.location.search="?debug=assets";},category:"debug",name:env._t("Activate debug mode"),});}}
return result;},});return __exports;});;

/* /web/static/src/core/debug/debug_utils.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/debug/debug_utils',async function(require){'use strict';let __exports={};__exports.editModelDebug=editModelDebug;function editModelDebug(env,title,model,id){return env.services.action.doAction({res_model:model,res_id:id,name:title,type:"ir.actions.act_window",views:[[false,"form"]],view_mode:"form",target:"new",flags:{action_buttons:true,headless:true},});}
return __exports;});;

/* /web/static/src/core/debug/profiling/profiling_item.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/debug/profiling/profiling_item',async function(require){'use strict';let __exports={};const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{useBus,useService}=require("@web/core/utils/hooks");const{Component}=owl;const ProfilingItem=__exports.ProfilingItem=class ProfilingItem extends Component{setup(){this.profiling=useService("profiling");useBus(this.props.bus,"UPDATE",this.render);}
changeParam(param,ev){this.profiling.setParam(param,ev.target.value);}
toggleParam(param,ev){const value=this.profiling.state.params.execution_context_qweb;this.profiling.setParam(param,!value);}
openProfiles(){if(this.env.services.action){this.env.services.action.doAction("base.action_menu_ir_profile");}else{window.location="/web/#action=base.action_menu_ir_profile";}}}
ProfilingItem.components={DropdownItem};ProfilingItem.template="web.DebugMenu.ProfilingItem";return __exports;});;

/* /web/static/src/core/debug/profiling/profiling_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/debug/profiling/profiling_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{ProfilingItem}=require("@web/core/debug/profiling/profiling_item");const{session}=require("@web/session");const{core}=owl;const profilingService={dependencies:["orm"],start(env,{orm}){const state={session:session.profile_session||false,collectors:session.profile_collectors||["sql","traces_async"],params:session.profile_params||{},get isEnabled(){return Boolean(state.session);},};const bus=new core.EventBus();let recordingIcon=null;function updateDebugIcon(){const debugItem=document.querySelector(".o_main_navbar .o_debug_manager .fa-bug");if(state.isEnabled){recordingIcon=document.createElement("span");recordingIcon.classList.add("o_recording","text-danger","fa","fa-circle");debugItem.appendChild(recordingIcon);}else if(recordingIcon){debugItem.removeChild(recordingIcon);recordingIcon=null;}}
if(env.debug){env.bus.on("WEB_CLIENT_READY",null,updateDebugIcon);}
async function setProfiling(params){const kwargs=Object.assign({collectors:state.collectors,params:state.params,profile:state.isEnabled,},params);const resp=await orm.call("ir.profile","set_profiling",[],kwargs);if(resp.type){env.services.action.doAction(resp);}else{state.session=resp.session;state.collectors=resp.collectors;state.params=resp.params;bus.trigger("UPDATE");updateDebugIcon();}}
function profilingSeparator(){return{type:"separator",sequence:500,};}
function profilingItem(){return{type:"component",Component:ProfilingItem,props:{bus},sequence:510,};}
registry.category("debug").category("default").add("profilingSeparator",profilingSeparator).add("profilingItem",profilingItem);return{state,async toggleProfiling(){await setProfiling({profile:!state.isEnabled});},async toggleCollector(collector){let nextCollectors=state.collectors.slice();const index=nextCollectors.indexOf(collector);if(index>=0){nextCollectors.splice(index,1);}else{nextCollectors.push(collector);}
await setProfiling({collectors:nextCollectors});},async setParam(key,value){const nextParams=Object.assign({},state.params);nextParams[key]=value;await setProfiling({params:nextParams});},isCollectorEnabled(collector){return state.collectors.includes(collector);},};},};registry.category("services").add("profiling",profilingService);return __exports;});;

/* /web/static/src/core/dialog/dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/dialog/dialog',async function(require){'use strict';let __exports={};const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{useActiveElement}=require("@web/core/ui/ui_service");const{Component,hooks}=owl;const{useRef,useSubEnv}=hooks;const Dialog=__exports.Dialog=class Dialog extends Component{setup(){if(this.constructor===Dialog){throw new Error("Dialog should not be used by itself. Please use the dialog service with a Dialog subclass.");}
this.modalRef=useRef("modal");useActiveElement("modal");useHotkey("escape",()=>{this.close();});useSubEnv({inDialog:true});this.close=this.close.bind(this);this.contentClass=this.constructor.contentClass;this.fullscreen=this.constructor.fullscreen;this.renderFooter=this.constructor.renderFooter;this.renderHeader=this.constructor.renderHeader;this.size=this.constructor.size;this.technical=this.constructor.technical;this.title=this.constructor.title;}
close(){this.props.close();}}
Dialog.template="web.Dialog";Dialog.contentClass=null;Dialog.fullscreen=false;Dialog.renderFooter=true;Dialog.renderHeader=true;Dialog.size="modal-lg";Dialog.technical=true;Dialog.title="Odoo";Dialog.bodyTemplate=owl.tags.xml`<div/>`;Dialog.footerTemplate="web.DialogFooterDefault";return __exports;});;

/* /web/static/src/core/dialog/dialog_container.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/dialog/dialog_container',async function(require){'use strict';let __exports={};const{ErrorHandler,NotUpdatable}=require("@web/core/utils/components");const{Component,tags}=owl;const DialogContainer=__exports.DialogContainer=class DialogContainer extends Component{setup(){this.props.bus.on("UPDATE",this,this.render);}
close(id){if(this.props.dialogs[id]){this.props.dialogs[id].props.close();}}
handleError(error,dialogId){this.close(dialogId);Promise.resolve().then(()=>{throw error;});}}
DialogContainer.components={ErrorHandler,NotUpdatable};DialogContainer.template=tags.xml`
    <div class="o_dialog_container" t-att-class="{'modal-open': Object.keys(props.dialogs).length > 0}">
      <t t-foreach="Object.values(props.dialogs)" t-as="dialog" t-key="dialog.id">
        <NotUpdatable>
            <ErrorHandler onError="(error) => handleError(error, dialog.id)">
                <t t-component="dialog.class" t-props="dialog.props"
                    t-on-dialog-closed="dialog.props.close()" 
                    t-att-class="{o_inactive_modal: !dialog_last}"/>
            </ErrorHandler>
        </NotUpdatable>
      </t>
    </div>
    `;return __exports;});;

/* /web/static/src/core/dialog/dialog_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/dialog/dialog_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Dialog}=require("@web/core/dialog/dialog");const{DialogContainer}=require("@web/core/dialog/dialog_container");const{core}=owl;const{EventBus}=core;const dialogService=__exports.dialogService={start(){const dialogs={};const bus=new EventBus();let dialogId=0;registry.category("main_components").add("DialogContainer",{Component:DialogContainer,props:{bus,dialogs},});function add(dialogClass,props,options={}){if(!(dialogClass.prototype instanceof Dialog)){throw new Error(`${dialogClass.name} must be a subclass of Dialog`);}
const id=++dialogId;function close(){if(dialogs[id]){delete dialogs[id];if(options.onClose){options.onClose();}
bus.trigger("UPDATE");}}
const dialog={id,class:dialogClass,props:{...props,close},};dialogs[id]=dialog;bus.trigger("UPDATE");return close;}
return{add};},};registry.category("services").add("dialog",dialogService);return __exports;});;

/* /web/static/src/core/domain.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/domain',async function(require){'use strict';let __exports={};const{evaluate,formatAST,parseExpr}=require("@web/core/py_js/py");const{toPyValue}=require("@web/core/py_js/py_utils");class InvalidDomainError extends Error{}
const Domain=__exports.Domain=class Domain{static combine(domains,operator){if(domains.length===0){return new Domain([]);}
const domain1=domains[0]instanceof Domain?domains[0]:new Domain(domains[0]);if(domains.length===1){return domain1;}
const domain2=Domain.combine(domains.slice(1),operator);const result=new Domain([]);const astValues1=domain1.ast.value;const astValues2=domain2.ast.value;const op=operator==="AND"?"&":"|";const combinedAST={type:4,value:astValues1.concat(astValues2)};result.ast=normalizeDomainAST(combinedAST,op);return result;}
static and(domains){return Domain.combine(domains,"AND");}
static or(domains){return Domain.combine(domains,"OR");}
static not(domain){const result=new Domain(domain);result.ast.value.unshift({type:1,value:"!"});return result;}
constructor(descr=[]){if(descr instanceof Domain){return new Domain(descr.toString());}else{const rawAST=typeof descr==="string"?parseExpr(descr):toAST(descr);this.ast=normalizeDomainAST(rawAST);}}
contains(record){const expr=evaluate(this.ast,record);return matchDomain(record,expr);}
toString(){return formatAST(this.ast);}
toList(context){return evaluate(this.ast,context);}}
const TRUE_LEAF=[1,"=",1];const FALSE_LEAF=[0,"=",1];const TRUE_DOMAIN=new Domain([TRUE_LEAF]);const FALSE_DOMAIN=new Domain([FALSE_LEAF]);Domain.TRUE=TRUE_DOMAIN;Domain.FALSE=FALSE_DOMAIN;function toAST(domain){const elems=domain.map((elem)=>{switch(elem){case"!":case"&":case"|":return{type:1,value:elem};default:return{type:10,value:elem.map(toPyValue),};}});return{type:4,value:elems};}
function normalizeDomainAST(domain,op="&"){if(domain.type!==4){throw new InvalidDomainError("Invalid domain AST");}
if(domain.value.length===0){return domain;}
let expected=1;for(let child of domain.value){if(child.type===1&&(child.value==="&"||child.value==="|")){expected++;}else if(child.type!==1||child.value!=="!"){expected--;}}
let values=domain.value.slice();while(expected<0){expected++;values.unshift({type:1,value:op});}
if(expected>0){throw new InvalidDomainError(`invalid domain ${formatAST(domain)} (missing ${expected} segment(s))`);}
return{type:4,value:values};}
function matchCondition(record,condition){if(typeof condition==="boolean"){return condition;}
const[field,operator,value]=condition;const fieldValue=typeof field==="number"?field:record[field];switch(operator){case"=":case"==":return fieldValue===value;case"!=":case"<>":return fieldValue!==value;case"<":return fieldValue<value;case"<=":return fieldValue<=value;case">":return fieldValue>value;case">=":return fieldValue>=value;case"in":{const val=Array.isArray(value)?value:[value];const fieldVal=Array.isArray(fieldValue)?fieldValue:[fieldValue];return fieldVal.some((fv)=>val.includes(fv));}
case"not in":{const val=Array.isArray(value)?value:[value];const fieldVal=Array.isArray(fieldValue)?fieldValue:[fieldValue];return!fieldVal.some((fv)=>val.includes(fv));}
case"like":if(fieldValue===false){return false;}
return fieldValue.indexOf(value)>=0;case"=like":if(fieldValue===false){return false;}
return new RegExp(value.replace(/%/g,".*")).test(fieldValue);case"ilike":if(fieldValue===false){return false;}
return fieldValue.toLowerCase().indexOf(value.toLowerCase())>=0;case"=ilike":if(fieldValue===false){return false;}
return new RegExp(value.replace(/%/g,".*"),"i").test(fieldValue);}
throw new InvalidDomainError("could not match domain");}
function makeOperators(record){const match=matchCondition.bind(null,record);return{"!":(x)=>!match(x),"&":(a,b)=>match(a)&&match(b),"|":(a,b)=>match(a)||match(b),};}
function matchDomain(record,domain){if(domain.length===0){return true;}
const operators=makeOperators(record);const reversedDomain=Array.from(domain).reverse();const condStack=[];for(const item of reversedDomain){if(item in operators){const operator=operators[item];const operands=condStack.splice(-operator.length);condStack.push(operator(...operands));}else{condStack.push(item);}}
return matchCondition(record,condStack.pop());}
return __exports;});;

/* /web/static/src/core/dropdown/dropdown.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/dropdown/dropdown',async function(require){'use strict';let __exports={};const{useBus,useEffect,useService}=require("@web/core/utils/hooks");const{usePosition}=require("@web/core/position/position_hook");const{useDropdownNavigation}=require("@web/core/dropdown/dropdown_navigation_hook");const{ParentClosingMode}=require("@web/core/dropdown/dropdown_item");const{localization}=require("@web/core/l10n/localization");const{Component,core,hooks,useState,QWeb}=owl;const{EventBus}=core;const{onWillStart,useExternalListener,useRef,useSubEnv}=hooks;const DIRECTION_CARET_CLASS={bottom:"dropdown",top:"dropup",left:"dropleft",right:"dropright",};const Dropdown=__exports.Dropdown=class Dropdown extends Component{setup(){this.state=useState({open:this.props.startOpen,groupIsOpen:this.props.startOpen,});onWillStart(()=>{if(this.state.open&&this.props.beforeOpen){return this.props.beforeOpen();}});if(!this.props.manualOnly){useExternalListener(window,"click",this.onWindowClicked);useBus(Dropdown.bus,"state-changed",this.onDropdownStateChanged);}
this.ui=useService("ui");useEffect(()=>{Promise.resolve().then(()=>{this.myActiveEl=this.ui.activeElement;});},()=>[]);this.hasParentDropdown=this.env.inDropdown;useSubEnv({inDropdown:true});useDropdownNavigation();let position=this.props.position||(this.hasParentDropdown?"right-start":"bottom-start");let[direction,variant="middle"]=position.split("-");if(localization.direction==="rtl"){if(["bottom","top"].includes(direction)){variant=variant==="start"?"end":"start";}else{direction=direction==="left"?"right":"left";}
position=[direction,variant].join("-");}
const positioningOptions={popper:"menuRef",position,};this.directionCaretClass=DIRECTION_CARET_CLASS[direction];this.togglerRef=useRef("togglerRef");if(this.props.toggler==="parent"){useEffect(()=>{const onClick=(ev)=>{if(this.el.contains(ev.target)){return;}
this.toggle();};this.el.parentElement.addEventListener("click",onClick);return()=>{this.el.parentElement.removeEventListener("click",onClick);};},()=>[]);usePosition(()=>this.el.parentElement,positioningOptions);}else{const togglerRef=useRef("togglerRef");usePosition(()=>togglerRef.el,positioningOptions);}}
async changeStateAndNotify(stateSlice){if(stateSlice.open&&this.props.beforeOpen){await this.props.beforeOpen();}
Object.assign(this.state,stateSlice);const stateChangedPayload={emitter:this,newState:{...this.state},};Dropdown.bus.trigger("state-changed",stateChangedPayload);}
close(){return this.changeStateAndNotify({open:false,groupIsOpen:false});}
open(){return this.changeStateAndNotify({open:true,groupIsOpen:true});}
toggle(){const toggled=!this.state.open;return this.changeStateAndNotify({open:toggled,groupIsOpen:toggled});}
onItemSelected(ev){const{dropdownClosingRequest}=ev.detail;const closeAll=dropdownClosingRequest.mode===ParentClosingMode.AllParents;const closeSelf=dropdownClosingRequest.isFresh&&dropdownClosingRequest.mode===ParentClosingMode.ClosestParent;if(!this.props.manualOnly&&(closeAll||closeSelf)){this.close();}
ev.detail.dropdownClosingRequest.isFresh=false;}
onDropdownStateChanged(args){if(this.el.contains(args.emitter.el)){return;}
if(args.emitter.el.parentElement===this.el.parentElement){this.state.groupIsOpen=args.newState.groupIsOpen;if(this.state.open&&args.newState.open){this.state.open=false;}}else{if(this.state.open&&args.newState.open){this.close();}}}
onTogglerClick(){this.toggle();}
onTogglerMouseEnter(){if(this.state.groupIsOpen&&!this.state.open){this.open();}}
onWindowClicked(ev){if(!this.state.open){return;}
if(this.ui.activeElement!==this.myActiveEl){return;}
const rootEl=this.props.toggler==="parent"?this.el.parentElement:this.el;const gotClickedInside=rootEl.contains(ev.target);if(!gotClickedInside){this.close();}}}
Dropdown.bus=new EventBus();Dropdown.props={toggler:{type:String,optional:true,validate:(prop)=>["parent"].includes(prop),},startOpen:{type:Boolean,optional:true,},manualOnly:{type:Boolean,optional:true,},menuClass:{type:String,optional:true,},beforeOpen:{type:Function,optional:true,},togglerClass:{type:String,optional:true,},hotkey:{type:String,optional:true,},title:{type:String,optional:true,},position:{type:String,optional:true,},};Dropdown.template="web.Dropdown";QWeb.registerComponent("Dropdown",Dropdown);return __exports;});;

/* /web/static/src/core/dropdown/dropdown_item.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/dropdown/dropdown_item',async function(require){'use strict';let __exports={};const{Component,QWeb}=owl;const ParentClosingMode=__exports.ParentClosingMode={None:"none",ClosestParent:"closest",AllParents:"all",};const DropdownItem=__exports.DropdownItem=class DropdownItem extends Component{onClick(ev){if(this.props.href){ev.preventDefault();}
const detail={payload:this.props.payload,dropdownClosingRequest:{isFresh:true,mode:this.props.parentClosingMode,},};this.trigger("dropdown-item-selected",detail);}}
DropdownItem.template="web.DropdownItem";DropdownItem.props={payload:{type:Object,optional:true,},parentClosingMode:{type:ParentClosingMode,optional:true,},hotkey:{type:String,optional:true,},href:{type:String,optional:true,},title:{type:String,optional:true,},};DropdownItem.defaultProps={parentClosingMode:ParentClosingMode.AllParents,};QWeb.registerComponent("DropdownItem",DropdownItem);return __exports;});;

/* /web/static/src/core/dropdown/dropdown_navigation_hook.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/dropdown/dropdown_navigation_hook',async function(require){'use strict';let __exports={};const{useEffect,useService}=require("@web/core/utils/hooks");const{browser}=require("@web/core/browser/browser");const{localization}=require("@web/core/l10n/localization");const{scrollTo}=require("@web/core/utils/scrolling");const{hooks}=owl;const{useComponent,useRef}=hooks;const ACTIVE_MENU_ELEMENT_CLASS="focus";const MENU_ELEMENTS_SELECTORS=[":scope > .dropdown-item",":scope > .dropdown"];const NEXT_ACTIVE_INDEX_FNS={FIRST:()=>0,LAST:(list)=>list.length-1,NEXT:(list,prevActiveIndex)=>(prevActiveIndex+1)%list.length,PREV:(list,prevActiveIndex)=>(prevActiveIndex<=0?list.length:prevActiveIndex)-1,};__exports.useDropdownNavigation=useDropdownNavigation;function useDropdownNavigation(){const comp=useComponent();if(comp.hasParentDropdown&&comp.props.toggler==="parent"){throw new Error("A nested Dropdown must use its standard toggler");}
const originalOnTogglerClick=comp.onTogglerClick.bind(comp);comp.onTogglerClick=(ev)=>{if(comp.hasParentDropdown&&!ev.__fromDropdownNavigation){return;}
originalOnTogglerClick();};const originalOnTogglerMouseEnter=comp.onTogglerMouseEnter.bind(comp);comp.onTogglerMouseEnter=()=>{if(comp.hasParentDropdown){return;}
originalOnTogglerMouseEnter();};let mouseSelectionActive=true;const menuRef=useRef("menuRef");let menuElements=[];useEffect(()=>{if(!comp.state.open){return;}
const addedListeners=[];const queryResult=menuRef.el.querySelectorAll(MENU_ELEMENTS_SELECTORS.join());for(const el of queryResult){const isSubDropdown=el.classList.contains("dropdown");const isSubDropdownOpen=()=>el.classList.contains("show");const navTarget=isSubDropdown?el.querySelector(":scope > .dropdown-toggle"):el;let subDropdownTimeout;const closeSubDropdown=()=>{browser.clearTimeout(subDropdownTimeout);subDropdownTimeout=browser.setTimeout(()=>{if(isSubDropdownOpen()){const ev=new MouseEvent("click",{bubbles:false});ev.__fromDropdownNavigation=true;navTarget.dispatchEvent(ev);}},200);};const openSubDropdown=(immediate=false)=>{browser.clearTimeout(subDropdownTimeout);subDropdownTimeout=browser.setTimeout(()=>{if(!isSubDropdownOpen()){const ev=new MouseEvent("click",{bubbles:false});ev.__fromDropdownNavigation=true;navTarget.dispatchEvent(ev);}},immediate?0:200);};const makeOnlyActive=()=>{for(const menuElement of menuElements){if(menuElement.el===el){continue;}
menuElement.navTarget.classList.remove(ACTIVE_MENU_ELEMENT_CLASS);if(menuElement.isSubDropdown){menuElement.closeSubDropdown();}}
navTarget.classList.add(ACTIVE_MENU_ELEMENT_CLASS);};const menuElement={el,get isActive(){return navTarget.classList.contains(ACTIVE_MENU_ELEMENT_CLASS);},makeOnlyActive,navTarget,get isSubDropdownOpen(){return isSubDropdownOpen();},isSubDropdown,closeSubDropdown,openSubDropdown,};menuElements.push(menuElement);const elementListeners={mouseenter:()=>{if(!mouseSelectionActive){mouseSelectionActive=true;}else{makeOnlyActive();if(isSubDropdown){openSubDropdown();}}},};for(const[eventType,listener]of Object.entries(elementListeners)){navTarget.addEventListener(eventType,listener);}
addedListeners.push([navTarget,elementListeners]);}
return()=>{menuElements=[];mouseSelectionActive=true;for(const[navTarget,listeners]of addedListeners){for(const[eventType,listener]of Object.entries(listeners)){navTarget.removeEventListener(eventType,listener);}}};});const getActiveMenuElement=()=>{return menuElements.find((menuElement)=>menuElement.isActive);};const setActiveMenuElement=(menuElement)=>{if(menuElements.length){if(typeof menuElement==="string"){const prevIndex=menuElements.indexOf(getActiveMenuElement());const nextIndex=NEXT_ACTIVE_INDEX_FNS[menuElement](menuElements,prevIndex);menuElement=menuElements[nextIndex];}
menuElement.makeOnlyActive();scrollTo(menuElement.el,{scrollable:menuElement.el.parentElement});}};useEffect((open)=>{if(open&&comp.hasParentDropdown){setActiveMenuElement("FIRST");}},()=>[comp.state.open]);const hotkeyService=useService("hotkey");const closeSubDropdown=comp.hasParentDropdown?comp.close:()=>{};const openSubDropdown=()=>{const menuElement=getActiveMenuElement();if(menuElement&&menuElement.isSubDropdown){menuElement.openSubDropdown(true);}};const selectActiveMenuElement=()=>{const menuElement=getActiveMenuElement();if(menuElement){if(menuElement.isSubDropdown){menuElement.openSubDropdown(true);}else{menuElement.navTarget.click();}}};let hotkeyRemoves=[];const hotkeyCallbacks={home:()=>setActiveMenuElement("FIRST"),end:()=>setActiveMenuElement("LAST"),tab:()=>setActiveMenuElement("NEXT"),"shift+tab":()=>setActiveMenuElement("PREV"),arrowdown:()=>setActiveMenuElement("NEXT"),arrowup:()=>setActiveMenuElement("PREV"),arrowleft:localization.direction==="rtl"?openSubDropdown:closeSubDropdown,arrowright:localization.direction==="rtl"?closeSubDropdown:openSubDropdown,enter:selectActiveMenuElement,escape:comp.close,};useEffect((open)=>{if(!open){return;}
for(const[hotkey,callback]of Object.entries(hotkeyCallbacks)){const callbackWrapper=()=>{const hasOpenedSubDropdown=menuElements.some((m)=>m.isSubDropdownOpen);if(!hasOpenedSubDropdown){mouseSelectionActive=false;callback.call(comp);}};hotkeyRemoves.push(hotkeyService.add(hotkey,callbackWrapper,{allowRepeat:true}));}
return()=>{for(const removeHotkey of hotkeyRemoves){removeHotkey();}
hotkeyRemoves=[];};},()=>[comp.state.open]);}
return __exports;});;

/* /web/static/src/core/effects/effect_container.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/effects/effect_container',async function(require){'use strict';let __exports={};const{Component,tags}=owl;const EffectContainer=__exports.EffectContainer=class EffectContainer extends Component{setup(){this.effect=null;this.props.bus.on("UPDATE",this,(effect)=>{this.effect=effect;this.render();});}
removeEffect(){this.effect=null;this.render();}}
EffectContainer.template=tags.xml`
  <div class="o_effects_manager">
    <t t-if="effect">
        <t t-component="effect.Component" t-props="effect.props" t-key="effect.id" close="() => removeEffect()"/>
    </t>
  </div>`;return __exports;});;

/* /web/static/src/core/effects/effect_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/effects/effect_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{EffectContainer}=require("@web/core/effects/effect_container");const{RainbowMan}=require("@web/core/effects/rainbow_man");const{EventBus}=owl.core;const effectRegistry=registry.category("effects");function rainbowMan(env,params={}){let message=params.message;if(message instanceof jQuery){console.log("Providing a jQuery element to an effect is deprecated. Note that all event handlers will be lost.");message=message.html();}else if(message instanceof Element){console.log("Providing an HTML element to an effect is deprecated. Note that all event handlers will be lost.");message=message.outerHTML;}else if(!message){message=env._t("well Done!");}
if(env.services.user.showEffect){return{Component:params.Component||RainbowMan,props:{imgUrl:params.img_url||"/web/static/img/smile.svg",fadeout:params.fadeout,message,messageIsHtml:params.messageIsHtml||false,...params.props,},};}
env.services.notification.add(message);}
effectRegistry.add("rainbow_man",rainbowMan);const effectService=__exports.effectService={start(env){const bus=new EventBus();registry.category("main_components").add("EffectContainer",{Component:EffectContainer,props:{bus},});let effectId=0;function add(params){const type=params.type||"rainbow_man";const effect=effectRegistry.get(type);const{Component,props}=effect(env,params)||{};if(Component){bus.trigger("UPDATE",{Component,props,id:effectId++});}}
return{add};},};registry.category("services").add("effect",effectService);return __exports;});;

/* /web/static/src/core/effects/rainbow_man.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/effects/rainbow_man',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{useEffect}=require("@web/core/utils/hooks");const{Component,hooks}=owl;const RainbowMan=__exports.RainbowMan=class RainbowMan extends Component{setup(){hooks.useExternalListener(document.body,"click",this.closeRainbowMan);const fadeout="fadeout"in this.props?this.props.fadeout:"medium";const delay=fadeout?RainbowMan.rainbowFadeouts[fadeout]:false;this.delay=typeof delay==="number"?delay:false;if(this.delay!==false){useEffect(()=>{const timeout=browser.setTimeout(()=>{this.el.classList.add("o_reward_fading");},this.delay);return()=>browser.clearTimeout(timeout);},()=>[]);}}
onAnimationEnd(ev){if(this.delay!==false&&ev.animationName==="reward-fading-reverse"){ev.stopPropagation();this.closeRainbowMan();}}
closeRainbowMan(){this.props.close();}}
RainbowMan.template="web.RainbowMan";RainbowMan.rainbowFadeouts={slow:4500,medium:3500,fast:2000,no:false};return __exports;});;

/* /web/static/src/core/errors/error_dialogs.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/errors/error_dialogs',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{Dialog}=require("@web/core/dialog/dialog");const{_lt}=require("@web/core/l10n/translation");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{capitalize}=require("@web/core/utils/strings");const{hooks}=owl;const{useState}=hooks;const odooExceptionTitleMap=__exports.odooExceptionTitleMap=new Map(Object.entries({"odoo.addons.base.models.ir_mail_server.MailDeliveryException":_lt("MailDeliveryException"),"odoo.exceptions.AccessDenied":_lt("Access Denied"),"odoo.exceptions.MissingError":_lt("Missing Record"),"odoo.exceptions.UserError":_lt("User Error"),"odoo.exceptions.ValidationError":_lt("Validation Error"),"odoo.exceptions.AccessError":_lt("Access Error"),"odoo.exceptions.Warning":_lt("Warning"),}));const ErrorDialog=__exports.ErrorDialog=class ErrorDialog extends Dialog{setup(){super.setup();this.state=useState({showTraceback:false,});}
onClickClipboard(){browser.navigator.clipboard.writeText(`${this.props.name}\n${this.props.message}\n${this.props.traceback}`);}}
ErrorDialog.contentClass="o_dialog_error";ErrorDialog.bodyTemplate="web.ErrorDialogBody";ErrorDialog.title=_lt("Odoo Error");const ClientErrorDialog=__exports.ClientErrorDialog=class ClientErrorDialog extends ErrorDialog{}
ClientErrorDialog.title=_lt("Odoo Client Error");const NetworkErrorDialog=__exports.NetworkErrorDialog=class NetworkErrorDialog extends ErrorDialog{}
NetworkErrorDialog.title=_lt("Odoo Network Error");const RPCErrorDialog=__exports.RPCErrorDialog=class RPCErrorDialog extends ErrorDialog{setup(){super.setup();this.inferTitle();this.traceback=this.props.traceback;if(this.props.data&&this.props.data.debug){this.traceback=`${this.props.data.debug}`;}}
inferTitle(){if(this.props.exceptionName&&odooExceptionTitleMap.has(this.props.exceptionName)){this.title=odooExceptionTitleMap.get(this.props.exceptionName).toString();return;}
if(!this.props.type)return;switch(this.props.type){case"server":this.title=this.env._t("Odoo Server Error");break;case"script":this.title=this.env._t("Odoo Client Error");break;case"network":this.title=this.env._t("Odoo Network Error");break;}}
onClickClipboard(){browser.navigator.clipboard.writeText(`${this.props.name}\n${this.props.message}\n${this.traceback}`);}}
const WarningDialog=__exports.WarningDialog=class WarningDialog extends Dialog{setup(){super.setup();this.title=this.env._t("Odoo Warning");this.inferTitle();const{data,message}=this.props;if(data&&data.arguments&&data.arguments.length>0){this.message=data.arguments[0];}else{this.message=message;}}
inferTitle(){if(this.props.exceptionName&&odooExceptionTitleMap.has(this.props.exceptionName)){this.title=odooExceptionTitleMap.get(this.props.exceptionName).toString();}}}
WarningDialog.bodyTemplate="web.WarningDialogBody";const RedirectWarningDialog=__exports.RedirectWarningDialog=class RedirectWarningDialog extends Dialog{setup(){super.setup();this.actionService=useService("action");const{data,subType}=this.props;const[message,actionId,buttonText,additional_context]=data.arguments;this.title=capitalize(subType)||this.env._t("Odoo Warning");this.message=message;this.actionId=actionId;this.buttonText=buttonText;this.additionalContext=additional_context;}
async onClick(){const options={};if(this.additionalContext){options.additionalContext=this.additionalContext;}
await this.actionService.doAction(this.actionId,options);this.close();}
onCancel(){this.close();}}
RedirectWarningDialog.bodyTemplate="web.RedirectWarningDialogBody";RedirectWarningDialog.footerTemplate="web.RedirectWarningDialogFooter";const Error504Dialog=__exports.Error504Dialog=class Error504Dialog extends Dialog{}
Error504Dialog.bodyTemplate="web.Error504DialogBody";Error504Dialog.title=_lt("Request timeout");const SessionExpiredDialog=__exports.SessionExpiredDialog=class SessionExpiredDialog extends Dialog{onClick(){browser.location.reload();}}
SessionExpiredDialog.bodyTemplate="web.SessionExpiredDialogBody";SessionExpiredDialog.footerTemplate="web.SessionExpiredDialogFooter";SessionExpiredDialog.title=_lt("Odoo Session Expired");registry.category("error_dialogs").add("odoo.exceptions.AccessDenied",WarningDialog).add("odoo.exceptions.AccessError",WarningDialog).add("odoo.exceptions.MissingError",WarningDialog).add("odoo.exceptions.UserError",WarningDialog).add("odoo.exceptions.ValidationError",WarningDialog).add("odoo.exceptions.RedirectWarning",RedirectWarningDialog).add("odoo.http.SessionExpiredException",SessionExpiredDialog).add("werkzeug.exceptions.Forbidden",SessionExpiredDialog).add("504",Error504Dialog);return __exports;});;

/* /web/static/src/core/errors/error_handlers.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/errors/error_handlers',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{ConnectionLostError,RPCError}=require("@web/core/network/rpc_service");const{registry}=require("@web/core/registry");const{ClientErrorDialog,ErrorDialog,NetworkErrorDialog,RPCErrorDialog,}=require("@web/core/errors/error_dialogs");const{UncaughtClientError,UncaughtCorsError,UncaughtPromiseError}=require("@web/core/errors/error_service");const errorHandlerRegistry=registry.category("error_handlers");const errorDialogRegistry=registry.category("error_dialogs");const errorNotificationRegistry=registry.category("error_notifications");function corsErrorHandler(env,error){if(error instanceof UncaughtCorsError){env.services.dialog.add(NetworkErrorDialog,{traceback:error.traceback,message:error.message,name:error.name,});return true;}}
errorHandlerRegistry.add("corsErrorHandler",corsErrorHandler,{sequence:95});function clientErrorHandler(env,error){if(error instanceof UncaughtClientError){env.services.dialog.add(ClientErrorDialog,{traceback:error.traceback,message:error.message,name:error.name,});return true;}}
errorHandlerRegistry.add("clientErrorHandler",clientErrorHandler,{sequence:96});__exports.rpcErrorHandler=rpcErrorHandler;function rpcErrorHandler(env,error,originalError){if(!(error instanceof UncaughtPromiseError)){return false;}
if(originalError instanceof RPCError){error.unhandledRejectionEvent.preventDefault();const exceptionName=originalError.exceptionName;let ErrorComponent=originalError.Component;if(!ErrorComponent&&exceptionName){if(errorNotificationRegistry.contains(exceptionName)){const notif=errorNotificationRegistry.get(exceptionName);env.services.notification.add(notif.message||originalError.data.message,notif);return true;}
if(errorDialogRegistry.contains(exceptionName)){ErrorComponent=errorDialogRegistry.get(exceptionName);}}
if(!ErrorComponent&&originalError.data.context){const exceptionClass=originalError.data.context.exception_class;if(errorDialogRegistry.contains(exceptionClass)){ErrorComponent=errorDialogRegistry.get(exceptionClass);}}
env.services.dialog.add(ErrorComponent||RPCErrorDialog,{traceback:error.traceback,message:originalError.message,name:originalError.name,exceptionName:originalError.exceptionName,data:originalError.data,subType:originalError.subType,code:originalError.code,type:originalError.type,});return true;}}
errorHandlerRegistry.add("rpcErrorHandler",rpcErrorHandler,{sequence:97});let connectionLostNotifRemove=null;__exports.lostConnectionHandler=lostConnectionHandler;function lostConnectionHandler(env,error,originalError){if(!(error instanceof UncaughtPromiseError)){return false;}
if(originalError instanceof ConnectionLostError){if(connectionLostNotifRemove){return true;}
connectionLostNotifRemove=env.services.notification.add(env._t("Connection lost. Trying to reconnect..."),{sticky:true});let delay=2000;browser.setTimeout(function checkConnection(){env.services.rpc("/web/webclient/version_info",{}).then(function(){if(connectionLostNotifRemove){connectionLostNotifRemove();connectionLostNotifRemove=null;}
env.services.notification.add(env._t("Connection restored. You are back online."),{type:"info",});}).catch(()=>{delay=delay*1.5+500*Math.random();browser.setTimeout(checkConnection,delay);});},delay);return true;}}
errorHandlerRegistry.add("lostConnectionHandler",lostConnectionHandler,{sequence:98});function emptyRejectionErrorHandler(env,error){if(!(error instanceof UncaughtPromiseError)){return false;}
env.services.dialog.add(ClientErrorDialog,{traceback:error.traceback,message:error.message,name:error.name,});return true;}
errorHandlerRegistry.add("emptyRejectionErrorHandler",emptyRejectionErrorHandler,{sequence:99,});function defaultHandler(env,error){env.services.dialog.add(ErrorDialog,{traceback:error.traceback,message:error.message,name:error.name,});return true;}
errorHandlerRegistry.add("defaultHandler",defaultHandler,{sequence:100});return __exports;});;

/* /web/static/src/core/errors/error_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/errors/error_service',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{_lt}=require("@web/core/l10n/translation");const{registry}=require("@web/core/registry");const{annotateTraceback,formatTraceback,getErrorTechnicalName}=require("@web/core/errors/error_utils");const UncaughtError=__exports.UncaughtError=class UncaughtError extends Error{constructor(message){super(message);this.name=getErrorTechnicalName(this);this.traceback=null;}}
const UncaughtClientError=__exports.UncaughtClientError=class UncaughtClientError extends UncaughtError{constructor(message=_lt("Uncaught Javascript Error")){super(message);}}
const UncaughtPromiseError=__exports.UncaughtPromiseError=class UncaughtPromiseError extends UncaughtError{constructor(message=_lt("Uncaught Promise")){super(message);this.unhandledRejectionEvent=null;}}
const UncaughtCorsError=__exports.UncaughtCorsError=class UncaughtCorsError extends UncaughtError{constructor(message=_lt("Uncaught CORS Error")){super(message);}}
function combineErrorNames(uncaughtError,originalError){const originalErrorName=getErrorTechnicalName(originalError);const uncaughtErrorName=getErrorTechnicalName(uncaughtError);if(originalErrorName===Error.name){return uncaughtErrorName;}else{return`${uncaughtErrorName} > ${originalErrorName}`;}}
async function completeUncaughtError(env,uncaughtError,originalError){uncaughtError.name=combineErrorNames(uncaughtError,originalError);if(env.debug.includes("assets")){uncaughtError.traceback=await annotateTraceback(originalError);}else{uncaughtError.traceback=formatTraceback(originalError);}
if(originalError.message){uncaughtError.message=`${uncaughtError.message} > ${originalError.message}`;}}
const errorService=__exports.errorService={start(env){function handleError(error,originalError,retry=true){const services=env.services;if(!services.dialog||!services.notification||!services.rpc){if(retry){browser.setTimeout(()=>{handleError(error,originalError,false);},1000);}
return;}
for(let handler of registry.category("error_handlers").getAll()){if(handler(env,error,originalError)){break;}}}
browser.addEventListener("error",async(ev)=>{const{colno,error:originalError,filename,lineno,message}=ev;const errorsToIgnore=["ResizeObserver loop completed with undelivered notifications.","ResizeObserver loop limit exceeded"]
if(!originalError&&errorsToIgnore.includes(message)){return;}
let uncaughtError;if(!filename&&!lineno&&!colno){uncaughtError=new UncaughtCorsError();uncaughtError.traceback=env._t(`Unknown CORS error\n\n`+`An unknown CORS error occured.\n`+`The error probably originates from a JavaScript file served from a different origin.\n`+`(Opening your browser console might give you a hint on the error.)`);}else{uncaughtError=new UncaughtClientError();await completeUncaughtError(env,uncaughtError,originalError);}
handleError(uncaughtError,originalError);});browser.addEventListener("unhandledrejection",async(ev)=>{const originalError=ev.reason;const uncaughtError=new UncaughtPromiseError();uncaughtError.unhandledRejectionEvent=ev;if(originalError instanceof Error){await completeUncaughtError(env,uncaughtError,originalError);}
handleError(uncaughtError,originalError);});},};registry.category("services").add("error",errorService,{sequence:1});return __exports;});;

/* /web/static/src/core/errors/error_utils.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/errors/error_utils',async function(require){'use strict';let __exports={};const{loadAssets}=require("@web/core/assets");const{isBrowserChrome}=require("@web/core/browser/feature_detection");__exports.getErrorTechnicalName=getErrorTechnicalName;function getErrorTechnicalName(error){return error.name!==Error.name?error.name:error.constructor.name;}
__exports.formatTraceback=formatTraceback;function formatTraceback(error){let traceback=error.stack;const errorName=getErrorTechnicalName(error);if(!isBrowserChrome()){traceback=`${errorName}: ${error.message}\n${error.stack}`.replace(/\n/g,"\n    ");}else if(error.stack){traceback=error.stack.replace(/^[^:]*/g,errorName);}
return traceback;}
__exports.annotateTraceback=annotateTraceback;async function annotateTraceback(error){const traceback=formatTraceback(error);try{await loadAssets({jsLibs:["/web/static/lib/stacktracejs/stacktrace.js"],});}catch(e){return traceback;}
if(error.stack){const regex=/ line (\d*) > (Function):(\d*)/gm;const subst=`:$1`;error.stack=error.stack.replace(regex,subst);}
let frames;try{frames=await StackTrace.fromError(error);}catch(e){console.warn("The following error could not be annotated:",error,e);return traceback;}
const lines=traceback.split("\n");if(lines[lines.length-1].trim()===""){lines.splice(-1);}
const skips=lines.filter((l)=>l.includes("(index 0")).length;const offset=lines.length-frames.length-skips;let lineIndex=offset;let frameIndex=0;while(frameIndex<frames.length){const line=lines[lineIndex];if(line.includes("(index 0)")){lineIndex++;continue;}
const frame=frames[frameIndex];const info=` (${frame.fileName}:${frame.lineNumber})`;lines[lineIndex]=line+info;lineIndex++;frameIndex++;}
return lines.join("\n");}
return __exports;});;

/* /web/static/src/core/file_input/file_input.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/file_input/file_input',async function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{Component,hooks,QWeb}=owl;const{useRef}=hooks;const FileInput=__exports.FileInput=class FileInput extends Component{setup(){this.http=useService("http");this.fileInputRef=useRef("file-input");}
async onFileInputChange(){const{action,model,id}=this.props;const params={csrf_token:odoo.csrf_token,ufile:[...this.fileInputRef.el.files],};if(model){params.model=model;}
if(id){params.id=id;}
const fileData=await this.http.post(action,params,"text");const parsedFileData=JSON.parse(fileData);if(parsedFileData.error){throw new Error(parsedFileData.error);}
this.trigger("uploaded",{files:parsedFileData});}
onTriggerClicked(){this.fileInputRef.el.click();}}
FileInput.defaultProps={accepted_file_extensions:"*",action:"/web/binary/upload",multi_upload:false,};FileInput.props={accepted_file_extensions:{type:String,optional:1},action:{type:String,optional:1},id:{type:Number,optional:1},model:{type:String,optional:1},multi_upload:{type:Boolean,optional:1},};FileInput.template="web.FileInput";QWeb.registerComponent("FileInput",FileInput);return __exports;});;

/* /web/static/src/core/hotkeys/hotkey_hook.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/hotkeys/hotkey_hook',async function(require){'use strict';let __exports={};const{useEffect,useService}=require("@web/core/utils/hooks");__exports.useHotkey=useHotkey;function useHotkey(hotkey,callback,options={}){const hotkeyService=useService("hotkey");useEffect(()=>hotkeyService.add(hotkey,callback,options),()=>[]);}
return __exports;});;

/* /web/static/src/core/hotkeys/hotkey_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/hotkeys/hotkey_service',async function(require){'use strict';let __exports={};const{isMacOS}=require("@web/core/browser/feature_detection");const{registry}=require("@web/core/registry");const{browser}=require("@web/core/browser/browser");const{getVisibleElements}=require("@web/core/utils/ui");const ALPHANUM_KEYS="abcdefghijklmnopqrstuvwxyz0123456789".split("");const NAV_KEYS=["arrowleft","arrowright","arrowup","arrowdown","pageup","pagedown","home","end","backspace","enter","tab","delete",];const MODIFIERS=new Set(["alt","control","shift"]);const AUTHORIZED_KEYS=new Set([...ALPHANUM_KEYS,...NAV_KEYS,"escape"]);const hotkeyService=__exports.hotkeyService={dependencies:["ui"],overlayModifier:"alt",start(env,{ui}){const registrations=new Map();let nextToken=0;let overlaysVisible=false;browser.addEventListener("keydown",onKeydown);browser.addEventListener("keyup",removeHotkeyOverlays);browser.addEventListener("blur",removeHotkeyOverlays);browser.addEventListener("click",removeHotkeyOverlays);function onKeydown(event){if(!event.key){return;}
const hotkey=getActiveHotkey(event);if(ui.isBlocked){return;}
const elementsWithoutDataHotkey=getVisibleElements(ui.activeElement,"[accesskey]:not([data-hotkey])");for(const el of elementsWithoutDataHotkey){el.dataset.hotkey=el.accessKey;el.removeAttribute("accesskey");}
if(hotkey===hotkeyService.overlayModifier){addHotkeyOverlays();event.preventDefault();return;}
const singleKey=hotkey.split("+").pop();if(!AUTHORIZED_KEYS.has(singleKey)){return;}
const targetIsEditable=(event.target instanceof Element&&/input|textarea/i.test(event.target.tagName))||(event.target instanceof HTMLElement&&event.target.isContentEditable);const shouldProtectEditable=targetIsEditable&&[...ALPHANUM_KEYS,...NAV_KEYS].includes(singleKey);const infos={hotkey,shouldProtectEditable,_originalEvent:event,};dispatch(infos);removeHotkeyOverlays(event);}
function dispatch(infos){let dispatched=false;const{hotkey,shouldProtectEditable,_originalEvent:event}=infos;const activeElement=ui.activeElement;for(const reg of Array.from(registrations.values()).reverse()){if(!reg.global&&reg.activeElement!==activeElement){continue;}
if(reg.hotkey!==hotkey){continue;}
if(!reg.allowRepeat&&event.repeat){continue;}
if(!reg.bypassEditableProtection&&shouldProtectEditable){continue;}
reg.callback();dispatched=true;break;}
const overlayModParts=hotkeyService.overlayModifier.split("+");if(!dispatched&&!event.repeat&&overlayModParts.every((el)=>hotkey.includes(el))){const cleanHotkey=hotkey.split("+").filter((key)=>!overlayModParts.includes(key)).join("+");const elems=getVisibleElements(ui.activeElement,`[data-hotkey='${cleanHotkey}' i]`);for(const el of elems){el.focus();el.click();dispatched=true;break;}}
if(dispatched){event.preventDefault();event.stopImmediatePropagation();}}
function addHotkeyOverlays(){if(overlaysVisible){return;}
for(const el of getVisibleElements(ui.activeElement,"[data-hotkey]:not(:disabled)")){const hotkey=el.dataset.hotkey;const overlay=document.createElement("div");overlay.className="o_web_hotkey_overlay";overlay.appendChild(document.createTextNode(hotkey.toUpperCase()));let overlayParent;if(el.tagName.toUpperCase()==="INPUT"){overlayParent=el.parentElement;}else{overlayParent=el;}
if(overlayParent.style.position!=="absolute"){overlayParent.style.position="relative";}
overlayParent.appendChild(overlay);}
overlaysVisible=true;}
function removeHotkeyOverlays(event){if(!overlaysVisible){return;}
for(const overlay of document.querySelectorAll(".o_web_hotkey_overlay")){overlay.remove();}
overlaysVisible=false;event.preventDefault();}
function getActiveHotkey(ev){const hotkey=[];if(isMacOS()?ev.ctrlKey:ev.altKey){hotkey.push("alt");}
if(isMacOS()?ev.metaKey:ev.ctrlKey){hotkey.push("control");}
if(ev.shiftKey){hotkey.push("shift");}
let key=ev.key.toLowerCase();if(ev.code&&ev.code.indexOf("Digit")===0){key=ev.code.slice(-1);}
if(!AUTHORIZED_KEYS.has(key)&&ev.code&&ev.code.indexOf("Key")===0){key=ev.code.slice(-1).toLowerCase();}
if(!MODIFIERS.has(key)){hotkey.push(key);}
return hotkey.join("+");}
function registerHotkey(hotkey,callback,options={}){if(!hotkey||hotkey.length===0){throw new Error("You must specify an hotkey when registering a registration.");}
if(!callback||typeof callback!=="function"){throw new Error("You must specify a callback function when registering a registration.");}
const keys=hotkey.toLowerCase().split("+").filter((k)=>!MODIFIERS.has(k));if(keys.some((k)=>!AUTHORIZED_KEYS.has(k))){throw new Error(`You are trying to subscribe for an hotkey ('${hotkey}')
            that contains parts not whitelisted: ${keys.join(", ")}`);}else if(keys.length>1){throw new Error(`You are trying to subscribe for an hotkey ('${hotkey}')
            that contains more than one single key part: ${keys.join("+")}`);}
const token=nextToken++;const registration={hotkey:hotkey.toLowerCase(),callback,activeElement:null,allowRepeat:options&&options.allowRepeat,bypassEditableProtection:options&&options.bypassEditableProtection,global:options&&options.global,};registrations.set(token,registration);Promise.resolve().then(()=>{registration.activeElement=ui.activeElement;});return token;}
function unregisterHotkey(token){registrations.delete(token);}
return{add(hotkey,callback,options={}){const token=registerHotkey(hotkey,callback,options);return()=>{unregisterHotkey(token);};},};},};registry.category("services").add("hotkey",hotkeyService);return __exports;});;

/* /web/static/src/core/l10n/dates.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/l10n/dates',async function(require){'use strict';let __exports={};const{localization}=require("@web/core/l10n/localization");const{_t}=require("@web/core/l10n/translation");const{memoize}=require("@web/core/utils/functions");const{sprintf}=require("@web/core/utils/strings");const{DateTime,Settings}=luxon;const SERVER_DATE_FORMAT="yyyy-MM-dd";const SERVER_TIME_FORMAT="HH:mm:ss";const alphaRegex=/[a-zA-Z]/g;const nonAlphaRegex=/[^a-zA-Z]/g;const nonDigitsRegex=/[^0-9]/g;const normalizeFormatTable={a:"ccc",A:"cccc",b:"MMM",B:"MMMM",d:"dd",H:"HH",I:"hh",j:"o",m:"MM",M:"mm",p:"a",S:"ss",W:"WW",w:"c",y:"yy",Y:"yyyy",c:"ccc MMM d HH:mm:ss yyyy",x:"MM/dd/yy",X:"HH:mm:ss",};const smartDateUnits={d:"days",m:"months",w:"weeks",y:"years",};const smartDateRegex=new RegExp(`^([+-])(\\d+)([${Object.keys(smartDateUnits).join("")}]?)$`);function parseSmartDateInput(value){const match=smartDateRegex.exec(value);if(match){let date=DateTime.utc();const offset=parseInt(match[2],10);const unit=smartDateUnits[match[3]||"d"];if(match[1]==="+"){date=date.plus({[unit]:offset});}else{date=date.minus({[unit]:offset});}
return date;}
return false;}
function constrain(dt){let valid=dt!==false;valid=valid&&dt.isValid;valid=valid&&dt.year>=1000;valid=valid&&dt.year<10000;return valid?dt:false;}
const stripAlphaDupes=memoize(function stripAlphaDupes(str){return str.replace(alphaRegex,(letter,index,str)=>{return letter===str[index-1]?"":letter;});});const strftimeToLuxonFormat=__exports.strftimeToLuxonFormat=memoize(function strftimeToLuxonFormat(value){const output=[];let inToken=false;for(let index=0;index<value.length;++index){let character=value[index];if(character==="%"&&!inToken){inToken=true;continue;}
if(character.match(alphaRegex)){if(inToken&&normalizeFormatTable[character]!==undefined){character=normalizeFormatTable[character];}else{character="["+character+"]";}}
output.push(character);inToken=false;}
return output.join("");});__exports.formatDate=formatDate;function formatDate(value,options={}){return formatDateTime(value,{timezone:false,...options,format:options.format||localization.dateFormat,});}
__exports.formatDateTime=formatDateTime;function formatDateTime(value,options={}){if(value===false){return"";}
const format=options.format||localization.dateTimeFormat;const numberingSystem=options.numberingSystem||Settings.defaultNumberingSystem;const zone=options.timezone?"local":"utc";value=value.setZone(zone,{keepLocaltime:options.timezone});return value.toFormat(format,{numberingSystem});}
__exports.parseDate=parseDate;function parseDate(value,options={}){return parseDateTime(value,{timezone:false,...options}).startOf("day");}
__exports.parseDateTime=parseDateTime;function parseDateTime(value,options={}){if(!value){return false;}
const valueDigitsOnly=value.replace(nonDigitsRegex,"");const parseOpts={setZone:true,zone:options.timezone?"local":"utc",locale:options.locale,numberingSystem:options.numberingSystem||Settings.defaultNumberingSystem,};let result=constrain(parseSmartDateInput(value));if(!result){const fmt=options.format||localization.dateTimeFormat;const fmtWoZero=stripAlphaDupes(fmt);const woSeps={val:valueDigitsOnly,fmt:fmt.replace(nonAlphaRegex,"").slice(0,valueDigitsOnly.length),};result=constrain(DateTime.fromFormat(value,fmt,parseOpts))||constrain(DateTime.fromFormat(value,fmtWoZero,parseOpts))||constrain(DateTime.fromFormat(woSeps.val,woSeps.fmt,parseOpts));}
if(!result){if(valueDigitsOnly.length>4){result=constrain(DateTime.fromISO(value,parseOpts))||constrain(DateTime.fromSQL(value,parseOpts));}}
if(!result){throw new Error(sprintf(_t("'%s' is not a correct date or datetime"),value));}
return options.timezone?result:result.toUTC();}
const deserializeDate=__exports.deserializeDate=(value)=>{return parseDate(value,{format:SERVER_DATE_FORMAT,numberingSystem:"latn",});};const deserializeDateTime=__exports.deserializeDateTime=(value)=>{return parseDateTime(value,{format:`${SERVER_DATE_FORMAT} ${SERVER_TIME_FORMAT}`,numberingSystem:"latn",});};const serializeDate=__exports.serializeDate=(value)=>{return formatDate(value,{format:SERVER_DATE_FORMAT,numberingSystem:"latn",});};const serializeDateTime=__exports.serializeDateTime=(value)=>{return formatDateTime(value,{format:`${SERVER_DATE_FORMAT} ${SERVER_TIME_FORMAT}`,numberingSystem:"latn",});};return __exports;});;

/* /web/static/src/core/l10n/localization.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/l10n/localization',async function(require){'use strict';let __exports={};const notReadyError=new Error("Localization parameters not ready yet. Maybe add 'localization' to your dependencies?");const localization=__exports.localization={dateFormat:notReadyError,dateTimeFormat:notReadyError,timeFormat:notReadyError,decimalPoint:notReadyError,direction:notReadyError,grouping:notReadyError,multiLang:notReadyError,thousandsSep:notReadyError,weekStart:notReadyError,};return __exports;});;

/* /web/static/src/core/l10n/localization_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/l10n/localization_service',async function(require){'use strict';let __exports={};const{session}=require("@web/session");const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{strftimeToLuxonFormat}=require("@web/core/l10n/dates");const{localization}=require("@web/core/l10n/localization");const{translatedTerms,_t}=require("@web/core/l10n/translation");const{Settings}=luxon;const NUMBERING_SYSTEMS=[[/^ar-(sa|001)$/i,"arab"],[/^bn/i,"beng"],[/^bo/i,"tibt"],[/^pa-in/i,"guru"],[/^ta/i,"tamldec"],[/.*/i,"latn"],];const localizationService=__exports.localizationService={dependencies:["user"],start:async(env,{user})=>{owl.config.translatableAttributes.push("data-tooltip");const cacheHashes=session.cache_hashes||{};const translationsHash=cacheHashes.translations||new Date().getTime().toString();const lang=user.lang||null;const translationURL=session.translationURL||"/web/webclient/translations";let url=`${translationURL}/${translationsHash}`;if(lang){url+=`?lang=${lang}`;}
const response=await browser.fetch(url);if(!response.ok){throw new Error("Error while fetching translations");}
const{lang_parameters:userLocalization,modules:modules}=await response.json();let terms={};for(const addon of Object.keys(modules)){for(const message of modules[addon].messages){terms[message.id]=message.string;}}
Object.setPrototypeOf(translatedTerms,terms);env._t=_t;env.qweb.translateFn=_t;if(lang){const locale=lang==="sr@latin"?"sr-Latn-RS":lang.replace(/_/g,"-");Settings.defaultLocale=locale;for(const[re,numberingSystem]of NUMBERING_SYSTEMS){if(re.test(locale)){Settings.defaultNumberingSystem=numberingSystem;break;}}}
const dateFormat=strftimeToLuxonFormat(userLocalization.date_format);const timeFormat=strftimeToLuxonFormat(userLocalization.time_format);const dateTimeFormat=`${dateFormat} ${timeFormat}`;const grouping=JSON.parse(userLocalization.grouping);Object.assign(localization,{dateFormat,timeFormat,dateTimeFormat,decimalPoint:userLocalization.decimal_point,direction:userLocalization.direction,grouping,multiLang:userLocalization.multi_lang,thousandsSep:userLocalization.thousands_sep,weekStart:userLocalization.week_start,});},};registry.category("services").add("localization",localizationService);return __exports;});;

/* /web/static/src/core/l10n/translation.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/l10n/translation',async function(require){'use strict';let __exports={};const translatedTerms=__exports.translatedTerms={};__exports._t=_t;function _t(term){return translatedTerms[term]||term;}
class LazyTranslatedString extends String{valueOf(){const str=super.valueOf();return _t(str);}
toString(){return this.valueOf();}}
__exports._lt=_lt;function _lt(term){return new LazyTranslatedString(term);}
_lt("less than a minute ago");_lt("about a minute ago");_lt("%d minutes ago");_lt("about an hour ago");_lt("%d hours ago");_lt("a day ago");_lt("%d days ago");_lt("about a month ago");_lt("%d months ago");_lt("about a year ago");_lt("%d years ago");return __exports;});;

/* /web/static/src/core/main_components_container.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/main_components_container',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{NotUpdatable,ErrorHandler}=require("@web/core/utils/components");const{Component,tags}=owl;const MainComponentsContainer=__exports.MainComponentsContainer=class MainComponentsContainer extends Component{setup(){this.Components=registry.category("main_components").getEntries();}
handleComponentError(error,C){this.Components.splice(this.Components.indexOf(C),1);this.render();Promise.resolve().then(()=>{throw error;});}}
MainComponentsContainer.template=tags.xml`
<div>
    <t t-foreach="Components" t-as="C" t-key="C[0]">
        <NotUpdatable>
            <ErrorHandler onError="error => handleComponentError(error, C)">
                <t t-component="C[1].Component" t-props="C[1].props"/>
            </ErrorHandler>
        </NotUpdatable>
    </t>
</div>
`;MainComponentsContainer.components={NotUpdatable,ErrorHandler};return __exports;});;

/* /web/static/src/core/network/download.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/network/download',async function(require){'use strict';let __exports={};const{_lt}=require("@web/core/l10n/translation");const{makeErrorFromResponse}=require("@web/core/network/rpc_service");const{ConnectionLostError}=require("@web/core/network/rpc_service");const{browser}=require("@web/core/browser/browser");const HEX_ESCAPE_REPLACE_REGEXP=/%([0-9A-Fa-f]{2})/g;const NON_LATIN1_REGEXP=/[^\x20-\x7e\xa0-\xff]/g;const QESC_REGEXP=/\\([\u0000-\u007f])/g;const PARAM_REGEXP=/;[\x09\x20]*([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*=[\x09\x20]*("(?:[\x20!\x23-\x5b\x5d-\x7e\x80-\xff]|\\[\x20-\x7e])*"|[!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*/g;const EXT_VALUE_REGEXP=/^([A-Za-z0-9!#$%&+\-^_`{}~]+)'(?:[A-Za-z]{2,3}(?:-[A-Za-z]{3}){0,3}|[A-Za-z]{4,8}|)'((?:%[0-9A-Fa-f]{2}|[A-Za-z0-9!#$&+.^_`|~-])+)$/;const DISPOSITION_TYPE_REGEXP=/^([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*(?:$|;)/;function decodefield(str){const match=EXT_VALUE_REGEXP.exec(str);if(!match){throw new TypeError("invalid extended field value");}
const charset=match[1].toLowerCase();const encoded=match[2];switch(charset){case"iso-8859-1":return encoded.replace(HEX_ESCAPE_REPLACE_REGEXP,pdecode).replace(NON_LATIN1_REGEXP,"?");case"utf-8":return decodeURIComponent(encoded);default:throw new TypeError("unsupported charset in extended field");}}
function parse(string){if(!string||typeof string!=="string"){throw new TypeError("argument string is required");}
let match=DISPOSITION_TYPE_REGEXP.exec(string);if(!match){throw new TypeError("invalid type format");}
let index=match[0].length;const type=match[1].toLowerCase();let key;const names=[];const params={};let value;index=PARAM_REGEXP.lastIndex=match[0].substr(-1)===";"?index-1:index;while((match=PARAM_REGEXP.exec(string))){if(match.index!==index){throw new TypeError("invalid parameter format");}
index+=match[0].length;key=match[1].toLowerCase();value=match[2];if(names.indexOf(key)!==-1){throw new TypeError("invalid duplicate parameter");}
names.push(key);if(key.indexOf("*")+1===key.length){key=key.slice(0,-1);value=decodefield(value);params[key]=value;continue;}
if(typeof params[key]==="string"){continue;}
if(value[0]==='"'){value=value.substr(1,value.length-2).replace(QESC_REGEXP,"$1");}
params[key]=value;}
if(index!==-1&&index!==string.length){throw new TypeError("invalid parameter format");}
return new ContentDisposition(type,params);}
function pdecode(str,hex){return String.fromCharCode(parseInt(hex,16));}
function ContentDisposition(type,parameters){this.type=type;this.parameters=parameters;}
function _download(data,filename,mimetype){let self=window,defaultMime="application/octet-stream",mimeType=mimetype||defaultMime,payload=data,url=!filename&&!mimetype&&payload,anchor=document.createElement("a"),toString=function(a){return String(a);},myBlob=self.Blob||self.MozBlob||self.WebKitBlob||toString,fileName=filename||"download",blob,reader;myBlob=myBlob.call?myBlob.bind(self):Blob;if(String(this)==="true"){payload=[payload,mimeType];mimeType=payload[0];payload=payload[1];}
if(url&&url.length<2048){fileName=url.split("/").pop().split("?")[0];anchor.href=url;if(anchor.href.indexOf(url)!==-1){let ajax=new XMLHttpRequest();ajax.open("GET",url,true);ajax.responseType="blob";ajax.onload=function(e){_download(e.target.response,fileName,defaultMime);};setTimeout(()=>{ajax.send();},0);return ajax;}}
if(/^data:[\w+\-]+\/[\w+\-]+[,;]/.test(payload)){if(payload.length>1024*1024*1.999&&myBlob!==toString){payload=dataUrlToBlob(payload);mimeType=payload.type||defaultMime;}else{return navigator.msSaveBlob?navigator.msSaveBlob(dataUrlToBlob(payload),fileName):saver(payload);}}
blob=payload instanceof myBlob?payload:new myBlob([payload],{type:mimeType});function dataUrlToBlob(strUrl){let parts=strUrl.split(/[:;,]/),type=parts[1],decoder=parts[2]==="base64"?atob:decodeURIComponent,binData=decoder(parts.pop()),mx=binData.length,i=0,uiArr=new Uint8Array(mx);for(i;i<mx;++i){uiArr[i]=binData.charCodeAt(i);}
return new myBlob([uiArr],{type});}
function saver(url,winMode){if("download"in anchor){anchor.href=url;anchor.setAttribute("download",fileName);anchor.className="download-js-link";anchor.innerText=_lt("downloading...");anchor.style.display="none";document.body.appendChild(anchor);setTimeout(()=>{anchor.click();document.body.removeChild(anchor);if(winMode===true){setTimeout(()=>{self.URL.revokeObjectURL(anchor.href);},250);}},66);return true;}
if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent)){url=url.replace(/^data:([\w\/\-+]+)/,defaultMime);if(!window.open(url)){if(confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")){location.href=url;}}
return true;}
let f=document.createElement("iframe");document.body.appendChild(f);if(!winMode){url=`data:${url.replace(/^data:([\w\/\-+]+)/, defaultMime)}`;}
f.src=url;setTimeout(()=>{document.body.removeChild(f);},333);}
if(navigator.msSaveBlob){return navigator.msSaveBlob(blob,fileName);}
if(self.URL){saver(self.URL.createObjectURL(blob),true);}else{if(typeof blob==="string"||blob.constructor===toString){try{return saver(`data:${mimeType};base64,${self.btoa(blob)}`);}catch(y){return saver(`data:${mimeType},${encodeURIComponent(blob)}`);}}
reader=new FileReader();reader.onload=function(){saver(this.result);};reader.readAsDataURL(blob);}
return true;}
__exports.download=download;function download(options){return download._download(options);}
download._download=(options)=>{return new Promise((resolve,reject)=>{const xhr=new browser.XMLHttpRequest();let data;if(Object.prototype.hasOwnProperty.call(options,"form")){xhr.open(options.form.method,options.form.action);data=new FormData(options.form);}else{xhr.open("POST",options.url);data=new FormData();Object.entries(options.data).forEach((entry)=>{const[key,value]=entry;data.append(key,value);});}
data.append("token","dummy-because-api-expects-one");if(odoo.csrf_token){data.append("csrf_token",odoo.csrf_token);}
xhr.responseType="blob";xhr.onload=()=>{const mimetype=xhr.response.type;if(xhr.status===200&&mimetype!=="text/html"){const header=(xhr.getResponseHeader("Content-Disposition")||"").replace(/;$/,"");const filename=header?parse(header).parameters.filename:null;_download(xhr.response,filename,mimetype);return resolve(filename);}else if(xhr.status===502){reject(new ConnectionLostError());}else{const decoder=new FileReader();decoder.onload=()=>{const contents=decoder.result;const doc=new DOMParser().parseFromString(contents,"text/html");const nodes=doc.body.children.length===0?doc.body.childNodes:doc.body.children;let error;try{const node=nodes[1]||nodes[0];error=JSON.parse(node.textContent);}catch(e){error={message:"Arbitrary Uncaught Python Exception",data:{debug:`${xhr.status}`+`\n`+`${nodes.length > 0 ? nodes[0].textContent : ""}
                                    ${nodes.length > 1 ? nodes[1].textContent : ""}`},};}
error=makeErrorFromResponse(error);reject(error);};decoder.readAsText(xhr.response);}};xhr.onerror=()=>{reject(new ConnectionLostError());};xhr.send(data);});};return __exports;});;

/* /web/static/src/core/network/http_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/network/http_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");function checkResponseStatus(response){if(response.status===502){throw new Error("Failed to fetch");}}
const httpService=__exports.httpService={start(){return{async get(route,readMethod="json"){const response=await fetch(route,{method:"GET"});checkResponseStatus(response);return response[readMethod]();},async post(route,params={},readMethod="json"){const formData=new FormData();for(const key in params){const value=params[key];if(Array.isArray(value)&&value.length){for(const val of value){formData.append(key,val);}}else{formData.append(key,value);}}
const info={body:formData,method:"POST",};const response=await fetch(route,info);checkResponseStatus(response);return response[readMethod]();},};},};registry.category("services").add("http",httpService);return __exports;});;

/* /web/static/src/core/network/rpc_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/network/rpc_service',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const RPCError=__exports.RPCError=class RPCError extends Error{constructor(){super(...arguments);this.name="RPC_ERROR";this.type="server";this.code=null;this.data=null;this.exceptionName=null;this.subType=null;}}
const ConnectionLostError=__exports.ConnectionLostError=class ConnectionLostError extends Error{}
const ConnectionAbortedError=__exports.ConnectionAbortedError=class ConnectionAbortedError extends Error{}
__exports.makeErrorFromResponse=makeErrorFromResponse;function makeErrorFromResponse(reponse){const{code,data:errorData,message,type:subType}=reponse;const error=new RPCError();error.exceptionName=errorData.name;error.subType=subType;error.data=errorData;error.message=message;error.code=code;return error;}
__exports.jsonrpc=jsonrpc;function jsonrpc(env,rpcId,url,params,settings={}){const bus=env.bus;const XHR=browser.XMLHttpRequest;const data={id:rpcId,jsonrpc:"2.0",method:"call",params:params,};const request=settings.xhr||new XHR();let rejectFn;const promise=new Promise((resolve,reject)=>{rejectFn=reject;if(!settings.silent){bus.trigger("RPC:REQUEST",data.id);}
request.addEventListener("load",()=>{if(request.status===502){if(!settings.silent){bus.trigger("RPC:RESPONSE",data.id);}
reject(new ConnectionLostError());return;}
const{error:responseError,result:responseResult}=JSON.parse(request.response);if(!settings.silent){bus.trigger("RPC:RESPONSE",data.id);}
if(!responseError){return resolve(responseResult);}
const error=makeErrorFromResponse(responseError);reject(error);});request.addEventListener("error",()=>{if(!settings.silent){bus.trigger("RPC:RESPONSE",data.id);}
reject(new ConnectionLostError());});request.open("POST",url);request.setRequestHeader("Content-Type","application/json");request.send(JSON.stringify(data));});promise.abort=function(){if(request.abort){request.abort();}
rejectFn(new ConnectionAbortedError("XmlHttpRequestError abort"));};return promise;}
const rpcService=__exports.rpcService={async:true,start(env){let rpcId=0;return function rpc(route,params={},settings){return jsonrpc(env,rpcId++,route,params,settings);};},};registry.category("services").add("rpc",rpcService);return __exports;});;

/* /web/static/src/core/notifications/notification.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/notifications/notification',async function(require){'use strict';let __exports={};const{Component,hooks}=owl;const Notification=__exports.Notification=class Notification extends Component{setup(){if(this.props.onClose){hooks.onWillUnmount(()=>this.props.onClose());}}
shouldUpdate(){return false;}
get className(){let className;switch(this.props.type){case"danger":className="bg-danger";break;case"warning":className="bg-warning";break;case"success":className="bg-success";break;case"info":className="bg-info";break;}
return className?`${className} ${this.props.className}`:this.props.className;}}
Notification.template="web.NotificationWowl";Notification.props={message:{validate:(m)=>{return(typeof m==="string"||(typeof m==="object"&&typeof m.toString==="function"));}},title:{type:[String,Boolean,{toString:Function}],optional:true},type:{type:String,optional:true,validate:(t)=>["warning","danger","success","info"].includes(t)},messageIsHtml:{type:Boolean,optional:true},className:{type:String,optional:true},buttons:{type:Array,element:{type:Object,shape:{name:{type:String},icon:{type:String,optional:true},primary:{type:Boolean,optional:true},onClick:Function}}},onClose:{type:Function,optional:true}};Notification.defaultProps={buttons:[],className:"",messageIsHtml:false,type:"warning"};return __exports;});;

/* /web/static/src/core/notifications/notification_container.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/notifications/notification_container',async function(require){'use strict';let __exports={};const{Notification}=require("@web/core/notifications/notification");const{Component,tags}=owl;const NotificationContainer=__exports.NotificationContainer=class NotificationContainer extends Component{setup(){this.props.bus.on("UPDATE",this,this.render);}}
NotificationContainer.template=tags.xml`
    <div class="o_notification_manager">
        <t t-foreach="props.notifications" t-as="notification" t-key="notification.id">
            <Notification
                t-props="notification.props"
                t-transition="o_notification_fade"
                t-on-close="notification.close()"
            />
        </t>
    </div>`;NotificationContainer.components={Notification};return __exports;});;

/* /web/static/src/core/notifications/notification_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/notifications/notification_service',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{NotificationContainer}=require("@web/core/notifications/notification_container");const{EventBus}=owl.core;const AUTOCLOSE_DELAY=4000;const notificationService=__exports.notificationService={start(){let notifId=0;let notifications=[];const bus=new EventBus();registry.category("main_components").add("NotificationContainer",{Component:NotificationContainer,props:{bus,notifications},});function add(message,options={}){const id=++notifId;const props=Object.assign({},options,{message});const sticky=props.sticky;delete props.sticky;const closeFn=()=>close(id);const notification={id,props,close:closeFn,};notifications.push(notification);bus.trigger("UPDATE");if(!sticky){browser.setTimeout(closeFn,AUTOCLOSE_DELAY);}
return closeFn;}
function close(id){const index=notifications.findIndex((n)=>n.id===id);if(index>-1){notifications.splice(index,1);bus.trigger("UPDATE");}}
return{add};},};registry.category("services").add("notification",notificationService);return __exports;});;

/* /web/static/src/core/orm_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/orm_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");function assignOptions(kwargs,options,whileList){for(let elem of whileList){if(elem in options){kwargs[elem]=options[elem];}}}
const Commands=__exports.Commands={create(virtualID,values){delete values.id;return[0,virtualID||false,values];},update(id,values){delete values.id;return[1,id,values];},delete(id){return[2,id,false];},forget(id){return[3,id,false];},linkTo(id){return[4,id,false];},deleteAll(){return[5,false,false];},replaceWith(ids){return[6,false,ids];},};function validateModel(value){if(typeof value!=="string"||value.length===0){throw new Error(`Invalid model name: ${value}`);}}
function validatePrimitiveList(name,type,value){if(!Array.isArray(value)||value.some((val)=>typeof val!==type)){throw new Error(`Invalid ${name} list: ${value}`);}}
function validateObject(name,obj){if(typeof obj!=="object"||obj===null||Array.isArray(obj)){throw new Error(`${name} should be an object`);}}
function validateArray(name,array){if(!Array.isArray(array)){throw new Error(`${name} should be an array`);}}
const ORM=__exports.ORM=class ORM{constructor(rpc,user){this.rpc=rpc;this.user=user;this._silent=false;}
get silent(){return Object.assign(Object.create(this),{_silent:true});}
call(model,method,args=[],kwargs={}){validateModel(model);let url=`/web/dataset/call_kw/${model}/${method}`;const fullContext=Object.assign({},this.user.context,kwargs.context||{});const fullKwargs=Object.assign({},kwargs,{context:fullContext});let params={model,method,args,kwargs:fullKwargs,};return this.rpc(url,params,{silent:this._silent});}
create(model,state,ctx){validateObject("state",state);return this.call(model,"create",[state],{context:ctx});}
read(model,ids,fields,ctx){validatePrimitiveList("ids","number",ids);if(fields){validatePrimitiveList("fields","string",fields);}
if(!ids.length){return Promise.resolve([]);}
return this.call(model,"read",[ids,fields],{context:ctx});}
readGroup(model,domain,fields,groupby,options={},ctx={}){validateArray("domain",domain);validatePrimitiveList("fields","string",fields);validatePrimitiveList("groupby","string",groupby);const kwargs={domain,groupby,fields,context:ctx,};assignOptions(kwargs,options,["lazy","offset","orderby","limit"]);return this.call(model,"read_group",[],kwargs);}
search(model,domain,options={},ctx={}){validateArray("domain",domain);const kwargs={context:ctx,};assignOptions(kwargs,options,["offset","limit","order"]);return this.call(model,"search",[domain],kwargs);}
searchRead(model,domain,fields,options={},ctx={}){validateArray("domain",domain);if(fields){validatePrimitiveList("fields","string",fields);}
const kwargs={context:ctx,domain,fields};assignOptions(kwargs,options,["offset","limit","order"]);return this.call(model,"search_read",[],kwargs);}
unlink(model,ids,ctx){validatePrimitiveList("ids","number",ids);if(!ids.length){return true;}
return this.call(model,"unlink",[ids],{context:ctx});}
webReadGroup(model,domain,fields,groupby,options={},ctx={}){validateArray("domain",domain);validatePrimitiveList("fields","string",fields);validatePrimitiveList("groupby","string",groupby);const kwargs={domain,groupby,fields,context:ctx,};assignOptions(kwargs,options,["lazy","offset","orderby","limit"]);return this.call(model,"web_read_group",[],kwargs);}
webSearchRead(model,domain,fields,options={},ctx={}){validateArray("domain",domain);validatePrimitiveList("fields","string",fields);const kwargs={context:ctx,domain,fields};assignOptions(kwargs,options,["offset","limit","order"]);return this.call(model,"web_search_read",[],kwargs);}
write(model,ids,data,ctx){validatePrimitiveList("ids","number",ids);validateObject("data",data);return this.call(model,"write",[ids,data],{context:ctx});}}
const ormService=__exports.ormService={dependencies:["rpc","user"],async:["call","create","read","readGroup","search","searchRead","unlink","web_search_read","write",],start(env,{rpc,user}){return new ORM(rpc,user);},};registry.category("services").add("orm",ormService);return __exports;});;

/* /web/static/src/core/popover/popover.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/popover/popover',async function(require){'use strict';let __exports={};const{usePosition}=require("@web/core/position/position_hook");const{Component}=owl;const Popover=__exports.Popover=class Popover extends Component{setup(){usePosition(this.props.target,{margin:16,position:this.props.position,});}}
Popover.template="web.PopoverWowl";Popover.defaultProps={position:"bottom",};Popover.props={popoverClass:{optional:true,type:String,},position:{type:String,validate:(p)=>["top","bottom","left","right"].includes(p),},target:HTMLElement,};return __exports;});;

/* /web/static/src/core/popover/popover_container.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/popover/popover_container',async function(require){'use strict';let __exports={};const{Popover}=require("@web/core/popover/popover");const{Component}=owl;const{useExternalListener,useState}=owl.hooks;const{xml}=owl.tags;class PopoverController extends Component{setup(){this.state=useState({displayed:false});this.targetObserver=new MutationObserver(this.onTargetMutate.bind(this));useExternalListener(window,"click",this.onClickAway,{capture:true});}
mounted(){this.targetObserver.observe(this.target.parentElement,{childList:true});}
willUnmount(){this.targetObserver.disconnect();}
shouldUpdate(){return false;}
get popoverProps(){return{target:this.target,position:this.props.position,popoverClass:this.props.popoverClass,};}
get target(){if(typeof this.props.target==="string"){return document.querySelector(this.props.target);}else{return this.props.target;}}
onClickAway(ev){if(this.target.contains(ev.target)||ev.target.closest(".o_popover")){return;}
if(this.props.closeOnClickAway){this.props.close();}}
onTargetMutate(){const target=this.target;if(!target||!target.parentElement){this.props.close();}}}
PopoverController.components={Popover};PopoverController.defaultProps={alwaysDisplayed:false,closeOnClickAway:true,};PopoverController.template=xml`
    <Popover t-props="popoverProps" t-on-popover-closed="props.close()">
        <t t-component="props.Component" t-props="props.props" />
    </Popover>
`;const PopoverContainer=__exports.PopoverContainer=class PopoverContainer extends Component{setup(){this.props.bus.on("UPDATE",this,this.render);}}
PopoverContainer.components={PopoverController};PopoverContainer.template=xml`
    <div class="o_popover_container">
        <t t-foreach="Object.values(props.popovers)" t-as="popover" t-key="popover.id">
            <PopoverController t-props="popover" />
        </t>
    </div>
`;return __exports;});;

/* /web/static/src/core/popover/popover_hook.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/popover/popover_hook',async function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{onWillUnmount,useComponent}=owl.hooks;__exports.usePopover=usePopover;function usePopover(){const removeFns=new Set();const service=useService("popover");const component=useComponent();onWillUnmount(function(){for(const removeFn of removeFns){removeFn();}
removeFns.clear();});return{add(target,Component,props,options={}){const newOptions=Object.create(options);newOptions.onClose=function(){removeFns.delete(removeFn);if(options.onClose&&component.__owl__.status!==5){options.onClose();}};const removeFn=service.add(target,Component,props,newOptions);removeFns.add(removeFn);return removeFn;},};}
return __exports;});;

/* /web/static/src/core/popover/popover_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/popover/popover_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{PopoverContainer}=require("@web/core/popover/popover_container");const{EventBus}=owl.core;const popoverService=__exports.popoverService={start(){let nextId=0;const popovers={};const bus=new EventBus();registry.category("main_components").add("PopoverContainer",{Component:PopoverContainer,props:{bus,popovers}});function add(target,Component,props,options={}){const id=++nextId;const closeFn=()=>close(id);const popover={id,target,Component,props,close:closeFn,onClose:options.onClose,position:options.position,popoverClass:options.popoverClass,closeOnClickAway:options.closeOnClickAway,};popovers[id]=popover;bus.trigger("UPDATE");return closeFn;}
function close(id){if(id in popovers){const popover=popovers[id];if(popover.onClose){popover.onClose();}
delete popovers[id];bus.trigger("UPDATE");}}
return{add};},};registry.category("services").add("popover",popoverService);return __exports;});;

/* /web/static/src/core/position/position_hook.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/position/position_hook',async function(require){'use strict';let __exports={};const{useEffect}=require("@web/core/utils/hooks");const{throttleForAnimation}=require("@web/core/utils/timing");const{onWillUnmount}=owl.hooks;const{hooks}=owl;const{useComponent,useExternalListener,useRef}=hooks;const POPPER_CLASS="o-popper-position";const DIRECTION_FLIP_ORDER={top:"tbrl",right:"rltb",bottom:"btrl",left:"lrbt"};const VARIANT_FLIP_ORDER={start:"sme",middle:"mse",end:"ems"};const DEFAULTS=__exports.DEFAULTS={margin:0,position:"bottom",};__exports.computePositioning=computePositioning;function computePositioning(reference,popper,options){const{container,margin,position}=options;const[directionKey,variantKey="middle"]=position.split("-");const directions=DIRECTION_FLIP_ORDER[directionKey];const variants=VARIANT_FLIP_ORDER[variantKey];const popBox=popper.getBoundingClientRect();const refBox=reference.getBoundingClientRect();const contBox=container.getBoundingClientRect();const containerIsHTMLNode=container===document.firstElementChild;const directionsData={t:refBox.top-popBox.height-margin,b:refBox.bottom+margin,r:refBox.right+margin,l:refBox.left-popBox.width-margin,};const variantsData={vs:refBox.left,vm:refBox.left+refBox.width/2+-popBox.width/2,ve:refBox.right-popBox.width,hs:refBox.top,hm:refBox.top+refBox.height/2+-popBox.height/2,he:refBox.bottom-popBox.height,};function get(d=directions[0],v=variants[0],containerRestricted=false){const vertical=["t","b"].includes(d);const variantPrefix=vertical?"v":"h";const directionValue=directionsData[d];const variantValue=variantsData[variantPrefix+v];if(containerRestricted){const[directionSize,variantSize]=vertical?[popBox.height+margin,popBox.width]:[popBox.width,popBox.height+margin];let[directionMin,directionMax]=vertical?[contBox.top,contBox.bottom]:[contBox.left,contBox.right];let[variantMin,variantMax]=vertical?[contBox.left,contBox.right]:[contBox.top,contBox.bottom];if(containerIsHTMLNode){if(vertical){directionMin+=container.scrollTop;directionMax+=container.scrollTop;}else{variantMin+=container.scrollTop;variantMax+=container.scrollTop;}}
const directionOverflow=directionValue<directionMin||directionValue+directionSize>directionMax;const variantOverflow=variantValue<variantMin||variantValue+variantSize>variantMax;if(directionOverflow||variantOverflow){return null;}}
const positioning=vertical?{top:directionValue,left:variantValue,}:{top:variantValue,left:directionValue,};return{...positioning,className:`${POPPER_CLASS}--${d}${v}`};}
return{directions,variants,get,};}
function reposition(reference,popper,options){options={container:document.documentElement,...DEFAULTS,...options,};for(const popperClass of popper.classList){if(popperClass.startsWith(POPPER_CLASS)){popper.classList.remove(popperClass);}}
popper.classList.add(POPPER_CLASS);const positioning=computePositioning(reference,popper,options);for(const d of positioning.directions){for(const v of positioning.variants){const posData=positioning.get(d,v,true);if(!posData){continue;}
const{className,top,left}=posData;popper.classList.add(className);popper.style.top=`${top}px`;popper.style.left=`${left}px`;return;}}
const{className,top,left}=positioning.get();popper.classList.add(className);popper.style.top=`${top}px`;popper.style.left=`${left}px`;}
__exports.usePosition=usePosition;function usePosition(reference,options){options={...DEFAULTS,...options};const{popper}=options;const popperRef=popper?useRef(popper):useComponent();const getReference=reference instanceof HTMLElement?()=>reference:reference;const update=()=>{const ref=getReference();if(popperRef.el&&ref){reposition(ref,popperRef.el,options);}};useEffect(update);const throttledUpdate=throttleForAnimation(update);useExternalListener(document,"scroll",throttledUpdate,{capture:true});useExternalListener(window,"resize",throttledUpdate);onWillUnmount(throttledUpdate.cancel);}
return __exports;});;

/* /web/static/src/core/py_js/py.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/py_js/py',async function(require){'use strict';let __exports={};const{evaluate}=require("@web/core/py_js/py_interpreter");const{parse}=require("@web/core/py_js/py_parser");const{tokenize}=require("@web/core/py_js/py_tokenizer");{const{evaluate}=require("@web/core/py_js/py_interpreter");Object.assign(__exports,{evaluate})};{const{parse}=require("@web/core/py_js/py_parser");Object.assign(__exports,{parse})};{const{tokenize}=require("@web/core/py_js/py_tokenizer");Object.assign(__exports,{tokenize})};{const{formatAST}=require("@web/core/py_js/py_utils");Object.assign(__exports,{formatAST})};__exports.parseExpr=parseExpr;function parseExpr(expr){const tokens=tokenize(expr);return parse(tokens);}
__exports.evaluateExpr=evaluateExpr;function evaluateExpr(expr,context={}){const ast=parseExpr(expr);return evaluate(ast,context);}
return __exports;});;

/* /web/static/src/core/py_js/py_builtin.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/py_js/py_builtin',async function(require){'use strict';let __exports={};const{PyDate,PyDateTime,PyRelativeDelta,PyTime,PyTimeDelta}=require("@web/core/py_js/py_date");const BUILTINS=__exports.BUILTINS={bool(value){switch(typeof value){case"number":return value!==0;case"string":return value!=="";case"boolean":return value;case"object":if(value===null){return false;}
if(value.isTrue){return value.isTrue();}
return true;}
return true;},time:{strftime(format){return PyDateTime.now().strftime(format);},},context_today(){return PyDate.today();},get current_date(){return this.today;},get today(){return PyDate.today().strftime("%Y-%m-%d");},get now(){return PyDateTime.now().strftime("%Y-%m-%d %H:%M:%S");},datetime:{time:PyTime,timedelta:PyTimeDelta,datetime:PyDateTime,date:PyDate,},relativedelta:PyRelativeDelta,};return __exports;});;

/* /web/static/src/core/py_js/py_date.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/py_js/py_date',async function(require){'use strict';let __exports={};const{parseArgs}=require("@web/core/py_js/py_utils");const AssertionError=__exports.AssertionError=class AssertionError extends Error{}
const ValueError=__exports.ValueError=class ValueError extends Error{}
const NotSupportedError=__exports.NotSupportedError=class NotSupportedError extends Error{}
function fmt2(n){return String(n).padStart(2,"0");}
function fmt4(n){return String(n).padStart(4,"0");}
function divmod(a,b,fn){let mod=a%b;if((mod>0&&b<0)||(mod<0&&b>0)){mod+=b;}
return fn(Math.floor(a/b),mod);}
function assert(bool,message="AssertionError"){if(!bool){throw new AssertionError(message);}}
const DAYS_IN_MONTH=[null,31,28,31,30,31,30,31,31,30,31,30,31];const DAYS_BEFORE_MONTH=[null];for(let dbm=0,i=1;i<DAYS_IN_MONTH.length;++i){DAYS_BEFORE_MONTH.push(dbm);dbm+=DAYS_IN_MONTH[i];}
function daysInMonth(year,month){if(month===2&&isLeap(year)){return 29;}
return DAYS_IN_MONTH[month];}
function isLeap(year){return year%4===0&&(year%100!==0||year%400===0);}
function daysBeforeYear(year){const y=year-1;return y*365+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);}
function daysBeforeMonth(year,month){const postLeapFeb=month>2&&isLeap(year);return DAYS_BEFORE_MONTH[month]+(postLeapFeb?1:0);}
function ymd2ord(year,month,day){const dim=daysInMonth(year,month);if(!(1<=day&&day<=dim)){throw new ValueError(`day must be in 1..${dim}`);}
return daysBeforeYear(year)+daysBeforeMonth(year,month)+day;}
const DI400Y=daysBeforeYear(401);const DI100Y=daysBeforeYear(101);const DI4Y=daysBeforeYear(5);function ord2ymd(n){--n;let n400,n100,n4,n1,n0;divmod(n,DI400Y,function(_n400,n){n400=_n400;divmod(n,DI100Y,function(_n100,n){n100=_n100;divmod(n,DI4Y,function(_n4,n){n4=_n4;divmod(n,365,function(_n1,n){n1=_n1;n0=n;});});});});n=n0;const year=n400*400+1+n100*100+n4*4+n1;if(n1==4||n100==100){assert(n0===0);return{year:year-1,month:12,day:31,};}
let leapyear=n1===3&&(n4!==24||n100==3);assert(leapyear==isLeap(year));let month=(n+50)>>5;let preceding=DAYS_BEFORE_MONTH[month]+(month>2&&leapyear?1:0);if(preceding>n){--month;preceding-=DAYS_IN_MONTH[month]+(month===2&&leapyear?1:0);}
n-=preceding;return{year:year,month:month,day:n+1,};}
function tmxxx(year,month,day,hour,minute,second,microsecond){hour=hour||0;minute=minute||0;second=second||0;microsecond=microsecond||0;if(microsecond<0||microsecond>999999){divmod(microsecond,1000000,function(carry,ms){microsecond=ms;second+=carry;});}
if(second<0||second>59){divmod(second,60,function(carry,s){second=s;minute+=carry;});}
if(minute<0||minute>59){divmod(minute,60,function(carry,m){minute=m;hour+=carry;});}
if(hour<0||hour>23){divmod(hour,24,function(carry,h){hour=h;day+=carry;});}
if(month<1||month>12){divmod(month-1,12,function(carry,m){month=m+1;year+=carry;});}
let dim=daysInMonth(year,month);if(day<1||day>dim){if(day===0){--month;if(month>0){day=daysInMonth(year,month);}else{--year;month=12;day=31;}}else if(day==dim+1){++month;day=1;if(month>12){month=1;++year;}}else{let r=ord2ymd(ymd2ord(year,month,1)+(day-1));year=r.year;month=r.month;day=r.day;}}
return{year:year,month:month,day:day,hour:hour,minute:minute,second:second,microsecond:microsecond,};}
const PyDate=__exports.PyDate=class PyDate{static today(){const now=new Date();const year=now.getUTCFullYear();const month=now.getUTCMonth()+1;const day=now.getUTCDate();return new PyDate(year,month,day);}
constructor(year,month,day){this.year=year;this.month=month;this.day=day;}
static create(...args){const{year,month,day}=parseArgs(args,["year","month","day"]);return new PyDate(year,month,day);}
add(timedelta){const s=tmxxx(this.year,this.month,this.day+timedelta.days);return new PyDate(s.year,s.month,s.day);}
isEqual(other){if(!(other instanceof PyDate)){return false;}
return this.year===other.year&&this.month===other.month&&this.day===other.day;}
strftime(format){return format.replace(/%([A-Za-z])/g,(m,c)=>{switch(c){case"Y":return fmt4(this.year);case"m":return fmt2(this.month);case"d":return fmt2(this.day);}
throw new ValueError(`No known conversion for ${m}`);});}
substract(other){if(other instanceof PyTimeDelta){return this.add(other.negate());}
if(other instanceof PyDate){return PyTimeDelta.create(this.toordinal()-other.toordinal());}
throw NotSupportedError();}
toJSON(){return this.strftime("%Y-%m-%d");}
toordinal(){return ymd2ord(this.year,this.month,this.day);}}
const PyDateTime=__exports.PyDateTime=class PyDateTime{static now(){const now=new Date();const year=now.getUTCFullYear();const month=now.getUTCMonth()+1;const day=now.getUTCDate();const hour=now.getUTCHours();const minute=now.getUTCMinutes();const second=now.getUTCSeconds();return new PyDateTime(year,month,day,hour,minute,second,0);}
static create(...args){const namedArgs=parseArgs(args,["year","month","day","hour","minute","second","microsecond",]);const year=namedArgs.year;const month=namedArgs.month;const day=namedArgs.day;const hour=namedArgs.hour||0;const minute=namedArgs.minute||0;const second=namedArgs.second||0;const ms=namedArgs.micro/1000||0;return new PyDateTime(year,month,day,hour,minute,second,ms);}
static combine(...args){const{date,time}=parseArgs(args,["date","time"]);return PyDateTime.create(date.year,date.month,date.day,time.hour,time.minute,time.second);}
constructor(year,month,day,hour,minute,second,microsecond){this.year=year;this.month=month;this.day=day;this.hour=hour;this.minute=minute;this.second=second;this.microsecond=microsecond;}
add(timedelta){const s=tmxxx(this.year,this.month,this.day+timedelta.days,this.hour,this.minute,this.second+timedelta.seconds,this.microsecond+timedelta.microseconds);return new PyDateTime(s.year,s.month,s.day,s.hour,s.minute,s.second,s.microsecond);}
isEqual(other){if(!(other instanceof PyDateTime)){return false;}
return(this.year===other.year&&this.month===other.month&&this.day===other.day&&this.hour===other.hour&&this.minute===other.minute&&this.second===other.second&&this.microsecond===other.microsecond);}
strftime(format){return format.replace(/%([A-Za-z])/g,(m,c)=>{switch(c){case"Y":return fmt4(this.year);case"m":return fmt2(this.month);case"d":return fmt2(this.day);case"H":return fmt2(this.hour);case"M":return fmt2(this.minute);case"S":return fmt2(this.second);}
throw new ValueError(`No known conversion for ${m}`);});}
substract(timedelta){return this.add(timedelta.negate());}
toJSON(){return this.strftime("%Y-%m-%d %H:%M:%S");}
to_utc(){const d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);const timedelta=PyTimeDelta.create({minutes:d.getTimezoneOffset()});return this.add(timedelta);}}
const PyTime=__exports.PyTime=class PyTime extends PyDate{static create(...args){const namedArgs=parseArgs(args,["hour","minute","second"]);const hour=namedArgs.hour||0;const minute=namedArgs.minute||0;const second=namedArgs.second||0;return new PyTime(hour,minute,second);}
constructor(hour,minute,second){const now=new Date();const year=now.getFullYear();const month=now.getUTCMonth();const day=now.getUTCDate();super(year,month,day);this.hour=hour;this.minute=minute;this.second=second;}
strftime(format){return format.replace(/%([A-Za-z])/g,(m,c)=>{switch(c){case"Y":return fmt4(this.year);case"m":return fmt2(this.month+1);case"d":return fmt2(this.day);case"H":return fmt2(this.hour);case"M":return fmt2(this.minute);case"S":return fmt2(this.second);}
throw new ValueError(`No known conversion for ${m}`);});}
toJSON(){return this.strftime("%H:%M:%S");}}
const DAYS_IN_YEAR=[31,59,90,120,151,181,212,243,273,304,334,366];const TIME_PERIODS=["hour","minute","second"];const PERIODS=["year","month","day",...TIME_PERIODS];const RELATIVE_KEYS="years months weeks days hours minutes seconds microseconds leapdays".split(" ");const ABSOLUTE_KEYS="year month day hour minute second microsecond weekday nlyearday yearday".split(" ");const argsSpec=["dt1","dt2"];const PyRelativeDelta=__exports.PyRelativeDelta=class PyRelativeDelta{static create(...args){const params=parseArgs(args,argsSpec);if("dt1"in params){throw new Error("relativedelta(dt1, dt2) is not supported for now");}
for(const period of PERIODS){if(period in params){const val=params[period];assert(val>=0,`${period} ${val} is out of range`);}}
for(const key of RELATIVE_KEYS){params[key]=params[key]||0;}
for(const key of ABSOLUTE_KEYS){params[key]=key in params?params[key]:null;}
params.days+=7*params.weeks;let yearDay=0;if(params.nlyearday){yearDay=params.nlyearday;}else if(params.yearday){yearDay=params.yearday;if(yearDay>59){params.leapDays=-1;}}
if(yearDay){for(let monthIndex=0;monthIndex<DAYS_IN_YEAR.length;monthIndex++){if(yearDay<=DAYS_IN_YEAR[monthIndex]){params.month=monthIndex+1;if(monthIndex===0){params.day=yearDay;}else{params.day=yearDay-DAYS_IN_YEAR[monthIndex-1];}
break;}}}
return new PyRelativeDelta(params);}
static add(date,delta){if(!(date instanceof PyDate||date instanceof PyDateTime)){throw NotSupportedError();}
const s=tmxxx((delta.year||date.year)+delta.years,(delta.month||date.month)+delta.months,delta.day||date.day,delta.hour||date.hour||0,delta.minute||date.minute||0,delta.second||date.seconds||0,delta.microseconds||date.microseconds||0);const newDateTime=new PyDateTime(s.year,s.month,s.day,s.hour,s.minute,s.second,s.microsecond);let leapDays=0;if(delta.leapDays&&newDateTime.month>2&&isLeap(newDateTime.year)){leapDays=delta.leapDays;}
const temp=newDateTime.add(PyTimeDelta.create({days:delta.days+leapDays,hours:delta.hours,minutes:delta.minutes,seconds:delta.seconds,microseconds:delta.microseconds,}));const hasTime=Boolean(temp.hour||temp.minute||temp.second||temp.microsecond);const returnDate=!hasTime&&date instanceof PyDate?new PyDate(temp.year,temp.month,temp.day):temp;if(delta.weekday!==null){const wantedDow=delta.weekday+1;const _date=new Date(returnDate.year,returnDate.month-1,returnDate.day);const days=(7-_date.getDay()+wantedDow)%7;return returnDate.add(new PyTimeDelta(days,0,0));}
return returnDate;}
static substract(date,delta){return PyRelativeDelta.add(date,delta.negate());}
constructor(params={},sign=+1){this.years=sign*params.years;this.months=sign*params.months;this.days=sign*params.days;this.hours=sign*params.hours;this.minutes=sign*params.minutes;this.seconds=sign*params.seconds;this.microseconds=sign*params.microseconds;this.leapDays=params.leapDays;this.year=params.year;this.month=params.month;this.day=params.day;this.hour=params.hour;this.minute=params.minute;this.second=params.second;this.microsecond=params.microsecond;this.weekday=params.weekday;}
negate(){return new PyRelativeDelta(this,-1);}
isEqual(other){throw new NotSupportedError();}}
const TIME_DELTA_KEYS="weeks days hours minutes seconds milliseconds microseconds".split(" ");function modf(x){const mod=x%1;return[mod<0?mod+1:mod,Math.floor(x)];}
const PyTimeDelta=__exports.PyTimeDelta=class PyTimeDelta{static create(...args){const namedArgs=parseArgs(args,["days","seconds","microseconds"]);for(const key of TIME_DELTA_KEYS){namedArgs[key]=namedArgs[key]||0;}
let d=0;let s=0;let us=0;const days=namedArgs.days+namedArgs.weeks*7;let seconds=namedArgs.seconds+60*namedArgs.minutes+3600*namedArgs.hours;let microseconds=namedArgs.microseconds+1000*namedArgs.milliseconds;const[dFrac,dInt]=modf(days);d=dInt;let daysecondsfrac=0;if(dFrac){const[dsFrac,dsInt]=modf(dFrac*24*3600);s=dsInt;daysecondsfrac=dsFrac;}
const[sFrac,sInt]=modf(seconds);seconds=sInt;const secondsfrac=sFrac+daysecondsfrac;divmod(seconds,24*3600,(days,seconds)=>{d+=days;s+=seconds;});microseconds+=secondsfrac*1e6;divmod(microseconds,1000000,(seconds,microseconds)=>{divmod(seconds,24*3600,(days,seconds)=>{d+=days;s+=seconds;us+=Math.round(microseconds);});});return new PyTimeDelta(d,s,us);}
constructor(days,seconds,microseconds){this.days=days;this.seconds=seconds;this.microseconds=microseconds;}
add(other){return PyTimeDelta.create({days:this.days+other.days,seconds:this.seconds+other.seconds,microseconds:this.microseconds+other.microseconds,});}
divide(n){const us=(this.days*24*3600+this.seconds)*1e6+this.microseconds;return PyTimeDelta.create({microseconds:Math.floor(us/n)});}
isEqual(other){if(!(other instanceof PyTimeDelta)){return false;}
return(this.days===other.days&&this.seconds===other.seconds&&this.microseconds===other.microseconds);}
isTrue(){return this.days!==0||this.seconds!==0||this.microseconds!==0;}
multiply(n){return PyTimeDelta.create({days:n*this.days,seconds:n*this.seconds,microseconds:n*this.microseconds,});}
negate(){return PyTimeDelta.create({days:-this.days,seconds:-this.seconds,microseconds:-this.microseconds,});}
substract(other){return PyTimeDelta.create({days:this.days-other.days,seconds:this.seconds-other.seconds,microseconds:this.microseconds-other.microseconds,});}
total_seconds(){return this.days*86400+this.seconds+this.microseconds/1000000;}}
return __exports;});;

/* /web/static/src/core/py_js/py_interpreter.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/py_js/py_interpreter',async function(require){'use strict';let __exports={};const{BUILTINS}=require("@web/core/py_js/py_builtin");const{NotSupportedError,PyDate,PyDateTime,PyRelativeDelta,PyTime,PyTimeDelta,}=require("@web/core/py_js/py_date");const{parseArgs,PY_DICT,toPyDict}=require("@web/core/py_js/py_utils");const EvaluationError=__exports.EvaluationError=class EvaluationError extends Error{}
const isTrue=BUILTINS.bool;function applyUnaryOp(ast,context){const value=evaluate(ast.right,context);switch(ast.op){case"-":if(value instanceof Object&&value.negate){return value.negate();}
return-value;case"+":return value;case"not":return!isTrue(value);}
throw new EvaluationError(`Unknown unary operator: ${ast.op}`);}
function pytypeIndex(val){switch(typeof val){case"object":return val===null?1:Array.isArray(val)?5:3;case"number":return 2;case"string":return 4;}
throw new EvaluationError(`Unknown type: ${typeof val}`);}
function isConstructor(obj){return!!obj.prototype&&!!obj.prototype.constructor.name;}
function isLess(left,right){if(typeof left==="number"&&typeof right==="number"){return left<right;}
if(typeof left==="boolean"){left=left?1:0;}
if(typeof right==="boolean"){right=right?1:0;}
const leftIndex=pytypeIndex(left);const rightIndex=pytypeIndex(right);if(leftIndex===rightIndex){return left<right;}
return leftIndex<rightIndex;}
function isEqual(left,right){if(typeof left!==typeof right){if(typeof left==="boolean"&&typeof right==="number"){return right===(left?1:0);}
if(typeof left==="number"&&typeof right==="boolean"){return left===(right?1:0);}
return false;}
if(left instanceof Object&&left.isEqual){return left.isEqual(right);}
return left===right;}
function isIn(left,right){if(Array.isArray(right)){return right.includes(left);}
if(typeof right==="string"&&typeof left==="string"){return right.includes(left);}
return false;}
function applyBinaryOp(ast,context){const left=evaluate(ast.left,context);const right=evaluate(ast.right,context);switch(ast.op){case"+":{const relativeDeltaOnLeft=left instanceof PyRelativeDelta;const relativeDeltaOnRight=right instanceof PyRelativeDelta;if(relativeDeltaOnLeft||relativeDeltaOnRight){const date=relativeDeltaOnLeft?right:left;const delta=relativeDeltaOnLeft?left:right;return PyRelativeDelta.add(date,delta);}
const timeDeltaOnLeft=left instanceof PyTimeDelta;const timeDeltaOnRight=right instanceof PyTimeDelta;if(timeDeltaOnLeft&&timeDeltaOnRight){return left.add(right);}
if(timeDeltaOnLeft){if(right instanceof PyDate||right instanceof PyDateTime){return right.add(left);}else{throw NotSupportedError();}}
if(timeDeltaOnRight){if(left instanceof PyDate||left instanceof PyDateTime){return left.add(right);}else{throw NotSupportedError();}}
return left+right;}
case"-":{const isRightDelta=right instanceof PyRelativeDelta;if(isRightDelta){return PyRelativeDelta.substract(left,right);}
const timeDeltaOnRight=right instanceof PyTimeDelta;if(timeDeltaOnRight){if(left instanceof PyTimeDelta){return left.substract(right);}else if(left instanceof PyDate||left instanceof PyDateTime){return left.substract(right);}else{throw NotSupportedError();}}
if(left instanceof PyDate){return left.substract(right);}
return left-right;}
case"*":const timeDeltaOnLeft=left instanceof PyTimeDelta;const timeDeltaOnRight=right instanceof PyTimeDelta;if(timeDeltaOnLeft||timeDeltaOnRight){const number=timeDeltaOnLeft?right:left;const delta=timeDeltaOnLeft?left:right;return delta.multiply(number);}
return left*right;case"/":return left/right;case"%":return left%right;case"//":if(left instanceof PyTimeDelta){return left.divide(right);}
return Math.floor(left/right);case"**":return left**right;case"==":return isEqual(left,right);case"<>":case"!=":return!isEqual(left,right);case"<":return isLess(left,right);case">":return isLess(right,left);case">=":return isEqual(left,right)||isLess(right,left);case"<=":return isEqual(left,right)||isLess(left,right);case"in":return isIn(left,right);case"not in":return!isIn(left,right);}
throw new EvaluationError(`Unknown binary operator: ${ast.op}`);}
const DICT={get(dict){return(...args)=>{const{key,defValue}=parseArgs(args,["key","defValue"]);if(key in dict){return dict[key];}else if(defValue){return defValue;}
return null;};},};__exports.evaluate=evaluate;function evaluate(ast,context={}){const dicts=new Set();let pyContext;const evalContext=Object.create(context);Object.defineProperty(evalContext,"context",{get(){if(!pyContext){pyContext=toPyDict(context);}
return pyContext;},});function _evaluate(ast){switch(ast.type){case 0:case 1:return ast.value;case 5:if(ast.value in evalContext){return evalContext[ast.value];}else if(ast.value in BUILTINS){return BUILTINS[ast.value];}else{throw new EvaluationError(`Name '${ast.value}' is not defined`);}
case 3:return null;case 2:return ast.value;case 6:return applyUnaryOp(ast,evalContext);case 7:return applyBinaryOp(ast,evalContext);case 14:const left=_evaluate(ast.left);if(ast.op==="and"){return isTrue(left)?_evaluate(ast.right):left;}else{return isTrue(left)?left:_evaluate(ast.right);}
case 4:case 10:return ast.value.map(_evaluate);case 11:const dict={};for(let key in ast.value){dict[key]=_evaluate(ast.value[key]);}
dicts.add(dict);return dict;case 8:const fnValue=_evaluate(ast.fn);const args=ast.args.map(_evaluate);const kwargs={};for(let kwarg in ast.kwargs){kwargs[kwarg]=_evaluate(ast.kwargs[kwarg]);}
if(fnValue===PyDate||fnValue===PyDateTime||fnValue===PyTime||fnValue===PyRelativeDelta||fnValue===PyTimeDelta){return fnValue.create(...args,kwargs);}
return fnValue(...args,kwargs);case 12:{const dict=_evaluate(ast.target);const key=_evaluate(ast.key);return dict[key];}
case 13:{if(isTrue(_evaluate(ast.condition))){return _evaluate(ast.ifTrue);}else{return _evaluate(ast.ifFalse);}}
case 15:{const left=_evaluate(ast.obj);if(dicts.has(left)||Object.isPrototypeOf.call(PY_DICT,left)){return DICT[ast.key](left);}
const result=left[ast.key];if(typeof result==="function"&&!isConstructor(result)){return result.bind(left);}
return result;}}
throw new EvaluationError(`AST of type ${ast.type} cannot be evaluated`);}
return _evaluate(ast);}
return __exports;});;

/* /web/static/src/core/py_js/py_parser.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/py_js/py_parser',async function(require){'use strict';let __exports={};const{binaryOperators,comparators}=require("@web/core/py_js/py_tokenizer");const ParserError=__exports.ParserError=class ParserError extends Error{}
const chainedOperators=new Set(comparators);const infixOperators=new Set(binaryOperators.concat(comparators));__exports.bp=bp;function bp(symbol){switch(symbol){case"=":return 10;case"if":return 20;case"in":case"not in":case"is":case"is not":case"<":case"<=":case">":case">=":case"<>":case"==":case"!=":return 60;case"or":return 30;case"and":return 40;case"not":return 50;case"|":return 70;case"^":return 80;case"&":return 90;case"<<":case">>":return 100;case"+":case"-":return 110;case"*":case"/":case"//":case"%":return 120;case"**":return 140;case".":case"(":case"[":return 150;}
return 0;}
function bindingPower(token){return token.type===2?bp(token.value):0;}
function isSymbol(token,value){return token.type===2&&token.value===value;}
function parsePrefix(current,tokens){switch(current.type){case 0:return{type:0,value:current.value};case 1:return{type:1,value:current.value};case 4:if(current.value==="None"){return{type:3};}else{return{type:2,value:current.value==="True"};}
case 3:return{type:5,value:current.value};case 2:switch(current.value){case"-":case"+":case"~":return{type:6,op:current.value,right:_parse(tokens,130),};case"not":return{type:6,op:current.value,right:_parse(tokens,50),};case"(":const content=[];let isTuple=false;while(tokens[0]&&!isSymbol(tokens[0],")")){content.push(_parse(tokens,0));if(tokens[0]){if(tokens[0]&&isSymbol(tokens[0],",")){isTuple=true;tokens.shift();}else if(!isSymbol(tokens[0],")")){throw new ParserError("parsing error");}}else{throw new ParserError("parsing error");}}
if(!tokens[0]||!isSymbol(tokens[0],")")){throw new ParserError("parsing error");}
tokens.shift();isTuple=isTuple||content.length===0;return isTuple?{type:10,value:content}:content[0];case"[":const value=[];while(tokens[0]&&!isSymbol(tokens[0],"]")){value.push(_parse(tokens,0));if(tokens[0]){if(isSymbol(tokens[0],",")){tokens.shift();}else if(!isSymbol(tokens[0],"]")){throw new ParserError("parsing error");}}}
if(!tokens[0]||!isSymbol(tokens[0],"]")){throw new ParserError("parsing error");}
tokens.shift();return{type:4,value};case"{":{const dict={};while(tokens[0]&&!isSymbol(tokens[0],"}")){const key=_parse(tokens,0);if((key.type!==1&&key.type!==0)||!tokens[0]||!isSymbol(tokens[0],":")){throw new ParserError("parsing error");}
tokens.shift();const value=_parse(tokens,0);dict[key.value]=value;if(isSymbol(tokens[0],",")){tokens.shift();}}
if(!tokens.shift()){throw new ParserError("parsing error");}
return{type:11,value:dict};}}}
throw new ParserError("Token cannot be parsed");}
function parseInfix(left,current,tokens){switch(current.type){case 2:if(infixOperators.has(current.value)){let right=_parse(tokens,bindingPower(current));if(current.value==="and"||current.value==="or"){return{type:14,op:current.value,left,right,};}else if(current.value==="."){if(right.type===5){return{type:15,obj:left,key:right.value,};}else{throw new ParserError("invalid obj lookup");}}
let op={type:7,op:current.value,left,right,};while(chainedOperators.has(current.value)&&tokens[0]&&tokens[0].type===2&&chainedOperators.has(tokens[0].value)){const nextToken=tokens.shift();op={type:14,op:"and",left:op,right:{type:7,op:nextToken.value,left:right,right:_parse(tokens,bindingPower(nextToken)),},};right=op.right.right;}
return op;}
switch(current.value){case"(":const args=[];const kwargs={};while(tokens[0]&&!isSymbol(tokens[0],")")){const arg=_parse(tokens,0);if(arg.type===9){kwargs[arg.name.value]=arg.value;}else{args.push(arg);}
if(tokens[0]&&isSymbol(tokens[0],",")){tokens.shift();}}
if(!tokens[0]||!isSymbol(tokens[0],")")){throw new ParserError("parsing error");}
tokens.shift();return{type:8,fn:left,args,kwargs};case"=":if(left.type===5){return{type:9,name:left,value:_parse(tokens,10),};}
case"[":{const key=_parse(tokens);if(!tokens[0]||!isSymbol(tokens[0],"]")){throw new ParserError("parsing error");}
tokens.shift();return{type:12,target:left,key:key,};}
case"if":{const condition=_parse(tokens);if(!tokens[0]||!isSymbol(tokens[0],"else")){throw new ParserError("parsing error");}
tokens.shift();const ifFalse=_parse(tokens);return{type:13,condition,ifTrue:left,ifFalse,};}}}
throw new ParserError("Token cannot be parsed");}
function _parse(tokens,bp=0){const token=tokens.shift();let expr=parsePrefix(token,tokens);while(tokens[0]&&bindingPower(tokens[0])>bp){expr=parseInfix(expr,tokens.shift(),tokens);}
return expr;}
__exports.parse=parse;function parse(tokens){if(tokens.length){return _parse(tokens,0);}
throw new ParserError("Missing token");}
return __exports;});;

/* /web/static/src/core/py_js/py_tokenizer.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/py_js/py_tokenizer',async function(require){'use strict';let __exports={};const TokenizerError=__exports.TokenizerError=class TokenizerError extends Error{}
const directMap={"\\":"\\",'"':'"',"'":"'",a:"\x07",b:"\x08",f:"\x0c",n:"\n",r:"\r",t:"\t",v:"\v",};function decodeStringLiteral(str,unicode){let out=[];let code;for(var i=0;i<str.length;++i){if(str[i]!=="\\"){out.push(str[i]);continue;}
var escape=str[i+1];if(escape in directMap){out.push(directMap[escape]);++i;continue;}
switch(escape){case"\n":++i;continue;case"N":if(!unicode){break;}
throw new TokenizerError("SyntaxError: \\N{} escape not implemented");case"u":if(!unicode){break;}
var uni=str.slice(i+2,i+6);if(!/[0-9a-f]{4}/i.test(uni)){throw new TokenizerError(["SyntaxError: (unicode error) 'unicodeescape' codec"," can't decode bytes in position ",i,"-",i+4,": truncated \\uXXXX escape",].join(""));}
code=parseInt(uni,16);out.push(String.fromCharCode(code));i+=5;continue;case"U":if(!unicode){break;}
throw new TokenizerError("SyntaxError: \\U escape not implemented");case"x":var hex=str.slice(i+2,i+4);if(!/[0-9a-f]{2}/i.test(hex)){if(!unicode){throw new TokenizerError("ValueError: invalid \\x escape");}
throw new TokenizerError(["SyntaxError: (unicode error) 'unicodeescape'"," codec can't decode bytes in position ",i,"-",i+2,": truncated \\xXX escape",].join(""));}
code=parseInt(hex,16);out.push(String.fromCharCode(code));i+=3;continue;default:if(!/[0-8]/.test(escape)){break;}
var r=/[0-8]{1,3}/g;r.lastIndex=i+1;var m=r.exec(str);var oct=m[0];code=parseInt(oct,8);out.push(String.fromCharCode(code));i+=oct.length;continue;}
out.push("\\");}
return out.join("");}
const constants=new Set(["None","False","True"]);const comparators=__exports.comparators=["in","not","not in","is","is not","<","<=",">",">=","<>","!=","==",];const binaryOperators=__exports.binaryOperators=["or","and","|","^","&","<<",">>","+","-","*","/","//","%","~","**",".",];const unaryOperators=__exports.unaryOperators=["-"];const symbols=new Set([...["(",")","[","]","{","}",":",","],...["if","else","lambda","="],...comparators,...binaryOperators,...unaryOperators,]);function group(...args){return"("+args.join("|")+")";}
const Name="[a-zA-Z_]\\w*";const Whitespace="[ \\f\\t]*";const DecNumber="\\d+(L|l)?";const IntNumber=DecNumber;const PointFloat=group("\\d+\\.\\d*","\\.\\d+");const FloatNumber=PointFloat;const Number=group(FloatNumber,IntNumber);const Operator=group("\\*\\*=?",">>=?","<<=?","<>","!=","//=?","[+\\-*/%&|^=<>]=?","~");const Bracket="[\\[\\]\\(\\)\\{\\}]";const Special="[:;.,`@]";const Funny=group(Operator,Bracket,Special);const ContStr=group("([uU])?'([^\n'\\\\]*(?:\\\\.[^\n'\\\\]*)*)'",'([uU])?"([^\n"\\\\]*(?:\\\\.[^\n"\\\\]*)*)"');const PseudoToken=Whitespace+group(Number,Funny,ContStr,Name);const NumberPattern=new RegExp("^"+Number+"$");const StringPattern=new RegExp("^"+ContStr+"$");const NamePattern=new RegExp("^"+Name+"$");const strip=new RegExp("^"+Whitespace);__exports.tokenize=tokenize;function tokenize(str){const tokens=[];let max=str.length;let start=0;let end=0;const pseudoprog=new RegExp(PseudoToken,"g");while(pseudoprog.lastIndex<max){const pseudomatch=pseudoprog.exec(str);if(!pseudomatch){if(/^\s+$/.test(str.slice(end))){break;}
throw new TokenizerError("Failed to tokenize <<"+
str+">> at index "+
(end||0)+"; parsed so far: "+
tokens);}
if(pseudomatch.index>end){if(str.slice(end,pseudomatch.index).trim()){throw new TokenizerError("Invalid expression");}}
start=pseudomatch.index;end=pseudoprog.lastIndex;let token=str.slice(start,end).replace(strip,"");if(NumberPattern.test(token)){tokens.push({type:0,value:parseFloat(token),});}else if(StringPattern.test(token)){var m=StringPattern.exec(token);tokens.push({type:1,value:decodeStringLiteral(m[3]!==undefined?m[3]:m[5],!!(m[2]||m[4])),});}else if(symbols.has(token)){if(token==="in"&&tokens.length>0&&tokens[tokens.length-1].value==="not"){token="not in";tokens.pop();}else if(token==="not"&&tokens.length>0&&tokens[tokens.length-1].value==="is"){token="is not";tokens.pop();}
tokens.push({type:2,value:token,});}else if(constants.has(token)){tokens.push({type:4,value:token,});}else if(NamePattern.test(token)){tokens.push({type:3,value:token,});}else{throw new TokenizerError("Invalid expression");}}
return tokens;}
return __exports;});;

/* /web/static/src/core/py_js/py_utils.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/py_js/py_utils',async function(require){'use strict';let __exports={};const{bp}=require("@web/core/py_js/py_parser");__exports.parseArgs=parseArgs;function parseArgs(args,spec){const last=args[args.length-1];const unnamedArgs=typeof last==="object"?args.slice(0,-1):args;const kwargs=typeof last==="object"?last:{};for(let[index,val]of unnamedArgs.entries()){kwargs[spec[index]]=val;}
return kwargs;}
__exports.toPyValue=toPyValue;function toPyValue(value){switch(typeof value){case"string":return{type:1,value};case"number":return{type:0,value};case"boolean":return{type:2,value};case"object":if(Array.isArray(value)){return{type:4,value:value.map(toPyValue)};}else if(value===null){return{type:3};}else{const content={};for(let key in value){content[key]=toPyValue(value[key]);}
return{type:11,value:content};}
default:throw new Error("Invalid type");}}
__exports.formatAST=formatAST;function formatAST(ast,lbp=0){switch(ast.type){case 3:return"None";case 1:return JSON.stringify(ast.value);case 0:return String(ast.value);case 2:return ast.value?"True":"False";case 4:return`[${ast.value.map(formatAST).join(", ")}]`;case 6:if(ast.op==="not"){return`not `+formatAST(ast.right,50);}
return ast.op+formatAST(ast.right,130);case 7:{const abp=bp(ast.op);const str=`${formatAST(ast.left, abp)} ${ast.op} ${formatAST(ast.right, abp)}`;return abp<lbp?`(${str})`:str;}
case 11:{const pairs=[];for(let k in ast.value){pairs.push(`"${k}": ${formatAST(ast.value[k])}`);}
return`{`+pairs.join(", ")+`}`;}
case 10:return`(${ast.value.map(formatAST).join(", ")})`;case 5:return ast.value;case 12:{return`${formatAST(ast.target)}[${formatAST(ast.key)}]`;}
case 13:{const{ifTrue,condition,ifFalse}=ast;return`${formatAST(ifTrue)} if ${formatAST(condition)} else ${formatAST(ifFalse)}`;}
case 14:{const abp=bp(ast.op);const str=`${formatAST(ast.left, abp)} ${ast.op} ${formatAST(ast.right, abp)}`;return abp<lbp?`(${str})`:str;}
case 15:return`${formatAST(ast.obj, 150)}.${ast.key}`;case 8:{const args=ast.args.map(formatAST);const kwargs=[];for(let kwarg in ast.kwargs){kwargs.push(`${kwarg} = ${formatAST(ast.kwargs[kwarg])}`);}
const argStr=args.concat(kwargs).join(", ");return`${formatAST(ast.fn)}(${argStr})`;}}
throw new Error("invalid expression: "+ast);}
const PY_DICT=__exports.PY_DICT=Object.create(null);__exports.toPyDict=toPyDict;function toPyDict(obj){const result=Object.create(PY_DICT);return Object.assign(result,obj);}
return __exports;});;

/* /web/static/src/core/registry.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/registry',async function(require){'use strict';let __exports={};const{core}=owl;const{EventBus}=core;const KeyNotFoundError=__exports.KeyNotFoundError=class KeyNotFoundError extends Error{}
const DuplicatedKeyError=__exports.DuplicatedKeyError=class DuplicatedKeyError extends Error{}
const Registry=__exports.Registry=class Registry extends EventBus{constructor(){super();this.content={};this.subRegistries={};this.elements=null;this.entries=null;this.on("UPDATE",this,()=>{this.elements=null;this.entries=null;});}
add(key,value,{force,sequence}={}){if(!force&&key in this.content){throw new DuplicatedKeyError(`Cannot add '${key}' in this registry: it already exists`);}
let previousSequence;if(force){const elem=this.content[key];previousSequence=elem&&elem[0];}
sequence=sequence===undefined?previousSequence||50:sequence;this.content[key]=[sequence,value];const payload={operation:"add",key,value};this.trigger("UPDATE",payload);return this;}
get(key,defaultValue){if(arguments.length<2&&!(key in this.content)){throw new KeyNotFoundError(`Cannot find ${key} in this registry!`);}
const info=this.content[key];return info?info[1]:defaultValue;}
contains(key){return key in this.content;}
getAll(){if(!this.elements){const content=Object.values(this.content).sort((el1,el2)=>el1[0]-el2[0]);this.elements=content.map((elem)=>elem[1]);}
return this.elements;}
getEntries(){if(!this.entries){const entries=Object.entries(this.content).sort((el1,el2)=>el1[1][0]-el2[1][0]);this.entries=entries.map(([str,elem])=>[str,elem[1]]);}
return this.entries;}
remove(key){const value=this.content[key];delete this.content[key];const payload={operation:"delete",key,value};this.trigger("UPDATE",payload);}
category(subcategory){if(!(subcategory in this.subRegistries)){this.subRegistries[subcategory]=new Registry();}
return this.subRegistries[subcategory];}}
const registry=__exports.registry=new Registry();return __exports;});;

/* /web/static/src/core/scroller_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/scroller_service',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{scrollTo}=require("@web/core/utils/scrolling");const scrollerService=__exports.scrollerService={start(env){browser.addEventListener("click",(ev)=>{const link=ev.target.closest("a");if(!link){return;}
const disableAnchor=link.attributes.getNamedItem("disable_anchor");if(disableAnchor&&disableAnchor.value==="true"){return;}
const href=link.attributes.getNamedItem("href");if(href){if(href.value[0]==="#"){if(href.value.length===1){ev.preventDefault();return;}
let matchingEl=null;try{matchingEl=document.querySelector(`.o_content #${href.value.substr(1)}`);}catch(e){}
const triggerEv=new CustomEvent("anchor-link-clicked",{detail:{element:matchingEl,id:href.value,originalEv:ev,},});env.bus.trigger("SCROLLER:ANCHOR_LINK_CLICKED",triggerEv);if(matchingEl&&!triggerEv.defaultPrevented){ev.preventDefault();scrollTo(matchingEl,{isAnchor:true});}}}});},};registry.category("services").add("scroller",scrollerService);return __exports;});;

/* /web/static/src/core/tooltip/tooltip.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/tooltip/tooltip',async function(require){'use strict';let __exports={};const{Component}=owl;const Tooltip=__exports.Tooltip=class Tooltip extends Component{}
Tooltip.template="web.Tooltip";Tooltip.props={tooltip:{type:String,optional:true},template:{type:String,optional:true},info:{optional:true},};return __exports;});;

/* /web/static/src/core/tooltip/tooltip_hook.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/tooltip/tooltip_hook',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{useEffect,useListener}=require("@web/core/utils/hooks");const{usePopover}=require("@web/core/popover/popover_hook");const{Tooltip}=require("@web/core/tooltip/tooltip");const OPEN_DELAY=400;const CLOSE_DELAY=200;__exports.useTooltip=useTooltip;function useTooltip(){const popover=usePopover();let openTooltipTimeout;let closeTooltip;let target=null;function cleanup(){browser.clearTimeout(openTooltipTimeout);if(closeTooltip){closeTooltip();}}
function onMouseEnter(ev){const dataset=ev.target.dataset;const tooltip=dataset.tooltip;let template,info;if("tooltipTemplate"in dataset){template=dataset.tooltipTemplate;info=dataset.tooltipInfo?JSON.parse(dataset.tooltipInfo):null;}
if(tooltip||template){cleanup();target=ev.target;openTooltipTimeout=browser.setTimeout(()=>{const position=dataset.tooltipPosition;closeTooltip=popover.add(target,Tooltip,{tooltip,template,info},{position});},OPEN_DELAY);}}
let positionX;let positionY;useListener("mousemove",(ev)=>{positionX=ev.x;positionY=ev.y;});useEffect(()=>{const interval=browser.setInterval(()=>{if(!target){return;}
if(!document.body.contains(target)){return cleanup();}
const targetRect=target.getBoundingClientRect();if(positionX<targetRect.left||positionX>targetRect.right||positionY<targetRect.top||positionY>targetRect.bottom){return cleanup();}},CLOSE_DELAY);return()=>browser.clearInterval(interval);},()=>[]);const selector="[data-tooltip], [data-tooltip-template]";useListener("mouseenter",selector,onMouseEnter,{capture:true});}
return __exports;});;

/* /web/static/src/core/ui/block_ui.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/ui/block_ui',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{Component,tags,useState}=owl;const BlockUI=__exports.BlockUI=class BlockUI extends Component{setup(){this.messagesByDuration=[{time:20,l1:this.env._t("Loading...")},{time:40,l1:this.env._t("Still loading...")},{time:60,l1:this.env._t("Still loading..."),l2:this.env._t("Please be patient."),},{time:180,l1:this.env._t("Don't leave yet,"),l2:this.env._t("it's still loading..."),},{time:120,l1:this.env._t("You may not believe it,"),l2:this.env._t("but the application is actually loading..."),},{time:3180,l1:this.env._t("Take a minute to get a coffee,"),l2:this.env._t("because it's loading..."),},{time:null,l1:this.env._t("Maybe you should consider reloading the application by pressing F5..."),},];this.state=useState({blockUI:false,line1:"",line2:"",});this.props.bus.on("BLOCK",this,this.block);this.props.bus.on("UNBLOCK",this,this.unblock);}
replaceMessage(index){const message=this.messagesByDuration[index];this.state.line1=message.l1;this.state.line2=message.l2||"";if(message.time!==null){this.msgTimer=browser.setTimeout(()=>{this.replaceMessage(index+1);},message.time*1000);}}
block(){this.state.blockUI=true;this.replaceMessage(0);}
unblock(){this.state.blockUI=false;clearTimeout(this.msgTimer);this.state.line1="";this.state.line2="";}}
BlockUI.template=tags.xml`
    <div t-att-class="state.blockUI ? 'o_blockUI' : ''">
      <t t-if="state.blockUI">
        <div class="o_spinner">
            <img src="/web/static/img/spin.png" alt="Loading..."/>
        </div>
        <div class="o_message">
            <t t-raw="state.line1"/> <br/>
            <t t-raw="state.line2"/>
        </div>
      </t>
    </div>`;return __exports;});;

/* /web/static/src/core/ui/ui_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/ui/ui_service',async function(require){'use strict';let __exports={};const{useEffect,useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{debounce}=require("@web/core/utils/timing");const{BlockUI}=require("@web/core/ui/block_ui");const{browser}=require("@web/core/browser/browser");const{Component,core,hooks}=owl;const{EventBus}=core;const{useRef}=hooks;const SIZES=__exports.SIZES={XS:0,VSM:1,SM:2,MD:3,LG:4,XL:5,XXL:6};__exports.useActiveElement=useActiveElement;function useActiveElement(refName=null){const uiService=useService("ui");const owner=refName?useRef(refName):Component.current;useEffect(()=>{uiService.activateElement(owner.el);return()=>uiService.deactivateElement(owner.el);},()=>[]);}
const uiService=__exports.uiService={start(env){let ui={};const bus=new EventBus();registry.category("main_components").add("BlockUI",{Component:BlockUI,props:{bus}});let blockCount=0;function block(){blockCount++;if(blockCount===1){bus.trigger("BLOCK");}}
function unblock(){blockCount--;if(blockCount<0){console.warn("Unblock ui was called more times than block, you should only unblock the UI if you have previously blocked it.");blockCount=0;}
if(blockCount===0){bus.trigger("UNBLOCK");}}
Object.assign(ui,{bus,block,unblock,});Object.defineProperty(ui,"isBlocked",{get(){return blockCount>0;},});let activeElems=[document];function activateElement(el){activeElems.push(el);bus.trigger("active-element-changed",el);}
function deactivateElement(el){activeElems=activeElems.filter((x)=>x!==el);bus.trigger("active-element-changed",ui.activeElement);}
function getActiveElementOf(el){for(const activeElement of[...activeElems].reverse()){if(activeElement.contains(el)){return activeElement;}}}
Object.assign(ui,{activateElement,deactivateElement,getActiveElementOf,});Object.defineProperty(ui,"activeElement",{get(){return activeElems[activeElems.length-1];},});const MEDIAS=[window.matchMedia("(max-width: 474px)"),window.matchMedia("(min-width: 475px) and (max-width: 575px)"),window.matchMedia("(min-width: 576px) and (max-width: 767px)"),window.matchMedia("(min-width: 768px) and (max-width: 991px)"),window.matchMedia("(min-width: 992px) and (max-width: 1199px)"),window.matchMedia("(min-width: 1200px) and (max-width: 1533px)"),window.matchMedia("(min-width: 1534px)"),];function getSize(){return MEDIAS.findIndex((media)=>media.matches);}
function updateSize(){ui.size=getSize();}
browser.addEventListener("resize",debounce(updateSize,100));Object.assign(ui,{size:getSize(),});Object.defineProperty(ui,"isSmall",{get(){return ui.size<=SIZES.SM;},});Object.defineProperty(env,"isSmall",{get(){return ui.size<=SIZES.SM;},});return ui;},};registry.category("services").add("ui",uiService);return __exports;});;

/* /web/static/src/core/user_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/user_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{session}=require("@web/session");const userService=__exports.userService={dependencies:["rpc"],async:["hasGroup"],start(env,{rpc}){const groupProms={};const context={...session.user_context,uid:session.uid,};return{get context(){return Object.assign({},context);},removeFromContext(key){delete context[key];},updateContext(update){Object.assign(context,update);},hasGroup(group){if(!context.uid){return Promise.resolve(false);}
if(!groupProms[group]){groupProms[group]=rpc("/web/dataset/call_kw/res.users/has_group",{model:"res.users",method:"has_group",args:[group],kwargs:{context},});}
return groupProms[group];},name:session.name,userName:session.username,isAdmin:session.is_admin,isSystem:session.is_system,partnerId:session.partner_id,home_action_id:session.home_action_id,showEffect:session.show_effect,get userId(){return context.uid;},get lang(){return context.lang;},get tz(){return context.tz;},get db(){const res={name:session.db,};if("dbuuid"in session){res.uuid=session.dbuuid;}
return res;},};},};registry.category("services").add("user",userService);return __exports;});;

/* /web/static/src/core/utils/arrays.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/arrays',async function(require){'use strict';let __exports={};function _cartesian(){const args=Array.prototype.slice.call(arguments);if(args.length===0){return[undefined];}
const firstArray=args[0].map(function(elem){return[elem];});if(args.length===1){return firstArray;}
const productOfOtherArrays=_cartesian.apply(null,args.slice(1));return firstArray.reduce(function(acc,elem){return acc.concat(productOfOtherArrays.map(function(tuple){return elem.concat(tuple);}));},[]);}
function _getExtractorFrom(criterion){if(criterion){switch(typeof criterion){case"string":return(element)=>element[criterion];case"function":return criterion;default:throw new Error(`Expected criterion of type 'string' or 'function' and got '${typeof criterion}'`);}}else{return(element)=>element;}}
__exports.groupBy=groupBy;function groupBy(array,criterion){const extract=_getExtractorFrom(criterion);const groups={};for(const element of array){const group=String(extract(element));if(!(group in groups)){groups[group]=[];}
groups[group].push(element);}
return groups;}
__exports.sortBy=sortBy;function sortBy(array,criterion,order="asc"){const extract=_getExtractorFrom(criterion);return array.slice().sort((elA,elB)=>{const a=extract(elA);const b=extract(elB);let result;if(isNaN(a)&&isNaN(b)){result=a>b?1:a<b?-1:0;}else{result=a-b;}
return order==="asc"?result:-result;});}
__exports.symmetricalDifference=symmetricalDifference;function symmetricalDifference(arrayA,arrayB){return arrayA.filter((id)=>!arrayB.includes(id)).concat(arrayB.filter((id)=>!arrayA.includes(id)));}
__exports.cartesian=cartesian;function cartesian(){const args=Array.prototype.slice.call(arguments);if(args.length===0){return[undefined];}else if(args.length===1){return args[0];}else{return _cartesian.apply(null,args);}}
__exports.sections=sections;function sections(array){const sections=[];for(let i=0;i<array.length+1;i++){sections.push(array.slice(0,i));}
return sections;}
return __exports;});;

/* /web/static/src/core/utils/components.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/components',async function(require){'use strict';let __exports={};const{Component,tags}=owl;const NotUpdatable=__exports.NotUpdatable=class NotUpdatable extends Component{shouldUpdate(){return false;}}
NotUpdatable.template=tags.xml`<t t-slot="default" />`;const ErrorHandler=__exports.ErrorHandler=class ErrorHandler extends Component{catchError(error){if(this.props.onError){this.props.onError(error);}}}
ErrorHandler.template=tags.xml`<t t-slot="default" />`;return __exports;});;

/* /web/static/src/core/utils/concurrency.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/concurrency',async function(require){'use strict';let __exports={};const KeepLast=__exports.KeepLast=class KeepLast{constructor(){this._id=0;}
add(promise){this._id++;const currentId=this._id;return new Promise((resolve,reject)=>{promise.then((value)=>{if(this._id===currentId){resolve(value);}}).catch((reason)=>{if(this._id===currentId){reject(reason);}});});}}
const Mutex=__exports.Mutex=class Mutex{constructor(){this._lock=Promise.resolve();this._queueSize=0;this._unlockedProm=undefined;this._unlock=undefined;}
async exec(action){const currentLock=this._lock;let result;this._queueSize++;this._unlockedProm=this._unlockedProm||new Promise((resolve)=>{this._unlock=resolve;});this._lock=new Promise((unlockCurrent)=>{currentLock.then(()=>{result=action();const always=(returnedResult)=>{unlockCurrent();this._queueSize--;if(this._queueSize===0){this._unlockedProm=undefined;this._unlock();}
return returnedResult;};Promise.resolve(result).then(always).guardedCatch(always);});});await this._lock;return result;}
getUnlockedDef(){return this._unlockedProm||Promise.resolve();}}
const Race=__exports.Race=class Race{constructor(){this.currentProm=null;this.currentPromResolver=null;}
add(promise){if(!this.currentProm){this.currentProm=new Promise((resolve)=>{this.currentPromResolver=(value)=>{this.currentProm=null;this.currentPromResolver=null;resolve(value);};});}
promise.then(this.currentPromResolver);return this.currentProm;}
getCurrentProm(){return this.currentProm;}}
return __exports;});;

/* /web/static/src/core/utils/functions.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/functions',async function(require){'use strict';let __exports={};__exports.memoize=memoize;function memoize(func){const cache=new Map();const funcName=func.name?func.name+" (memoized)":"memoized";return{[funcName](...args){if(!cache.has(args[0])){cache.set(args[0],func(...args));}
return cache.get(...args);},}[funcName];}
return __exports;});;

/* /web/static/src/core/utils/hooks.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/hooks',async function(require){'use strict';let __exports={};const{SERVICES_METADATA}=require("@web/env");const{onMounted,onWillPatch,onPatched,onWillUnmount,useComponent}=owl.hooks;__exports.useAutofocus=useAutofocus;function useAutofocus(params={}){const comp=useComponent();if(comp.env.isSmall){return()=>{};}
const selector=params.selector||"[autofocus]";let forceFocusCount=0;useEffect(function autofocus(){const target=comp.el.querySelector(selector);if(target){target.focus();if(["INPUT","TEXTAREA"].includes(target.tagName)){const inputEl=target;inputEl.selectionStart=inputEl.selectionEnd=inputEl.value.length;}}},()=>[forceFocusCount]);return function focusOnUpdate(){forceFocusCount++;};}
__exports.useBus=useBus;function useBus(bus,eventName,callback){const component=useComponent();useEffect(()=>{bus.on(eventName,component,callback);return()=>bus.off(eventName,component);},()=>[]);}
const NO_OP=()=>{};__exports.useEffect=useEffect;function useEffect(effect,computeDependencies=()=>[NaN]){let cleanup,dependencies;onMounted(()=>{dependencies=computeDependencies();cleanup=effect(...dependencies)||NO_OP;});let shouldReapplyOnPatch=false;onWillPatch(()=>{const newDeps=computeDependencies();shouldReapplyOnPatch=newDeps.some((val,i)=>val!==dependencies[i]);if(shouldReapplyOnPatch){cleanup();dependencies=newDeps;}});onPatched(()=>{if(shouldReapplyOnPatch){cleanup=effect(...dependencies)||NO_OP;}});onWillUnmount(()=>cleanup());}
__exports.useListener=useListener;function useListener(eventName,querySelector,handler,options={}){if(typeof arguments[1]!=="string"){querySelector=null;handler=arguments[1];options=arguments[2]||{};}
if(typeof handler!=="function"){throw new Error("The handler must be a function");}
const comp=useComponent();let boundHandler;if(querySelector){boundHandler=function(ev){let el=ev.target;let target;while(el&&!target){if(el.matches(querySelector)){target=el;}else if(el===comp.el){el=null;}else{el=el.parentElement;}}
if(el){handler.call(comp,ev);}};}else{boundHandler=handler.bind(comp);}
useEffect(()=>{comp.el.addEventListener(eventName,boundHandler,options);return()=>{comp.el.removeEventListener(eventName,boundHandler,options);};},()=>[]);}
function _protectMethod(component,caller,fn){return async(...args)=>{if(component.__owl__.status===5){throw new Error("Component is destroyed");}
const result=await fn.call(caller,...args);return component.__owl__.status===5?new Promise(()=>{}):result;};}
__exports.useService=useService;function useService(serviceName){const component=useComponent();const{services}=component.env;if(!(serviceName in services)){throw new Error(`Service ${serviceName} is not available`);}
const service=services[serviceName];if(serviceName in SERVICES_METADATA){if(service instanceof Function){return _protectMethod(component,null,service);}else{const methods=SERVICES_METADATA[serviceName];const result=Object.create(service);for(let method of methods){result[method]=_protectMethod(component,service,service[method]);}
return result;}}
return service;}
__exports.onDestroyed=onDestroyed;function onDestroyed(callback){const component=useComponent();const _destroy=component.__destroy;component.__destroy=(...args)=>{_destroy.call(component,...args);callback();};}
return __exports;});;

/* /web/static/src/core/utils/numbers.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/numbers',async function(require){'use strict';let __exports={};__exports.computeVariation=computeVariation;function computeVariation(value,comparisonValue){if(isNaN(value)||isNaN(comparisonValue)){return NaN;}
if(comparisonValue===0){if(value===0){return 0;}else if(value>0){return 1;}else{return-1;}}
return(value-comparisonValue)/Math.abs(comparisonValue);}
return __exports;});;

/* /web/static/src/core/utils/objects.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/objects',async function(require){'use strict';let __exports={};__exports.shallowEqual=shallowEqual;function shallowEqual(obj1,obj2){const obj1Keys=Object.keys(obj1);return(obj1Keys.length===Object.keys(obj2).length&&obj1Keys.every((key)=>obj1[key]===obj2[key]));}
__exports.deepCopy=deepCopy;function deepCopy(obj){return JSON.parse(JSON.stringify(obj));}
return __exports;});;

/* /web/static/src/core/utils/patch.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/patch',async function(require){'use strict';let __exports={};const patchMap=new WeakMap();__exports.patch=patch;function patch(obj,patchName,patchValue,options={}){const pure=Boolean(options.pure);if(!patchMap.has(obj)){patchMap.set(obj,{original:{},patches:[],});}
const objDesc=patchMap.get(obj);if(objDesc.patches.some((p)=>p.name===patchName)){throw new Error(`Class ${obj.name} already has a patch ${patchName}`);}
objDesc.patches.push({name:patchName,patch:patchValue,pure,});for(const k in patchValue){let prevDesc=null;let proto=obj;do{prevDesc=Object.getOwnPropertyDescriptor(proto,k);proto=Object.getPrototypeOf(proto);}while(!prevDesc&&proto);const newDesc=Object.getOwnPropertyDescriptor(patchValue,k);if(!objDesc.original.hasOwnProperty(k)){objDesc.original[k]=Object.getOwnPropertyDescriptor(obj,k);}
if(prevDesc){const patchedFnName=`${k} (patch ${patchName})`;if(prevDesc.value&&typeof newDesc.value==="function"){makeIntermediateFunction("value",prevDesc,newDesc,patchedFnName);}
if((newDesc.get||newDesc.set)&&(prevDesc.get||prevDesc.set)){newDesc.get=newDesc.get||prevDesc.get;newDesc.set=newDesc.set||prevDesc.set;if(prevDesc.get&&typeof newDesc.get==="function"){makeIntermediateFunction("get",prevDesc,newDesc,patchedFnName);}
if(prevDesc.set&&typeof newDesc.set==="function"){makeIntermediateFunction("set",prevDesc,newDesc,patchedFnName);}}}
Object.defineProperty(obj,k,newDesc);}
function makeIntermediateFunction(key,prevDesc,newDesc,patchedFnName){const _superFn=prevDesc[key];const patchFn=newDesc[key];if(pure){newDesc[key]=patchFn;}else{newDesc[key]={[patchedFnName](...args){let prevSuper;if(this){prevSuper=this._super;Object.defineProperty(this,"_super",{value:_superFn.bind(this),configurable:true,writable:true,});}
const result=patchFn.call(this,...args);if(this){Object.defineProperty(this,"_super",{value:prevSuper,configurable:true,writable:true,});}
return result;},}[patchedFnName];}}}
__exports.unpatch=unpatch;function unpatch(obj,patchName){const objDesc=patchMap.get(obj);if(!objDesc.patches.some((p)=>p.name===patchName)){throw new Error(`Class ${obj.name} does not have any patch ${patchName}`);}
patchMap.delete(obj);for(const k in objDesc.original){if(objDesc.original[k]===undefined){delete obj[k];}else{Object.defineProperty(obj,k,objDesc.original[k]);}}
for(const patchDesc of objDesc.patches){if(patchDesc.name!==patchName){patch(obj,patchDesc.name,patchDesc.patch,{pure:patchDesc.pure});}}}
return __exports;});;

/* /web/static/src/core/utils/scrolling.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/scrolling',async function(require){'use strict';let __exports={};__exports.scrollTo=scrollTo;function scrollTo(element,options={scrollable:null,isAnchor:false}){function _getScrollParent(node){if(node==null){return null;}
if(node.scrollHeight>node.clientHeight&&node.clientHeight>0){return node;}else{return _getScrollParent(node.parentNode);}}
const scrollable=options.scrollable?options.scrollable:_getScrollParent(element.parentNode);if(scrollable){const scrollBottom=scrollable.getBoundingClientRect().bottom;const scrollTop=scrollable.getBoundingClientRect().top;const elementBottom=element.getBoundingClientRect().bottom;const elementTop=element.getBoundingClientRect().top;if(elementBottom>scrollBottom&&!options.isAnchor){scrollable.scrollTop+=elementTop-scrollBottom+element.getBoundingClientRect().height;}else if(elementTop<scrollTop||options.isAnchor){scrollable.scrollTop-=scrollTop-elementTop;if(options.isAnchor){const parentScrollable=_getScrollParent(scrollable.parentNode);if(parentScrollable){scrollTo(scrollable,{isAnchor:true,scrollable:parentScrollable});}}}}}
function getScrollableElement(component){if(component.env.isSmall){return document.firstElementChild;}else{return component.el.querySelector(".o_action_manager .o_content");}}
__exports.getScrollPosition=getScrollPosition;function getScrollPosition(component){const scrollingEl=getScrollableElement(component);return{left:scrollingEl?scrollingEl.scrollLeft:0,top:scrollingEl?scrollingEl.scrollTop:0,};}
__exports.setScrollPosition=setScrollPosition;function setScrollPosition(component,offset){const scrollingEl=getScrollableElement(component);if(scrollingEl){scrollingEl.scrollLeft=offset.left||0;scrollingEl.scrollTop=offset.top||0;}}
return __exports;});;

/* /web/static/src/core/utils/search.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/search',async function(require){'use strict';let __exports={};const{unaccent}=require("@web/core/utils/strings");function match(pattern,str){let totalScore=0;let currentScore=0;let len=str.length;let patternIndex=0;pattern=unaccent(pattern,false);str=unaccent(str,false);for(let i=0;i<len;i++){if(str[i]===pattern[patternIndex]){patternIndex++;currentScore+=100+currentScore-i/200;}else{currentScore=0;}
totalScore=totalScore+currentScore;}
return patternIndex===pattern.length?totalScore:0;}
__exports.fuzzyLookup=fuzzyLookup;function fuzzyLookup(pattern,list,fn){const results=[];list.forEach((data)=>{const score=match(pattern,fn(data));if(score>0){results.push({score,elem:data});}});results.sort((a,b)=>b.score-a.score);return results.map((r)=>r.elem);}
__exports.fuzzyTest=fuzzyTest;function fuzzyTest(pattern,string){return match(pattern,string)!==0;}
return __exports;});;

/* /web/static/src/core/utils/strings.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/strings',async function(require){'use strict';let __exports={};__exports.escapeRegExp=escapeRegExp;function escapeRegExp(str){return str.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");}
__exports.intersperse=intersperse;function intersperse(str,indices,separator=""){separator=separator||"";const result=[];let last=str.length;for(let i=0;i<indices.length;++i){let section=indices[i];if(section===-1||last<=0){break;}else if(section===0&&i===0){break;}else if(section===0){section=indices[--i];}
result.push(str.substring(last-section,last));last-=section;}
const s=str.substring(0,last);if(s){result.push(s);}
return result.reverse().join(separator);}
__exports.sprintf=sprintf;function sprintf(s,...values){if(values.length===1&&Object.prototype.toString.call(values[0])==="[object Object]"){const valuesDict=values[0];s=s.replace(/\%\(?([^\)]+)\)s/g,(match,value)=>valuesDict[value]);}else if(values.length>0){s=s.replace(/\%s/g,()=>values.shift());}
return s;}
__exports.capitalize=capitalize;function capitalize(s){return s?s[0].toUpperCase()+s.slice(1):"";}
const diacriticsMap={'\u0041':'A','\u24B6':'A','\uFF21':'A','\u00C0':'A','\u00C1':'A','\u00C2':'A','\u1EA6':'A','\u1EA4':'A','\u1EAA':'A','\u1EA8':'A','\u00C3':'A','\u0100':'A','\u0102':'A','\u1EB0':'A','\u1EAE':'A','\u1EB4':'A','\u1EB2':'A','\u0226':'A','\u01E0':'A','\u00C4':'A','\u01DE':'A','\u1EA2':'A','\u00C5':'A','\u01FA':'A','\u01CD':'A','\u0200':'A','\u0202':'A','\u1EA0':'A','\u1EAC':'A','\u1EB6':'A','\u1E00':'A','\u0104':'A','\u023A':'A','\u2C6F':'A','\uA732':'AA','\u00C6':'AE','\u01FC':'AE','\u01E2':'AE','\uA734':'AO','\uA736':'AU','\uA738':'AV','\uA73A':'AV','\uA73C':'AY','\u0042':'B','\u24B7':'B','\uFF22':'B','\u1E02':'B','\u1E04':'B','\u1E06':'B','\u0243':'B','\u0182':'B','\u0181':'B','\u0043':'C','\u24B8':'C','\uFF23':'C','\u0106':'C','\u0108':'C','\u010A':'C','\u010C':'C','\u00C7':'C','\u1E08':'C','\u0187':'C','\u023B':'C','\uA73E':'C','\u0044':'D','\u24B9':'D','\uFF24':'D','\u1E0A':'D','\u010E':'D','\u1E0C':'D','\u1E10':'D','\u1E12':'D','\u1E0E':'D','\u0110':'D','\u018B':'D','\u018A':'D','\u0189':'D','\uA779':'D','\u01F1':'DZ','\u01C4':'DZ','\u01F2':'Dz','\u01C5':'Dz','\u0045':'E','\u24BA':'E','\uFF25':'E','\u00C8':'E','\u00C9':'E','\u00CA':'E','\u1EC0':'E','\u1EBE':'E','\u1EC4':'E','\u1EC2':'E','\u1EBC':'E','\u0112':'E','\u1E14':'E','\u1E16':'E','\u0114':'E','\u0116':'E','\u00CB':'E','\u1EBA':'E','\u011A':'E','\u0204':'E','\u0206':'E','\u1EB8':'E','\u1EC6':'E','\u0228':'E','\u1E1C':'E','\u0118':'E','\u1E18':'E','\u1E1A':'E','\u0190':'E','\u018E':'E','\u0046':'F','\u24BB':'F','\uFF26':'F','\u1E1E':'F','\u0191':'F','\uA77B':'F','\u0047':'G','\u24BC':'G','\uFF27':'G','\u01F4':'G','\u011C':'G','\u1E20':'G','\u011E':'G','\u0120':'G','\u01E6':'G','\u0122':'G','\u01E4':'G','\u0193':'G','\uA7A0':'G','\uA77D':'G','\uA77E':'G','\u0048':'H','\u24BD':'H','\uFF28':'H','\u0124':'H','\u1E22':'H','\u1E26':'H','\u021E':'H','\u1E24':'H','\u1E28':'H','\u1E2A':'H','\u0126':'H','\u2C67':'H','\u2C75':'H','\uA78D':'H','\u0049':'I','\u24BE':'I','\uFF29':'I','\u00CC':'I','\u00CD':'I','\u00CE':'I','\u0128':'I','\u012A':'I','\u012C':'I','\u0130':'I','\u00CF':'I','\u1E2E':'I','\u1EC8':'I','\u01CF':'I','\u0208':'I','\u020A':'I','\u1ECA':'I','\u012E':'I','\u1E2C':'I','\u0197':'I','\u004A':'J','\u24BF':'J','\uFF2A':'J','\u0134':'J','\u0248':'J','\u004B':'K','\u24C0':'K','\uFF2B':'K','\u1E30':'K','\u01E8':'K','\u1E32':'K','\u0136':'K','\u1E34':'K','\u0198':'K','\u2C69':'K','\uA740':'K','\uA742':'K','\uA744':'K','\uA7A2':'K','\u004C':'L','\u24C1':'L','\uFF2C':'L','\u013F':'L','\u0139':'L','\u013D':'L','\u1E36':'L','\u1E38':'L','\u013B':'L','\u1E3C':'L','\u1E3A':'L','\u0141':'L','\u023D':'L','\u2C62':'L','\u2C60':'L','\uA748':'L','\uA746':'L','\uA780':'L','\u01C7':'LJ','\u01C8':'Lj','\u004D':'M','\u24C2':'M','\uFF2D':'M','\u1E3E':'M','\u1E40':'M','\u1E42':'M','\u2C6E':'M','\u019C':'M','\u004E':'N','\u24C3':'N','\uFF2E':'N','\u01F8':'N','\u0143':'N','\u00D1':'N','\u1E44':'N','\u0147':'N','\u1E46':'N','\u0145':'N','\u1E4A':'N','\u1E48':'N','\u0220':'N','\u019D':'N','\uA790':'N','\uA7A4':'N','\u01CA':'NJ','\u01CB':'Nj','\u004F':'O','\u24C4':'O','\uFF2F':'O','\u00D2':'O','\u00D3':'O','\u00D4':'O','\u1ED2':'O','\u1ED0':'O','\u1ED6':'O','\u1ED4':'O','\u00D5':'O','\u1E4C':'O','\u022C':'O','\u1E4E':'O','\u014C':'O','\u1E50':'O','\u1E52':'O','\u014E':'O','\u022E':'O','\u0230':'O','\u00D6':'O','\u022A':'O','\u1ECE':'O','\u0150':'O','\u01D1':'O','\u020C':'O','\u020E':'O','\u01A0':'O','\u1EDC':'O','\u1EDA':'O','\u1EE0':'O','\u1EDE':'O','\u1EE2':'O','\u1ECC':'O','\u1ED8':'O','\u01EA':'O','\u01EC':'O','\u00D8':'O','\u01FE':'O','\u0186':'O','\u019F':'O','\uA74A':'O','\uA74C':'O','\u01A2':'OI','\uA74E':'OO','\u0222':'OU','\u0050':'P','\u24C5':'P','\uFF30':'P','\u1E54':'P','\u1E56':'P','\u01A4':'P','\u2C63':'P','\uA750':'P','\uA752':'P','\uA754':'P','\u0051':'Q','\u24C6':'Q','\uFF31':'Q','\uA756':'Q','\uA758':'Q','\u024A':'Q','\u0052':'R','\u24C7':'R','\uFF32':'R','\u0154':'R','\u1E58':'R','\u0158':'R','\u0210':'R','\u0212':'R','\u1E5A':'R','\u1E5C':'R','\u0156':'R','\u1E5E':'R','\u024C':'R','\u2C64':'R','\uA75A':'R','\uA7A6':'R','\uA782':'R','\u0053':'S','\u24C8':'S','\uFF33':'S','\u1E9E':'S','\u015A':'S','\u1E64':'S','\u015C':'S','\u1E60':'S','\u0160':'S','\u1E66':'S','\u1E62':'S','\u1E68':'S','\u0218':'S','\u015E':'S','\u2C7E':'S','\uA7A8':'S','\uA784':'S','\u0054':'T','\u24C9':'T','\uFF34':'T','\u1E6A':'T','\u0164':'T','\u1E6C':'T','\u021A':'T','\u0162':'T','\u1E70':'T','\u1E6E':'T','\u0166':'T','\u01AC':'T','\u01AE':'T','\u023E':'T','\uA786':'T','\uA728':'TZ','\u0055':'U','\u24CA':'U','\uFF35':'U','\u00D9':'U','\u00DA':'U','\u00DB':'U','\u0168':'U','\u1E78':'U','\u016A':'U','\u1E7A':'U','\u016C':'U','\u00DC':'U','\u01DB':'U','\u01D7':'U','\u01D5':'U','\u01D9':'U','\u1EE6':'U','\u016E':'U','\u0170':'U','\u01D3':'U','\u0214':'U','\u0216':'U','\u01AF':'U','\u1EEA':'U','\u1EE8':'U','\u1EEE':'U','\u1EEC':'U','\u1EF0':'U','\u1EE4':'U','\u1E72':'U','\u0172':'U','\u1E76':'U','\u1E74':'U','\u0244':'U','\u0056':'V','\u24CB':'V','\uFF36':'V','\u1E7C':'V','\u1E7E':'V','\u01B2':'V','\uA75E':'V','\u0245':'V','\uA760':'VY','\u0057':'W','\u24CC':'W','\uFF37':'W','\u1E80':'W','\u1E82':'W','\u0174':'W','\u1E86':'W','\u1E84':'W','\u1E88':'W','\u2C72':'W','\u0058':'X','\u24CD':'X','\uFF38':'X','\u1E8A':'X','\u1E8C':'X','\u0059':'Y','\u24CE':'Y','\uFF39':'Y','\u1EF2':'Y','\u00DD':'Y','\u0176':'Y','\u1EF8':'Y','\u0232':'Y','\u1E8E':'Y','\u0178':'Y','\u1EF6':'Y','\u1EF4':'Y','\u01B3':'Y','\u024E':'Y','\u1EFE':'Y','\u005A':'Z','\u24CF':'Z','\uFF3A':'Z','\u0179':'Z','\u1E90':'Z','\u017B':'Z','\u017D':'Z','\u1E92':'Z','\u1E94':'Z','\u01B5':'Z','\u0224':'Z','\u2C7F':'Z','\u2C6B':'Z','\uA762':'Z','\u0061':'a','\u24D0':'a','\uFF41':'a','\u1E9A':'a','\u00E0':'a','\u00E1':'a','\u00E2':'a','\u1EA7':'a','\u1EA5':'a','\u1EAB':'a','\u1EA9':'a','\u00E3':'a','\u0101':'a','\u0103':'a','\u1EB1':'a','\u1EAF':'a','\u1EB5':'a','\u1EB3':'a','\u0227':'a','\u01E1':'a','\u00E4':'a','\u01DF':'a','\u1EA3':'a','\u00E5':'a','\u01FB':'a','\u01CE':'a','\u0201':'a','\u0203':'a','\u1EA1':'a','\u1EAD':'a','\u1EB7':'a','\u1E01':'a','\u0105':'a','\u2C65':'a','\u0250':'a','\uA733':'aa','\u00E6':'ae','\u01FD':'ae','\u01E3':'ae','\uA735':'ao','\uA737':'au','\uA739':'av','\uA73B':'av','\uA73D':'ay','\u0062':'b','\u24D1':'b','\uFF42':'b','\u1E03':'b','\u1E05':'b','\u1E07':'b','\u0180':'b','\u0183':'b','\u0253':'b','\u0063':'c','\u24D2':'c','\uFF43':'c','\u0107':'c','\u0109':'c','\u010B':'c','\u010D':'c','\u00E7':'c','\u1E09':'c','\u0188':'c','\u023C':'c','\uA73F':'c','\u2184':'c','\u0064':'d','\u24D3':'d','\uFF44':'d','\u1E0B':'d','\u010F':'d','\u1E0D':'d','\u1E11':'d','\u1E13':'d','\u1E0F':'d','\u0111':'d','\u018C':'d','\u0256':'d','\u0257':'d','\uA77A':'d','\u01F3':'dz','\u01C6':'dz','\u0065':'e','\u24D4':'e','\uFF45':'e','\u00E8':'e','\u00E9':'e','\u00EA':'e','\u1EC1':'e','\u1EBF':'e','\u1EC5':'e','\u1EC3':'e','\u1EBD':'e','\u0113':'e','\u1E15':'e','\u1E17':'e','\u0115':'e','\u0117':'e','\u00EB':'e','\u1EBB':'e','\u011B':'e','\u0205':'e','\u0207':'e','\u1EB9':'e','\u1EC7':'e','\u0229':'e','\u1E1D':'e','\u0119':'e','\u1E19':'e','\u1E1B':'e','\u0247':'e','\u025B':'e','\u01DD':'e','\u0066':'f','\u24D5':'f','\uFF46':'f','\u1E1F':'f','\u0192':'f','\uA77C':'f','\u0067':'g','\u24D6':'g','\uFF47':'g','\u01F5':'g','\u011D':'g','\u1E21':'g','\u011F':'g','\u0121':'g','\u01E7':'g','\u0123':'g','\u01E5':'g','\u0260':'g','\uA7A1':'g','\u1D79':'g','\uA77F':'g','\u0068':'h','\u24D7':'h','\uFF48':'h','\u0125':'h','\u1E23':'h','\u1E27':'h','\u021F':'h','\u1E25':'h','\u1E29':'h','\u1E2B':'h','\u1E96':'h','\u0127':'h','\u2C68':'h','\u2C76':'h','\u0265':'h','\u0195':'hv','\u0069':'i','\u24D8':'i','\uFF49':'i','\u00EC':'i','\u00ED':'i','\u00EE':'i','\u0129':'i','\u012B':'i','\u012D':'i','\u00EF':'i','\u1E2F':'i','\u1EC9':'i','\u01D0':'i','\u0209':'i','\u020B':'i','\u1ECB':'i','\u012F':'i','\u1E2D':'i','\u0268':'i','\u0131':'i','\u006A':'j','\u24D9':'j','\uFF4A':'j','\u0135':'j','\u01F0':'j','\u0249':'j','\u006B':'k','\u24DA':'k','\uFF4B':'k','\u1E31':'k','\u01E9':'k','\u1E33':'k','\u0137':'k','\u1E35':'k','\u0199':'k','\u2C6A':'k','\uA741':'k','\uA743':'k','\uA745':'k','\uA7A3':'k','\u006C':'l','\u24DB':'l','\uFF4C':'l','\u0140':'l','\u013A':'l','\u013E':'l','\u1E37':'l','\u1E39':'l','\u013C':'l','\u1E3D':'l','\u1E3B':'l','\u017F':'l','\u0142':'l','\u019A':'l','\u026B':'l','\u2C61':'l','\uA749':'l','\uA781':'l','\uA747':'l','\u01C9':'lj','\u006D':'m','\u24DC':'m','\uFF4D':'m','\u1E3F':'m','\u1E41':'m','\u1E43':'m','\u0271':'m','\u026F':'m','\u006E':'n','\u24DD':'n','\uFF4E':'n','\u01F9':'n','\u0144':'n','\u00F1':'n','\u1E45':'n','\u0148':'n','\u1E47':'n','\u0146':'n','\u1E4B':'n','\u1E49':'n','\u019E':'n','\u0272':'n','\u0149':'n','\uA791':'n','\uA7A5':'n','\u01CC':'nj','\u006F':'o','\u24DE':'o','\uFF4F':'o','\u00F2':'o','\u00F3':'o','\u00F4':'o','\u1ED3':'o','\u1ED1':'o','\u1ED7':'o','\u1ED5':'o','\u00F5':'o','\u1E4D':'o','\u022D':'o','\u1E4F':'o','\u014D':'o','\u1E51':'o','\u1E53':'o','\u014F':'o','\u022F':'o','\u0231':'o','\u00F6':'o','\u022B':'o','\u1ECF':'o','\u0151':'o','\u01D2':'o','\u020D':'o','\u020F':'o','\u01A1':'o','\u1EDD':'o','\u1EDB':'o','\u1EE1':'o','\u1EDF':'o','\u1EE3':'o','\u1ECD':'o','\u1ED9':'o','\u01EB':'o','\u01ED':'o','\u00F8':'o','\u01FF':'o','\u0254':'o','\uA74B':'o','\uA74D':'o','\u0275':'o','\u01A3':'oi','\u0223':'ou','\uA74F':'oo','\u0070':'p','\u24DF':'p','\uFF50':'p','\u1E55':'p','\u1E57':'p','\u01A5':'p','\u1D7D':'p','\uA751':'p','\uA753':'p','\uA755':'p','\u0071':'q','\u24E0':'q','\uFF51':'q','\u024B':'q','\uA757':'q','\uA759':'q','\u0072':'r','\u24E1':'r','\uFF52':'r','\u0155':'r','\u1E59':'r','\u0159':'r','\u0211':'r','\u0213':'r','\u1E5B':'r','\u1E5D':'r','\u0157':'r','\u1E5F':'r','\u024D':'r','\u027D':'r','\uA75B':'r','\uA7A7':'r','\uA783':'r','\u0073':'s','\u24E2':'s','\uFF53':'s','\u00DF':'s','\u015B':'s','\u1E65':'s','\u015D':'s','\u1E61':'s','\u0161':'s','\u1E67':'s','\u1E63':'s','\u1E69':'s','\u0219':'s','\u015F':'s','\u023F':'s','\uA7A9':'s','\uA785':'s','\u1E9B':'s','\u0074':'t','\u24E3':'t','\uFF54':'t','\u1E6B':'t','\u1E97':'t','\u0165':'t','\u1E6D':'t','\u021B':'t','\u0163':'t','\u1E71':'t','\u1E6F':'t','\u0167':'t','\u01AD':'t','\u0288':'t','\u2C66':'t','\uA787':'t','\uA729':'tz','\u0075':'u','\u24E4':'u','\uFF55':'u','\u00F9':'u','\u00FA':'u','\u00FB':'u','\u0169':'u','\u1E79':'u','\u016B':'u','\u1E7B':'u','\u016D':'u','\u00FC':'u','\u01DC':'u','\u01D8':'u','\u01D6':'u','\u01DA':'u','\u1EE7':'u','\u016F':'u','\u0171':'u','\u01D4':'u','\u0215':'u','\u0217':'u','\u01B0':'u','\u1EEB':'u','\u1EE9':'u','\u1EEF':'u','\u1EED':'u','\u1EF1':'u','\u1EE5':'u','\u1E73':'u','\u0173':'u','\u1E77':'u','\u1E75':'u','\u0289':'u','\u0076':'v','\u24E5':'v','\uFF56':'v','\u1E7D':'v','\u1E7F':'v','\u028B':'v','\uA75F':'v','\u028C':'v','\uA761':'vy','\u0077':'w','\u24E6':'w','\uFF57':'w','\u1E81':'w','\u1E83':'w','\u0175':'w','\u1E87':'w','\u1E85':'w','\u1E98':'w','\u1E89':'w','\u2C73':'w','\u0078':'x','\u24E7':'x','\uFF58':'x','\u1E8B':'x','\u1E8D':'x','\u0079':'y','\u24E8':'y','\uFF59':'y','\u1EF3':'y','\u00FD':'y','\u0177':'y','\u1EF9':'y','\u0233':'y','\u1E8F':'y','\u00FF':'y','\u1EF7':'y','\u1E99':'y','\u1EF5':'y','\u01B4':'y','\u024F':'y','\u1EFF':'y','\u007A':'z','\u24E9':'z','\uFF5A':'z','\u017A':'z','\u1E91':'z','\u017C':'z','\u017E':'z','\u1E93':'z','\u1E95':'z','\u01B6':'z','\u0225':'z','\u0240':'z','\u2C6C':'z','\uA763':'z',};__exports.unaccent=unaccent;function unaccent(str,caseSensitive){str=str.replace(/[^\u0000-\u007E]/g,function(accented){return diacriticsMap[accented]||accented;});return caseSensitive?str:str.toLowerCase();}
return __exports;});;

/* /web/static/src/core/utils/timing.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/timing',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");__exports.throttleForAnimation=throttleForAnimation;function throttleForAnimation(func){let handle=null;const funcName=func.name?`${func.name} (throttleForAnimation)`:"throttleForAnimation";return Object.assign({[funcName](...args){browser.cancelAnimationFrame(handle);handle=browser.requestAnimationFrame(()=>{handle=null;func.call(this,...args);});},}[funcName],{cancel(){browser.cancelAnimationFrame(handle);},});}
__exports.debounce=debounce;function debounce(func,wait,immediate=false){let cancelled;let timeout;const funcName=func.name?func.name+" (debounce)":"debounce";return Object.assign({[funcName](...args){const context=this;let resolve;const prom=new Promise((r)=>{resolve=r;});function later(){if(!immediate&&!cancelled){Promise.resolve(func.apply(context,args)).then(resolve);}}
const callNow=immediate&&!timeout&&!cancelled;browser.clearTimeout(timeout);timeout=browser.setTimeout(later,wait);if(callNow){Promise.resolve(func.apply(context,args)).then(resolve);}
return prom;},}[funcName],{cancel(){cancelled=true;browser.clearTimeout(timeout);},});}
__exports.throttle=throttle;function throttle(func,wait){let waiting=false;const funcName=func.name?func.name+" (throttle)":"throttle";return{[funcName](...args){const context=this;if(!waiting){waiting=true;browser.setTimeout(function(){waiting=false;func.call(context,...args);},wait);}},}[funcName];}
return __exports;});;

/* /web/static/src/core/utils/ui.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/ui',async function(require){'use strict';let __exports={};__exports.getVisibleElements=getVisibleElements;function getVisibleElements(activeElement,selector){const visibleElements=[];for(const el of activeElement.querySelectorAll(selector)){const isVisible=el.offsetWidth>0&&el.offsetHeight>0;if(isVisible){visibleElements.push(el);}}
return visibleElements;}
return __exports;});;

/* /web/static/src/core/utils/urls.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/urls',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");__exports.objectToUrlEncodedString=objectToUrlEncodedString;function objectToUrlEncodedString(obj){return Object.entries(obj).map(([k,v])=>(v?`${k}=${encodeURIComponent(v)}`:k)).join("&");}
__exports.getOrigin=getOrigin;function getOrigin(origin){if(origin){origin=origin.replace(/\/+$/,"");}else{const{host,protocol}=browser.location;origin=`${protocol}//${host}`;}
return origin;}
__exports.url=url;function url(route,queryParams,options={}){const origin=getOrigin(options.origin);if(!route){return origin;}
let queryString=objectToUrlEncodedString(queryParams||{});queryString=queryString.length>0?`?${queryString}`:queryString;let prefix=["http://","https://","//"].some((el)=>route.length>=el.length&&route.slice(0,el.length)===el);prefix=prefix?"":origin;return`${prefix}${route}${queryString}`;}
return __exports;});;

/* /web/static/src/core/utils/xml.js defined in bundle 'web.assets_backend' */
odoo.define('@web/core/utils/xml',async function(require){'use strict';let __exports={};function hasParsingError(parsedDocument){return parsedDocument.getElementsByTagName("parsererror").length>0;}
const XMLParser=__exports.XMLParser=class XMLParser{parse(){}
visitXML(xml,callback){function visit(xml){if(xml){let didVisitChildren=false;const visitChildren=()=>{for(let child of xml.children){visit(child);}
didVisitChildren=true;};const shouldVisitChildren=callback(xml,visitChildren);if(shouldVisitChildren!==false&&!didVisitChildren){visitChildren();}}}
const xmlDoc=typeof xml==="string"?this.parseXML(xml):xml;visit(xmlDoc);}
parseXML(arch){const parser=new DOMParser();const xml=parser.parseFromString(arch,"text/xml");if(hasParsingError(xml)){throw new Error(`An error occured while parsing ${arch}: ${xml.getElementsByTagName("parsererror")}`);}
return xml.documentElement;}}
return __exports;});;

/* /web/static/src/fields/fields.js defined in bundle 'web.assets_backend' */
odoo.define('@web/fields/fields',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const legacyFieldRegistry=require("web.field_registry");const owlFieldRegistry=require("web.field_registry_owl");const{ComponentAdapter}=require("web.OwlCompatibility");const{useEffect}=require("@web/core/utils/hooks");const{Component,tags,hooks}=owl;const fieldRegistry=registry.category("fields");function getFieldFromRegistry(registry,{fieldType,viewType,fieldName,fieldsDescription}){if(viewType&&fieldType){const specificType=`${viewType}.${fieldType}`;if(registry.contains(specificType)){return registry.get(specificType);}}
if(!registry.contains(fieldType)){const field=fieldsDescription[fieldName];fieldType=field&&field.type;}
return registry.get(fieldType,null);}
class Field extends Component{static getTangibleField({record,type,name}){const FieldClass=getFieldFromRegistry(fieldRegistry,{fieldName:name,fieldType:type,viewType:record.viewtype,fieldsDescription:record.fields,});return{FieldClass};}
setup(){const{record,type,name}=this.props;this.fieldRef=hooks.useRef("fieldRef");this.FieldComponent=Field.getTangibleField({record,type,name}).FieldClass;}}
Field.template=tags.xml`
    <t t-component="FieldComponent" t-props="props" class="o-field" t-key="props.record.id" t-ref="fieldRef"/>
`;class FieldSupportsLegacy extends Field{static getTangibleField({record,type,fieldName}){let{FieldClass}=super.getTangibleField(...arguments);if(!FieldClass){FieldClass=getFieldFromRegistry(owlFieldRegistry,{fieldName,fieldType:type,viewType:record.viewType,fieldsDescription:record.fields,});if(FieldClass){return{FieldClass,isOwlLegacy:true};}else{FieldClass=getFieldFromRegistry(legacyFieldRegistry,{fieldName,fieldType:type,viewType:record.viewType,fieldsDescription:record.fields,});return{FieldClass,isLegacy:true};}}
return{};}
setup(){super.setup();this.renderId=0;useEffect(()=>{this.renderId++;});if(!this.FieldComponent){this.env=owl.Component.env;const{record,type,name}=this.props;const{FieldClass,isOwlLegacy,isLegacy}=FieldSupportsLegacy.getTangibleField({record,type,name,});this.FieldComponent=FieldClass;this.isOwlLegacy=isOwlLegacy;this.isLegacy=isLegacy;}}
get legacyProps(){const legacyRecord=Object.assign({},this.props.model._legacyRecord_);legacyRecord.data=Object.assign({},legacyRecord.data,this.props.record.data);return{fieldName:this.props.name,record:legacyRecord,};}
get widgetArgs(){const{fieldName,record}=this.legacyProps;return[fieldName,record];}}
FieldSupportsLegacy.template=tags.xml`<t>
    <t t-if="!isOwlLegacy and !isLegacy" t-call="${Field.template}" />
    <t t-elif="isOwlLegacy" t-component="FieldComponent" t-props="legacyProps" />
    <t t-elif="isLegacy" t-component="ComponentAdapter" widgetArgs="widgetArgs" Component="FieldComponent" t-key="renderId" />
</t>
`;FieldSupportsLegacy.components={ComponentAdapter};Object.assign(__exports,{Field:FieldSupportsLegacy});return __exports;});;

/* /web/static/src/fields/formatters.js defined in bundle 'web.assets_backend' */
odoo.define('@web/fields/formatters',async function(require){'use strict';let __exports={};const{formatDate,formatDateTime}=require("@web/core/l10n/dates");const{localization:l10n}=require("@web/core/l10n/localization");const{_lt}=require("@web/core/l10n/translation");const{registry}=require("@web/core/registry");const{intersperse}=require("@web/core/utils/strings");const{session}=require("@web/session");function insertThousandsSep(number,thousandsSep=",",grouping=[3,0]){const negative=number[0]==="-";number=negative?number.slice(1):number;return(negative?"-":"")+intersperse(number,grouping,thousandsSep);}
function humanNumber(number,options={decimals:0,minDigits:1}){const decimals=options.decimals||0;const minDigits=options.minDigits||1;const d2=Math.pow(10,decimals);const numberMagnitude=+number.toExponential().split("e+")[1];number=Math.round(number*d2)/d2;if(numberMagnitude>=21){number=Math.round(number*Math.pow(10,decimals-numberMagnitude))/d2;return`${number}e+${numberMagnitude}`;}
const unitSymbols=_lt("kMGTPE").toString();const sign=Math.sign(number);number=Math.abs(number);let symbol="";for(let i=unitSymbols.length;i>0;i--){const s=Math.pow(10,i*3);if(s<=number/Math.pow(10,minDigits-1)){number=Math.round((number*d2)/s)/d2;symbol=unitSymbols[i-1];break;}}
const{decimalPoint,grouping,thousandsSep}=l10n;const decimalsToKeep=number>=1000?0:decimals;number=sign*number;const[integerPart,decimalPart]=number.toFixed(decimalsToKeep).split(".");const int=insertThousandsSep(integerPart,thousandsSep,grouping);if(!decimalPart){return int+symbol;}
return int+decimalPoint+decimalPart+symbol;}
__exports.formatFloat=formatFloat;function formatFloat(value,options={}){if(value===false){return"";}
if(options.humanReadable){return humanNumber(value,options);}
const grouping=options.grouping||l10n.grouping;const thousandsSep="thousandsSep"in options?options.thousandsSep:l10n.thousandsSep;const decimalPoint="decimalPoint"in options?options.decimalPoint:l10n.decimalPoint;let precision;if(options.digits){precision=options.digits[1];}else if(options.field&&options.field.digits){precision=options.field.digits[1];}else{precision=2;}
const formatted=(value||0).toFixed(precision||2).split(".");formatted[0]=insertThousandsSep(formatted[0],thousandsSep,grouping);if(options.noTrailingZeros){formatted[1]=formatted[1].replace(/0+$/,"");}
return formatted[1].length?formatted.join(decimalPoint):formatted[0];}
__exports.formatFloatFactor=formatFloatFactor;function formatFloatFactor(value,options={}){if(value===false){return"";}
const factor=options.factor||1;return formatFloat(value*factor,options);}
__exports.formatFloatTime=formatFloatTime;function formatFloatTime(value,options={}){if(value===false){return"";}
const isNegative=value<0;if(isNegative){value=Math.abs(value);}
let hour=Math.floor(value);let min=Math.round((value%1)*60);if(min===60){min=0;hour=hour+1;}
min=`${min}`.padStart(2,"0");if(!options.noLeadingZeroHour){hour=`${hour}`.padStart(2,"0");}
return`${isNegative ? "-" : ""}${hour}:${min}`;}
__exports.formatInteger=formatInteger;function formatInteger(value,options={}){if(value===false){return"";}
if(options.isPassword){return new Array(value.length+1).join("*");}
if(options.humanReadable){return humanNumber(value,options);}
const grouping=options.grouping||l10n.grouping;const thousandsSep="thousandsSep"in options?options.thousandsSep:l10n.thousandsSep;return insertThousandsSep(value.toFixed(0),thousandsSep,grouping);}
__exports.formatMany2one=formatMany2one;function formatMany2one(value,options){if(!value){value="";}else if(Array.isArray(value)){value=value[1];}else{while(value.data){value=value.data.display_name||"";}}
if(options&&options.escape){value=encodeURIComponent(value);}
return value;}
__exports.formatMonetary=formatMonetary;function formatMonetary(value,options={}){let currencyId=options.currencyId;if(!currencyId&&options.data){const currencyField=options.currencyField||(options.field&&options.field.currency_field)||"currency_id";currencyId=options.data[currencyField]&&options.data[currencyField].res_id;}
const currency=session.currencies[currencyId];const digits=(currency&&currency.digits)||options.digits;let formatted;if(options.humanReadable){formatted=humanNumber(value,{decimals:digits?digits[1]:2});}else{formatted=formatFloat(value,{digits});}
if(!currency||options.noSymbol){return formatted;}
if(currency.position==="after"){return`${formatted} ${currency.symbol}`;}else{return`${currency.symbol} ${formatted}`;}}
__exports.formatPercentage=formatPercentage;function formatPercentage(value,options={}){value=value||0;options=Object.assign({noTrailingZeros:true,thousandsSep:""},options);const formatted=formatFloat(value*100,options);return`${formatted}${options.noSymbol ? "" : "%"}`;}
registry.category("formatters").add("date",formatDate).add("datetime",formatDateTime).add("float",formatFloat).add("float_factor",formatFloatFactor).add("float_time",formatFloatTime).add("integer",formatInteger).add("many2one",formatMany2one).add("monetary",formatMonetary).add("percentage",formatPercentage);return __exports;});;

/* /web/static/src/fields/parsers.js defined in bundle 'web.assets_backend' */
odoo.define('@web/fields/parsers',async function(require){'use strict';let __exports={};const{parseDate,parseDateTime}=require("@web/core/l10n/dates");const{localization}=require("@web/core/l10n/localization");const{registry}=require("@web/core/registry");const{escapeRegExp}=require("@web/core/utils/strings");const{session}=require("@web/session");function parseNumber(value,options={}){value=value.replaceAll(options.thousandsSep||",","");value=value.replace(options.decimalPoint||".",".");return Number(value);}
const InvalidNumberError=__exports.InvalidNumberError=class InvalidNumberError extends Error{}
__exports.parseFloat=parseFloat;function parseFloat(value){const thousandsSepRegex=new RegExp(escapeRegExp(localization.thousandsSep),"g");const decimalPointRegex=new RegExp(escapeRegExp(localization.decimalPoint),"g");const parsed=parseNumber(value,{thousandsSep:thousandsSepRegex,decimalPoint:decimalPointRegex,});if(isNaN(parsed)){throw new InvalidNumberError(`"${value}" is not a correct number`);}
return parsed;}
__exports.parseFloatTime=parseFloatTime;function parseFloatTime(value){let sign=1;if(value[0]==="-"){value=value.slice(1);sign=-1;}
const values=value.split(":");if(values.length>2){throw new InvalidNumberError(`"${value}" is not a correct number`);}
if(values.length===1){return sign*parseFloat(value);}
const hours=parseInteger(values[0]);const minutes=parseInteger(values[1]);return sign*(hours+minutes/60);}
__exports.parseInteger=parseInteger;function parseInteger(value){const thousandsSepRegex=new RegExp(escapeRegExp(localization.thousandsSep),"g");const decimalPointRegex=new RegExp(escapeRegExp(localization.decimalPoint),"g");const parsed=parseNumber(value,{thousandsSep:thousandsSepRegex,decimalPoint:decimalPointRegex,});if(!Number.isInteger(parsed)){throw new InvalidNumberError(`"${value}" is not a correct number`);}
return parsed;}
__exports.parsePercentage=parsePercentage;function parsePercentage(value){if(value[value.length-1]==="%"){value=value.slice(0,value.length-1);}
return parseFloat(value)/100;}
__exports.parseMonetary=parseMonetary;function parseMonetary(value,options={}){const values=value.split("&nbsp;");if(values.length===1){return parseFloat(value);}
let currency;if(options.currencyId){currency=session.currencies[options.currencyId];}else{currency=Object.values(session.currencies)[0];}
const symbolIndex=values.findIndex((v)=>v===currency.symbol);if(symbolIndex===-1){throw new InvalidNumberError(`"${value}" is not a correct number`);}
values.splice(symbolIndex,1);if(values.length!==1){throw new InvalidNumberError(`"${value}" is not a correct number`);}
return parseFloat(values[0]);}
registry.category("parsers").add("date",parseDate).add("datetime",parseDateTime).add("float",parseFloat).add("float_time",parseFloatTime).add("integer",parseInteger).add("monetary",parseMonetary).add("percentage",parsePercentage);return __exports;});;

/* /web/static/src/search/comparison_menu/comparison_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/comparison_menu/comparison_menu',async function(require){'use strict';let __exports={};const{FACET_ICONS}=require("@web/search/utils/misc");const{useBus}=require("@web/core/utils/hooks");const{Component}=owl;const ComparisonMenu=__exports.ComparisonMenu=class ComparisonMenu extends Component{setup(){this.icon=FACET_ICONS.comparison;useBus(this.env.searchModel,"update",this.render);}
get items(){return this.env.searchModel.getSearchItems((searchItem)=>searchItem.type==="comparison");}
onComparisonSelected(ev){const{itemId}=ev.detail.payload;this.env.searchModel.toggleSearchItem(itemId);}}
ComparisonMenu.template="web.ComparisonMenu";return __exports;});;

/* /web/static/src/search/control_panel/control_panel.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/control_panel/control_panel',async function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{ComparisonMenu}=require("@web/search/comparison_menu/comparison_menu");const{FavoriteMenu}=require("@web/search/favorite_menu/favorite_menu");const{FilterMenu}=require("@web/search/filter_menu/filter_menu");const{GroupByMenu}=require("@web/search/group_by_menu/group_by_menu");const{SearchBar}=require("@web/search/search_bar/search_bar");const{Component}=owl;const MAPPING={filter:FilterMenu,groupBy:GroupByMenu,comparison:ComparisonMenu,favorite:FavoriteMenu,};const ControlPanel=__exports.ControlPanel=class ControlPanel extends Component{setup(){this.actionService=useService("action");}
__render(){const{slots}=this.env.qweb.constructor;const{__owl__}=this;const originalSlots={};const transferredSlotNames=["control-panel-top-left","control-panel-top-right","control-panel-bottom-left","control-panel-bottom-right",];for(const slotName of transferredSlotNames){const parentSlotkey=`${__owl__.parent.__owl__.slotId}_${slotName}`;if(parentSlotkey in slots){const cpSlotKey=`${__owl__.slotId}_${slotName}`;originalSlots[cpSlotKey]=slots[cpSlotKey];slots[cpSlotKey]=function(scope,extra){slots[parentSlotkey].call(this,__owl__.parent.__owl__.scope,extra);};}}
const res=super.__render(...arguments);Object.assign(slots,originalSlots);return res;}
get display(){const display=Object.assign({"top-left":true,"top-right":true,"bottom-left":true,"bottom-right":true,},this.props.display||this.env.searchModel.display.controlPanel);display.top=display["top-left"]||display["top-right"];display.bottom=display["bottom-left"]||display["bottom-right"];return display;}
get searchMenus(){const searchMenus=[];for(const key of this.env.searchModel.searchMenuTypes){if(key==="comparison"&&this.env.searchModel.getSearchItems((i)=>i.type==="comparison").length===0){continue;}
searchMenus.push({Component:MAPPING[key],key});}
return searchMenus;}
onBreadcrumbClicked(jsId){this.actionService.restore(jsId);}
onViewClicked(viewType){this.actionService.switchView(viewType);}}
ControlPanel.components={ComparisonMenu,FavoriteMenu,FilterMenu,GroupByMenu,SearchBar};ControlPanel.template="web.ControlPanel";return __exports;});;

/* /web/static/src/search/favorite_menu/custom_favorite_item.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/favorite_menu/custom_favorite_item',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useAutofocus,useService}=require("@web/core/utils/hooks");const{Component,hooks}=owl;const{useRef,useState}=hooks;const favoriteMenuRegistry=registry.category("favoriteMenu");const CustomFavoriteItem=__exports.CustomFavoriteItem=class CustomFavoriteItem extends Component{setup(){this.notificationService=useService("notification");this.descriptionRef=useRef("description");useAutofocus();this.state=useState({description:this.env.config.displayName||"",isDefault:false,isShared:false,});}
saveFavorite(ev){if(!this.state.description.length){this.notificationService.add(this.env._t("A name for your favorite filter is required."),{type:"danger"});ev.stopPropagation();return this.descriptionRef.el.focus();}
const favorites=this.env.searchModel.getSearchItems((s)=>s.type==="favorite"&&s.description===this.state.description);if(favorites.length){this.notificationService.add(this.env._t("A filter with same name already exists."),{type:"danger",});ev.stopPropagation();return this.descriptionRef.el.focus();}
const{description,isDefault,isShared}=this.state;this.env.searchModel.createNewFavorite({description,isDefault,isShared});Object.assign(this.state,{description:this.env.config.displayName||"",isDefault:false,isShared:false,});}
onDefaultCheckboxChange(ev){const{checked}=ev.target;this.state.isDefault=checked;if(checked){this.state.isShared=false;}}
onShareCheckboxChange(ev){const{checked}=ev.target;this.state.isShared=checked;if(checked){this.state.isDefault=false;}}
onInputKeydown(ev){switch(ev.key){case"Enter":ev.preventDefault();this.saveFavorite();break;case"Escape":ev.preventDefault();ev.target.blur();break;}}}
CustomFavoriteItem.template="web.CustomFavoriteItem";favoriteMenuRegistry.add("custom-favorite-item",{Component:CustomFavoriteItem,groupNumber:3},{sequence:0});return __exports;});;

/* /web/static/src/search/favorite_menu/favorite_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/favorite_menu/favorite_menu',async function(require){'use strict';let __exports={};const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{FACET_ICONS}=require("@web/search/utils/misc");const{registry}=require("@web/core/registry");const{useBus}=require("@web/core/utils/hooks");const{useService}=require("@web/core/utils/hooks");const favoriteMenuRegistry=registry.category("favoriteMenu");const{Component}=owl;const FavoriteMenu=__exports.FavoriteMenu=class FavoriteMenu extends Component{setup(){this.icon=FACET_ICONS.favorite;this.dialogService=useService("dialog");useBus(this.env.searchModel,"update",this.render);}
get items(){const favorites=this.env.searchModel.getSearchItems((searchItem)=>searchItem.type==="favorite");const registryMenus=[];for(const item of favoriteMenuRegistry.getAll()){if("isDisplayed"in item?item.isDisplayed(this.env):true){registryMenus.push({Component:item.Component,groupNumber:item.groupNumber,key:item.Component.name,});}}
return[...favorites,...registryMenus];}
onFavoriteSelected(ev){const{itemId}=ev.detail.payload;this.env.searchModel.toggleSearchItem(itemId);}
openConfirmationDialog(itemId){const{userId}=this.items.find((item)=>item.id===itemId);const dialogProps={title:this.env._t("Warning"),body:userId?this.env._t("Are you sure that you want to remove this filter?"):this.env._t("This filter is global and will be removed for everybody if you continue."),confirm:()=>this.env.searchModel.deleteFavorite(itemId),cancel:()=>{},};this.dialogService.add(ConfirmationDialog,dialogProps);}}
FavoriteMenu.template="web.FavoriteMenu";return __exports;});;

/* /web/static/src/search/filter_menu/custom_filter_item.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/filter_menu/custom_filter_item',async function(require){'use strict';let __exports={};const{DatePicker,DateTimePicker}=require("@web/core/datepicker/datepicker");const{Domain}=require("@web/core/domain");const{serializeDate,serializeDateTime}=require("@web/core/l10n/dates");const{_lt}=require("@web/core/l10n/translation");const{registry}=require("@web/core/registry");const{Component,hooks}=owl;const{useState}=hooks;const{DateTime}=luxon;const formatters=registry.category("formatters");const parsers=registry.category("parsers");const FIELD_TYPES={boolean:"boolean",char:"char",date:"date",datetime:"datetime",float:"number",id:"id",integer:"number",html:"char",many2many:"char",many2one:"char",monetary:"number",one2many:"char",text:"char",selection:"selection",};const FIELD_OPERATORS={boolean:[{symbol:"=",description:_lt("is true"),value:true},{symbol:"!=",description:_lt("is false"),value:true},],char:[{symbol:"ilike",description:_lt("contains")},{symbol:"not ilike",description:_lt("doesn't contain")},{symbol:"=",description:_lt("is equal to")},{symbol:"!=",description:_lt("is not equal to")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],date:[{symbol:"=",description:_lt("is equal to")},{symbol:"!=",description:_lt("is not equal to")},{symbol:">",description:_lt("is after")},{symbol:"<",description:_lt("is before")},{symbol:">=",description:_lt("is after or equal to")},{symbol:"<=",description:_lt("is before or equal to")},{symbol:"between",description:_lt("is between")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],datetime:[{symbol:"between",description:_lt("is between")},{symbol:"=",description:_lt("is equal to")},{symbol:"!=",description:_lt("is not equal to")},{symbol:">",description:_lt("is after")},{symbol:"<",description:_lt("is before")},{symbol:">=",description:_lt("is after or equal to")},{symbol:"<=",description:_lt("is before or equal to")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],id:[{symbol:"=",description:_lt("is")}],number:[{symbol:"=",description:_lt("is equal to")},{symbol:"!=",description:_lt("is not equal to")},{symbol:">",description:_lt("greater than")},{symbol:"<",description:_lt("less than")},{symbol:">=",description:_lt("greater than or equal to")},{symbol:"<=",description:_lt("less than or equal to")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],selection:[{symbol:"=",description:_lt("is")},{symbol:"!=",description:_lt("is not")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],};const parseField=(field,value,opts={})=>{if(FIELD_TYPES[field.type]==="char"){return value;}
const type=field.type==="id"?"integer":field.type;const parse=parsers.contains(type)?parsers.get(type):(v)=>v;return parse(value,{field,...opts});};const formatField=(field,value,opts={})=>{if(FIELD_TYPES[field.type]==="char"){return value;}
const type=field.type==="id"?"integer":field.type;const format=formatters.contains(type)?formatters.get(type):(v)=>v;return format(value,{field,...opts});};const CustomFilterItem=__exports.CustomFilterItem=class CustomFilterItem extends Component{setup(){this.conditions=useState([]);this.fields=Object.values(this.env.searchModel.searchViewFields).filter((field)=>this.validateField(field)).concat({string:"ID",type:"id",name:"id"}).sort(({string:a},{string:b})=>(a>b?1:a<b?-1:0));this.OPERATORS=FIELD_OPERATORS;this.FIELD_TYPES=FIELD_TYPES;this.addNewCondition();}
addNewCondition(){const lastCondition=[...this.conditions].pop();const condition=lastCondition?Object.assign({},lastCondition):{field:0,operator:0,};this.setDefaultValue(condition);this.conditions.push(condition);}
validateField(field){return(!field.deprecated&&field.searchable&&FIELD_TYPES[field.type]&&field.name!=="id");}
setDefaultValue(condition){const field=this.fields[condition.field];const genericType=FIELD_TYPES[field.type];const operator=FIELD_OPERATORS[genericType][condition.operator];switch(genericType){case"id":case"number":{condition.value=0;break;}
case"date":case"datetime":{condition.value=[DateTime.local()];if(operator.symbol==="between"){condition.value.push(DateTime.local());}
if(genericType==="datetime"){condition.value[0].set({hour:0,minute:0,second:0});if(operator.symbol==="between"){condition.value[1].set({hour:23,minute:59,second:59});}}
break;}
case"selection":{const[firstValue]=this.fields[condition.field].selection[0];condition.value=firstValue;break;}
default:{condition.value="";}}
if(!["date","datetime"].includes(field.type)){condition.displayedValue=formatField(field,condition.value);}}
onApply(){const preFilters=this.conditions.map((condition)=>{const field=this.fields[condition.field];const genericType=this.FIELD_TYPES[field.type];const operator=this.OPERATORS[genericType][condition.operator];const descriptionArray=[field.string,operator.description.toString()];const domainArray=[];let domainValue;if("value"in operator){domainValue=[operator.value];}else if(["date","datetime"].includes(genericType)){const serialize=genericType==="date"?serializeDate:serializeDateTime;domainValue=condition.value.map(serialize);descriptionArray.push(`"${condition.value
                        .map((val) => formatField(field, val, { timezone: true }))
                        .join(" " + this.env._t("and") + " ")}"`);}else{domainValue=[condition.value];descriptionArray.push(`"${condition.value}"`);}
if(operator.symbol==="between"){domainArray.push([field.name,">=",domainValue[0]],[field.name,"<=",domainValue[1]]);}else{domainArray.push([field.name,operator.symbol,domainValue[0]]);}
const preFilter={description:descriptionArray.join(" "),domain:new Domain(domainArray).toString(),type:"filter",};return preFilter;});this.env.searchModel.createNewFilters(preFilters);while(this.conditions.length){this.conditions.pop();}
this.addNewCondition();}
onDateChanged(condition,valueIndex,ev){condition.value[valueIndex]=ev.detail.date;}
onFieldSelect(condition,ev){Object.assign(condition,{field:ev.target.selectedIndex,operator:0,});this.setDefaultValue(condition);}
onOperatorSelect(condition,ev){condition.operator=ev.target.selectedIndex;this.setDefaultValue(condition);}
onRemoveCondition(conditionIndex){this.conditions.splice(conditionIndex,1);}
onValueChange(condition,ev){if(!ev.target.value){return this.setDefaultValue(condition);}
const field=this.fields[condition.field];try{const parsed=parseField(field,ev.target.value);const formatted=formatField(field,parsed);condition.value=parsed;condition.displayedValue=formatted;}catch(err){}
ev.target.value=condition.displayedValue;}}
CustomFilterItem.components={DatePicker,DateTimePicker};CustomFilterItem.template="web.CustomFilterItem";return __exports;});;

/* /web/static/src/search/filter_menu/filter_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/filter_menu/filter_menu',async function(require){'use strict';let __exports={};const{CustomFilterItem}=require("@web/search/filter_menu/custom_filter_item");const{FACET_ICONS}=require("@web/search/utils/misc");const{useBus}=require("@web/core/utils/hooks");const{Component}=owl;const FilterMenu=__exports.FilterMenu=class FilterMenu extends Component{setup(){this.icon=FACET_ICONS.filter;useBus(this.env.searchModel,"update",this.render);}
get items(){return this.env.searchModel.getSearchItems((searchItem)=>["filter","dateFilter"].includes(searchItem.type));}
onFilterSelected(ev){const{itemId,optionId}=ev.detail.payload;if(optionId){this.env.searchModel.toggleDateFilter(itemId,optionId);}else{this.env.searchModel.toggleSearchItem(itemId);}}}
FilterMenu.components={CustomFilterItem};FilterMenu.template="web.FilterMenu";return __exports;});;

/* /web/static/src/search/group_by_menu/custom_group_by_item.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/group_by_menu/custom_group_by_item',async function(require){'use strict';let __exports={};const{Component,hooks}=owl;const{useState}=hooks;const CustomGroupByItem=__exports.CustomGroupByItem=class CustomGroupByItem extends Component{setup(){this.state=useState({});if(this.props.fields.length){this.state.fieldName=this.props.fields[0].name;}}
onApply(){this.trigger("add-custom-group",{fieldName:this.state.fieldName});}}
CustomGroupByItem.template="web.CustomGroupByItem";return __exports;});;

/* /web/static/src/search/group_by_menu/group_by_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/group_by_menu/group_by_menu',async function(require){'use strict';let __exports={};const{CustomGroupByItem}=require("@web/search/group_by_menu/custom_group_by_item");const{FACET_ICONS,GROUPABLE_TYPES}=require("@web/search/utils/misc");const{Dropdown}=require("@web/core/dropdown/dropdown");const{sortBy}=require("@web/core/utils/arrays");const{useBus}=require("@web/core/utils/hooks");const{Component}=owl;const GroupByMenu=__exports.GroupByMenu=class GroupByMenu extends Component{setup(){this.icon=FACET_ICONS.groupBy;this.dropdownProps=Object.keys(this.props).filter((key)=>key in Dropdown.props).reduce((obj,key)=>({...obj,[key]:this.props[key]}),{});const fields=[];for(const[fieldName,field]of Object.entries(this.env.searchModel.searchViewFields)){if(this.validateField(fieldName,field)){fields.push(Object.assign({name:fieldName},field));}}
this.fields=sortBy(fields,"string");useBus(this.env.searchModel,"update",this.render);}
get items(){return this.env.searchModel.getSearchItems((searchItem)=>["groupBy","dateGroupBy"].includes(searchItem.type));}
validateField(fieldName,field){const{sortable,type}=field;return fieldName!=="id"&&sortable&&GROUPABLE_TYPES.includes(type);}
onGroupBySelected(ev){const{itemId,optionId}=ev.detail.payload;if(optionId){this.env.searchModel.toggleDateGroupBy(itemId,optionId);}else{this.env.searchModel.toggleSearchItem(itemId);}}
onAddCustomGroup(ev){const{fieldName}=ev.detail;this.env.searchModel.createNewGroupBy(fieldName);}}
GroupByMenu.components={CustomGroupByItem};GroupByMenu.template="web.GroupByMenu";GroupByMenu.defaultProps={showActiveItems:true,showCaretDown:false,};return __exports;});;

/* /web/static/src/search/search_arch_parser.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/search_arch_parser',async function(require){'use strict';let __exports={};const{makeContext}=require("@web/core/context");const{_lt}=require("@web/core/l10n/translation");const{evaluateExpr}=require("@web/core/py_js/py");const{XMLParser}=require("@web/core/utils/xml");const{DEFAULT_INTERVAL,DEFAULT_PERIOD}=require("@web/search/utils/dates");const ALL=_lt("All");const DEFAULT_LIMIT=200;const DEFAULT_VIEWS_WITH_SEARCH_PANEL=["kanban","list"];const getContextGroubBy=(context)=>{try{return makeContext([context]).group_by.split(":");}catch(err){return[];}};function reduceType(type){if(type==="dateFilter"){return"filter";}
if(type==="dateGroupBy"){return"groupBy";}
return type;}
const SearchArchParser=__exports.SearchArchParser=class SearchArchParser extends XMLParser{constructor(searchViewDescription,searchDefaults={},searchPanelDefaults={}){super();const{fields,irFilters,arch}=searchViewDescription;this.fields=fields||{};this.irFilters=irFilters||[];this.arch=arch||"<search/>";this.labels=[];this.preSearchItems=[];this.searchPanelInfo={className:"",viewTypes:DEFAULT_VIEWS_WITH_SEARCH_PANEL,};this.sections=[];this.searchDefaults=searchDefaults;this.searchPanelDefaults=searchPanelDefaults;this.currentGroup=[];this.currentTag=null;this.groupNumber=0;this.pregroupOfGroupBys=[];}
parse(){this.visitXML(this.arch,(node,visitChildren)=>{switch(node.tagName){case"search":this.visitSearch(node,visitChildren);break;case"searchpanel":this.visitSearchPanel(node);break;case"group":this.visitGroup(node,visitChildren);break;case"separator":this.visitSeparator();break;case"field":this.visitField(node);break;case"filter":this.visitFilter(node);break;}});return{labels:this.labels,preSearchItems:this.preSearchItems,searchPanelInfo:this.searchPanelInfo,sections:this.sections,};}
pushGroup(tag=null){if(this.currentGroup.length){if(this.currentTag==="groupBy"){this.pregroupOfGroupBys.push(...this.currentGroup);}else{this.preSearchItems.push(this.currentGroup);}}
this.currentTag=tag;this.currentGroup=[];this.groupNumber++;}
visitField(node){this.pushGroup("field");const preField={type:"field"};if(node.hasAttribute("modifiers")){const modifiers=JSON.parse(node.getAttribute("modifiers"));if(modifiers.invisible){preField.invisible=true;}}
if(node.hasAttribute("domain")){preField.domain=node.getAttribute("domain");}
if(node.hasAttribute("filter_domain")){preField.filterDomain=node.getAttribute("filter_domain");}else if(node.hasAttribute("operator")){preField.operator=node.getAttribute("operator");}
if(node.hasAttribute("context")){preField.context=node.getAttribute("context");}
if(node.hasAttribute("name")){const name=node.getAttribute("name");preField.fieldName=name;preField.fieldType=this.fields[name].type;if(name in this.searchDefaults){preField.isDefault=true;let value=this.searchDefaults[name];value=Array.isArray(value)?value[0]:value;let operator=preField.operator;if(!operator){let type=preField.fieldType;if(node.hasAttribute("widget")){type=node.getAttribute("widget");}
if(["char","html","many2many","one2many","text"].includes(type)){operator="ilike";}else{operator="=";}}
preField.defaultRank=-10;const{fieldType,fieldName}=preField;const{selection,context,relation}=this.fields[fieldName];preField.defaultAutocompleteValue={label:value,operator,value};if(fieldType==="selection"){const option=selection.find((sel)=>sel[0]===value);if(!option){throw Error();}
preField.defaultAutocompleteValue.label=option[1];}else if(fieldType==="many2one"){this.labels.push((orm)=>{orm.call(relation,"name_get",[value],{context}).then((results)=>{preField.defaultAutocompleteValue.label=results[0][1];});});}}}else{throw Error();}
if(node.hasAttribute("string")){preField.description=node.getAttribute("string");}else if(preField.fieldName){preField.description=this.fields[preField.fieldName].string;}else{preField.description="Ω";}
this.currentGroup.push(preField);}
visitFilter(node){const preSearchItem={type:"filter"};if(node.hasAttribute("context")){const context=node.getAttribute("context");const[fieldName,defaultInterval]=getContextGroubBy(context);const groupByField=this.fields[fieldName];if(groupByField){preSearchItem.type="groupBy";preSearchItem.fieldName=fieldName;preSearchItem.fieldType=groupByField.type;if(["date","datetime"].includes(groupByField.type)){preSearchItem.type="dateGroupBy";preSearchItem.defaultIntervalId=defaultInterval||DEFAULT_INTERVAL;}}else{preSearchItem.context=context;}}
if(reduceType(preSearchItem.type)!==this.currentTag){this.pushGroup(reduceType(preSearchItem.type));}
if(preSearchItem.type==="filter"){if(node.hasAttribute("date")){const fieldName=node.getAttribute("date");preSearchItem.type="dateFilter";preSearchItem.fieldName=fieldName;preSearchItem.fieldType=this.fields[fieldName].type;preSearchItem.defaultGeneratorId=DEFAULT_PERIOD;if(node.hasAttribute("default_period")){preSearchItem.defaultGeneratorId=node.getAttribute("default_period");}}else{let stringRepr="[]";if(node.hasAttribute("domain")){stringRepr=node.getAttribute("domain");}
preSearchItem.domain=stringRepr;}}
if(node.hasAttribute("modifiers")){const modifiers=JSON.parse(node.getAttribute("modifiers"));if(modifiers.invisible){preSearchItem.invisible=true;let fieldName=preSearchItem.fieldName;if(fieldName&&!this.fields[fieldName]){return;}}}
preSearchItem.groupNumber=this.groupNumber;if(node.hasAttribute("name")){const name=node.getAttribute("name");if(name in this.searchDefaults){preSearchItem.isDefault=true;if(["groupBy","dateGroupBy"].includes(preSearchItem.type)){const value=this.searchDefaults[name];preSearchItem.defaultRank=typeof value==="number"?value:100;}else{preSearchItem.defaultRank=-5;}}}
if(node.hasAttribute("string")){preSearchItem.description=node.getAttribute("string");}else if(preSearchItem.fieldName){preSearchItem.description=this.fields[preSearchItem.fieldName].string;}else if(node.hasAttribute("help")){preSearchItem.description=node.getAttribute("help");}else if(node.hasAttribute("name")){preSearchItem.description=node.getAttribute("name");}else{preSearchItem.description="Ω";}
this.currentGroup.push(preSearchItem);}
visitGroup(node,visitChildren){this.pushGroup();visitChildren();this.pushGroup();}
visitSearch(node,visitChildren){visitChildren();this.pushGroup();if(this.pregroupOfGroupBys.length){this.preSearchItems.push(this.pregroupOfGroupBys);}}
visitSearchPanel(searchPanelNode){let hasCategoryWithCounters=false;let hasFilterWithDomain=false;let nextSectionId=1;if(searchPanelNode.hasAttribute("class")){this.searchPanelInfo.className=searchPanelNode.getAttribute("class");}
if(searchPanelNode.hasAttribute("view_types")){this.searchPanelInfo.viewTypes=searchPanelNode.getAttribute("view_types").split(",");}
for(const node of searchPanelNode.children){if(node.nodeType!==1||node.tagName!=="field"){continue;}
const isInvisible=Boolean(evaluateExpr(node.getAttribute("invisible")||"0"));if(isInvisible){continue;}
const attrs={};for(const attrName of node.getAttributeNames()){attrs[attrName]=node.getAttribute(attrName);}
const type=attrs.select==="multi"?"filter":"category";const section={color:attrs.color||null,description:attrs.string||this.fields[attrs.name].string,enableCounters:Boolean(evaluateExpr(attrs.enable_counters||"0")),expand:Boolean(evaluateExpr(attrs.expand||"0")),fieldName:attrs.name,icon:attrs.icon||null,id:nextSectionId++,limit:evaluateExpr(attrs.limit||String(DEFAULT_LIMIT)),type,values:new Map(),};if(type==="category"){section.activeValueId=this.searchPanelDefaults[attrs.name];section.icon=section.icon||"fa-folder";section.hierarchize=Boolean(evaluateExpr(attrs.hierarchize||"1"));section.values.set(false,{childrenIds:[],display_name:ALL.toString(),id:false,bold:true,parentId:false,});hasCategoryWithCounters=hasCategoryWithCounters||section.enableCounters;}else{section.domain=attrs.domain||"[]";section.groupBy=attrs.groupby||null;section.icon=section.icon||"fa-filter";hasFilterWithDomain=hasFilterWithDomain||section.domain!=="[]";}
this.sections.push([section.id,section]);}
if(hasCategoryWithCounters&&hasFilterWithDomain){for(const section of this.sections){if(section.type==="category"){section.enableCounters=false;}}
console.warn("Warning: categories with counters are incompatible with filters having a domain attribute.","All category counters have been disabled to avoid inconsistencies.");}
return false;}
visitSeparator(){this.pushGroup();}}
return __exports;});;

/* /web/static/src/search/search_bar/search_bar.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/search_bar/search_bar',async function(require){'use strict';let __exports={};const{Domain}=require("@web/core/domain");const{serializeDate,serializeDateTime}=require("@web/core/l10n/dates");const{registry}=require("@web/core/registry");const{KeepLast}=require("@web/core/utils/concurrency");const{useAutofocus,useBus,useService}=require("@web/core/utils/hooks");const{fuzzyTest}=require("@web/core/utils/search");const{Component,hooks}=owl;const{useExternalListener,useRef,useState}=hooks;const parsers=registry.category("parsers");const CHAR_FIELDS=["char","html","many2many","many2one","one2many","text"];let nextItemId=1;const SearchBar=__exports.SearchBar=class SearchBar extends Component{setup(){this.fields=this.env.searchModel.searchViewFields;this.searchItems=this.env.searchModel.getSearchItems((f)=>f.type==="field");this.state=useState({expanded:[],focusedIndex:0,query:"",});this.items=[];this.subItems={};this.orm=useService("orm");this.keepLast=new KeepLast();this.focusOnUpdate=useAutofocus();this.inputRef=useRef("search-input");useBus(this.env.bus,"FOCUS-SEARCH-BAR",()=>{this.inputRef.el.focus();});useBus(this.env.searchModel,"update",this.render);useExternalListener(window,"click",this.onWindowClick);useExternalListener(window,"keydown",this.onWindowKeydown);}
async computeState(options={}){const query="query"in options?options.query:this.state.query;const expanded="expanded"in options?options.expanded:this.state.expanded;const focusedIndex="focusedIndex"in options?options.focusedIndex:this.state.focusedIndex;const subItems="subItems"in options?options.subItems:this.subItems;const tasks=[];for(const id of expanded){if(!subItems[id]){tasks.push({id,prom:this.computeSubItems(id,query)});}}
const prom=this.keepLast.add(Promise.all(tasks.map((task)=>task.prom)));if(tasks.length){const taskResults=await prom;tasks.forEach((task,index)=>{subItems[task.id]=taskResults[index];});}
this.state.expanded=expanded;this.state.query=query;this.state.focusedIndex=focusedIndex;this.subItems=subItems;this.inputRef.el.value=query;const trimmedQuery=this.state.query.trim();this.items=[];if(!trimmedQuery){return;}
for(const searchItem of this.searchItems){const field=this.fields[searchItem.fieldName];const type=field.type==="reference"?"char":field.type;const preposition=this.env._t(["date","datetime"].includes(type)?"at":"for");if(["selection","boolean"].includes(type)){const options=field.selection||[[true,this.env._t("Yes")],[false,this.env._t("No")],];for(const[value,label]of options){if(fuzzyTest(trimmedQuery.toLowerCase(),label.toLowerCase())){this.items.push({id:nextItemId++,searchItemDescription:searchItem.description,preposition,searchItemId:searchItem.id,label,operator:searchItem.operator||"=",value,});}}
continue;}
const parser=parsers.contains(type)?parsers.get(type):(str)=>str;let value;try{switch(type){case"date":{value=serializeDate(parser(trimmedQuery,{timezone:false}));break;}
case"datetime":{value=serializeDateTime(parser(trimmedQuery,{timezone:true}));break;}
case"many2one":{value=trimmedQuery;break;}
default:{value=parser(trimmedQuery);}}}catch(e){continue;}
const item={id:nextItemId++,searchItemDescription:searchItem.description,preposition,searchItemId:searchItem.id,label:this.state.query,operator:searchItem.operator||(CHAR_FIELDS.includes(type)?"ilike":"="),value,};if(type==="many2one"){item.isParent=true;item.isExpanded=this.state.expanded.includes(item.searchItemId);}
this.items.push(item);if(item.isExpanded){this.items.push(...this.subItems[searchItem.id]);}}}
async computeSubItems(searchItemId,query){const searchItem=this.searchItems.find((i)=>i.id===searchItemId);const field=this.fields[searchItem.fieldName];let domain=[];if(searchItem.domain){try{domain=new Domain(searchItem.domain).toList();}catch(e){}}
const options=await this.orm.call(field.relation,"name_search",domain,{context:field.context,limit:8,name:query.trim(),});let subItems=[];if(options.length){const operator=searchItem.operator||"=";for(const[value,label]of options){subItems.push({id:nextItemId++,isChild:true,searchItemId,value,label,operator,});}}else{subItems.push({id:nextItemId++,isChild:true,searchItemId,label:this.env._t("(no result)"),unselectable:true,});}
return subItems;}
focusFacet(index){const facets=this.el.getElementsByClassName("o_searchview_facet");if(facets.length){if(!index){facets[facets.length-1].focus();}else{facets[index].focus();}}}
removeFacet(facet){this.env.searchModel.deactivateGroup(facet.groupId);this.focusOnUpdate();}
resetState(){this.computeState({expanded:[],focusedIndex:0,query:"",subItems:[]});this.focusOnUpdate();}
selectItem(item){if(!item.unselectable){const{searchItemId,label,operator,value}=item;this.env.searchModel.addAutoCompletionValues(searchItemId,{label,operator,value});}
this.resetState();}
toggleItem(item,shouldExpand){const id=item.searchItemId;const expanded=[...this.state.expanded];const index=expanded.findIndex((id0)=>id0===id);if(shouldExpand===true){if(index<0){expanded.push(id);}}else{if(index>=0){expanded.splice(index,1);}}
this.computeState({expanded});}
onFacetKeydown(facet,facetIndex,ev){switch(ev.key){case"ArrowLeft":{if(facetIndex===0){this.inputRef.el.focus();}else{this.focusFacet(facetIndex-1);}
break;}
case"ArrowRight":{const facets=this.el.getElementsByClassName("o_searchview_facet");if(facetIndex===facets.length-1){this.inputRef.el.focus();}else{this.focusFacet(facetIndex+1);}
break;}
case"Backspace":{this.removeFacet(facet);break;}}}
onFacetRemove(facet){this.removeFacet(facet);}
onItemMousemove(focusedIndex){this.state.focusedIndex=focusedIndex;this.inputRef.el.focus();}
onSearchKeydown(ev){if(ev.isComposing){return;}
const focusedItem=this.items[this.state.focusedIndex];let focusedIndex;switch(ev.key){case"ArrowDown":ev.preventDefault();if(this.items.length){if(this.state.focusedIndex>=this.items.length-1){focusedIndex=0;}else{focusedIndex=this.state.focusedIndex+1;}}else{this.env.bus.trigger("FOCUS-VIEW");}
break;case"ArrowUp":ev.preventDefault();if(this.items.length){if(this.state.focusedIndex===0||this.state.focusedIndex>this.items.length-1){focusedIndex=this.items.length-1;}else{focusedIndex=this.state.focusedIndex-1;}}
break;case"ArrowLeft":if(focusedItem&&focusedItem.isParent&&focusedItem.isExpanded){ev.preventDefault();this.toggleItem(focusedItem,false);}else if(focusedItem&&focusedItem.isChild){ev.preventDefault();focusedIndex=this.items.findIndex((item)=>item.isParent&&item.searchItemId===focusedItem.searchItemId);}else if(ev.target.selectionStart===0){this.focusFacet();}else{}
break;case"ArrowRight":if(ev.target.selectionStart===this.state.query.length){if(focusedItem&&focusedItem.isParent){ev.preventDefault();if(focusedItem.isExpanded){focusedIndex=this.state.focusedIndex+1;}else{this.toggleItem(focusedItem,true);}}else if(ev.target.selectionStart===this.state.query.length){this.focusFacet(0);}}
break;case"Backspace":if(!this.state.query.length){const facets=this.env.searchModel.facets;if(facets.length){this.removeFacet(facets[facets.length-1]);}}
break;case"Enter":if(!this.state.query.length){this.env.searchModel.search();break;}else if(focusedItem){ev.preventDefault();this.selectItem(focusedItem);}
break;case"Tab":if(this.state.query.length&&focusedItem){ev.preventDefault();this.selectItem(focusedItem);}
break;case"Escape":this.resetState();break;}
if(focusedIndex!==undefined){this.state.focusedIndex=focusedIndex;}}
onSearchInput(ev){const query=ev.target.value;if(query.trim()){this.computeState({query,expanded:[],focusedIndex:0,subItems:[]});}else if(this.items.length){this.resetState();}}
onWindowClick(ev){if(this.items.length&&!this.el.contains(ev.target)){this.resetState();}}
onWindowKeydown(ev){if(this.items.length&&ev.key==="Escape"){this.resetState();}}}
SearchBar.template="web.SearchBar";return __exports;});;

/* /web/static/src/search/search_model.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/search_model',async function(require){'use strict';let __exports={};const{makeContext}=require("@web/core/context");const{Domain}=require("@web/core/domain");const{evaluateExpr}=require("@web/core/py_js/py");const{sortBy}=require("@web/core/utils/arrays");const{deepCopy}=require("@web/core/utils/objects");const{SearchArchParser}=require("@web/search/search_arch_parser");const{constructDateDomain,DEFAULT_INTERVAL,getComparisonOptions,getIntervalOptions,getPeriodOptions,rankInterval,yearSelected,}=require("@web/search/utils/dates");const{FACET_ICONS}=require("@web/search/utils/misc");const{DateTime}=luxon;const EventBus=owl.core.EventBus;function hasValues(section){const{errorMsg,type,values}=section;if(errorMsg){return true;}
switch(type){case"category":{return values&&values.size>1;}
case"filter":{return values&&values.size>0;}}}
function mapToArray(map){const result=[];for(const[key,val]of map){const valCopy=Object.assign({},val);result.push([key,valCopy]);}
return result;}
function arraytoMap(array){return new Map(array);}
function execute(op,source,target){const{query,nextId,nextGroupId,nextGroupNumber,searchItems,searchPanelInfo,sections,}=source;target.nextGroupId=nextGroupId;target.nextGroupNumber=nextGroupNumber;target.nextId=nextId;target.query=query;target.searchItems=searchItems;target.searchPanelInfo=searchPanelInfo;target.sections=op(sections);for(const[,section]of target.sections){section.values=op(section.values);if(section.groups){section.groups=op(section.groups);for(const[,group]of section.groups){group.values=op(group.values);}}}}
const FAVORITE_PRIVATE_GROUP=1;const FAVORITE_SHARED_GROUP=2;const SearchModel=__exports.SearchModel=class SearchModel extends EventBus{constructor(env,services){super();this.env=env;this.setup(services);}
setup(services){const{orm,user,view}=services;this.orm=orm;this.userService=user;this.viewService=view;this.referenceMoment=DateTime.local();this.comparisonOptions=getComparisonOptions();this.intervalOptions=getIntervalOptions();this.optionGenerators=getPeriodOptions(this.referenceMoment);}
async load(config){const{resModel}=config;if(!resModel){throw Error(`SearchPanel config should have a "resModel" key`);}
this.resModel=resModel;this._reset();const{comparison,context,domain,groupBy,orderBy}=config;this.globalComparison=comparison;this.globalContext=context||{};this.globalDomain=domain||[];this.globalGroupBy=groupBy||[];this.globalOrderBy=orderBy||[];this.searchMenuTypes=new Set(config.searchMenuTypes||["filter","groupBy","favorite"]);let{irFilters,loadIrFilters,searchViewArch,searchViewFields,searchViewId}=config;const loadSearchView=searchViewId!==undefined&&(!searchViewArch||!searchViewFields||(!irFilters&&loadIrFilters));const searchViewDescription={};if(loadSearchView){const viewDescriptions=await this.viewService.loadViews({context:this.globalContext,resModel,views:[[searchViewId,"search"]],},{actionId:this.env.config.actionId,loadIrFilters:loadIrFilters||false,});Object.assign(searchViewDescription,viewDescriptions.search);}
if(searchViewArch){searchViewDescription.arch=searchViewArch;}
if(searchViewFields){searchViewDescription.fields=searchViewFields;}
if(irFilters){searchViewDescription.irFilters=irFilters;}
if(searchViewId!==undefined){searchViewDescription.viewId=searchViewId;}
this.searchViewArch=searchViewDescription.arch||"<search/>";this.searchViewFields=searchViewDescription.fields||{};if(searchViewDescription.irFilters){this.irFilters=searchViewDescription.irFilters;}
if(searchViewDescription.viewId!==undefined){this.searchViewId=searchViewDescription.viewId;}
if(config.state){this._importState(config.state);this.__legacyParseSearchPanelArchAnyway(searchViewDescription);this.domainParts={};this.display=this._getDisplay(config.display);return this._reloadSections();}
this.blockNotification=true;this.searchItems={};this.query=[];this.nextId=1;this.nextGroupId=1;this.nextGroupNumber=1;this.domainParts={};const searchDefaults={};const searchPanelDefaults={};for(const key in this.globalContext){const defaultValue=this.globalContext[key];const searchDefaultMatch=/^search_default_(.*)$/.exec(key);if(searchDefaultMatch){if(defaultValue){searchDefaults[searchDefaultMatch[1]]=defaultValue;}
delete this.globalContext[key];continue;}
const searchPanelDefaultMatch=/^searchpanel_default_(.*)$/.exec(key);if(searchPanelDefaultMatch){searchPanelDefaults[searchPanelDefaultMatch[1]]=defaultValue;delete this.globalContext[key];}}
const parser=new SearchArchParser(searchViewDescription,searchDefaults,searchPanelDefaults);const{labels,preSearchItems,searchPanelInfo,sections}=parser.parse();this.searchPanelInfo={...searchPanelInfo,shouldReload:false};await Promise.all(labels.map((cb)=>cb(this.orm)));for(const preGroup of preSearchItems||[]){this._createGroupOfSearchItems(preGroup);}
this.nextGroupNumber=1+Math.max(...Object.values(this.searchItems).map((i)=>i.groupNumber||0),0);const dateFilters=Object.values(this.searchItems).filter((searchElement)=>searchElement.type==="dateFilter");if(dateFilters.length){this._createGroupOfComparisons(dateFilters);}
const{dynamicFilters}=config;if(dynamicFilters){this._createGroupOfDynamicFilters(dynamicFilters);}
const defaultFavoriteId=this._createGroupOfFavorites(this.irFilters||[]);const activateFavorite="activateFavorite"in config?config.activateFavorite:true;this._activateDefaultSearchItems(activateFavorite?defaultFavoriteId:null);this.sections=new Map(sections||[]);this.display=this._getDisplay(config.display);if(this.display.searchPanel){this.searchDomain=this._getDomain({withSearchPanel:false});this.sectionsPromise=this._fetchSections(this.categories,this.filters).then(()=>{for(const{fieldName,values}of this.filters){const filterDefaults=searchPanelDefaults[fieldName]||[];for(const valueId of filterDefaults){const value=values.get(valueId);if(value){value.checked=true;}}}});if(Object.keys(searchPanelDefaults).length||this._shouldWaitForData(false)){await this.sectionsPromise;}}
this.blockNotification=false;}
async reload(config={}){this._reset();const{comparison,context,domain,groupBy,orderBy}=config;this.globalContext=context||{};this.globalDomain=domain||[];this.globalComparison=comparison;this.globalGroupBy=groupBy||[];this.globalOrderBy=orderBy||[];await this._reloadSections();}
get categories(){return[...this.sections.values()].filter((s)=>s.type==="category");}
get context(){if(!this._context){this._context=makeContext([this._getContext(),this.globalContext]);}
return deepCopy(this._context);}
get domain(){if(!this._domain){this._domain=this._getDomain();}
return deepCopy(this._domain);}
get comparison(){if(!this.searchMenuTypes.has("comparison")){return null;}
if(this._comparison===undefined){if(this.globalComparison){this._comparison=this.globalComparison;}else{const comparison=this.getFullComparison();if(comparison){const{fieldName,range,rangeDescription,comparisonRange,comparisonRangeDescription,}=comparison;const domains=[{arrayRepr:Domain.and([this.domain,range]).toList(),description:rangeDescription,},{arrayRepr:Domain.and([this.domain,comparisonRange]).toList(),description:comparisonRangeDescription,},];this._comparison={domains,fieldName};}else{this._comparison=null;}}}
return deepCopy(this._comparison);}
get facets(){const isValidType=(type)=>!["groupBy","comparison"].includes(type)||this.searchMenuTypes.has(type);const facets=[];for(const facet of this._getFacets()){if(!isValidType(facet.type)){continue;}
facets.push(facet);}
return facets;}
get filters(){return[...this.sections.values()].filter((s)=>s.type==="filter");}
get groupBy(){if(!this._groupBy){this._groupBy=this._getGroupBy();}
return deepCopy(this._groupBy);}
get orderBy(){if(!this._orderBy){this._orderBy=this._getOrderBy();}
return deepCopy(this._orderBy);}
addAutoCompletionValues(searchItemId,autocompleteValue){const searchItem=this.searchItems[searchItemId];if(searchItem.type!=="field"){return;}
const{label,value,operator}=autocompleteValue;const queryElem=this.query.find((queryElem)=>queryElem.searchItemId===searchItemId&&"autocompleteValue"in queryElem&&queryElem.autocompleteValue.value===value&&queryElem.autocompleteValue.operator===operator);if(!queryElem){this.query.push({searchItemId,autocompleteValue});}else{queryElem.autocompleteValue.label=label;}
this._notify();}
clearQuery(){this.query=[];this._notify();}
async createNewFavorite(params){const{preFavorite,irFilter}=this._getIrFilterDescription(params);const serverSideId=await this.orm.call("ir.filters","create_or_replace",[irFilter]);this.env.bus.trigger("CLEAR-CACHES");this.blockNotification=true;this.clearQuery();const favorite={...preFavorite,type:"favorite",id:this.nextId,groupId:this.nextGroupId,groupNumber:preFavorite.userId?FAVORITE_PRIVATE_GROUP:FAVORITE_SHARED_GROUP,removable:true,serverSideId,};this.searchItems[this.nextId]=favorite;this.query.push({searchItemId:this.nextId});this.nextGroupId++;this.nextId++;this.blockNotification=false;this._notify();}
createNewFilters(prefilters){if(!prefilters.length){return[];}
prefilters.forEach((preFilter)=>{const filter=Object.assign(preFilter,{groupId:this.nextGroupId,groupNumber:this.nextGroupNumber,id:this.nextId,type:"filter",});this.searchItems[this.nextId]=filter;this.query.push({searchItemId:this.nextId});this.nextId++;});this.nextGroupId++;this.nextGroupNumber++;this._notify();}
createNewGroupBy(fieldName){const field=this.searchViewFields[fieldName];const{string,type:fieldType}=field;const firstGroupBy=Object.values(this.searchItems).find((f)=>f.type==="groupBy");const preSearchItem={description:string||fieldName,fieldName,fieldType,groupId:firstGroupBy?firstGroupBy.groupId:this.nextGroupId++,groupNumber:this.nextGroupNumber,id:this.nextId,custom:true,};if(["date","datetime"].includes(fieldType)){this.searchItems[this.nextId]=Object.assign({type:"dateGroupBy",defaultIntervalId:DEFAULT_INTERVAL},preSearchItem);this.toggleDateGroupBy(this.nextId);}else{this.searchItems[this.nextId]=Object.assign({type:"groupBy"},preSearchItem);this.toggleSearchItem(this.nextId);}
this.nextGroupNumber++;this.nextId++;this._notify();}
deactivateGroup(groupId){this.query=this.query.filter((queryElem)=>{const searchItem=this.searchItems[queryElem.searchItemId];return searchItem.groupId!==groupId;});for(const partName in this.domainParts){const part=this.domainParts[partName];if(part.groupId===groupId){this.setDomainParts({[partName]:null});}}
this._checkComparisonStatus();this._notify();}
async deleteFavorite(favoriteId){const searchItem=this.searchItems[favoriteId];if(searchItem.type!=="favorite"){return;}
const{serverSideId}=searchItem;await this.orm.unlink("ir.filters",[serverSideId]);this.env.bus.trigger("CLEAR-CACHES");const index=this.query.findIndex((queryElem)=>queryElem.searchItemId===favoriteId);delete this.searchItems[favoriteId];if(index>=0){this.query.splice(index,1);}
this._notify();}
exportState(){const state={};execute(mapToArray,this,state);return state;}
getDomainPart(partName){let part=this.domainParts[partName]||null;if(part){return deepCopy(part);}
return part;}
getDomainParts(){const copy=deepCopy(this.domainParts);return sortBy(Object.values(copy),(part)=>part.groupId);}
getFullComparison(){let searchItem=null;for(const queryElem of this.query.slice().reverse()){const item=this.searchItems[queryElem.searchItemId];if(item.type==="comparison"){searchItem=item;break;}else if(item.type==="favorite"&&item.comparison){searchItem=item;break;}}
if(!searchItem){return null;}else if(searchItem.type==="favorite"){return searchItem.comparison;}
const{dateFilterId,comparisonOptionId}=searchItem;const{fieldName,fieldType,description:dateFilterDescription}=this.searchItems[dateFilterId];const selectedGeneratorIds=this._getSelectedGeneratorIds(dateFilterId);const{domain:range,description:rangeDescription}=constructDateDomain(this.referenceMoment,fieldName,fieldType,selectedGeneratorIds);const{domain:comparisonRange,description:comparisonRangeDescription,}=constructDateDomain(this.referenceMoment,fieldName,fieldType,selectedGeneratorIds,comparisonOptionId);return{comparisonId:comparisonOptionId,fieldName,fieldDescription:dateFilterDescription,range:range.toList(),rangeDescription,comparisonRange:comparisonRange.toList(),comparisonRangeDescription,};}
getIrFilterValues(params){const{irFilter}=this._getIrFilterDescription(params);return irFilter;}
getSearchItems(predicate){const searchItems=[];Object.values(this.searchItems).forEach((searchItem)=>{if((!("invisible"in searchItem)||!searchItem.invisible)&&(!predicate||predicate(searchItem))){const enrichedSearchitem=this._enrichItem(searchItem);if(enrichedSearchitem){searchItems.push(enrichedSearchitem);}}});if(searchItems.some((f)=>f.type==="favorite")){searchItems.sort((f1,f2)=>f1.groupNumber-f2.groupNumber);}
return searchItems;}
getSections(predicate){let sections=[...this.sections.values()].map((section)=>Object.assign({},section,{empty:!hasValues(section)}));if(predicate){sections=sections.filter(predicate);}
return sections.sort((s1,s2)=>s1.index-s2.index);}
search(){this.trigger("update");}
setDomainParts(parts){for(const key in parts){const val=parts[key];if(!val){delete this.domainParts[key];}else{this.domainParts[key]=val;val.groupId=this.nextGroupId++;}}
this._notify();}
toggleCategoryValue(sectionId,valueId){const category=this.sections.get(sectionId);category.activeValueId=valueId;this._notify();}
toggleFilterValues(sectionId,valueIds,forceTo=null){const filter=this.sections.get(sectionId);for(const valueId of valueIds){const value=filter.values.get(valueId);value.checked=forceTo===null?!value.checked:forceTo;}
this._notify();}
toggleSearchItem(searchItemId){const searchItem=this.searchItems[searchItemId];switch(searchItem.type){case"dateFilter":case"dateGroupBy":case"field":{return;}}
const index=this.query.findIndex((queryElem)=>queryElem.searchItemId===searchItemId);if(index>=0){this.query.splice(index,1);}else{if(searchItem.type==="favorite"){this.query=[];}else if(searchItem.type==="comparison"){this.query=this.query.filter((queryElem)=>{const{type}=this.searchItems[queryElem.searchItemId];return type!=="comparison";});}
this.query.push({searchItemId});}
this._notify();}
toggleDateFilter(searchItemId,generatorId){const searchItem=this.searchItems[searchItemId];if(searchItem.type!=="dateFilter"){return;}
generatorId=generatorId||searchItem.defaultGeneratorId;const index=this.query.findIndex((queryElem)=>queryElem.searchItemId===searchItemId&&"generatorId"in queryElem&&queryElem.generatorId===generatorId);if(index>=0){this.query.splice(index,1);if(!yearSelected(this._getSelectedGeneratorIds(searchItemId))){this.query=this.query.filter((queryElem)=>queryElem.searchItemId!==searchItemId);}}else{this.query.push({searchItemId,generatorId});if(!yearSelected(this._getSelectedGeneratorIds(searchItemId))){const{defaultYearId}=this.optionGenerators.find((o)=>o.id===generatorId);this.query.push({searchItemId,generatorId:defaultYearId});}}
this._checkComparisonStatus();this._notify();}
toggleDateGroupBy(searchItemId,intervalId){const searchItem=this.searchItems[searchItemId];if(searchItem.type!=="dateGroupBy"){return;}
intervalId=intervalId||searchItem.defaultIntervalId;const index=this.query.findIndex((queryElem)=>queryElem.searchItemId===searchItemId&&"intervalId"in queryElem&&queryElem.intervalId===intervalId);if(index>=0){this.query.splice(index,1);}else{this.query.push({searchItemId,intervalId});}
this._notify();}
_activateDefaultSearchItems(defaultFavoriteId){if(defaultFavoriteId){this.toggleSearchItem(defaultFavoriteId);}else{Object.values(this.searchItems).filter((f)=>f.isDefault&&f.type!=="favorite").sort((f1,f2)=>(f1.defaultRank||100)-(f2.defaultRank||100)).forEach((f)=>{if(f.type==="dateFilter"){this.toggleDateFilter(f.id);}else if(f.type==="dateGroupBy"){this.toggleDateGroupBy(f.id);}else if(f.type==="field"){this.addAutoCompletionValues(f.id,f.defaultAutocompleteValue);}else{this.toggleSearchItem(f.id);}});}}
_checkComparisonStatus(){const activeComparison=this._getActiveComparison();if(!activeComparison){return;}
const{dateFilterId,id}=activeComparison;const dateFilterIsActive=this.query.some((queryElem)=>queryElem.searchItemId===dateFilterId);if(!dateFilterIsActive){this.query=this.query.filter((queryElem)=>queryElem.searchItemId!==id);}}
_createCategoryTree(sectionId,result){const category=this.sections.get(sectionId);let{error_msg,parent_field:parentField,values}=result;if(error_msg){category.errorMsg=error_msg;values=[];}
if(category.hierarchize){category.parentField=parentField;}
for(const value of values){category.values.set(value.id,Object.assign({},value,{childrenIds:[],parentId:value[parentField]||false,}));}
for(const value of values){const{parentId}=category.values.get(value.id);if(parentId&&category.values.has(parentId)){category.values.get(parentId).childrenIds.push(value.id);}}
category.rootIds=[false];for(const value of values){const{parentId}=category.values.get(value.id);if(!parentId){category.rootIds.push(value.id);}}
const valueIds=[false,...values.map((val)=>val.id)];this._ensureCategoryValue(category,valueIds);}
_createFilterTree(sectionId,result){const filter=this.sections.get(sectionId);let{error_msg,values}=result;if(error_msg){filter.errorMsg=error_msg;values=[];}
values.forEach((value)=>{const oldValue=filter.values.get(value.id);value.checked=oldValue?oldValue.checked:false;});filter.values=new Map();const groupIds=[];if(filter.groupBy){const groups=new Map();for(const value of values){const groupId=value.group_id;if(!groups.has(groupId)){if(groupId){groupIds.push(groupId);}
groups.set(groupId,{id:groupId,name:value.group_name,values:new Map(),tooltip:value.group_tooltip,sequence:value.group_sequence,hex_color:value.group_hex_color,});const oldGroup=filter.groups&&filter.groups.get(groupId);groups.get(groupId).state=(oldGroup&&oldGroup.state)||false;}
groups.get(groupId).values.set(value.id,value);}
filter.groups=groups;filter.sortedGroupIds=sortBy(groupIds,(id)=>groups.get(id).sequence||groups.get(id).name);for(const group of filter.groups.values()){for(const[valueId,value]of group.values){filter.values.set(valueId,value);}}}else{for(const value of values){filter.values.set(value.id,value);}}}
_createGroupOfComparisons(dateFilters){const preSearchItem=[];for(const dateFilter of dateFilters){for(const comparisonOption of this.comparisonOptions){const{id:dateFilterId,description}=dateFilter;const preFilter={type:"comparison",comparisonOptionId:comparisonOption.id,description:`${description}: ${comparisonOption.description}`,dateFilterId,};preSearchItem.push(preFilter);}}
this._createGroupOfSearchItems(preSearchItem);}
_createGroupOfDynamicFilters(dynamicFilters){const pregroup=dynamicFilters.map((filter)=>{return{groupNumber:this.nextGroupNumber,description:filter.description,domain:filter.domain,isDefault:true,type:"filter",};});this.nextGroupNumber++;this._createGroupOfSearchItems(pregroup);}
_createGroupOfFavorites(irFilters){let defaultFavoriteId=null;irFilters.forEach((irFilter)=>{const favorite=this._irFilterToFavorite(irFilter);this._createGroupOfSearchItems([favorite]);if(favorite.isDefault){defaultFavoriteId=favorite.id;}});return defaultFavoriteId;}
_createGroupOfSearchItems(pregroup){pregroup.forEach((preSearchItem)=>{const searchItem=Object.assign(preSearchItem,{groupId:this.nextGroupId,id:this.nextId,});this.searchItems[this.nextId]=searchItem;this.nextId++;});this.nextGroupId++;}
_enrichItem(searchItem){const queryElements=this.query.filter((queryElem)=>queryElem.searchItemId===searchItem.id);const isActive=Boolean(queryElements.length);const enrichSearchItem=Object.assign({isActive},searchItem);function _enrichOptions(options,selectedIds){return options.map((o)=>{const{description,id,groupNumber}=o;const isActive=selectedIds.some((optionId)=>optionId===id);return{description,id,groupNumber,isActive};});}
switch(searchItem.type){case"comparison":{const{dateFilterId}=searchItem;const dateFilterIsActive=this.query.some((queryElem)=>queryElem.searchItemId===dateFilterId);if(!dateFilterIsActive){return null;}
break;}
case"dateFilter":enrichSearchItem.options=_enrichOptions(this.optionGenerators,queryElements.map((queryElem)=>queryElem.generatorId));break;case"dateGroupBy":enrichSearchItem.options=_enrichOptions(this.intervalOptions,queryElements.map((queryElem)=>queryElem.intervalId));break;case"field":enrichSearchItem.autocompleteValues=queryElements.map((queryElem)=>queryElem.autocompleteValue);break;}
return enrichSearchItem;}
_ensureCategoryValue(category,valueIds){if(!valueIds.includes(category.activeValueId)){category.activeValueId=valueIds[0];}}
async _fetchCategories(categories){const filterDomain=this._getFilterDomain();const searchDomain=this.searchDomain;await Promise.all(categories.map(async(category)=>{const result=await this.orm.call(this.resModel,"search_panel_select_range",[category.fieldName],{category_domain:this._getCategoryDomain(category.id),enable_counters:category.enableCounters,expand:category.expand,filter_domain:filterDomain,hierarchize:category.hierarchize,limit:category.limit,search_domain:searchDomain,});this._createCategoryTree(category.id,result);}));}
async _fetchFilters(filters){const evalContext={};for(const category of this.categories){evalContext[category.fieldName]=category.activeValueId;}
const categoryDomain=this._getCategoryDomain();const searchDomain=this.searchDomain;await Promise.all(filters.map(async(filter)=>{const result=await this.orm.call(this.resModel,"search_panel_select_multi_range",[filter.fieldName],{category_domain:categoryDomain,comodel_domain:new Domain(filter.domain).toList(evalContext),enable_counters:filter.enableCounters,filter_domain:this._getFilterDomain(filter.id),expand:filter.expand,group_by:filter.groupBy||false,group_domain:this._getGroupDomain(filter),limit:filter.limit,search_domain:searchDomain,});this._createFilterTree(filter.id,result);}));}
async _fetchSections(categoriesToLoad,filtersToLoad){await this._fetchCategories(categoriesToLoad);await this._fetchFilters(filtersToLoad);}
_getActiveComparison(){for(const queryElem of this.query){const searchItem=this.searchItems[queryElem.searchItemId];if(searchItem.type==="comparison"){return searchItem;}}
return null;}
_getCategoryDomain(excludedCategoryId){const domain=[];for(const category of this.categories){if(category.id===excludedCategoryId||!category.activeValueId){continue;}
const field=this.searchViewFields[category.fieldName];const operator=field.type==="many2one"&&category.parentField?"child_of":"=";domain.push([category.fieldName,operator,category.activeValueId]);}
return domain;}
_getContext(){const groups=this._getGroups();const contexts=[this.userService.context];for(const group of groups){for(const activeItem of group.activeItems){const context=this._getSearchItemContext(activeItem);if(context){contexts.push(context);}}}
let context;try{context=makeContext(contexts);return context;}catch(error){throw new Error(`${this.env._t("Failed to evaluate the context")} ${context}.\n${error.message}`);}}
_getDateFilterDomain(dateFilter,generatorIds,key="domain"){const{fieldName,fieldType}=dateFilter;const dateFilterRange=constructDateDomain(this.referenceMoment,fieldName,fieldType,generatorIds);return dateFilterRange[key];}
_getDisplay(display={}){const{viewTypes}=this.searchPanelInfo;const{bannerRoute,viewType}=this.env.config;return{controlPanel:"controlPanel"in display?display.controlPanel:{},searchPanel:this.sections.size&&(!viewType||viewTypes.includes(viewType))&&("searchPanel"in display?display.searchPanel:true),banner:Boolean(bannerRoute),};}
_getDomain(params={}){const withSearchPanel="withSearchPanel"in params?params.withSearchPanel:true;const withGlobal="withGlobal"in params?params.withGlobal:true;const groups=this._getGroups();const domains=[];if(withGlobal){domains.push(this.globalDomain);}
for(const group of groups){const groupActiveItemDomains=[];for(const activeItem of group.activeItems){const domain=this._getSearchItemDomain(activeItem);if(domain){groupActiveItemDomains.push(domain);}}
const groupDomain=Domain.or(groupActiveItemDomains);domains.push(groupDomain);}
for(const{domain}of this.getDomainParts()){domains.push(domain);}
if(this.display.searchPanel&&withSearchPanel){domains.push(this._getSearchPanelDomain());}
let domain;try{domain=Domain.and(domains);return params.raw?domain:domain.toList(this.userService.context);}catch(error){throw new Error(`${this.env._t("Failed to evaluate the domain")} ${domain.toString()}.\n${
                    error.message
                }`);}}
_getFacets(){const facets=[];const groups=this._getGroups();for(const group of groups){const values=[];let title;let type;for(const activeItem of group.activeItems){const searchItem=this.searchItems[activeItem.searchItemId];switch(searchItem.type){case"field":{type="field";title=searchItem.description;for(const autocompleteValue of activeItem.autocompletValues){values.push(autocompleteValue.label);}
break;}
case"groupBy":{type="groupBy";values.push(searchItem.description);break;}
case"dateGroupBy":{type="groupBy";for(const intervalId of activeItem.intervalIds){const option=this.intervalOptions.find((o)=>o.id===intervalId);values.push(`${searchItem.description}: ${option.description}`);}
break;}
case"dateFilter":{type="filter";const periodDescription=this._getDateFilterDomain(searchItem,activeItem.generatorIds,"description");values.push(`${searchItem.description}: ${periodDescription}`);break;}
default:{type=searchItem.type;values.push(searchItem.description);}}}
const facet={groupId:group.id,type:type,values,separator:type==="groupBy"?">":this.env._t("or"),};if(type==="field"){facet.title=title;}else{facet.icon=FACET_ICONS[type];}
facets.push(facet);}
for(const{facetLabel,groupId}of this.getDomainParts()){const type="filter";facets.push({groupId,type,values:[facetLabel],icon:FACET_ICONS[type],});}
return facets;}
_getFieldDomain(field,autocompleteValues){const domains=autocompleteValues.map(({label,value,operator})=>{let domain;if(field.filterDomain){domain=new Domain(field.filterDomain).toList({self:label,raw_value:value});}else{domain=[[field.fieldName,operator,value]];}
return new Domain(domain);});return Domain.or(domains);}
_getFilterDomain(excludedFilterId){const domain=[];function addCondition(fieldName,valueMap){const ids=[];for(const[valueId,value]of valueMap){if(value.checked){ids.push(valueId);}}
if(ids.length){domain.push([fieldName,"in",ids]);}}
for(const filter of this.filters){if(filter.id===excludedFilterId){continue;}
const{fieldName,groups,values}=filter;if(groups){for(const group of groups.values()){addCondition(fieldName,group.values);}}else{addCondition(fieldName,values);}}
return domain;}
_getGroupBy(){const groups=this._getGroups();const groupBys=[];for(const group of groups){for(const activeItem of group.activeItems){const activeItemGroupBys=this._getSearchItemGroupBys(activeItem);if(activeItemGroupBys){groupBys.push(...activeItemGroupBys);}}}
const groupBy=groupBys.length?groupBys:this.globalGroupBy.slice();return typeof groupBy==="string"?[groupBy]:groupBy;}
_getGroupDomain(filter){const{fieldName,groups,enableCounters}=filter;const{type:fieldType}=this.searchViewFields[fieldName];if(!enableCounters||!groups){return{many2one:[],many2many:{},}[fieldType];}
let groupDomain=null;if(fieldType==="many2one"){for(const group of groups.values()){const valueIds=[];let active=false;for(const[valueId,value]of group.values){const{checked}=value;valueIds.push(valueId);if(checked){active=true;}}
if(active){if(groupDomain){groupDomain=[[0,"=",1]];break;}else{groupDomain=[[fieldName,"in",valueIds]];}}}}else if(fieldType==="many2many"){const checkedValueIds=new Map();groups.forEach(({values},groupId)=>{values.forEach(({checked},valueId)=>{if(checked){if(!checkedValueIds.has(groupId)){checkedValueIds.set(groupId,[]);}
checkedValueIds.get(groupId).push(valueId);}});});groupDomain={};for(const[gId,ids]of checkedValueIds.entries()){for(const groupId of groups.keys()){if(gId!==groupId){const key=JSON.stringify(groupId);if(!groupDomain[key]){groupDomain[key]=[];}
groupDomain[key].push([fieldName,"in",ids]);}}}}
return groupDomain;}
_getGroups(){const preGroups=[];for(const queryElem of this.query){const{searchItemId}=queryElem;const{groupId}=this.searchItems[searchItemId];let preGroup=preGroups.find((group)=>group.id===groupId);if(!preGroup){preGroup={id:groupId,queryElements:[]};preGroups.push(preGroup);}
preGroup.queryElements.push(queryElem);}
const groups=[];for(const preGroup of preGroups){const{queryElements,id}=preGroup;let activeItems=[];for(const queryElem of queryElements){const{searchItemId}=queryElem;let activeItem=activeItems.find(({searchItemId:id})=>id===searchItemId);if("generatorId"in queryElem){if(!activeItem){activeItem={searchItemId,generatorIds:[]};activeItems.push(activeItem);}
activeItem.generatorIds.push(queryElem.generatorId);}else if("intervalId"in queryElem){if(!activeItem){activeItem={searchItemId,intervalIds:[]};activeItems.push(activeItem);}
activeItem.intervalIds.push(queryElem.intervalId);}else if("autocompleteValue"in queryElem){if(!activeItem){activeItem={searchItemId,autocompletValues:[]};activeItems.push(activeItem);}
activeItem.autocompletValues.push(queryElem.autocompleteValue);}else{if(!activeItem){activeItem={searchItemId};activeItems.push(activeItem);}}}
for(const activeItem of activeItems){if("intervalIds"in activeItem){activeItem.intervalIds.sort((g1,g2)=>rankInterval(g1)-rankInterval(g2));}}
groups.push({id,activeItems});}
return groups;}
_getIrFilterDescription(params={}){const{description,isDefault,isShared}=params;const fns=this.env.__getContext__.callbacks;const localContext=Object.assign({},...fns.map((fn)=>fn()));const context=makeContext([this._getContext(),localContext]);const userContext=this.userService.context;for(const key in context){if(key in userContext||/^search(panel)?_default_/.test(key)){delete context[key];}}
const domain=this._getDomain({raw:true,withGlobal:false}).toString();const groupBys=this._getGroupBy();const comparison=this.getFullComparison();const orderBy=this._getOrderBy();const userId=isShared?false:this.userService.userId;const preFavorite={description,isDefault,domain,context,groupBys,orderBy,userId,};const irFilter={name:description,action_id:this.env.config.actionId,model_id:this.resModel,domain,is_default:isDefault,sort:JSON.stringify(orderBy.map((o)=>`${o.name}${o.asc === false ? " desc" : ""}`)),user_id:userId,context:{group_by:groupBys,...context},};if(comparison){preFavorite.comparison=comparison;irFilter.context.comparison=comparison;}
return{preFavorite,irFilter};}
_getOrderBy(){const groups=this._getGroups();let orderBy=[];for(const group of groups){for(const activeItem of group.activeItems){const{searchItemId}=activeItem;const searchItem=this.searchItems[searchItemId];if(searchItem.type==="favorite"){orderBy.push(...searchItem.orderBy);}}}
orderBy=orderBy.length?orderBy:this.globalOrderBy;return typeof orderBy==="string"?[orderBy]:orderBy;}
_getSearchItemContext(activeItem){const{searchItemId}=activeItem;const searchItem=this.searchItems[searchItemId];switch(searchItem.type){case"field":{let context={};if(searchItem.context){try{const self=activeItem.autocompletValues.map((autocompleValue)=>autocompleValue.value);context=evaluateExpr(searchItem.context,{self});if(typeof context!=="object"){throw Error();}}catch(error){throw new Error(`${this.env._t("Failed to evaluate the context")} "${
                                searchItem.context
                            }".\n${error.message}`);}}
if(searchItem.isDefault&&searchItem.fieldType==="many2one"){context[`default_${searchItem.fieldName}`]=searchItem.defaultAutocompleteValue.value;}
return context;}
case"favorite":case"filter":{return makeContext([searchItem.context&&deepCopy(searchItem.context)]);}
default:{return null;}}}
_getSearchItemDomain(activeItem){const{searchItemId}=activeItem;const searchItem=this.searchItems[searchItemId];switch(searchItem.type){case"field":{return this._getFieldDomain(searchItem,activeItem.autocompletValues);}
case"dateFilter":{const{dateFilterId}=this._getActiveComparison()||{};if(this.searchMenuTypes.has("comparison")&&dateFilterId===searchItemId){return new Domain([]);}
return this._getDateFilterDomain(searchItem,activeItem.generatorIds);}
case"filter":case"favorite":{return searchItem.domain;}
default:{return null;}}}
_getSearchItemGroupBys(activeItem){const{searchItemId}=activeItem;const searchItem=this.searchItems[searchItemId];switch(searchItem.type){case"dateGroupBy":{const{fieldName}=searchItem;return activeItem.intervalIds.map((intervalId)=>`${fieldName}:${intervalId}`);}
case"groupBy":{return[searchItem.fieldName];}
case"favorite":{return searchItem.groupBys;}
default:{return null;}}}
_getSelectedGeneratorIds(dateFilterId){const selectedOptionIds=[];for(const queryElem of this.query){if(queryElem.searchItemId===dateFilterId&&"generatorId"in queryElem){selectedOptionIds.push(queryElem.generatorId);}}
return selectedOptionIds;}
_getSearchPanelDomain(){return Domain.and([this._getCategoryDomain(),this._getFilterDomain()]);}
_importState(state){execute(arraytoMap,state,this);}
_irFilterToFavorite(irFilter){let userId=false;if(Array.isArray(irFilter.user_id)){userId=irFilter.user_id[0];}
const groupNumber=userId?FAVORITE_PRIVATE_GROUP:FAVORITE_SHARED_GROUP;const context=evaluateExpr(irFilter.context,this.userService.context);let groupBys=[];if(context.group_by){groupBys=context.group_by;delete context.group_by;}
let comparison;if(context.comparison){comparison=context.comparison;if(typeof comparison.range==="string"){comparison.range=new Domain(comparison.range).toList();}
if(typeof comparison.comparisonRange==="string"){comparison.comparisonRange=new Domain(comparison.comparisonRange).toList();}
delete context.comparison;}
let sort;try{sort=JSON.parse(irFilter.sort);}catch(err){if(err instanceof SyntaxError){sort=[];}else{throw err;}}
const orderBy=sort.map((order)=>{let fieldName;let asc;const sqlNotation=order.split(" ");if(sqlNotation.length>1){fieldName=sqlNotation[0];asc=sqlNotation[1]==="asc";}else{fieldName=order[0]==="-"?order.slice(1):order;asc=order[0]==="-"?false:true;}
return{asc:asc,name:fieldName,};});const favorite={context,description:irFilter.name,domain:irFilter.domain,groupBys,groupNumber,orderBy,removable:true,serverSideId:irFilter.id,type:"favorite",userId,};if(irFilter.is_default){favorite.isDefault=irFilter.is_default;}
if(comparison){favorite.comparison=comparison;}
return favorite;}
async _notify(){if(this.blockNotification){return;}
this._reset();await this._reloadSections();this.trigger("update");}
async _reloadSections(){this.blockNotification=true;const searchDomain=this._getDomain({withSearchPanel:false});const searchDomainChanged=this.searchPanelInfo.shouldReload||JSON.stringify(this.searchDomain)!==JSON.stringify(searchDomain);this.searchDomain=searchDomain;const toFetch=(section)=>section.enableCounters||(searchDomainChanged&&!section.expand);const categoriesToFetch=this.categories.filter(toFetch);const filtersToFetch=this.filters.filter(toFetch);if(searchDomainChanged||Boolean(categoriesToFetch.length+filtersToFetch.length)){if(this.display.searchPanel){this.sectionsPromise=this._fetchSections(categoriesToFetch,filtersToFetch);if(this._shouldWaitForData(searchDomainChanged)){await this.sectionsPromise;}}
this.searchPanelInfo.shouldReload=!this.display.searchPanel;}
this.blockNotification=false;}
_reset(){delete this._comparison;this._context=null;this._domain=null;this._groupBy=null;this._orderBy=null;}
_shouldWaitForData(searchDomainChanged){if(this.categories.length&&this.filters.some((filter)=>filter.domain!=="[]")){return true;}
if(!this.searchDomain.length){return false;}
return[...this.sections.values()].some((section)=>!section.expand&&searchDomainChanged);}
__legacyParseSearchPanelArchAnyway(searchViewDescription){if(this.searchPanelInfo){return;}
const parser=new SearchArchParser(searchViewDescription);const{searchPanelInfo}=parser.parse();this.searchPanelInfo={...searchPanelInfo,shouldReload:false};}}
return __exports;});;

/* /web/static/src/search/search_panel/search_panel.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/search_panel/search_panel',async function(require){'use strict';let __exports={};const{Component,hooks}=owl;const{useState}=hooks;const SearchPanel=__exports.SearchPanel=class SearchPanel extends Component{setup(){this.state=useState({active:{},expanded:{},});this.scrollTop=0;this.hasImportedState=false;this.importState(this.props.importedState);}
async willStart(){await this.env.searchModel.sectionsPromise;this.expandDefaultValue();this.updateActiveValues();}
mounted(){this.updateGroupHeadersChecked();if(this.hasImportedState){this.el.scroll({top:this.scrollTop});}}
async willUpdateProps(){await this.env.searchModel.sectionsPromise;this.updateActiveValues();}
get sections(){return this.env.searchModel.getSections((s)=>!s.empty);}
exportState(){const exported={expanded:this.state.expanded,scrollTop:this.el.scrollTop,};return JSON.stringify(exported);}
importState(stringifiedState){this.hasImportedState=Boolean(stringifiedState);if(this.hasImportedState){const state=JSON.parse(stringifiedState);this.state.expanded=state.expanded;this.scrollTop=state.scrollTop;}}
expandDefaultValue(){if(this.hasImportedState){return;}
const categories=this.env.searchModel.getSections((s)=>s.type==="category");for(const category of categories){this.state.expanded[category.id]={};if(category.activeValueId){const ancestorIds=this.getAncestorValueIds(category,category.activeValueId);for(const ancestorId of ancestorIds){this.state.expanded[category.id][ancestorId]=true;}}}}
getAncestorValueIds(category,categoryValueId){const{parentId}=category.values.get(categoryValueId);return parentId?[...this.getAncestorValueIds(category,parentId),parentId]:[];}
async toggleCategory(category,value){if(value.childrenIds.length){const categoryState=this.state.expanded[category.id];if(categoryState[value.id]&&category.activeValueId===value.id){delete categoryState[value.id];}else{categoryState[value.id]=true;}}
if(category.activeValueId!==value.id){this.state.active[category.id]=value.id;this.env.searchModel.toggleCategoryValue(category.id,value.id);}}
toggleFilterGroup(filterId,{values}){const valueIds=[];const checked=[...values.values()].every((value)=>this.state.active[filterId][value.id]);values.forEach(({id})=>{valueIds.push(id);this.state.active[filterId][id]=!checked;});this.env.searchModel.toggleFilterValues(filterId,valueIds,!checked);}
toggleFilterValue(filterId,valueId,{currentTarget}){this.state.active[filterId][valueId]=currentTarget.checked;this.updateGroupHeadersChecked();this.env.searchModel.toggleFilterValues(filterId,[valueId]);}
updateActiveValues(){for(const section of this.sections){if(section.type==="category"){this.state.active[section.id]=section.activeValueId;}else{this.state.active[section.id]={};if(section.groups){for(const group of section.groups.values()){for(const value of group.values.values()){this.state.active[section.id][value.id]=value.checked;}}}
if(section&&section.values){for(const value of section.values.values()){this.state.active[section.id][value.id]=value.checked;}}}}}
updateGroupHeadersChecked(){const groups=this.el.querySelectorAll(":scope .o_search_panel_filter_group");for(const group of groups){const header=group.querySelector(":scope .o_search_panel_group_header input");const vals=[...group.querySelectorAll(":scope .o_search_panel_filter_value input")];header.checked=false;header.indeterminate=false;if(vals.every((v)=>v.checked)){header.checked=true;}else if(vals.some((v)=>v.checked)){header.indeterminate=true;}}}}
SearchPanel.props={importedState:{type:String,optional:true},};SearchPanel.subTemplates={category:"web.SearchPanel.Category",filtersGroup:"web.SearchPanel.FiltersGroup",};SearchPanel.template="web.SearchPanel";return __exports;});;

/* /web/static/src/search/utils/dates.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/utils/dates',async function(require){'use strict';let __exports={};const{_lt}=require("@web/core/l10n/translation");const{Domain}=require("@web/core/domain");const{serializeDate,serializeDateTime}=require("@web/core/l10n/dates");const{localization}=require("@web/core/l10n/localization");const DEFAULT_PERIOD=__exports.DEFAULT_PERIOD="this_month";const QUARTERS=__exports.QUARTERS={1:{description:_lt("Q1"),coveredMonths:[1,2,3]},2:{description:_lt("Q2"),coveredMonths:[4,5,6]},3:{description:_lt("Q3"),coveredMonths:[7,8,9]},4:{description:_lt("Q4"),coveredMonths:[10,11,12]},};const MONTH_OPTIONS=__exports.MONTH_OPTIONS={this_month:{id:"this_month",groupNumber:1,format:"MMMM",plusParam:{},granularity:"month",},last_month:{id:"last_month",groupNumber:1,format:"MMMM",plusParam:{months:-1},granularity:"month",},antepenultimate_month:{id:"antepenultimate_month",groupNumber:1,format:"MMMM",plusParam:{months:-2},granularity:"month",},};const QUARTER_OPTIONS=__exports.QUARTER_OPTIONS={fourth_quarter:{id:"fourth_quarter",groupNumber:1,description:QUARTERS[4].description,setParam:{quarter:4},granularity:"quarter",},third_quarter:{id:"third_quarter",groupNumber:1,description:QUARTERS[3].description,setParam:{quarter:3},granularity:"quarter",},second_quarter:{id:"second_quarter",groupNumber:1,description:QUARTERS[2].description,setParam:{quarter:2},granularity:"quarter",},first_quarter:{id:"first_quarter",groupNumber:1,description:QUARTERS[1].description,setParam:{quarter:1},granularity:"quarter",},};const YEAR_OPTIONS=__exports.YEAR_OPTIONS={this_year:{id:"this_year",groupNumber:2,format:"yyyy",plusParam:{},granularity:"year",},last_year:{id:"last_year",groupNumber:2,format:"yyyy",plusParam:{years:-1},granularity:"year",},antepenultimate_year:{id:"antepenultimate_year",groupNumber:2,format:"yyyy",plusParam:{years:-2},granularity:"year",},};const PERIOD_OPTIONS=__exports.PERIOD_OPTIONS=Object.assign({},MONTH_OPTIONS,QUARTER_OPTIONS,YEAR_OPTIONS);const DEFAULT_INTERVAL=__exports.DEFAULT_INTERVAL="month";const INTERVAL_OPTIONS=__exports.INTERVAL_OPTIONS={year:{description:_lt("Year"),id:"year",groupNumber:1},quarter:{description:_lt("Quarter"),id:"quarter",groupNumber:1},month:{description:_lt("Month"),id:"month",groupNumber:1},week:{description:_lt("Week"),id:"week",groupNumber:1},day:{description:_lt("Day"),id:"day",groupNumber:1},};const COMPARISON_OPTIONS=__exports.COMPARISON_OPTIONS={previous_period:{description:_lt("Previous Period"),id:"previous_period",},previous_year:{description:_lt("Previous Year"),id:"previous_year",plusParam:{years:-1},},};const PER_YEAR=__exports.PER_YEAR={year:1,quarter:4,month:12,};__exports.constructDateDomain=constructDateDomain;function constructDateDomain(referenceMoment,fieldName,fieldType,selectedOptionIds,comparisonOptionId){let plusParam;let selectedOptions;if(comparisonOptionId){[plusParam,selectedOptions]=getComparisonParams(referenceMoment,selectedOptionIds,comparisonOptionId);}else{selectedOptions=getSelectedOptions(referenceMoment,selectedOptionIds);}
const yearOptions=selectedOptions.year;const otherOptions=[...(selectedOptions.quarter||[]),...(selectedOptions.month||[])];sortPeriodOptions(yearOptions);sortPeriodOptions(otherOptions);const ranges=[];for(const yearOption of yearOptions){const constructRangeParams={referenceMoment,fieldName,fieldType,plusParam,};if(otherOptions.length){for(const option of otherOptions){const setParam=Object.assign({},yearOption.setParam,option?option.setParam:{});const{granularity}=option;const range=constructDateRange(Object.assign({granularity,setParam},constructRangeParams));ranges.push(range);}}else{const{granularity,setParam}=yearOption;const range=constructDateRange(Object.assign({granularity,setParam},constructRangeParams));ranges.push(range);}}
const domain=Domain.combine(ranges.map((range)=>range.domain),"OR");const description=ranges.map((range)=>range.description).join("/");return{domain,description};}
__exports.constructDateRange=constructDateRange;function constructDateRange(params){const{referenceMoment,fieldName,fieldType,granularity,setParam,plusParam}=params;if("quarter"in setParam){setParam.month=QUARTERS[setParam.quarter].coveredMonths[0];delete setParam.quarter;}
const date=referenceMoment.set(setParam).plus(plusParam||{}).setZone("utc",{keepLocalTime:true});let leftDate=date.startOf(granularity);let rightDate=date.endOf(granularity);let leftBound;let rightBound;if(fieldType==="date"){leftBound=serializeDate(leftDate);rightBound=serializeDate(rightDate);}else{leftBound=serializeDateTime(leftDate);rightBound=serializeDateTime(rightDate);}
const domain=new Domain(["&",[fieldName,">=",leftBound],[fieldName,"<=",rightBound]]);const descriptions=[date.toFormat("yyyy")];const method=localization.direction==="rtl"?"push":"unshift";if(granularity==="month"){descriptions[method](date.toFormat("MMMM"));}else if(granularity==="quarter"){const quarter=date.quarter;descriptions[method](QUARTERS[quarter].description.toString());}
const description=descriptions.join(" ");return{domain,description};}
__exports.getComparisonOptions=getComparisonOptions;function getComparisonOptions(){return getOptionsWithDescriptions(COMPARISON_OPTIONS);}
__exports.getComparisonParams=getComparisonParams;function getComparisonParams(referenceMoment,selectedOptionIds,comparisonOptionId){const comparisonOption=COMPARISON_OPTIONS[comparisonOptionId];const selectedOptions=getSelectedOptions(referenceMoment,selectedOptionIds);if(comparisonOption.plusParam){return[comparisonOption.plusParam,selectedOptions];}
let plusParam={};let globalGranularity="year";if(selectedOptions.month){globalGranularity="month";}else if(selectedOptions.quarter){globalGranularity="quarter";}
const granularityFactor=PER_YEAR[globalGranularity];const years=selectedOptions.year.map((o)=>o.setParam.year);const yearMin=Math.min(...years);const yearMax=Math.max(...years);let optionMin=0;let optionMax=0;if(selectedOptions.quarter){const quarters=selectedOptions.quarter.map((o)=>o.setParam.quarter);if(globalGranularity==="month"){delete selectedOptions.quarter;for(const quarter of quarters){for(const month of QUARTERS[quarter].coveredMonths){const monthOption=selectedOptions.month.find((o)=>o.setParam.month===month);if(!monthOption){selectedOptions.month.push({setParam:{month},granularity:"month",});}}}}else{optionMin=Math.min(...quarters);optionMax=Math.max(...quarters);}}
if(selectedOptions.month){const months=selectedOptions.month.map((o)=>o.setParam.month);optionMin=Math.min(...months);optionMax=Math.max(...months);}
const num=-1+granularityFactor*(yearMin-yearMax)+optionMin-optionMax;const key=globalGranularity==="year"?"years":globalGranularity==="month"?"months":"quarters";plusParam[key]=num;return[plusParam,selectedOptions];}
__exports.getIntervalOptions=getIntervalOptions;function getIntervalOptions(){return getOptionsWithDescriptions(INTERVAL_OPTIONS);}
__exports.getPeriodOptions=getPeriodOptions;function getPeriodOptions(referenceMoment){const options=[];const originalOptions=Object.values(PERIOD_OPTIONS);for(const option of originalOptions){const{id,groupNumber}=option;let description;let defaultYear;switch(option.granularity){case"quarter":description=option.description.toString();defaultYear=referenceMoment.set(option.setParam).year;break;case"month":case"year":const date=referenceMoment.plus(option.plusParam);description=date.toFormat(option.format);defaultYear=date.year;break;}
const setParam=getSetParam(option,referenceMoment);options.push({id,groupNumber,description,defaultYear,setParam});}
const periodOptions=[];for(const option of options){const{id,groupNumber,description,defaultYear}=option;const yearOption=options.find((o)=>o.setParam&&o.setParam.year===defaultYear);periodOptions.push({id,groupNumber,description,defaultYearId:yearOption.id,});}
return periodOptions;}
__exports.getOptionsWithDescriptions=getOptionsWithDescriptions;function getOptionsWithDescriptions(OPTIONS){const options=[];for(const option of Object.values(OPTIONS)){options.push(Object.assign({},option,{description:option.description.toString()}));}
return options;}
__exports.getSelectedOptions=getSelectedOptions;function getSelectedOptions(referenceMoment,selectedOptionIds){const selectedOptions={year:[]};for(const optionId of selectedOptionIds){const option=PERIOD_OPTIONS[optionId];const setParam=getSetParam(option,referenceMoment);const granularity=option.granularity;if(!selectedOptions[granularity]){selectedOptions[granularity]=[];}
selectedOptions[granularity].push({granularity,setParam});}
return selectedOptions;}
__exports.getSetParam=getSetParam;function getSetParam(periodOption,referenceMoment){if(periodOption.granularity==="quarter"){return periodOption.setParam;}
const date=referenceMoment.plus(periodOption.plusParam);const granularity=periodOption.granularity;const setParam={[granularity]:date[granularity]};return setParam;}
__exports.rankInterval=rankInterval;function rankInterval(intervalOptionId){return Object.keys(INTERVAL_OPTIONS).indexOf(intervalOptionId);}
__exports.sortPeriodOptions=sortPeriodOptions;function sortPeriodOptions(options){options.sort((o1,o2)=>{var _a,_b;const granularity1=o1.granularity;const granularity2=o2.granularity;if(granularity1===granularity2){return(((_a=o1.setParam[granularity1])!==null&&_a!==void 0?_a:0)-
((_b=o2.setParam[granularity1])!==null&&_b!==void 0?_b:0));}
return granularity1<granularity2?-1:1;});}
__exports.yearSelected=yearSelected;function yearSelected(selectedOptionIds){return selectedOptionIds.some((optionId)=>Object.keys(YEAR_OPTIONS).includes(optionId));}
return __exports;});;

/* /web/static/src/search/utils/group_by.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/utils/group_by',async function(require){'use strict';let __exports={};const{DEFAULT_INTERVAL,INTERVAL_OPTIONS}=require("@web/search/utils/dates");function errorMsg(descr){return`Invalid groupBy description: ${descr}`;}
__exports.getGroupBy=getGroupBy;function getGroupBy(descr,fields){let fieldName;let interval;let spec;[fieldName,interval]=descr.split(":");if(!fieldName){throw Error();}
if(fields){if(!fields[fieldName]){throw Error(errorMsg(descr));}
const fieldType=fields[fieldName].type;if(["date","datetime"].includes(fieldType)){if(!interval){interval=DEFAULT_INTERVAL;}else if(!Object.keys(INTERVAL_OPTIONS).includes(interval)){throw Error(errorMsg(descr));}
spec=`${fieldName}:${interval}`;}else if(interval){throw Error(errorMsg(descr));}else{spec=fieldName;interval=null;}}else{if(interval){if(!Object.keys(INTERVAL_OPTIONS).includes(interval)){throw Error(errorMsg(descr));}
spec=`${fieldName}:${interval}`;}else{spec=fieldName;interval=null;}}
return{fieldName,interval,spec,toJSON(){return spec;},};}
return __exports;});;

/* /web/static/src/search/utils/misc.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/utils/misc',async function(require){'use strict';let __exports={};const FACET_ICONS=__exports.FACET_ICONS={filter:"fa fa-filter",groupBy:"fa fa-bars",favorite:"fa fa-star",comparison:"fa fa-adjust",};const GROUPABLE_TYPES=__exports.GROUPABLE_TYPES=["boolean","char","date","datetime","integer","many2one","selection",];return __exports;});;

/* /web/static/src/search/with_search/with_search.js defined in bundle 'web.assets_backend' */
odoo.define('@web/search/with_search/with_search',async function(require){'use strict';let __exports={};const{useBus,useService}=require("@web/core/utils/hooks");const{SearchModel}=require("@web/search/search_model");const{CallbackRecorder,useSetupAction}=require("@web/webclient/actions/action_hook");const{Component,hooks}=owl;const{useSubEnv}=hooks;const SEARCH_KEYS=__exports.SEARCH_KEYS=["comparison","context","domain","groupBy","orderBy"];const OTHER_SEARCH_KEYS=["irFilters","searchViewArch","searchViewFields","searchViewId"];const WithSearch=__exports.WithSearch=class WithSearch extends Component{setup(){this.Component=this.props.Component;if(!this.env.__getContext__){useSubEnv({__getContext__:new CallbackRecorder()});}
const SearchModelClass=this.Component.SearchModel||SearchModel;this.env.searchModel=new SearchModelClass(this.env,{user:useService("user"),orm:useService("orm"),view:useService("view"),});useBus(this.env.searchModel,"update",this.render);useSetupAction({getGlobalState:()=>{return{searchModel:JSON.stringify(this.env.searchModel.exportState()),};},});}
async willStart(){const config={...this.props};if(config.globalState&&config.globalState.searchModel){config.state=JSON.parse(config.globalState.searchModel);delete config.globalState;}
await this.env.searchModel.load(config);}
async willUpdateProps(nextProps){const config={};for(const key of SEARCH_KEYS){if(nextProps[key]!==undefined){config[key]=nextProps[key];}}
await this.env.searchModel.reload(config);}
get componentProps(){const componentProps={...this.props.componentProps};for(const key of SEARCH_KEYS){componentProps[key]=this.env.searchModel[key];}
componentProps.info=componentProps.info||{};for(const key of OTHER_SEARCH_KEYS){componentProps.info[key]=this.env.searchModel[key];}
return componentProps;}}
WithSearch.defaultProps={componentProps:{},};WithSearch.props={Component:Function,componentProps:{type:Object,optional:true},resModel:String,globalState:{type:Object,optional:true},display:{type:Object,optional:true},comparison:{validate:()=>true,optional:true},context:{type:Object,optional:true},domain:{type:Array,element:[String,Array],optional:true},groupBy:{type:Array,element:String,optional:true},orderBy:{type:Array,element:String,optional:true},searchViewArch:{type:String,optional:true},searchViewFields:{type:Object,optional:true},searchViewId:{type:[Number,false],optional:true},irFilters:{type:Array,element:Object,optional:true},loadIrFilters:{type:Boolean,optional:true},activateFavorite:{type:Boolean,optional:true},dynamicFilters:{type:Array,element:Object,optional:true},searchMenuTypes:{type:Array,element:String,optional:true},};WithSearch.template="web.WithSearch";return __exports;});;

/* /web/static/src/views/debug_items.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/debug_items',async function(require){'use strict';let __exports={};const{_lt}=require("@web/core/l10n/translation");const{Dialog}=require("@web/core/dialog/dialog");const{editModelDebug}=require("@web/core/debug/debug_utils");const{registry}=require("@web/core/registry");const{tags}=owl;const debugRegistry=registry.category("debug");class FieldViewGetDialog extends Dialog{}
FieldViewGetDialog.props=Object.assign({},Dialog.props,{arch:{type:String},close:Function,});FieldViewGetDialog.bodyTemplate=tags.xml`<pre t-esc="props.arch"/>`;FieldViewGetDialog.title=_lt("Fields View Get");function viewSeparator(){return{type:"separator",sequence:300,};}
function fieldsViewGet({component,env}){let{arch}=component.props;if("viewInfo"in component.props){arch=component.props.viewInfo.arch;}
return{type:"item",description:env._t("Fields View Get"),callback:()=>{env.services.dialog.add(FieldViewGetDialog,{arch});},sequence:340,};}
__exports.editView=editView;function editView({accessRights,component,env}){if(!accessRights.canEditView){return null;}
let{viewId,viewType:type}=component.env.config||{};if("viewInfo"in component.props){viewId=component.props.viewInfo.view_id;type=component.props.viewInfo.type;type=type==="tree"?"list":type;}
const displayName=type[0].toUpperCase()+type.slice(1);const description=env._t("Edit View: ")+displayName;return{type:"item",description,callback:()=>{editModelDebug(env,description,"ir.ui.view",viewId);},sequence:350,};}
__exports.editSearchView=editSearchView;function editSearchView({accessRights,component,env}){if(!accessRights.canEditView){return null;}
let{searchViewId}=component.props.info||{};if("viewParams"in component.props){if(!component.props.viewParams.action.controlPanelFieldsView){return null;}
searchViewId=component.props.viewParams.action.controlPanelFieldsView.view_id;}
if(searchViewId===undefined){return null;}
const description=env._t("Edit ControlPanelView");return{type:"item",description,callback:()=>{editModelDebug(env,description,"ir.ui.view",searchViewId);},sequence:360,};}
debugRegistry.category("view").add("viewSeparator",viewSeparator).add("fieldsViewGet",fieldsViewGet).add("editView",editView).add("editSearchView",editSearchView);return __exports;});;

/* /web/static/src/views/graph/colors.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/graph/colors',async function(require){'use strict';let __exports={};const COLORS=__exports.COLORS=["#1f77b4","#ff7f0e","#aec7e8","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5",];__exports.getColor=getColor;function getColor(index){return COLORS[index%COLORS.length];}
const DEFAULT_BG=__exports.DEFAULT_BG="#d3d3d3";const BORDER_WHITE=__exports.BORDER_WHITE="rgba(255,255,255,0.6)";const RGB_REGEX=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;__exports.hexToRGBA=hexToRGBA;function hexToRGBA(hex,opacity){const rgb=RGB_REGEX.exec(hex).slice(1,4).map((n)=>parseInt(n,16)).join(",");return`rgba(${rgb},${opacity})`;}
return __exports;});;

/* /web/static/src/views/graph/graph_arch_parser.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/graph/graph_arch_parser',async function(require){'use strict';let __exports={};const{evaluateExpr}=require("@web/core/py_js/py");const{GROUPABLE_TYPES}=require("@web/search/utils/misc");const{XMLParser}=require("@web/core/utils/xml");const{archParseBoolean}=require("@web/views/helpers/utils");const MODES=["bar","line","pie"];const ORDERS=["ASC","DESC",null];const GraphArchParser=__exports.GraphArchParser=class GraphArchParser extends XMLParser{parse(arch,fields={}){const archInfo={fields,fieldAttrs:{},groupBy:[]};this.visitXML(arch,(node)=>{switch(node.tagName){case"graph":{if(node.hasAttribute("disable_linking")){archInfo.disableLinking=archParseBoolean(node.getAttribute("disable_linking"));}
if(node.hasAttribute("stacked")){archInfo.stacked=archParseBoolean(node.getAttribute("stacked"));}
const mode=node.getAttribute("type");if(mode&&MODES.includes(mode)){archInfo.mode=mode;}
const order=node.getAttribute("order");if(order&&ORDERS.includes(order)){archInfo.order=order;}
const title=node.getAttribute("string");if(title){archInfo.title=title;}
break;}
case"field":{let fieldName=node.getAttribute("name");if(fieldName==="id"){break;}
const string=node.getAttribute("string");if(string){if(!archInfo.fieldAttrs[fieldName]){archInfo.fieldAttrs[fieldName]={};}
archInfo.fieldAttrs[fieldName].string=string;}
const isInvisible=Boolean(evaluateExpr(node.getAttribute("invisible")||"0"));if(isInvisible){if(!archInfo.fieldAttrs[fieldName]){archInfo.fieldAttrs[fieldName]={};}
archInfo.fieldAttrs[fieldName].isInvisible=true;break;}
const isMeasure=node.getAttribute("type")==="measure";if(isMeasure){archInfo.measure=fieldName;}else{const{type}=archInfo.fields[fieldName];if(GROUPABLE_TYPES.includes(type)){let groupBy=fieldName;const interval=node.getAttribute("interval");if(interval){groupBy+=`:${interval}`;}
archInfo.groupBy.push(groupBy);}}
break;}}});return archInfo;}}
return __exports;});;

/* /web/static/src/views/graph/graph_model.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/graph/graph_model',async function(require){'use strict';let __exports={};const{sortBy}=require("@web/core/utils/arrays");const{KeepLast,Race}=require("@web/core/utils/concurrency");const{rankInterval}=require("@web/search/utils/dates");const{getGroupBy}=require("@web/search/utils/group_by");const{GROUPABLE_TYPES}=require("@web/search/utils/misc");const{Model}=require("@web/views/helpers/model");const{computeReportMeasures,processMeasure}=require("@web/views/helpers/utils");const SEP=__exports.SEP=" / ";class DateClasses{constructor(array){this.__referenceIndex=null;this.__array=array;for(let i=0;i<this.__array.length;i++){const arr=this.__array[i];if(arr.length&&this.__referenceIndex===null){this.__referenceIndex=i;}}}
classLabel(index,o){return`${this.__array[index].indexOf(o)}`;}
classMembers(classLabel){const classNumber=Number(classLabel);const classMembers=new Set();for(const arr of this.__array){if(arr[classNumber]!==undefined){classMembers.add(arr[classNumber]);}}
return[...classMembers];}
representative(classLabel,index){const classNumber=Number(classLabel);const i=index===undefined?this.__referenceIndex:index;if(i===null){return null;}
return this.__array[i][classNumber];}
arrayLength(index){return this.__array[index].length;}}
const GraphModel=__exports.GraphModel=class GraphModel extends Model{setup(params){this.keepLast=new KeepLast();this.race=new Race();const _fetchDataPoints=this._fetchDataPoints.bind(this);this._fetchDataPoints=(...args)=>{return this.race.add(_fetchDataPoints(...args));};this.initialGroupBy=null;this.metaData=params;this.data=null;this.searchParams=null;}
async load(searchParams){this.searchParams=searchParams;if(!this.initialGroupBy){this.initialGroupBy=searchParams.context.graph_groupbys||this.metaData.groupBy;}
const metaData=this._buildMetaData();return this._fetchDataPoints(metaData);}
hasData(){return this.dataPoints.length>0;}
async updateMetaData(params){if("measure"in params){const metaData=this._buildMetaData(params);await this._fetchDataPoints(metaData);}else{await this.race.getCurrentProm();this.metaData=Object.assign({},this.metaData,params);this._prepareData();}
this.notify();}
_buildMetaData(params){const{comparison,domain,context,groupBy}=this.searchParams;const metaData=Object.assign({},this.metaData,{context});if(comparison){metaData.domains=comparison.domains;metaData.comparisonField=comparison.fieldName;}else{metaData.domains=[{arrayRepr:domain,description:null}];}
metaData.measure=context.graph_measure||metaData.measure;metaData.mode=context.graph_mode||metaData.mode;metaData.groupBy=groupBy.length?groupBy:this.initialGroupBy;this._normalize(metaData);metaData.measures=computeReportMeasures(metaData.fields,metaData.fieldAttrs,[metaData.measure],metaData.additionalMeasures);return Object.assign(metaData,params);}
async _fetchDataPoints(metaData){this.dataPoints=await this.keepLast.add(this._loadDataPoints(metaData));this.metaData=metaData;this._prepareData();}
_getData(dataPoints){const{comparisonField,groupBy,mode}=this.metaData;let identify=false;if(comparisonField&&groupBy.length&&groupBy[0].fieldName===comparisonField){identify=true;}
const dateClasses=identify?this._getDateClasses(dataPoints):null;let labels=[];const labelMap={};for(const dataPt of dataPoints){const x=dataPt.labels.slice(0,mode==="pie"?undefined:1);const trueLabel=x.length?x.join(SEP):this.env._t("Total");if(dateClasses){x[0]=dateClasses.classLabel(dataPt.originIndex,x[0]);}
const key=JSON.stringify(x);if(labelMap[key]===undefined){labelMap[key]=labels.length;if(dateClasses){if(mode==="pie"){x[0]=dateClasses.classMembers(x[0]).join(", ");}else{x[0]=dateClasses.representative(x[0]);}}
const label=x.length?x.join(SEP):this.env._t("Total");labels.push(label);}
dataPt.labelIndex=labelMap[key];dataPt.trueLabel=trueLabel;}
const datasetsTmp={};for(const dataPt of dataPoints){const{domain,labelIndex,originIndex,trueLabel,value}=dataPt;const datasetLabel=this._getDatasetLabel(dataPt);if(!(datasetLabel in datasetsTmp)){let dataLength=labels.length;if(mode!=="pie"&&dateClasses){dataLength=dateClasses.arrayLength(originIndex);}
datasetsTmp[datasetLabel]={data:new Array(dataLength).fill(0),trueLabels:labels.slice(0,dataLength),domains:new Array(dataLength).fill([]),label:datasetLabel,originIndex:originIndex,};}
datasetsTmp[datasetLabel].data[labelIndex]=value;datasetsTmp[datasetLabel].domains[labelIndex]=domain;datasetsTmp[datasetLabel].trueLabels[labelIndex]=trueLabel;}
let datasets=sortBy(Object.values(datasetsTmp),"originIndex");if(mode==="pie"){datasets=datasets.filter((dataset)=>dataset.data.some((v)=>Boolean(v)));const labelsToKeepIndexes={};labels.forEach((_,index)=>{if(datasets.some((dataset)=>Boolean(dataset.data[index]))){labelsToKeepIndexes[index]=true;}});labels=labels.filter((_,index)=>labelsToKeepIndexes[index]);for(const dataset of datasets){dataset.data=dataset.data.filter((_,index)=>labelsToKeepIndexes[index]);dataset.domains=dataset.domains.filter((_,index)=>labelsToKeepIndexes[index]);dataset.trueLabels=dataset.trueLabels.filter((_,index)=>labelsToKeepIndexes[index]);}}
return{datasets,labels};}
_getDatasetLabel(dataPoint){const{measure,measures,domains,mode}=this.metaData;const{labels,originIndex}=dataPoint;if(mode==="pie"){return domains[originIndex].description||"";}
let datasetLabel=labels.slice(1).join(SEP);if(domains.length>1){datasetLabel=domains[originIndex].description+(datasetLabel?SEP+datasetLabel:"");}
datasetLabel=datasetLabel||measures[measure].string;return datasetLabel;}
_getDateClasses(dataPoints){const{domains}=this.metaData;const dateSets=domains.map(()=>new Set());for(const{labels,originIndex}of dataPoints){const date=labels[0];dateSets[originIndex].add(date);}
const arrays=dateSets.map((dateSet)=>[...dateSet]);return new DateClasses(arrays);}
_getProcessedDataPoints(){const{domains,groupBy,mode,order}=this.metaData;let processedDataPoints=[];if(mode==="line"){processedDataPoints=this.dataPoints.filter((dataPoint)=>dataPoint.labels[0]!==this.env._t("Undefined"));}else{processedDataPoints=this.dataPoints.filter((dataPoint)=>dataPoint.count!==0);}
if(order!==null&&mode!=="pie"&&domains.length===1&&groupBy.length>0){const groupedDataPoints={};for(const dataPt of processedDataPoints){const key=dataPt.labels[0];if(!groupedDataPoints[key]){groupedDataPoints[key]=[];}
groupedDataPoints[key].push(dataPt);}
const groups=Object.values(groupedDataPoints);const groupTotal=(group)=>group.reduce((sum,dataPt)=>sum+dataPt.value,0);processedDataPoints=sortBy(groups,groupTotal,order.toLowerCase()).flat();}
return processedDataPoints;}
_isValidData(dataPoints){const{mode}=this.metaData;let somePositive=false;let someNegative=false;if(mode==="pie"){for(const dataPt of dataPoints){if(dataPt.value>0){somePositive=true;}else if(dataPt.value<0){someNegative=true;}}
if(someNegative&&somePositive){return false;}}
return true;}
async _loadDataPoints(metaData){const{measure,domains,fields,groupBy,resModel}=metaData;const measures=["__count"];if(measure!=="__count"){let{group_operator,type}=fields[measure];if(type==="many2one"){group_operator="count_distinct";}
if(group_operator===undefined){throw new Error(`No aggregate function has been provided for the measure '${measure}'`);}
measures.push(`${measure}:${group_operator}`);}
const proms=[];const numbering={};domains.forEach((domain,originIndex)=>{proms.push(this.orm.webReadGroup(resModel,domain.arrayRepr,measures,groupBy.map((gb)=>gb.spec),{lazy:false},{fill_temporal:true,...this.searchParams.context}).then((data)=>{const dataPoints=[];for(const group of data.groups){const{__domain,__count}=group;const labels=[];for(const gb of groupBy){let label;const val=group[gb.spec];const fieldName=gb.fieldName;const{type}=fields[fieldName];if(type==="boolean"){label=`${val}`;}else if(val===false){label=this.env._t("Undefined");}else if(type==="many2one"){const[id,name]=val;const key=JSON.stringify([fieldName,name]);if(!numbering[key]){numbering[key]={};}
const numbers=numbering[key];if(!numbers[id]){numbers[id]=Object.keys(numbers).length+1;}
const num=numbers[id];label=num===1?name:`${name} (${num})`;}else if(type==="selection"){const selected=fields[fieldName].selection.find((s)=>s[0]===val);label=selected[1];}else{label=val;}
labels.push(label);}
let value=group[measure];if(value instanceof Array){value=1;}
if(!Number.isInteger(value)){metaData.allIntegers=false;}
dataPoints.push({count:__count,domain:__domain,value,labels,originIndex,});}
return dataPoints;}));});const promResults=await Promise.all(proms);return promResults.flat();}
_normalize(metaData){const{fields}=metaData;const groupBy=[];for(const gb of metaData.groupBy){let ngb=gb;if(typeof gb==="string"){ngb=getGroupBy(gb,fields);}
groupBy.push(ngb);}
const processedGroupBy=[];for(const gb of groupBy){const{fieldName,interval}=gb;const{sortable,type}=fields[fieldName];if(!sortable||["id","__count"].includes(fieldName)||!GROUPABLE_TYPES.includes(type)){continue;}
const index=processedGroupBy.findIndex((gb)=>gb.fieldName===fieldName);if(index===-1){processedGroupBy.push(gb);}else if(interval){const registeredInterval=processedGroupBy[index].interval;if(rankInterval(registeredInterval)<rankInterval(interval)){processedGroupBy.splice(index,1,gb);}}}
metaData.groupBy=processedGroupBy;metaData.measure=processMeasure(metaData.measure);}
async _prepareData(){const processedDataPoints=this._getProcessedDataPoints();this.data=null;if(this._isValidData(processedDataPoints)){this.data=this._getData(processedDataPoints);}}}
return __exports;});;

/* /web/static/src/views/graph/graph_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/graph/graph_renderer',async function(require){'use strict';let __exports={};const{_lt}=require("@web/core/l10n/translation");const{BORDER_WHITE,DEFAULT_BG,getColor,hexToRGBA}=require("@web/views/graph/colors");const{formatFloat}=require("@web/fields/formatters");const{SEP}=require("@web/views/graph/graph_model");const{sortBy}=require("@web/core/utils/arrays");const{useAssets}=require("@web/core/assets");const{useEffect}=require("@web/core/utils/hooks");const{Component,hooks}=owl;const{useRef}=hooks;const NO_DATA=_lt("No data");function getMaxWidth(chartArea){const{left,right}=chartArea;return Math.floor((right-left)/1.618)+"px";}
function shortenLabel(label){const groups=label.toString().split(SEP);let shortLabel=groups.slice(0,3).join(SEP);if(shortLabel.length>30){shortLabel=`${shortLabel.slice(0, 30)}...`;}else if(groups.length>3){shortLabel=`${shortLabel}${SEP}...`;}
return shortLabel;}
const GraphRenderer=__exports.GraphRenderer=class GraphRenderer extends Component{setup(){this.model=this.props.model;this.canvasRef=useRef("canvas");this.containerRef=useRef("container");this.chart=null;this.tooltip=null;this.legendTooltip=null;useAssets({jsLibs:["/web/static/lib/Chart/Chart.js"]});useEffect(()=>this.renderChart());}
willUnmount(){if(this.chart){this.chart.destroy();}}
adjustTooltipHeight(tooltip,maxTooltipHeight){const sizeOneLine=tooltip.querySelector("tbody tr").clientHeight;const tbodySize=tooltip.querySelector("tbody").clientHeight;const toKeep=Math.max(0,Math.floor((maxTooltipHeight-(tooltip.clientHeight-tbodySize))/sizeOneLine)-1);const lines=tooltip.querySelectorAll("tbody tr");const toRemove=lines.length-toKeep;if(toRemove>0){for(let index=toKeep;index<lines.length;++index){lines[index].remove();}
const tr=document.createElement("tr");const td=document.createElement("td");tr.classList.add("o_show_more");td.innerText=this.env._t("...");tr.appendChild(td);tooltip.querySelector("tbody").appendChild(tr);}}
customTooltip(data,metaData,tooltipModel){const{measure,measures,disableLinking,mode}=metaData;this.el.style.cursor="";this.removeTooltips();if(tooltipModel.opacity===0||tooltipModel.dataPoints.length===0){return;}
if(!disableLinking&&mode!=="line"){this.el.style.cursor="pointer";}
const chartAreaTop=this.chart.chartArea.top;const viewContentTop=this.el.getBoundingClientRect().top;const innerHTML=this.env.qweb.renderToString("web.GraphRenderer.CustomTooltip",{maxWidth:getMaxWidth(this.chart.chartArea),measure:measures[measure].string,mode:this.model.metaData.mode,tooltipItems:this.getTooltipItems(data,metaData,tooltipModel),});const template=Object.assign(document.createElement("template"),{innerHTML});const tooltip=template.content.firstChild;this.containerRef.el.prepend(tooltip);let top;const tooltipHeight=tooltip.clientHeight;const minTopAllowed=Math.floor(chartAreaTop);const maxTopAllowed=Math.floor(window.innerHeight-(viewContentTop+tooltipHeight))-2;const y=Math.floor(tooltipModel.y);if(minTopAllowed<=maxTopAllowed){if(y<=maxTopAllowed){if(y>=minTopAllowed){top=y;}else{top=minTopAllowed;}}else{top=maxTopAllowed;}}else{top=minTopAllowed;const maxTooltipHeight=window.innerHeight-(viewContentTop+chartAreaTop)-2;this.adjustTooltipHeight(tooltip,maxTooltipHeight);}
this.fixTooltipLeftPosition(tooltip,tooltipModel.x);tooltip.style.top=Math.floor(top)+"px";this.tooltip=tooltip;}
fixTooltipLeftPosition(tooltip,x){let left;const tooltipWidth=tooltip.clientWidth;const minLeftAllowed=Math.floor(this.chart.chartArea.left+2);const maxLeftAllowed=Math.floor(this.chart.chartArea.right-tooltipWidth-2);x=Math.floor(x);if(x<minLeftAllowed){left=minLeftAllowed;}else if(x>maxLeftAllowed){left=maxLeftAllowed;}else{left=x;}
tooltip.style.left=`${left}px`;}
formatValue(value,allIntegers=true){const largeNumber=Math.abs(value)>=1000;if(allIntegers&&!largeNumber){return String(value);}
if(largeNumber){return formatFloat(value,{humanReadable:true,decimals:2,minDigits:1});}
return formatFloat(value);}
getBarChartData(){const{domains,stacked}=this.model.metaData;const data=this.model.data;for(let index=0;index<data.datasets.length;++index){const dataset=data.datasets[index];if(stacked){dataset.stack=domains[dataset.originIndex].description||"";}
dataset.backgroundColor=getColor(index);}
return data;}
getChartConfig(){const{mode}=this.model.metaData;let data;switch(mode){case"bar":data=this.getBarChartData();break;case"line":data=this.getLineChartData();break;case"pie":data=this.getPieChartData();}
const options=this.prepareOptions();return{data,options,type:mode};}
getElementOptions(){const{mode}=this.model.metaData;const elementOptions={};if(mode==="bar"){elementOptions.rectangle={borderWidth:1};}else if(mode==="line"){elementOptions.line={fill:false,tension:0};}
return elementOptions;}
getLegendOptions(){const{mode}=this.model.metaData;const data=this.model.data;const refLength=mode==="pie"?data.labels.length:data.datasets.length;const legendOptions={display:refLength<=20,position:"top",onHover:this.onlegendHover.bind(this),onLeave:this.onLegendLeave.bind(this),};if(mode==="line"){legendOptions.onClick=this.onLegendClick.bind(this);}
if(mode==="pie"){legendOptions.labels={generateLabels:(chart)=>{const{data}=chart;const metaData=data.datasets.map((_,index)=>chart.getDatasetMeta(index).data);const labels=data.labels.map((label,index)=>{const hidden=metaData.some((data)=>data[index]&&data[index].hidden);const fullText=label;const text=shortenLabel(fullText);const fillStyle=label===NO_DATA?DEFAULT_BG:getColor(index);return{text,fullText,fillStyle,hidden,index};});return labels;},};}else{const referenceColor=mode==="bar"?"backgroundColor":"borderColor";legendOptions.labels={generateLabels:(chart)=>{const{data}=chart;const labels=data.datasets.map((dataset,index)=>{return{text:shortenLabel(dataset.label),fullText:dataset.label,fillStyle:dataset[referenceColor],hidden:!chart.isDatasetVisible(index),lineCap:dataset.borderCapStyle,lineDash:dataset.borderDash,lineDashOffset:dataset.borderDashOffset,lineJoin:dataset.borderJoinStyle,lineWidth:dataset.borderWidth,strokeStyle:dataset[referenceColor],pointStyle:dataset.pointStyle,datasetIndex:index,};});return labels;},};}
return legendOptions;}
getLineChartData(){const{groupBy,domains}=this.model.metaData;const data=this.model.data;for(let index=0;index<data.datasets.length;++index){const dataset=data.datasets[index];if(groupBy.length<=1&&domains.length>1){if(dataset.originIndex===0){dataset.fill="origin";dataset.backgroundColor=hexToRGBA(getColor(0),0.4);dataset.borderColor=getColor(0);}else if(dataset.originIndex===1){dataset.borderColor=getColor(1);}else{dataset.borderColor=getColor(index);}}else{dataset.borderColor=getColor(index);}
if(data.labels.length===1){dataset.data.unshift(undefined);dataset.trueLabels.unshift(undefined);dataset.domains.unshift(undefined);}
dataset.pointBackgroundColor=dataset.borderColor;dataset.pointBorderColor="rgba(0,0,0,0.2)";}
if(data.datasets.length===1&&data.datasets[0].originIndex===0){const dataset=data.datasets[0];dataset.fill="origin";dataset.backgroundColor=hexToRGBA(getColor(0),0.4);}
data.labels=data.labels.length>1?data.labels:["",...data.labels,""];return data;}
getPieChartData(){const{domains}=this.model.metaData;const data=this.model.data;const colors=data.labels.map((_,index)=>getColor(index));for(const dataset of data.datasets){dataset.backgroundColor=colors;dataset.borderColor=BORDER_WHITE;}
const representedOriginIndexes=new Set(data.datasets.map((dataset)=>dataset.originIndex));let addNoDataToLegend=false;const fakeData=new Array(data.labels.length+1);fakeData[data.labels.length]=1;const fakeTrueLabels=new Array(data.labels.length+1);fakeTrueLabels[data.labels.length]=NO_DATA;for(let index=0;index<domains.length;++index){if(!representedOriginIndexes.has(index)){data.datasets.push({label:domains[index].description,data:fakeData,trueLabels:fakeTrueLabels,backgroundColor:[...colors,DEFAULT_BG],borderColor:BORDER_WHITE,});addNoDataToLegend=true;}}
if(addNoDataToLegend){data.labels.push(NO_DATA);}
return data;}
getScaleOptions(){const{allIntegers,displayScaleLabels,fields,groupBy,measure,measures,mode,}=this.model.metaData;if(mode==="pie"){return{};}
const xAxe={type:"category",scaleLabel:{display:Boolean(groupBy.length&&displayScaleLabels),labelString:groupBy.length?fields[groupBy[0].fieldName].string:"",},};const yAxe={type:"linear",scaleLabel:{display:displayScaleLabels,labelString:measures[measure].string,},ticks:{callback:(value)=>this.formatValue(value,allIntegers),suggestedMax:0,suggestedMin:0,},};return{xAxes:[xAxe],yAxes:[yAxe]};}
getTooltipItems(data,metaData,tooltipModel){const{allIntegers,domains,mode,groupBy}=metaData;const sortedDataPoints=sortBy(tooltipModel.dataPoints,"yLabel","desc");const items=[];for(const item of sortedDataPoints){const id=item.index;const dataset=data.datasets[item.datasetIndex];let label=dataset.trueLabels[id];let value=this.formatValue(dataset.data[id],allIntegers);let boxColor;let percentage;if(mode==="pie"){if(label===NO_DATA){value=this.formatValue(0,allIntegers);}
if(domains.length>1){label=`${dataset.label} / ${label}`;}
boxColor=dataset.backgroundColor[id];const totalData=dataset.data.reduce((a,b)=>a+b,0);percentage=totalData&&((dataset.data[item.index]*100)/totalData).toFixed(2);}else{if(groupBy.length>1||domains.length>1){label=`${label} / ${dataset.label}`;}
boxColor=mode==="bar"?dataset.backgroundColor:dataset.borderColor;}
items.push({id,label,value,boxColor,percentage});}
return items;}
getTooltipOptions(){const{data,metaData}=this.model;const{mode}=metaData;const tooltipOptions={enabled:false,custom:this.customTooltip.bind(this,data,metaData),};if(mode==="line"){tooltipOptions.mode="index";tooltipOptions.intersect=false;}
return tooltipOptions;}
onGraphClicked(ev){const[activeElement]=this.chart.getElementAtEvent(ev);if(!activeElement){return;}
const{_datasetIndex,_index}=activeElement;const{domains}=this.chart.data.datasets[_datasetIndex];if(domains){this.props.onGraphClicked(domains[_index]);}}
onLegendClick(ev,legendItem){this.removeTooltips();const index=legendItem.datasetIndex;const meta=this.chart.getDatasetMeta(index);meta.hidden=meta.hidden===null?!this.chart.data.datasets[index].hidden:null;this.chart.update();}
onlegendHover(ev,legendItem){this.canvasRef.el.style.cursor="pointer";const{fullText,text}=legendItem;if(this.legendTooltip||text===fullText){return;}
const viewContentTop=this.el.getBoundingClientRect().top;const legendTooltip=Object.assign(document.createElement("div"),{className:"o_tooltip_legend",innerText:fullText,});legendTooltip.style.top=`${ev.clientY - viewContentTop}px`;legendTooltip.style.maxWidth=getMaxWidth(this.chart.chartArea);this.containerRef.el.appendChild(legendTooltip);this.fixTooltipLeftPosition(legendTooltip,ev.clientX);this.legendTooltip=legendTooltip;}
onLegendLeave(){this.canvasRef.el.style.cursor="";this.removeLegendTooltip();}
prepareOptions(){const{disableLinking,mode}=this.model.metaData;const options={maintainAspectRatio:false,scales:this.getScaleOptions(),legend:this.getLegendOptions(),tooltips:this.getTooltipOptions(),elements:this.getElementOptions(),};if(!disableLinking&&mode!=="line"){options.onClick=this.onGraphClicked.bind(this);}
return options;}
removeLegendTooltip(){if(this.legendTooltip){this.legendTooltip.remove();this.legendTooltip=null;}}
removeTooltips(){if(this.tooltip){this.tooltip.remove();this.tooltip=null;}
this.removeLegendTooltip();}
renderChart(){if(this.chart){this.chart.destroy();}
const config=this.getChartConfig();this.chart=new Chart(this.canvasRef.el,config);Chart.animationService.advance();}}
GraphRenderer.template="web.GraphRenderer";GraphRenderer.props=["model","onGraphClicked"];return __exports;});;

/* /web/static/src/views/graph/graph_view.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/graph/graph_view',async function(require){'use strict';let __exports={};const{_lt}=require("@web/core/l10n/translation");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{GroupByMenu}=require("@web/search/group_by_menu/group_by_menu");const{standardViewProps}=require("@web/views/helpers/standard_view_props");const{useSetupView}=require("@web/views/helpers/view_hook");const{Layout}=require("@web/views/layout");const{useModel}=require("@web/views/helpers/model");const{GraphArchParser}=require("@web/views/graph/graph_arch_parser");const{GraphModel}=require("@web/views/graph/graph_model");const{GraphRenderer}=require("@web/views/graph/graph_renderer");const viewRegistry=registry.category("views");const{Component}=owl;const GraphView=__exports.GraphView=class GraphView extends Component{setup(){this.actionService=useService("action");let modelParams;if(this.props.state){modelParams=this.props.state.metaData;}else{const{arch,fields}=this.props;const parser=new this.constructor.ArchParser();const archInfo=parser.parse(arch,fields);modelParams={additionalMeasures:this.props.additionalMeasures,disableLinking:Boolean(archInfo.disableLinking),displayScaleLabels:this.props.displayScaleLabels,fieldAttrs:archInfo.fieldAttrs,fields:this.props.fields,groupBy:archInfo.groupBy,measure:archInfo.measure||"__count",mode:archInfo.mode||"bar",order:archInfo.order||null,resModel:this.props.resModel,stacked:"stacked"in archInfo?archInfo.stacked:true,title:archInfo.title||this.env._t("Untitled"),};}
this.model=useModel(this.constructor.Model,modelParams);useSetupView({getLocalState:()=>{return{metaData:this.model.metaData};},getContext:()=>this.getContext(),});}
getContext(){const{measure,groupBy,mode}=this.model.metaData;return{graph_measure:measure,graph_mode:mode,graph_groupbys:groupBy.map((gb)=>gb.spec),};}
onGraphClicked(domain){const{context,resModel,title}=this.model.metaData;const views={};for(const[viewId,viewType]of this.env.config.views||[]){views[viewType]=viewId;}
function getView(viewType){return[views[viewType]||false,viewType];}
const actionViews=[getView("list"),getView("form")];this.actionService.doAction({context,domain,name:title,res_model:resModel,target:"current",type:"ir.actions.act_window",views:actionViews,},{viewType:"list",});}
onMeasureSelected(ev){const{measure}=ev.detail.payload;this.model.updateMetaData({measure});}
onModeSelected(mode){this.model.updateMetaData({mode});}
toggleOrder(order){const{order:currentOrder}=this.model.metaData;const nextOrder=currentOrder===order?null:order;this.model.updateMetaData({order:nextOrder});}
toggleStacked(){const{stacked}=this.model.metaData;this.model.updateMetaData({stacked:!stacked});}}
GraphView.template="web.GraphView";GraphView.buttonTemplate="web.GraphView.Buttons";GraphView.components={GroupByMenu,Renderer:GraphRenderer,Layout};GraphView.defaultProps={additionalMeasures:[],displayGroupByMenu:false,displayScaleLabels:true,};GraphView.props={...standardViewProps,additionalMeasures:{type:Array,elements:String,optional:true},displayGroupByMenu:{type:Boolean,optional:true},displayScaleLabels:{type:Boolean,optional:true},};GraphView.type="graph";GraphView.display_name=_lt("Graph");GraphView.icon="fa-bar-chart";GraphView.multiRecord=true;GraphView.Model=GraphModel;GraphView.ArchParser=GraphArchParser;GraphView.searchMenuTypes=["filter","groupBy","comparison","favorite"];viewRegistry.add("graph",GraphView);return __exports;});;

/* /web/static/src/views/helpers/model.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/helpers/model',async function(require){'use strict';let __exports={};const{SEARCH_KEYS}=require("@web/search/with_search/with_search");const{useBus,useService}=require("@web/core/utils/hooks");const{buildSampleORM}=require("@web/views/helpers/sample_server");const{useSetupView}=require("@web/views/helpers/view_hook");const{core,hooks}=owl;const{EventBus}=core;const{onWillStart,onWillUpdateProps,useComponent}=hooks;const Model=__exports.Model=class Model extends EventBus{constructor(env,params,services){super();this.env=env;this.orm=services.orm;this.useSampleModel=false;this.setup(params,services);}
setup(){}
async load(){}
hasData(){return true;}
notify(){this.trigger("update");}}
Model.services=[];function getSearchParams(props){const params={};for(const key of SEARCH_KEYS){params[key]=props[key];}
return params;}
__exports.useModel=useModel;function useModel(ModelClass,params,options={}){const component=useComponent();if(!(ModelClass.prototype instanceof Model)){throw new Error(`the model class should extend Model`);}
const services={};for(const key of ModelClass.services){services[key]=useService(key);}
services.orm=services.orm||useService("orm");const model=new ModelClass(component.env,params,services);useBus(model,"update",options.onUpdate||component.render);const globalState=component.props.globalState||{};let useSampleModel=Boolean("useSampleModel"in globalState?globalState.useSampleModel:component.props.useSampleModel);model.useSampleModel=useSampleModel;const orm=model.orm;let sampleORM=globalState.sampleORM;const user=useService("user");async function load(props){model.orm=orm;const searchParams=getSearchParams(props);await model.load(searchParams);if(useSampleModel&&!model.hasData()){sampleORM=sampleORM||buildSampleORM(component.props.resModel,component.props.fields,user);model.orm=sampleORM;await model.load(searchParams);}else{useSampleModel=false;}
model.useSampleModel=useSampleModel;}
onWillStart(()=>{return load(component.props);});onWillUpdateProps((nextProps)=>{useSampleModel=false;return load(nextProps);});useSetupView({getGlobalState(){return{sampleORM,useSampleModel:model.useSampleModel,};},});return model;}
return __exports;});;

/* /web/static/src/views/helpers/sample_server.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/helpers/sample_server',async function(require){'use strict';let __exports={};const{groupBy:arrayGroupBy,sortBy:arraySortBy}=require("@web/core/utils/arrays");const{registry}=require("@web/core/registry");const{ORM}=require("@web/core/orm_service");const{parseDate}=require("@web/core/l10n/dates");class UnimplementedRouteError extends Error{}
function getSampleFromId(id,sampleTexts){return sampleTexts[(id-1)%sampleTexts.length];}
function fieldNameRegex(...terms){return new RegExp(`\\b((\\w+)?_)?(${terms.join("|")})(_(\\w+)?)?\\b`);}
const MEASURE_SPEC_REGEX=/(?<measure>\w+):(?<aggregateFunction>\w+)(\((?<fieldName>\w+)\))?/;const DESCRIPTION_REGEX=fieldNameRegex("description","label","title","subject","message");const EMAIL_REGEX=fieldNameRegex("email");const PHONE_REGEX=fieldNameRegex("phone");const URL_REGEX=fieldNameRegex("url");const SampleServer=__exports.SampleServer=class SampleServer{constructor(modelName,fields){this.mainModel=modelName;this.data={};this.data[modelName]={fields,records:[],};for(const fieldName in fields){const field=fields[fieldName];if(["many2one","one2many","many2many"].includes(field.type)){this.data[field.relation]=this.data[field.relation]||{fields:{display_name:{type:"char"},id:{type:"integer"},color:{type:"integer"},},records:[],};}}
this.existingGroups=null;this.populated=false;this.existingGroupsPopulated=false;}
mockRpc(params){if(!(params.model in this.data)){throw new Error(`SampleServer: unknown model ${params.model}`);}
this._populateModels();switch(params.method||params.route){case"/web/dataset/search_read":return this._mockSearchReadController(params);case"web_read_group":return this._mockWebReadGroup(params);case"read_group":return this._mockReadGroup(params);case"read_progress_bar":return this._mockReadProgressBar(params);case"read":return this._mockRead(params);}
const method=params.method||params.route;const mockFunction=registry.category("sample_server").get(`${params.model}/${method}`,null)||registry.category("sample_server").get(method,null);if(mockFunction){return mockFunction.call(this,params);}
console.log(`SampleServer: unimplemented route "${params.method || params.route}"`);throw new SampleServer.UnimplementedRouteError();}
setExistingGroups(groups){this.existingGroups=groups;}
_aggregateFields(measures,records){const values={};for(const{fieldName,type}of measures){if(["float","integer","monetary"].includes(type)){if(records.length){let value=0;for(const record of records){value+=record[fieldName];}
values[fieldName]=this._sanitizeNumber(value);}else{values[fieldName]=null;}}
if(type==="many2one"){const ids=new Set(records.map((r)=>r[fieldName]));values.fieldName=ids.size||null;}}
return values;}
_formatValue(value,options){if(!value){return false;}
const{type,interval,relation}=options;if(["date","datetime"].includes(type)){const fmt=SampleServer.FORMATS[interval];return parseDate(value).toFormat(fmt);}else if(type==="many2one"){const rec=this.data[relation].records.find(({id})=>id===value);return[value,rec.display_name];}else{return value;}}
_generateFieldValue(modelName,fieldName,id){const field=this.data[modelName].fields[fieldName];switch(field.type){case"boolean":return fieldName==="active"?true:this._getRandomBool();case"char":case"text":if(["display_name","name"].includes(fieldName)){if(SampleServer.PEOPLE_MODELS.includes(modelName)){return getSampleFromId(id,SampleServer.SAMPLE_PEOPLE);}else if(modelName==="res.country"){return getSampleFromId(id,SampleServer.SAMPLE_COUNTRIES);}}
if(fieldName==="display_name"){return getSampleFromId(id,SampleServer.SAMPLE_TEXTS);}else if(["name","reference"].includes(fieldName)){return`REF${String(id).padStart(4, "0")}`;}else if(DESCRIPTION_REGEX.test(fieldName)){return getSampleFromId(id,SampleServer.SAMPLE_TEXTS);}else if(EMAIL_REGEX.test(fieldName)){const emailName=getSampleFromId(id,SampleServer.SAMPLE_PEOPLE).replace(/ /,".").toLowerCase();return`${emailName}@sample.demo`;}else if(PHONE_REGEX.test(fieldName)){return`+1 555 754 ${String(id).padStart(4, "0")}`;}else if(URL_REGEX.test(fieldName)){return`http://sample${id}.com`;}
return false;case"date":case"datetime":{const format=field.type==="date"?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss";return this._getRandomDate(format);}
case"float":return this._getRandomFloat(SampleServer.MAX_FLOAT);case"integer":{let max=SampleServer.MAX_INTEGER;if(fieldName.includes("color")){max=this._getRandomBool()?SampleServer.MAX_COLOR_INT:0;}
return this._getRandomInt(max);}
case"monetary":return this._getRandomInt(SampleServer.MAX_MONETARY);case"many2one":if(field.relation==="res.currency"){return 1;}
if(field.relation==="ir.attachment"){return false;}
return this._getRandomSubRecordId();case"one2many":case"many2many":{const ids=[this._getRandomSubRecordId(),this._getRandomSubRecordId()];return[...new Set(ids)];}
case"selection":{if(fieldName==="activity_exception_decoration"){return false;}
if(field.selection.length>0){return this._getRandomArrayEl(field.selection)[0];}
return false;}
default:return false;}}
_getRandomArrayEl(array){return array[Math.floor(Math.random()*array.length)];}
_getRandomBool(){return Math.random()<0.5;}
_getRandomDate(format){const delta=Math.floor((Math.random()-Math.random())*SampleServer.DATE_DELTA);return luxon.DateTime.local().plus({hours:delta}).toFormat(format);}
_getRandomFloat(max){return this._sanitizeNumber(Math.random()*max);}
_getRandomInt(max){return Math.floor(Math.random()*max);}
_getRandomSubRecordId(){return Math.floor(Math.random()*SampleServer.SUB_RECORDSET_SIZE)+1;}
_mockRead(params){const model=this.data[params.model];const ids=params.args[0];const fieldNames=params.args[1];const records=[];for(const r of model.records){if(!ids.includes(r.id)){continue;}
const record={id:r.id};for(const fieldName of fieldNames){const field=model.fields[fieldName];if(!field){record[fieldName]=false;}else if(field.type==="many2one"){const relModel=this.data[field.relation];const relRecord=relModel.records.find((relR)=>r[fieldName]===relR.id);record[fieldName]=relRecord?[relRecord.id,relRecord.display_name]:false;}else{record[fieldName]=r[fieldName];}}
records.push(record);}
return records;}
_mockReadGroup(params){const lazy="lazy"in params?params.lazy:true;const model=params.model;const fields=this.data[model].fields;const records=this.data[model].records;const normalizedGroupBys=[];let groupBy=[];if(params.groupBy.length){groupBy=lazy?[params.groupBy[0]]:params.groupBy;}
for(const groupBySpec of groupBy){let[fieldName,interval]=groupBySpec.split(":");interval=interval||"month";const{type,relation}=fields[fieldName];if(type){const gb={fieldName,type,interval,relation,alias:groupBySpec};normalizedGroupBys.push(gb);}}
const groups=arrayGroupBy(records,(record)=>{const vals={};for(const gb of normalizedGroupBys){const{fieldName,type}=gb;let value;if(["date","datetime"].includes(type)){value=this._formatValue(record[fieldName],gb);}else{value=record[fieldName];}
vals[fieldName]=value;}
return JSON.stringify(vals);});const measures=[];for(const measureSpec of params.fields||Object.keys(fields)){const matches=measureSpec.match(MEASURE_SPEC_REGEX);const{fieldName,aggregateFunction,measure}=(matches&&matches.groups)||{};if(!fieldName&&!measure){continue;}
const fName=fieldName||measure;const{type}=fields[fName];if(!params.groupBy.includes(fName)&&type&&(type!=="many2one"||aggregateFunction!=="count_distinct")){measures.push({fieldName:fName,type});}}
let result=[];for(const id in groups){const records=groups[id];const group={__domain:[]};let countKey=`__count`;if(normalizedGroupBys.length&&lazy){countKey=`${normalizedGroupBys[0].fieldName}_count`;}
group[countKey]=records.length;const firstElem=records[0];for(const gb of normalizedGroupBys){const{alias,fieldName}=gb;group[alias]=this._formatValue(firstElem[fieldName],gb);}
Object.assign(group,this._aggregateFields(measures,records));result.push(group);}
if(normalizedGroupBys.length>0){const{alias,interval,type}=normalizedGroupBys[0];result=arraySortBy(result,(group)=>{const val=group[alias];if(["date","datetime"].includes(type)){return parseDate(val,{format:SampleServer.FORMATS[interval]});}
return val;});}
return result;}
_mockReadProgressBar(params){const groupBy=params.kwargs.group_by;const progress_bar=params.kwargs.progress_bar;const groupByField=this.data[params.model].fields[groupBy];const data={};for(const record of this.data[params.model].records){let groupByValue=record[groupBy];if(groupByField.type==="many2one"){const relatedRecords=this.data[groupByField.relation].records;const relatedRecord=relatedRecords.find((r)=>r.id===groupByValue);groupByValue=relatedRecord.display_name;}
if(!(groupByValue in data)){data[groupByValue]={};for(const key in progress_bar.colors){data[groupByValue][key]=0;}}
const fieldValue=record[progress_bar.field];if(fieldValue in data[groupByValue]){data[groupByValue][fieldValue]++;}}
return data;}
_mockSearchReadController(params){const model=this.data[params.model];const rawRecords=model.records.slice(0,SampleServer.SEARCH_READ_LIMIT);const records=this._mockRead({model:params.model,args:[rawRecords.map((r)=>r.id),params.fields],});return{records,length:records.length};}
_mockWebReadGroup(params){let groups;if(this.existingGroups){this._tweakExistingGroups(params);groups=this.existingGroups;}else{groups=this._mockReadGroup(params);}
return{groups,length:groups.length,};}
_populateExistingGroups(params){if(!this.existingGroupsPopulated){const groups=this.existingGroups;this.groupsInfo=groups;const groupBy=params.groupBy[0];const values=groups.map((g)=>g[groupBy]);const groupByField=this.data[params.model].fields[groupBy];const groupedByM2O=groupByField.type==="many2one";if(groupedByM2O){this.data[groupByField.relation].records=values.map((v)=>{return{id:v[0],display_name:v[1]};});}
for(const r of this.data[params.model].records){const value=getSampleFromId(r.id,values);r[groupBy]=groupedByM2O?value[0]:value;}
this.existingGroupsPopulated=true;}}
_populateModels(){if(!this.populated){for(const modelName in this.data){const model=this.data[modelName];const fieldNames=Object.keys(model.fields).filter((f)=>f!=="id");const size=modelName===this.mainModel?SampleServer.MAIN_RECORDSET_SIZE:SampleServer.SUB_RECORDSET_SIZE;for(let id=1;id<=size;id++){const record={id};for(const fieldName of fieldNames){record[fieldName]=this._generateFieldValue(modelName,fieldName,id);}
model.records.push(record);}}
this.populated=true;}}
_sanitizeNumber(value){return parseFloat(value.toFixed(SampleServer.FLOAT_PRECISION));}
_tweakExistingGroups(params){const groups=this.existingGroups;this._populateExistingGroups(params);const groupBy=params.groupBy[0].split(":")[0];const groupByField=this.data[params.model].fields[groupBy];const groupedByM2O=groupByField.type==="many2one";const records=this.data[params.model].records;for(const g of groups){const groupValue=groupedByM2O?g[groupBy][0]:g[groupBy];const recordsInGroup=records.filter((r)=>r[groupBy]===groupValue);g[`${groupBy}_count`]=recordsInGroup.length;for(const field of params.fields){const fieldType=this.data[params.model].fields[field].type;if(["integer, float","monetary"].includes(fieldType)){g[field]=recordsInGroup.reduce((acc,r)=>acc+r[field],0);}}
g.__data={records:this._mockRead({model:params.model,args:[recordsInGroup.map((r)=>r.id),params.fields],}),length:recordsInGroup.length,};}}}
SampleServer.FORMATS={day:"yyyy-MM-dd",week:"'W'WW kkkk",month:"MMMM yyyy",quarter:"'Q'q yyyy",year:"y",};SampleServer.DISPLAY_FORMATS=Object.assign({},SampleServer.FORMATS,{day:"dd MMM yyyy"});SampleServer.MAIN_RECORDSET_SIZE=16;SampleServer.SUB_RECORDSET_SIZE=5;SampleServer.SEARCH_READ_LIMIT=10;SampleServer.MAX_FLOAT=100;SampleServer.MAX_INTEGER=50;SampleServer.MAX_COLOR_INT=7;SampleServer.MAX_MONETARY=100000;SampleServer.DATE_DELTA=24*60;SampleServer.FLOAT_PRECISION=2;SampleServer.SAMPLE_COUNTRIES=["Belgium","France","Portugal","Singapore","Australia"];SampleServer.SAMPLE_PEOPLE=["John Miller","Henry Campbell","Carrie Helle","Wendi Baltz","Thomas Passot",];SampleServer.SAMPLE_TEXTS=["Laoreet id","Volutpat blandit","Integer vitae","Viverra nam","In massa",];SampleServer.PEOPLE_MODELS=["res.users","res.partner","hr.employee","mail.followers","mailing.contact",];SampleServer.UnimplementedRouteError=UnimplementedRouteError;__exports.buildSampleORM=buildSampleORM;function buildSampleORM(resModel,fields,user){const sampleServer=new SampleServer(resModel,fields);const fakeRPC=async(_,params)=>{const{kwargs,method,model}=params;const{groupby:groupBy}=kwargs;return sampleServer.mockRpc({method,model,...kwargs,groupBy});};return new ORM(fakeRPC,user);}
return __exports;});;

/* /web/static/src/views/helpers/standard_view_props.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/helpers/standard_view_props',async function(require){'use strict';let __exports={};const standardViewProps=__exports.standardViewProps={info:{type:Object,},resModel:String,arch:{type:String},comparison:{validate:()=>true},context:{type:Object},domain:{type:Array},fields:{type:Object,elements:Object},groupBy:{type:Array,elements:String},limit:{type:Number,optional:1},orderBy:{type:Array,elements:String},useSampleModel:{type:Boolean},state:{type:Object,optional:1},globalState:{type:Object,optional:1},resId:{type:Number,optional:1},resIds:{type:Array,optional:1},bannerRoute:{type:String,optional:1},};return __exports;});;

/* /web/static/src/views/helpers/utils.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/helpers/utils',async function(require){'use strict';let __exports={};const{_t}=require("@web/core/l10n/translation");const archParseBoolean=__exports.archParseBoolean=(str)=>{return str!=="False"&&str!=="false"&&str!=="0"&&str!=="";};const computeReportMeasures=__exports.computeReportMeasures=(fields,fieldAttrs,activeMeasures,additionalMeasures=[])=>{const measures={__count:{name:"__count",string:_t("Count"),type:"integer"},};for(const[fieldName,field]of Object.entries(fields)){if(fieldName==="id"||!field.store){continue;}
const{isInvisible}=fieldAttrs[fieldName]||{};if(isInvisible&&!additionalMeasures.includes(fieldName)){continue;}
if(["integer","float","monetary"].includes(field.type)||additionalMeasures.includes(fieldName)){measures[fieldName]=field;}}
for(const measure of activeMeasures){if(!measures[measure]){measures[measure]=fields[measure];}}
for(const fieldName in fieldAttrs){if(fieldAttrs[fieldName].string&&fieldName in measures){measures[fieldName].string=fieldAttrs[fieldName].string;}}
const sortedMeasures=Object.entries(measures).sort(([m1,f1],[m2,f2])=>{if(m1==="__count"||m2==="__count"){return m1==="__count"?1:-1;}
return f1.string.toLowerCase().localeCompare(f2.string.toLowerCase());});return Object.fromEntries(sortedMeasures);};const processMeasure=__exports.processMeasure=(measure)=>{if(Array.isArray(measure)){return measure.map(processMeasure);}
return measure==="__count__"?"__count":measure;};return __exports;});;

/* /web/static/src/views/helpers/view_hook.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/helpers/view_hook',async function(require){'use strict';let __exports={};const{useDebugCategory}=require("@web/core/debug/debug_context");const{useSetupAction}=require("@web/webclient/actions/action_hook");const{registry}=require("@web/core/registry");const{useListener,useService}=require("@web/core/utils/hooks");const{evaluateExpr}=require("@web/core/py_js/py");const{useComponent}=owl.hooks;__exports.useSetupView=useSetupView;function useSetupView(params){const component=useComponent();useDebugCategory("view",{component});useSetupAction(params);}
__exports.useViewArch=useViewArch;function useViewArch(arch,params={}){const CATEGORY="__processed_archs__";arch=arch.trim();const processedRegistry=registry.category(CATEGORY);let processedArch;if(!processedRegistry.contains(arch)){processedArch={};processedRegistry.add(arch,processedArch);}else{processedArch=processedRegistry.get(arch);}
const{compile,extract}=params;if(!("template"in processedArch)&&compile){processedArch.template=owl.tags.xml`${compile(arch)}`;}
if(!("extracted"in processedArch)&&extract){processedArch.extracted=extract(arch);}
return processedArch;}
__exports.useActionLinks=useActionLinks;function useActionLinks({resModel,reload}){const selector=`a[type="action"]`;const component=owl.hooks.useComponent();const keepLast=component.env.keepLast;const orm=useService("orm");const{doAction}=useService("action");function checkAndCollapseBootstrap(target){if(target.dataset.toggle==="collapse"){$(target).trigger("click.bs.collapse.data-api");}}
async function handler(ev){ev.preventDefault();ev.stopPropagation();let target=ev.target;if(target.tagName!=="A"){target=target.closest("a");}
const data=target.dataset;if(data.method!==undefined&&data.model!==undefined){const options={};if(data.reloadOnClose){options.onClose=reload||(()=>component.render());}
const action=await keepLast.add(orm.call(data.model,data.method));if(action!==undefined){keepLast.add(Promise.resolve(doAction(action,options)));}}else if(target.getAttribute("name")){const options={};if(data.context){options.additionalContext=evaluateExpr(data.context);}
keepLast.add(doAction(target.getAttribute("name"),options));}else{let views;const resId=data.resid?parseInt(data.resid,10):null;if(data.views){views=evaluateExpr(data.views);}else{views=resId?[[false,"form"]]:[[false,"list"],[false,"form"],];}
const action={name:target.getAttribute("title")||target.textContent.trim(),type:"ir.actions.act_window",res_model:data.model||resModel,target:"current",views,domain:data.domain?evaluateExpr(data.domain):[],};if(resId){action.res_id=resId;}
const options={};if(data.context){options.additionalContext=evaluateExpr(data.context);}
keepLast.add(doAction(action,options));}
checkAndCollapseBootstrap(target);}
useListener("click",selector,handler);}
return __exports;});;

/* /web/static/src/views/layout.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/layout',async function(require){'use strict';let __exports={};const{ControlPanel}=require("@web/search/control_panel/control_panel");const{SearchPanel}=require("@web/search/search_panel/search_panel");const{Component}=owl;const extractLayoutComponents=__exports.extractLayoutComponents=(params)=>{return{ControlPanel:params.ControlPanel||ControlPanel,SearchPanel:params.SearchPanel||SearchPanel,Banner:params.Banner||false,};};const Layout=__exports.Layout=class Layout extends Component{setup(){const{display={}}=this.env.searchModel||{};this.components=extractLayoutComponents(this.env.config);this.display=display;}}
Layout.template="web.Layout";Layout.props={viewType:{type:String,optional:true},useSampleModel:{type:Boolean,optional:true},};return __exports;});;

/* /web/static/src/views/onboarding_banner.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/onboarding_banner',async function(require){'use strict';let __exports={};const{loadAssets}=require("@web/core/assets");const{useService}=require("@web/core/utils/hooks");const{useActionLinks}=require("@web/views/helpers/view_hook");const OnboardingBanner=__exports.OnboardingBanner=class OnboardingBanner extends owl.Component{setup(){this.rpc=useService("rpc");this.user=useService("user");const resModel="searchModel"in this.env?this.env.searchModel.resModel:undefined;useActionLinks({resModel,reload:async()=>{this.bannerHTML=await this.loadBanner(this.env.config.bannerRoute);this.render();},});}
async willStart(){this.bannerHTML=await this.loadBanner(this.env.config.bannerRoute);}
async loadBanner(bannerRoute){const response=await this.rpc(bannerRoute,{context:this.user.context});if(!response.html){return;}
const banner=new DOMParser().parseFromString(response.html,"text/html");const assets={jsLibs:[],cssLibs:[],};banner.querySelectorAll(`link[rel="stylesheet"] , script[type="text/javascript"]`).forEach((elem)=>{if(elem.tagName==="SCRIPT"){assets.jsLibs.push(elem.src);}else if(elem.tagName==="LINK"){assets.cssLibs.push(elem.href);}
elem.remove();});await loadAssets(assets);return new XMLSerializer().serializeToString(banner);}}
OnboardingBanner.template=owl.tags.xml`<div class="w-100" t-raw="bannerHTML" />`;OnboardingBanner.props={};return __exports;});;

/* /web/static/src/views/pivot/pivot_arch_parser.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/pivot/pivot_arch_parser',async function(require){'use strict';let __exports={};const{evaluateExpr}=require("@web/core/py_js/py");const{XMLParser}=require("@web/core/utils/xml");const{archParseBoolean}=require("@web/views/helpers/utils");const PivotArchParser=__exports.PivotArchParser=class PivotArchParser extends XMLParser{parse(arch){const archInfo={activeMeasures:[],colGroupBys:[],defaultOrder:null,fieldAttrs:{},rowGroupBys:[],widgets:{},};this.visitXML(arch,(node)=>{switch(node.tagName){case"pivot":{if(node.hasAttribute("disable_linking")){archInfo.disableLinking=archParseBoolean(node.getAttribute("disable_linking"));}
if(node.hasAttribute("default_order")){archInfo.defaultOrder=node.getAttribute("default_order");}
if(node.hasAttribute("string")){archInfo.title=node.getAttribute("string");}
if(node.hasAttribute("display_quantity")){archInfo.displayQuantity=archParseBoolean(node.getAttribute("display_quantity"));}
break;}
case"field":{let fieldName=node.getAttribute("name");archInfo.fieldAttrs[fieldName]={};if(node.hasAttribute("string")){archInfo.fieldAttrs[fieldName].string=node.getAttribute("string");}
if(node.hasAttribute("invisible")){const isInvisible=Boolean(evaluateExpr(node.getAttribute("invisible")));if(isInvisible){archInfo.fieldAttrs[fieldName].isInvisible=true;break;}}
if(node.hasAttribute("interval")){fieldName+=":"+node.getAttribute("interval");}
if(node.hasAttribute("widget")){archInfo.widgets[fieldName]=node.getAttribute("widget");}
if(node.getAttribute("type")==="measure"||node.hasAttribute("operator")){archInfo.activeMeasures.push(fieldName);}
if(node.getAttribute("type")==="col"){archInfo.colGroupBys.push(fieldName);}
if(node.getAttribute("type")==="row"){archInfo.rowGroupBys.push(fieldName);}
break;}}});return archInfo;}}
return __exports;});;

/* /web/static/src/views/pivot/pivot_group_by_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/pivot/pivot_group_by_menu',async function(require){'use strict';let __exports={};const{GroupByMenu}=require("@web/search/group_by_menu/group_by_menu");const{getIntervalOptions}=require("@web/search/utils/dates");const PivotGroupByMenu=__exports.PivotGroupByMenu=class PivotGroupByMenu extends GroupByMenu{get items(){let items=super.items.filter((i)=>!i.custom);if(items.length===0){items=this.fields;}
let groupNumber=1+Math.max(0,...items.map(({groupNumber:n})=>n));for(const[fieldName,customGroupBy]of this.props.customGroupBys.entries()){items.push({...customGroupBy,name:fieldName,groupNumber:groupNumber++});}
return items.map((item)=>({...item,id:item.id||item.name,fieldName:item.fieldName||item.name,description:item.description||item.string,isActive:false,options:item.options||["date","datetime"].includes(item.type)?getIntervalOptions():undefined,}));}
onAddCustomGroup(ev){this.trigger("add-custom-group-by",{fieldName:ev.detail.fieldName,groupId:this.props.cell.groupId,});}
onGroupBySelected(ev){const{itemId,optionId}=ev.detail.payload;const item=this.items.find(({id})=>id===itemId);Object.assign(ev.detail.payload,{fieldName:item.fieldName,interval:optionId,groupId:this.props.cell.groupId,});}}
return __exports;});;

/* /web/static/src/views/pivot/pivot_model.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/pivot/pivot_model',async function(require){'use strict';let __exports={};const{Domain}=require("@web/core/domain");const{cartesian,sections,sortBy,symmetricalDifference}=require("@web/core/utils/arrays");const{KeepLast,Race}=require("@web/core/utils/concurrency");const{computeVariation}=require("@web/core/utils/numbers");const{DEFAULT_INTERVAL}=require("@web/search/utils/dates");const{Model}=require("@web/views/helpers/model");const{computeReportMeasures,processMeasure}=require("@web/views/helpers/utils");const PivotModel=__exports.PivotModel=class PivotModel extends Model{setup(params){this.keepLast=new KeepLast();this.race=new Race();const _loadData=this._loadData.bind(this);this._loadData=(...args)=>{return this.race.add(_loadData(...args));};let sortedColumn=params.metaData.sortedColumn||null;if(!sortedColumn&&params.metaData.defaultOrder){const defaultOrder=params.metaData.defaultOrder.split(" ");sortedColumn={groupId:[[],[]],measure:defaultOrder[0],order:defaultOrder[1]?defaultOrder[1]:"asc",};}
this.searchParams={context:{},domain:[],domains:[],groupBy:[],};this.data=params.data||{colGroupTree:null,rowGroupTree:null,groupDomains:{},measurements:{},counts:{},numbering:{},};const metaData=Object.assign({},params.metaData,{customGroupBys:params.metaData.customGroupBys||new Map(),expandedRowGroupBys:params.metaData.expandedRowGroupBys||[],expandedColGroupBys:params.metaData.expandedColGroupBys||[],sortedColumn,});this.metaData=this._buildMetaData(metaData);this.reload=false;this.nextActiveMeasures=null;}
async addGroupBy(params){if(this.race.getCurrentProm()){return;}
const{groupId,fieldName,type,custom}=params;let{interval}=params;const metaData=this._buildMetaData();if(custom&&!metaData.customGroupBys.has(fieldName)){const field=metaData.fields[fieldName];if(!interval&&["date","datetime"].includes(field.type)){interval=DEFAULT_INTERVAL;}
metaData.customGroupBys.set(fieldName,{...field,id:fieldName,});}
let groupBy=fieldName;if(interval){groupBy=`${groupBy}:${interval}`;}
if(type==="row"){metaData.expandedRowGroupBys.push(groupBy);}else{metaData.expandedColGroupBys.push(groupBy);}
const config={metaData,data:this.data};await this._expandGroup(groupId,type,config);this.metaData=metaData;this.notify();}
closeGroup(groupId,type){if(this.race.getCurrentProm()){return;}
let groupBys;let expandedGroupBys;let keyPart;let group;let tree;if(type==="row"){groupBys=this.metaData.rowGroupBys;expandedGroupBys=this.metaData.expandedRowGroupBys;tree=this.data.rowGroupTree;group=this._findGroup(this.data.rowGroupTree,groupId[0]);keyPart=0;}else{groupBys=this.metaData.colGroupBys;expandedGroupBys=this.metaData.expandedColGroupBys;tree=this.data.colGroupTree;group=this._findGroup(this.data.colGroupTree,groupId[1]);keyPart=1;}
const groupIdPart=groupId[keyPart];const range=groupIdPart.map((_,index)=>index);function keep(key){const idPart=JSON.parse(key)[keyPart];return(range.some((index)=>groupIdPart[index]!==idPart[index])||idPart.length===groupIdPart.length);}
function omitKeys(object){const newObject={};for(const key in object){if(keep(key)){newObject[key]=object[key];}}
return newObject;}
this.data.measurements=omitKeys(this.data.measurements);this.data.counts=omitKeys(this.data.counts);this.data.groupDomains=omitKeys(this.data.groupDomains);group.directSubTrees.clear();delete group.sortedKeys;var newGroupBysLength=this._getTreeHeight(tree)-1;if(newGroupBysLength<=groupBys.length){expandedGroupBys.splice(0);groupBys.splice(newGroupBysLength);}else{expandedGroupBys.splice(newGroupBysLength-groupBys.length);}
this.notify();}
async expandAll(){const config={metaData:this.metaData,data:this.data};await this._loadData(config,false);this.notify();}
async expandGroup(groupId,type){if(this.race.getCurrentProm()){return;}
const config={metaData:this.metaData,data:this.data};await this._expandGroup(groupId,type,config);this.notify();}
exportData(){const measureCount=this.metaData.activeMeasures.length;const originCount=this.metaData.origins.length;const table=this.getTable();const headers=table.headers;let colGroupHeaderRows;let measureRow=[];let originRow=[];function processHeader(header){const inTotalColumn=header.groupId[1].length===0;return{title:header.title,width:header.width,height:header.height,is_bold:!!header.measure&&inTotalColumn,};}
if(originCount>1){colGroupHeaderRows=headers.slice(0,headers.length-2);measureRow=headers[headers.length-2].map(processHeader);originRow=headers[headers.length-1].map(processHeader);}else{colGroupHeaderRows=headers.slice(0,headers.length-1);measureRow=headers[headers.length-1].map(processHeader);}
colGroupHeaderRows[0].splice(0,1);colGroupHeaderRows=colGroupHeaderRows.map((headerRow)=>{return headerRow.map(processHeader);});const tableRows=table.rows.map((row)=>{return{title:row.title,indent:row.indent,values:row.subGroupMeasurements.map((measurement)=>{let value=measurement.value;if(value===undefined){value="";}else if(measurement.originIndexes.length>1){value=value*100;}
return{is_bold:measurement.isBold,value:value,};}),};});return{model:this.metaData.resModel,title:this.metaData.title,col_group_headers:colGroupHeaderRows,measure_headers:measureRow,origin_headers:originRow,rows:tableRows,measure_count:measureCount,origin_count:originCount,};}
async flip(){await this.race.getCurrentProm();let temp=this.data.rowGroupTree;this.data.rowGroupTree=this.data.colGroupTree;this.data.colGroupTree=temp;temp=this.metaData.rowGroupBys;this.metaData.rowGroupBys=this.metaData.colGroupBys;this.metaData.colGroupBys=temp;temp=this.metaData.expandedColGroupBys;this.metaData.expandedColGroupBys=this.metaData.expandedRowGroupBys;this.metaData.expandedRowGroupBys=temp;function twistKey(key){return JSON.stringify(JSON.parse(key).reverse());}
function twist(object){const newObject={};Object.keys(object).forEach((key)=>{const value=object[key];newObject[twistKey(key)]=value;});return newObject;}
this.data.measurements=twist(this.data.measurements);this.data.counts=twist(this.data.counts);this.data.groupDomains=twist(this.data.groupDomains);this.notify();}
getGroupDomain(group){const config={metaData:this.metaData,data:this.data};return this._getGroupDomain(group,config);}
getTable(){const headers=this._getTableHeaders();return{headers:headers,rows:this._getTableRows(this.data.rowGroupTree,headers[headers.length-1]),};}
getTableWidth(){var leafCounts=this._getLeafCounts(this.data.colGroupTree);return leafCounts[JSON.stringify(this.data.colGroupTree.root.values)]+2;}
hasData(){return this._hasData(this.data);}
async load(searchParams){this.searchParams=searchParams;const activeMeasures=processMeasure(searchParams.context.pivot_measures)||this.metaData.activeMeasures;const metaData=this._buildMetaData({activeMeasures});if(!this.reload){metaData.rowGroupBys=searchParams.context.pivot_row_groupby||(searchParams.groupBy.length?searchParams.groupBy:metaData.rowGroupBys);this.reload=true;}else{metaData.rowGroupBys=searchParams.groupBy.length?searchParams.groupBy:searchParams.context.pivot_row_groupby||metaData.rowGroupBys;}
metaData.colGroupBys=searchParams.context.pivot_column_groupby||this.metaData.colGroupBys;if(JSON.stringify(metaData.rowGroupBys)!==JSON.stringify(this.metaData.rowGroupBys)){metaData.expandedRowGroupBys=[];}
if(JSON.stringify(metaData.colGroupBys)!==JSON.stringify(this.metaData.colGroupBys)){metaData.expandedColGroupBys=[];}
metaData.measures=computeReportMeasures(metaData.fields,metaData.fieldAttrs,metaData.activeMeasures,metaData.additionalMeasures);const config={metaData,data:this.data};return this._loadData(config);}
sortRows(sortedColumn){if(this.race.getCurrentProm()){return;}
const config={metaData:this.metaData,data:this.data};this._sortRows(sortedColumn,config);this.notify();}
async toggleMeasure(fieldName){const metaData=this._buildMetaData();this.nextActiveMeasures=this.nextActiveMeasures||metaData.activeMeasures;metaData.activeMeasures=this.nextActiveMeasures;const index=metaData.activeMeasures.indexOf(fieldName);if(index!==-1){metaData.activeMeasures.splice(index,1);await Promise.resolve(this.race.getCurrentProm());this.metaData=metaData;}else{metaData.activeMeasures.push(fieldName);let config={metaData,data:this.data};await this._loadData(config);}
this.nextActiveMeasures=null;this.notify();}
_addGroup(groupTree,labels,values){let tree=groupTree;values.slice(0,values.length-1).forEach(function(value){tree=tree.directSubTrees.get(value);});const value=values[values.length-1];if(tree.directSubTrees.has(value)){return;}
tree.directSubTrees.set(value,{root:{labels:labels,values:values,},directSubTrees:new Map(),});}
_buildMetaData(params){const metaData=Object.assign({},this.metaData,params);metaData.activeMeasures=[...metaData.activeMeasures];metaData.colGroupBys=[...metaData.colGroupBys];metaData.rowGroupBys=[...metaData.rowGroupBys];metaData.expandedColGroupBys=[...metaData.expandedColGroupBys];metaData.expandedRowGroupBys=[...metaData.expandedRowGroupBys];metaData.customGroupBys=new Map([...metaData.customGroupBys]);metaData.sortedColumn=metaData.sortedColumn?{...metaData.sortedColumn}:null;if(this.searchParams.comparison){const domains=this.searchParams.comparison.domains.slice().reverse();metaData.domains=domains.map((d)=>d.arrayRepr);metaData.origins=domains.map((d)=>d.description);}else{metaData.domains=[this.searchParams.domain];metaData.origins=[""];}
Object.defineProperty(metaData,"fullColGroupBys",{get(){return metaData.colGroupBys.concat(metaData.expandedColGroupBys);},});Object.defineProperty(metaData,"fullRowGroupBys",{get(){return metaData.rowGroupBys.concat(metaData.expandedRowGroupBys);},});return metaData;}
async _expandGroup(groupId,type,config){const{metaData}=config;const group={rowValues:groupId[0],colValues:groupId[1],type:type,};const groupValues=type==="row"?groupId[0]:groupId[1];const groupBys=type==="row"?metaData.fullRowGroupBys:metaData.fullColGroupBys;if(groupValues.length>=groupBys.length){throw new Error("Cannot expand group");}
const groupBy=groupBys[groupValues.length];let leftDivisors;let rightDivisors;if(group.type==="row"){leftDivisors=[[groupBy]];rightDivisors=sections(metaData.fullColGroupBys);}else{leftDivisors=sections(metaData.fullRowGroupBys);rightDivisors=[[groupBy]];}
const divisors=cartesian(leftDivisors,rightDivisors);delete group.type;await this._subdivideGroup(group,divisors,config);}
_findGroup(groupTree,values){let tree=groupTree;values.slice(0,values.length).forEach((value)=>{tree=tree.directSubTrees.get(value);});return tree;}
_getCellValue(groupId,measure,originIndexes,config){var key=JSON.stringify(groupId);if(!config.data.measurements[key]){return;}
var values=originIndexes.map((originIndex)=>{return config.data.measurements[key][originIndex][measure];});if(originIndexes.length>1){return computeVariation(values[1],values[0]);}else{return values[0];}}
_getGroupDomain(group,config){const{data}=config;var key=JSON.stringify([group.rowValues,group.colValues]);return data.groupDomains[key][group.originIndex];}
_getGroupLabels(group,groupBys,config){return groupBys.map((groupBy)=>{return this._sanitizeLabel(group[groupBy],groupBy,config);});}
async _getGroupSubdivision(group,rowGroupBy,colGroupBy,config){const groupDomain=this._getGroupDomain(group,config);const measureSpecs=this._getMeasureSpecs(config);const groupBy=rowGroupBy.concat(colGroupBy);const options={lazy:false};const subGroups=await this.orm.readGroup(config.metaData.resModel,groupDomain,measureSpecs,groupBy,options,this.searchParams.context);return{group:group,subGroups:subGroups,rowGroupBy:rowGroupBy,colGroupBy:colGroupBy,};}
_getGroupValues(group,groupBys){return groupBys.map((groupBy)=>{return this._sanitizeValue(group[groupBy]);});}
_getLeafCounts(tree){const leafCounts={};let leafCount;if(!tree.directSubTrees.size){leafCount=1;}else{leafCount=[...tree.directSubTrees.values()].reduce((acc,subTree)=>{const subLeafCounts=this._getLeafCounts(subTree);Object.assign(leafCounts,subLeafCounts);return acc+leafCounts[JSON.stringify(subTree.root.values)];},0);}
leafCounts[JSON.stringify(tree.root.values)]=leafCount;return leafCounts;}
_getMeasurements(group,config){const{metaData}=config;return metaData.activeMeasures.reduce((measurements,measureName)=>{var measurement=group[measureName];if(measurement instanceof Array){measurement=1;}
if(metaData.measures[measureName].type==="boolean"&&measurement instanceof Boolean){measurement=measurement?1:0;}
if(metaData.origins.length>1&&!measurement){measurement=0;}
measurements[measureName]=measurement;return measurements;},{});}
_getMeasuresRow(columns){const sortedColumn=this.metaData.sortedColumn||{};const measureRow=[];columns.forEach((column)=>{this.metaData.activeMeasures.forEach((measureName)=>{const measureCell={groupId:column.groupId,height:1,measure:measureName,title:this.metaData.measures[measureName].string,width:2*this.metaData.origins.length-1,};if(sortedColumn.measure===measureName&&JSON.stringify(sortedColumn.groupId)===JSON.stringify(column.groupId)){measureCell.order=sortedColumn.order;}
measureRow.push(measureCell);});});return measureRow;}
_getMeasureSpecs(config){const{metaData}=config;return metaData.activeMeasures.reduce((acc,measure)=>{if(measure==="__count"){acc.push(measure);return acc;}
const field=this.metaData.fields[measure];if(field.type==="many2one"){field.group_operator="count_distinct";}
if(field.group_operator===undefined){throw new Error("No aggregate function has been provided for the measure '"+measure+"'");}
acc.push(measure+":"+field.group_operator);return acc;},[]);}
_getNumberedLabel(label,fieldName,config){const{data}=config;const id=label[0];const name=label[1];data.numbering[fieldName]=data.numbering[fieldName]||{};data.numbering[fieldName][name]=data.numbering[fieldName][name]||{};const numbers=data.numbering[fieldName][name];numbers[id]=numbers[id]||Object.keys(numbers).length+1;return name+(numbers[id]>1?"  ("+numbers[id]+")":"");}
_getOriginsRow(columns){const sortedColumn=this.metaData.sortedColumn||{};const originRow=[];columns.forEach((column)=>{const groupId=column.groupId;const measure=column.measure;const isSorted=sortedColumn.measure===measure&&JSON.stringify(sortedColumn.groupId)===JSON.stringify(groupId);const isSortedByOrigin=isSorted&&!sortedColumn.originIndexes[1];const isSortedByVariation=isSorted&&sortedColumn.originIndexes[1];this.metaData.origins.forEach((origin,originIndex)=>{const originCell={groupId:groupId,height:1,measure:measure,originIndexes:[originIndex],title:origin,width:1,};if(isSortedByOrigin&&sortedColumn.originIndexes[0]===originIndex){originCell.order=sortedColumn.order;}
originRow.push(originCell);if(originIndex>0){const variationCell={groupId:groupId,height:1,measure:measure,originIndexes:[originIndex-1,originIndex],title:this.env._t("Variation"),width:1,};if(isSortedByVariation&&sortedColumn.originIndexes[1]===originIndex){variationCell.order=sortedColumn.order;}
originRow.push(variationCell);}});});return originRow;}
_getTableHeaders(){const _t=this.env._t;const colGroupBys=this.metaData.fullColGroupBys;const height=colGroupBys.length+1;const measureCount=this.metaData.activeMeasures.length;const originCount=this.metaData.origins.length;const leafCounts=this._getLeafCounts(this.data.colGroupTree);let headers=[];const measureColumns=[];const colGroupRows=new Array(height).fill(0).map(()=>[]);colGroupRows[0].push({height:height+1+(originCount>1?1:0),title:"",width:1,});function generateTreeHeaders(tree,fields){const group=tree.root;const rowIndex=group.values.length;const row=colGroupRows[rowIndex];const groupId=[[],group.values];const isLeaf=!tree.directSubTrees.size;const leafCount=leafCounts[JSON.stringify(tree.root.values)];const cell={groupId:groupId,height:isLeaf?colGroupBys.length+1-rowIndex:1,isLeaf:isLeaf,isFolded:isLeaf&&colGroupBys.length>group.values.length,label:rowIndex===0?undefined:fields[colGroupBys[rowIndex-1].split(":")[0]].string,title:group.labels[group.labels.length-1]||_t("Total"),width:leafCount*measureCount*(2*originCount-1),};row.push(cell);if(isLeaf){measureColumns.push(cell);}
[...tree.directSubTrees.values()].forEach((subTree)=>{generateTreeHeaders(subTree,fields);});}
generateTreeHeaders(this.data.colGroupTree,this.metaData.fields);if(leafCounts[JSON.stringify(this.data.colGroupTree.root.values)]>1){var groupId=[[],[]];var totalTopRightCell={groupId:groupId,height:height,title:"",width:measureCount*(2*originCount-1),};colGroupRows[0].push(totalTopRightCell);measureColumns.push(totalTopRightCell);}
headers=headers.concat(colGroupRows);var measuresRow=this._getMeasuresRow(measureColumns);headers.push(measuresRow);if(originCount>1){headers.push(this._getOriginsRow(measuresRow));}
return headers;}
_getTableRows(tree,columns){let rows=[];const group=tree.root;const rowGroupId=[group.values,[]];const title=group.labels[group.labels.length-1]||this.env._t("Total");const indent=group.labels.length;const isLeaf=!tree.directSubTrees.size;const rowGroupBys=this.metaData.fullRowGroupBys;const subGroupMeasurements=columns.map((column)=>{const colGroupId=column.groupId;const groupIntersectionId=[rowGroupId[0],colGroupId[1]];const measure=column.measure;const originIndexes=column.originIndexes||[0];const value=this._getCellValue(groupIntersectionId,measure,originIndexes,{data:this.data,});const measurement={groupId:groupIntersectionId,originIndexes:originIndexes,measure:measure,value:value,isBold:!groupIntersectionId[0].length||!groupIntersectionId[1].length,};return measurement;});rows.push({title:title,label:indent===0?undefined:this.metaData.fields[rowGroupBys[indent-1].split(":")[0]].string,groupId:rowGroupId,indent:indent,isLeaf:isLeaf,isFolded:isLeaf&&rowGroupBys.length>group.values.length,subGroupMeasurements:subGroupMeasurements,});const subTreeKeys=tree.sortedKeys||[...tree.directSubTrees.keys()];subTreeKeys.forEach((subTreeKey)=>{const subTree=tree.directSubTrees.get(subTreeKey);rows=rows.concat(this._getTableRows(subTree,columns));});return rows;}
_getTreeHeight(tree){const subTreeHeights=[...tree.directSubTrees.values()].map(this._getTreeHeight.bind(this));return Math.max(0,Math.max.apply(null,subTreeHeights))+1;}
_hasData(data){return(data.counts[JSON.stringify([[],[]])]||[]).some((count)=>{return count>0;});}
async _loadData(config,prune=true){config.data={};const{data,metaData}=config;data.rowGroupTree={root:{labels:[],values:[]},directSubTrees:new Map()};data.colGroupTree={root:{labels:[],values:[]},directSubTrees:new Map()};data.measurements={};data.counts={};data.groupDomains={};data.numbering={};const key=JSON.stringify([[],[]]);data.groupDomains[key]=metaData.domains.slice(0);const group={rowValues:[],colValues:[]};const leftDivisors=sections(metaData.fullRowGroupBys);const rightDivisors=sections(metaData.fullColGroupBys);const divisors=cartesian(leftDivisors,rightDivisors);await this._subdivideGroup(group,divisors.slice(0,1),config);await this._subdivideGroup(group,divisors.slice(1),config);if(prune&&this._hasData(data)&&this._hasData(this.data)){if(symmetricalDifference(metaData.rowGroupBys,this.metaData.rowGroupBys).length===0){this._pruneTree(data.rowGroupTree,this.data.rowGroupTree);}
if(symmetricalDifference(metaData.colGroupBys,this.metaData.colGroupBys).length===0){this._pruneTree(data.colGroupTree,this.data.colGroupTree);}}
this.data=config.data;this.metaData=config.metaData;}
_prepareData(group,groupSubdivisions,config){const{data,metaData}=config;const groupRowValues=group.rowValues;let groupRowLabels=[];let rowSubTree=data.rowGroupTree;let root;if(groupRowValues.length){rowSubTree=this._findGroup(data.rowGroupTree,groupRowValues);root=rowSubTree.root;groupRowLabels=root.labels;}
const groupColValues=group.colValues;let groupColLabels=[];if(groupColValues.length){root=this._findGroup(data.colGroupTree,groupColValues).root;groupColLabels=root.labels;}
groupSubdivisions.forEach((groupSubdivision)=>{groupSubdivision.subGroups.forEach((subGroup)=>{const rowValues=groupRowValues.concat(this._getGroupValues(subGroup,groupSubdivision.rowGroupBy));const rowLabels=groupRowLabels.concat(this._getGroupLabels(subGroup,groupSubdivision.rowGroupBy,config));const colValues=groupColValues.concat(this._getGroupValues(subGroup,groupSubdivision.colGroupBy));const colLabels=groupColLabels.concat(this._getGroupLabels(subGroup,groupSubdivision.colGroupBy,config));if(!colValues.length&&rowValues.length){this._addGroup(data.rowGroupTree,rowLabels,rowValues);}
if(colValues.length&&!rowValues.length){this._addGroup(data.colGroupTree,colLabels,colValues);}
const key=JSON.stringify([rowValues,colValues]);const originIndex=groupSubdivision.group.originIndex;if(!(key in data.measurements)){data.measurements[key]=metaData.origins.map(()=>{return this._getMeasurements({},config);});}
data.measurements[key][originIndex]=this._getMeasurements(subGroup,config);if(!(key in data.counts)){data.counts[key]=metaData.origins.map(function(){return 0;});}
data.counts[key][originIndex]=subGroup.__count;if(!(key in data.groupDomains)){data.groupDomains[key]=metaData.origins.map(function(){return Domain.FALSE.toList();});}
if(subGroup.__domain){data.groupDomains[key][originIndex]=subGroup.__domain;}});});if(metaData.sortedColumn){this._sortRows(metaData.sortedColumn,config);}}
_pruneTree(tree,oldTree){if(!oldTree.directSubTrees.size){tree.directSubTrees.clear();delete tree.sortedKeys;return;}
[...tree.directSubTrees.keys()].forEach((subTreeKey)=>{const subTree=tree.directSubTrees.get(subTreeKey);if(!oldTree.directSubTrees.has(subTreeKey)){subTree.directSubTrees.clear();delete subTreeKey.sortedKeys;}else{const oldSubTree=oldTree.directSubTrees.get(subTreeKey);this._pruneTree(subTree,oldSubTree);}});}
_sanitizeLabel(value,groupBy,config){const{metaData}=config;const fieldName=groupBy.split(":")[0];if(value===false){return this.env._t("Undefined");}
if(value instanceof Array){return this._getNumberedLabel(value,fieldName,config);}
if(fieldName&&metaData.fields[fieldName]&&metaData.fields[fieldName].type==="selection"){const selected=metaData.fields[fieldName].selection.find((o)=>o[0]===value);return selected?selected[1]:value;}
return value;}
_sanitizeValue(value){if(value instanceof Array){return value[0];}
return value;}
async _subdivideGroup(group,divisors,config){const{data,metaData}=config;const key=JSON.stringify([group.rowValues,group.colValues]);const proms=metaData.origins.reduce((acc,origin,originIndex)=>{if(!data.counts[key]||data.counts[key][originIndex]>0){const subGroup={rowValues:group.rowValues,colValues:group.colValues,originIndex:originIndex,};divisors.forEach((divisor)=>{acc.push(this._getGroupSubdivision(subGroup,divisor[0],divisor[1],config));});}
return acc;},[]);const groupSubdivisions=await this.keepLast.add(Promise.all(proms));if(groupSubdivisions.length){this._prepareData(group,groupSubdivisions,config);}}
_sortRows(sortedColumn,config){const metaData=config.metaData||this.metaData;const data=config.data||this.data;const colGroupValues=sortedColumn.groupId[1];sortedColumn.originIndexes=sortedColumn.originIndexes||[0];metaData.sortedColumn=sortedColumn;const sortFunction=(tree)=>{return(subTreeKey)=>{const subTree=tree.directSubTrees.get(subTreeKey);const groupIntersectionId=[subTree.root.values,colGroupValues];const value=this._getCellValue(groupIntersectionId,sortedColumn.measure,sortedColumn.originIndexes,{data})||0;return sortedColumn.order==="asc"?value:-value;};};this._sortTree(sortFunction,data.rowGroupTree);}
_sortTree(sortFunction,tree){tree.sortedKeys=sortBy([...tree.directSubTrees.keys()],sortFunction(tree));[...tree.directSubTrees.values()].forEach((subTree)=>{this._sortTree(sortFunction,subTree);});}}
return __exports;});;

/* /web/static/src/views/pivot/pivot_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/pivot/pivot_renderer',async function(require){'use strict';let __exports={};const{PivotGroupByMenu}=require("@web/views/pivot/pivot_group_by_menu");const{localization}=require("@web/core/l10n/localization");const{registry}=require("@web/core/registry");const fieldUtils=require("web.field_utils");const{Component}=owl;const formatterRegistry=registry.category("formatters");const PivotRenderer=__exports.PivotRenderer=class PivotRenderer extends Component{setup(){this.model=this.props.model;this.table=this.model.getTable();this.l10n=localization;}
willUpdateProps(){this.table=this.model.getTable();}
getFormattedValue(cell){const field=this.model.metaData.measures[cell.measure];let formatType=this.model.metaData.widgets[cell.measure];if(!formatType){const fieldType=field.type;formatType=fieldType==="many2one"?"integer":fieldType;}
const formatter=formatterRegistry.get(formatType,null)||fieldUtils.format[formatType];if(!formatter){throw new Error(`${formatType} is not a defined formatter!`);}
return formatter(cell.value,field);}
getFormattedVariation(cell){if(isNaN(cell.value)){return"-";}
const formatPercentage=formatterRegistry.get("percentage");return formatPercentage(cell.value,this.model.metaData.fields[cell.measure]);}
getPadding(cell){return 5+cell.indent*30;}
onCellClicked(cell){this.props.onCellClicked(cell);}
onAddCustomGroupBy(type,ev){this.model.addGroupBy({...ev.detail,custom:true,type});}
onDropdownItemSelected(type,ev){this.model.addGroupBy({...ev.detail.payload,type});}
onHeaderClick(cell,type){if(cell.isLeaf&&cell.isFolded){this.model.expandGroup(cell.groupId,type);}else if(!cell.isLeaf){this.model.closeGroup(cell.groupId,type);}}
onMeasureClick(cell){this.model.sortRows({groupId:cell.groupId,measure:cell.measure,order:(cell.order||"desc")==="asc"?"desc":"asc",originIndexes:cell.originIndexes,});}
onMouseEnter(ev){var index=[...ev.currentTarget.parentNode.children].indexOf(ev.currentTarget);if(ev.currentTarget.tagName==="TH"){if(!ev.currentTarget.classList.contains("o_pivot_origin_row")&&this.model.metaData.origins.length===2){index=3*index;}
index+=1;}
this.el.querySelectorAll("td:nth-child("+(index+1)+")").forEach((elt)=>elt.classList.add("o_cell_hover"));}
onMouseLeave(){this.el.querySelectorAll(".o_cell_hover").forEach((elt)=>elt.classList.remove("o_cell_hover"));}}
PivotRenderer.template="web.PivotRenderer";PivotRenderer.components={PivotGroupByMenu};PivotRenderer.props=["model","onCellClicked"];return __exports;});;

/* /web/static/src/views/pivot/pivot_view.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/pivot/pivot_view',async function(require){'use strict';let __exports={};const{_lt}=require("@web/core/l10n/translation");const{download}=require("@web/core/network/download");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{useModel}=require("@web/views/helpers/model");const{standardViewProps}=require("@web/views/helpers/standard_view_props");const{useSetupView}=require("@web/views/helpers/view_hook");const{Layout}=require("@web/views/layout");const{PivotArchParser}=require("@web/views/pivot/pivot_arch_parser");const{PivotModel}=require("@web/views/pivot/pivot_model");const{PivotRenderer}=require("@web/views/pivot/pivot_renderer");const viewRegistry=registry.category("views");const{Component}=owl;const PivotView=__exports.PivotView=class PivotView extends Component{setup(){this.actionService=useService("action");let modelParams={};if(this.props.state){modelParams.data=this.props.state.data;modelParams.metaData=this.props.state.metaData;}else{const{arch}=this.props;const archInfo=new this.constructor.ArchParser().parse(arch);if(!archInfo.activeMeasures.length||archInfo.displayQuantity){archInfo.activeMeasures.unshift("__count");}
modelParams.metaData={activeMeasures:archInfo.activeMeasures,additionalMeasures:this.props.additionalMeasures,colGroupBys:archInfo.colGroupBys,defaultOrder:archInfo.defaultOrder,disableLinking:Boolean(archInfo.disableLinking),fields:this.props.fields,fieldAttrs:archInfo.fieldAttrs,resModel:this.props.resModel,rowGroupBys:archInfo.rowGroupBys,title:archInfo.title||this.env._t("Untitled"),widgets:archInfo.widgets,};}
this.model=useModel(this.constructor.Model,modelParams);useSetupView({getLocalState:()=>{const{data,metaData}=this.model;return{data,metaData};},getContext:()=>this.getContext(),});}
getContext(){return{pivot_measures:this.model.metaData.activeMeasures,pivot_column_groupby:this.model.metaData.fullColGroupBys,pivot_row_groupby:this.model.metaData.fullRowGroupBys,};}
onDownloadButtonClicked(){if(this.model.getTableWidth()>16384){throw new Error(this.env._t("For Excel compatibility, data cannot be exported if there are more than 16384 columns.\n\nTip: try to flip axis, filter further or reduce the number of measures."));}
const table=this.model.exportData();download({url:"/web/pivot/export_xlsx",data:{data:JSON.stringify(table)},});}
onExpandButtonClicked(){this.model.expandAll();}
onFlipButtonClicked(){this.model.flip();}
onMeasureSelected(ev){this.model.toggleMeasure(ev.detail.payload.measure);}
onOpenView(cell){if(cell.value===undefined||this.model.metaData.disableLinking){return;}
const context=Object.assign({},this.model.searchParams.context);Object.keys(context).forEach((x)=>{if(x==="group_by"||x.startsWith("search_default_")){delete context[x];}});const{views=[]}=this.env.config;this.views=["list","form"].map((viewType)=>{const view=views.find((view)=>view[1]===viewType);return[view?view[0]:false,viewType];});const group={rowValues:cell.groupId[0],colValues:cell.groupId[1],originIndex:cell.originIndexes[0],};const domain=this.model.getGroupDomain(group);this.actionService.doAction({type:"ir.actions.act_window",name:this.model.metaData.title,res_model:this.props.resModel,views:this.views,view_mode:"list",target:"current",context,domain,});}}
PivotView.template="web.PivotView";PivotView.buttonTemplate="web.PivotView.Buttons";PivotView.components={Renderer:PivotRenderer,Layout};PivotView.props={...standardViewProps,additionalMeasures:{type:Array,elements:String,optional:1},};PivotView.defaultProps={additionalMeasures:[],};PivotView.Model=PivotModel;PivotView.ArchParser=PivotArchParser;PivotView.type="pivot";PivotView.display_name=_lt("Pivot");PivotView.icon="fa-table";PivotView.multiRecord=true;PivotView.searchMenuTypes=["filter","groupBy","comparison","favorite"];viewRegistry.add("pivot",PivotView);return __exports;});;

/* /web/static/src/views/view.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/view',async function(require){'use strict';let __exports={};const{evaluateExpr}=require("@web/core/py_js/py");const{registry}=require("@web/core/registry");const{KeepLast}=require("@web/core/utils/concurrency");const{useService}=require("@web/core/utils/hooks");const{deepCopy}=require("@web/core/utils/objects");const{WithSearch}=require("@web/search/with_search/with_search");const{useActionLinks}=require("@web/views/helpers/view_hook");const{extractLayoutComponents}=require("@web/views/layout");const viewRegistry=registry.category("views");const{Component,hooks}=owl;const{useSubEnv}=hooks;const STANDARD_PROPS=["resModel","type","arch","fields","viewId","actionMenus","loadActionMenus","searchViewArch","searchViewFields","searchViewId","irFilters","loadIrFilters","comparison","context","domain","groupBy","orderBy","useSampleModel","noContentHelp","display","globalState","activateFavorite","searchPanel","searchModel",];const View=__exports.View=class View extends Component{setup(){const{arch,fields,resModel,searchViewArch,searchViewFields,type}=this.props;if(!resModel){throw Error(`View props should have a "resModel" key`);}
if(!type){throw Error(`View props should have a "type" key`);}
if((arch&&!fields)||(!arch&&fields)){throw new Error(`"arch" and "fields" props must be given together`);}
if((searchViewArch&&!searchViewFields)||(!searchViewArch&&searchViewFields)){throw new Error(`"searchViewArch" and "searchViewFields" props must be given together`);}
this.viewService=useService("view");this.withSearchProps=null;useSubEnv({keepLast:new KeepLast(),config:{...(this.env.config||{})},});useActionLinks({resModel});}
async willStart(){let ViewClass=viewRegistry.get(this.props.type);const type=ViewClass.type;let{viewId,searchViewId}=this.props;const views=deepCopy(this.env.config.views||[]);const view=views.find((v)=>v[1]===type)||[];if(view.length){view[0]=viewId!==undefined?viewId:view[0];viewId=view[0];}else{view.push(viewId||false,type);views.push(view);}
const searchView=views.find((v)=>v[1]==="search");if(searchView){searchView[0]=searchViewId!==undefined?searchViewId:searchView[0];searchViewId=searchView[0];}else if(searchViewId!==undefined){views.push([searchViewId,"search"]);}
const{context,resModel,loadActionMenus,loadIrFilters}=this.props;let{arch,fields,searchViewArch,searchViewFields,irFilters,actionMenus}=this.props;let loadView=!arch||(!actionMenus&&loadActionMenus);let loadSearchView=(searchViewId!==undefined&&!searchViewArch)||(!irFilters&&loadIrFilters);let viewDescription={viewId,resModel,type};let searchViewDescription;if(loadView||loadSearchView){const viewDescriptions=await this.viewService.loadViews({context,resModel,views},{actionId:this.env.config.actionId,loadActionMenus,loadIrFilters});viewDescription=viewDescriptions[type];view[0]=viewDescription.viewId;searchViewDescription=viewDescriptions.search;if(loadSearchView){searchViewId=searchViewId||searchViewDescription.viewId;if(!searchViewArch){searchViewArch=searchViewDescription.arch;searchViewFields=searchViewDescription.fields;}
if(!irFilters){irFilters=searchViewDescription.irFilters;}}
this.env.config.views=views;}
if(!arch){arch=viewDescription.arch;fields=viewDescription.fields;}
if(!actionMenus){actionMenus=viewDescription.actionMenus;}
const parser=new DOMParser();const xml=parser.parseFromString(arch,"text/xml");const rootNode=xml.documentElement;const subType=rootNode.getAttribute("js_class");const bannerRoute=rootNode.getAttribute("banner_route");const sample=rootNode.getAttribute("sample");if(subType){ViewClass=viewRegistry.get(subType);}
Object.assign(this.env.config,{viewId:viewDescription.viewId,viewType:type,viewSubType:subType,bannerRoute,...extractLayoutComponents(ViewClass),});const viewProps={info:{actionMenus,mode:this.props.display.mode},arch,fields,resModel,useSampleModel:false,};if(this.props.globalState){viewProps.globalState=this.props.globalState;}
if("useSampleModel"in this.props){viewProps.useSampleModel=this.props.useSampleModel;}else if(sample){viewProps.useSampleModel=Boolean(evaluateExpr(sample));}
for(const key in this.props){if(!STANDARD_PROPS.includes(key)){viewProps[key]=this.props[key];}}
let{noContentHelp}=this.props;if(noContentHelp!==undefined){const htmlHelp=document.createElement("div");htmlHelp.innerHTML=noContentHelp;if(htmlHelp.innerText.trim()){viewProps.info.noContentHelp=noContentHelp;}}
this.withSearchProps={...this.props,Component:ViewClass,componentProps:viewProps,};if(searchViewId!==undefined){this.withSearchProps.searchViewId=searchViewId;}
if(searchViewArch){this.withSearchProps.searchViewArch=searchViewArch;this.withSearchProps.searchViewFields=searchViewFields;}
if(irFilters){this.withSearchProps.irFilters=irFilters;}
if(!this.withSearchProps.searchMenuTypes){this.withSearchProps.searchMenuTypes=this.props.searchMenuTypes||ViewClass.searchMenuTypes||this.constructor.searchMenuTypes;}
for(const key in this.withSearchProps){if(!(key in WithSearch.props)){delete this.withSearchProps[key];}}}
async willUpdateProps(nextProps){const{comparison,context,domain,groupBy,orderBy}=nextProps;Object.assign(this.withSearchProps,{comparison,context,domain,groupBy,orderBy});}}
View.template="web.View";View.components={WithSearch};View.defaultProps={display:{},context:{},loadActionMenus:false,loadIrFilters:false,};View.searchMenuTypes=["filter","groupBy","favorite"];return __exports;});;

/* /web/static/src/views/view_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/views/view_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const viewService=__exports.viewService={name:"view",dependencies:["orm"],start(env,{orm}){let cache={};env.bus.on("CLEAR-CACHES",null,()=>{cache={};const processedArchs=registry.category("__processed_archs__");processedArchs.content={};processedArchs.trigger("UPDATE");});async function loadViews(params,options){const key=JSON.stringify([params.resModel,params.views,params.context,options]);if(!cache[key]){cache[key]=orm.call(params.resModel,"load_views",[],{views:params.views,options:{action_id:options.actionId||false,load_filters:options.loadIrFilters||false,toolbar:options.loadActionMenus||false,},context:params.context,}).then((result)=>{const viewDescriptions={__legacy__:result,};for(const[,viewType]of params.views){const viewDescription=JSON.parse(JSON.stringify(result.fields_views[viewType]));viewDescription.viewId=viewDescription.view_id;delete viewDescription.view_id;if(viewDescription.toolbar){viewDescription.actionMenus=viewDescription.toolbar;delete viewDescription.toolbar;}
viewDescription.fields=Object.assign({},result.fields,viewDescription.fields);delete viewDescription.base_model;delete viewDescription.field_parent;if(viewType==="search"&&options.loadIrFilters){viewDescription.irFilters=result.filters;}
viewDescriptions[viewType]=viewDescription;}
return viewDescriptions;}).catch((error)=>{delete cache[key];return Promise.reject(error);});}
return cache[key];}
return{loadViews};},};registry.category("services").add("view",viewService);return __exports;});;

/* /web/static/src/webclient/actions/action_container.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/actions/action_container',async function(require){'use strict';let __exports={};const{ActionDialog}=require("@web/webclient/actions/action_dialog");const{Component,tags}=owl;const ActionContainer=__exports.ActionContainer=class ActionContainer extends Component{setup(){this.info={};this.env.bus.on("ACTION_MANAGER:UPDATE",this,(info)=>{this.info=info;this.render();});}
__destroy(){this.env.bus.off("ACTION_MANAGER:UPDATE",this);super.__destroy();}}
ActionContainer.components={ActionDialog};ActionContainer.template=tags.xml`
    <t t-name="web.ActionContainer">
      <div class="o_action_manager">
        <t t-if="info.Component" t-component="info.Component" t-props="info.componentProps" t-key="info.id"/>
      </div>
    </t>`;return __exports;});;

/* /web/static/src/webclient/actions/action_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/actions/action_dialog',async function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{DebugMenu}=require("@web/core/debug/debug_menu");const{useOwnDebugContext}=require("@web/core/debug/debug_context");const{useEffect}=require("@web/core/utils/hooks");const{hooks}=owl;const LEGACY_SIZE_CLASSES={"extra-large":"modal-xl",large:"modal-lg",small:"modal-sm",};class ActionDialog extends Dialog{setup(){super.setup();useOwnDebugContext();this.actionRef=hooks.useRef("actionRef");const actionProps=this.props&&this.props.actionProps;const action=actionProps&&actionProps.action;this.actionType=action&&action.type;this.title="title"in this.props?this.props.title:this.constructor.title;}}
ActionDialog.components={...Dialog.components,DebugMenu};ActionDialog.template="web.ActionDialog";ActionDialog.bodyTemplate="web.ActionDialogBody";ActionDialog.props={ActionComponent:{optional:true},actionProps:{optional:true},title:{optional:true},close:Function,};class LegacyAdaptedActionDialog extends ActionDialog{setup(){super.setup();const actionProps=this.props&&this.props.actionProps;const action=actionProps&&actionProps.action;const actionContext=action&&action.context;const actionDialogSize=actionContext&&actionContext.dialog_size;this.size=LEGACY_SIZE_CLASSES[actionDialogSize]||this.constructor.size;const ControllerComponent=this.props&&this.props.ActionComponent;const Controller=ControllerComponent&&ControllerComponent.Component;this.isLegacy=Controller&&Controller.isLegacy;useEffect(()=>{if(this.isLegacy){const componentController=this.actionRef.comp;const controller=componentController.componentRef.comp;const viewAdapter=controller.controllerRef.comp;const widget=viewAdapter.widget;const footer=this.modalRef.el.querySelector("footer");widget.renderButtons($(footer));}},()=>[]);}}
LegacyAdaptedActionDialog.footerTemplate="web.LegacyAdaptedActionDialogFooter";Object.assign(__exports,{ActionDialog:LegacyAdaptedActionDialog});return __exports;});;

/* /web/static/src/webclient/actions/action_hook.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/actions/action_hook',async function(require){'use strict';let __exports={};const{getScrollPosition,setScrollPosition}=require("@web/core/utils/scrolling");const{useEffect}=require("@web/core/utils/hooks");const{useComponent}=owl.hooks;const scrollSymbol=Symbol("scroll");const CallbackRecorder=__exports.CallbackRecorder=class CallbackRecorder{constructor(){this.setup();}
setup(){this._callbacks=[];}
get callbacks(){return this._callbacks.map(({callback})=>callback);}
add(owner,callback){if(!callback){throw new Error("Missing callback");}
this._callbacks.push({owner,callback});}
remove(owner){this._callbacks=this._callbacks.filter((s)=>s.owner!==owner);}}
__exports.useCallbackRecorder=useCallbackRecorder;function useCallbackRecorder(callbackRecorder,callback){const component=useComponent();useEffect(()=>{callbackRecorder.add(component,callback);return()=>callbackRecorder.remove(component);},()=>[]);}
__exports.useSetupAction=useSetupAction;function useSetupAction(params={}){const component=useComponent();const{__beforeLeave__,__getGlobalState__,__getLocalState__,__getContext__,}=component.env;if(__beforeLeave__&&params.beforeLeave){useCallbackRecorder(__beforeLeave__,params.beforeLeave);}
if(__getGlobalState__&&params.getGlobalState){useCallbackRecorder(__getGlobalState__,params.getGlobalState);}
if(__getLocalState__){useCallbackRecorder(__getLocalState__,()=>{const state={};state[scrollSymbol]=getScrollPosition(component);if(params.getLocalState){Object.assign(state,params.getLocalState());}
return state;});}
if(__getContext__&&params.getContext){useCallbackRecorder(__getContext__,params.getContext);}
useEffect(()=>{if(component.props.state&&component.props.state[scrollSymbol]){setScrollPosition(component,component.props.state[scrollSymbol]);}},()=>[]);}
return __exports;});;

/* /web/static/src/webclient/actions/action_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/actions/action_service',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{makeContext}=require("@web/core/context");const{useDebugCategory}=require("@web/core/debug/debug_context");const{download}=require("@web/core/network/download");const{evaluateExpr}=require("@web/core/py_js/py");const{registry}=require("@web/core/registry");const{KeepLast}=require("@web/core/utils/concurrency");const{useBus,useService}=require("@web/core/utils/hooks");const{sprintf}=require("@web/core/utils/strings");const{cleanDomFromBootstrap}=require("@web/legacy/utils");const{View}=require("@web/views/view");const{ActionDialog}=require("@web/webclient/actions/action_dialog");const{CallbackRecorder}=require("@web/webclient/actions/action_hook");const{Component,hooks,tags}=owl;const{useRef,useSubEnv}=hooks;const actionHandlersRegistry=registry.category("action_handlers");const actionRegistry=registry.category("actions");const viewRegistry=registry.category("views");__exports.clearUncommittedChanges=clearUncommittedChanges;function clearUncommittedChanges(env){const callbacks=[];env.bus.trigger("CLEAR-UNCOMMITTED-CHANGES",callbacks);return Promise.all(callbacks.map((fn)=>fn()));}
function parseActiveIds(ids){const activeIds=[];if(typeof ids==="string"){activeIds.push(...ids.split(",").map(Number));}else if(typeof ids==="number"){activeIds.push(ids);}
return activeIds;}
const ViewNotFoundError=__exports.ViewNotFoundError=class ViewNotFoundError extends Error{}
const ControllerNotFoundError=__exports.ControllerNotFoundError=class ControllerNotFoundError extends Error{}
const InvalidButtonParamsError=__exports.InvalidButtonParamsError=class InvalidButtonParamsError extends Error{}
const CTX_KEY_REGEX=/^(?:(?:default_|search_default_|show_).+|.+_view_ref|group_by|group_by_no_leaf|active_id|active_ids|orderedBy)$/;const ControllerComponentTemplate=tags.xml`<t t-component="Component" t-props="props"
    t-ref="component"
    t-on-history-back="onHistoryBack"
    t-on-controller-title-updated.stop="onTitleUpdated"/>`;function makeActionManager(env){const keepLast=new KeepLast();let id=0;let controllerStack=[];let dialogCloseProm;let actionCache={};let dialog=null;const actionParams=_getActionParams();if(actionParams&&typeof actionParams.actionRequest==="number"){const{actionRequest,options}=actionParams;_loadAction(actionRequest,options.additionalContext);}
env.bus.on("CLEAR-CACHES",null,()=>{actionCache={};});function _removeDialog(){if(dialog){const{onClose,remove}=dialog;dialog=null;remove();return onClose;}}
function _getCurrentController(){const stack=controllerStack;return stack.length?stack[stack.length-1]:null;}
async function _loadAction(actionRequest,context={}){if(typeof actionRequest==="string"&&actionRegistry.contains(actionRequest)){return{target:"current",tag:actionRequest,type:"ir.actions.client",};}
if(typeof actionRequest==="string"||typeof actionRequest==="number"){const additional_context={active_id:context.active_id,active_ids:context.active_ids,active_model:context.active_model,};const key=`${JSON.stringify(actionRequest)},${JSON.stringify(additional_context)}`;if(!actionCache[key]){actionCache[key]=env.services.rpc("/web/action/load",{action_id:actionRequest,additional_context,});}
const action=await actionCache[key];if(!action){return{type:"ir.actions.client",tag:"invalid_action",id:actionRequest,};}
return Object.assign({},action);}
return actionRequest;}
function _preprocessAction(action,context={}){action._originalAction=JSON.stringify(action);action.context=makeContext([context,action.context],env.services.user.context);if(action.domain){const domain=action.domain||[];action.domain=typeof domain==="string"?evaluateExpr(domain,Object.assign({},env.services.user.context,action.context)):domain;}
action={...action};action.jsId=`action_${++id}`;if(action.type==="ir.actions.act_window"||action.type==="ir.actions.client"){action.target=action.target||"current";}
if(action.type==="ir.actions.act_window"){action.views=[...action.views];action.controllers={};const target=action.target;if(target!=="inline"&&!(target==="new"&&action.views[0][1]==="form")){const searchViewId=action.search_view_id?action.search_view_id[0]:false;action.views.push([searchViewId,"search"]);}}
return action;}
function _getView(viewType){const currentController=controllerStack[controllerStack.length-1];if(currentController.action.type!=="ir.actions.act_window"){throw new Error(`switchView called but the current controller isn't a view`);}
const view=currentController.views.find((view)=>view.type===viewType);return view||null;}
function _getBreadcrumbs(stack){return stack.filter((controller)=>controller.action.tag!=="menu").map((controller)=>{return{jsId:controller.jsId,name:controller.title||controller.action.name||env._t("Undefined"),};});}
function _getActionParams(){const state=env.services.router.current.hash;const options={clearBreadcrumbs:true};let actionRequest=null;if(state.action){if(actionRegistry.contains(state.action)){actionRequest={params:state,tag:state.action,type:"ir.actions.client",};}else{actionRequest=state.action;const context={params:state};if(state.active_id){context.active_id=state.active_id;}
if(state.active_ids){context.active_ids=parseActiveIds(state.active_ids);}else if(state.active_id){context.active_ids=[state.active_id];}
Object.assign(options,{additionalContext:context,viewType:state.view_type,});if(state.id){options.props={resId:state.id};}}}else if(state.model){if(state.id){actionRequest={res_model:state.model,res_id:state.id,type:"ir.actions.act_window",views:[[state.view_id?state.view_id:false,"form"]],};}else if(state.view_type){const storedAction=browser.sessionStorage.getItem("current_action");const lastAction=JSON.parse(storedAction||"{}");if(lastAction.res_model===state.model){actionRequest=lastAction;options.viewType=state.view_type;}}}
if(!actionRequest&&env.services.user.home_action_id){actionRequest=env.services.user.home_action_id;}
return actionRequest?{actionRequest,options}:null;}
function _getActionInfo(action,props){return{props:Object.assign({},props,{action,actionId:action.id}),config:{actionId:action.id,actionType:action.type,actionFlags:action.flags,displayName:action.display_name||action.name||"",views:action.views,},};}
function _getActionMode(action){if(action.target==="new"){return"new";}
if(action.type==="ir.actions.client"){const clientAction=actionRegistry.get(action.tag);if(clientAction.target){return clientAction.target;}}
if(controllerStack.some((c)=>c.action.target==="fullscreen")){return"fullscreen";}
return"current";}
function _getSwitchViewParams(){const state=env.services.router.current.hash;if(state.action&&!actionRegistry.contains(state.action)){const currentController=controllerStack[controllerStack.length-1];const currentActionId=currentController&&currentController.action&&currentController.action.id;if(currentController&&currentController.action.type==="ir.actions.act_window"&&currentActionId===state.action){const props={resId:state.id||false};const viewType=state.view_type||currentController.view.type;return{viewType,props};}}
return null;}
function _getViewInfo(view,action,views,props={}){const target=action.target;const viewSwitcherEntries=views.filter((v)=>v.multiRecord===view.multiRecord).map((v)=>{const viewSwitcherEntry={icon:v.icon,name:v.display_name.toString(),type:v.type,multiRecord:v.multiRecord,};if(view.type===v.type){viewSwitcherEntry.active=true;}
return viewSwitcherEntry;});const context=action.context||{};let groupBy=context.group_by||[];if(typeof groupBy==="string"){groupBy=[groupBy];}
const viewProps=Object.assign({},props,{context,display:{mode:target==="new"?"inDialog":target},domain:action.domain||[],groupBy,loadActionMenus:target!=="new"&&target!=="inline",loadIrFilters:action.views.some((v)=>v[1]==="search"),resModel:action.res_model,type:view.type,});if(target==="inline"){viewProps.searchMenuTypes=[];}
const specialKeys=["help","useSampleModel","limit","count"];for(const key of specialKeys){if(key in action){if(key==="help"){viewProps.noContentHelp=action.help;}else{viewProps[key]=action[key];}}}
if(context.active_id||context.active_ids||context.search_disable_custom_filters){viewProps.activateFavorite=false;}
if(action.res_id){viewProps.resId=action.res_id;}
if(view.isLegacy){const legacyActionInfo={...action,...viewProps.action};Object.assign(viewProps,{action:legacyActionInfo,View:view,views:action.views,});}
return{props:viewProps,config:{actionId:action.id,actionType:action.type,actionFlags:action.flags,displayName:action.display_name||action.name||"",views:action.views,viewSwitcherEntries,},};}
function _computeStackIndex(options){let index=null;if(options.clearBreadcrumbs){index=0;}else if(options.stackPosition==="replaceCurrentAction"){const currentController=controllerStack[controllerStack.length-1];if(currentController){index=controllerStack.findIndex((ct)=>ct.action.jsId===currentController.action.jsId);}}else if(options.stackPosition==="replacePreviousAction"){let last;for(let i=controllerStack.length-1;i>=0;i--){const action=controllerStack[i].action.jsId;if(!last){last=action;}
if(action!==last){last=action;break;}}
if(last){index=controllerStack.findIndex((ct)=>ct.action.jsId===last);}}else if("index"in options){index=options.index;}else{index=controllerStack.length;}
return index;}
async function _updateUI(controller,options={}){let resolve;let reject;let dialogCloseResolve;const currentActionProm=new Promise((_res,_rej)=>{resolve=_res;reject=_rej;});const action=controller.action;const index=_computeStackIndex(options);const controllerArray=[controller];if(options.lazyController){controllerArray.unshift(options.lazyController);}
const nextStack=controllerStack.slice(0,index).concat(controllerArray);controller.config.breadcrumbs=_getBreadcrumbs(nextStack.slice(0,-1));if(controller.Component.isLegacy){controller.props.breadcrumbs=controller.config.breadcrumbs;}
class ControllerComponent extends Component{setup(){this.Component=controller.Component;this.componentRef=useRef("component");this.titleService=useService("title");useDebugCategory("action",{action});useSubEnv({config:controller.config});if(action.target!=="new"){this.__beforeLeave__=new CallbackRecorder();this.__getGlobalState__=new CallbackRecorder();this.__getLocalState__=new CallbackRecorder();useBus(env.bus,"CLEAR-UNCOMMITTED-CHANGES",(callbacks)=>{const beforeLeaveFns=this.__beforeLeave__.callbacks;callbacks.push(...beforeLeaveFns);});useSubEnv({__beforeLeave__:this.__beforeLeave__,__getGlobalState__:this.__getGlobalState__,__getLocalState__:this.__getLocalState__,});}
this.isMounted=false;}
catchError(error){reject(error);cleanDomFromBootstrap();if(action.target==="new"){throw error;}else{const lastCt=controllerStack[controllerStack.length-1];let info={};if(lastCt){if(lastCt.jsId===controller.jsId){Promise.resolve().then(()=>{throw error;});return;}else{info=lastCt.__info__;}}
env.bus.trigger("ACTION_MANAGER:UPDATE",info);}}
mounted(){if(action.target==="new"){dialogCloseProm=new Promise((_r)=>{dialogCloseResolve=_r;}).then(()=>{dialogCloseProm=undefined;});dialog=nextDialog;}else{controller.getGlobalState=()=>{const exportFns=this.__getGlobalState__.callbacks;if(exportFns.length){return Object.assign({},...exportFns.map((fn)=>fn()));}};controller.getLocalState=()=>{const exportFns=this.__getLocalState__.callbacks;if(exportFns.length){return Object.assign({},...exportFns.map((fn)=>fn()));}};const nextStackActionIds=nextStack.map((c)=>c.action.jsId);const toDestroy=new Set();for(const c of controllerStack){if(!nextStackActionIds.includes(c.action.jsId)){if(c.action.type==="ir.actions.act_window"){for(const viewType in c.action.controllers){const controller=c.action.controllers[viewType];if(controller.Component.isLegacy){toDestroy.add(controller);}}}else{toDestroy.add(c);}}}
for(const c of toDestroy){if(c.exportedState&&c.exportedState.__legacy_widget__){c.exportedState.__legacy_widget__.destroy();}}
controllerStack=nextStack;pushState(controller);this.titleService.setParts({action:controller.title||this.env.config.displayName,});browser.sessionStorage.setItem("current_action",action._originalAction);}
resolve();env.bus.trigger("ACTION_MANAGER:UI-UPDATED",_getActionMode(action));this.isMounted=true;}
willUnmount(){if(action.target==="new"&&dialogCloseResolve){dialogCloseResolve();}}
onHistoryBack(){const previousController=controllerStack[controllerStack.length-2];if(previousController&&!dialog){restore(previousController.jsId);}else{_executeCloseAction();}}
onTitleUpdated(ev){controller.title=ev.detail;if(this.isMounted){this.titleService.setParts({action:controller.title});}}}
ControllerComponent.template=ControllerComponentTemplate;ControllerComponent.Component=controller.Component;let nextDialog=null;if(action.target==="new"){cleanDomFromBootstrap();const actionDialogProps={ActionComponent:ControllerComponent,actionProps:controller.props,};if(action.name){actionDialogProps.title=action.name;}
let onClose=_removeDialog();const removeDialog=env.services.dialog.add(ActionDialog,actionDialogProps,{onClose:()=>{const onClose=_removeDialog();if(onClose){onClose();}
cleanDomFromBootstrap();},});nextDialog={remove:removeDialog,onClose:onClose||options.onClose,};return currentActionProm;}
const currentController=_getCurrentController();if(currentController&&currentController.getLocalState){currentController.exportedState=currentController.getLocalState();}
if(controller.exportedState){controller.props.state=controller.exportedState;}
if(currentController&&currentController.getGlobalState){currentController.action.globalState=Object.assign({},currentController.action.globalState,currentController.getGlobalState());}
if(controller.action.globalState){controller.props.globalState=controller.action.globalState;}
const closingProm=_executeCloseAction();controller.__info__={id:++id,Component:ControllerComponent,componentProps:controller.props,};env.bus.trigger("ACTION_MANAGER:UPDATE",controller.__info__);return Promise.all([currentActionProm,closingProm]).then((r)=>r[0]);}
function _executeActURLAction(action,options){if(action.target==="self"){env.services.router.redirect(action.url);}else{const w=browser.open(action.url,"_blank");if(!w||w.closed||typeof w.closed==="undefined"){const msg=env._t("A popup window has been blocked. You may need to change your "+"browser settings to allow popup windows for this page.");env.services.notification.add(msg,{sticky:true,type:"warning",});}
if(options.onClose){options.onClose();}}}
function _executeActWindowAction(action,options){const views=[];for(const[,type]of action.views){if(viewRegistry.contains(type)){views.push(viewRegistry.get(type));}}
if(!views.length){throw new Error(`No view found for act_window action ${action.id}`);}
let view=options.viewType&&views.find((v)=>v.type===options.viewType);let lazyView;if(view&&!view.multiRecord){lazyView=views[0].multiRecord?views[0]:undefined;}else if(!view){view=views[0];}
if(env.isSmall){if(!view.isMobileFriendly){view=_findMobileView(views,view.multiRecord)||view;}
if(lazyView&&!lazyView.isMobileFriendly){lazyView=_findMobileView(views,lazyView.multiRecord)||lazyView;}}
const controller={jsId:`controller_${++id}`,Component:view.isLegacy?view:View,action,view,views,..._getViewInfo(view,action,views,options.props),};action.controllers[view.type]=controller;const updateUIOptions={clearBreadcrumbs:options.clearBreadcrumbs,onClose:options.onClose,stackPosition:options.stackPosition,};if(lazyView){updateUIOptions.lazyController={jsId:`controller_${++id}`,Component:lazyView.isLegacy?lazyView:View,action,view:lazyView,views,..._getViewInfo(lazyView,action,views),};}
return _updateUI(controller,updateUIOptions);}
function _findMobileView(views,multiRecord){return views.find((view)=>view.isMobileFriendly&&view.multiRecord===multiRecord);}
async function _executeClientAction(action,options){const clientAction=actionRegistry.get(action.tag);if(clientAction.prototype instanceof Component){if(action.target!=="new"){await clearUncommittedChanges(env);if(clientAction.target){action.target=clientAction.target;}}
const controller={jsId:`controller_${++id}`,Component:clientAction,action,..._getActionInfo(action,options.props),};return _updateUI(controller,{clearBreadcrumbs:options.clearBreadcrumbs,stackPosition:options.stackPosition,onClose:options.onClose,});}else{const next=await clientAction(env,action);if(next){return doAction(next,options);}}}
const link='<br><br><a href="http://wkhtmltopdf.org/" target="_blank">wkhtmltopdf.org</a>';const WKHTMLTOPDF_MESSAGES={broken:env._t("Your installation of Wkhtmltopdf seems to be broken. The report will be shown "+"in html.")+link,install:env._t("Unable to find Wkhtmltopdf on this system. The report will be shown in "+"html.")+link,upgrade:env._t("You should upgrade your version of Wkhtmltopdf to at least 0.12.0 in order to "+"get a correct display of headers and footers as well as support for "+"table-breaking between pages.")+link,workers:env._t("You need to start Odoo with at least two workers to print a pdf version of "+"the reports."),};let wkhtmltopdfStateProm;function _getReportUrl(action,type){let url=`/report/${type}/${action.report_name}`;const actionContext=action.context||{};if(action.data&&JSON.stringify(action.data)!=="{}"){const options=encodeURIComponent(JSON.stringify(action.data));const context=encodeURIComponent(JSON.stringify(actionContext));url+=`?options=${options}&context=${context}`;}else{if(actionContext.active_ids){url+=`/${actionContext.active_ids.join(",")}`;}
if(type==="html"){const context=encodeURIComponent(JSON.stringify(env.services.user.context));url+=`?context=${context}`;}}
return url;}
async function _triggerDownload(action,options,type){const url=_getReportUrl(action,type);env.services.ui.block();try{await download({url:"/report/download",data:{data:JSON.stringify([url,action.report_type]),context:JSON.stringify(env.services.user.context),},});}finally{env.services.ui.unblock();}
const onClose=options.onClose;if(action.close_on_report_download){return doAction({type:"ir.actions.act_window_close"},{onClose});}else if(onClose){onClose();}}
function _executeReportClientAction(action,options){const props=Object.assign({},options.props,{data:action.data,display_name:action.display_name,name:action.name,report_file:action.report_file,report_name:action.report_name,report_url:_getReportUrl(action,"html"),context:Object.assign({},action.context),});const controller={jsId:`controller_${++id}`,Component:actionRegistry.get("report.client_action"),action,..._getActionInfo(action,props),};return _updateUI(controller,{clearBreadcrumbs:options.clearBreadcrumbs,stackPosition:options.stackPosition,onClose:options.onClose,});}
async function _executeReportAction(action,options){const handlers=registry.category("ir.actions.report handlers").getAll();for(const handler of handlers){const result=await handler(action,options,env);if(result){return result;}}
if(action.report_type==="qweb-html"){return _executeReportClientAction(action,options);}else if(action.report_type==="qweb-pdf"){if(!wkhtmltopdfStateProm){wkhtmltopdfStateProm=env.services.rpc("/report/check_wkhtmltopdf");}
const state=await wkhtmltopdfStateProm;if(state in WKHTMLTOPDF_MESSAGES){env.services.notification.add(WKHTMLTOPDF_MESSAGES[state],{sticky:true,title:env._t("Report"),});}
if(state==="upgrade"||state==="ok"){return _triggerDownload(action,options,"pdf");}else{return _executeReportClientAction(action,options);}}else if(action.report_type==="qweb-text"){return _triggerDownload(action,options,"text");}else{console.error(`The ActionManager can't handle reports of type ${action.report_type}`,action);}}
async function _executeServerAction(action,options){const runProm=env.services.rpc("/web/action/run",{action_id:action.id,context:makeContext([env.services.user.context,action.context]),});let nextAction=await keepLast.add(runProm);nextAction=nextAction||{type:"ir.actions.act_window_close"};return doAction(nextAction,options);}
async function _executeCloseAction(params={}){let onClose;if(dialog){onClose=_removeDialog();}else{onClose=params.onClose;}
if(onClose){await onClose(params.onCloseInfo);}
return dialogCloseProm;}
async function doAction(actionRequest,options={}){const actionProm=_loadAction(actionRequest,options.additionalContext);let action=await keepLast.add(actionProm);action=_preprocessAction(action,options.additionalContext);switch(action.type){case"ir.actions.act_url":return _executeActURLAction(action,options);case"ir.actions.act_window":if(action.target!=="new"){await clearUncommittedChanges(env);}
return _executeActWindowAction(action,options);case"ir.actions.act_window_close":return _executeCloseAction({onClose:options.onClose,onCloseInfo:action.infos});case"ir.actions.client":return _executeClientAction(action,options);case"ir.actions.report":return _executeReportAction(action,options);case"ir.actions.server":return _executeServerAction(action,options);default:{let handler=actionHandlersRegistry.get(action.type,null);if(handler!==null){return handler({env,action,options});}
throw new Error(`The ActionManager service can't handle actions of type ${action.type}`);}}}
async function doActionButton(params){let action;const context=makeContext([params.context,params.buttonContext]);if(params.special){action={type:"ir.actions.act_window_close",infos:{special:true}};}else if(params.type==="object"){let args=params.resId?[[params.resId]]:[params.resIds];if(params.args){let additionalArgs;try{additionalArgs=JSON.parse(params.args.replace(/'/g,'"'));}catch(e){browser.console.error("Could not JSON.parse arguments",params.args);}
args=args.concat(additionalArgs);}
const callProm=env.services.rpc("/web/dataset/call_button",{args,kwargs:{context},method:params.name,model:params.resModel,});action=await keepLast.add(callProm);action=action&&typeof action==="object"?action:{type:"ir.actions.act_window_close"};}else if(params.type==="action"){context.active_id=params.resId||null;context.active_ids=params.resIds;context.active_model=params.resModel;action=await keepLast.add(_loadAction(params.name,context));}else{throw new InvalidButtonParamsError("Missing type for doActionButton request");}
let currentCtx={};for(const key in params.context){if(key.match(CTX_KEY_REGEX)===null){currentCtx[key]=params.context[key];}}
const activeCtx={active_model:params.resModel};if(params.resId){activeCtx.active_id=params.resId;activeCtx.active_ids=[params.resId];}
action.context=makeContext([currentCtx,params.buttonContext,activeCtx,action.context]);const effect=params.effect?evaluateExpr(params.effect):action.effect;const options={onClose:params.onClose};await doAction(action,options);if(params.close){await _executeCloseAction();}
if(effect){env.services.effect.add(effect);}}
async function switchView(viewType,props={}){const controller=controllerStack[controllerStack.length-1];const view=_getView(viewType);if(!view){throw new ViewNotFoundError(sprintf(env._t("No view of type '%s' could be found in the current action."),viewType));}
const newController=controller.action.controllers[viewType]||{jsId:`controller_${++id}`,Component:view.isLegacy?view:View,action:controller.action,views:controller.views,view,};if(view.isLegacy&&newController.jsId===controller.jsId){const{__legacy_widget__}=controller.getLocalState();const params={};if("resId"in props){params.currentId=props.resId;}
return __legacy_widget__.reload(params);}
Object.assign(newController,_getViewInfo(view,controller.action,controller.views,props));controller.action.controllers[viewType]=newController;let index;if(view.multiRecord){index=controllerStack.findIndex((ct)=>ct.action.jsId===controller.action.jsId);index=index>-1?index:controllerStack.length-1;}else{index=controllerStack.findIndex((ct)=>ct.action.jsId===controller.action.jsId&&!ct.view.multiRecord);index=index>-1?index:controllerStack.length;}
await clearUncommittedChanges(env);return _updateUI(newController,{index});}
async function restore(jsId){let index;if(!jsId){index=controllerStack.length-2;}else{index=controllerStack.findIndex((controller)=>controller.jsId===jsId);}
if(index<0){const msg=jsId?"Invalid controller to restore":"No controller to restore";throw new ControllerNotFoundError(msg);}
const controller=controllerStack[index];if(controller.action.type==="ir.actions.act_window"){Object.assign(controller,_getViewInfo(controller.view,controller.action,controller.views));}
await clearUncommittedChanges(env);return _updateUI(controller,{index});}
async function loadState(){const switchViewParams=_getSwitchViewParams();if(switchViewParams){const{viewType,props}=switchViewParams;const view=_getView(viewType);if(view){await switchView(viewType,props);return true;}}else{const actionParams=_getActionParams();if(actionParams){const{actionRequest,options}=actionParams;await doAction(actionRequest,options);return true;}}
return false;}
function pushState(controller){const newState={};const action=controller.action;if(action.id){newState.action=action.id;}else if(action.type==="ir.actions.client"){newState.action=action.tag;}
if(action.context){const activeId=action.context.active_id;if(activeId){newState.active_id=activeId;}
const activeIds=action.context.active_ids;if(activeIds&&!(activeIds.length===1&&activeIds[0]===activeId)){newState.active_ids=activeIds.join(",");}}
if(action.type==="ir.actions.act_window"){const props=controller.props;newState.model=props.resModel;newState.view_type=props.type;newState.id=props.resId||(props.state&&props.state.currentId)||undefined;}
env.services.router.pushState(newState,{replace:true});}
return{doAction,doActionButton,switchView,restore,loadState,async loadAction(actionRequest,context){let action=await _loadAction(actionRequest,context);return _preprocessAction(action,context);},get currentController(){return _getCurrentController();},__legacy__isActionInStack(actionId){return controllerStack.find((c)=>c.action.jsId===actionId);},};}
const actionService=__exports.actionService={dependencies:["effect","localization","notification","router","rpc","ui","user"],start(env){return makeActionManager(env);},};registry.category("services").add("action",actionService);return __exports;});;

/* /web/static/src/webclient/actions/client_actions.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/actions/client_actions',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{sprintf}=require("@web/core/utils/strings");const{utils,Component}=owl;const{escape}=utils;const displayNotificationAction=__exports.displayNotificationAction=(env,action)=>{const params=action.params||{};const options={className:params.className||"",sticky:params.sticky||false,title:params.title,type:params.type||"info",messageIsHtml:true,};let links=(params.links||[]).map((link)=>{return`<a href="${escape(link.url)}" target="_blank">${escape(link.label)}</a>`;});const message=sprintf(escape(params.message),...links);env.services.notification.add(message,options);return params.next;};registry.category("actions").add("display_notification",displayNotificationAction);class InvalidAction extends Component{setup(){this.notification=useService("notification");}
mounted(){const message=sprintf(this.env._t("No action with id '%s' could be found"),this.props.actionId);this.notification.add(message,{type:"danger"});}}
InvalidAction.template=owl.tags.xml`<div class="o_invalid_action"></div>`;registry.category("actions").add("invalid_action",InvalidAction);return __exports;});;

/* /web/static/src/webclient/actions/debug_items.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/actions/debug_items',async function(require){'use strict';let __exports={};const{editModelDebug}=require("@web/core/debug/debug_utils");const{registry}=require("@web/core/registry");const debugRegistry=registry.category("debug");function actionSeparator({action}){if(!action.id||!action.res_model){return null;}
return{type:"separator",sequence:100,};}
function accessSeparator({accessRights,action}){const{canSeeModelAccess,canSeeRecordRules}=accessRights;if(!action.res_model||(!canSeeModelAccess&&!canSeeRecordRules)){return null;}
return{type:"separator",sequence:200,};}
function editAction({action,env}){if(!action.id){return null;}
const description=env._t("Edit Action");return{type:"item",description,callback:()=>{editModelDebug(env,description,action.type,action.id);},sequence:110,};}
function viewFields({action,env}){if(!action.res_model){return null;}
const description=env._t("View Fields");return{type:"item",description,callback:async()=>{const modelId=(await env.services.orm.search("ir.model",[["model","=",action.res_model]],{limit:1,}))[0];env.services.action.doAction({res_model:"ir.model.fields",name:description,views:[[false,"list"],[false,"form"],],domain:[["model_id","=",modelId]],type:"ir.actions.act_window",context:{default_model_id:modelId,},});},sequence:120,};}
function manageFilters({action,env}){if(!action.res_model){return null;}
const description=env._t("Manage Filters");return{type:"item",description,callback:()=>{env.services.action.doAction({res_model:"ir.filters",name:description,views:[[false,"list"],[false,"form"],],type:"ir.actions.act_window",context:{search_default_my_filters:true,search_default_model_id:action.res_model,},});},sequence:130,};}
function technicalTranslation({action,env}){if(!action.res_model){return null;}
return{type:"item",description:env._t("Technical Translation"),callback:async()=>{const result=await env.services.orm.call("ir.translation","get_technical_translations",[action.res_model]);env.services.action.doAction(result);},sequence:140,};}
function viewAccessRights({accessRights,action,env}){if(!action.res_model||!accessRights.canSeeModelAccess){return null;}
const description=env._t("View Access Rights");return{type:"item",description,callback:async()=>{const modelId=(await env.services.orm.search("ir.model",[["model","=",action.res_model]],{limit:1,}))[0];env.services.action.doAction({res_model:"ir.model.access",name:description,views:[[false,"list"],[false,"form"],],domain:[["model_id","=",modelId]],type:"ir.actions.act_window",context:{default_model_id:modelId,},});},sequence:210,};}
function viewRecordRules({accessRights,action,env}){if(!action.res_model||!accessRights.canSeeRecordRules){return null;}
const description=env._t("Model Record Rules");return{type:"item",description:env._t("View Record Rules"),callback:async()=>{const modelId=(await env.services.orm.search("ir.model",[["model","=",action.res_model]],{limit:1,}))[0];env.services.action.doAction({res_model:"ir.rule",name:description,views:[[false,"list"],[false,"form"],],domain:[["model_id","=",modelId]],type:"ir.actions.act_window",context:{default_model_id:modelId,},});},sequence:220,};}
debugRegistry.category("action").add("actionSeparator",actionSeparator).add("editAction",editAction).add("viewFields",viewFields).add("manageFilters",manageFilters).add("technicalTranslation",technicalTranslation).add("accessSeparator",accessSeparator).add("viewAccessRights",viewAccessRights).add("viewRecordRules",viewRecordRules);return __exports;});;

/* /web/static/src/webclient/clickbot/clickbot_loader.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/clickbot/clickbot_loader',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{loadJS}=owl.utils;__exports[Symbol.for("default")]=startClickEverywhere;async function startClickEverywhere(xmlId,appsMenusOnly){await loadJS("web/static/src/webclient/clickbot/clickbot.js");window.clickEverywhere(xmlId,appsMenusOnly);}
function runClickTestItem({env}){return{type:"item",description:env._t("Run Click Everywhere Test"),callback:()=>{startClickEverywhere();},sequence:30,};}
registry.category("debug").category("default").add("runClickTestItem",runClickTestItem);return __exports;});odoo.define(`web.clickEverywhere`,async function(require){return require('@web/webclient/clickbot/clickbot_loader')[Symbol.for("default")];});;

/* /web/static/src/webclient/company_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/company_service',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{symmetricalDifference}=require("@web/core/utils/arrays");const{session}=require("@web/session");function parseCompanyIds(cidsFromHash){const cids=[];if(typeof cidsFromHash==="string"){cids.push(...cidsFromHash.split(",").map(Number));}else if(typeof cidsFromHash==="number"){cids.push(cidsFromHash);}
return cids;}
function computeAllowedCompanyIds(cids){const{user_companies}=session;let allowedCompanyIds=cids||[];const availableCompaniesFromSession=user_companies.allowed_companies;const notReallyAllowedCompanies=allowedCompanyIds.filter((id)=>!(id in availableCompaniesFromSession));if(!allowedCompanyIds.length||notReallyAllowedCompanies.length){allowedCompanyIds=[user_companies.current_company];}
return allowedCompanyIds;}
const companyService=__exports.companyService={dependencies:["user","router","cookie"],start(env,{user,router,cookie}){let cids;if("cids"in router.current.hash){cids=parseCompanyIds(router.current.hash.cids);}else if("cids"in cookie.current){cids=parseCompanyIds(cookie.current.cids);}
let allowedCompanyIds=computeAllowedCompanyIds(cids);const stringCIds=allowedCompanyIds.join(",");router.replaceState({cids:stringCIds},{lock:true});cookie.setCookie("cids",stringCIds);user.updateContext({allowed_company_ids:allowedCompanyIds});const availableCompanies=session.user_companies.allowed_companies;return{availableCompanies,get allowedCompanyIds(){return allowedCompanyIds.slice();},get currentCompany(){return availableCompanies[allowedCompanyIds[0]];},setCompanies(mode,...companyIds){let nextCompanyIds;if(mode==="toggle"){nextCompanyIds=symmetricalDifference(allowedCompanyIds,companyIds);}else if(mode==="loginto"){const companyId=companyIds[0];if(allowedCompanyIds.length===1){nextCompanyIds=[companyId];}else{nextCompanyIds=[companyId,...allowedCompanyIds.filter((id)=>id!==companyId),];}}
nextCompanyIds=nextCompanyIds.length?nextCompanyIds:[companyIds[0]];router.pushState({cids:nextCompanyIds},{lock:true});cookie.setCookie("cids",nextCompanyIds);browser.setTimeout(()=>browser.location.reload());},};},};registry.category("services").add("company",companyService);return __exports;});;

/* /web/static/src/webclient/debug_items.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/debug_items',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{browser}=require("@web/core/browser/browser");const dialogs=require("web.view_dialogs");const{ComponentAdapter}=require("web.OwlCompatibility");function runJSTestsItem({env}){const runTestsURL=browser.location.origin+"/web/tests?mod=*";return{type:"item",description:env._t("Run JS Tests"),href:runTestsURL,callback:()=>{browser.open(runTestsURL);},sequence:10,};}
function runJSTestsMobileItem({env}){const runTestsMobileURL=browser.location.origin+"/web/tests/mobile?mod=*";return{type:"item",description:env._t("Run JS Mobile Tests"),href:runTestsMobileURL,callback:()=>{browser.open(runTestsMobileURL);},sequence:20,};}
__exports.openViewItem=openViewItem;function openViewItem({env}){async function onSelected(records){const views=await env.services.orm.searchRead("ir.ui.view",[["id","=",records[0].id]],["name","model","type"],{limit:1});const view=views[0];view.type=view.type==="tree"?"list":view.type;env.services.action.doAction({type:"ir.actions.act_window",name:view.name,res_model:view.model,views:[[view.id,view.type]],});}
return{type:"item",description:env._t("Open View"),callback:()=>{const adapterParent=new ComponentAdapter(null,{Component:owl.Component});const selectCreateDialog=new dialogs.SelectCreateDialog(adapterParent,{res_model:"ir.ui.view",title:env._t("Select a view"),disable_multiple_selection:true,domain:[["type","!=","qweb"],["type","!=","search"],],on_selected:onSelected,});selectCreateDialog.open();},sequence:40,};}
function globalSeparator(){return{type:"separator",sequence:400,};}
registry.category("debug").category("default").add("runJSTestsItem",runJSTestsItem).add("runJSTestsMobileItem",runJSTestsMobileItem).add("globalSeparator",globalSeparator).add("openViewItem",openViewItem);return __exports;});;

/* /web/static/src/webclient/loading_indicator/loading_indicator.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/loading_indicator/loading_indicator',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{Component,useState}=owl;const LoadingIndicator=__exports.LoadingIndicator=class LoadingIndicator extends Component{setup(){this.state=useState({count:0,show:false,});this.rpcIds=new Set();this.env.bus.on("RPC:REQUEST",this,this.requestCall);this.env.bus.on("RPC:RESPONSE",this,this.responseCall);this.uiService=useService("ui");}
requestCall(rpcId){if(this.state.count===0){this.state.show=true;this.blockUITimer=browser.setTimeout(()=>{this.shouldUnblock=true;this.uiService.block();},3000);}
this.rpcIds.add(rpcId);this.state.count++;}
responseCall(rpcId){this.rpcIds.delete(rpcId);this.state.count=this.rpcIds.size;if(this.state.count===0){if(this.shouldUnblock){this.uiService.unblock();this.shouldUnblock=false;}else{browser.clearTimeout(this.blockUITimer);}
this.state.show=false;}}}
LoadingIndicator.template="web.LoadingIndicator";registry.category("main_components").add("LoadingIndicator",{Component:LoadingIndicator,});return __exports;});;

/* /web/static/src/webclient/menus/menu_helpers.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/menus/menu_helpers',async function(require){'use strict';let __exports={};function traverseMenuTree(tree,cb,parents=[]){cb(tree,parents);tree.childrenTree.forEach((c)=>traverseMenuTree(c,cb,parents.concat([tree])));}
__exports.computeAppsAndMenuItems=computeAppsAndMenuItems;function computeAppsAndMenuItems(menuTree){const apps=[];const menuItems=[];traverseMenuTree(menuTree,(menuItem,parents)=>{if(!menuItem.id||!menuItem.actionID){return;}
const isApp=menuItem.id===menuItem.appID;const item={parents:parents.slice(1).map((p)=>p.name).join(" / "),label:menuItem.name,id:menuItem.id,xmlid:menuItem.xmlid,actionID:menuItem.actionID,appID:menuItem.appID,};if(isApp){if(menuItem.webIconData){item.webIconData=menuItem.webIconData;}else{const[iconClass,color,backgroundColor]=(menuItem.webIcon||"").split(",");if(backgroundColor!==undefined){item.webIcon={iconClass,color,backgroundColor};}else{item.webIconData="/web_enterprise/static/img/default_icon_app.png";}}}else{item.menuID=parents[1].id;}
if(isApp){apps.push(item);}else{menuItems.push(item);}});return{apps,menuItems};}
return __exports;});;

/* /web/static/src/webclient/menus/menu_providers.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/menus/menu_providers',async function(require){'use strict';let __exports={};const{_lt}=require("@web/core/l10n/translation");const{registry}=require("@web/core/registry");const{computeAppsAndMenuItems}=require("@web/webclient/menus/menu_helpers");const{fuzzyLookup}=require("@web/core/utils/search");const{Component}=owl;class AppIconCommand extends Component{}
AppIconCommand.template="web.AppIconCommand";const commandCategoryRegistry=registry.category("command_categories");commandCategoryRegistry.add("apps",{namespace:"/"},{sequence:10});commandCategoryRegistry.add("menu_items",{namespace:"/"},{sequence:20});const commandEmptyMessageRegistry=registry.category("command_empty_list");commandEmptyMessageRegistry.add("/",_lt("No menu found"));const commandProviderRegistry=registry.category("command_provider");commandProviderRegistry.add("menu",{namespace:"/",async provide(env,options){const result=[];const menuService=env.services.menu;let{apps,menuItems}=computeAppsAndMenuItems(menuService.getMenuAsTree("root"));if(options.searchValue!==""){apps=fuzzyLookup(options.searchValue,apps,(menu)=>menu.label);fuzzyLookup(options.searchValue,menuItems,(menu)=>(menu.parents+" / "+menu.label).split("/").reverse().join("/")).forEach((menu)=>{result.push({action(){menuService.selectMenu(menu);},category:"menu_items",name:menu.parents+" / "+menu.label,});});}
apps.forEach((menu)=>{const props={};if(menu.webIconData){const prefix="data:image/png;base64,";props.webIconData=menu.webIconData.startsWith(prefix)?menu.webIconData:prefix+menu.webIconData.replace(/\s/g,"");}else{props.webIcon=menu.webIcon;}
result.push({Component:AppIconCommand,action(){menuService.selectMenu(menu);},category:"apps",name:menu.label,props,});});return result;},});return __exports;});;

/* /web/static/src/webclient/menus/menu_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/menus/menu_service',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{session}=require("@web/session");const loadMenusUrl=`/web/webclient/load_menus`;function makeFetchLoadMenus(){const cacheHashes=session.cache_hashes;let loadMenusHash=cacheHashes.load_menus||new Date().getTime().toString();return async function fetchLoadMenus(reload){if(reload){loadMenusHash=new Date().getTime().toString();}else if(odoo.loadMenusPromise){return odoo.loadMenusPromise;}
const res=await browser.fetch(`${loadMenusUrl}/${loadMenusHash}`);if(!res.ok){throw new Error("Error while fetching menus");}
return res.json();};}
function makeMenus(env,menusData,fetchLoadMenus){let currentAppId;return{getAll(){return Object.values(menusData);},getApps(){return this.getMenu("root").children.map((mid)=>this.getMenu(mid));},getMenu(menuID){return menusData[menuID];},getCurrentApp(){if(!currentAppId){return;}
return this.getMenu(currentAppId);},getMenuAsTree(menuID){const menu=this.getMenu(menuID);if(!menu.childrenTree){menu.childrenTree=menu.children.map((mid)=>this.getMenuAsTree(mid));}
return menu;},async selectMenu(menu){menu=typeof menu==="number"?this.getMenu(menu):menu;if(!menu.actionID){return;}
await env.services.action.doAction(menu.actionID,{clearBreadcrumbs:true});this.setCurrentMenu(menu);},setCurrentMenu(menu){menu=typeof menu==="number"?this.getMenu(menu):menu;if(menu&&menu.appID!==currentAppId){currentAppId=menu.appID;env.bus.trigger("MENUS:APP-CHANGED");env.services.router.pushState({menu_id:menu.id},{lock:true});}},async reload(){if(fetchLoadMenus){menusData=await fetchLoadMenus(true);env.bus.trigger("MENUS:APP-CHANGED");}},};}
const menuService=__exports.menuService={dependencies:["action","router"],async start(env){const fetchLoadMenus=makeFetchLoadMenus();const menusData=await fetchLoadMenus();return makeMenus(env,menusData,fetchLoadMenus);},};registry.category("services").add("menu",menuService);return __exports;});;

/* /web/static/src/webclient/navbar/navbar.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/navbar/navbar',async function(require){'use strict';let __exports={};const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{useEffect,useService,onDestroyed,useBus}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{debounce}=require("@web/core/utils/timing");const{ErrorHandler,NotUpdatable}=require("@web/core/utils/components");const{Component,hooks}=owl;const{useExternalListener,useRef}=hooks;const systrayRegistry=registry.category("systray");const getBoundingClientRect=Element.prototype.getBoundingClientRect;const MenuDropdown=__exports.MenuDropdown=class MenuDropdown extends Dropdown{setup(){super.setup();useEffect(()=>{if(this.props.xmlid){this.togglerRef.el.dataset.menuXmlid=this.props.xmlid;}},()=>[]);}}
MenuDropdown.props.xmlid={type:String,optional:true,};const MenuItem=__exports.MenuItem=class MenuItem extends DropdownItem{setup(){super.setup();useEffect(()=>{if(this.props.payload.id){this.el.dataset.section=this.props.payload.id;}
if(this.props.payload.xmlid){this.el.dataset.menuXmlid=this.props.payload.xmlid;}},()=>[]);}}
const NavBar=__exports.NavBar=class NavBar extends Component{setup(){this.currentAppSectionsExtra=[];this.actionService=useService("action");this.menuService=useService("menu");this.appSubMenus=useRef("appSubMenus");const debouncedAdapt=debounce(this.adapt.bind(this),250);onDestroyed(()=>debouncedAdapt.cancel());useExternalListener(window,"resize",debouncedAdapt);let adaptCounter=0;const renderAndAdapt=()=>{adaptCounter++;this.render();};useBus(systrayRegistry,"UPDATE",renderAndAdapt);useBus(this.env.bus,"MENUS:APP-CHANGED",renderAndAdapt);useEffect(()=>{this.adapt();},()=>[adaptCounter]);}
handleItemError(error,item){item.isDisplayed=()=>false;Promise.resolve().then(()=>{throw error;});}
get currentApp(){return this.menuService.getCurrentApp();}
get currentAppSections(){return((this.currentApp&&this.menuService.getMenuAsTree(this.currentApp.id).childrenTree)||[]);}
get systrayItems(){return systrayRegistry.getEntries().map(([key,value])=>({key,...value})).filter((item)=>("isDisplayed"in item?item.isDisplayed(this.env):true)).reverse();}
async adapt(){if(!this.el){return;}
const sectionsMenu=this.appSubMenus.el;if(!sectionsMenu){return;}
const initialAppSectionsExtra=this.currentAppSectionsExtra;const firstInitialAppSectionExtra=[...initialAppSectionsExtra].shift();const initialAppId=firstInitialAppSectionExtra&&firstInitialAppSectionExtra.appID;const sections=[...sectionsMenu.querySelectorAll(":scope > *:not(.o_menu_sections_more)"),];for(const section of sections){section.classList.remove("d-none");}
this.currentAppSectionsExtra=[];const sectionsAvailableWidth=getBoundingClientRect.call(sectionsMenu).width;const sectionsTotalWidth=sections.reduce((sum,s)=>sum+getBoundingClientRect.call(s).width,0);if(sectionsAvailableWidth<sectionsTotalWidth){let width=46;for(const section of sections){if(sectionsAvailableWidth<width+section.offsetWidth){const overflowingSections=sections.slice(sections.indexOf(section));overflowingSections.forEach((s)=>{s.classList.add("d-none");const sectionId=s.dataset.section||s.querySelector("[data-section]").getAttribute("data-section");const currentAppSection=this.currentAppSections.find((appSection)=>appSection.id.toString()===sectionId);this.currentAppSectionsExtra.push(currentAppSection);});break;}
width+=section.offsetWidth;}}
const firstCurrentAppSectionExtra=[...this.currentAppSectionsExtra].shift();const currentAppId=firstCurrentAppSectionExtra&&firstCurrentAppSectionExtra.appID;if(initialAppSectionsExtra.length===this.currentAppSectionsExtra.length&&initialAppId===currentAppId){return;}
return this.render();}
onNavBarDropdownItemSelection(ev){const{payload:menu}=ev.detail;if(menu){this.menuService.selectMenu(menu);}}
getMenuItemHref(payload){const parts=[`menu_id=${payload.id}`];if(payload.action){parts.push(`action=${payload.action.split(",")[1]}`);}
return"#"+parts.join("&");}}
NavBar.template="web.NavBar";NavBar.components={MenuDropdown,MenuItem,NotUpdatable,ErrorHandler};return __exports;});;

/* /web/static/src/webclient/switch_company_menu/switch_company_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/switch_company_menu/switch_company_menu',async function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{browser}=require("@web/core/browser/browser");const{symmetricalDifference}=require("@web/core/utils/arrays");const{Component,hooks}=owl;const{useState}=hooks;const SwitchCompanyMenu=__exports.SwitchCompanyMenu=class SwitchCompanyMenu extends Component{setup(){this.companyService=useService("company");this.currentCompany=this.companyService.currentCompany;this.state=useState({companiesToToggle:[]});}
toggleCompany(companyId){this.state.companiesToToggle=symmetricalDifference(this.state.companiesToToggle,[companyId,]);browser.clearTimeout(this.toggleTimer);this.toggleTimer=browser.setTimeout(()=>{this.companyService.setCompanies("toggle",...this.state.companiesToToggle);},this.constructor.toggleDelay);}
logIntoCompany(companyId){browser.clearTimeout(this.toggleTimer);this.companyService.setCompanies("loginto",companyId);}
get selectedCompanies(){return symmetricalDifference(this.companyService.allowedCompanyIds,this.state.companiesToToggle);}}
SwitchCompanyMenu.template="web.SwitchCompanyMenu";SwitchCompanyMenu.toggleDelay=1000;const systrayItem=__exports.systrayItem={Component:SwitchCompanyMenu,isDisplayed(env){const{availableCompanies}=env.services.company;return Object.keys(availableCompanies).length>1;},};registry.category("systray").add("SwitchCompanyMenu",systrayItem,{sequence:1});return __exports;});;

/* /web/static/src/webclient/user_menu/user_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/user_menu/user_menu',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{registry}=require("@web/core/registry");const{useEffect,useService}=require("@web/core/utils/hooks");const{Component}=owl;const userMenuRegistry=registry.category("user_menuitems");class UserMenuItem extends DropdownItem{setup(){super.setup();useEffect(()=>{if(this.props.payload.id){this.el.dataset.menu=this.props.payload.id;}},()=>[]);}}
const UserMenu=__exports.UserMenu=class UserMenu extends Component{setup(){this.user=useService("user");const{origin}=browser.location;const{userId}=this.user;this.source=`${origin}/web/image?model=res.users&field=avatar_128&id=${userId}`;}
getElements(){const sortedItems=userMenuRegistry.getAll().map((element)=>element(this.env)).sort((x,y)=>{const xSeq=x.sequence?x.sequence:100;const ySeq=y.sequence?y.sequence:100;return xSeq-ySeq;});return sortedItems;}
onDropdownItemSelected(ev){ev.detail.payload.callback();}}
UserMenu.template="web.UserMenu";UserMenu.components={UserMenuItem};const systrayItem=__exports.systrayItem={Component:UserMenu,};registry.category("systray").add("web.user_menu",systrayItem,{sequence:0});return __exports;});;

/* /web/static/src/webclient/user_menu/user_menu_items.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/user_menu/user_menu_items',async function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{_lt}=require("@web/core/l10n/translation");const{session}=require("@web/session");function documentationItem(env){const documentationURL="https://www.odoo.com/documentation/15.0";return{type:"item",id:"documentation",description:env._t("Documentation"),href:documentationURL,callback:()=>{browser.open(documentationURL,"_blank");},sequence:10,};}
function supportItem(env){const url=session.support_url;return{type:"item",id:"support",description:env._t("Support"),href:url,callback:()=>{browser.open(url,"_blank");},sequence:20,};}
class ShortCutsDialog extends Dialog{}
ShortCutsDialog.bodyTemplate="web.UserMenu.shortcutsTable";ShortCutsDialog.title=_lt("Shortcuts");function shortCutsItem(env){return{type:"item",id:"shortcuts",hide:env.isSmall,description:env._t("Shortcuts"),callback:()=>{env.services.dialog.add(ShortCutsDialog);},sequence:30,};}
function separator(){return{type:"separator",sequence:40,};}
__exports.preferencesItem=preferencesItem;function preferencesItem(env){return{type:"item",id:"settings",description:env._t("Preferences"),callback:async function(){const actionDescription=await env.services.orm.call("res.users","action_get");actionDescription.res_id=env.services.user.userId;env.services.action.doAction(actionDescription);},sequence:50,};}
function odooAccountItem(env){return{type:"item",id:"account",description:env._t("My Odoo.com.account"),callback:()=>{env.services.rpc("/web/session/account").then((url)=>{browser.location.href=url;}).catch(()=>{browser.location.href="https://accounts.odoo.com/account";});},sequence:60,};}
function logOutItem(env){const route="/web/session/logout";return{type:"item",id:"logout",description:env._t("Log out"),href:`${browser.location.origin}${route}`,callback:()=>{browser.location.href=route;},sequence:70,};}
registry.category("user_menuitems").add("documentation",documentationItem).add("support",supportItem).add("shortcuts",shortCutsItem).add("separator",separator).add("profile",preferencesItem).add("odoo_account",odooAccountItem).add("log_out",logOutItem);return __exports;});;

/* /web/static/src/webclient/webclient.js defined in bundle 'web.assets_backend' */
odoo.define('@web/webclient/webclient',async function(require){'use strict';let __exports={};const{ActionContainer}=require("@web/webclient/actions/action_container");const{NavBar}=require("@web/webclient/navbar/navbar");const{useBus,useEffect,useService}=require("@web/core/utils/hooks");const{useTooltip}=require("@web/core/tooltip/tooltip_hook");const{NotUpdatable}=require("@web/core/utils/components");const{MainComponentsContainer}=require("@web/core/main_components_container");const{useOwnDebugContext}=require("@web/core/debug/debug_context");const{registry}=require("@web/core/registry");const{DebugMenu}=require("@web/core/debug/debug_menu");const{localization}=require("@web/core/l10n/localization");const{Component,hooks}=owl;const{useExternalListener}=hooks;const WebClient=__exports.WebClient=class WebClient extends Component{setup(){this.menuService=useService("menu");this.actionService=useService("action");this.title=useService("title");this.router=useService("router");this.user=useService("user");useService("legacy_service_provider");useOwnDebugContext({categories:["default"]});if(this.env.debug){registry.category("systray").add("web.debug_mode_menu",{Component:DebugMenu,},{sequence:100});}
this.localization=localization;this.title.setParts({zopenerp:"Odoo"});useBus(this.env.bus,"ROUTE_CHANGE",this.loadRouterState);useBus(this.env.bus,"ACTION_MANAGER:UI-UPDATED",(mode)=>{if(mode!=="new"){this.el.classList.toggle("o_fullscreen",mode==="fullscreen");}});useEffect(()=>{this.loadRouterState();},()=>[]);useExternalListener(window,"click",this.onGlobalClick,{capture:true});useTooltip();}
mounted(){this.env.bus.trigger("WEB_CLIENT_READY");}
async loadRouterState(){let stateLoaded=await this.actionService.loadState();let menuId=Number(this.router.current.hash.menu_id||0);if(!stateLoaded&&menuId){const menu=this.menuService.getAll().find((m)=>menuId===m.id);const actionId=menu&&menu.actionID;if(actionId){await this.actionService.doAction(actionId,{clearBreadcrumbs:true});stateLoaded=true;}}
if(stateLoaded&&!menuId){const currentController=this.actionService.currentController;const actionId=currentController&&currentController.action.id;const menu=this.menuService.getAll().find((m)=>m.actionID===actionId);menuId=menu&&menu.appID;}
if(menuId){this.menuService.setCurrentMenu(menuId);}
if(!stateLoaded){await this._loadDefaultApp();}}
_loadDefaultApp(){const root=this.menuService.getMenu("root");const firstApp=root.children[0];if(firstApp){return this.menuService.selectMenu(firstApp);}}
onGlobalClick(ev){if(ev.ctrlKey&&((ev.target instanceof HTMLAnchorElement&&ev.target.href)||(ev.target instanceof HTMLElement&&ev.target.closest("a[href]:not([href=''])")))){ev.stopImmediatePropagation();return;}}}
WebClient.components={ActionContainer,NavBar,NotUpdatable,MainComponentsContainer,};WebClient.template="web.WebClient";return __exports;});;

/* /web/static/src/env.js defined in bundle 'web.assets_backend' */
odoo.define('@web/env',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");__exports.makeEnv=makeEnv;function makeEnv(){return{qweb:new owl.QWeb(),bus:new owl.core.EventBus(),services:{},debug:odoo.debug,_t:()=>{throw new Error("Translations are not ready yet. Maybe use _lt instead?");},get isSmall(){throw new Error("UI service not initialized!");},};}
const serviceRegistry=registry.category("services");const SERVICES_METADATA=__exports.SERVICES_METADATA={};__exports.startServices=startServices;async function startServices(env){const toStart=new Set();serviceRegistry.on("UPDATE",null,async(payload)=>{await Promise.resolve();const{operation,key:name,value:service}=payload;if(operation==="delete"){return;}
if(toStart.size){const namedService=Object.assign(Object.create(service),{name});toStart.add(namedService);}else{await _startServices(env,toStart);}});await Promise.resolve();await _startServices(env,toStart);}
async function _startServices(env,toStart){const services=env.services;for(const[name,service]of serviceRegistry.getEntries()){if(!(name in services)){const namedService=Object.assign(Object.create(service),{name});toStart.add(namedService);}}
async function start(){let service=null;const proms=[];while((service=findNext())){let name=service.name;toStart.delete(service);const entries=(service.dependencies||[]).map((dep)=>[dep,services[dep]]);const dependencies=Object.fromEntries(entries);let value;try{value=service.start(env,dependencies);}catch(e){value=e;console.error(e);}
if("async"in service){SERVICES_METADATA[name]=service.async;}
if(value instanceof Promise){proms.push(new Promise(async(resolve)=>{value.then((val)=>{services[name]=val||null;}).catch((error)=>{services[name]=error;console.error(error);}).finally(resolve);}));}else{services[service.name]=value||null;}}
await Promise.all(proms);if(proms.length){return start();}}
await start();if(toStart.size){const names=[...toStart].map((s)=>s.name);const missingDeps=new Set();[...toStart].forEach((s)=>s.dependencies.forEach((dep)=>{if(!(dep in services)&&!names.includes(dep)){missingDeps.add(dep);}}));const depNames=[...missingDeps].join(", ");throw new Error(`Some services could not be started: ${names}. Missing dependencies: ${depNames}`);}
function findNext(){for(let s of toStart){if(s.dependencies){if(s.dependencies.every((d)=>d in services)){return s;}}else{return s;}}
return null;}}
return __exports;});;

/* /web/static/lib/jquery.scrollTo/jquery.scrollTo.js defined in bundle 'web.assets_backend' */
;(function(define){'use strict';define(['jquery'],function($){var $scrollTo=$.scrollTo=function(target,duration,settings){return $(window).scrollTo(target,duration,settings);};$scrollTo.defaults={axis:'xy',duration:0,limit:true};$scrollTo.window=function(scope){return $(window)._scrollable();};$.fn._scrollable=function(){return this.map(function(){var elem=this,isWin=!elem.nodeName||$.inArray(elem.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!isWin)
return elem;var doc=(elem.contentWindow||elem).document||elem.ownerDocument||elem;return/webkit/i.test(navigator.userAgent)||doc.compatMode=='BackCompat'?doc.body:doc.documentElement;});};$.fn.scrollTo=function(target,duration,settings){if(typeof duration=='object'){settings=duration;duration=0;}
if(typeof settings=='function')
settings={onAfter:settings};if(target=='max')
target=9e9;settings=$.extend({},$scrollTo.defaults,settings);duration=duration||settings.duration;settings.queue=settings.queue&&settings.axis.length>1;if(settings.queue)
duration/=2;settings.offset=both(settings.offset);settings.over=both(settings.over);return this._scrollable().each(function(){if(target==null)return;var elem=this,$elem=$(elem),targ=target,toff,attr={},win=$elem.is('html,body');switch(typeof targ){case'number':case'string':if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break;}
targ=win?$(targ):$(targ,this);if(!targ.length)return;case'object':if(targ.is||targ.style)
toff=(targ=$(targ)).offset();}
var offset=$.isFunction(settings.offset)&&settings.offset(elem,targ)||settings.offset;$.each(settings.axis.split(''),function(i,axis){var Pos=axis=='x'?'Left':'Top',pos=Pos.toLowerCase(),key='scroll'+Pos,old=elem[key],max=$scrollTo.max(elem,axis);if(toff){attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]);if(settings.margin){attr[key]-=parseInt(targ.css('margin'+Pos))||0;attr[key]-=parseInt(targ.css('border'+Pos+'Width'))||0;}
attr[key]+=offset[pos]||0;if(settings.over[pos])
attr[key]+=targ[axis=='x'?'width':'height']()*settings.over[pos];}else{var val=targ[pos];attr[key]=val.slice&&val.slice(-1)=='%'?parseFloat(val)/100*max:val;}
if(settings.limit&&/^\d+$/.test(attr[key]))
attr[key]=attr[key]<=0?0:Math.min(attr[key],max);if(!i&&settings.queue){if(old!=attr[key])
animate(settings.onAfterFirst);delete attr[key];}});animate(settings.onAfter);function animate(callback){$elem.animate(attr,duration,settings.easing,callback&&function(){callback.call(this,targ,settings);});}}).end();};$scrollTo.max=function(elem,axis){var Dim=axis=='x'?'Width':'Height',scroll='scroll'+Dim;if(!$(elem).is('html,body'))
return elem[scroll]-$(elem)[Dim.toLowerCase()]();var size='client'+Dim,html=elem.ownerDocument.documentElement,body=elem.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[size],body[size]);};function both(val){return $.isFunction(val)||$.isPlainObject(val)?val:{top:val,left:val};}
return $scrollTo;})}(typeof define==='function'&&define.amd?define:function(deps,factory){if(typeof module!=='undefined'&&module.exports){module.exports=factory(require('jquery'));}else{factory(jQuery);}}));;

/* /web/static/lib/luxon/luxon.js defined in bundle 'web.assets_backend' */
var luxon=(function(exports){'use strict';function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}
function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}
function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;subClass.__proto__=superClass;}
function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}
function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}
function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}
function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct;}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}
return _construct.apply(null,arguments);}
function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1;}
function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map():undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function");}
if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper);}
function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor);}
Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,Class);};return _wrapNativeSuper(Class);}
function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}
return target;}
function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}
function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}
function _createForOfIteratorHelperLoose(o){var i=0;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(o=_unsupportedIterableToArray(o)))return function(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}
i=o[Symbol.iterator]();return i.next.bind(i);}
var LuxonError=function(_Error){_inheritsLoose(LuxonError,_Error);function LuxonError(){return _Error.apply(this,arguments)||this;}
return LuxonError;}(_wrapNativeSuper(Error));var InvalidDateTimeError=function(_LuxonError){_inheritsLoose(InvalidDateTimeError,_LuxonError);function InvalidDateTimeError(reason){return _LuxonError.call(this,"Invalid DateTime: "+reason.toMessage())||this;}
return InvalidDateTimeError;}(LuxonError);var InvalidIntervalError=function(_LuxonError2){_inheritsLoose(InvalidIntervalError,_LuxonError2);function InvalidIntervalError(reason){return _LuxonError2.call(this,"Invalid Interval: "+reason.toMessage())||this;}
return InvalidIntervalError;}(LuxonError);var InvalidDurationError=function(_LuxonError3){_inheritsLoose(InvalidDurationError,_LuxonError3);function InvalidDurationError(reason){return _LuxonError3.call(this,"Invalid Duration: "+reason.toMessage())||this;}
return InvalidDurationError;}(LuxonError);var ConflictingSpecificationError=function(_LuxonError4){_inheritsLoose(ConflictingSpecificationError,_LuxonError4);function ConflictingSpecificationError(){return _LuxonError4.apply(this,arguments)||this;}
return ConflictingSpecificationError;}(LuxonError);var InvalidUnitError=function(_LuxonError5){_inheritsLoose(InvalidUnitError,_LuxonError5);function InvalidUnitError(unit){return _LuxonError5.call(this,"Invalid unit "+unit)||this;}
return InvalidUnitError;}(LuxonError);var InvalidArgumentError=function(_LuxonError6){_inheritsLoose(InvalidArgumentError,_LuxonError6);function InvalidArgumentError(){return _LuxonError6.apply(this,arguments)||this;}
return InvalidArgumentError;}(LuxonError);var ZoneIsAbstractError=function(_LuxonError7){_inheritsLoose(ZoneIsAbstractError,_LuxonError7);function ZoneIsAbstractError(){return _LuxonError7.call(this,"Zone is an abstract class")||this;}
return ZoneIsAbstractError;}(LuxonError);var n="numeric",s="short",l="long";var DATE_SHORT={year:n,month:n,day:n};var DATE_MED={year:n,month:s,day:n};var DATE_MED_WITH_WEEKDAY={year:n,month:s,day:n,weekday:s};var DATE_FULL={year:n,month:l,day:n};var DATE_HUGE={year:n,month:l,day:n,weekday:l};var TIME_SIMPLE={hour:n,minute:n};var TIME_WITH_SECONDS={hour:n,minute:n,second:n};var TIME_WITH_SHORT_OFFSET={hour:n,minute:n,second:n,timeZoneName:s};var TIME_WITH_LONG_OFFSET={hour:n,minute:n,second:n,timeZoneName:l};var TIME_24_SIMPLE={hour:n,minute:n,hour12:false};var TIME_24_WITH_SECONDS={hour:n,minute:n,second:n,hour12:false};var TIME_24_WITH_SHORT_OFFSET={hour:n,minute:n,second:n,hour12:false,timeZoneName:s};var TIME_24_WITH_LONG_OFFSET={hour:n,minute:n,second:n,hour12:false,timeZoneName:l};var DATETIME_SHORT={year:n,month:n,day:n,hour:n,minute:n};var DATETIME_SHORT_WITH_SECONDS={year:n,month:n,day:n,hour:n,minute:n,second:n};var DATETIME_MED={year:n,month:s,day:n,hour:n,minute:n};var DATETIME_MED_WITH_SECONDS={year:n,month:s,day:n,hour:n,minute:n,second:n};var DATETIME_MED_WITH_WEEKDAY={year:n,month:s,day:n,weekday:s,hour:n,minute:n};var DATETIME_FULL={year:n,month:l,day:n,hour:n,minute:n,timeZoneName:s};var DATETIME_FULL_WITH_SECONDS={year:n,month:l,day:n,hour:n,minute:n,second:n,timeZoneName:s};var DATETIME_HUGE={year:n,month:l,day:n,weekday:l,hour:n,minute:n,timeZoneName:l};var DATETIME_HUGE_WITH_SECONDS={year:n,month:l,day:n,weekday:l,hour:n,minute:n,second:n,timeZoneName:l};function isUndefined(o){return typeof o==="undefined";}
function isNumber(o){return typeof o==="number";}
function isInteger(o){return typeof o==="number"&&o%1===0;}
function isString(o){return typeof o==="string";}
function isDate(o){return Object.prototype.toString.call(o)==="[object Date]";}
function hasIntl(){try{return typeof Intl!=="undefined"&&Intl.DateTimeFormat;}catch(e){return false;}}
function hasFormatToParts(){return!isUndefined(Intl.DateTimeFormat.prototype.formatToParts);}
function hasRelative(){try{return typeof Intl!=="undefined"&&!!Intl.RelativeTimeFormat;}catch(e){return false;}}
function maybeArray(thing){return Array.isArray(thing)?thing:[thing];}
function bestBy(arr,by,compare){if(arr.length===0){return undefined;}
return arr.reduce(function(best,next){var pair=[by(next),next];if(!best){return pair;}else if(compare(best[0],pair[0])===best[0]){return best;}else{return pair;}},null)[1];}
function pick(obj,keys){return keys.reduce(function(a,k){a[k]=obj[k];return a;},{});}
function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop);}
function integerBetween(thing,bottom,top){return isInteger(thing)&&thing>=bottom&&thing<=top;}
function floorMod(x,n){return x-n*Math.floor(x/n);}
function padStart(input,n){if(n===void 0){n=2;}
if(input.toString().length<n){return("0".repeat(n)+input).slice(-n);}else{return input.toString();}}
function parseInteger(string){if(isUndefined(string)||string===null||string===""){return undefined;}else{return parseInt(string,10);}}
function parseMillis(fraction){if(isUndefined(fraction)||fraction===null||fraction===""){return undefined;}else{var f=parseFloat("0."+fraction)*1000;return Math.floor(f);}}
function roundTo(number,digits,towardZero){if(towardZero===void 0){towardZero=false;}
var factor=Math.pow(10,digits),rounder=towardZero?Math.trunc:Math.round;return rounder(number*factor)/factor;}
function isLeapYear(year){return year%4===0&&(year%100!==0||year%400===0);}
function daysInYear(year){return isLeapYear(year)?366:365;}
function daysInMonth(year,month){var modMonth=floorMod(month-1,12)+1,modYear=year+(month-modMonth)/12;if(modMonth===2){return isLeapYear(modYear)?29:28;}else{return[31,null,31,30,31,30,31,31,30,31,30,31][modMonth-1];}}
function objToLocalTS(obj){var d=Date.UTC(obj.year,obj.month-1,obj.day,obj.hour,obj.minute,obj.second,obj.millisecond);if(obj.year<100&&obj.year>=0){d=new Date(d);d.setUTCFullYear(d.getUTCFullYear()-1900);}
return+d;}
function weeksInWeekYear(weekYear){var p1=(weekYear+Math.floor(weekYear/4)-Math.floor(weekYear/100)+Math.floor(weekYear/400))%7,last=weekYear-1,p2=(last+Math.floor(last/4)-Math.floor(last/100)+Math.floor(last/400))%7;return p1===4||p2===3?53:52;}
function untruncateYear(year){if(year>99){return year;}else return year>60?1900+year:2000+year;}
function parseZoneInfo(ts,offsetFormat,locale,timeZone){if(timeZone===void 0){timeZone=null;}
var date=new Date(ts),intlOpts={hour12:false,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};if(timeZone){intlOpts.timeZone=timeZone;}
var modified=Object.assign({timeZoneName:offsetFormat},intlOpts),intl=hasIntl();if(intl&&hasFormatToParts()){var parsed=new Intl.DateTimeFormat(locale,modified).formatToParts(date).find(function(m){return m.type.toLowerCase()==="timezonename";});return parsed?parsed.value:null;}else if(intl){var without=new Intl.DateTimeFormat(locale,intlOpts).format(date),included=new Intl.DateTimeFormat(locale,modified).format(date),diffed=included.substring(without.length),trimmed=diffed.replace(/^[, \u200e]+/,"");return trimmed;}else{return null;}}
function signedOffset(offHourStr,offMinuteStr){var offHour=parseInt(offHourStr,10);if(Number.isNaN(offHour)){offHour=0;}
var offMin=parseInt(offMinuteStr,10)||0,offMinSigned=offHour<0||Object.is(offHour,-0)?-offMin:offMin;return offHour*60+offMinSigned;}
function asNumber(value){var numericValue=Number(value);if(typeof value==="boolean"||value===""||Number.isNaN(numericValue))throw new InvalidArgumentError("Invalid unit value "+value);return numericValue;}
function normalizeObject(obj,normalizer,nonUnitKeys){var normalized={};for(var u in obj){if(hasOwnProperty(obj,u)){if(nonUnitKeys.indexOf(u)>=0)continue;var v=obj[u];if(v===undefined||v===null)continue;normalized[normalizer(u)]=asNumber(v);}}
return normalized;}
function formatOffset(offset,format){var hours=Math.trunc(Math.abs(offset/60)),minutes=Math.trunc(Math.abs(offset%60)),sign=offset>=0?"+":"-";switch(format){case"short":return""+sign+padStart(hours,2)+":"+padStart(minutes,2);case"narrow":return""+sign+hours+(minutes>0?":"+minutes:"");case"techie":return""+sign+padStart(hours,2)+padStart(minutes,2);default:throw new RangeError("Value format "+format+" is out of range for property format");}}
function timeObject(obj){return pick(obj,["hour","minute","second","millisecond"]);}
var ianaRegex=/[A-Za-z_+-]{1,256}(:?\/[A-Za-z_+-]{1,256}(\/[A-Za-z_+-]{1,256})?)?/;function stringify(obj){return JSON.stringify(obj,Object.keys(obj).sort());}
var monthsLong=["January","February","March","April","May","June","July","August","September","October","November","December"];var monthsShort=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var monthsNarrow=["J","F","M","A","M","J","J","A","S","O","N","D"];function months(length){switch(length){case"narrow":return monthsNarrow;case"short":return monthsShort;case"long":return monthsLong;case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null;}}
var weekdaysLong=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];var weekdaysShort=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];var weekdaysNarrow=["M","T","W","T","F","S","S"];function weekdays(length){switch(length){case"narrow":return weekdaysNarrow;case"short":return weekdaysShort;case"long":return weekdaysLong;case"numeric":return["1","2","3","4","5","6","7"];default:return null;}}
var meridiems=["AM","PM"];var erasLong=["Before Christ","Anno Domini"];var erasShort=["BC","AD"];var erasNarrow=["B","A"];function eras(length){switch(length){case"narrow":return erasNarrow;case"short":return erasShort;case"long":return erasLong;default:return null;}}
function meridiemForDateTime(dt){return meridiems[dt.hour<12?0:1];}
function weekdayForDateTime(dt,length){return weekdays(length)[dt.weekday-1];}
function monthForDateTime(dt,length){return months(length)[dt.month-1];}
function eraForDateTime(dt,length){return eras(length)[dt.year<0?0:1];}
function formatRelativeTime(unit,count,numeric,narrow){if(numeric===void 0){numeric="always";}
if(narrow===void 0){narrow=false;}
var units={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]};var lastable=["hours","minutes","seconds"].indexOf(unit)===-1;if(numeric==="auto"&&lastable){var isDay=unit==="days";switch(count){case 1:return isDay?"tomorrow":"next "+units[unit][0];case-1:return isDay?"yesterday":"last "+units[unit][0];case 0:return isDay?"today":"this "+units[unit][0];}}
var isInPast=Object.is(count,-0)||count<0,fmtValue=Math.abs(count),singular=fmtValue===1,lilUnits=units[unit],fmtUnit=narrow?singular?lilUnits[1]:lilUnits[2]||lilUnits[1]:singular?units[unit][0]:unit;return isInPast?fmtValue+" "+fmtUnit+" ago":"in "+fmtValue+" "+fmtUnit;}
function formatString(knownFormat){var filtered=pick(knownFormat,["weekday","era","year","month","day","hour","minute","second","timeZoneName","hour12"]),key=stringify(filtered),dateTimeHuge="EEEE, LLLL d, yyyy, h:mm a";switch(key){case stringify(DATE_SHORT):return"M/d/yyyy";case stringify(DATE_MED):return"LLL d, yyyy";case stringify(DATE_MED_WITH_WEEKDAY):return"EEE, LLL d, yyyy";case stringify(DATE_FULL):return"LLLL d, yyyy";case stringify(DATE_HUGE):return"EEEE, LLLL d, yyyy";case stringify(TIME_SIMPLE):return"h:mm a";case stringify(TIME_WITH_SECONDS):return"h:mm:ss a";case stringify(TIME_WITH_SHORT_OFFSET):return"h:mm a";case stringify(TIME_WITH_LONG_OFFSET):return"h:mm a";case stringify(TIME_24_SIMPLE):return"HH:mm";case stringify(TIME_24_WITH_SECONDS):return"HH:mm:ss";case stringify(TIME_24_WITH_SHORT_OFFSET):return"HH:mm";case stringify(TIME_24_WITH_LONG_OFFSET):return"HH:mm";case stringify(DATETIME_SHORT):return"M/d/yyyy, h:mm a";case stringify(DATETIME_MED):return"LLL d, yyyy, h:mm a";case stringify(DATETIME_FULL):return"LLLL d, yyyy, h:mm a";case stringify(DATETIME_HUGE):return dateTimeHuge;case stringify(DATETIME_SHORT_WITH_SECONDS):return"M/d/yyyy, h:mm:ss a";case stringify(DATETIME_MED_WITH_SECONDS):return"LLL d, yyyy, h:mm:ss a";case stringify(DATETIME_MED_WITH_WEEKDAY):return"EEE, d LLL yyyy, h:mm a";case stringify(DATETIME_FULL_WITH_SECONDS):return"LLLL d, yyyy, h:mm:ss a";case stringify(DATETIME_HUGE_WITH_SECONDS):return"EEEE, LLLL d, yyyy, h:mm:ss a";default:return dateTimeHuge;}}
function stringifyTokens(splits,tokenToString){var s="";for(var _iterator=_createForOfIteratorHelperLoose(splits),_step;!(_step=_iterator()).done;){var token=_step.value;if(token.literal){s+=token.val;}else{s+=tokenToString(token.val);}}
return s;}
var _macroTokenToFormatOpts={D:DATE_SHORT,DD:DATE_MED,DDD:DATE_FULL,DDDD:DATE_HUGE,t:TIME_SIMPLE,tt:TIME_WITH_SECONDS,ttt:TIME_WITH_SHORT_OFFSET,tttt:TIME_WITH_LONG_OFFSET,T:TIME_24_SIMPLE,TT:TIME_24_WITH_SECONDS,TTT:TIME_24_WITH_SHORT_OFFSET,TTTT:TIME_24_WITH_LONG_OFFSET,f:DATETIME_SHORT,ff:DATETIME_MED,fff:DATETIME_FULL,ffff:DATETIME_HUGE,F:DATETIME_SHORT_WITH_SECONDS,FF:DATETIME_MED_WITH_SECONDS,FFF:DATETIME_FULL_WITH_SECONDS,FFFF:DATETIME_HUGE_WITH_SECONDS};var Formatter=function(){Formatter.create=function create(locale,opts){if(opts===void 0){opts={};}
return new Formatter(locale,opts);};Formatter.parseFormat=function parseFormat(fmt){var current=null,currentFull="",bracketed=false;var splits=[];for(var i=0;i<fmt.length;i++){var c=fmt.charAt(i);if(c==="'"){if(currentFull.length>0){splits.push({literal:bracketed,val:currentFull});}
current=null;currentFull="";bracketed=!bracketed;}else if(bracketed){currentFull+=c;}else if(c===current){currentFull+=c;}else{if(currentFull.length>0){splits.push({literal:false,val:currentFull});}
currentFull=c;current=c;}}
if(currentFull.length>0){splits.push({literal:bracketed,val:currentFull});}
return splits;};Formatter.macroTokenToFormatOpts=function macroTokenToFormatOpts(token){return _macroTokenToFormatOpts[token];};function Formatter(locale,formatOpts){this.opts=formatOpts;this.loc=locale;this.systemLoc=null;}
var _proto=Formatter.prototype;_proto.formatWithSystemDefault=function formatWithSystemDefault(dt,opts){if(this.systemLoc===null){this.systemLoc=this.loc.redefaultToSystem();}
var df=this.systemLoc.dtFormatter(dt,Object.assign({},this.opts,opts));return df.format();};_proto.formatDateTime=function formatDateTime(dt,opts){if(opts===void 0){opts={};}
var df=this.loc.dtFormatter(dt,Object.assign({},this.opts,opts));return df.format();};_proto.formatDateTimeParts=function formatDateTimeParts(dt,opts){if(opts===void 0){opts={};}
var df=this.loc.dtFormatter(dt,Object.assign({},this.opts,opts));return df.formatToParts();};_proto.resolvedOptions=function resolvedOptions(dt,opts){if(opts===void 0){opts={};}
var df=this.loc.dtFormatter(dt,Object.assign({},this.opts,opts));return df.resolvedOptions();};_proto.num=function num(n,p){if(p===void 0){p=0;}
if(this.opts.forceSimple){return padStart(n,p);}
var opts=Object.assign({},this.opts);if(p>0){opts.padTo=p;}
return this.loc.numberFormatter(opts).format(n);};_proto.formatDateTimeFromString=function formatDateTimeFromString(dt,fmt){var _this=this;var knownEnglish=this.loc.listingMode()==="en",useDateTimeFormatter=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory"&&hasFormatToParts(),string=function string(opts,extract){return _this.loc.extract(dt,opts,extract);},formatOffset=function formatOffset(opts){if(dt.isOffsetFixed&&dt.offset===0&&opts.allowZ){return"Z";}
return dt.isValid?dt.zone.formatOffset(dt.ts,opts.format):"";},meridiem=function meridiem(){return knownEnglish?meridiemForDateTime(dt):string({hour:"numeric",hour12:true},"dayperiod");},month=function month(length,standalone){return knownEnglish?monthForDateTime(dt,length):string(standalone?{month:length}:{month:length,day:"numeric"},"month");},weekday=function weekday(length,standalone){return knownEnglish?weekdayForDateTime(dt,length):string(standalone?{weekday:length}:{weekday:length,month:"long",day:"numeric"},"weekday");},maybeMacro=function maybeMacro(token){var formatOpts=Formatter.macroTokenToFormatOpts(token);if(formatOpts){return _this.formatWithSystemDefault(dt,formatOpts);}else{return token;}},era=function era(length){return knownEnglish?eraForDateTime(dt,length):string({era:length},"era");},tokenToString=function tokenToString(token){switch(token){case"S":return _this.num(dt.millisecond);case"u":case"SSS":return _this.num(dt.millisecond,3);case"s":return _this.num(dt.second);case"ss":return _this.num(dt.second,2);case"m":return _this.num(dt.minute);case"mm":return _this.num(dt.minute,2);case"h":return _this.num(dt.hour%12===0?12:dt.hour%12);case"hh":return _this.num(dt.hour%12===0?12:dt.hour%12,2);case"H":return _this.num(dt.hour);case"HH":return _this.num(dt.hour,2);case"Z":return formatOffset({format:"narrow",allowZ:_this.opts.allowZ});case"ZZ":return formatOffset({format:"short",allowZ:_this.opts.allowZ});case"ZZZ":return formatOffset({format:"techie",allowZ:_this.opts.allowZ});case"ZZZZ":return dt.zone.offsetName(dt.ts,{format:"short",locale:_this.loc.locale});case"ZZZZZ":return dt.zone.offsetName(dt.ts,{format:"long",locale:_this.loc.locale});case"z":return dt.zoneName;case"a":return meridiem();case"d":return useDateTimeFormatter?string({day:"numeric"},"day"):_this.num(dt.day);case"dd":return useDateTimeFormatter?string({day:"2-digit"},"day"):_this.num(dt.day,2);case"c":return _this.num(dt.weekday);case"ccc":return weekday("short",true);case"cccc":return weekday("long",true);case"ccccc":return weekday("narrow",true);case"E":return _this.num(dt.weekday);case"EEE":return weekday("short",false);case"EEEE":return weekday("long",false);case"EEEEE":return weekday("narrow",false);case"L":return useDateTimeFormatter?string({month:"numeric",day:"numeric"},"month"):_this.num(dt.month);case"LL":return useDateTimeFormatter?string({month:"2-digit",day:"numeric"},"month"):_this.num(dt.month,2);case"LLL":return month("short",true);case"LLLL":return month("long",true);case"LLLLL":return month("narrow",true);case"M":return useDateTimeFormatter?string({month:"numeric"},"month"):_this.num(dt.month);case"MM":return useDateTimeFormatter?string({month:"2-digit"},"month"):_this.num(dt.month,2);case"MMM":return month("short",false);case"MMMM":return month("long",false);case"MMMMM":return month("narrow",false);case"y":return useDateTimeFormatter?string({year:"numeric"},"year"):_this.num(dt.year);case"yy":return useDateTimeFormatter?string({year:"2-digit"},"year"):_this.num(dt.year.toString().slice(-2),2);case"yyyy":return useDateTimeFormatter?string({year:"numeric"},"year"):_this.num(dt.year,4);case"yyyyyy":return useDateTimeFormatter?string({year:"numeric"},"year"):_this.num(dt.year,6);case"G":return era("short");case"GG":return era("long");case"GGGGG":return era("narrow");case"kk":return _this.num(dt.weekYear.toString().slice(-2),2);case"kkkk":return _this.num(dt.weekYear,4);case"W":return _this.num(dt.weekNumber);case"WW":return _this.num(dt.weekNumber,2);case"o":return _this.num(dt.ordinal);case"ooo":return _this.num(dt.ordinal,3);case"q":return _this.num(dt.quarter);case"qq":return _this.num(dt.quarter,2);case"X":return _this.num(Math.floor(dt.ts/1000));case"x":return _this.num(dt.ts);default:return maybeMacro(token);}};return stringifyTokens(Formatter.parseFormat(fmt),tokenToString);};_proto.formatDurationFromString=function formatDurationFromString(dur,fmt){var _this2=this;var tokenToField=function tokenToField(token){switch(token[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"M":return"month";case"y":return"year";default:return null;}},tokenToString=function tokenToString(lildur){return function(token){var mapped=tokenToField(token);if(mapped){return _this2.num(lildur.get(mapped),token.length);}else{return token;}};},tokens=Formatter.parseFormat(fmt),realTokens=tokens.reduce(function(found,_ref){var literal=_ref.literal,val=_ref.val;return literal?found:found.concat(val);},[]),collapsed=dur.shiftTo.apply(dur,realTokens.map(tokenToField).filter(function(t){return t;}));return stringifyTokens(tokens,tokenToString(collapsed));};return Formatter;}();var Invalid=function(){function Invalid(reason,explanation){this.reason=reason;this.explanation=explanation;}
var _proto=Invalid.prototype;_proto.toMessage=function toMessage(){if(this.explanation){return this.reason+": "+this.explanation;}else{return this.reason;}};return Invalid;}();var Zone=function(){function Zone(){}
var _proto=Zone.prototype;_proto.offsetName=function offsetName(ts,opts){throw new ZoneIsAbstractError();};_proto.formatOffset=function formatOffset(ts,format){throw new ZoneIsAbstractError();};_proto.offset=function offset(ts){throw new ZoneIsAbstractError();};_proto.equals=function equals(otherZone){throw new ZoneIsAbstractError();};_createClass(Zone,[{key:"type",get:function get(){throw new ZoneIsAbstractError();}},{key:"name",get:function get(){throw new ZoneIsAbstractError();}},{key:"universal",get:function get(){throw new ZoneIsAbstractError();}},{key:"isValid",get:function get(){throw new ZoneIsAbstractError();}}]);return Zone;}();var singleton=null;var LocalZone=function(_Zone){_inheritsLoose(LocalZone,_Zone);function LocalZone(){return _Zone.apply(this,arguments)||this;}
var _proto=LocalZone.prototype;_proto.offsetName=function offsetName(ts,_ref){var format=_ref.format,locale=_ref.locale;return parseZoneInfo(ts,format,locale);};_proto.formatOffset=function formatOffset$1(ts,format){return formatOffset(this.offset(ts),format);};_proto.offset=function offset(ts){return-new Date(ts).getTimezoneOffset();};_proto.equals=function equals(otherZone){return otherZone.type==="local";};_createClass(LocalZone,[{key:"type",get:function get(){return"local";}},{key:"name",get:function get(){if(hasIntl()){return new Intl.DateTimeFormat().resolvedOptions().timeZone;}else return"local";}},{key:"universal",get:function get(){return false;}},{key:"isValid",get:function get(){return true;}}],[{key:"instance",get:function get(){if(singleton===null){singleton=new LocalZone();}
return singleton;}}]);return LocalZone;}(Zone);var matchingRegex=RegExp("^"+ianaRegex.source+"$");var dtfCache={};function makeDTF(zone){if(!dtfCache[zone]){dtfCache[zone]=new Intl.DateTimeFormat("en-US",{hour12:false,timeZone:zone,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});}
return dtfCache[zone];}
var typeToPos={year:0,month:1,day:2,hour:3,minute:4,second:5};function hackyOffset(dtf,date){var formatted=dtf.format(date).replace(/\u200E/g,""),parsed=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(formatted),fMonth=parsed[1],fDay=parsed[2],fYear=parsed[3],fHour=parsed[4],fMinute=parsed[5],fSecond=parsed[6];return[fYear,fMonth,fDay,fHour,fMinute,fSecond];}
function partsOffset(dtf,date){var formatted=dtf.formatToParts(date),filled=[];for(var i=0;i<formatted.length;i++){var _formatted$i=formatted[i],type=_formatted$i.type,value=_formatted$i.value,pos=typeToPos[type];if(!isUndefined(pos)){filled[pos]=parseInt(value,10);}}
return filled;}
var ianaZoneCache={};var IANAZone=function(_Zone){_inheritsLoose(IANAZone,_Zone);IANAZone.create=function create(name){if(!ianaZoneCache[name]){ianaZoneCache[name]=new IANAZone(name);}
return ianaZoneCache[name];};IANAZone.resetCache=function resetCache(){ianaZoneCache={};dtfCache={};};IANAZone.isValidSpecifier=function isValidSpecifier(s){return!!(s&&s.match(matchingRegex));};IANAZone.isValidZone=function isValidZone(zone){try{new Intl.DateTimeFormat("en-US",{timeZone:zone}).format();return true;}catch(e){return false;}};IANAZone.parseGMTOffset=function parseGMTOffset(specifier){if(specifier){var match=specifier.match(/^Etc\/GMT([+-]\d{1,2})$/i);if(match){return-60*parseInt(match[1]);}}
return null;};function IANAZone(name){var _this;_this=_Zone.call(this)||this;_this.zoneName=name;_this.valid=IANAZone.isValidZone(name);return _this;}
var _proto=IANAZone.prototype;_proto.offsetName=function offsetName(ts,_ref){var format=_ref.format,locale=_ref.locale;return parseZoneInfo(ts,format,locale,this.name);};_proto.formatOffset=function formatOffset$1(ts,format){return formatOffset(this.offset(ts),format);};_proto.offset=function offset(ts){var date=new Date(ts),dtf=makeDTF(this.name),_ref2=dtf.formatToParts?partsOffset(dtf,date):hackyOffset(dtf,date),year=_ref2[0],month=_ref2[1],day=_ref2[2],hour=_ref2[3],minute=_ref2[4],second=_ref2[5],adjustedHour=hour===24?0:hour;var asUTC=objToLocalTS({year:year,month:month,day:day,hour:adjustedHour,minute:minute,second:second,millisecond:0});var asTS=+date;var over=asTS%1000;asTS-=over>=0?over:1000+over;return(asUTC-asTS)/(60*1000);};_proto.equals=function equals(otherZone){return otherZone.type==="iana"&&otherZone.name===this.name;};_createClass(IANAZone,[{key:"type",get:function get(){return"iana";}},{key:"name",get:function get(){return this.zoneName;}},{key:"universal",get:function get(){return false;}},{key:"isValid",get:function get(){return this.valid;}}]);return IANAZone;}(Zone);var singleton$1=null;var FixedOffsetZone=function(_Zone){_inheritsLoose(FixedOffsetZone,_Zone);FixedOffsetZone.instance=function instance(offset){return offset===0?FixedOffsetZone.utcInstance:new FixedOffsetZone(offset);};FixedOffsetZone.parseSpecifier=function parseSpecifier(s){if(s){var r=s.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r){return new FixedOffsetZone(signedOffset(r[1],r[2]));}}
return null;};_createClass(FixedOffsetZone,null,[{key:"utcInstance",get:function get(){if(singleton$1===null){singleton$1=new FixedOffsetZone(0);}
return singleton$1;}}]);function FixedOffsetZone(offset){var _this;_this=_Zone.call(this)||this;_this.fixed=offset;return _this;}
var _proto=FixedOffsetZone.prototype;_proto.offsetName=function offsetName(){return this.name;};_proto.formatOffset=function formatOffset$1(ts,format){return formatOffset(this.fixed,format);};_proto.offset=function offset(){return this.fixed;};_proto.equals=function equals(otherZone){return otherZone.type==="fixed"&&otherZone.fixed===this.fixed;};_createClass(FixedOffsetZone,[{key:"type",get:function get(){return"fixed";}},{key:"name",get:function get(){return this.fixed===0?"UTC":"UTC"+formatOffset(this.fixed,"narrow");}},{key:"universal",get:function get(){return true;}},{key:"isValid",get:function get(){return true;}}]);return FixedOffsetZone;}(Zone);var InvalidZone=function(_Zone){_inheritsLoose(InvalidZone,_Zone);function InvalidZone(zoneName){var _this;_this=_Zone.call(this)||this;_this.zoneName=zoneName;return _this;}
var _proto=InvalidZone.prototype;_proto.offsetName=function offsetName(){return null;};_proto.formatOffset=function formatOffset(){return"";};_proto.offset=function offset(){return NaN;};_proto.equals=function equals(){return false;};_createClass(InvalidZone,[{key:"type",get:function get(){return"invalid";}},{key:"name",get:function get(){return this.zoneName;}},{key:"universal",get:function get(){return false;}},{key:"isValid",get:function get(){return false;}}]);return InvalidZone;}(Zone);function normalizeZone(input,defaultZone){var offset;if(isUndefined(input)||input===null){return defaultZone;}else if(input instanceof Zone){return input;}else if(isString(input)){var lowered=input.toLowerCase();if(lowered==="local")return defaultZone;else if(lowered==="utc"||lowered==="gmt")return FixedOffsetZone.utcInstance;else if((offset=IANAZone.parseGMTOffset(input))!=null){return FixedOffsetZone.instance(offset);}else if(IANAZone.isValidSpecifier(lowered))return IANAZone.create(input);else return FixedOffsetZone.parseSpecifier(lowered)||new InvalidZone(input);}else if(isNumber(input)){return FixedOffsetZone.instance(input);}else if(typeof input==="object"&&input.offset&&typeof input.offset==="number"){return input;}else{return new InvalidZone(input);}}
var now=function now(){return Date.now();},defaultZone=null,defaultLocale=null,defaultNumberingSystem=null,defaultOutputCalendar=null,throwOnInvalid=false;var Settings=function(){function Settings(){}
Settings.resetCaches=function resetCaches(){Locale.resetCache();IANAZone.resetCache();};_createClass(Settings,null,[{key:"now",get:function get(){return now;},set:function set(n){now=n;}},{key:"defaultZoneName",get:function get(){return Settings.defaultZone.name;},set:function set(z){if(!z){defaultZone=null;}else{defaultZone=normalizeZone(z);}}},{key:"defaultZone",get:function get(){return defaultZone||LocalZone.instance;}},{key:"defaultLocale",get:function get(){return defaultLocale;},set:function set(locale){defaultLocale=locale;}},{key:"defaultNumberingSystem",get:function get(){return defaultNumberingSystem;},set:function set(numberingSystem){defaultNumberingSystem=numberingSystem;}},{key:"defaultOutputCalendar",get:function get(){return defaultOutputCalendar;},set:function set(outputCalendar){defaultOutputCalendar=outputCalendar;}},{key:"throwOnInvalid",get:function get(){return throwOnInvalid;},set:function set(t){throwOnInvalid=t;}}]);return Settings;}();var intlDTCache={};function getCachedDTF(locString,opts){if(opts===void 0){opts={};}
var key=JSON.stringify([locString,opts]);var dtf=intlDTCache[key];if(!dtf){dtf=new Intl.DateTimeFormat(locString,opts);intlDTCache[key]=dtf;}
return dtf;}
var intlNumCache={};function getCachedINF(locString,opts){if(opts===void 0){opts={};}
var key=JSON.stringify([locString,opts]);var inf=intlNumCache[key];if(!inf){inf=new Intl.NumberFormat(locString,opts);intlNumCache[key]=inf;}
return inf;}
var intlRelCache={};function getCachedRTF(locString,opts){if(opts===void 0){opts={};}
var _opts=opts,base=_opts.base,cacheKeyOpts=_objectWithoutPropertiesLoose(_opts,["base"]);var key=JSON.stringify([locString,cacheKeyOpts]);var inf=intlRelCache[key];if(!inf){inf=new Intl.RelativeTimeFormat(locString,opts);intlRelCache[key]=inf;}
return inf;}
var sysLocaleCache=null;function systemLocale(){if(sysLocaleCache){return sysLocaleCache;}else if(hasIntl()){var computedSys=new Intl.DateTimeFormat().resolvedOptions().locale;sysLocaleCache=!computedSys||computedSys==="und"?"en-US":computedSys;return sysLocaleCache;}else{sysLocaleCache="en-US";return sysLocaleCache;}}
function parseLocaleString(localeStr){var uIndex=localeStr.indexOf("-u-");if(uIndex===-1){return[localeStr];}else{var options;var smaller=localeStr.substring(0,uIndex);try{options=getCachedDTF(localeStr).resolvedOptions();}catch(e){options=getCachedDTF(smaller).resolvedOptions();}
var _options=options,numberingSystem=_options.numberingSystem,calendar=_options.calendar;return[smaller,numberingSystem,calendar];}}
function intlConfigString(localeStr,numberingSystem,outputCalendar){if(hasIntl()){if(outputCalendar||numberingSystem){localeStr+="-u";if(outputCalendar){localeStr+="-ca-"+outputCalendar;}
if(numberingSystem){localeStr+="-nu-"+numberingSystem;}
return localeStr;}else{return localeStr;}}else{return[];}}
function mapMonths(f){var ms=[];for(var i=1;i<=12;i++){var dt=DateTime.utc(2016,i,1);ms.push(f(dt));}
return ms;}
function mapWeekdays(f){var ms=[];for(var i=1;i<=7;i++){var dt=DateTime.utc(2016,11,13+i);ms.push(f(dt));}
return ms;}
function listStuff(loc,length,defaultOK,englishFn,intlFn){var mode=loc.listingMode(defaultOK);if(mode==="error"){return null;}else if(mode==="en"){return englishFn(length);}else{return intlFn(length);}}
function supportsFastNumbers(loc){if(loc.numberingSystem&&loc.numberingSystem!=="latn"){return false;}else{return loc.numberingSystem==="latn"||!loc.locale||loc.locale.startsWith("en")||hasIntl()&&new Intl.DateTimeFormat(loc.intl).resolvedOptions().numberingSystem==="latn";}}
var PolyNumberFormatter=function(){function PolyNumberFormatter(intl,forceSimple,opts){this.padTo=opts.padTo||0;this.floor=opts.floor||false;if(!forceSimple&&hasIntl()){var intlOpts={useGrouping:false};if(opts.padTo>0)intlOpts.minimumIntegerDigits=opts.padTo;this.inf=getCachedINF(intl,intlOpts);}}
var _proto=PolyNumberFormatter.prototype;_proto.format=function format(i){if(this.inf){var fixed=this.floor?Math.floor(i):i;return this.inf.format(fixed);}else{var _fixed=this.floor?Math.floor(i):roundTo(i,3);return padStart(_fixed,this.padTo);}};return PolyNumberFormatter;}();var PolyDateFormatter=function(){function PolyDateFormatter(dt,intl,opts){this.opts=opts;this.hasIntl=hasIntl();var z;if(dt.zone.universal&&this.hasIntl){z="UTC";if(opts.timeZoneName){this.dt=dt;}else{this.dt=dt.offset===0?dt:DateTime.fromMillis(dt.ts+dt.offset*60*1000);}}else if(dt.zone.type==="local"){this.dt=dt;}else{this.dt=dt;z=dt.zone.name;}
if(this.hasIntl){var intlOpts=Object.assign({},this.opts);if(z){intlOpts.timeZone=z;}
this.dtf=getCachedDTF(intl,intlOpts);}}
var _proto2=PolyDateFormatter.prototype;_proto2.format=function format(){if(this.hasIntl){return this.dtf.format(this.dt.toJSDate());}else{var tokenFormat=formatString(this.opts),loc=Locale.create("en-US");return Formatter.create(loc).formatDateTimeFromString(this.dt,tokenFormat);}};_proto2.formatToParts=function formatToParts(){if(this.hasIntl&&hasFormatToParts()){return this.dtf.formatToParts(this.dt.toJSDate());}else{return[];}};_proto2.resolvedOptions=function resolvedOptions(){if(this.hasIntl){return this.dtf.resolvedOptions();}else{return{locale:"en-US",numberingSystem:"latn",outputCalendar:"gregory"};}};return PolyDateFormatter;}();var PolyRelFormatter=function(){function PolyRelFormatter(intl,isEnglish,opts){this.opts=Object.assign({style:"long"},opts);if(!isEnglish&&hasRelative()){this.rtf=getCachedRTF(intl,opts);}}
var _proto3=PolyRelFormatter.prototype;_proto3.format=function format(count,unit){if(this.rtf){return this.rtf.format(count,unit);}else{return formatRelativeTime(unit,count,this.opts.numeric,this.opts.style!=="long");}};_proto3.formatToParts=function formatToParts(count,unit){if(this.rtf){return this.rtf.formatToParts(count,unit);}else{return[];}};return PolyRelFormatter;}();var Locale=function(){Locale.fromOpts=function fromOpts(opts){return Locale.create(opts.locale,opts.numberingSystem,opts.outputCalendar,opts.defaultToEN);};Locale.create=function create(locale,numberingSystem,outputCalendar,defaultToEN){if(defaultToEN===void 0){defaultToEN=false;}
var specifiedLocale=locale||Settings.defaultLocale,localeR=specifiedLocale||(defaultToEN?"en-US":systemLocale()),numberingSystemR=numberingSystem||Settings.defaultNumberingSystem,outputCalendarR=outputCalendar||Settings.defaultOutputCalendar;return new Locale(localeR,numberingSystemR,outputCalendarR,specifiedLocale);};Locale.resetCache=function resetCache(){sysLocaleCache=null;intlDTCache={};intlNumCache={};intlRelCache={};};Locale.fromObject=function fromObject(_temp){var _ref=_temp===void 0?{}:_temp,locale=_ref.locale,numberingSystem=_ref.numberingSystem,outputCalendar=_ref.outputCalendar;return Locale.create(locale,numberingSystem,outputCalendar);};function Locale(locale,numbering,outputCalendar,specifiedLocale){var _parseLocaleString=parseLocaleString(locale),parsedLocale=_parseLocaleString[0],parsedNumberingSystem=_parseLocaleString[1],parsedOutputCalendar=_parseLocaleString[2];this.locale=parsedLocale;this.numberingSystem=numbering||parsedNumberingSystem||null;this.outputCalendar=outputCalendar||parsedOutputCalendar||null;this.intl=intlConfigString(this.locale,this.numberingSystem,this.outputCalendar);this.weekdaysCache={format:{},standalone:{}};this.monthsCache={format:{},standalone:{}};this.meridiemCache=null;this.eraCache={};this.specifiedLocale=specifiedLocale;this.fastNumbersCached=null;}
var _proto4=Locale.prototype;_proto4.listingMode=function listingMode(defaultOK){if(defaultOK===void 0){defaultOK=true;}
var intl=hasIntl(),hasFTP=intl&&hasFormatToParts(),isActuallyEn=this.isEnglish(),hasNoWeirdness=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");if(!hasFTP&&!(isActuallyEn&&hasNoWeirdness)&&!defaultOK){return"error";}else if(!hasFTP||isActuallyEn&&hasNoWeirdness){return"en";}else{return"intl";}};_proto4.clone=function clone(alts){if(!alts||Object.getOwnPropertyNames(alts).length===0){return this;}else{return Locale.create(alts.locale||this.specifiedLocale,alts.numberingSystem||this.numberingSystem,alts.outputCalendar||this.outputCalendar,alts.defaultToEN||false);}};_proto4.redefaultToEN=function redefaultToEN(alts){if(alts===void 0){alts={};}
return this.clone(Object.assign({},alts,{defaultToEN:true}));};_proto4.redefaultToSystem=function redefaultToSystem(alts){if(alts===void 0){alts={};}
return this.clone(Object.assign({},alts,{defaultToEN:false}));};_proto4.months=function months$1(length,format,defaultOK){var _this=this;if(format===void 0){format=false;}
if(defaultOK===void 0){defaultOK=true;}
return listStuff(this,length,defaultOK,months,function(){var intl=format?{month:length,day:"numeric"}:{month:length},formatStr=format?"format":"standalone";if(!_this.monthsCache[formatStr][length]){_this.monthsCache[formatStr][length]=mapMonths(function(dt){return _this.extract(dt,intl,"month");});}
return _this.monthsCache[formatStr][length];});};_proto4.weekdays=function weekdays$1(length,format,defaultOK){var _this2=this;if(format===void 0){format=false;}
if(defaultOK===void 0){defaultOK=true;}
return listStuff(this,length,defaultOK,weekdays,function(){var intl=format?{weekday:length,year:"numeric",month:"long",day:"numeric"}:{weekday:length},formatStr=format?"format":"standalone";if(!_this2.weekdaysCache[formatStr][length]){_this2.weekdaysCache[formatStr][length]=mapWeekdays(function(dt){return _this2.extract(dt,intl,"weekday");});}
return _this2.weekdaysCache[formatStr][length];});};_proto4.meridiems=function meridiems$1(defaultOK){var _this3=this;if(defaultOK===void 0){defaultOK=true;}
return listStuff(this,undefined,defaultOK,function(){return meridiems;},function(){if(!_this3.meridiemCache){var intl={hour:"numeric",hour12:true};_this3.meridiemCache=[DateTime.utc(2016,11,13,9),DateTime.utc(2016,11,13,19)].map(function(dt){return _this3.extract(dt,intl,"dayperiod");});}
return _this3.meridiemCache;});};_proto4.eras=function eras$1(length,defaultOK){var _this4=this;if(defaultOK===void 0){defaultOK=true;}
return listStuff(this,length,defaultOK,eras,function(){var intl={era:length};if(!_this4.eraCache[length]){_this4.eraCache[length]=[DateTime.utc(-40,1,1),DateTime.utc(2017,1,1)].map(function(dt){return _this4.extract(dt,intl,"era");});}
return _this4.eraCache[length];});};_proto4.extract=function extract(dt,intlOpts,field){var df=this.dtFormatter(dt,intlOpts),results=df.formatToParts(),matching=results.find(function(m){return m.type.toLowerCase()===field;});return matching?matching.value:null;};_proto4.numberFormatter=function numberFormatter(opts){if(opts===void 0){opts={};}
return new PolyNumberFormatter(this.intl,opts.forceSimple||this.fastNumbers,opts);};_proto4.dtFormatter=function dtFormatter(dt,intlOpts){if(intlOpts===void 0){intlOpts={};}
return new PolyDateFormatter(dt,this.intl,intlOpts);};_proto4.relFormatter=function relFormatter(opts){if(opts===void 0){opts={};}
return new PolyRelFormatter(this.intl,this.isEnglish(),opts);};_proto4.isEnglish=function isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||hasIntl()&&new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us");};_proto4.equals=function equals(other){return this.locale===other.locale&&this.numberingSystem===other.numberingSystem&&this.outputCalendar===other.outputCalendar;};_createClass(Locale,[{key:"fastNumbers",get:function get(){if(this.fastNumbersCached==null){this.fastNumbersCached=supportsFastNumbers(this);}
return this.fastNumbersCached;}}]);return Locale;}();function combineRegexes(){for(var _len=arguments.length,regexes=new Array(_len),_key=0;_key<_len;_key++){regexes[_key]=arguments[_key];}
var full=regexes.reduce(function(f,r){return f+r.source;},"");return RegExp("^"+full+"$");}
function combineExtractors(){for(var _len2=arguments.length,extractors=new Array(_len2),_key2=0;_key2<_len2;_key2++){extractors[_key2]=arguments[_key2];}
return function(m){return extractors.reduce(function(_ref,ex){var mergedVals=_ref[0],mergedZone=_ref[1],cursor=_ref[2];var _ex=ex(m,cursor),val=_ex[0],zone=_ex[1],next=_ex[2];return[Object.assign(mergedVals,val),mergedZone||zone,next];},[{},null,1]).slice(0,2);};}
function parse(s){if(s==null){return[null,null];}
for(var _len3=arguments.length,patterns=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){patterns[_key3-1]=arguments[_key3];}
for(var _i=0,_patterns=patterns;_i<_patterns.length;_i++){var _patterns$_i=_patterns[_i],regex=_patterns$_i[0],extractor=_patterns$_i[1];var m=regex.exec(s);if(m){return extractor(m);}}
return[null,null];}
function simpleParse(){for(var _len4=arguments.length,keys=new Array(_len4),_key4=0;_key4<_len4;_key4++){keys[_key4]=arguments[_key4];}
return function(match,cursor){var ret={};var i;for(i=0;i<keys.length;i++){ret[keys[i]]=parseInteger(match[cursor+i]);}
return[ret,null,cursor+i];};}
var offsetRegex=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,isoTimeBaseRegex=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,isoTimeRegex=RegExp(""+isoTimeBaseRegex.source+offsetRegex.source+"?"),isoTimeExtensionRegex=RegExp("(?:T"+isoTimeRegex.source+")?"),isoYmdRegex=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,isoWeekRegex=/(\d{4})-?W(\d\d)(?:-?(\d))?/,isoOrdinalRegex=/(\d{4})-?(\d{3})/,extractISOWeekData=simpleParse("weekYear","weekNumber","weekDay"),extractISOOrdinalData=simpleParse("year","ordinal"),sqlYmdRegex=/(\d{4})-(\d\d)-(\d\d)/,sqlTimeRegex=RegExp(isoTimeBaseRegex.source+" ?(?:"+offsetRegex.source+"|("+ianaRegex.source+"))?"),sqlTimeExtensionRegex=RegExp("(?: "+sqlTimeRegex.source+")?");function int(match,pos,fallback){var m=match[pos];return isUndefined(m)?fallback:parseInteger(m);}
function extractISOYmd(match,cursor){var item={year:int(match,cursor),month:int(match,cursor+1,1),day:int(match,cursor+2,1)};return[item,null,cursor+3];}
function extractISOTime(match,cursor){var item={hour:int(match,cursor,0),minute:int(match,cursor+1,0),second:int(match,cursor+2,0),millisecond:parseMillis(match[cursor+3])};return[item,null,cursor+4];}
function extractISOOffset(match,cursor){var local=!match[cursor]&&!match[cursor+1],fullOffset=signedOffset(match[cursor+1],match[cursor+2]),zone=local?null:FixedOffsetZone.instance(fullOffset);return[{},zone,cursor+3];}
function extractIANAZone(match,cursor){var zone=match[cursor]?IANAZone.create(match[cursor]):null;return[{},zone,cursor+1];}
var isoDuration=/^-?P(?:(?:(-?\d{1,9})Y)?(?:(-?\d{1,9})M)?(?:(-?\d{1,9})W)?(?:(-?\d{1,9})D)?(?:T(?:(-?\d{1,9})H)?(?:(-?\d{1,9})M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function extractISODuration(match){var s=match[0],yearStr=match[1],monthStr=match[2],weekStr=match[3],dayStr=match[4],hourStr=match[5],minuteStr=match[6],secondStr=match[7],millisecondsStr=match[8];var hasNegativePrefix=s[0]==="-";var maybeNegate=function maybeNegate(num){return num&&hasNegativePrefix?-num:num;};return[{years:maybeNegate(parseInteger(yearStr)),months:maybeNegate(parseInteger(monthStr)),weeks:maybeNegate(parseInteger(weekStr)),days:maybeNegate(parseInteger(dayStr)),hours:maybeNegate(parseInteger(hourStr)),minutes:maybeNegate(parseInteger(minuteStr)),seconds:maybeNegate(parseInteger(secondStr)),milliseconds:maybeNegate(parseMillis(millisecondsStr))}];}
var obsOffsets={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function fromStrings(weekdayStr,yearStr,monthStr,dayStr,hourStr,minuteStr,secondStr){var result={year:yearStr.length===2?untruncateYear(parseInteger(yearStr)):parseInteger(yearStr),month:monthsShort.indexOf(monthStr)+1,day:parseInteger(dayStr),hour:parseInteger(hourStr),minute:parseInteger(minuteStr)};if(secondStr)result.second=parseInteger(secondStr);if(weekdayStr){result.weekday=weekdayStr.length>3?weekdaysLong.indexOf(weekdayStr)+1:weekdaysShort.indexOf(weekdayStr)+1;}
return result;}
var rfc2822=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function extractRFC2822(match){var weekdayStr=match[1],dayStr=match[2],monthStr=match[3],yearStr=match[4],hourStr=match[5],minuteStr=match[6],secondStr=match[7],obsOffset=match[8],milOffset=match[9],offHourStr=match[10],offMinuteStr=match[11],result=fromStrings(weekdayStr,yearStr,monthStr,dayStr,hourStr,minuteStr,secondStr);var offset;if(obsOffset){offset=obsOffsets[obsOffset];}else if(milOffset){offset=0;}else{offset=signedOffset(offHourStr,offMinuteStr);}
return[result,new FixedOffsetZone(offset)];}
function preprocessRFC2822(s){return s.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim();}
var rfc1123=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,rfc850=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,ascii=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function extractRFC1123Or850(match){var weekdayStr=match[1],dayStr=match[2],monthStr=match[3],yearStr=match[4],hourStr=match[5],minuteStr=match[6],secondStr=match[7],result=fromStrings(weekdayStr,yearStr,monthStr,dayStr,hourStr,minuteStr,secondStr);return[result,FixedOffsetZone.utcInstance];}
function extractASCII(match){var weekdayStr=match[1],monthStr=match[2],dayStr=match[3],hourStr=match[4],minuteStr=match[5],secondStr=match[6],yearStr=match[7],result=fromStrings(weekdayStr,yearStr,monthStr,dayStr,hourStr,minuteStr,secondStr);return[result,FixedOffsetZone.utcInstance];}
var isoYmdWithTimeExtensionRegex=combineRegexes(isoYmdRegex,isoTimeExtensionRegex);var isoWeekWithTimeExtensionRegex=combineRegexes(isoWeekRegex,isoTimeExtensionRegex);var isoOrdinalWithTimeExtensionRegex=combineRegexes(isoOrdinalRegex,isoTimeExtensionRegex);var isoTimeCombinedRegex=combineRegexes(isoTimeRegex);var extractISOYmdTimeAndOffset=combineExtractors(extractISOYmd,extractISOTime,extractISOOffset);var extractISOWeekTimeAndOffset=combineExtractors(extractISOWeekData,extractISOTime,extractISOOffset);var extractISOOrdinalDataAndTime=combineExtractors(extractISOOrdinalData,extractISOTime);var extractISOTimeAndOffset=combineExtractors(extractISOTime,extractISOOffset);function parseISODate(s){return parse(s,[isoYmdWithTimeExtensionRegex,extractISOYmdTimeAndOffset],[isoWeekWithTimeExtensionRegex,extractISOWeekTimeAndOffset],[isoOrdinalWithTimeExtensionRegex,extractISOOrdinalDataAndTime],[isoTimeCombinedRegex,extractISOTimeAndOffset]);}
function parseRFC2822Date(s){return parse(preprocessRFC2822(s),[rfc2822,extractRFC2822]);}
function parseHTTPDate(s){return parse(s,[rfc1123,extractRFC1123Or850],[rfc850,extractRFC1123Or850],[ascii,extractASCII]);}
function parseISODuration(s){return parse(s,[isoDuration,extractISODuration]);}
var sqlYmdWithTimeExtensionRegex=combineRegexes(sqlYmdRegex,sqlTimeExtensionRegex);var sqlTimeCombinedRegex=combineRegexes(sqlTimeRegex);var extractISOYmdTimeOffsetAndIANAZone=combineExtractors(extractISOYmd,extractISOTime,extractISOOffset,extractIANAZone);var extractISOTimeOffsetAndIANAZone=combineExtractors(extractISOTime,extractISOOffset,extractIANAZone);function parseSQL(s){return parse(s,[sqlYmdWithTimeExtensionRegex,extractISOYmdTimeOffsetAndIANAZone],[sqlTimeCombinedRegex,extractISOTimeOffsetAndIANAZone]);}
var INVALID="Invalid Duration";var lowOrderMatrix={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1000},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1000},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1000},minutes:{seconds:60,milliseconds:60*1000},seconds:{milliseconds:1000}},casualMatrix=Object.assign({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1000},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1000},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1000}},lowOrderMatrix),daysInYearAccurate=146097.0/400,daysInMonthAccurate=146097.0/4800,accurateMatrix=Object.assign({years:{quarters:4,months:12,weeks:daysInYearAccurate/7,days:daysInYearAccurate,hours:daysInYearAccurate*24,minutes:daysInYearAccurate*24*60,seconds:daysInYearAccurate*24*60*60,milliseconds:daysInYearAccurate*24*60*60*1000},quarters:{months:3,weeks:daysInYearAccurate/28,days:daysInYearAccurate/4,hours:daysInYearAccurate*24/4,minutes:daysInYearAccurate*24*60/4,seconds:daysInYearAccurate*24*60*60/4,milliseconds:daysInYearAccurate*24*60*60*1000/4},months:{weeks:daysInMonthAccurate/7,days:daysInMonthAccurate,hours:daysInMonthAccurate*24,minutes:daysInMonthAccurate*24*60,seconds:daysInMonthAccurate*24*60*60,milliseconds:daysInMonthAccurate*24*60*60*1000}},lowOrderMatrix);var orderedUnits=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"];var reverseUnits=orderedUnits.slice(0).reverse();function clone(dur,alts,clear){if(clear===void 0){clear=false;}
var conf={values:clear?alts.values:Object.assign({},dur.values,alts.values||{}),loc:dur.loc.clone(alts.loc),conversionAccuracy:alts.conversionAccuracy||dur.conversionAccuracy};return new Duration(conf);}
function antiTrunc(n){return n<0?Math.floor(n):Math.ceil(n);}
function convert(matrix,fromMap,fromUnit,toMap,toUnit){var conv=matrix[toUnit][fromUnit],raw=fromMap[fromUnit]/conv,sameSign=Math.sign(raw)===Math.sign(toMap[toUnit]),added=!sameSign&&toMap[toUnit]!==0&&Math.abs(raw)<=1?antiTrunc(raw):Math.trunc(raw);toMap[toUnit]+=added;fromMap[fromUnit]-=added*conv;}
function normalizeValues(matrix,vals){reverseUnits.reduce(function(previous,current){if(!isUndefined(vals[current])){if(previous){convert(matrix,vals,previous,vals,current);}
return current;}else{return previous;}},null);}
var Duration=function(){function Duration(config){var accurate=config.conversionAccuracy==="longterm"||false;this.values=config.values;this.loc=config.loc||Locale.create();this.conversionAccuracy=accurate?"longterm":"casual";this.invalid=config.invalid||null;this.matrix=accurate?accurateMatrix:casualMatrix;this.isLuxonDuration=true;}
Duration.fromMillis=function fromMillis(count,opts){return Duration.fromObject(Object.assign({milliseconds:count},opts));};Duration.fromObject=function fromObject(obj){if(obj==null||typeof obj!=="object"){throw new InvalidArgumentError("Duration.fromObject: argument expected to be an object, got "+(obj===null?"null":typeof obj));}
return new Duration({values:normalizeObject(obj,Duration.normalizeUnit,["locale","numberingSystem","conversionAccuracy","zone"]),loc:Locale.fromObject(obj),conversionAccuracy:obj.conversionAccuracy});};Duration.fromISO=function fromISO(text,opts){var _parseISODuration=parseISODuration(text),parsed=_parseISODuration[0];if(parsed){var obj=Object.assign(parsed,opts);return Duration.fromObject(obj);}else{return Duration.invalid("unparsable","the input \""+text+"\" can't be parsed as ISO 8601");}};Duration.invalid=function invalid(reason,explanation){if(explanation===void 0){explanation=null;}
if(!reason){throw new InvalidArgumentError("need to specify a reason the Duration is invalid");}
var invalid=reason instanceof Invalid?reason:new Invalid(reason,explanation);if(Settings.throwOnInvalid){throw new InvalidDurationError(invalid);}else{return new Duration({invalid:invalid});}};Duration.normalizeUnit=function normalizeUnit(unit){var normalized={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[unit?unit.toLowerCase():unit];if(!normalized)throw new InvalidUnitError(unit);return normalized;};Duration.isDuration=function isDuration(o){return o&&o.isLuxonDuration||false;};var _proto=Duration.prototype;_proto.toFormat=function toFormat(fmt,opts){if(opts===void 0){opts={};}
var fmtOpts=Object.assign({},opts,{floor:opts.round!==false&&opts.floor!==false});return this.isValid?Formatter.create(this.loc,fmtOpts).formatDurationFromString(this,fmt):INVALID;};_proto.toObject=function toObject(opts){if(opts===void 0){opts={};}
if(!this.isValid)return{};var base=Object.assign({},this.values);if(opts.includeConfig){base.conversionAccuracy=this.conversionAccuracy;base.numberingSystem=this.loc.numberingSystem;base.locale=this.loc.locale;}
return base;};_proto.toISO=function toISO(){if(!this.isValid)return null;var s="P";if(this.years!==0)s+=this.years+"Y";if(this.months!==0||this.quarters!==0)s+=this.months+this.quarters*3+"M";if(this.weeks!==0)s+=this.weeks+"W";if(this.days!==0)s+=this.days+"D";if(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)s+="T";if(this.hours!==0)s+=this.hours+"H";if(this.minutes!==0)s+=this.minutes+"M";if(this.seconds!==0||this.milliseconds!==0)
s+=roundTo(this.seconds+this.milliseconds/1000,3)+"S";if(s==="P")s+="T0S";return s;};_proto.toJSON=function toJSON(){return this.toISO();};_proto.toString=function toString(){return this.toISO();};_proto.valueOf=function valueOf(){return this.as("milliseconds");};_proto.plus=function plus(duration){if(!this.isValid)return this;var dur=friendlyDuration(duration),result={};for(var _iterator=_createForOfIteratorHelperLoose(orderedUnits),_step;!(_step=_iterator()).done;){var k=_step.value;if(hasOwnProperty(dur.values,k)||hasOwnProperty(this.values,k)){result[k]=dur.get(k)+this.get(k);}}
return clone(this,{values:result},true);};_proto.minus=function minus(duration){if(!this.isValid)return this;var dur=friendlyDuration(duration);return this.plus(dur.negate());};_proto.mapUnits=function mapUnits(fn){if(!this.isValid)return this;var result={};for(var _i=0,_Object$keys=Object.keys(this.values);_i<_Object$keys.length;_i++){var k=_Object$keys[_i];result[k]=asNumber(fn(this.values[k],k));}
return clone(this,{values:result},true);};_proto.get=function get(unit){return this[Duration.normalizeUnit(unit)];};_proto.set=function set(values){if(!this.isValid)return this;var mixed=Object.assign(this.values,normalizeObject(values,Duration.normalizeUnit,[]));return clone(this,{values:mixed});};_proto.reconfigure=function reconfigure(_temp){var _ref=_temp===void 0?{}:_temp,locale=_ref.locale,numberingSystem=_ref.numberingSystem,conversionAccuracy=_ref.conversionAccuracy;var loc=this.loc.clone({locale:locale,numberingSystem:numberingSystem}),opts={loc:loc};if(conversionAccuracy){opts.conversionAccuracy=conversionAccuracy;}
return clone(this,opts);};_proto.as=function as(unit){return this.isValid?this.shiftTo(unit).get(unit):NaN;};_proto.normalize=function normalize(){if(!this.isValid)return this;var vals=this.toObject();normalizeValues(this.matrix,vals);return clone(this,{values:vals},true);};_proto.shiftTo=function shiftTo(){for(var _len=arguments.length,units=new Array(_len),_key=0;_key<_len;_key++){units[_key]=arguments[_key];}
if(!this.isValid)return this;if(units.length===0){return this;}
units=units.map(function(u){return Duration.normalizeUnit(u);});var built={},accumulated={},vals=this.toObject();var lastUnit;for(var _iterator2=_createForOfIteratorHelperLoose(orderedUnits),_step2;!(_step2=_iterator2()).done;){var k=_step2.value;if(units.indexOf(k)>=0){lastUnit=k;var own=0;for(var ak in accumulated){own+=this.matrix[ak][k]*accumulated[ak];accumulated[ak]=0;}
if(isNumber(vals[k])){own+=vals[k];}
var i=Math.trunc(own);built[k]=i;accumulated[k]=own-i;for(var down in vals){if(orderedUnits.indexOf(down)>orderedUnits.indexOf(k)){convert(this.matrix,vals,down,built,k);}}}else if(isNumber(vals[k])){accumulated[k]=vals[k];}}
for(var key in accumulated){if(accumulated[key]!==0){built[lastUnit]+=key===lastUnit?accumulated[key]:accumulated[key]/this.matrix[lastUnit][key];}}
return clone(this,{values:built},true).normalize();};_proto.negate=function negate(){if(!this.isValid)return this;var negated={};for(var _i2=0,_Object$keys2=Object.keys(this.values);_i2<_Object$keys2.length;_i2++){var k=_Object$keys2[_i2];negated[k]=-this.values[k];}
return clone(this,{values:negated},true);};_proto.equals=function equals(other){if(!this.isValid||!other.isValid){return false;}
if(!this.loc.equals(other.loc)){return false;}
for(var _iterator3=_createForOfIteratorHelperLoose(orderedUnits),_step3;!(_step3=_iterator3()).done;){var u=_step3.value;if(this.values[u]!==other.values[u]){return false;}}
return true;};_createClass(Duration,[{key:"locale",get:function get(){return this.isValid?this.loc.locale:null;}},{key:"numberingSystem",get:function get(){return this.isValid?this.loc.numberingSystem:null;}},{key:"years",get:function get(){return this.isValid?this.values.years||0:NaN;}},{key:"quarters",get:function get(){return this.isValid?this.values.quarters||0:NaN;}},{key:"months",get:function get(){return this.isValid?this.values.months||0:NaN;}},{key:"weeks",get:function get(){return this.isValid?this.values.weeks||0:NaN;}},{key:"days",get:function get(){return this.isValid?this.values.days||0:NaN;}},{key:"hours",get:function get(){return this.isValid?this.values.hours||0:NaN;}},{key:"minutes",get:function get(){return this.isValid?this.values.minutes||0:NaN;}},{key:"seconds",get:function get(){return this.isValid?this.values.seconds||0:NaN;}},{key:"milliseconds",get:function get(){return this.isValid?this.values.milliseconds||0:NaN;}},{key:"isValid",get:function get(){return this.invalid===null;}},{key:"invalidReason",get:function get(){return this.invalid?this.invalid.reason:null;}},{key:"invalidExplanation",get:function get(){return this.invalid?this.invalid.explanation:null;}}]);return Duration;}();function friendlyDuration(durationish){if(isNumber(durationish)){return Duration.fromMillis(durationish);}else if(Duration.isDuration(durationish)){return durationish;}else if(typeof durationish==="object"){return Duration.fromObject(durationish);}else{throw new InvalidArgumentError("Unknown duration argument "+durationish+" of type "+typeof durationish);}}
var INVALID$1="Invalid Interval";function validateStartEnd(start,end){if(!start||!start.isValid){return Interval.invalid("missing or invalid start");}else if(!end||!end.isValid){return Interval.invalid("missing or invalid end");}else if(end<start){return Interval.invalid("end before start","The end of an interval must be after its start, but you had start="+start.toISO()+" and end="+end.toISO());}else{return null;}}
var Interval=function(){function Interval(config){this.s=config.start;this.e=config.end;this.invalid=config.invalid||null;this.isLuxonInterval=true;}
Interval.invalid=function invalid(reason,explanation){if(explanation===void 0){explanation=null;}
if(!reason){throw new InvalidArgumentError("need to specify a reason the Interval is invalid");}
var invalid=reason instanceof Invalid?reason:new Invalid(reason,explanation);if(Settings.throwOnInvalid){throw new InvalidIntervalError(invalid);}else{return new Interval({invalid:invalid});}};Interval.fromDateTimes=function fromDateTimes(start,end){var builtStart=friendlyDateTime(start),builtEnd=friendlyDateTime(end);var validateError=validateStartEnd(builtStart,builtEnd);if(validateError==null){return new Interval({start:builtStart,end:builtEnd});}else{return validateError;}};Interval.after=function after(start,duration){var dur=friendlyDuration(duration),dt=friendlyDateTime(start);return Interval.fromDateTimes(dt,dt.plus(dur));};Interval.before=function before(end,duration){var dur=friendlyDuration(duration),dt=friendlyDateTime(end);return Interval.fromDateTimes(dt.minus(dur),dt);};Interval.fromISO=function fromISO(text,opts){var _split=(text||"").split("/",2),s=_split[0],e=_split[1];if(s&&e){var start,startIsValid;try{start=DateTime.fromISO(s,opts);startIsValid=start.isValid;}catch(e){startIsValid=false;}
var end,endIsValid;try{end=DateTime.fromISO(e,opts);endIsValid=end.isValid;}catch(e){endIsValid=false;}
if(startIsValid&&endIsValid){return Interval.fromDateTimes(start,end);}
if(startIsValid){var dur=Duration.fromISO(e,opts);if(dur.isValid){return Interval.after(start,dur);}}else if(endIsValid){var _dur=Duration.fromISO(s,opts);if(_dur.isValid){return Interval.before(end,_dur);}}}
return Interval.invalid("unparsable","the input \""+text+"\" can't be parsed as ISO 8601");};Interval.isInterval=function isInterval(o){return o&&o.isLuxonInterval||false;};var _proto=Interval.prototype;_proto.length=function length(unit){if(unit===void 0){unit="milliseconds";}
return this.isValid?this.toDuration.apply(this,[unit]).get(unit):NaN;};_proto.count=function count(unit){if(unit===void 0){unit="milliseconds";}
if(!this.isValid)return NaN;var start=this.start.startOf(unit),end=this.end.startOf(unit);return Math.floor(end.diff(start,unit).get(unit))+1;};_proto.hasSame=function hasSame(unit){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,unit):false;};_proto.isEmpty=function isEmpty(){return this.s.valueOf()===this.e.valueOf();};_proto.isAfter=function isAfter(dateTime){if(!this.isValid)return false;return this.s>dateTime;};_proto.isBefore=function isBefore(dateTime){if(!this.isValid)return false;return this.e<=dateTime;};_proto.contains=function contains(dateTime){if(!this.isValid)return false;return this.s<=dateTime&&this.e>dateTime;};_proto.set=function set(_temp){var _ref=_temp===void 0?{}:_temp,start=_ref.start,end=_ref.end;if(!this.isValid)return this;return Interval.fromDateTimes(start||this.s,end||this.e);};_proto.splitAt=function splitAt(){var _this=this;if(!this.isValid)return[];for(var _len=arguments.length,dateTimes=new Array(_len),_key=0;_key<_len;_key++){dateTimes[_key]=arguments[_key];}
var sorted=dateTimes.map(friendlyDateTime).filter(function(d){return _this.contains(d);}).sort(),results=[];var s=this.s,i=0;while(s<this.e){var added=sorted[i]||this.e,next=+added>+this.e?this.e:added;results.push(Interval.fromDateTimes(s,next));s=next;i+=1;}
return results;};_proto.splitBy=function splitBy(duration){var dur=friendlyDuration(duration);if(!this.isValid||!dur.isValid||dur.as("milliseconds")===0){return[];}
var s=this.s,added,next;var results=[];while(s<this.e){added=s.plus(dur);next=+added>+this.e?this.e:added;results.push(Interval.fromDateTimes(s,next));s=next;}
return results;};_proto.divideEqually=function divideEqually(numberOfParts){if(!this.isValid)return[];return this.splitBy(this.length()/numberOfParts).slice(0,numberOfParts);};_proto.overlaps=function overlaps(other){return this.e>other.s&&this.s<other.e;};_proto.abutsStart=function abutsStart(other){if(!this.isValid)return false;return+this.e===+other.s;};_proto.abutsEnd=function abutsEnd(other){if(!this.isValid)return false;return+other.e===+this.s;};_proto.engulfs=function engulfs(other){if(!this.isValid)return false;return this.s<=other.s&&this.e>=other.e;};_proto.equals=function equals(other){if(!this.isValid||!other.isValid){return false;}
return this.s.equals(other.s)&&this.e.equals(other.e);};_proto.intersection=function intersection(other){if(!this.isValid)return this;var s=this.s>other.s?this.s:other.s,e=this.e<other.e?this.e:other.e;if(s>e){return null;}else{return Interval.fromDateTimes(s,e);}};_proto.union=function union(other){if(!this.isValid)return this;var s=this.s<other.s?this.s:other.s,e=this.e>other.e?this.e:other.e;return Interval.fromDateTimes(s,e);};Interval.merge=function merge(intervals){var _intervals$sort$reduc=intervals.sort(function(a,b){return a.s-b.s;}).reduce(function(_ref2,item){var sofar=_ref2[0],current=_ref2[1];if(!current){return[sofar,item];}else if(current.overlaps(item)||current.abutsStart(item)){return[sofar,current.union(item)];}else{return[sofar.concat([current]),item];}},[[],null]),found=_intervals$sort$reduc[0],final=_intervals$sort$reduc[1];if(final){found.push(final);}
return found;};Interval.xor=function xor(intervals){var _Array$prototype;var start=null,currentCount=0;var results=[],ends=intervals.map(function(i){return[{time:i.s,type:"s"},{time:i.e,type:"e"}];}),flattened=(_Array$prototype=Array.prototype).concat.apply(_Array$prototype,ends),arr=flattened.sort(function(a,b){return a.time-b.time;});for(var _iterator=_createForOfIteratorHelperLoose(arr),_step;!(_step=_iterator()).done;){var i=_step.value;currentCount+=i.type==="s"?1:-1;if(currentCount===1){start=i.time;}else{if(start&&+start!==+i.time){results.push(Interval.fromDateTimes(start,i.time));}
start=null;}}
return Interval.merge(results);};_proto.difference=function difference(){var _this2=this;for(var _len2=arguments.length,intervals=new Array(_len2),_key2=0;_key2<_len2;_key2++){intervals[_key2]=arguments[_key2];}
return Interval.xor([this].concat(intervals)).map(function(i){return _this2.intersection(i);}).filter(function(i){return i&&!i.isEmpty();});};_proto.toString=function toString(){if(!this.isValid)return INVALID$1;return"["+this.s.toISO()+" \u2013 "+this.e.toISO()+")";};_proto.toISO=function toISO(opts){if(!this.isValid)return INVALID$1;return this.s.toISO(opts)+"/"+this.e.toISO(opts);};_proto.toISODate=function toISODate(){if(!this.isValid)return INVALID$1;return this.s.toISODate()+"/"+this.e.toISODate();};_proto.toISOTime=function toISOTime(opts){if(!this.isValid)return INVALID$1;return this.s.toISOTime(opts)+"/"+this.e.toISOTime(opts);};_proto.toFormat=function toFormat(dateFormat,_temp2){var _ref3=_temp2===void 0?{}:_temp2,_ref3$separator=_ref3.separator,separator=_ref3$separator===void 0?" – ":_ref3$separator;if(!this.isValid)return INVALID$1;return""+this.s.toFormat(dateFormat)+separator+this.e.toFormat(dateFormat);};_proto.toDuration=function toDuration(unit,opts){if(!this.isValid){return Duration.invalid(this.invalidReason);}
return this.e.diff(this.s,unit,opts);};_proto.mapEndpoints=function mapEndpoints(mapFn){return Interval.fromDateTimes(mapFn(this.s),mapFn(this.e));};_createClass(Interval,[{key:"start",get:function get(){return this.isValid?this.s:null;}},{key:"end",get:function get(){return this.isValid?this.e:null;}},{key:"isValid",get:function get(){return this.invalidReason===null;}},{key:"invalidReason",get:function get(){return this.invalid?this.invalid.reason:null;}},{key:"invalidExplanation",get:function get(){return this.invalid?this.invalid.explanation:null;}}]);return Interval;}();var Info=function(){function Info(){}
Info.hasDST=function hasDST(zone){if(zone===void 0){zone=Settings.defaultZone;}
var proto=DateTime.local().setZone(zone).set({month:12});return!zone.universal&&proto.offset!==proto.set({month:6}).offset;};Info.isValidIANAZone=function isValidIANAZone(zone){return IANAZone.isValidSpecifier(zone)&&IANAZone.isValidZone(zone);};Info.normalizeZone=function normalizeZone$1(input){return normalizeZone(input,Settings.defaultZone);};Info.months=function months(length,_temp){if(length===void 0){length="long";}
var _ref=_temp===void 0?{}:_temp,_ref$locale=_ref.locale,locale=_ref$locale===void 0?null:_ref$locale,_ref$numberingSystem=_ref.numberingSystem,numberingSystem=_ref$numberingSystem===void 0?null:_ref$numberingSystem,_ref$outputCalendar=_ref.outputCalendar,outputCalendar=_ref$outputCalendar===void 0?"gregory":_ref$outputCalendar;return Locale.create(locale,numberingSystem,outputCalendar).months(length);};Info.monthsFormat=function monthsFormat(length,_temp2){if(length===void 0){length="long";}
var _ref2=_temp2===void 0?{}:_temp2,_ref2$locale=_ref2.locale,locale=_ref2$locale===void 0?null:_ref2$locale,_ref2$numberingSystem=_ref2.numberingSystem,numberingSystem=_ref2$numberingSystem===void 0?null:_ref2$numberingSystem,_ref2$outputCalendar=_ref2.outputCalendar,outputCalendar=_ref2$outputCalendar===void 0?"gregory":_ref2$outputCalendar;return Locale.create(locale,numberingSystem,outputCalendar).months(length,true);};Info.weekdays=function weekdays(length,_temp3){if(length===void 0){length="long";}
var _ref3=_temp3===void 0?{}:_temp3,_ref3$locale=_ref3.locale,locale=_ref3$locale===void 0?null:_ref3$locale,_ref3$numberingSystem=_ref3.numberingSystem,numberingSystem=_ref3$numberingSystem===void 0?null:_ref3$numberingSystem;return Locale.create(locale,numberingSystem,null).weekdays(length);};Info.weekdaysFormat=function weekdaysFormat(length,_temp4){if(length===void 0){length="long";}
var _ref4=_temp4===void 0?{}:_temp4,_ref4$locale=_ref4.locale,locale=_ref4$locale===void 0?null:_ref4$locale,_ref4$numberingSystem=_ref4.numberingSystem,numberingSystem=_ref4$numberingSystem===void 0?null:_ref4$numberingSystem;return Locale.create(locale,numberingSystem,null).weekdays(length,true);};Info.meridiems=function meridiems(_temp5){var _ref5=_temp5===void 0?{}:_temp5,_ref5$locale=_ref5.locale,locale=_ref5$locale===void 0?null:_ref5$locale;return Locale.create(locale).meridiems();};Info.eras=function eras(length,_temp6){if(length===void 0){length="short";}
var _ref6=_temp6===void 0?{}:_temp6,_ref6$locale=_ref6.locale,locale=_ref6$locale===void 0?null:_ref6$locale;return Locale.create(locale,null,"gregory").eras(length);};Info.features=function features(){var intl=false,intlTokens=false,zones=false,relative=false;if(hasIntl()){intl=true;intlTokens=hasFormatToParts();relative=hasRelative();try{zones=new Intl.DateTimeFormat("en",{timeZone:"America/New_York"}).resolvedOptions().timeZone==="America/New_York";}catch(e){zones=false;}}
return{intl:intl,intlTokens:intlTokens,zones:zones,relative:relative};};return Info;}();function dayDiff(earlier,later){var utcDayStart=function utcDayStart(dt){return dt.toUTC(0,{keepLocalTime:true}).startOf("day").valueOf();},ms=utcDayStart(later)-utcDayStart(earlier);return Math.floor(Duration.fromMillis(ms).as("days"));}
function highOrderDiffs(cursor,later,units){var differs=[["years",function(a,b){return b.year-a.year;}],["months",function(a,b){return b.month-a.month+(b.year-a.year)*12;}],["weeks",function(a,b){var days=dayDiff(a,b);return(days-days%7)/7;}],["days",dayDiff]];var results={};var lowestOrder,highWater;for(var _i=0,_differs=differs;_i<_differs.length;_i++){var _differs$_i=_differs[_i],unit=_differs$_i[0],differ=_differs$_i[1];if(units.indexOf(unit)>=0){var _cursor$plus;lowestOrder=unit;var delta=differ(cursor,later);highWater=cursor.plus((_cursor$plus={},_cursor$plus[unit]=delta,_cursor$plus));if(highWater>later){var _cursor$plus2;cursor=cursor.plus((_cursor$plus2={},_cursor$plus2[unit]=delta-1,_cursor$plus2));delta-=1;}else{cursor=highWater;}
results[unit]=delta;}}
return[cursor,results,highWater,lowestOrder];}
function _diff(earlier,later,units,opts){var _highOrderDiffs=highOrderDiffs(earlier,later,units),cursor=_highOrderDiffs[0],results=_highOrderDiffs[1],highWater=_highOrderDiffs[2],lowestOrder=_highOrderDiffs[3];var remainingMillis=later-cursor;var lowerOrderUnits=units.filter(function(u){return["hours","minutes","seconds","milliseconds"].indexOf(u)>=0;});if(lowerOrderUnits.length===0){if(highWater<later){var _cursor$plus3;highWater=cursor.plus((_cursor$plus3={},_cursor$plus3[lowestOrder]=1,_cursor$plus3));}
if(highWater!==cursor){results[lowestOrder]=(results[lowestOrder]||0)+remainingMillis/(highWater-cursor);}}
var duration=Duration.fromObject(Object.assign(results,opts));if(lowerOrderUnits.length>0){var _Duration$fromMillis;return(_Duration$fromMillis=Duration.fromMillis(remainingMillis,opts)).shiftTo.apply(_Duration$fromMillis,lowerOrderUnits).plus(duration);}else{return duration;}}
var numberingSystems={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"};var numberingSystemsUTF16={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]};var hanidecChars=numberingSystems.hanidec.replace(/[\[|\]]/g,"").split("");function parseDigits(str){var value=parseInt(str,10);if(isNaN(value)){value="";for(var i=0;i<str.length;i++){var code=str.charCodeAt(i);if(str[i].search(numberingSystems.hanidec)!==-1){value+=hanidecChars.indexOf(str[i]);}else{for(var key in numberingSystemsUTF16){var _numberingSystemsUTF=numberingSystemsUTF16[key],min=_numberingSystemsUTF[0],max=_numberingSystemsUTF[1];if(code>=min&&code<=max){value+=code-min;}}}}
return parseInt(value,10);}else{return value;}}
function digitRegex(_ref,append){var numberingSystem=_ref.numberingSystem;if(append===void 0){append="";}
return new RegExp(""+numberingSystems[numberingSystem||"latn"]+append);}
var MISSING_FTP="missing Intl.DateTimeFormat.formatToParts support";function intUnit(regex,post){if(post===void 0){post=function post(i){return i;};}
return{regex:regex,deser:function deser(_ref){var s=_ref[0];return post(parseDigits(s));}};}
var NBSP=String.fromCharCode(160);var spaceOrNBSP="( |"+NBSP+")";var spaceOrNBSPRegExp=new RegExp(spaceOrNBSP,"g");function fixListRegex(s){return s.replace(/\./g,"\\.?").replace(spaceOrNBSPRegExp,spaceOrNBSP);}
function stripInsensitivities(s){return s.replace(/\./g,"").replace(spaceOrNBSPRegExp," ").toLowerCase();}
function oneOf(strings,startIndex){if(strings===null){return null;}else{return{regex:RegExp(strings.map(fixListRegex).join("|")),deser:function deser(_ref2){var s=_ref2[0];return strings.findIndex(function(i){return stripInsensitivities(s)===stripInsensitivities(i);})+startIndex;}};}}
function offset(regex,groups){return{regex:regex,deser:function deser(_ref3){var h=_ref3[1],m=_ref3[2];return signedOffset(h,m);},groups:groups};}
function simple(regex){return{regex:regex,deser:function deser(_ref4){var s=_ref4[0];return s;}};}
function escapeToken(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");}
function unitForToken(token,loc){var one=digitRegex(loc),two=digitRegex(loc,"{2}"),three=digitRegex(loc,"{3}"),four=digitRegex(loc,"{4}"),six=digitRegex(loc,"{6}"),oneOrTwo=digitRegex(loc,"{1,2}"),oneToThree=digitRegex(loc,"{1,3}"),oneToSix=digitRegex(loc,"{1,6}"),oneToNine=digitRegex(loc,"{1,9}"),twoToFour=digitRegex(loc,"{2,4}"),fourToSix=digitRegex(loc,"{4,6}"),literal=function literal(t){return{regex:RegExp(escapeToken(t.val)),deser:function deser(_ref5){var s=_ref5[0];return s;},literal:true};},unitate=function unitate(t){if(token.literal){return literal(t);}
switch(t.val){case"G":return oneOf(loc.eras("short",false),0);case"GG":return oneOf(loc.eras("long",false),0);case"y":return intUnit(oneToSix);case"yy":return intUnit(twoToFour,untruncateYear);case"yyyy":return intUnit(four);case"yyyyy":return intUnit(fourToSix);case"yyyyyy":return intUnit(six);case"M":return intUnit(oneOrTwo);case"MM":return intUnit(two);case"MMM":return oneOf(loc.months("short",true,false),1);case"MMMM":return oneOf(loc.months("long",true,false),1);case"L":return intUnit(oneOrTwo);case"LL":return intUnit(two);case"LLL":return oneOf(loc.months("short",false,false),1);case"LLLL":return oneOf(loc.months("long",false,false),1);case"d":return intUnit(oneOrTwo);case"dd":return intUnit(two);case"o":return intUnit(oneToThree);case"ooo":return intUnit(three);case"HH":return intUnit(two);case"H":return intUnit(oneOrTwo);case"hh":return intUnit(two);case"h":return intUnit(oneOrTwo);case"mm":return intUnit(two);case"m":return intUnit(oneOrTwo);case"q":return intUnit(oneOrTwo);case"qq":return intUnit(two);case"s":return intUnit(oneOrTwo);case"ss":return intUnit(two);case"S":return intUnit(oneToThree);case"SSS":return intUnit(three);case"u":return simple(oneToNine);case"a":return oneOf(loc.meridiems(),0);case"kkkk":return intUnit(four);case"kk":return intUnit(twoToFour,untruncateYear);case"W":return intUnit(oneOrTwo);case"WW":return intUnit(two);case"E":case"c":return intUnit(one);case"EEE":return oneOf(loc.weekdays("short",false,false),1);case"EEEE":return oneOf(loc.weekdays("long",false,false),1);case"ccc":return oneOf(loc.weekdays("short",true,false),1);case"cccc":return oneOf(loc.weekdays("long",true,false),1);case"Z":case"ZZ":return offset(new RegExp("([+-]"+oneOrTwo.source+")(?::("+two.source+"))?"),2);case"ZZZ":return offset(new RegExp("([+-]"+oneOrTwo.source+")("+two.source+")?"),2);case"z":return simple(/[a-z_+-/]{1,256}?/i);default:return literal(t);}};var unit=unitate(token)||{invalidReason:MISSING_FTP};unit.token=token;return unit;}
var partTypeStyleToTokenVal={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function tokenForPart(part,locale,formatOpts){var type=part.type,value=part.value;if(type==="literal"){return{literal:true,val:value};}
var style=formatOpts[type];var val=partTypeStyleToTokenVal[type];if(typeof val==="object"){val=val[style];}
if(val){return{literal:false,val:val};}
return undefined;}
function buildRegex(units){var re=units.map(function(u){return u.regex;}).reduce(function(f,r){return f+"("+r.source+")";},"");return["^"+re+"$",units];}
function match(input,regex,handlers){var matches=input.match(regex);if(matches){var all={};var matchIndex=1;for(var i in handlers){if(hasOwnProperty(handlers,i)){var h=handlers[i],groups=h.groups?h.groups+1:1;if(!h.literal&&h.token){all[h.token.val[0]]=h.deser(matches.slice(matchIndex,matchIndex+groups));}
matchIndex+=groups;}}
return[matches,all];}else{return[matches,{}];}}
function dateTimeFromMatches(matches){var toField=function toField(token){switch(token){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null;}};var zone;if(!isUndefined(matches.Z)){zone=new FixedOffsetZone(matches.Z);}else if(!isUndefined(matches.z)){zone=IANAZone.create(matches.z);}else{zone=null;}
if(!isUndefined(matches.q)){matches.M=(matches.q-1)*3+1;}
if(!isUndefined(matches.h)){if(matches.h<12&&matches.a===1){matches.h+=12;}else if(matches.h===12&&matches.a===0){matches.h=0;}}
if(matches.G===0&&matches.y){matches.y=-matches.y;}
if(!isUndefined(matches.u)){matches.S=parseMillis(matches.u);}
var vals=Object.keys(matches).reduce(function(r,k){var f=toField(k);if(f){r[f]=matches[k];}
return r;},{});return[vals,zone];}
var dummyDateTimeCache=null;function getDummyDateTime(){if(!dummyDateTimeCache){dummyDateTimeCache=DateTime.fromMillis(1555555555555);}
return dummyDateTimeCache;}
function maybeExpandMacroToken(token,locale){if(token.literal){return token;}
var formatOpts=Formatter.macroTokenToFormatOpts(token.val);if(!formatOpts){return token;}
var formatter=Formatter.create(locale,formatOpts);var parts=formatter.formatDateTimeParts(getDummyDateTime());var tokens=parts.map(function(p){return tokenForPart(p,locale,formatOpts);});if(tokens.includes(undefined)){return token;}
return tokens;}
function expandMacroTokens(tokens,locale){var _Array$prototype;return(_Array$prototype=Array.prototype).concat.apply(_Array$prototype,tokens.map(function(t){return maybeExpandMacroToken(t,locale);}));}
function explainFromTokens(locale,input,format){var tokens=expandMacroTokens(Formatter.parseFormat(format),locale),units=tokens.map(function(t){return unitForToken(t,locale);}),disqualifyingUnit=units.find(function(t){return t.invalidReason;});if(disqualifyingUnit){return{input:input,tokens:tokens,invalidReason:disqualifyingUnit.invalidReason};}else{var _buildRegex=buildRegex(units),regexString=_buildRegex[0],handlers=_buildRegex[1],regex=RegExp(regexString,"i"),_match=match(input,regex,handlers),rawMatches=_match[0],matches=_match[1],_ref6=matches?dateTimeFromMatches(matches):[null,null],result=_ref6[0],zone=_ref6[1];if(hasOwnProperty(matches,"a")&&hasOwnProperty(matches,"H")){throw new ConflictingSpecificationError("Can't include meridiem when specifying 24-hour format");}
return{input:input,tokens:tokens,regex:regex,rawMatches:rawMatches,matches:matches,result:result,zone:zone};}}
function parseFromTokens(locale,input,format){var _explainFromTokens=explainFromTokens(locale,input,format),result=_explainFromTokens.result,zone=_explainFromTokens.zone,invalidReason=_explainFromTokens.invalidReason;return[result,zone,invalidReason];}
var nonLeapLadder=[0,31,59,90,120,151,181,212,243,273,304,334],leapLadder=[0,31,60,91,121,152,182,213,244,274,305,335];function unitOutOfRange(unit,value){return new Invalid("unit out of range","you specified "+value+" (of type "+typeof value+") as a "+unit+", which is invalid");}
function dayOfWeek(year,month,day){var js=new Date(Date.UTC(year,month-1,day)).getUTCDay();return js===0?7:js;}
function computeOrdinal(year,month,day){return day+(isLeapYear(year)?leapLadder:nonLeapLadder)[month-1];}
function uncomputeOrdinal(year,ordinal){var table=isLeapYear(year)?leapLadder:nonLeapLadder,month0=table.findIndex(function(i){return i<ordinal;}),day=ordinal-table[month0];return{month:month0+1,day:day};}
function gregorianToWeek(gregObj){var year=gregObj.year,month=gregObj.month,day=gregObj.day,ordinal=computeOrdinal(year,month,day),weekday=dayOfWeek(year,month,day);var weekNumber=Math.floor((ordinal-weekday+10)/7),weekYear;if(weekNumber<1){weekYear=year-1;weekNumber=weeksInWeekYear(weekYear);}else if(weekNumber>weeksInWeekYear(year)){weekYear=year+1;weekNumber=1;}else{weekYear=year;}
return Object.assign({weekYear:weekYear,weekNumber:weekNumber,weekday:weekday},timeObject(gregObj));}
function weekToGregorian(weekData){var weekYear=weekData.weekYear,weekNumber=weekData.weekNumber,weekday=weekData.weekday,weekdayOfJan4=dayOfWeek(weekYear,1,4),yearInDays=daysInYear(weekYear);var ordinal=weekNumber*7+weekday-weekdayOfJan4-3,year;if(ordinal<1){year=weekYear-1;ordinal+=daysInYear(year);}else if(ordinal>yearInDays){year=weekYear+1;ordinal-=daysInYear(weekYear);}else{year=weekYear;}
var _uncomputeOrdinal=uncomputeOrdinal(year,ordinal),month=_uncomputeOrdinal.month,day=_uncomputeOrdinal.day;return Object.assign({year:year,month:month,day:day},timeObject(weekData));}
function gregorianToOrdinal(gregData){var year=gregData.year,month=gregData.month,day=gregData.day,ordinal=computeOrdinal(year,month,day);return Object.assign({year:year,ordinal:ordinal},timeObject(gregData));}
function ordinalToGregorian(ordinalData){var year=ordinalData.year,ordinal=ordinalData.ordinal,_uncomputeOrdinal2=uncomputeOrdinal(year,ordinal),month=_uncomputeOrdinal2.month,day=_uncomputeOrdinal2.day;return Object.assign({year:year,month:month,day:day},timeObject(ordinalData));}
function hasInvalidWeekData(obj){var validYear=isInteger(obj.weekYear),validWeek=integerBetween(obj.weekNumber,1,weeksInWeekYear(obj.weekYear)),validWeekday=integerBetween(obj.weekday,1,7);if(!validYear){return unitOutOfRange("weekYear",obj.weekYear);}else if(!validWeek){return unitOutOfRange("week",obj.week);}else if(!validWeekday){return unitOutOfRange("weekday",obj.weekday);}else return false;}
function hasInvalidOrdinalData(obj){var validYear=isInteger(obj.year),validOrdinal=integerBetween(obj.ordinal,1,daysInYear(obj.year));if(!validYear){return unitOutOfRange("year",obj.year);}else if(!validOrdinal){return unitOutOfRange("ordinal",obj.ordinal);}else return false;}
function hasInvalidGregorianData(obj){var validYear=isInteger(obj.year),validMonth=integerBetween(obj.month,1,12),validDay=integerBetween(obj.day,1,daysInMonth(obj.year,obj.month));if(!validYear){return unitOutOfRange("year",obj.year);}else if(!validMonth){return unitOutOfRange("month",obj.month);}else if(!validDay){return unitOutOfRange("day",obj.day);}else return false;}
function hasInvalidTimeData(obj){var hour=obj.hour,minute=obj.minute,second=obj.second,millisecond=obj.millisecond;var validHour=integerBetween(hour,0,23)||hour===24&&minute===0&&second===0&&millisecond===0,validMinute=integerBetween(minute,0,59),validSecond=integerBetween(second,0,59),validMillisecond=integerBetween(millisecond,0,999);if(!validHour){return unitOutOfRange("hour",hour);}else if(!validMinute){return unitOutOfRange("minute",minute);}else if(!validSecond){return unitOutOfRange("second",second);}else if(!validMillisecond){return unitOutOfRange("millisecond",millisecond);}else return false;}
var INVALID$2="Invalid DateTime";var MAX_DATE=8.64e15;function unsupportedZone(zone){return new Invalid("unsupported zone","the zone \""+zone.name+"\" is not supported");}
function possiblyCachedWeekData(dt){if(dt.weekData===null){dt.weekData=gregorianToWeek(dt.c);}
return dt.weekData;}
function clone$1(inst,alts){var current={ts:inst.ts,zone:inst.zone,c:inst.c,o:inst.o,loc:inst.loc,invalid:inst.invalid};return new DateTime(Object.assign({},current,alts,{old:current}));}
function fixOffset(localTS,o,tz){var utcGuess=localTS-o*60*1000;var o2=tz.offset(utcGuess);if(o===o2){return[utcGuess,o];}
utcGuess-=(o2-o)*60*1000;var o3=tz.offset(utcGuess);if(o2===o3){return[utcGuess,o2];}
return[localTS-Math.min(o2,o3)*60*1000,Math.max(o2,o3)];}
function tsToObj(ts,offset){ts+=offset*60*1000;var d=new Date(ts);return{year:d.getUTCFullYear(),month:d.getUTCMonth()+1,day:d.getUTCDate(),hour:d.getUTCHours(),minute:d.getUTCMinutes(),second:d.getUTCSeconds(),millisecond:d.getUTCMilliseconds()};}
function objToTS(obj,offset,zone){return fixOffset(objToLocalTS(obj),offset,zone);}
function adjustTime(inst,dur){var oPre=inst.o,year=inst.c.year+Math.trunc(dur.years),month=inst.c.month+Math.trunc(dur.months)+Math.trunc(dur.quarters)*3,c=Object.assign({},inst.c,{year:year,month:month,day:Math.min(inst.c.day,daysInMonth(year,month))+Math.trunc(dur.days)+Math.trunc(dur.weeks)*7}),millisToAdd=Duration.fromObject({years:dur.years-Math.trunc(dur.years),quarters:dur.quarters-Math.trunc(dur.quarters),months:dur.months-Math.trunc(dur.months),weeks:dur.weeks-Math.trunc(dur.weeks),days:dur.days-Math.trunc(dur.days),hours:dur.hours,minutes:dur.minutes,seconds:dur.seconds,milliseconds:dur.milliseconds}).as("milliseconds"),localTS=objToLocalTS(c);var _fixOffset=fixOffset(localTS,oPre,inst.zone),ts=_fixOffset[0],o=_fixOffset[1];if(millisToAdd!==0){ts+=millisToAdd;o=inst.zone.offset(ts);}
return{ts:ts,o:o};}
function parseDataToDateTime(parsed,parsedZone,opts,format,text){var setZone=opts.setZone,zone=opts.zone;if(parsed&&Object.keys(parsed).length!==0){var interpretationZone=parsedZone||zone,inst=DateTime.fromObject(Object.assign(parsed,opts,{zone:interpretationZone,setZone:undefined}));return setZone?inst:inst.setZone(zone);}else{return DateTime.invalid(new Invalid("unparsable","the input \""+text+"\" can't be parsed as "+format));}}
function toTechFormat(dt,format,allowZ){if(allowZ===void 0){allowZ=true;}
return dt.isValid?Formatter.create(Locale.create("en-US"),{allowZ:allowZ,forceSimple:true}).formatDateTimeFromString(dt,format):null;}
function toTechTimeFormat(dt,_ref){var _ref$suppressSeconds=_ref.suppressSeconds,suppressSeconds=_ref$suppressSeconds===void 0?false:_ref$suppressSeconds,_ref$suppressMillisec=_ref.suppressMilliseconds,suppressMilliseconds=_ref$suppressMillisec===void 0?false:_ref$suppressMillisec,includeOffset=_ref.includeOffset,_ref$includeZone=_ref.includeZone,includeZone=_ref$includeZone===void 0?false:_ref$includeZone,_ref$spaceZone=_ref.spaceZone,spaceZone=_ref$spaceZone===void 0?false:_ref$spaceZone,_ref$format=_ref.format,format=_ref$format===void 0?"extended":_ref$format;var fmt=format==="basic"?"HHmm":"HH:mm";if(!suppressSeconds||dt.second!==0||dt.millisecond!==0){fmt+=format==="basic"?"ss":":ss";if(!suppressMilliseconds||dt.millisecond!==0){fmt+=".SSS";}}
if((includeZone||includeOffset)&&spaceZone){fmt+=" ";}
if(includeZone){fmt+="z";}else if(includeOffset){fmt+=format==="basic"?"ZZZ":"ZZ";}
return toTechFormat(dt,fmt);}
var defaultUnitValues={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},defaultWeekUnitValues={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},defaultOrdinalUnitValues={ordinal:1,hour:0,minute:0,second:0,millisecond:0};var orderedUnits$1=["year","month","day","hour","minute","second","millisecond"],orderedWeekUnits=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],orderedOrdinalUnits=["year","ordinal","hour","minute","second","millisecond"];function normalizeUnit(unit){var normalized={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[unit.toLowerCase()];if(!normalized)throw new InvalidUnitError(unit);return normalized;}
function quickDT(obj,zone){for(var _iterator=_createForOfIteratorHelperLoose(orderedUnits$1),_step;!(_step=_iterator()).done;){var u=_step.value;if(isUndefined(obj[u])){obj[u]=defaultUnitValues[u];}}
var invalid=hasInvalidGregorianData(obj)||hasInvalidTimeData(obj);if(invalid){return DateTime.invalid(invalid);}
var tsNow=Settings.now(),offsetProvis=zone.offset(tsNow),_objToTS=objToTS(obj,offsetProvis,zone),ts=_objToTS[0],o=_objToTS[1];return new DateTime({ts:ts,zone:zone,o:o});}
function diffRelative(start,end,opts){var round=isUndefined(opts.round)?true:opts.round,format=function format(c,unit){c=roundTo(c,round||opts.calendary?0:2,true);var formatter=end.loc.clone(opts).relFormatter(opts);return formatter.format(c,unit);},differ=function differ(unit){if(opts.calendary){if(!end.hasSame(start,unit)){return end.startOf(unit).diff(start.startOf(unit),unit).get(unit);}else return 0;}else{return end.diff(start,unit).get(unit);}};if(opts.unit){return format(differ(opts.unit),opts.unit);}
for(var _iterator2=_createForOfIteratorHelperLoose(opts.units),_step2;!(_step2=_iterator2()).done;){var unit=_step2.value;var count=differ(unit);if(Math.abs(count)>=1){return format(count,unit);}}
return format(0,opts.units[opts.units.length-1]);}
var DateTime=function(){function DateTime(config){var zone=config.zone||Settings.defaultZone;var invalid=config.invalid||(Number.isNaN(config.ts)?new Invalid("invalid input"):null)||(!zone.isValid?unsupportedZone(zone):null);this.ts=isUndefined(config.ts)?Settings.now():config.ts;var c=null,o=null;if(!invalid){var unchanged=config.old&&config.old.ts===this.ts&&config.old.zone.equals(zone);if(unchanged){var _ref2=[config.old.c,config.old.o];c=_ref2[0];o=_ref2[1];}else{var ot=zone.offset(this.ts);c=tsToObj(this.ts,ot);invalid=Number.isNaN(c.year)?new Invalid("invalid input"):null;c=invalid?null:c;o=invalid?null:ot;}}
this._zone=zone;this.loc=config.loc||Locale.create();this.invalid=invalid;this.weekData=null;this.c=c;this.o=o;this.isLuxonDateTime=true;}
DateTime.local=function local(year,month,day,hour,minute,second,millisecond){if(isUndefined(year)){return new DateTime({ts:Settings.now()});}else{return quickDT({year:year,month:month,day:day,hour:hour,minute:minute,second:second,millisecond:millisecond},Settings.defaultZone);}};DateTime.utc=function utc(year,month,day,hour,minute,second,millisecond){if(isUndefined(year)){return new DateTime({ts:Settings.now(),zone:FixedOffsetZone.utcInstance});}else{return quickDT({year:year,month:month,day:day,hour:hour,minute:minute,second:second,millisecond:millisecond},FixedOffsetZone.utcInstance);}};DateTime.fromJSDate=function fromJSDate(date,options){if(options===void 0){options={};}
var ts=isDate(date)?date.valueOf():NaN;if(Number.isNaN(ts)){return DateTime.invalid("invalid input");}
var zoneToUse=normalizeZone(options.zone,Settings.defaultZone);if(!zoneToUse.isValid){return DateTime.invalid(unsupportedZone(zoneToUse));}
return new DateTime({ts:ts,zone:zoneToUse,loc:Locale.fromObject(options)});};DateTime.fromMillis=function fromMillis(milliseconds,options){if(options===void 0){options={};}
if(!isNumber(milliseconds)){throw new InvalidArgumentError("fromMillis requires a numerical input, but received a "+typeof milliseconds+" with value "+milliseconds);}else if(milliseconds<-MAX_DATE||milliseconds>MAX_DATE){return DateTime.invalid("Timestamp out of range");}else{return new DateTime({ts:milliseconds,zone:normalizeZone(options.zone,Settings.defaultZone),loc:Locale.fromObject(options)});}};DateTime.fromSeconds=function fromSeconds(seconds,options){if(options===void 0){options={};}
if(!isNumber(seconds)){throw new InvalidArgumentError("fromSeconds requires a numerical input");}else{return new DateTime({ts:seconds*1000,zone:normalizeZone(options.zone,Settings.defaultZone),loc:Locale.fromObject(options)});}};DateTime.fromObject=function fromObject(obj){var zoneToUse=normalizeZone(obj.zone,Settings.defaultZone);if(!zoneToUse.isValid){return DateTime.invalid(unsupportedZone(zoneToUse));}
var tsNow=Settings.now(),offsetProvis=zoneToUse.offset(tsNow),normalized=normalizeObject(obj,normalizeUnit,["zone","locale","outputCalendar","numberingSystem"]),containsOrdinal=!isUndefined(normalized.ordinal),containsGregorYear=!isUndefined(normalized.year),containsGregorMD=!isUndefined(normalized.month)||!isUndefined(normalized.day),containsGregor=containsGregorYear||containsGregorMD,definiteWeekDef=normalized.weekYear||normalized.weekNumber,loc=Locale.fromObject(obj);if((containsGregor||containsOrdinal)&&definiteWeekDef){throw new ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");}
if(containsGregorMD&&containsOrdinal){throw new ConflictingSpecificationError("Can't mix ordinal dates with month/day");}
var useWeekData=definiteWeekDef||normalized.weekday&&!containsGregor;var units,defaultValues,objNow=tsToObj(tsNow,offsetProvis);if(useWeekData){units=orderedWeekUnits;defaultValues=defaultWeekUnitValues;objNow=gregorianToWeek(objNow);}else if(containsOrdinal){units=orderedOrdinalUnits;defaultValues=defaultOrdinalUnitValues;objNow=gregorianToOrdinal(objNow);}else{units=orderedUnits$1;defaultValues=defaultUnitValues;}
var foundFirst=false;for(var _iterator3=_createForOfIteratorHelperLoose(units),_step3;!(_step3=_iterator3()).done;){var u=_step3.value;var v=normalized[u];if(!isUndefined(v)){foundFirst=true;}else if(foundFirst){normalized[u]=defaultValues[u];}else{normalized[u]=objNow[u];}}
var higherOrderInvalid=useWeekData?hasInvalidWeekData(normalized):containsOrdinal?hasInvalidOrdinalData(normalized):hasInvalidGregorianData(normalized),invalid=higherOrderInvalid||hasInvalidTimeData(normalized);if(invalid){return DateTime.invalid(invalid);}
var gregorian=useWeekData?weekToGregorian(normalized):containsOrdinal?ordinalToGregorian(normalized):normalized,_objToTS2=objToTS(gregorian,offsetProvis,zoneToUse),tsFinal=_objToTS2[0],offsetFinal=_objToTS2[1],inst=new DateTime({ts:tsFinal,zone:zoneToUse,o:offsetFinal,loc:loc});if(normalized.weekday&&containsGregor&&obj.weekday!==inst.weekday){return DateTime.invalid("mismatched weekday","you can't specify both a weekday of "+normalized.weekday+" and a date of "+inst.toISO());}
return inst;};DateTime.fromISO=function fromISO(text,opts){if(opts===void 0){opts={};}
var _parseISODate=parseISODate(text),vals=_parseISODate[0],parsedZone=_parseISODate[1];return parseDataToDateTime(vals,parsedZone,opts,"ISO 8601",text);};DateTime.fromRFC2822=function fromRFC2822(text,opts){if(opts===void 0){opts={};}
var _parseRFC2822Date=parseRFC2822Date(text),vals=_parseRFC2822Date[0],parsedZone=_parseRFC2822Date[1];return parseDataToDateTime(vals,parsedZone,opts,"RFC 2822",text);};DateTime.fromHTTP=function fromHTTP(text,opts){if(opts===void 0){opts={};}
var _parseHTTPDate=parseHTTPDate(text),vals=_parseHTTPDate[0],parsedZone=_parseHTTPDate[1];return parseDataToDateTime(vals,parsedZone,opts,"HTTP",opts);};DateTime.fromFormat=function fromFormat(text,fmt,opts){if(opts===void 0){opts={};}
if(isUndefined(text)||isUndefined(fmt)){throw new InvalidArgumentError("fromFormat requires an input string and a format");}
var _opts=opts,_opts$locale=_opts.locale,locale=_opts$locale===void 0?null:_opts$locale,_opts$numberingSystem=_opts.numberingSystem,numberingSystem=_opts$numberingSystem===void 0?null:_opts$numberingSystem,localeToUse=Locale.fromOpts({locale:locale,numberingSystem:numberingSystem,defaultToEN:true}),_parseFromTokens=parseFromTokens(localeToUse,text,fmt),vals=_parseFromTokens[0],parsedZone=_parseFromTokens[1],invalid=_parseFromTokens[2];if(invalid){return DateTime.invalid(invalid);}else{return parseDataToDateTime(vals,parsedZone,opts,"format "+fmt,text);}};DateTime.fromString=function fromString(text,fmt,opts){if(opts===void 0){opts={};}
return DateTime.fromFormat(text,fmt,opts);};DateTime.fromSQL=function fromSQL(text,opts){if(opts===void 0){opts={};}
var _parseSQL=parseSQL(text),vals=_parseSQL[0],parsedZone=_parseSQL[1];return parseDataToDateTime(vals,parsedZone,opts,"SQL",text);};DateTime.invalid=function invalid(reason,explanation){if(explanation===void 0){explanation=null;}
if(!reason){throw new InvalidArgumentError("need to specify a reason the DateTime is invalid");}
var invalid=reason instanceof Invalid?reason:new Invalid(reason,explanation);if(Settings.throwOnInvalid){throw new InvalidDateTimeError(invalid);}else{return new DateTime({invalid:invalid});}};DateTime.isDateTime=function isDateTime(o){return o&&o.isLuxonDateTime||false;};var _proto=DateTime.prototype;_proto.get=function get(unit){return this[unit];};_proto.resolvedLocaleOpts=function resolvedLocaleOpts(opts){if(opts===void 0){opts={};}
var _Formatter$create$res=Formatter.create(this.loc.clone(opts),opts).resolvedOptions(this),locale=_Formatter$create$res.locale,numberingSystem=_Formatter$create$res.numberingSystem,calendar=_Formatter$create$res.calendar;return{locale:locale,numberingSystem:numberingSystem,outputCalendar:calendar};};_proto.toUTC=function toUTC(offset,opts){if(offset===void 0){offset=0;}
if(opts===void 0){opts={};}
return this.setZone(FixedOffsetZone.instance(offset),opts);};_proto.toLocal=function toLocal(){return this.setZone(Settings.defaultZone);};_proto.setZone=function setZone(zone,_temp){var _ref3=_temp===void 0?{}:_temp,_ref3$keepLocalTime=_ref3.keepLocalTime,keepLocalTime=_ref3$keepLocalTime===void 0?false:_ref3$keepLocalTime,_ref3$keepCalendarTim=_ref3.keepCalendarTime,keepCalendarTime=_ref3$keepCalendarTim===void 0?false:_ref3$keepCalendarTim;zone=normalizeZone(zone,Settings.defaultZone);if(zone.equals(this.zone)){return this;}else if(!zone.isValid){return DateTime.invalid(unsupportedZone(zone));}else{var newTS=this.ts;if(keepLocalTime||keepCalendarTime){var offsetGuess=zone.offset(this.ts);var asObj=this.toObject();var _objToTS3=objToTS(asObj,offsetGuess,zone);newTS=_objToTS3[0];}
return clone$1(this,{ts:newTS,zone:zone});}};_proto.reconfigure=function reconfigure(_temp2){var _ref4=_temp2===void 0?{}:_temp2,locale=_ref4.locale,numberingSystem=_ref4.numberingSystem,outputCalendar=_ref4.outputCalendar;var loc=this.loc.clone({locale:locale,numberingSystem:numberingSystem,outputCalendar:outputCalendar});return clone$1(this,{loc:loc});};_proto.setLocale=function setLocale(locale){return this.reconfigure({locale:locale});};_proto.set=function set(values){if(!this.isValid)return this;var normalized=normalizeObject(values,normalizeUnit,[]),settingWeekStuff=!isUndefined(normalized.weekYear)||!isUndefined(normalized.weekNumber)||!isUndefined(normalized.weekday);var mixed;if(settingWeekStuff){mixed=weekToGregorian(Object.assign(gregorianToWeek(this.c),normalized));}else if(!isUndefined(normalized.ordinal)){mixed=ordinalToGregorian(Object.assign(gregorianToOrdinal(this.c),normalized));}else{mixed=Object.assign(this.toObject(),normalized);if(isUndefined(normalized.day)){mixed.day=Math.min(daysInMonth(mixed.year,mixed.month),mixed.day);}}
var _objToTS4=objToTS(mixed,this.o,this.zone),ts=_objToTS4[0],o=_objToTS4[1];return clone$1(this,{ts:ts,o:o});};_proto.plus=function plus(duration){if(!this.isValid)return this;var dur=friendlyDuration(duration);return clone$1(this,adjustTime(this,dur));};_proto.minus=function minus(duration){if(!this.isValid)return this;var dur=friendlyDuration(duration).negate();return clone$1(this,adjustTime(this,dur));};_proto.startOf=function startOf(unit){if(!this.isValid)return this;var o={},normalizedUnit=Duration.normalizeUnit(unit);switch(normalizedUnit){case"years":o.month=1;case"quarters":case"months":o.day=1;case"weeks":case"days":o.hour=0;case"hours":o.minute=0;case"minutes":o.second=0;case"seconds":o.millisecond=0;break;}
if(normalizedUnit==="weeks"){o.weekday=1;}
if(normalizedUnit==="quarters"){var q=Math.ceil(this.month/3);o.month=(q-1)*3+1;}
return this.set(o);};_proto.endOf=function endOf(unit){var _this$plus;return this.isValid?this.plus((_this$plus={},_this$plus[unit]=1,_this$plus)).startOf(unit).minus(1):this;};_proto.toFormat=function toFormat(fmt,opts){if(opts===void 0){opts={};}
return this.isValid?Formatter.create(this.loc.redefaultToEN(opts)).formatDateTimeFromString(this,fmt):INVALID$2;};_proto.toLocaleString=function toLocaleString(opts){if(opts===void 0){opts=DATE_SHORT;}
return this.isValid?Formatter.create(this.loc.clone(opts),opts).formatDateTime(this):INVALID$2;};_proto.toLocaleParts=function toLocaleParts(opts){if(opts===void 0){opts={};}
return this.isValid?Formatter.create(this.loc.clone(opts),opts).formatDateTimeParts(this):[];};_proto.toISO=function toISO(opts){if(opts===void 0){opts={};}
if(!this.isValid){return null;}
return this.toISODate(opts)+"T"+this.toISOTime(opts);};_proto.toISODate=function toISODate(_temp3){var _ref5=_temp3===void 0?{}:_temp3,_ref5$format=_ref5.format,format=_ref5$format===void 0?"extended":_ref5$format;var fmt=format==="basic"?"yyyyMMdd":"yyyy-MM-dd";if(this.year>9999){fmt="+"+fmt;}
return toTechFormat(this,fmt);};_proto.toISOWeekDate=function toISOWeekDate(){return toTechFormat(this,"kkkk-'W'WW-c");};_proto.toISOTime=function toISOTime(_temp4){var _ref6=_temp4===void 0?{}:_temp4,_ref6$suppressMillise=_ref6.suppressMilliseconds,suppressMilliseconds=_ref6$suppressMillise===void 0?false:_ref6$suppressMillise,_ref6$suppressSeconds=_ref6.suppressSeconds,suppressSeconds=_ref6$suppressSeconds===void 0?false:_ref6$suppressSeconds,_ref6$includeOffset=_ref6.includeOffset,includeOffset=_ref6$includeOffset===void 0?true:_ref6$includeOffset,_ref6$format=_ref6.format,format=_ref6$format===void 0?"extended":_ref6$format;return toTechTimeFormat(this,{suppressSeconds:suppressSeconds,suppressMilliseconds:suppressMilliseconds,includeOffset:includeOffset,format:format});};_proto.toRFC2822=function toRFC2822(){return toTechFormat(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",false);};_proto.toHTTP=function toHTTP(){return toTechFormat(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'");};_proto.toSQLDate=function toSQLDate(){return toTechFormat(this,"yyyy-MM-dd");};_proto.toSQLTime=function toSQLTime(_temp5){var _ref7=_temp5===void 0?{}:_temp5,_ref7$includeOffset=_ref7.includeOffset,includeOffset=_ref7$includeOffset===void 0?true:_ref7$includeOffset,_ref7$includeZone=_ref7.includeZone,includeZone=_ref7$includeZone===void 0?false:_ref7$includeZone;return toTechTimeFormat(this,{includeOffset:includeOffset,includeZone:includeZone,spaceZone:true});};_proto.toSQL=function toSQL(opts){if(opts===void 0){opts={};}
if(!this.isValid){return null;}
return this.toSQLDate()+" "+this.toSQLTime(opts);};_proto.toString=function toString(){return this.isValid?this.toISO():INVALID$2;};_proto.valueOf=function valueOf(){return this.toMillis();};_proto.toMillis=function toMillis(){return this.isValid?this.ts:NaN;};_proto.toSeconds=function toSeconds(){return this.isValid?this.ts/1000:NaN;};_proto.toJSON=function toJSON(){return this.toISO();};_proto.toBSON=function toBSON(){return this.toJSDate();};_proto.toObject=function toObject(opts){if(opts===void 0){opts={};}
if(!this.isValid)return{};var base=Object.assign({},this.c);if(opts.includeConfig){base.outputCalendar=this.outputCalendar;base.numberingSystem=this.loc.numberingSystem;base.locale=this.loc.locale;}
return base;};_proto.toJSDate=function toJSDate(){return new Date(this.isValid?this.ts:NaN);};_proto.diff=function diff(otherDateTime,unit,opts){if(unit===void 0){unit="milliseconds";}
if(opts===void 0){opts={};}
if(!this.isValid||!otherDateTime.isValid){return Duration.invalid(this.invalid||otherDateTime.invalid,"created by diffing an invalid DateTime");}
var durOpts=Object.assign({locale:this.locale,numberingSystem:this.numberingSystem},opts);var units=maybeArray(unit).map(Duration.normalizeUnit),otherIsLater=otherDateTime.valueOf()>this.valueOf(),earlier=otherIsLater?this:otherDateTime,later=otherIsLater?otherDateTime:this,diffed=_diff(earlier,later,units,durOpts);return otherIsLater?diffed.negate():diffed;};_proto.diffNow=function diffNow(unit,opts){if(unit===void 0){unit="milliseconds";}
if(opts===void 0){opts={};}
return this.diff(DateTime.local(),unit,opts);};_proto.until=function until(otherDateTime){return this.isValid?Interval.fromDateTimes(this,otherDateTime):this;};_proto.hasSame=function hasSame(otherDateTime,unit){if(!this.isValid)return false;if(unit==="millisecond"){return this.valueOf()===otherDateTime.valueOf();}else{var inputMs=otherDateTime.valueOf();return this.startOf(unit)<=inputMs&&inputMs<=this.endOf(unit);}};_proto.equals=function equals(other){return this.isValid&&other.isValid&&this.valueOf()===other.valueOf()&&this.zone.equals(other.zone)&&this.loc.equals(other.loc);};_proto.toRelative=function toRelative(options){if(options===void 0){options={};}
if(!this.isValid)return null;var base=options.base||DateTime.fromObject({zone:this.zone}),padding=options.padding?this<base?-options.padding:options.padding:0;return diffRelative(base,this.plus(padding),Object.assign(options,{numeric:"always",units:["years","months","days","hours","minutes","seconds"]}));};_proto.toRelativeCalendar=function toRelativeCalendar(options){if(options===void 0){options={};}
if(!this.isValid)return null;return diffRelative(options.base||DateTime.fromObject({zone:this.zone}),this,Object.assign(options,{numeric:"auto",units:["years","months","days"],calendary:true}));};DateTime.min=function min(){for(var _len=arguments.length,dateTimes=new Array(_len),_key=0;_key<_len;_key++){dateTimes[_key]=arguments[_key];}
if(!dateTimes.every(DateTime.isDateTime)){throw new InvalidArgumentError("min requires all arguments be DateTimes");}
return bestBy(dateTimes,function(i){return i.valueOf();},Math.min);};DateTime.max=function max(){for(var _len2=arguments.length,dateTimes=new Array(_len2),_key2=0;_key2<_len2;_key2++){dateTimes[_key2]=arguments[_key2];}
if(!dateTimes.every(DateTime.isDateTime)){throw new InvalidArgumentError("max requires all arguments be DateTimes");}
return bestBy(dateTimes,function(i){return i.valueOf();},Math.max);};DateTime.fromFormatExplain=function fromFormatExplain(text,fmt,options){if(options===void 0){options={};}
var _options=options,_options$locale=_options.locale,locale=_options$locale===void 0?null:_options$locale,_options$numberingSys=_options.numberingSystem,numberingSystem=_options$numberingSys===void 0?null:_options$numberingSys,localeToUse=Locale.fromOpts({locale:locale,numberingSystem:numberingSystem,defaultToEN:true});return explainFromTokens(localeToUse,text,fmt);};DateTime.fromStringExplain=function fromStringExplain(text,fmt,options){if(options===void 0){options={};}
return DateTime.fromFormatExplain(text,fmt,options);};_createClass(DateTime,[{key:"isValid",get:function get(){return this.invalid===null;}},{key:"invalidReason",get:function get(){return this.invalid?this.invalid.reason:null;}},{key:"invalidExplanation",get:function get(){return this.invalid?this.invalid.explanation:null;}},{key:"locale",get:function get(){return this.isValid?this.loc.locale:null;}},{key:"numberingSystem",get:function get(){return this.isValid?this.loc.numberingSystem:null;}},{key:"outputCalendar",get:function get(){return this.isValid?this.loc.outputCalendar:null;}},{key:"zone",get:function get(){return this._zone;}},{key:"zoneName",get:function get(){return this.isValid?this.zone.name:null;}},{key:"year",get:function get(){return this.isValid?this.c.year:NaN;}},{key:"quarter",get:function get(){return this.isValid?Math.ceil(this.c.month/3):NaN;}},{key:"month",get:function get(){return this.isValid?this.c.month:NaN;}},{key:"day",get:function get(){return this.isValid?this.c.day:NaN;}},{key:"hour",get:function get(){return this.isValid?this.c.hour:NaN;}},{key:"minute",get:function get(){return this.isValid?this.c.minute:NaN;}},{key:"second",get:function get(){return this.isValid?this.c.second:NaN;}},{key:"millisecond",get:function get(){return this.isValid?this.c.millisecond:NaN;}},{key:"weekYear",get:function get(){return this.isValid?possiblyCachedWeekData(this).weekYear:NaN;}},{key:"weekNumber",get:function get(){return this.isValid?possiblyCachedWeekData(this).weekNumber:NaN;}},{key:"weekday",get:function get(){return this.isValid?possiblyCachedWeekData(this).weekday:NaN;}},{key:"ordinal",get:function get(){return this.isValid?gregorianToOrdinal(this.c).ordinal:NaN;}},{key:"monthShort",get:function get(){return this.isValid?Info.months("short",{locale:this.locale})[this.month-1]:null;}},{key:"monthLong",get:function get(){return this.isValid?Info.months("long",{locale:this.locale})[this.month-1]:null;}},{key:"weekdayShort",get:function get(){return this.isValid?Info.weekdays("short",{locale:this.locale})[this.weekday-1]:null;}},{key:"weekdayLong",get:function get(){return this.isValid?Info.weekdays("long",{locale:this.locale})[this.weekday-1]:null;}},{key:"offset",get:function get(){return this.isValid?+this.o:NaN;}},{key:"offsetNameShort",get:function get(){if(this.isValid){return this.zone.offsetName(this.ts,{format:"short",locale:this.locale});}else{return null;}}},{key:"offsetNameLong",get:function get(){if(this.isValid){return this.zone.offsetName(this.ts,{format:"long",locale:this.locale});}else{return null;}}},{key:"isOffsetFixed",get:function get(){return this.isValid?this.zone.universal:null;}},{key:"isInDST",get:function get(){if(this.isOffsetFixed){return false;}else{return this.offset>this.set({month:1}).offset||this.offset>this.set({month:5}).offset;}}},{key:"isInLeapYear",get:function get(){return isLeapYear(this.year);}},{key:"daysInMonth",get:function get(){return daysInMonth(this.year,this.month);}},{key:"daysInYear",get:function get(){return this.isValid?daysInYear(this.year):NaN;}},{key:"weeksInWeekYear",get:function get(){return this.isValid?weeksInWeekYear(this.weekYear):NaN;}}],[{key:"DATE_SHORT",get:function get(){return DATE_SHORT;}},{key:"DATE_MED",get:function get(){return DATE_MED;}},{key:"DATE_MED_WITH_WEEKDAY",get:function get(){return DATE_MED_WITH_WEEKDAY;}},{key:"DATE_FULL",get:function get(){return DATE_FULL;}},{key:"DATE_HUGE",get:function get(){return DATE_HUGE;}},{key:"TIME_SIMPLE",get:function get(){return TIME_SIMPLE;}},{key:"TIME_WITH_SECONDS",get:function get(){return TIME_WITH_SECONDS;}},{key:"TIME_WITH_SHORT_OFFSET",get:function get(){return TIME_WITH_SHORT_OFFSET;}},{key:"TIME_WITH_LONG_OFFSET",get:function get(){return TIME_WITH_LONG_OFFSET;}},{key:"TIME_24_SIMPLE",get:function get(){return TIME_24_SIMPLE;}},{key:"TIME_24_WITH_SECONDS",get:function get(){return TIME_24_WITH_SECONDS;}},{key:"TIME_24_WITH_SHORT_OFFSET",get:function get(){return TIME_24_WITH_SHORT_OFFSET;}},{key:"TIME_24_WITH_LONG_OFFSET",get:function get(){return TIME_24_WITH_LONG_OFFSET;}},{key:"DATETIME_SHORT",get:function get(){return DATETIME_SHORT;}},{key:"DATETIME_SHORT_WITH_SECONDS",get:function get(){return DATETIME_SHORT_WITH_SECONDS;}},{key:"DATETIME_MED",get:function get(){return DATETIME_MED;}},{key:"DATETIME_MED_WITH_SECONDS",get:function get(){return DATETIME_MED_WITH_SECONDS;}},{key:"DATETIME_MED_WITH_WEEKDAY",get:function get(){return DATETIME_MED_WITH_WEEKDAY;}},{key:"DATETIME_FULL",get:function get(){return DATETIME_FULL;}},{key:"DATETIME_FULL_WITH_SECONDS",get:function get(){return DATETIME_FULL_WITH_SECONDS;}},{key:"DATETIME_HUGE",get:function get(){return DATETIME_HUGE;}},{key:"DATETIME_HUGE_WITH_SECONDS",get:function get(){return DATETIME_HUGE_WITH_SECONDS;}}]);return DateTime;}();function friendlyDateTime(dateTimeish){if(DateTime.isDateTime(dateTimeish)){return dateTimeish;}else if(dateTimeish&&dateTimeish.valueOf&&isNumber(dateTimeish.valueOf())){return DateTime.fromJSDate(dateTimeish);}else if(dateTimeish&&typeof dateTimeish==="object"){return DateTime.fromObject(dateTimeish);}else{throw new InvalidArgumentError("Unknown datetime argument: "+dateTimeish+", of type "+typeof dateTimeish);}}
exports.DateTime=DateTime;exports.Duration=Duration;exports.FixedOffsetZone=FixedOffsetZone;exports.IANAZone=IANAZone;exports.Info=Info;exports.Interval=Interval;exports.InvalidZone=InvalidZone;exports.LocalZone=LocalZone;exports.Settings=Settings;exports.Zone=Zone;return exports;}({}));;

/* /web/static/lib/py.js/lib/py.js defined in bundle 'web.assets_backend' */
var py={};(function(py){var create=function(o,props){function F(){}
F.prototype=o;var inst=new F;if(props){for(var name in props){if(!props.hasOwnProperty(name)){continue;}
inst[name]=props[name];}}
return inst;};var symbols={};var comparators={};var Base={nud:function(){throw new Error(this.id+" undefined as prefix");},led:function(led){throw new Error(this.id+" undefined as infix");},toString:function(){if(this.id==='(constant)'||this.id==='(number)'||this.id==='(name)'||this.id==='(string)'){return[this.id.slice(0,this.id.length-1),' ',this.value,')'].join('');}else if(this.id==='(end)'){return'(end)';}else if(this.id==='(comparator)'){var repr=['(comparator',this.expressions[0]];for(var i=0;i<this.operators.length;++i){repr.push(this.operators[i],this.expressions[i+1]);}
return repr.join(' ')+')';}
var out=[this.id,this.first,this.second,this.third].filter(function(r){return r}).join(' ');return'('+out+')';}};function symbol(id,bp){bp=bp||0;var s=symbols[id];if(s){if(bp>s.lbp){s.lbp=bp;}
return s;}
return symbols[id]=create(Base,{id:id,lbp:bp});}
function constant(id){var s=symbol(id);s.id='(constant)';s.value=id;s.nud=function(){return this;};}
function prefix(id,bp,nud){symbol(id).nud=nud||function(){this.first=expression(bp);return this}}
function infix(id,bp,led){symbol(id,bp).led=led||function(left){this.first=left;this.second=expression(bp);return this;}}
function infixr(id,bp){symbol(id,bp).led=function(left){this.first=left;this.second=expression(bp-1);return this;}}
function comparator(id){comparators[id]=true;var bp=60;infix(id,bp,function(left){this.id='(comparator)';this.operators=[id];this.expressions=[left,expression(bp)];while(token.id in comparators){this.operators.push(token.id);advance();this.expressions.push(expression(bp));}
return this;});}
constant('None');constant('False');constant('True');symbol('(number)').nud=function(){return this;};symbol('(name)').nud=function(){return this;};symbol('(string)').nud=function(){return this;};symbol('(end)');symbol(':');symbol(')');symbol(']');symbol('}');symbol(',');symbol('else');infix('=',10,function(left){if(left.id!=='(name)'){throw new Error("Expected keyword argument name, got "+token.id);}
this.first=left;this.second=expression();return this;});symbol('lambda',20).nud=function(){this.first=[];if(token.id!==':'){for(;;){if(token.id!=='(name)'){throw new Error('Excepted an argument name');}
this.first.push(token);advance();if(token.id!==','){break;}
advance(',');}}
advance(':');this.second=expression();return this;};infix('if',20,function(left){this.ifTrue=left;this.condition=expression();advance('else');this.ifFalse=expression();return this;});infixr('or',30);infixr('and',40);prefix('not',50);comparator('in');comparator('not in');comparator('is');comparator('is not');comparator('<');comparator('<=');comparator('>');comparator('>=');comparator('<>');comparator('!=');comparator('==');infix('|',70);infix('^',80);infix('&',90);infix('<<',100);infix('>>',100);infix('+',110);infix('-',110);infix('*',120);infix('/',120);infix('//',120);infix('%',120);prefix('-',130);prefix('+',130);prefix('~',130);infixr('**',140);infix('.',150,function(left){if(token.id!=='(name)'){throw new Error('Expected attribute name, got '+token.id);}
this.first=left;this.second=token;advance();return this;});symbol('(',150).nud=function(){this.first=[];var comma=false;if(token.id!==')'){while(true){if(token.id===')'){break;}
this.first.push(expression());if(token.id!==','){break;}
comma=true;advance(',');}}
advance(')');if(!this.first.length||comma){return this;}else{return this.first[0];}};symbol('(').led=function(left){this.first=left;this.second=[];if(token.id!==")"){for(;;){this.second.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(")");return this;};infix('[',150,function(left){this.first=left;this.second=expression();advance("]");return this;});symbol('[').nud=function(){this.first=[];if(token.id!==']'){for(;;){if(token.id===']'){break;}
this.first.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(']');return this;};symbol('{').nud=function(){this.first=[];if(token.id!=='}'){for(;;){if(token.id==='}'){break;}
var key=expression();advance(':');var value=expression();this.first.push([key,value]);if(token.id!==','){break;}
advance(',');}}
advance('}');return this;};py.tokenize=(function(){function group(){return'('+Array.prototype.join.call(arguments,'|')+')';}
var Whitespace='[ \\f\\t]*';var Name='[a-zA-Z_]\\w*';var DecNumber='\\d+(L|l)?';var IntNumber=DecNumber;var PointFloat=group('\\d+\\.\\d*','\\.\\d+');var FloatNumber=PointFloat;var Number=group(FloatNumber,IntNumber);var Operator=group("\\*\\*=?",">>=?","<<=?","<>","!=","//=?","[+\\-*/%&|^=<>]=?","~");var Bracket='[\\[\\]\\(\\)\\{\\}]';var Special='[:;.,`@]';var Funny=group(Operator,Bracket,Special);var ContStr=group("([uU])?'([^\n'\\\\]*(?:\\\\.[^\n'\\\\]*)*)'",'([uU])?"([^\n"\\\\]*(?:\\\\.[^\n"\\\\]*)*)"');var PseudoToken=Whitespace+group(Number,Funny,ContStr,Name);var number_pattern=new RegExp('^'+Number+'$');var string_pattern=new RegExp('^'+ContStr+'$');var name_pattern=new RegExp('^'+Name+'$');var strip=new RegExp('^'+Whitespace);return function tokenize(s){var max=s.length,tokens=[],start,end;var pseudoprog=new RegExp(PseudoToken,'g');while(pseudoprog.lastIndex<max){var pseudomatch=pseudoprog.exec(s);if(!pseudomatch){if(/^\s+$/.test(s.slice(end))){break;}
throw new Error('Failed to tokenize <<'+s
+'>> at index '+(end||0)
+'; parsed so far: '+tokens);}
start=pseudomatch.index;end=pseudoprog.lastIndex;var token=s.slice(start,end).replace(strip,'');if(number_pattern.test(token)){tokens.push(create(symbols['(number)'],{value:parseFloat(token)}));}else if(string_pattern.test(token)){var m=string_pattern.exec(token);tokens.push(create(symbols['(string)'],{value:PY_decode_string_literal(m[3]!==undefined?m[3]:m[5],!!(m[2]||m[4]))}));}else if(token in symbols){var symbol;if(token==='in'&&tokens.length>1&&tokens[tokens.length-1].id==='not'){symbol=symbols['not in'];tokens.pop();}else if(token==='not'&&tokens.length>1&&tokens[tokens.length-1].id==='is'){symbol=symbols['is not'];tokens.pop();}else{symbol=symbols[token];}
tokens.push(create(symbol));}else if(name_pattern.test(token)){tokens.push(create(symbols['(name)'],{value:token}));}else{throw new Error("Tokenizing failure of <<"+s+">> at index "+start
+" for token [["+token+"]]"
+"; parsed so far: "+tokens);}}
tokens.push(create(symbols['(end)']));return tokens;}})();var token,next;function expression(rbp){rbp=rbp||0;var t=token;token=next();var left=t.nud();while(rbp<token.lbp){t=token;token=next();left=t.led(left);}
return left;}
function advance(id){if(id&&token.id!==id){throw new Error('Expected "'+id+'", got "'+token.id+'"');}
token=next();}
function PY_ensurepy(val,name){switch(val){case undefined:throw new Error("NameError: name '"+name+"' is not defined");case null:return py.None;case true:return py.True;case false:return py.False;}
var fn=function(){};fn.prototype=py.object;if(py.PY_isInstance(val,py.object)||py.PY_isSubclass(val,py.object)){return val;}
switch(typeof val){case'number':return py.float.fromJSON(val);case'string':return py.str.fromJSON(val);case'function':return py.PY_def.fromJSON(val);}
switch(val.constructor){case Object:var o=py.PY_call(py.object);for(var prop in val){if(val.hasOwnProperty(prop)){o[prop]=val[prop];}}
return o;case Array:return py.list.fromJSON(val);}
throw new Error("Could not convert "+val+" to a pyval");}
var typename=function(obj){if(obj.__class__){return obj.__class__.__name__;}else if(typeof obj!=='object'){return typeof obj;}else{return obj.constructor.name;}};py.py={};py.PY_parseArgs=function PY_parseArgs(argument,format){var out={};var args=argument[0];var kwargs={};for(var k in argument[1]){if(!argument[1].hasOwnProperty(k)){continue;}
kwargs[k]=argument[1][k];}
if(typeof format==='string'){format=format.split(/\s+/);}
var name=function(spec){if(typeof spec==='string'){return spec;}else if(spec instanceof Array&&spec.length===2){return spec[0];}
throw new Error("TypeError: unknown format specification "+
JSON.stringify(spec));};var spec;for(var i=0;i<args.length;++i){spec=format[i];if(!spec||spec==='*'){throw new Error("TypeError: function takes exactly "+(i-1)+" positional arguments ("+args.length+" given")}else if(/^\*\w/.test(spec)){out[name(spec.slice(1))]=args.slice(i);break;}
out[name(spec)]=args[i];}
for(var j=i;j<format.length;++j){spec=format[j];var n=name(spec);if(n in out){throw new Error("TypeError: function got multiple values "+"for keyword argument '"+kwarg+"'");}
if(/^\*\*\w/.test(n)){out[n.slice(2)]=kwargs;kwargs={};break;}
if(n in kwargs){out[n]=kwargs[n];delete kwargs[n];}}
for(var key in kwargs){throw new Error("TypeError: function got an unexpected keyword argument '"
+key+"'");}
var kwonly=0;for(var k=0;k<format.length;++k){if(/^\*/.test(format[k])){kwonly=1;break;}}
for(var k=0;k<format.length;++k){spec=format[k];var n=name(spec);if(/^\*/.test(n)||n in out){continue;}
if(!(spec instanceof Array)){throw new Error("TypeError: function takes exactly "+(format.length-kwonly)
+" arguments");}
out[n]=spec[1];}
return out;};py.PY_hasAttr=function(o,attr_name){try{py.PY_getAttr(o,attr_name);return true;}catch(e){return false;}};py.PY_getAttr=function(o,attr_name){return PY_ensurepy(o.__getattribute__(attr_name));};py.PY_str=function(o){var v=o.__str__();if(py.PY_isInstance(v,py.str)){return v;}
throw new Error('TypeError: __str__ returned non-string (type '
+typename(v)
+')');};py.PY_isInstance=function(inst,cls){var fn=function(){};fn.prototype=cls;return inst instanceof fn;};py.PY_isSubclass=function(derived,cls){var fn=function(){};fn.prototype=cls;return derived===cls||derived instanceof fn;};py.PY_call=function(callable,args,kwargs){if(!args){args=[];}
if(typeof args==='object'&&!(args instanceof Array)){kwargs=args;args=[];}
if(!kwargs){kwargs={};}
if(callable.__is_type){var instance=callable.__new__.call(callable,args,kwargs);var typ=function(){};typ.prototype=callable;if(instance instanceof typ){instance.__init__.call(instance,args,kwargs);}
return instance}
return callable.__call__(args,kwargs);};py.PY_isTrue=function(o){var res=o.__nonzero__();if(res===py.True){return true;}
if(res===py.False){return false;}
throw new Error("TypeError: __nonzero__ should return bool, returned "
+typename(res));};py.PY_not=function(o){return!py.PY_isTrue(o);};py.PY_size=function(o){if(!o.__len__){throw new Error("TypeError: object of type '"+
typename(o)+"' has no len()");}
var v=o.__len__();if(typeof v!=='number'){throw new Error("TypeError: a number is required");}
return v;};py.PY_getItem=function(o,key){if(!('__getitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object is unsubscriptable")}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
var res=o.__getitem__(key);if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: __getitem__ must return a py.js object, got "
+typename(res));}
return res;};py.PY_setItem=function(o,key,v){if(!('__setitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object does not support item assignment");}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
if(!py.PY_isInstance(v,py.object)){throw new Error("TypeError: '"+typename(v)+"' is not a py.js object");}
o.__setitem__(key,v);};py.PY_add=function(o1,o2){return PY_op(o1,o2,'+');};py.PY_subtract=function(o1,o2){return PY_op(o1,o2,'-');};py.PY_multiply=function(o1,o2){return PY_op(o1,o2,'*');};py.PY_divide=function(o1,o2){return PY_op(o1,o2,'/');};py.PY_negative=function(o){if(!o.__neg__){throw new Error("TypeError: bad operand for unary -: '"
+typename(o)
+"'");}
return o.__neg__();};py.PY_positive=function(o){if(!o.__pos__){throw new Error("TypeError: bad operand for unary +: '"
+typename(o)
+"'");}
return o.__pos__();};py.type=function type(name,bases,dict){if(typeof name!=='string'){throw new Error("ValueError: a class name should be a string");}
if(!bases||bases.length===0){bases=[py.object];}else if(bases.length>1){throw new Error("ValueError: can't provide multiple bases for a "
+"new type");}
var base=bases[0];var ClassObj=create(base);if(dict){for(var k in dict){if(!dict.hasOwnProperty(k)){continue;}
ClassObj[k]=dict[k];}}
ClassObj.__class__=ClassObj;ClassObj.__name__=name;ClassObj.__bases__=bases;ClassObj.__is_type=true;return ClassObj;};py.type.__call__=function(){var args=py.PY_parseArgs(arguments,['object']);return args.object.__class__;};var hash_counter=0;py.object=py.type('object',[{}],{__new__:function(){var inst=create(this);inst.__is_type=false;return inst;},__init__:function(){},__hash__:function(){if(this._hash){return this._hash;}
return this._hash='\0\0\0'+String(hash_counter++);},__eq__:function(other){return(this===other)?py.True:py.False;},__ne__:function(other){if(py.PY_isTrue(this.__eq__(other))){return py.False;}else{return py.True;}},__lt__:function(){return py.NotImplemented;},__le__:function(){return py.NotImplemented;},__ge__:function(){return py.NotImplemented;},__gt__:function(){return py.NotImplemented;},__str__:function(){return this.__unicode__();},__unicode__:function(){return py.str.fromJSON('<'+typename(this)+' object>');},__nonzero__:function(){return py.True;},__getattribute__:function(name){if(name in this){var val=this[name];if(typeof val==='object'&&'__get__'in val){return val.__get__(this,py.PY_call(py.type,[this]));}
if(typeof val==='function'&&!this.hasOwnProperty(name)){return PY_instancemethod.fromJSON(val,this);}
return val;}
if('__getattr__'in this){return this.__getattr__(name);}
throw new Error("AttributeError: object has no attribute '"+name+"'");},__setattr__:function(name,value){if(name in this&&'__set__'in this[name]){this[name].__set__(this,value);}
this[name]=value;},toJSON:function(){throw new Error(this.constructor.name+' can not be converted to JSON');}});var NoneType=py.type('NoneType',null,{__nonzero__:function(){return py.False;},toJSON:function(){return null;}});py.None=py.PY_call(NoneType);var NotImplementedType=py.type('NotImplementedType',null,{});py.NotImplemented=py.PY_call(NotImplementedType);var booleans_initialized=false;py.bool=py.type('bool',null,{__new__:function(){if(!booleans_initialized){return py.object.__new__.apply(this);}
var ph={};var args=py.PY_parseArgs(arguments,[['value',ph]]);if(args.value===ph){return py.False;}
return py.PY_isTrue(args.value)?py.True:py.False;},__str__:function(){return py.str.fromJSON((this===py.True)?"True":"False");},__nonzero__:function(){return this;},fromJSON:function(val){return val?py.True:py.False},toJSON:function(){return this===py.True;}});py.True=py.PY_call(py.bool);py.False=py.PY_call(py.bool);booleans_initialized=true;py.float=py.type('float',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var value=args.value;if(value===placeholder){this._value=0;return;}
if(py.PY_isInstance(value,py.float)){this._value=value._value;}
if(py.PY_isInstance(value,py.object)&&'__float__'in value){var res=value.__float__();if(py.PY_isInstance(res,py.float)){this._value=res._value;return;}
throw new Error('TypeError: __float__ returned non-float (type '+
typename(res)+')');}
throw new Error('TypeError: float() argument must be a string or a number');},__str__:function(){return py.str.fromJSON(String(this._value));},__eq__:function(other){return this._value===other._value?py.True:py.False;},__lt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__abs__:function(){return py.float.fromJSON(Math.abs(this._value));},__add__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value+other._value);},__mod__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value%other._value);},__neg__:function(){return py.float.fromJSON(-this._value);},__sub__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value-other._value);},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value*other._value);},__pow__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value**other._value);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value/other._value);},__nonzero__:function(){return this._value?py.True:py.False;},fromJSON:function(v){if(!(typeof v==='number')){throw new Error('py.float.fromJSON can only take numbers');}
var instance=py.PY_call(py.float);instance._value=v;return instance;},toJSON:function(){return this._value;}});py.str=py.type('str',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var s=args.value;if(s===placeholder){this._value='';return;}
this._value=py.PY_str(s)._value;},__hash__:function(){return'\1\0\1'+this._value;},__str__:function(){return this;},__eq__:function(other){if(py.PY_isInstance(other,py.str)&&this._value===other._value){return py.True;}
return py.False;},__lt__:function(other){if(py.PY_not(py.PY_call(py.isinstance,[other,py.str]))){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return py.str.fromJSON(this._value+other._value);},__nonzero__:function(){return this._value.length?py.True:py.False;},__contains__:function(s){return(this._value.indexOf(s._value)!==-1)?py.True:py.False;},fromJSON:function(s){if(typeof s==='string'){var instance=py.PY_call(py.str);instance._value=s;return instance;}
throw new Error("str.fromJSON can only take strings");},toJSON:function(){return this._value;}});py.tuple=py.type('tuple',null,{__init__:function(){this._values=[];},__len__:function(){return this._values.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},__contains__:function(value){for(var i=0,len=this._values.length;i<len;++i){if(py.PY_isTrue(this._values[i].__eq__(value))){return py.True;}}
return py.False;},__getitem__:function(index){return this._values[index.toJSON()];},toJSON:function(){var out=[];for(var i=0;i<this._values.length;++i){out.push(this._values[i].toJSON());}
return out;},fromJSON:function(ar){if(!(ar instanceof Array)){throw new Error("Can only create a py.tuple from an Array");}
var t=py.PY_call(py.tuple);for(var i=0;i<ar.length;++i){t._values.push(PY_ensurepy(ar[i]));}
return t;}});py.list=py.type('list',null,{__nonzero__:function(){return this.__len__>0?py.True:py.False;},});_.defaults(py.list,py.tuple)
py.dict=py.type('dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var h=key.__hash__();if(!(h in this._store)){throw new Error("KeyError: '"+key.toJSON()+"'");}
return this._store[h][1];},__setitem__:function(key,value){this._store[key.__hash__()]=[key,value];},__len__:function(){return Object.keys(this._store).length},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);var h=args.k.__hash__();if(!(h in this._store)){return args.d;}
return this._store[h][1];},fromJSON:function(d){var instance=py.PY_call(py.dict);for(var k in(d||{})){if(!d.hasOwnProperty(k)){continue;}
instance.__setitem__(py.str.fromJSON(k),PY_ensurepy(d[k]));}
return instance;},toJSON:function(){var out={};for(var k in this._store){var item=this._store[k];out[item[0].toJSON()]=item[1].toJSON();}
return out;}});py.PY_def=py.type('function',null,{__call__:function(){return this._func.apply(this._inst,arguments);},fromJSON:function(nativefunc){var instance=py.PY_call(py.PY_def);instance._inst=null;instance._func=nativefunc;return instance;},toJSON:function(){return this._func;}});py.classmethod=py.type('classmethod',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'function');this._func=args['function'];},__get__:function(obj,type){return PY_instancemethod.fromJSON(this._func,type);},fromJSON:function(func){return py.PY_call(py.classmethod,[func]);}});var PY_instancemethod=py.type('instancemethod',[py.PY_def],{fromJSON:function(nativefunc,instance){var inst=py.PY_call(PY_instancemethod);inst._inst=instance;inst._func=nativefunc;return inst;}});py.abs=new py.PY_def.fromJSON(function abs(){var args=py.PY_parseArgs(arguments,['number']);if(!args.number.__abs__){throw new Error("TypeError: bad operand type for abs(): '"
+typename(args.number)
+"'");}
return args.number.__abs__();});py.len=new py.PY_def.fromJSON(function len(){var args=py.PY_parseArgs(arguments,['object']);return py.float.fromJSON(py.PY_size(args.object));});py.isinstance=new py.PY_def.fromJSON(function isinstance(){var args=py.PY_parseArgs(arguments,['object','class']);return py.PY_isInstance(args.object,args['class'])?py.True:py.False;});py.issubclass=new py.PY_def.fromJSON(function issubclass(){var args=py.PY_parseArgs(arguments,['C','B']);return py.PY_isSubclass(args.C,args.B)?py.True:py.False;});var PY_decode_string_literal=function(str,unicode){var out=[],code;var direct_map={'\\':'\\','"':'"',"'":"'",'a':'\x07','b':'\x08','f':'\x0c','n':'\n','r':'\r','t':'\t','v':'\v'};for(var i=0;i<str.length;++i){if(str[i]!=='\\'){out.push(str[i]);continue;}
var escape=str[i+1];if(escape in direct_map){out.push(direct_map[escape]);++i;continue;}
switch(escape){case'\n':++i;continue;case'N':if(!unicode){break;}
throw Error("SyntaxError: \\N{} escape not implemented");case'u':if(!unicode){break;}
var uni=str.slice(i+2,i+6);if(!/[0-9a-f]{4}/i.test(uni)){throw new Error(["SyntaxError: (unicode error) 'unicodeescape' codec"," can't decode bytes in position ",i,"-",i+4,": truncated \\uXXXX escape"].join(''));}
code=parseInt(uni,16);out.push(String.fromCharCode(code));i+=5;continue;case'U':if(!unicode){break;}
throw Error("SyntaxError: \\U escape not implemented");case'x':var hex=str.slice(i+2,i+4);if(!/[0-9a-f]{2}/i.test(hex)){if(!unicode){throw new Error('ValueError: invalid \\x escape');}
throw new Error(["SyntaxError: (unicode error) 'unicodeescape'"," codec can't decode bytes in position ",i,'-',i+2,": truncated \\xXX escape"].join(''))}
code=parseInt(hex,16);out.push(String.fromCharCode(code));i+=3;continue;default:if(!/[0-8]/.test(escape)){break;}
var r=/[0-8]{1,3}/g;r.lastIndex=i+1;var m=r.exec(str);var oct=m[0];code=parseInt(oct,8);out.push(String.fromCharCode(code));i+=oct.length;continue;}
out.push('\\');}
return out.join('');};var PY_operators={'==':['eq','eq',function(a,b){return a===b;}],'!=':['ne','ne',function(a,b){return a!==b;}],'<>':['ne','ne',function(a,b){return a!==b;}],'<':['lt','gt',function(a,b){return a.__class__.__name__<b.__class__.__name__;}],'<=':['le','ge',function(a,b){return a.__class__.__name__<=b.__class__.__name__;}],'>':['gt','lt',function(a,b){return a.__class__.__name__>b.__class__.__name__;}],'>=':['ge','le',function(a,b){return a.__class__.__name__>=b.__class__.__name__;}],'+':['add','radd'],'-':['sub','rsub'],'*':['mul','rmul'],'/':['div','rdiv'],'//':['floordiv','rfloordiv'],'%':['mod','rmod'],'**':['pow','rpow'],'<<':['lshift','rlshift'],'>>':['rshift','rrshift'],'&':['and','rand'],'^':['xor','rxor'],'|':['or','ror']};var PY_op=function(o1,o2,op){var r;var methods=PY_operators[op];var forward='__'+methods[0]+'__',reverse='__'+methods[1]+'__';var otherwise=methods[2];if(forward in o1&&(r=o1[forward](o2))!==py.NotImplemented){return r;}
if(reverse in o2&&(r=o2[reverse](o1))!==py.NotImplemented){return r;}
if(otherwise){return PY_ensurepy(otherwise(o1,o2));}
throw new Error("TypeError: unsupported operand type(s) for "+op+": '"
+typename(o1)+"' and '"+typename(o2)+"'");};var PY_builtins={type:py.type,None:py.None,True:py.True,False:py.False,NotImplemented:py.NotImplemented,object:py.object,bool:py.bool,float:py.float,str:py.str,unicode:py.unicode,tuple:py.tuple,list:py.list,dict:py.dict,abs:py.abs,len:py.len,isinstance:py.isinstance,issubclass:py.issubclass,classmethod:py.classmethod,};py.parse=function(toks){var index=0;token=toks[0];next=function(){return toks[++index];};return expression();};var evaluate_operator=function(operator,a,b){switch(operator){case'is':return a===b?py.True:py.False;case'is not':return a!==b?py.True:py.False;case'in':return b.__contains__(a);case'not in':return py.PY_isTrue(b.__contains__(a))?py.False:py.True;case'==':case'!=':case'<>':case'<':case'<=':case'>':case'>=':return PY_op(a,b,operator);}
throw new Error('SyntaxError: unknown comparator [['+operator+']]');};py.evaluate=function(expr,context){context=context||{};switch(expr.id){case'(name)':var val=context[expr.value];if(val===undefined&&expr.value in PY_builtins){return PY_builtins[expr.value];}
return PY_ensurepy(val,expr.value);case'(string)':return py.str.fromJSON(expr.value);case'(number)':return py.float.fromJSON(expr.value);case'(constant)':switch(expr.value){case'None':return py.None;case'False':return py.False;case'True':return py.True;}
throw new Error("SyntaxError: unknown constant '"+expr.value+"'");case'(comparator)':var result,left=py.evaluate(expr.expressions[0],context);for(var i=0;i<expr.operators.length;++i){result=evaluate_operator(expr.operators[i],left,left=py.evaluate(expr.expressions[i+1],context));if(py.PY_not(result)){return py.False;}}
return py.True;case'not':return py.PY_isTrue(py.evaluate(expr.first,context))?py.False:py.True;case'and':var and_first=py.evaluate(expr.first,context);if(py.PY_isTrue(and_first.__nonzero__())){return py.evaluate(expr.second,context);}
return and_first;case'or':var or_first=py.evaluate(expr.first,context);if(py.PY_isTrue(or_first.__nonzero__())){return or_first}
return py.evaluate(expr.second,context);case'if':var cond=py.evaluate(expr.condition,context);if(py.PY_isTrue(cond)){return py.evaluate(expr.ifTrue,context);}else{return py.evaluate(expr.ifFalse,context);}
case'(':if(expr.second){var callable=py.evaluate(expr.first,context);var args=[],kwargs={};for(var jj=0;jj<expr.second.length;++jj){var arg=expr.second[jj];if(arg.id!=='='){args.push(py.evaluate(arg,context));}else{kwargs[arg.first.value]=py.evaluate(arg.second,context);}}
return py.PY_call(callable,args,kwargs);}
var tuple_exprs=expr.first,tuple_values=[];for(var j=0,len=tuple_exprs.length;j<len;++j){tuple_values.push(py.evaluate(tuple_exprs[j],context));}
return py.tuple.fromJSON(tuple_values);case'[':if(expr.second){return py.PY_getItem(py.evaluate(expr.first,context),py.evaluate(expr.second,context));}
var list_exprs=expr.first,list_values=[];for(var k=0;k<list_exprs.length;++k){list_values.push(py.evaluate(list_exprs[k],context));}
return py.list.fromJSON(list_values);case'{':var dict_exprs=expr.first,dict=py.PY_call(py.dict);for(var l=0;l<dict_exprs.length;++l){py.PY_setItem(dict,py.evaluate(dict_exprs[l][0],context),py.evaluate(dict_exprs[l][1],context));}
return dict;case'.':if(expr.second.id!=='(name)'){throw new Error('SyntaxError: '+expr);}
return py.PY_getAttr(py.evaluate(expr.first,context),expr.second.value);case'~':return(py.evaluate(expr.first,context)).__invert__();case'+':if(!expr.second){return py.PY_positive(py.evaluate(expr.first,context));}
case'-':if(!expr.second){return py.PY_negative(py.evaluate(expr.first,context));}
case'*':case'/':case'//':case'%':case'**':case'<<':case'>>':case'&':case'^':case'|':return PY_op(py.evaluate(expr.first,context),py.evaluate(expr.second,context),expr.id);default:throw new Error('SyntaxError: Unknown node [['+expr.id+']]');}};py.eval=function(str,context){return py.evaluate(py.parse(py.tokenize(str)),context).toJSON();}})(typeof exports==='undefined'?py:exports);;

/* /web/static/lib/py.js/lib/py_extras.js defined in bundle 'web.assets_backend' */
(function(py){"use strict";function divmod(a,b,fn){var mod=a%b;if(mod>0&&b<0||mod<0&&b>0){mod+=b;}
return fn(Math.floor(a/b),mod);}
function modf(x,fn){var mod=x%1;if(mod<0){mod+=1;}
return fn(mod,Math.floor(x));}
function assert(bool){if(!bool){throw new Error("AssertionError");}}
var obj=function(){};obj.prototype=py.object;var asJS=function(arg){if(arg instanceof obj){return arg.toJSON();}
return arg;};var datetime=py.PY_call(py.object);var zero=py.float.fromJSON(0);var DAYS_IN_MONTH=[null,31,28,31,30,31,30,31,31,30,31,30,31];var DAYS_BEFORE_MONTH=[null];var dbm=0;for(var i=1;i<DAYS_IN_MONTH.length;++i){DAYS_BEFORE_MONTH.push(dbm);dbm+=DAYS_IN_MONTH[i];}
function is_leap(year){return year%4===0&&(year%100!==0||year%400===0);}
function days_before_year(year){var y=year-1;return y*365+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);}
function days_in_month(year,month){if(month===2&&is_leap(year)){return 29;}
return DAYS_IN_MONTH[month];}
function days_before_month(year,month){var post_leap_feb=month>2&&is_leap(year);return DAYS_BEFORE_MONTH[month]+(post_leap_feb?1:0);}
function ymd2ord(year,month,day){var dim=days_in_month(year,month);if(!(1<=day&&day<=dim)){throw new Error("ValueError: day must be in 1.."+dim);}
return days_before_year(year)+
days_before_month(year,month)+
day;}
function get_quarter_number(month){return Math.ceil(month/3);}
function get_quarter(year,month){var quarter_number=get_quarter_number(month);var month_from=((quarter_number-1)*3)+1
var date_from={year:year,month:month_from,day:1}
var date_to={year:year,month:month_from+2,day:days_in_month(year,month)}
return[date_from,date_to];}
function get_day_of_week(year,month,day){var d=new Date(year,month-1,day);return(d.getDay()+6)%7;}
var DI400Y=days_before_year(401);var DI100Y=days_before_year(101);var DI4Y=days_before_year(5);function ord2ymd(n){--n;var n400,n100,n4,n1,n0;divmod(n,DI400Y,function(_n400,n){n400=_n400;divmod(n,DI100Y,function(_n100,n){n100=_n100;divmod(n,DI4Y,function(_n4,n){n4=_n4;divmod(n,365,function(_n1,n){n1=_n1;n0=n;});});});});n=n0;var year=n400*400+1+n100*100+n4*4+n1;if(n1==4||n100==100){assert(n0===0);return{year:year-1,month:12,day:31};}
var leapyear=n1===3&&(n4!==24||n100==3);assert(leapyear==is_leap(year));var month=(n+50)>>5;var preceding=DAYS_BEFORE_MONTH[month]+((month>2&&leapyear)?1:0);if(preceding>n){--month;preceding-=DAYS_IN_MONTH[month]+((month===2&&leapyear)?1:0);}
n-=preceding;return{year:year,month:month,day:n+1};}
function tmxxx(year,month,day,hour,minute,second,microsecond){hour=hour||0;minute=minute||0;second=second||0;microsecond=microsecond||0;if(microsecond<0||microsecond>999999){divmod(microsecond,1000000,function(carry,ms){microsecond=ms;second+=carry;});}
if(second<0||second>59){divmod(second,60,function(carry,s){second=s;minute+=carry;});}
if(minute<0||minute>59){divmod(minute,60,function(carry,m){minute=m;hour+=carry;});}
if(hour<0||hour>23){divmod(hour,24,function(carry,h){hour=h;day+=carry;});}
if(month<1||month>12){divmod(month-1,12,function(carry,m){month=m+1;year+=carry;});}
var dim=days_in_month(year,month);if(day<1||day>dim){if(day===0){--month;if(month>0){day=days_in_month(year,month);}else{--year;month=12;day=31;}}else if(day==dim+1){++month;day=1;if(month>12){month=1;++year;}}else{var r=ord2ymd(ymd2ord(year,month,1)+(day-1));year=r.year;month=r.month;day=r.day;}}
return{year:year,month:month,day:day,hour:hour,minute:minute,second:second,microsecond:microsecond};}
datetime.timedelta=py.type('timedelta',null,{__init__:function(){var args=py.PY_parseArgs(arguments,[['days',zero],['seconds',zero],['microseconds',zero],['milliseconds',zero],['minutes',zero],['hours',zero],['weeks',zero]]);var d=0,s=0,m=0;var days=args.days.toJSON()+args.weeks.toJSON()*7;var seconds=args.seconds.toJSON()
+args.minutes.toJSON()*60
+args.hours.toJSON()*3600;var microseconds=args.microseconds.toJSON()
+args.milliseconds.toJSON()*1000;var daysecondsfrac=modf(days,function(dayfrac,days){d=days;if(dayfrac){return modf(dayfrac*24*3600,function(dsf,dsw){s=dsw;return dsf;});}
return 0;});var secondsfrac=modf(seconds,function(sf,s){seconds=s;return sf+daysecondsfrac;});divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;});microseconds+=secondsfrac*1e6;divmod(microseconds,1000000,function(seconds,microseconds){divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;m+=Math.round(microseconds);});});this.days=d;this.seconds=s;this.microseconds=m;},__str__:function(){var hh,mm,ss;divmod(this.seconds,60,function(m,s){divmod(m,60,function(h,m){hh=h;mm=m;ss=s;});});var s=_.str.sprintf("%d:%02d:%02d",hh,mm,ss);if(this.days){s=_.str.sprintf("%d day%s, %s",this.days,(this.days!=1&&this.days!=-1)?'s':'',s);}
if(this.microseconds){s=_.str.sprintf("%s.%06d",s,this.microseconds);}
return py.str.fromJSON(s);},__eq__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.False;}
return(this.days===other.days&&this.seconds===other.seconds&&this.microseconds===other.microseconds)?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days+other.days),py.float.fromJSON(this.seconds+other.seconds),py.float.fromJSON(this.microseconds+other.microseconds)]);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days-other.days),py.float.fromJSON(this.seconds-other.seconds),py.float.fromJSON(this.microseconds-other.microseconds)]);},__rsub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return this.__neg__().__add__(other);},__neg__:function(){return py.PY_call(datetime.timedelta,[py.float.fromJSON(-this.days),py.float.fromJSON(-this.seconds),py.float.fromJSON(-this.microseconds)]);},__pos__:function(){return this;},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var n=other.toJSON();return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days*n),py.float.fromJSON(this.seconds*n),py.float.fromJSON(this.microseconds*n)]);},__rmul__:function(other){return this.__mul__(other);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var usec=((this.days*24*3600)+this.seconds)*1000000
+this.microseconds;return py.PY_call(datetime.timedelta,[zero,zero,py.float.fromJSON(usec/other.toJSON())]);},__floordiv__:function(other){return this.__div__(other);},total_seconds:function(){return py.float.fromJSON(this.days*86400
+this.seconds
+this.microseconds/1000000);},__nonzero__:function(){return(!!this.days||!!this.seconds||!!this.microseconds)?py.True:py.False;}});datetime.datetime=py.type('datetime',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,['year','month','day',['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var key in args){if(!args.hasOwnProperty(key)){continue;}
this[key]=asJS(args[key]);}},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day&&this.hour===other.hour&&this.minute===other.minute&&this.second===other.second&&this.microsecond===other.microsecond&&this.tzinfo===other.tzinfo)?py.True:py.False;},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None],['hour',py.None],['minute',py.None],['second',py.None],['microsecond',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.datetime,params);},start_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();if(granularity==='year'){return py.PY_call(datetime.datetime,[this.year,1,1]);}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[0];return py.PY_call(datetime.datetime,[quarter.year,quarter.month,quarter.day]);}else if(granularity==='month'){return py.PY_call(datetime.datetime,[this.year,this.month,1]);}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.datetime,[this.year,this.month,this.day-dow]);}else if(granularity==='day'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day]);}else if(granularity==='hour'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day,this.hour]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week, day and hour.')}},end_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();var min=[23,59,59];if(granularity==='year'){return py.PY_call(datetime.datetime,[this.year,12,31].concat(min));}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[1];return py.PY_call(datetime.datetime,[quarter.year,quarter.month,quarter.day].concat(min));}else if(granularity==='month'){var dom=days_in_month(this.year,this.month);return py.PY_call(datetime.datetime,[this.year,this.month,dom].concat(min));}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.datetime,[this.year,this.month,this.day+(6-dow)].concat(min));}else if(granularity==='day'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day].concat(min));}else if(granularity==='hour'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day,this.hour,59,59]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week, day and hour.')}},add:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],['hours',py.None],['minutes',py.None],['seconds',py.None],]);return py.PY_add(this,py.PY_call(relativedelta,{'years':args.years,'months':args.months,'days':args.days,'hours':args.hours,'minutes':args.minutes,'seconds':args.seconds,}));},subtract:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],['hours',py.None],['minutes',py.None],['seconds',py.None],]);var params={};for(var key in args){params[key]=(args[key]===py.None?args[key]:py.float.fromJSON(-asJS(args[key])));}
return py.PY_add(this,py.PY_call(relativedelta,params));},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return _.str.sprintf('%04d',self.year);case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);case'H':return _.str.sprintf('%02d',self.hour);case'M':return _.str.sprintf('%02d',self.minute);case'S':return _.str.sprintf('%02d',self.second);}
throw new Error('ValueError: No known conversion for '+m);}));},to_utc:function(){var d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);var offset=d.getTimezoneOffset();var kwargs={minutes:py.float.fromJSON(offset)};var timedelta=py.PY_call(py.extras.datetime.timedelta,[],kwargs);var s=tmxxx(this.year,this.month,this.day+timedelta.days,this.hour,this.minute,this.second+timedelta.seconds);return datetime.datetime.fromJSON(s.year,s.month,s.day,s.hour,s.minute,s.second);},now:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getFullYear(),d.getMonth()+1,d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()*1000]);}),today:py.classmethod.fromJSON(function(){var dt_class=py.PY_getAttr(datetime,'datetime');return py.PY_call(py.PY_getAttr(dt_class,'now'));}),utcnow:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getUTCFullYear(),d.getUTCMonth()+1,d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()*1000]);}),combine:py.classmethod.fromJSON(function(){var args=py.PY_parseArgs(arguments,'date time');return py.PY_call(datetime.datetime,[py.PY_getAttr(args.date,'year'),py.PY_getAttr(args.date,'month'),py.PY_getAttr(args.date,'day'),py.PY_getAttr(args.time,'hour'),py.PY_getAttr(args.time,'minute'),py.PY_getAttr(args.time,'second')]);}),toJSON:function(){return new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.microsecond/1000);},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days,this.hour,this.minute,this.second+other.seconds);return datetime.datetime.fromJSON(s.year,s.month,s.day,s.hour,s.minute,s.second);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return py.PY_add(this,py.PY_negative(other));}
return py.NotImplemented;},fromJSON:function(year,month,day,hour,minute,second){return py.PY_call(datetime.datetime,[year,month,day,hour,minute,second]);},});datetime.date=py.type('date',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'year month day');this.year=asJS(args.year);this.month=asJS(args.month);this.day=asJS(args.day);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return self.year;case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);}
throw new Error('ValueError: No known conversion for '+m);}));},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day)?py.True:py.False;},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.date,params);},start_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();if(granularity==='year'){return py.PY_call(datetime.date,[this.year,1,1]);}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[0];return py.PY_call(datetime.date,[quarter.year,quarter.month,quarter.day]);}else if(granularity==='month'){return py.PY_call(datetime.date,[this.year,this.month,1]);}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.date,[this.year,this.month,this.day-dow]);}else if(granularity==='day'){return py.PY_call(datetime.date,[this.year,this.month,this.day]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week and day.')}},end_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();if(granularity==='year'){return py.PY_call(datetime.date,[this.year,12,31]);}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[1];return py.PY_call(datetime.date,[quarter.year,quarter.month,quarter.day]);}else if(granularity==='month'){var dom=days_in_month(this.year,this.month);return py.PY_call(datetime.date,[this.year,this.month,dom]);}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.date,[this.year,this.month,this.day+(6-dow)]);}else if(granularity==='day'){return py.PY_call(datetime.date,[this.year,this.month,this.day]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week and day.')}},add:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],]);return py.PY_add(this,py.PY_call(relativedelta,{'years':args.years,'months':args.months,'days':args.days,}));},subtract:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],]);var params={};for(var key in args){params[key]=(args[key]===py.None?args[key]:py.float.fromJSON(-asJS(args[key])));}
return py.PY_add(this,py.PY_call(relativedelta,params));},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days);return datetime.date.fromJSON(s.year,s.month,s.day);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return py.PY_add(this,py.PY_negative(other));}
if(py.PY_isInstance(other,datetime.date)){return py.PY_call(datetime.timedelta,[py.PY_subtract(py.PY_call(py.PY_getAttr(this,'toordinal')),py.PY_call(py.PY_getAttr(other,'toordinal')))]);}
return py.NotImplemented;},toordinal:function(){return py.float.fromJSON(ymd2ord(this.year,this.month,this.day));},weekday:function(){return py.float.fromJSON((this.toordinal().toJSON()+6)%7);},fromJSON:function(year,month,day){return py.PY_call(datetime.date,[year,month,day]);},today:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}),});datetime.time=py.type('time',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,[['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var k in args){if(!args.hasOwnProperty(k)){continue;}
this[k]=asJS(args[k]);}}});var time=py.PY_call(py.object);time.strftime=py.PY_def.fromJSON(function(){var args=py.PY_parseArgs(arguments,'format');var dt_class=py.PY_getAttr(datetime,'datetime');var d=py.PY_call(py.PY_getAttr(dt_class,'utcnow'));return py.PY_call(py.PY_getAttr(d,'strftime'),[args.format]);});var args=_.map(('year month day hour minute second '
+'years months weeks days hours minutes seconds '
+'weekday leapdays yearday nlyearday').split(' '),function(arg){switch(arg){case'years':case'months':case'days':case'leapdays':case'weeks':case'hours':case'minutes':case'seconds':return[arg,zero];case'year':case'month':case'day':case'weekday':case'hour':case'minute':case'second':case'yearday':case'nlyearday':return[arg,null];default:throw new Error("Unknown relativedelta argument "+arg);}});args.unshift('*');var _utils={monthrange:function(year,month){if(month<1||month>12){throw new Error("Illegal month "+month);}
var day1=this.weekday(year,month,1);var ndays=this.mdays[month]+(month==this.February&&this.isleap(year));return[day1,ndays];},weekday:function(year,month,day){var date=py.PY_call(datetime.date,[year,month,day]);return py.PY_call(py.PY_getAttr(date,'weekday'));},isleap:function(year){return year%4===0&&(year%100!==0||year%400===0);},mdays:[0,31,28,31,30,31,30,31,31,30,31,30,31],January:1,February:2};var relativedelta=py.type('relativedelta',null,{__init__:function(){this.ops=py.PY_parseArgs(arguments,args);this.ops.days=py.float.fromJSON(asJS(this.ops.days)+asJS(this.ops.weeks)*7);var yday=zero;if(this.ops.nlyearday){yday=this.ops.nlyearday;}else if(this.ops.yearday){yday=this.ops.yearday;if(asJS(this.ops.yearday)>59){this.ops.leapdays=py.float.fromJS(-1);}}
if(py.PY_isTrue(yday)){var ydayidx=[31,59,90,120,151,181,212,243,273,304,334,366];for(var idx=0;idx<ydayidx.length;++idx){var ydays=ydayidx[idx];if(asJS(yday)<=ydays){this.ops.month=py.float.fromJSON(idx+1);if(!idx){this.ops.day=yday;}else{this.ops.day=py.PY_subtract(yday,py.float.fromJSON(ydayidx[idx-1]));}
break;}}
if(idx===ydayidx.length){throw new Error("Invalid year day ("+asJS(yday)+")");}}
this._fix();},_fix:function(){var self=this;var months=asJS(this.ops.months);if(Math.abs(months)>11){var s=months>0?1:-1;divmod(months*s,12,function(years,months){self.ops.months=py.float.fromJSON(months*s);self.ops.years=py.float.fromJSON(asJS(self.ops.years)+years*s);});}
this._has_time=0;},__add__:function(other){if(!(py.PY_isInstance(other,datetime.date)||py.PY_isInstance(other,datetime.datetime))){return py.NotImplemented;}
var year=(asJS(this.ops.year)||asJS(other.year))+asJS(this.ops.years);var month=asJS(this.ops.month)||asJS(other.month);var months;if(months=asJS(this.ops.months)){if(Math.abs(months)<1||Math.abs(months)>12){throw new Error("Can only use relative months between -12 and +12");}
month+=months;if(month>12){year+=1;month-=12;}
if(month<1){year-=1;month+=12;}}
var day=Math.min(_utils.monthrange(year,month)[1],asJS(this.ops.day)||asJS(other.day));var repl={year:py.float.fromJSON(year),month:py.float.fromJSON(month),day:py.float.fromJSON(day)};if(py.PY_isInstance(other,datetime.datetime)){repl.hour=py.float.fromJSON(asJS(this.ops.hour)||asJS(other.hour));repl.minute=py.float.fromJSON(asJS(this.ops.minute)||asJS(other.minute));repl.second=py.float.fromJSON(asJS(this.ops.second)||asJS(other.second));}
var days=asJS(this.ops.days);if(py.PY_isTrue(this.ops.leapdays)&&month>2&&_utils.isleap(year)){days+=asJS(this.ops.leapdays);}
var ret=py.PY_add(py.PY_call(py.PY_getAttr(other,'replace'),repl),py.PY_call(datetime.timedelta,{days:py.float.fromJSON(days),hours:py.float.fromJSON(asJS(this.ops.hours)),minutes:py.float.fromJSON(asJS(this.ops.minutes)),seconds:py.float.fromJSON(asJS(this.ops.seconds))}));if(this.ops.weekday){var weekday=asJS(this.ops.weekday),nth=1;var jumpdays=(Math.abs(nth)-1)*7;var ret_weekday=asJS(py.PY_call(py.PY_getAttr(ret,'weekday')));if(nth>0){jumpdays+=(7-ret_weekday+weekday)%7;}else{jumpdays+=(ret_weekday-weekday)%7;jumpdays*=-1;}
ret=py.PY_add(ret,py.PY_call(datetime.timedelta,{days:py.float.fromJSON(jumpdays)}));}
return ret;},__radd__:function(other){return this.__add__(other);},__rsub__:function(other){return this.__neg__().__radd__(other);},__neg__:function(){return py.PY_call(relativedelta,{years:py.PY_negative(this.ops.years),months:py.PY_negative(this.ops.months),days:py.PY_negative(this.ops.days),leapdays:this.ops.leapdays,hours:py.PY_negative(this.ops.hours),minutes:py.PY_negative(this.ops.minutes),seconds:py.PY_negative(this.ops.seconds),year:this.ops.year,month:this.ops.month,day:this.ops.day,weekday:this.ops.weekday,hour:this.ops.hour,minute:this.ops.minute,second:this.ops.second});}});py.extras={datetime:datetime,time:time,relativedelta:relativedelta,};})(typeof exports==='undefined'?py:exports);;

/* /web/static/lib/jquery.ba-bbq/jquery.ba-bbq.js defined in bundle 'web.assets_backend' */
(function($,window){'$:nomunge';var undefined,aps=Array.prototype.slice,decode=decodeURIComponent,jq_param=$.param,jq_param_sorted,jq_param_fragment,jq_deparam,jq_deparam_fragment,jq_bbq=$.bbq=$.bbq||{},jq_bbq_pushState,jq_bbq_getState,jq_elemUrlAttr,special=$.event.special,str_hashchange='hashchange',str_querystring='querystring',str_fragment='fragment',str_elemUrlAttr='elemUrlAttr',str_href='href',str_src='src',re_params_querystring=/^.*\?|#.*$/g,re_params_fragment,re_fragment,re_no_escape,ajax_crawlable,fragment_prefix,elemUrlAttr_cache={};function is_string(arg){return typeof arg==='string';};function curry(func){var args=aps.call(arguments,1);return function(){return func.apply(this,args.concat(aps.call(arguments)));};};function get_fragment(url){return url.replace(re_fragment,'$2');};function get_querystring(url){return url.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,'$1');};function jq_param_sub(is_fragment,get_func,url,params,merge_mode){var result,qs,matches,url_params,hash;if(params!==undefined){matches=url.match(is_fragment?re_fragment:/^([^#?]*)\??([^#]*)(#?.*)/);hash=matches[3]||'';if(merge_mode===2&&is_string(params)){qs=params.replace(is_fragment?re_params_fragment:re_params_querystring,'');}else{url_params=jq_deparam(matches[2]);params=is_string(params)?jq_deparam[is_fragment?str_fragment:str_querystring](params):params;qs=merge_mode===2?params:merge_mode===1?$.extend({},params,url_params):$.extend({},url_params,params);qs=jq_param_sorted(qs);if(is_fragment){qs=qs.replace(re_no_escape,decode);}}
result=matches[1]+(is_fragment?fragment_prefix:qs||!matches[1]?'?':'')+qs+hash;}else{result=get_func(url!==undefined?url:location.href);}
return result;};jq_param[str_querystring]=curry(jq_param_sub,0,get_querystring);jq_param[str_fragment]=jq_param_fragment=curry(jq_param_sub,1,get_fragment);jq_param.sorted=jq_param_sorted=function(a,traditional){var arr=[],obj={};$.each(jq_param(a,traditional).split('&'),function(i,v){var key=v.replace(/(?:%5B|=).*$/,''),key_obj=obj[key];if(!key_obj){key_obj=obj[key]=[];arr.push(key);}
key_obj.push(v);});return $.map(arr.sort(),function(v){return obj[v];}).join('&');};jq_param_fragment.noEscape=function(chars){chars=chars||'';var arr=$.map(chars.split(''),encodeURIComponent);re_no_escape=new RegExp(arr.join('|'),'g');};jq_param_fragment.noEscape(',/');jq_param_fragment.ajaxCrawlable=function(state){if(state!==undefined){if(state){re_params_fragment=/^.*(?:#!|#)/;re_fragment=/^([^#]*)(?:#!|#)?(.*)$/;fragment_prefix='#!';}else{re_params_fragment=/^.*#/;re_fragment=/^([^#]*)#?(.*)$/;fragment_prefix='#';}
ajax_crawlable=!!state;}
return ajax_crawlable;};jq_param_fragment.ajaxCrawlable(0);$.deparam=jq_deparam=function(params,coerce){var obj={},coerce_types={'true':!0,'false':!1,'null':null};$.each(params.replace(/\+/g,' ').split('&'),function(j,v){var param=v.split('='),key=decode(param[0]),val,cur=obj,i=0,keys=key.split(']['),keys_last=keys.length-1;if(/\[/.test(keys[0])&&/\]$/.test(keys[keys_last])){keys[keys_last]=keys[keys_last].replace(/\]$/,'');keys=keys.shift().split('[').concat(keys);keys_last=keys.length-1;}else{keys_last=0;}
if(param.length===2){val=decode(param[1]);if(coerce){val=val&&!isNaN(val)?+val:val==='undefined'?undefined:coerce_types[val]!==undefined?coerce_types[val]:val;}
if(keys_last){for(;i<=keys_last;i++){key=keys[i]===''?cur.length:keys[i];cur=cur[key]=i<keys_last?cur[key]||(keys[i+1]&&isNaN(keys[i+1])?{}:[]):val;}}else{if($.isArray(obj[key])){obj[key].push(val);}else if(obj[key]!==undefined){obj[key]=[obj[key],val];}else{obj[key]=val;}}}else if(key){obj[key]=coerce?undefined:'';}});return obj;};function jq_deparam_sub(is_fragment,url_or_params,coerce){if(url_or_params===undefined||typeof url_or_params==='boolean'){coerce=url_or_params;url_or_params=jq_param[is_fragment?str_fragment:str_querystring]();}else{url_or_params=is_string(url_or_params)?url_or_params.replace(is_fragment?re_params_fragment:re_params_querystring,''):url_or_params;}
return jq_deparam(url_or_params,coerce);};jq_deparam[str_querystring]=curry(jq_deparam_sub,0);jq_deparam[str_fragment]=jq_deparam_fragment=curry(jq_deparam_sub,1);$[str_elemUrlAttr]||($[str_elemUrlAttr]=function(obj){return $.extend(elemUrlAttr_cache,obj);})({a:str_href,base:str_href,iframe:str_src,img:str_src,input:str_src,form:'action',link:str_href,script:str_src});jq_elemUrlAttr=$[str_elemUrlAttr];function jq_fn_sub(mode,force_attr,params,merge_mode){if(!is_string(params)&&typeof params!=='object'){merge_mode=params;params=force_attr;force_attr=undefined;}
return this.each(function(){var that=$(this),attr=force_attr||jq_elemUrlAttr()[(this.nodeName||'').toLowerCase()]||'',url=attr&&that.attr(attr)||'';that.attr(attr,jq_param[mode](url,params,merge_mode));});};$.fn[str_querystring]=curry(jq_fn_sub,str_querystring);$.fn[str_fragment]=curry(jq_fn_sub,str_fragment);jq_bbq.pushState=jq_bbq_pushState=function(params,merge_mode){if(is_string(params)&&/^#/.test(params)&&merge_mode===undefined){merge_mode=2;}
var has_args=params!==undefined,url=jq_param_fragment(location.href,has_args?params:{},has_args?merge_mode:2);location.href=url;};jq_bbq.getState=jq_bbq_getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam_fragment(key):jq_deparam_fragment(coerce)[key];};jq_bbq.removeState=function(arr){var state={};if(arr!==undefined){state=jq_bbq_getState();$.each($.isArray(arr)?arr:arguments,function(i,v){delete state[v];});}
jq_bbq_pushState(state,2);};special[str_hashchange]=$.extend(special[str_hashchange],{add:function(handleObj){var old_handler;function new_handler(e){var hash=e[str_fragment]=jq_param_fragment();e.getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam(hash,key):jq_deparam(hash,coerce)[key];};old_handler.apply(this,arguments);};if($.isFunction(handleObj)){old_handler=handleObj;return new_handler;}else{old_handler=handleObj.handler;handleObj.handler=new_handler;}}});})(jQuery,this);(function($,window,undefined){'$:nomunge';var str_hashchange='hashchange',doc=document,fake_onhashchange,special=$.event.special,doc_mode=doc.documentMode,supports_onhashchange='on'+str_hashchange in window&&(doc_mode===undefined||doc_mode>7);function get_fragment(url){url=url||location.href;return'#'+url.replace(/^[^#]*#?(.*)$/,'$1');};$.fn[str_hashchange]=function(fn){return fn?this.bind(str_hashchange,fn):this.trigger(str_hashchange);};$.fn[str_hashchange].delay=50;special[str_hashchange]=$.extend(special[str_hashchange],{setup:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.start);},teardown:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.stop);}});fake_onhashchange=(function(){var self={},timeout_id,last_hash=get_fragment(),fn_retval=function(val){return val;},history_set=fn_retval,history_get=fn_retval;self.start=function(){timeout_id||poll();};self.stop=function(){timeout_id&&clearTimeout(timeout_id);timeout_id=undefined;};function poll(){var hash=get_fragment(),history_hash=history_get(last_hash);if(hash!==last_hash){history_set(last_hash=hash,history_hash);$(window).trigger(str_hashchange);}else if(history_hash!==last_hash){location.href=location.href.replace(/#.*/,'')+history_hash;}
timeout_id=setTimeout(poll,$.fn[str_hashchange].delay);};$.browser.msie&&!supports_onhashchange&&(function(){var iframe,iframe_src;self.start=function(){if(!iframe){iframe_src=$.fn[str_hashchange].src;iframe_src=iframe_src&&iframe_src+get_fragment();iframe=$('<iframe tabindex="-1" title="empty"/>').hide().one('load',function(){iframe_src||history_set(get_fragment());poll();}).attr('src',iframe_src||'javascript:0').insertAfter('body')[0].contentWindow;doc.onpropertychange=function(){try{if(event.propertyName==='title'){iframe.document.title=doc.title;}}catch(e){}};}};self.stop=fn_retval;history_get=function(){return get_fragment(iframe.location.href);};history_set=function(hash,history_hash){var iframe_doc=iframe.document,domain=$.fn[str_hashchange].domain;if(hash!==history_hash){iframe_doc.title=doc.title;iframe_doc.open();domain&&iframe_doc.write('<script>document.domain="'+domain+'"</script>');iframe_doc.close();iframe.location.hash=hash;}};})();return self;})();})(jQuery,this);;

/* /web/static/src/legacy/action_adapters.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/action_adapters',async function(require){'use strict';let __exports={};const Context=require("web.Context");const core=require("web.core");const{ComponentAdapter}=require("web.OwlCompatibility");const{objectToQuery}=require("@web/core/browser/router_service");const{useDebugCategory}=require("@web/core/debug/debug_context");const{Dialog}=require("@web/core/dialog/dialog");const{useEffect,useService}=require("@web/core/utils/hooks");const{ViewNotFoundError}=require("@web/webclient/actions/action_service");const{cleanDomFromBootstrap,wrapSuccessOrFail}=require("@web/legacy/utils");const{mapDoActionOptionAPI}=require("@web/legacy/backend_utils");const{Component,tags,hooks}=owl;const warningDialogBodyTemplate=tags.xml`<t t-esc="props.message"/>`;class ActionAdapter extends ComponentAdapter{setup(){super.setup();this.actionService=useService("action");this.router=useService("router");this.title=useService("title");this.notifications=useService("notification");this.dialogs=useService("dialog");this.wowlEnv=this.env;this.tempQuery={};let originalUpdateControlPanel;useEffect(()=>{const query=this.widget.getState();Object.assign(query,this.tempQuery);this.tempQuery=null;this.__widget=this.widget;if(!this.wowlEnv.inDialog){this.pushState(query);}
this.wowlEnv.bus.on("ACTION_MANAGER:UPDATE",this,()=>{this.env.bus.trigger("close_dialogs");cleanDomFromBootstrap();});originalUpdateControlPanel=this.__widget.updateControlPanel.bind(this.__widget);this.__widget.updateControlPanel=(newProps)=>{this.trigger("controller-title-updated",this.__widget.getTitle());return originalUpdateControlPanel(newProps);};core.bus.trigger("DOM_updated");return()=>{this.__widget.updateControlPanel=originalUpdateControlPanel;this.wowlEnv.bus.off("ACTION_MANAGER:UPDATE",this);};},()=>[]);hooks.useExternalListener(window,"click",()=>{cleanDomFromBootstrap();});}
get actionId(){throw new Error("Should be implement by specific adapters");}
pushState(state){if(this.wowlEnv.inDialog){return;}
const query=objectToQuery(state);if(this.tempQuery){Object.assign(this.tempQuery,query);return;}
if(this.widget){const actionTitle=this.widget.getTitle();if(actionTitle){this.trigger("controller-title-updated",actionTitle);}}
this.router.pushState(query);}
_trigger_up(ev){const payload=ev.data;if(ev.name==="do_action"){if(payload.action.context){payload.action.context=new Context(payload.action.context).eval();}
this.onReverseBreadcrumb=payload.options&&payload.options.on_reverse_breadcrumb;const legacyOptions=mapDoActionOptionAPI(payload.options);wrapSuccessOrFail(this.actionService.doAction(payload.action,legacyOptions),payload);}else if(ev.name==="breadcrumb_clicked"){this.actionService.restore(payload.controllerID);}else if(ev.name==="push_state"){this.pushState(payload.state);}else if(ev.name==="set_title_part"){const{part,title}=payload;this.title.setParts({[part]:title||null});}else if(ev.name==="warning"){if(payload.type==="dialog"){class WarningDialog extends Dialog{setup(){super.setup();this.title=this.props.title;}}
WarningDialog.bodyTemplate=warningDialogBodyTemplate;this.dialogs.add(WarningDialog,{title:payload.title,message:payload.message,});}else{this.notifications.add(payload.message,{className:payload.className,sticky:payload.sticky,title:payload.title,type:"warning",});}}else{super._trigger_up(ev);}}
exportState(){this.widget=null;return{__legacy_widget__:this.__widget,__on_reverse_breadcrumb__:this.onReverseBreadcrumb,};}
canBeRemoved(){return this.__widget.canBeRemoved();}
willUnmount(){if(this.__widget&&this.__widget.on_detach_callback){this.__widget.on_detach_callback();}
super.willUnmount();}
__destroy(){if(this.actionService.__legacy__isActionInStack(this.actionId)){this.widget=null;}
super.__destroy(...arguments);}}
const ClientActionAdapter=__exports.ClientActionAdapter=class ClientActionAdapter extends ActionAdapter{setup(){super.setup();useDebugCategory("action",{action:this.props.widgetArgs[0]});owl.hooks.onMounted(()=>{const action=this.props.widgetArgs[0];if("params"in action){const newState={};Object.entries(action.params).forEach(([k,v])=>{if(typeof v==="string"||typeof v==="number"){newState[k]=v;}});this.wowlEnv.services.router.pushState(newState);}});this.env=Component.env;}
get actionId(){return this.props.widgetArgs[0].jsId;}
async willStart(){if(this.props.widget){this.widget=this.props.widget;this.widget.setParent(this);if(this.props.onReverseBreadcrumb){await this.props.onReverseBreadcrumb();}
return this.updateWidget();}
return super.willStart();}
updateWidget(){return this.widget.do_show();}
do_push_state(state){this.pushState(state);}}
const magicReloadSymbol=Symbol("magicReload");function useMagicLegacyReload(){const comp=Component.current;if(comp.props.widget&&comp.props.widget[magicReloadSymbol]){return comp.props.widget[magicReloadSymbol];}
let legacyReloadProm=null;const getReloadProm=()=>legacyReloadProm;let manualReload;useEffect(()=>{const widget=comp.widget;const controllerReload=widget.reload;widget.reload=function(...args){manualReload=true;legacyReloadProm=controllerReload.call(widget,...args);return legacyReloadProm.then(()=>{if(manualReload){legacyReloadProm=null;manualReload=false;}});};const controllerUpdate=widget.update;widget.update=function(...args){const updateProm=controllerUpdate.call(widget,...args);const manualUpdate=!manualReload;if(manualUpdate){legacyReloadProm=updateProm;}
return updateProm.then(()=>{if(manualUpdate){legacyReloadProm=null;}});};widget[magicReloadSymbol]=getReloadProm;},()=>[]);return getReloadProm;}
const ViewAdapter=__exports.ViewAdapter=class ViewAdapter extends ActionAdapter{setup(){super.setup();this.actionService=useService("action");this.vm=useService("view");this.shouldUpdateWidget=true;this.magicReload=useMagicLegacyReload();const debugContext={action:this.props.viewParams.action,component:this,};useDebugCategory("action",debugContext);useDebugCategory("view",debugContext);if(this.props.viewInfo.type==="form"){useDebugCategory("form",debugContext);}
this.env=Component.env;}
get actionId(){return this.props.viewParams.action.jsId;}
async willStart(){if(this.props.widget){this.widget=this.props.widget;this.widget.setParent(this);if(this.props.onReverseBreadcrumb){await this.props.onReverseBreadcrumb();}
return this.updateWidget(this.props.viewParams);}else{const view=new this.props.View(this.props.viewInfo,this.props.viewParams);this.widget=await view.getController(this);if(this.__owl__.status===5){if(!this.actionService.__legacy__isActionInStack(this.actionId)){this.widget.destroy();}
return Promise.resolve();}
return this.widget._widgetRenderAndInsert(()=>{});}}
async updateWidget(){const shouldUpdateWidget=this.shouldUpdateWidget;this.shouldUpdateWidget=true;if(!shouldUpdateWidget){return this.magicReload();}
await this.widget.willRestore();const options=Object.assign({},this.props.viewParams,{shouldUpdateSearchComponents:true,});if(!this.magicReload()){this.widget.reload(options);}
return this.magicReload();}
exportState(){const state=super.exportState();const widgetState=this.__widget.exportState();return Object.assign({},state,widgetState);}
async loadViews(resModel,context,views){return(await this.vm.loadViews({resModel,views,context},{})).__legacy__.fields_views;}
async _trigger_up(ev){const payload=ev.data;if(ev.name==="switch_view"){try{const props={};if(payload.mode){props.mode=payload.mode;}
props.resId=payload.res_id;await this.actionService.switchView(payload.view_type,props);}catch(e){if(e instanceof ViewNotFoundError){return;}
throw e;}}else if(ev.name==="execute_action"){const buttonContext=new Context(payload.action_data.context).eval();const envContext=new Context(payload.env.context).eval();wrapSuccessOrFail(this.actionService.doActionButton({args:payload.action_data.args,buttonContext:buttonContext,context:envContext,close:payload.action_data.close,resModel:payload.env.model,name:payload.action_data.name,resId:payload.env.currentID||null,resIds:payload.env.resIDs,special:payload.action_data.special,type:payload.action_data.type,onClose:payload.on_closed,effect:payload.action_data.effect,}),payload);}else{super._trigger_up(ev);}}}
return __exports;});;

/* /web/static/src/legacy/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/debug_manager',async function(require){'use strict';let __exports={};const{_lt}=require("@web/core/l10n/translation");const{Dialog}=require("@web/core/dialog/dialog");const{formatDateTime,parseDateTime}=require("@web/core/l10n/dates");const{formatMany2one}=require("@web/fields/formatters");const{registry}=require("@web/core/registry");const{hooks}=owl;const{useState}=hooks;const debugRegistry=registry.category("debug");class GetMetadataDialog extends Dialog{setup(){super.setup();this.state=useState({});}
async willStart(){await this.getMetadata();}
async toggleNoupdate(){await this.env.services.orm.call("ir.model.data","toggle_noupdate",[this.props.res_model,this.state.id,]);await this.getMetadata();}
async getMetadata(){const metadata=(await this.env.services.orm.call(this.props.res_model,"get_metadata",[this.props.selectedIds,]))[0];this.state.id=metadata.id;this.state.xmlid=metadata.xmlid;this.state.creator=formatMany2one(metadata.create_uid);this.state.lastModifiedBy=formatMany2one(metadata.write_uid);this.state.noupdate=metadata.noupdate;this.state.create_date=formatDateTime(parseDateTime(metadata.create_date));this.state.write_date=formatDateTime(parseDateTime(metadata.write_date));}}
GetMetadataDialog.bodyTemplate="web.DebugMenu.getMetadataBody";GetMetadataDialog.title=_lt("View Metadata");class SetDefaultDialog extends Dialog{setup(){super.setup();this.state={fieldToSet:"",condition:"",scope:"self",};this.dataWidgetState=this.getDataWidgetState();this.defaultFields=this.getDefaultFields();this.conditions=this.getConditions();}
getDataWidgetState(){const renderer=this.props.component.widget.renderer;const state=renderer.state;const fields=state.fields;const fieldsInfo=state.fieldsInfo.form;const fieldNamesInView=state.getFieldNames();const fieldNamesOnlyOnView=["message_attachment_count"];const fieldsValues=state.data;const modifierDatas={};fieldNamesInView.forEach((fieldName)=>{modifierDatas[fieldName]=renderer.allModifiersData.find((modifierdata)=>{return modifierdata.node.attrs.name===fieldName;});});return{fields,fieldsInfo,fieldNamesInView,fieldNamesOnlyOnView,fieldsValues,modifierDatas,stateId:state.id,};}
getDefaultFields(){const{fields,fieldsInfo,fieldNamesInView,fieldNamesOnlyOnView,fieldsValues,modifierDatas,stateId,}=this.dataWidgetState;return fieldNamesInView.filter((fieldName)=>!fieldNamesOnlyOnView.includes(fieldName)).map((fieldName)=>{const modifierData=modifierDatas[fieldName];let invisibleOrReadOnly;if(modifierData){const evaluatedModifiers=modifierData.evaluatedModifiers[stateId];invisibleOrReadOnly=evaluatedModifiers.invisible||evaluatedModifiers.readonly;}
const fieldInfo=fields[fieldName];const valueDisplayed=this.display(fieldInfo,fieldsValues[fieldName]);const value=valueDisplayed[0];const displayed=valueDisplayed[1];if(!value||invisibleOrReadOnly||fieldInfo.type==="one2many"||fieldInfo.type==="many2many"||fieldInfo.type==="binary"||fieldsInfo[fieldName].options.isPassword||fieldInfo.depends.length!==0){return false;}
return{name:fieldName,string:fieldInfo.string,value:value,displayed:displayed,};}).filter((val)=>val).sort((field)=>field.string);}
getConditions(){const{fields,fieldNamesInView,fieldsValues}=this.dataWidgetState;return fieldNamesInView.filter((fieldName)=>{const fieldInfo=fields[fieldName];return fieldInfo.change_default;}).map((fieldName)=>{const fieldInfo=fields[fieldName];const valueDisplayed=this.display(fieldInfo,fieldsValues[fieldName]);const value=valueDisplayed[0];const displayed=valueDisplayed[1];return{name:fieldName,string:fieldInfo.string,value:value,displayed:displayed,};});}
display(fieldInfo,value){let displayed=value;if(value&&fieldInfo.type==="many2one"){displayed=value.data.display_name;value=value.data.id;}else if(value&&fieldInfo.type==="selection"){displayed=fieldInfo.selection.find((option)=>{return option[0]===value;})[1];}
return[value,displayed];}
async saveDefault(){if(!this.state.fieldToSet){return;}
const fieldToSet=this.defaultFields.find((field)=>{return field.name===this.state.fieldToSet;}).value;await this.env.services.orm.call("ir.default","set",[this.props.res_model,this.state.fieldToSet,fieldToSet,this.state.scope==="self",true,this.state.condition||false,]);this.trigger("dialog-closed");}}
SetDefaultDialog.bodyTemplate="web.DebugMenu.setDefaultBody";SetDefaultDialog.footerTemplate="web.DebugMenu.SetDefaultFooter";SetDefaultDialog.title=_lt("Set Default");function setDefaults({action,component,env}){return{type:"item",description:env._t("Set Defaults"),callback:()=>{env.services.dialog.add(SetDefaultDialog,{res_model:action.res_model,component,});},sequence:310,};}
function viewMetadata({action,component,env}){const selectedIds=component.widget.getSelectedIds();if(selectedIds.length!==1){return null;}
return{type:"item",description:env._t("View Metadata"),callback:()=>{env.services.dialog.add(GetMetadataDialog,{res_model:action.res_model,selectedIds,});},sequence:320,};}
function manageAttachments({action,component,env}){const selectedIds=component.widget.getSelectedIds();const description=env._t("Manage Attachments");if(selectedIds.length!==1){return null;}
return{type:"item",description,callback:()=>{const selectedId=selectedIds[0];env.services.action.doAction({res_model:"ir.attachment",name:description,views:[[false,"list"],[false,"form"],],type:"ir.actions.act_window",domain:[["res_model","=",action.res_model],["res_id","=",selectedId],],context:{default_res_model:action.res_model,default_res_id:selectedId,},});},sequence:330,};}
debugRegistry.category("form").add("setDefaults",setDefaults).add("viewMetadata",viewMetadata).add("manageAttachments",manageAttachments);return __exports;});;

/* /web/static/src/legacy/legacy_service_provider.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/legacy_service_provider',async function(require){'use strict';let __exports={};const{bus}=require("web.core");const Context=require("web.Context");const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{mapDoActionOptionAPI}=require("@web/legacy/backend_utils");const legacyServiceProvider=__exports.legacyServiceProvider={dependencies:["effect","action"],start({services}){browser.addEventListener("show-effect",(ev)=>{services.effect.add(ev.detail);});bus.on("show-effect",this,(payload)=>{services.effect.add(payload);});browser.addEventListener("do-action",(ev)=>{const payload=ev.detail;if(payload.action.context){payload.action.context=new Context(payload.action.context).eval();}
const legacyOptions=mapDoActionOptionAPI(payload.options);services.action.doAction(payload.action,legacyOptions);});},};registry.category("services").add("legacy_service_provider",legacyServiceProvider);return __exports;});;

/* /web/static/src/legacy/legacy_client_actions.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/legacy_client_actions',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{action_registry:legacyActionRegistry}=require("web.core");const Widget=require("web.Widget");const{setScrollPosition}=require("@web/core/utils/scrolling");const{useSetupAction}=require("@web/webclient/actions/action_hook");const{ClientActionAdapter}=require("@web/legacy/action_adapters");const{breadcrumbsToLegacy}=require("@web/legacy/backend_utils");const{Component,hooks,tags}=owl;const actionRegistry=registry.category("actions");const legacyClientActionTemplate=tags.xml`
    <ClientActionAdapter Component="Widget" widgetArgs="widgetArgs" widget="widget"
                         onReverseBreadcrumb="onReverseBreadcrumb" t-ref="controller"
                         t-on-scrollTo.stop="onScrollTo"/>`;function registerClientAction(name,action){if(action.prototype instanceof Widget){class Action extends Component{constructor(){super(...arguments);this.controllerRef=hooks.useRef("controller");this.Widget=action;const options={};for(const key in this.props){if(key==="action"||key==="actionId"){continue;}else{options[key]=this.props[key];}}
if(this.env.config.breadcrumbs){options.breadcrumbs=breadcrumbsToLegacy(this.env.config.breadcrumbs);}
this.user=useService("user");const clientAction=Object.assign({},this.props.action,{context:Object.assign({},this.user.context,this.props.action.context),});this.widgetArgs=[clientAction,options];this.widget=this.props.state&&this.props.state.__legacy_widget__;this.onReverseBreadcrumb=this.props.state&&this.props.state.__on_reverse_breadcrumb__;useSetupAction({beforeLeave:()=>this.controllerRef.comp.__widget.canBeRemoved(),getLocalState:()=>this.controllerRef.comp.exportState(),});this.onScrollTo=(ev)=>{setScrollPosition(this,{left:ev.detail.left,top:ev.detail.top});};}}
Action.template=legacyClientActionTemplate;Action.components={ClientActionAdapter};Action.isLegacy=true;Action.target=action.prototype.target;actionRegistry.add(name,Action);}else{actionRegistry.add(name,action);}}
for(const[name,action]of Object.entries(legacyActionRegistry.entries())){if(!actionRegistry.contains(name)){registerClientAction(name,action);}}
legacyActionRegistry.onAdd(registerClientAction);return __exports;});;

/* /web/static/src/legacy/legacy_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/legacy_dialog',async function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{patch}=require("@web/core/utils/patch");const{useEffect}=require("@web/core/utils/hooks");const OwlDialog=require("web.OwlDialog");patch(Dialog.prototype,"Legacy Adapted Dialog",{setup(){this._super();useEffect(()=>{OwlDialog.display(this);return()=>OwlDialog.hide(this);},()=>[]);},});return __exports;});;

/* /web/static/src/legacy/legacy_views.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/legacy_views',async function(require){'use strict';let __exports={};const{Component,hooks,tags}=owl;const{useService}=require("@web/core/utils/hooks");const{useSetupAction}=require("@web/webclient/actions/action_hook");const legacyViewRegistry=require("web.view_registry");const{ViewAdapter}=require("@web/legacy/action_adapters");const Widget=require("web.Widget");const{breadcrumbsToLegacy,getGlobalState,getLocalState,searchModelStateToLegacy,}=require("@web/legacy/backend_utils");const{setScrollPosition}=require("@web/core/utils/scrolling");const{registry}=require("@web/core/registry");const{loadPublicAsset}=require("@web/core/assets");const viewRegistry=registry.category("views");function getJsClassWidget(fieldsInfo){const parsedXML=new DOMParser().parseFromString(fieldsInfo.arch,"text/xml");const key=parsedXML.documentElement.getAttribute("js_class");return legacyViewRegistry.get(key);}
const legacyViewTemplate=tags.xml`
    <ViewAdapter Component="Widget" View="View" viewInfo="viewInfo" viewParams="viewParams"
                 widget="widget" onReverseBreadcrumb="onReverseBreadcrumb" t-ref="controller"
                 t-on-scrollTo.stop="onScrollTo"/>`;function registerView(name,LegacyView){class Controller extends Component{constructor(){super(...arguments);this.vm=useService("view");this.controllerRef=hooks.useRef("controller");this.Widget=Widget;this.View=LegacyView;this.viewInfo={};let resIds;let searchModel;let searchPanel;const{globalState}=this.props;if(globalState){resIds=globalState.resIds;searchModel=searchModelStateToLegacy(globalState.searchModel);searchPanel=globalState.searchPanel;}
this.user=useService("user");const action=Object.assign({},this.props.action,{context:Object.assign({},this.user.context,this.props.action.context),});const{actionFlags,breadcrumbs=[]}=this.env.config;this.viewParams=Object.assign({},actionFlags,{action,breadcrumbs:breadcrumbsToLegacy(breadcrumbs),modelName:this.props.resModel,currentId:this.props.resId,controllerState:{currentId:"resId"in this.props?this.props.resId:this.props.state&&this.props.state.currentId,resIds:this.props.resIds||resIds,searchModel,searchPanel,},});if(this.viewParams.currentId===false){this.viewParams.currentId=undefined;this.viewParams.controllerState.currentId=undefined;}
if(this.props.mode){this.viewParams.mode=this.props.mode;}
this.widget=this.props.state&&this.props.state.__legacy_widget__;this.onReverseBreadcrumb=this.props.state&&this.props.state.__on_reverse_breadcrumb__;useSetupAction({beforeLeave:()=>this.controllerRef.comp.__widget.canBeRemoved(),getGlobalState:()=>getGlobalState(this.controllerRef.comp.exportState()),getLocalState:()=>getLocalState(this.controllerRef.comp.exportState()),});this.onScrollTo=(ev)=>{setScrollPosition(this,{left:ev.detail.left,top:ev.detail.top});};}
async willStart(){const params={resModel:this.props.resModel,views:this.props.views,context:this.props.context,};const options={actionId:this.env.config.actionId,loadActionMenus:this.props.loadActionMenus,loadIrFilters:this.props.loadIrFilters,};const viewDescriptions=await this.vm.loadViews(params,options);const result=viewDescriptions.__legacy__;const fieldsInfo=result.fields_views[this.props.type];const jsClass=getJsClassWidget(fieldsInfo);this.View=jsClass||this.View;this.viewInfo=Object.assign({},fieldsInfo,{fields:result.fields,viewFields:fieldsInfo.fields,});let controlPanelFieldsView;if(result.fields_views.search){controlPanelFieldsView=Object.assign({},result.fields_views.search,{favoriteFilters:result.filters,fields:result.fields,viewFields:result.fields_views.search.fields,});}
const{viewSwitcherEntries=[]}=this.env.config;const views=this.viewParams.action.views.filter(([,vtype])=>vtype!=="search").map(([vid,vtype])=>{const view=viewSwitcherEntries.find((v)=>v.type===vtype);if(view){return Object.assign({},view,{viewID:vid});}else{return{viewID:vid,type:vtype,multiRecord:!this.constructor.multiRecord,};}});this.viewParams.action=Object.assign({},this.viewParams.action,{controlPanelFieldsView,_views:this.viewParams.action.views,views,});}}
Controller.template=legacyViewTemplate;Controller.components={ViewAdapter};Controller.display_name=LegacyView.prototype.display_name;Controller.icon=LegacyView.prototype.icon;Controller.isMobileFriendly=LegacyView.prototype.mobile_friendly;Controller.multiRecord=LegacyView.prototype.multi_record;Controller.type=LegacyView.prototype.viewType;Controller.isLegacy=true;if(!viewRegistry.contains(name)){viewRegistry.add(name,Controller);}}
for(const[name,action]of Object.entries(legacyViewRegistry.entries())){registerView(name,action);}
legacyViewRegistry.onAdd(registerView);__exports.loadLegacyViews=loadLegacyViews;async function loadLegacyViews({orm,rpc}){if(!orm&&rpc){orm={call:(...callArgs)=>{const[model,method,args=[],kwargs={}]=callArgs;return rpc({model,method,args,kwargs});},};}
await loadPublicAsset("web.assets_backend_legacy_lazy",orm);}
return __exports;});;

/* /web/static/src/legacy/legacy_promise_error_handler.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/legacy_promise_error_handler',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");function legacyRejectPromiseHandler(env,error,originalError){if(error.name==="UncaughtPromiseError"){const isLegitError=originalError&&originalError instanceof Error;const isLegacyRPC=originalError&&originalError.legacy;if(!isLegitError&&!isLegacyRPC){error.unhandledRejectionEvent.preventDefault();return true;}}
return false;}
registry.category("error_handlers").add("legacyRejectPromiseHandler",legacyRejectPromiseHandler,{sequence:1});return __exports;});;

/* /web/static/src/legacy/legacy_rpc_error_handler.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/legacy_rpc_error_handler',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{ConnectionLostError,RPCError}=require("@web/core/network/rpc_service");const{lostConnectionHandler,rpcErrorHandler}=require("@web/core/errors/error_handlers");const errorHandlerRegistry=registry.category("error_handlers");function legacyRPCErrorHandler(env,error,originalError){if(originalError&&originalError.legacy&&originalError.message&&(originalError.message instanceof RPCError||originalError.message instanceof ConnectionLostError)){const event=originalError.event;originalError=originalError.message;if(event.isDefaultPrevented()){error.unhandledRejectionEvent.preventDefault();return true;}
event.preventDefault();if(originalError instanceof ConnectionLostError){return lostConnectionHandler(env,error,originalError);}
return rpcErrorHandler(env,error,originalError);}
return false;}
errorHandlerRegistry.add("legacyRPCErrorHandler",legacyRPCErrorHandler,{sequence:2});return __exports;});;

/* /web/static/src/legacy/root_widget.js defined in bundle 'web.assets_backend' */
odoo.define("root.widget",function(require){require("web.legacySetup");const{ComponentAdapter}=require("web.OwlCompatibility");const{Component}=owl;return new ComponentAdapter(null,{Component});});;

/* /web/static/src/legacy/systray_menu.js defined in bundle 'web.assets_backend' */
odoo.define("web.SystrayMenu",function(){return{Items:[]};});;

/* /web/static/src/legacy/systray_menu_item.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/systray_menu_item',async function(require){'use strict';let __exports={};const{ComponentAdapter}=require("web.OwlCompatibility");const legacySystrayMenu=require("web.SystrayMenu");const{registry}=require("@web/core/registry");const{Component,tags}=owl;const systrayRegistry=registry.category("systray");class SystrayItemAdapter extends ComponentAdapter{constructor(){super(...arguments);this.env=Component.env;}}
const legacySystrayMenuItems=legacySystrayMenu.Items;const convertedItems=[];let id=1;const legacySystrayItemTemplate=tags.xml`<SystrayItemAdapter Component="Widget" />`;function addSystrayItem(Widget){const name=`_legacy_systray_item_${id++}`;class SystrayItem extends Component{constructor(){super(...arguments);this.Widget=Widget;}}
SystrayItem.template=legacySystrayItemTemplate;SystrayItem.components={SystrayItemAdapter};systrayRegistry.add(name,{Component:SystrayItem},{sequence:Widget.prototype.sequence});convertedItems.push(Widget);}
legacySystrayMenuItems.forEach(addSystrayItem);const push=legacySystrayMenuItems.push.bind(legacySystrayMenuItems);legacySystrayMenuItems.push=function(Widget){push(Widget);addSystrayItem(Widget);};const splice=legacySystrayMenuItems.splice.bind(legacySystrayMenuItems);legacySystrayMenuItems.splice=function(){splice(...arguments);legacySystrayMenuItems.forEach((Widget)=>{if(!convertedItems.includes(Widget)){addSystrayItem(Widget);}});};return __exports;});;

/* /web/static/src/legacy/backend_utils.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/backend_utils',async function(require){'use strict';let __exports={};const ActionModel=require("@web/legacy/js/views/action_model")[Symbol.for("default")];const{makeContext}=require("@web/core/context");function searchModelStateFromLegacy(state){const parsedState=JSON.parse(state);const newState={};if(parsedState.ControlPanelModelExtension){const{query,filters,nextGroupId,nextGroupNumber,nextId,}=parsedState.ControlPanelModelExtension;newState.nextGroupId=nextGroupId;newState.nextGroupNumber=nextGroupNumber;newState.nextId=nextId;newState.query=[];newState.searchItems={};for(const queryElem of query){const filterId=queryElem.filterId;const filter=filters[filterId];const newQueryElem={searchItemId:filterId};switch(filter.type){case"filter":if(filter.hasOptions){newQueryElem.generatorId=queryElem.optionId;}
break;case"groupBy":if(filter.hasOptions){newQueryElem.intervalId=queryElem.optionId;}
break;case"field":newQueryElem.autocompleteValue={value:queryElem.value,label:queryElem.label,operator:queryElem.operator,};break;}
newState.query.push(newQueryElem);}
for(const filter of Object.values(filters)){const item=Object.assign({},filter);switch(item.type){case"groupBy":if(filter.hasOptions){item.type="dateGroupBy";item.defaultIntervalId=item.defaultOptionId;delete item.hasOptions;delete item.defaultOptionId;}
break;case"filter":if(filter.hasOptions){item.type="dateFilter";item.defaultGeneratorId=item.defaultOptionId;delete item.hasOptions;delete item.isDateFilter;delete item.defaultOptionId;}
break;case"favorite":item.orderBy=item.orderedBy;delete item.orderedBy;break;}
newState.searchItems[filter.id]=item;}}
if(parsedState.SearchPanelModelExtension){const{sections,searchPanelInfo}=parsedState.SearchPanelModelExtension;newState.sections=sections;newState.searchPanelInfo=searchPanelInfo;}
for(const[key,extension]of Object.entries(ActionModel.registry.entries())){if(!["ControlPanel","SearchPanel"].includes(key)&&parsedState[extension.name]!==undefined){newState[key]=parsedState[extension.name];}}
if(!Object.keys(newState).length){return;}
return JSON.stringify(newState);}
__exports.searchModelStateToLegacy=searchModelStateToLegacy;function searchModelStateToLegacy(state){if(!state){return;}
const parsedState=JSON.parse(state);const query=[];for(const queryElem of parsedState.query){const searchItemId=queryElem.searchItemId;const searchItem=parsedState.searchItems[searchItemId];const groupId=searchItem.groupId;const legacyQueryElem={filterId:searchItemId,groupId};switch(searchItem.type){case"dateFilter":legacyQueryElem.optionId=queryElem.generatorId;break;case"dateGroupBy":legacyQueryElem.optionId=queryElem.intervalId;break;case"comparison":legacyQueryElem.type="comparison";legacyQueryElem.dateFilterId=searchItem.dateFilterId;break;case"field":legacyQueryElem.value=queryElem.autocompleteValue.value;legacyQueryElem.label=queryElem.autocompleteValue.label;legacyQueryElem.operator=queryElem.autocompleteValue.operator;break;}
query.push(legacyQueryElem);}
const filters={};for(const item of Object.values(parsedState.searchItems)){const filter=Object.assign({},item);switch(item.type){case"dateGroupBy":filter.type="groupBy";filter.hasOptions=true;filter.defaultOptionId=item.defaultIntervalId;delete filter.defaultIntervalId;break;case"dateFilter":filter.type="filter";filter.isDateFilter=true;filter.hasOptions=true;filter.defaultOptionId=item.defaultGeneratorId;delete filter.defaultGeneratorId;break;case"favorite":filter.orderedBy=item.orderBy;delete filter.orderBy;break;case"filter":let context=item.context;try{context=makeContext([context]);}catch(e){}
filter.context=context;}
filters[item.id]=filter;}
const{nextGroupId,nextGroupNumber,nextId,sections,searchPanelInfo}=parsedState;const legacyState={};legacyState.ControlPanelModelExtension={query,filters,nextGroupId,nextGroupNumber,nextId,};legacyState.SearchPanelModelExtension={sections,searchPanelInfo};for(const[key,extension]of Object.entries(ActionModel.registry.entries())){if(!["ControlPanel","SearchPanel"].includes(key)&&parsedState[key]!==undefined){legacyState[extension.name]=parsedState[key];}}
return JSON.stringify(legacyState);}
__exports.getGlobalState=getGlobalState;function getGlobalState(legacyControllerState){const{resIds,searchModel,searchPanel}=legacyControllerState;const globalState={};if(searchPanel){globalState.searchPanel=searchPanel;}
if(resIds){globalState.resIds=resIds;}
const newSearchModel=searchModelStateFromLegacy(searchModel);if(newSearchModel){globalState.searchModel=newSearchModel;}
return globalState;}
__exports.getLocalState=getLocalState;function getLocalState(legacyControllerState){const state=Object.assign({},legacyControllerState);delete state.searchModel;delete state.searchPanel;delete state.resIds;return state;}
__exports.mapDoActionOptionAPI=mapDoActionOptionAPI;function mapDoActionOptionAPI(legacyOptions){legacyOptions=legacyOptions||{};Object.assign(legacyOptions,{additionalContext:legacyOptions.additional_context,clearBreadcrumbs:legacyOptions.clear_breadcrumbs,viewType:legacyOptions.view_type,onClose:legacyOptions.on_close,props:Object.assign({resId:legacyOptions.res_id},legacyOptions.props),});if(legacyOptions.controllerState){legacyOptions.props.globalState=getGlobalState(legacyOptions.controllerState);}
delete legacyOptions.additional_context;delete legacyOptions.clear_breadcrumbs;delete legacyOptions.view_type;delete legacyOptions.res_id;delete legacyOptions.on_close;return legacyOptions;}
__exports.makeLegacyActionManagerService=makeLegacyActionManagerService;function makeLegacyActionManagerService(legacyEnv){return{dependencies:["action"],start(env){function do_action(action,options){const legacyOptions=mapDoActionOptionAPI(options);return env.services.action.doAction(action,legacyOptions);}
legacyEnv.bus.on("do-action",null,(payload)=>{const{action,options}=payload;do_action(action,options);});return{do_action};},};}
__exports.breadcrumbsToLegacy=breadcrumbsToLegacy;function breadcrumbsToLegacy(breadcrumbs){if(!breadcrumbs){return;}
return breadcrumbs.slice().map((bc)=>{return{title:bc.name,controllerID:bc.jsId};});}
return __exports;});;

/* /web/static/src/legacy/utils.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/utils',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const AbstractStorageService=require("web.AbstractStorageService");const{ConnectionAbortedError,RPCError,makeErrorFromResponse,ConnectionLostError,}=require("@web/core/network/rpc_service");const{ErrorDialog}=require("@web/core/errors/error_dialogs");__exports.makeLegacyRpcService=makeLegacyRpcService;function makeLegacyRpcService(legacyEnv){return{start(env){legacyEnv.bus.on("rpc_request",null,(rpcId)=>{env.bus.trigger("RPC:REQUEST",rpcId);});legacyEnv.bus.on("rpc_response",null,(rpcId)=>{env.bus.trigger("RPC:RESPONSE",rpcId);});legacyEnv.bus.on("rpc_response_failed",null,(rpcId)=>{env.bus.trigger("RPC:RESPONSE",rpcId);});},};}
__exports.makeLegacyDialogMappingService=makeLegacyDialogMappingService;function makeLegacyDialogMappingService(legacyEnv){return{dependencies:["ui","hotkey"],start(env){const{ui,hotkey}=env.services;function getModalEl(dialog){return dialog.modalRef?dialog.modalRef.el:dialog.$modal[0];}
function getCloseCallback(dialog){return dialog.modalRef?()=>dialog._close():()=>dialog.$modal.modal("hide");}
const dialogHotkeyRemoveMap=new Map();function onOpenDialog(dialog){ui.activateElement(getModalEl(dialog));const remove=hotkey.add("escape",getCloseCallback(dialog));dialogHotkeyRemoveMap.set(dialog,remove);}
function onCloseDialog(dialog){ui.deactivateElement(getModalEl(dialog));if(dialogHotkeyRemoveMap.has(dialog)){const removeHotkey=dialogHotkeyRemoveMap.get(dialog);removeHotkey();dialogHotkeyRemoveMap.delete(dialog);}}
legacyEnv.bus.on("legacy_dialog_opened",null,onOpenDialog);legacyEnv.bus.on("legacy_dialog_destroyed",null,onCloseDialog);legacyEnv.bus.on("owl_dialog_mounted",null,onOpenDialog);legacyEnv.bus.on("owl_dialog_willunmount",null,onCloseDialog);},};}
__exports.makeLegacyCommandService=makeLegacyCommandService;function makeLegacyCommandService(legacyEnv){return{dependencies:["command"],start(env){const{command}=env.services;const commandRemoveMap=new Map();function setLegacyCommand(uniqueId,getCommandDefinition){const{name,action,options}=getCommandDefinition(env);removeLegacyCommand(uniqueId);commandRemoveMap.set(uniqueId,command.add(name,action,options));}
function removeLegacyCommand(uniqueId){if(commandRemoveMap.has(uniqueId)){const removeCommand=commandRemoveMap.get(uniqueId);removeCommand();commandRemoveMap.delete(uniqueId);}}
legacyEnv.bus.on("set_legacy_command",null,setLegacyCommand);legacyEnv.bus.on("remove_legacy_command",null,removeLegacyCommand);},};}
__exports.makeLegacyDropdownService=makeLegacyDropdownService;function makeLegacyDropdownService(legacyEnv){return{dependencies:["ui","hotkey"],start(_,{ui,hotkey}){legacyEnv.services.ui=ui;legacyEnv.services.hotkey=hotkey;},};}
__exports.makeLegacySessionService=makeLegacySessionService;function makeLegacySessionService(legacyEnv,session){return{dependencies:["user"],start(env){function mapContext(){return Object.assign({},env.services.user.context);}
Object.defineProperty(legacyEnv.session,"userContext",{get:()=>mapContext(),});Object.defineProperty(session,"user_context",{get:()=>mapContext(),});},};}
__exports.mapLegacyEnvToWowlEnv=mapLegacyEnvToWowlEnv;function mapLegacyEnvToWowlEnv(legacyEnv,wowlEnv){legacyEnv.session.rpc=(...args)=>{let rejection;const prom=new Promise((resolve,reject)=>{const[route,params,settings={}]=args;if(params&&params.kwargs){params.kwargs.context=Object.assign(params.kwargs.context||{},legacyEnv.session.user_context);}
const jsonrpc=wowlEnv.services.rpc(route,params,{silent:settings.shadow,xhr:settings.xhr,});rejection=()=>{jsonrpc.abort();};jsonrpc.then(resolve).catch((reason)=>{if(reason instanceof RPCError||reason instanceof ConnectionLostError){reject({message:reason,event:$.Event(),legacy:true});}else if(reason instanceof ConnectionAbortedError){reject({message:reason.message,event:$.Event("abort")});}else{reject(reason);}});});prom.abort=rejection;return prom;};function mapStorage(storage){const StorageService=AbstractStorageService.extend({storage});return new StorageService();}
legacyEnv.services.local_storage=mapStorage(browser.localStorage);legacyEnv.services.session_storage=mapStorage(browser.sessionStorage);wowlEnv.bus.on("WEB_CLIENT_READY",null,()=>{legacyEnv.bus.trigger("web_client_ready");});wowlEnv.bus.on("SCROLLER:ANCHOR_LINK_CLICKED",null,(payload)=>{legacyEnv.bus.trigger("SCROLLER:ANCHOR_LINK_CLICKED",payload);});legacyEnv.bus.on("clear_cache",null,()=>{wowlEnv.bus.trigger("CLEAR-CACHES");});}
const reBSTooltip=/^bs-.*$/;__exports.cleanDomFromBootstrap=cleanDomFromBootstrap;function cleanDomFromBootstrap(){const body=document.body;const tooltips=body.querySelectorAll("body .tooltip");for(const tt of tooltips){if(Array.from(tt.classList).find((cls)=>reBSTooltip.test(cls))){tt.parentNode.removeChild(tt);}}}
__exports.makeLegacyNotificationService=makeLegacyNotificationService;function makeLegacyNotificationService(legacyEnv){return{dependencies:["notification"],start(env){let notifId=0;const idsToRemoveFn={};function notify({title,message,subtitle,buttons=[],sticky,type,className,onClose,}){if(subtitle){title=[title,subtitle].filter(Boolean).join(" ");}
if(!message&&title){message=title;title=undefined;}
buttons=buttons.map((button)=>{return{name:button.text,icon:button.icon,primary:button.primary,onClick:button.click,};});const removeFn=env.services.notification.add(_.escape(message),{sticky,title,type,className,onClose,buttons,messageIsHtml:true,});const id=++notifId;idsToRemoveFn[id]=removeFn;return id;}
function close(id,_,wait){const removeFn=idsToRemoveFn[id];delete idsToRemoveFn[id];if(wait){browser.setTimeout(()=>{removeFn(id);},wait);}else{removeFn(id);}}
legacyEnv.services.notification={notify,close};},};}
__exports.makeLegacyCrashManagerService=makeLegacyCrashManagerService;function makeLegacyCrashManagerService(legacyEnv){return{dependencies:["dialog"],start(env){legacyEnv.services.crash_manager={show_message(message){env.services.dialog.add(ErrorDialog,{traceback:message});},rpc_error(errorResponse){Promise.reject(makeErrorFromResponse(errorResponse));},};},};}
__exports.wrapSuccessOrFail=wrapSuccessOrFail;function wrapSuccessOrFail(promise,{on_success,on_fail}={}){return promise.then(on_success||(()=>{})).catch((reason)=>{let alreadyThrown=false;if(on_fail){alreadyThrown=on_fail(reason)==="alreadyThrown";}
if(reason instanceof Error&&!alreadyThrown){throw reason;}});}
__exports.makeLegacyRainbowManService=makeLegacyRainbowManService;function makeLegacyRainbowManService(legacyEnv){return{dependencies:["effect"],start(env,{effect}){legacyEnv.bus.on("show-effect",null,(payload)=>{effect.add(payload);});},};}
return __exports;});;

/* /web/static/src/legacy/web_client.js defined in bundle 'web.assets_backend' */
odoo.define("web.web_client",function(){return{};});odoo.define("web.pseudo_web_client",function(require){const FakeWebClient=require("web.web_client");function makeLegacyWebClientService(legacyEnv){const legacyPseudoWebClient={dependencies:["title","router"],start(env){function setTitlePart(part,title=null){env.services.title.setParts({[part]:title});}
legacyEnv.bus.on("set_title_part",null,(params)=>{const{part,title}=params;setTitlePart(part,title||null);});Object.assign(FakeWebClient,{do_push_state(state){if("title"in state){setTitlePart("action",state.title);delete state.title;}
env.services.router.pushState(state);},set_title(title){setTitlePart("action",title);},});},};return legacyPseudoWebClient;}
return makeLegacyWebClientService;});;

/* /web/static/src/legacy/js/_deprecated/basic_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.basic_fields.deprecated',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var _lt=core._lt;var FieldBoolean=AbstractField.extend({className:'o_field_boolean',description:_lt("Checkbox"),events:_.extend({},AbstractField.prototype.events,{change:'_onChange',}),supportedFieldTypes:['boolean'],activate:function(options){var activated=this._super.apply(this,arguments);if(activated&&options&&options.event&&$(options.event.target).closest('.custom-control.custom-checkbox').length){this._setValue(!this.value);}
return activated;},getFocusableElement:function(){return this.mode==='readonly'?$():this.$input;},isSet:function(){return true;},reset:function(record,event){var rendered=this._super.apply(this,arguments);if(event&&event.target.name===this.name){this.activate();}
return rendered;},setIDForLabel:function(id){this._super.apply(this,arguments);this.$('.custom-control-label').attr('for',id);},_quickEdit:function(extraInfo){this._super(...arguments);this._setValue(extraInfo.value===undefined?!this.value:extraInfo.value);},_getQuickEditExtraInfo(){return{value:!this.value,};},_render:function(){var $checkbox=this._formatValue(this.value);this.$input=$checkbox.find('input');this.$input.prop('disabled',this.hasReadonlyModifier);this.$el.addClass($checkbox.attr('class'));this.$el.empty().append($checkbox.contents());},_onChange:function(){this._setValue(this.$input[0].checked);},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.ENTER:ev.preventDefault();this.$input.prop('checked',!this.value);this._setValue(!this.value);return;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:ev.preventDefault();}
this._super.apply(this,arguments);},});return{FieldBoolean:FieldBoolean,};});;

/* /web/static/src/legacy/js/_deprecated/crash_manager_warning_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/_deprecated/crash_manager_warning_dialog',async function(require){'use strict';let __exports={};const Dialog=require("web.Dialog");const core=require("web.core");const WarningDialog=__exports.WarningDialog=Dialog.extend({template:'web.LegacyWarningDialog',init:function(parent,options,error){options.size=options.size||"medium";this._super.apply(this,[parent,options]);this.message=error.message;core.bus.off('close_dialogs',this);},open:function(){this._super({shouldFocusButtons:true});},});return __exports;});;

/* /web/static/src/legacy/js/_deprecated/data.js defined in bundle 'web.assets_backend' */
odoo.define('web.data',function(require){"use strict";var Class=require('web.Class');var Context=require('web.Context');var concurrency=require('web.concurrency');var mixins=require('web.mixins');var session=require('web.session');var translation=require('web.translation');var pyUtils=require('web.py_utils');var _t=translation._t;function serialize_sort(criterion){return _.map(criterion,function(criteria){if(criteria[0]==='-'){return criteria.slice(1)+' DESC';}
return criteria+' ASC';}).join(', ');}
function deserialize_sort(criterion){return _.map(criterion,function(criteria){var split=_.without(criteria.split(' '),'');return(split[1]&&split[1].toLowerCase()==='desc'?'-':'')+split[0];});}
var Query=Class.extend({init:function(model,fields){this._model=model;this._fields=fields;this._filter=[];this._context={};this._lazy=true;this._limit=false;this._offset=0;this._order_by=[];},clone:function(to_set){to_set=to_set||{};var q=new Query(this._model,this._fields);q._context=this._context;q._filter=this._filter;q._lazy=this._lazy;q._limit=this._limit;q._offset=this._offset;q._order_by=this._order_by;for(var key in to_set){if(!to_set.hasOwnProperty(key)){continue;}
switch(key){case'filter':q._filter=(q._filter||[]).concat(to_set.filter||[]);break;case'context':q._context=new Context(q._context,to_set.context);break;case'lazy':case'limit':case'offset':case'order_by':q['_'+key]=to_set[key];}}
return q;},_execute:function(options){var self=this;options=options||{};return session.rpc('/web/dataset/search_read',{model:this._model.name,fields:this._fields||false,domain:pyUtils.eval('domains',[this._model.domain(this._filter)]),context:pyUtils.eval('contexts',[this._model.context(this._context)]),offset:this._offset,limit:this._limit,sort:serialize_sort(this._order_by)},options).then(function(results){self._count=results.length;return results.records;},null);},first:function(options){var self=this;return this.clone({limit:1})._execute(options).then(function(records){delete self._count;if(records.length){return records[0];}
return null;});},all:function(options){return this._execute(options);},count:function(){if(this._count!==undefined){return Promise.resolve(this._count);}
return this._model.call('search_count',[this._filter],{context:this._model.context(this._context)});},group_by:function(grouping){var ctx=pyUtils.eval('context',this._model.context(this._context));if(_.isUndefined(grouping)){grouping=[];}
if(!(grouping instanceof Array)){grouping=_.toArray(arguments);}
if(_.isEmpty(grouping)&&!ctx.group_by_no_leaf){return null;}
var raw_fields=_.map(grouping.concat(this._fields||[]),function(field){return field.split(':')[0];});var self=this;return this._model.call('read_group',{groupby:grouping,fields:_.uniq(raw_fields),domain:this._model.domain(this._filter),context:ctx,offset:this._offset,lazy:this._lazy,limit:this._limit,orderby:serialize_sort(this._order_by)||false}).then(function(results){return _(results).map(function(result){result.__context=result.__context||{};result.__context.group_by=result.__context.group_by||[];_.defaults(result.__context,ctx);var grouping_fields=self._lazy?[grouping[0]]:grouping;return new QueryGroup(self._model.name,grouping_fields,result);});});},context:function(context){if(!context){return this;}
return this.clone({context:context});},filter:function(domain){if(!domain){return this;}
return this.clone({filter:domain});},lazy:function(lazy){return this.clone({lazy:lazy});},limit:function(limit){return this.clone({limit:limit});},offset:function(offset){return this.clone({offset:offset});},order_by:function(fields){if(fields===undefined){return this;}
if(!(fields instanceof Array)){fields=_.toArray(arguments);}
if(_.isEmpty(fields)){return this;}
return this.clone({order_by:fields});}});var QueryGroup=Class.extend({init:function(model,grouping_fields,read_group_group){var fixed_group=_.extend({__context:{group_by:[]},__domain:[]},read_group_group);var count_key=(grouping_fields[0]&&grouping_fields[0].split(':')[0])+'_count';var aggregates={};for(var key in fixed_group){if(fixed_group.hasOwnProperty(key)){if(!(key.indexOf('__')===0||_.contains(grouping_fields,key)||(key===count_key))){aggregates[key]=fixed_group[key]||0;}}}
this.model=new Model(model,fixed_group.__context,fixed_group.__domain);var group_size=fixed_group[count_key]||fixed_group.__count||0;var leaf_group=fixed_group.__context.group_by.length===0;var value=(grouping_fields.length===1)?fixed_group[grouping_fields[0]]:_.map(grouping_fields,function(field){return fixed_group[field];});var grouped_on=(grouping_fields.length===1)?grouping_fields[0]:grouping_fields;this.attributes={folded:!!(fixed_group.__fold),grouped_on:grouped_on,length:group_size,value:value,has_children:!(leaf_group&&fixed_group.__context.group_by_no_leaf),aggregates:aggregates};},get:function(key){return this.attributes[key];},subgroups:function(){return this.model.query().group_by(this.model.context().group_by);},query:function(){return this.model.query.apply(this.model,arguments);}});var DataSet=Class.extend(mixins.PropertiesMixin,{init:function(parent,model,context){mixins.PropertiesMixin.init.call(this);this.setParent(parent);this.model=model;this.context=context||{};this.index=null;this._sort=[];this._model=new Model(model,context);this.orderer=new concurrency.DropMisordered();},previous:function(){this.index-=1;if(!this.ids.length){this.index=null;}else if(this.index<0){this.index=this.ids.length-1;}
return this;},next:function(){this.index+=1;if(!this.ids.length){this.index=null;}else if(this.index>=this.ids.length){this.index=0;}
return this;},select_id:function(id){var idx=this.get_id_index(id);if(idx===null){return false;}else{this.index=idx;return true;}},get_id_index:function(id){for(var i=0,ii=this.ids.length;i<ii;i++){if(id==this.ids[i]){return i;}}
return null;},read_ids:function(ids,fields,options){if(_.isEmpty(ids)){return Promise.resolve([]);}
options=options||{};var method='read';var ids_arg=ids;var context=this.get_context(options.context);if(options.check_access_rule===true){method='search_read';ids_arg=[['id','in',ids]];context=new Context(context,{active_test:false});}
return this._model.call(method,[ids_arg,fields||false],{context:context}).then(function(records){if(records.length<=1){return records;}
var indexes={};for(var i=0;i<ids.length;i++){indexes[ids[i]]=i;}
records.sort(function(a,b){return indexes[a.id]-indexes[b.id];});return records;});},read_slice:function(fields,options){var self=this;options=options||{};var query=this._model.query(fields).limit(options.limit||false).offset(options.offset||0).all();var prom=this.orderer.add(query);prom.then(function(records){self.ids=_(records).pluck('id');});return prom;},read_index:function(fields,options){options=options||{};return this.read_ids([this.ids[this.index]],fields,options).then(function(records){if(_.isEmpty(records)){return Promise.reject();}
return records[0];});},default_get:function(fields,options){options=options||{};return this._model.call('default_get',[fields],{context:this.get_context(options.context)});},create:function(data,options){var self=this;var prom=this._model.call('create',[data],{context:this.get_context()});prom.then(function(){self.trigger('dataset_changed',data,options);});return prom;},write:function(id,data,options){options=options||{};var self=this;var prom=this._model.call('write',[[id],data],{context:this.get_context(options.context)});prom.then(function(){self.trigger('dataset_changed',id,data,options);});return prom;},unlink:function(ids){var self=this;var prom=this._model.call('unlink',[ids],{context:this.get_context()});prom.then(function(){self.trigger('dataset_changed',ids);});return prom;},call:function(method,args){return this._model.call(method,args);},call_button:function(method,args){return this._model.call_button(method,args);},name_get:function(ids){return this._model.call('name_get',[ids],{context:this.get_context()});},name_search:function(name,domain,operator,limit){return this._model.call('name_search',{name:name||'',args:domain||false,operator:operator||'ilike',context:this._model.context(),limit:limit||0});},name_create:function(name,context){return this._model.call('name_create',[name],{context:this.get_context(context)});},get_context:function(request_context){return this._model.context(request_context);},sort:function(field,force_reverse){if(!field){return serialize_sort(this._sort);}
var reverse=force_reverse||(this._sort[0]===field);this._sort.splice.apply(this._sort,[0,this._sort.length].concat(_.without(this._sort,field,'-'+field)));this._sort.unshift((reverse?'-':'')+field);return undefined;},set_sort:function(fields_list){this._sort=deserialize_sort(fields_list);},size:function(){return this.ids.length;},alter_ids:function(n_ids){this.ids=n_ids;},remove_ids:function(ids){this.alter_ids(_(this.ids).difference(ids));},add_ids:function(ids,at){var args=[at,0].concat(_.difference(ids,this.ids));this.ids.splice.apply(this.ids,args);},resequence:function(ids,options){options=options||{};return session.rpc('/web/dataset/resequence',{model:this.model,ids:ids,context:pyUtils.eval('context',this.get_context(options.context)),}).then(function(results){return results;});},});var DataSetStatic=DataSet.extend({init:function(parent,model,context,ids){this._super(parent,model,context);this.ids=ids||[];},read_slice:function(fields,options){options=options||{};fields=fields||{};var offset=options.offset||0,limit=options.limit||false;var end_pos=limit&&limit!==-1?offset+limit:this.ids.length;return this.read_ids(this.ids.slice(offset,end_pos),fields,options);},set_ids:function(ids){this.ids=ids;if(ids.length===0){this.index=null;}else if(this.index>=ids.length-1){this.index=ids.length-1;}},unlink:function(ids){this.set_ids(_.without.apply(null,[this.ids].concat(ids)));this.trigger('unlink',ids);return Promise.resolve({result:true});},});var DataSetSearch=DataSet.extend({init:function(parent,model,context,domain){this._super(parent,model,context);this.domain=domain||[];this._length=null;this.ids=[];this._model=new Model(model,context,domain);},read_slice:function(fields,options){options=options||{};var self=this;var q=this._model.query(fields||false).filter(options.domain).context(options.context).offset(options.offset||0).limit(options.limit||false);q=q.order_by.apply(q,this._sort);var prom=this.orderer.add(q.all());prom.then(function(records){q.count().then(function(count){self._length=count;});self.ids=_(records).pluck('id');});return prom;},get_domain:function(other_domain){return this._model.domain(other_domain);},alter_ids:function(ids){this._super(ids);if(this.index!==null&&this.index>=this.ids.length){this.index=this.ids.length>0?this.ids.length-1:0;}},remove_ids:function(ids){var before=this.ids.length;this._super(ids);if(this._length){this._length-=(before-this.ids.length);}},add_ids:function(ids,at){var before=this.ids.length;this._super(ids,at);if(this._length){this._length+=(this.ids.length-before);}},unlink:function(ids,callback,error_callback){var self=this;var prom=this._super(ids);prom.then(function(){self.remove_ids(ids);self.trigger("dataset_changed",ids,callback,error_callback);});return prom;},size:function(){if(this._length!==null){return this._length;}
return this._super();}});var data={Query:Query,DataSet:DataSet,DataSetStatic:DataSetStatic,DataSetSearch:DataSetSearch,noDisplayContent:"<em class=\"text-warning\">"+_t("Unnamed")+"</em>",};var Model=Class.extend({init:function(name,context,domain){this.name=name;this._context=context||{};this._domain=domain||[];},get_func:function(method_name){var self=this;return function(){return self.call(method_name,_.toArray(arguments));};},query:function(fields){return new data.Query(this,fields);},domain:function(domain){if(!domain){return this._domain;}
return this._domain.concat(domain);},context:function(context){return new Context(session.user_context,this._context,context||{});},call:function(method,args,kwargs,options){args=args||[];kwargs=kwargs||{};if(!_.isArray(args)){kwargs=args;args=[];}
pyUtils.ensure_evaluated(args,kwargs);var call_kw='/web/dataset/call_kw/'+this.name+'/'+method;return session.rpc(call_kw,{model:this.name,method:method,args:args,kwargs:kwargs},options);},call_button:function(method,args){pyUtils.ensure_evaluated(args,{});var context=(args||[]).length>0?args.pop():{};return session.rpc('/web/dataset/call_button',{model:this.name,method:method,args:args||[],kwargs:{context:context},});},});return data;});;

/* /web/static/src/legacy/js/chrome/abstract_action.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/chrome/abstract_action',async function(require){'use strict';let __exports={};const ActionMixin=require("web.ActionMixin");const ActionModel=require("web.ActionModel");const ControlPanel=require("web.ControlPanel");const Widget=require("web.Widget");const{ComponentWrapper}=require("web.OwlCompatibility");const AbstractAction=Widget.extend(ActionMixin,{config:{ControlPanel:ControlPanel,},hasControlPanel:false,loadControlPanel:false,withSearchBar:false,searchMenuTypes:[],init:function(parent,action,options){this._super(parent);this._title=action.display_name||action.name;this.searchModelConfig={context:Object.assign({},action.context),domain:action.domain||[],env:owl.Component.env,searchMenuTypes:this.searchMenuTypes,};this.extensions={};if(this.hasControlPanel){this.extensions.ControlPanel={actionId:action.id,withSearchBar:this.withSearchBar,};this.viewId=action.search_view_id&&action.search_view_id[0];this.controlPanelProps={action,breadcrumbs:options&&options.breadcrumbs,withSearchBar:this.withSearchBar,searchMenuTypes:this.searchMenuTypes,};}},willStart:async function(){const superPromise=this._super(...arguments);if(this.hasControlPanel){if(this.loadControlPanel){const{context,modelName}=this.searchModelConfig;const options={load_filters:this.searchMenuTypes.includes('favorite')};const{arch,fields,favoriteFilters}=await this.loadFieldView(modelName,context||{},this.viewId,'search',options);const archs={search:arch};const{ControlPanel:controlPanelInfo}=ActionModel.extractArchInfo(archs);Object.assign(this.extensions.ControlPanel,{archNodes:controlPanelInfo.children,favoriteFilters,fields,});this.controlPanelProps.fields=fields;}}
this.searchModel=new ActionModel(this.extensions,this.searchModelConfig);if(this.hasControlPanel){this.controlPanelProps.searchModel=this.searchModel;}
return Promise.all([superPromise,this.searchModel.load(),]);},start:async function(){await this._super(...arguments);if(this.hasControlPanel){if('title'in this.controlPanelProps){this._setTitle(this.controlPanelProps.title);}
this.controlPanelProps.title=this.getTitle();this._controlPanelWrapper=new ComponentWrapper(this,this.config.ControlPanel,this.controlPanelProps);await this._controlPanelWrapper.mount(this.el,{position:'first-child'});}},destroy:function(){this._super.apply(this,arguments);ActionMixin.destroy.call(this);},on_attach_callback:function(){ActionMixin.on_attach_callback.call(this);this.searchModel.on('search',this,this._onSearch);if(this.hasControlPanel){this.searchModel.on('get-controller-query-params',this,this._onGetOwnedQueryParams);}},on_detach_callback:function(){ActionMixin.on_detach_callback.call(this);this.searchModel.off('search',this);if(this.hasControlPanel){this.searchModel.off('get-controller-query-params',this);}},_onSearch:function(){},});__exports[Symbol.for("default")]=AbstractAction;return __exports;});odoo.define(`web.AbstractAction`,async function(require){return require('@web/legacy/js/chrome/abstract_action')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/chrome/action_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web.ActionMixin',function(require){"use strict";const core=require('web.core');const{WidgetAdapterMixin}=require('web.OwlCompatibility');const ActionMixin=Object.assign({},WidgetAdapterMixin,{template:'Action',contentTemplate:null,custom_events:{get_controller_query_params:'_onGetOwnedQueryParams',},_controlPanel:null,_title:'',renderElement:function(){this._super.apply(this,arguments);if(this.contentTemplate){const content=core.qweb.render(this.contentTemplate,{widget:this});this.$('.o_content').append(content);}},willRestore:function(){},canBeRemoved:function(){return Promise.resolve();},getOwnedQueryParams:function(){return{};},getState:function(){return{};},getTitle:function(){return this._title;},renderButtons:function($node){},updateButtons:function(){},updateControlPanel:async function(newProps={}){if(!this.withControlPanel&&!this.hasControlPanel){return;}
const props=Object.assign({},newProps);if('title'in props){this._setTitle(props.title);this.controlPanelProps.title=this.getTitle();delete props.title;}
if('cp_content'in props){this.controlPanelProps.cp_content=Object.assign({},this.controlPanelProps.cp_content,props.cp_content,);delete props.cp_content;}
Object.assign(this.controlPanelProps,props);return this._controlPanelWrapper.update(this.controlPanelProps);},_setTitle:function(title){this._title=title;},_onGetOwnedQueryParams:function(callback){const state=this.getOwnedQueryParams();callback(state||{});},});return ActionMixin;});;

/* /web/static/src/legacy/js/components/action_menus.js defined in bundle 'web.assets_backend' */
odoo.define('web.ActionMenus',function(require){"use strict";const Context=require('web.Context');const DropdownMenu=require('web.DropdownMenu');const Registry=require('web.Registry');const{Component}=owl;let registryActionId=1;class ActionMenus extends Component{async willStart(){this.actionItems=await this._setActionItems(this.props);this.printItems=await this._setPrintItems(this.props);}
async willUpdateProps(nextProps){this.actionItems=await this._setActionItems(nextProps);this.printItems=await this._setPrintItems(nextProps);}
mounted(){this._addTooltips();}
patched(){this._addTooltips();}
_addTooltips(){$(this.el.querySelectorAll('[title]')).tooltip({delay:{show:500,hide:0}});}
async _setActionItems(props){const callbackActions=(props.items.other||[]).map(action=>Object.assign({key:`action-${action.description}`},action));const actionActions=props.items.action||[];const relateActions=props.items.relate||[];const formattedActions=[...actionActions,...relateActions].map(action=>({action,description:action.name,key:action.id}));const registryActions=[];const rpc=this.rpc.bind(this);for(const{Component,getProps}of this.constructor.registry.values()){const itemProps=await getProps(props,this.env,rpc);if(itemProps){registryActions.push({Component,key:`registry-action-${registryActionId++}`,props:itemProps,});}}
return[...callbackActions,...formattedActions,...registryActions];}
async _setPrintItems(props){const printActions=props.items.print||[];const printItems=printActions.map(action=>({action,description:action.name,key:action.id}));return printItems;}
async _executeAction(action){let activeIds=this.props.activeIds;if(this.props.isDomainSelected){activeIds=await this.rpc({model:this.env.action.res_model,method:'search',args:[this.props.domain],kwargs:{limit:this.env.session.active_ids_limit,context:this.props.context,},});}
const activeIdsContext={active_id:activeIds[0],active_ids:activeIds,active_model:this.env.action.res_model,};if(this.props.domain){activeIdsContext.active_domain=this.props.domain;}
const context=new Context(this.props.context,activeIdsContext).eval();const result=await this.rpc({route:'/web/action/load',params:{action_id:action.id,context},});result.context=new Context(result.context||{},activeIdsContext).set_eval_context(context);result.flags=result.flags||{};result.flags.new_window=true;this.trigger('do-action',{action:result,options:{on_close:()=>this.trigger('reload'),},});}
_onItemSelected(ev){ev.stopPropagation();const{item}=ev.detail;if(item.callback){item.callback([item]);}else if(item.action){this._executeAction(item.action);}else if(item.url){this.env.services.navigate(item.url);}}}
ActionMenus.registry=new Registry();ActionMenus.components={DropdownMenu};ActionMenus.props={activeIds:{type:Array,element:[Number,String]},context:Object,domain:{type:Array,optional:1},isDomainSelected:{type:Boolean,optional:1},items:{type:Object,shape:{action:{type:Array,optional:1},print:{type:Array,optional:1},other:{type:Array,optional:1},},},};ActionMenus.template='web.ActionMenus';return ActionMenus;});;

/* /web/static/src/legacy/js/components/custom_checkbox.js defined in bundle 'web.assets_backend' */
odoo.define('web.CustomCheckbox',function(require){"use strict";const utils=require('web.utils');const{Component}=owl;class CustomCheckbox extends Component{constructor(){super(...arguments);this._id=`checkbox-comp-${utils.generateID()}`;}}
CustomCheckbox.props={id:{type:[String,Number],optional:1,},disabled:{type:Boolean,optional:1,},value:{type:Boolean,optional:1,},text:{type:String,optional:1,},};CustomCheckbox.template='web.CustomCheckbox';return CustomCheckbox;});;

/* /web/static/src/legacy/js/components/custom_file_input.js defined in bundle 'web.assets_backend' */
odoo.define('web.CustomFileInput',function(require){"use strict";const{Component,hooks}=owl;const{useRef}=hooks;class CustomFileInput extends Component{constructor(){super(...arguments);this.fileInputRef=useRef('file-input');}
async _onFileInputChange(){const{action,model,id}=this.props;const params={csrf_token:odoo.csrf_token,ufile:[...this.fileInputRef.el.files],};if(model){params.model=model;}
if(id){params.id=id;}
const fileData=await this.env.services.httpRequest(action,params,'text');const parsedFileData=JSON.parse(fileData);if(parsedFileData.error){throw new Error(parsedFileData.error);}
this.trigger('uploaded',{files:parsedFileData});}
_onTriggerClicked(){this.fileInputRef.el.click();}}
CustomFileInput.defaultProps={accepted_file_extensions:'*',action:'/web/binary/upload',multi_upload:false,};CustomFileInput.props={accepted_file_extensions:{type:String,optional:1},action:{type:String,optional:1},id:{type:Number,optional:1},model:{type:String,optional:1},multi_upload:{type:Boolean,optional:1},};CustomFileInput.template='web.CustomFileInput';return CustomFileInput;});;

/* /web/static/src/legacy/js/components/datepicker.js defined in bundle 'web.assets_backend' */
odoo.define('web.DatePickerOwl',function(require){"use strict";const field_utils=require('web.field_utils');const time=require('web.time');const{useAutofocus}=require('web.custom_hooks');const{Component,hooks}=owl;const{useExternalListener,useRef,useState}=hooks;let datePickerId=0;class DatePicker extends Component{constructor(){super(...arguments);this.inputRef=useRef('input');this.state=useState({warning:false});this.datePickerId=`o_datepicker_${datePickerId++}`;this.typeOfDate='date';useAutofocus();useExternalListener(window,'scroll',this._onWindowScroll);}
mounted(){$(this.el).on('show.datetimepicker',this._onDateTimePickerShow.bind(this));$(this.el).on('hide.datetimepicker',this._onDateTimePickerHide.bind(this));$(this.el).on('error.datetimepicker',()=>false);const pickerOptions=Object.assign({format:this.defaultFormat},this.props);this._datetimepicker(pickerOptions);this.inputRef.el.value=this._formatDate(this.props.date);}
willUnmount(){this._datetimepicker('destroy');}
willUpdateProps(nextProps){for(const prop in nextProps){this._datetimepicker(prop,nextProps[prop]);}
if(nextProps.date){this.inputRef.el.value=this._formatDate(nextProps.date);}}
get defaultFormat(){return time.getLangDateFormat();}
_datetimepicker(...args){this.ignoreBootstrapEvents=true;$(this.el).datetimepicker(...args);this.ignoreBootstrapEvents=false;}
_formatDate(date){try{return field_utils.format[this.typeOfDate](date,null,{timezone:false});}catch(err){return false;}}
_parseInput(inputValue){try{return field_utils.parse[this.typeOfDate](inputValue,null,{timezone:false});}catch(err){return false;}}
_onDateTimePickerHide(){if(this.ignoreBootstrapEvents){return;}
const date=this._parseInput(this.inputRef.el.value);this.state.warning=date.format('YYYY-MM-DD')>moment().format('YYYY-MM-DD');this.trigger('datetime-changed',{date});}
_onDateTimePickerShow(){if(this.ignoreBootstrapEvents){return;}
this.inputRef.el.select();}
_onInputClick(){this._datetimepicker('toggle');}
_onInputChange(){const date=this._parseInput(this.inputRef.el.value);if(date){this.state.warning=date.format('YYYY-MM-DD')>moment().format('YYYY-MM-DD');this.trigger('datetime-changed',{date});}else{this.inputRef.el.value=this._formatDate(this.props.date);}}
_onWindowScroll(ev){if(ev.target!==this.inputRef.el){this._datetimepicker('hide');}}}
DatePicker.defaultProps={calendarWeeks:true,icons:{clear:'fa fa-delete',close:'fa fa-check primary',date:'fa fa-calendar',down:'fa fa-chevron-down',next:'fa fa-chevron-right',previous:'fa fa-chevron-left',time:'fa fa-clock-o',today:'fa fa-calendar-check-o',up:'fa fa-chevron-up',},get locale(){return moment.locale();},maxDate:moment({y:9999,M:11,d:31}),minDate:moment({y:1000}),useCurrent:false,widgetParent:'body',};DatePicker.props={date:moment,buttons:{type:Object,shape:{showClear:Boolean,showClose:Boolean,showToday:Boolean,},optional:1,},calendarWeeks:Boolean,format:{type:String,optional:1},icons:{type:Object,shape:{clear:String,close:String,date:String,down:String,next:String,previous:String,time:String,today:String,up:String,},},keyBinds:{validate:kb=>typeof kb==='object'||kb===null,optional:1},locale:String,maxDate:moment,minDate:moment,readonly:{type:Boolean,optional:1},useCurrent:Boolean,widgetParent:String,};DatePicker.template="web.Legacy.DatePicker";class DateTimePicker extends DatePicker{constructor(){super(...arguments);this.typeOfDate='datetime';}
get defaultFormat(){return time.getLangDatetimeFormat();}}
DateTimePicker.defaultProps=Object.assign(Object.create(DatePicker.defaultProps),{buttons:{showClear:false,showClose:true,showToday:false,},});return{DatePicker,DateTimePicker,};});;

/* /web/static/src/legacy/js/components/dropdown_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.DropdownMenu',function(require){"use strict";const{_t}=require('web.core');const DropdownMenuItem=require('web.DropdownMenuItem');const{Component,hooks}=owl;const{useExternalListener,useRef,useState}=hooks;class DropdownMenu extends Component{constructor(){super(...arguments);this.dropdownMenu=useRef('dropdown');this.state=useState({open:false});useExternalListener(window,'click',this._onWindowClick,true);useExternalListener(window,'keydown',this._onWindowKeydown);}
get displayCaret(){return false;}
get displayChevron(){return this.env.device.isMobile;}
get dropdownMenuAlignClass(){if(this.env.device.isMobile){const threshold=document.documentElement.clientWidth/2;const{left,right}=this.el.getBoundingClientRect();if(_t.database.parameters.direction==='rtl'){return right>threshold?'dropdown-menu-left':'dropdown-menu-right';}
return left>threshold?'dropdown-menu-right':'dropdown-menu-left';}
return'';}
get icon(){return this.props.icon;}
get items(){return this.props.items;}
get title(){return this.props.title;}
_onButtonKeydown(ev){switch(ev.key){case'ArrowLeft':case'ArrowRight':case'ArrowUp':case'ArrowDown':const firstItem=this.el.querySelector('.dropdown-item');if(firstItem){ev.preventDefault();firstItem.focus();}}}
_onItemSelected(){if(this.props.closeOnSelected){this.state.open=false;}}
_onWindowClick(ev){if(this.state.open&&!this.el.contains(ev.target)&&!this.el.contains(document.activeElement)){if(document.body.classList.contains("modal-open")){const modal=this.el.closest(".modal[role='dialog']:not(.o_inactive_modal)")
if(!modal){return;}}
if(document.querySelector('body > .bootstrap-datetimepicker-widget')){return;}
this.state.open=false;}}
_onWindowKeydown(ev){if(this.state.open&&ev.key==='Escape'){this.state.open=false;}}}
DropdownMenu.components={DropdownMenuItem};DropdownMenu.defaultProps={items:[]};DropdownMenu.props={icon:{type:String,optional:1},items:{type:Array,element:Object,optional:1,},title:{type:String,optional:1},closeOnSelected:{type:Boolean,optional:1},hotkey:{type:String,optional:1},hotkeyTitle:{type:String,optional:1},};DropdownMenu.template='web.DropdownMenu';return DropdownMenu;});;

/* /web/static/src/legacy/js/components/dropdown_menu_item.js defined in bundle 'web.assets_backend' */
odoo.define('web.DropdownMenuItem',function(require){"use strict";const{useListener}=require('web.custom_hooks');const{Component,hooks}=owl;const{useExternalListener,useRef,useState}=hooks;class DropdownMenuItem extends Component{constructor(){super(...arguments);this.canBeOpened=Boolean(this.props.options&&this.props.options.length);this.fallbackFocusRef=useRef('fallback-focus');this.state=useState({open:false});useExternalListener(window,'click',this._onWindowClick);useListener('keydown',this._onKeydown);}
_onKeydown(ev){if(['INPUT','TEXTAREA'].includes(document.activeElement.tagName)){return;}
switch(ev.key){case'ArrowLeft':if(this.canBeOpened&&this.state.open){ev.preventDefault();if(this.fallbackFocusRef.el){this.fallbackFocusRef.el.focus();}
this.state.open=false;}
break;case'ArrowRight':if(this.canBeOpened&&!this.state.open){ev.preventDefault();this.state.open=true;}
break;case'Escape':ev.target.blur();if(this.canBeOpened&&this.state.open){ev.preventDefault();ev.stopPropagation();if(this.fallbackFocusRef.el){this.fallbackFocusRef.el.focus();}
this.state.open=false;}}}
_onWindowClick(ev){if(this.state.open&&!this.el.contains(ev.target)&&!this.el.contains(document.activeElement)){this.state.open=false;}}}
DropdownMenuItem.template='web.DropdownMenuItem';return DropdownMenuItem;});;

/* /web/static/src/legacy/js/components/pager.js defined in bundle 'web.assets_backend' */
odoo.define('web.Pager',function(require){"use strict";const{useAutofocus}=require('web.custom_hooks');const{Component,hooks}=owl;const{useState}=hooks;class Pager extends Component{constructor(){super(...arguments);this.state=useState({disabled:false,editing:false,});useAutofocus();}
async willUpdateProps(){this.state.editing=false;this.state.disabled=false;}
get maximum(){return Math.min(this.props.currentMinimum+this.props.limit-1,this.props.size);}
get singlePage(){return(1===this.props.currentMinimum)&&(this.maximum===this.props.size);}
get value(){return this.props.currentMinimum+(this.props.limit>1?`-${this.maximum}`:'');}
async _changeSelection(direction){try{await this.props.validate();}catch(err){return;}
const{limit,size}=this.props;let currentMinimum=(this.props.currentMinimum+limit*direction);if(currentMinimum>size){currentMinimum=1;}else if((currentMinimum<1)&&(limit===1)){currentMinimum=size;}else if((currentMinimum<1)&&(limit>1)){currentMinimum=size-((size%limit)||limit)+1;}
this._updateAndDisable(currentMinimum,limit);}
async _saveValue(value){try{await this.props.validate();}catch(err){return;}
const[min,max]=value.trim().split(/\s*[\-\s,;]\s*/);let currentMinimum=Math.max(Math.min(parseInt(min,10),this.props.size),1);let maximum=max?Math.max(Math.min(parseInt(max,10),this.props.size),1):min;if(!isNaN(currentMinimum)&&!isNaN(maximum)&&currentMinimum<=maximum){const limit=Math.max(maximum-currentMinimum)+1;this._updateAndDisable(currentMinimum,limit);}}
_updateAndDisable(currentMinimum,limit){if(currentMinimum!==this.props.currentMinimum||limit!==this.props.limit){this.state.disabled=true;}else{this.state.editing=false;}
this.trigger('pager-changed',{currentMinimum,limit});}
_onEdit(){if(this.props.editable&&!this.state.editing&&!this.state.disabled){this.state.editing=true;}}
_onValueChange(ev){this._saveValue(ev.currentTarget.value);if(!this.state.disabled){ev.preventDefault();}}
_onValueKeydown(ev){switch(ev.key){case'Enter':ev.preventDefault();ev.stopPropagation();this._saveValue(ev.currentTarget.value);break;case'Escape':ev.preventDefault();ev.stopPropagation();this.state.editing=false;break;}}}
Pager.defaultProps={editable:true,validate:async()=>{},withAccessKey:true,};Pager.props={currentMinimum:{type:Number,optional:1},editable:Boolean,limit:{validate:l=>!isNaN(l),optional:1},size:{type:Number,optional:1},validate:Function,withAccessKey:Boolean,};Pager.template='web.Pager';return Pager;});;

/* /web/static/src/legacy/js/control_panel/comparison_menu.js defined in bundle 'web.assets_backend' */
odoo.define("web.ComparisonMenu",function(require){"use strict";const{FACET_ICONS}=require("web.searchUtils");const{useModel}=require("web.Model");const{Component}=owl;class ComparisonMenu extends Component{constructor(){super(...arguments);this.icon=FACET_ICONS.comparison;this.model=useModel('searchModel');}
get items(){return this.model.get('filters',f=>f.type==='comparison');}
onComparisonSelected(ev){const{itemId}=ev.detail.payload;this.model.dispatch("toggleComparison",itemId);}}
ComparisonMenu.template="web.ComparisonMenu";return ComparisonMenu;});;

/* /web/static/src/legacy/js/control_panel/control_panel.js defined in bundle 'web.assets_backend' */
odoo.define('web.ControlPanel',function(require){"use strict";const ActionMenus=require('web.ActionMenus');const ComparisonMenu=require('web.ComparisonMenu');const ActionModel=require('web.ActionModel');const FavoriteMenu=require('web.FavoriteMenu');const FilterMenu=require('web.FilterMenu');const GroupByMenu=require('web.GroupByMenu');const Pager=require('web.Pager');const SearchBar=require('web.SearchBar');const{useModel}=require('web.Model');const{Component,hooks}=owl;const{useRef,useSubEnv}=hooks;function getAdditionalContent(props){const additionalContent={};if('cp_content'in props){const content=props.cp_content||{};if('$buttons'in content){additionalContent.buttons=content.$buttons;}
if('$searchview'in content){additionalContent.searchView=content.$searchview;}
if('$pager'in content){additionalContent.pager=content.$pager;}
if('$searchview_buttons'in content){additionalContent.searchViewButtons=content.$searchview_buttons;}}
return additionalContent;}
class ControlPanel extends Component{constructor(){super(...arguments);this.additionalContent=getAdditionalContent(this.props);useSubEnv({action:this.props.action,searchModel:this.props.searchModel,view:this.props.view,});if(this.env.searchModel){this.model=useModel('searchModel');}
this.contentRefs={buttons:useRef('buttons'),pager:useRef('pager'),searchView:useRef('searchView'),searchViewButtons:useRef('searchViewButtons'),};this.fields=this._formatFields(this.props.fields);this.sprintf=_.str.sprintf;}
mounted(){this._attachAdditionalContent();}
patched(){this._attachAdditionalContent();}
async willUpdateProps(nextProps){if('view'in nextProps){this.env.view=nextProps.view;}
if('fields'in nextProps){this.fields=this._formatFields(nextProps.fields);}
this.additionalContent=getAdditionalContent(nextProps);}
_attachAdditionalContent(){for(const key in this.additionalContent){if(this.additionalContent[key]&&this.additionalContent[key].length){const target=this.contentRefs[key].el;if(target){target.innerHTML="";target.append(...this.additionalContent[key]);}}}}
_formatFields(fields){const formattedFields={};for(const fieldName in fields){formattedFields[fieldName]=Object.assign({description:fields[fieldName].string,name:fieldName,},fields[fieldName]);}
return formattedFields;}}
ControlPanel.modelExtension="ControlPanel";ControlPanel.components={SearchBar,ActionMenus,Pager,ComparisonMenu,FilterMenu,GroupByMenu,FavoriteMenu,};ControlPanel.defaultProps={breadcrumbs:[],fields:{},searchMenuTypes:[],views:[],withBreadcrumbs:true,withSearchBar:true,};ControlPanel.props={action:Object,breadcrumbs:Array,searchModel:ActionModel,cp_content:{type:Object,optional:1},fields:Object,pager:{validate:p=>typeof p==='object'||p===null,optional:1},searchMenuTypes:Array,actionMenus:{validate:s=>typeof s==='object'||s===null,optional:1},title:{type:String,optional:1},view:{type:Object,optional:1},views:Array,withBreadcrumbs:Boolean,withSearchBar:Boolean,};ControlPanel.template='web.Legacy.ControlPanel';return ControlPanel;});;

/* /web/static/src/legacy/js/control_panel/control_panel_model_extension.js defined in bundle 'web.assets_backend' */
odoo.define("web/static/src/js/control_panel/control_panel_model_extension.js",function(require){"use strict";const ActionModel=require("web.ActionModel");const Domain=require('web.Domain');const pyUtils=require('web.py_utils');const{DEFAULT_INTERVAL,DEFAULT_PERIOD,getComparisonOptions,getIntervalOptions,getPeriodOptions,constructDateDomain,rankInterval,yearSelected}=require('web.searchUtils');const FAVORITE_PRIVATE_GROUP=1;const FAVORITE_SHARED_GROUP=2;const DISABLE_FAVORITE="search_disable_custom_filters";class ControlPanelModelExtension extends ActionModel.Extension{constructor(){super(...arguments);this.actionContext=Object.assign({},this.config.context);this.searchMenuTypes=this.config.searchMenuTypes||[];this.favoriteFilters=this.config.favoriteFilters||[];this.fields=this.config.fields||{};this.searchDefaults={};for(const key in this.actionContext){const match=/^search_default_(.*)$/.exec(key);if(match){const val=this.actionContext[key];if(val){this.searchDefaults[match[1]]=val;}
delete this.actionContext[key];}}
this.labelPromises=[];this.referenceMoment=moment();this.optionGenerators=getPeriodOptions(this.referenceMoment);this.intervalOptions=getIntervalOptions();this.comparisonOptions=getComparisonOptions();}
get(property,...args){switch(property){case"context":return this.getContext();case"domain":return this.getDomain();case"facets":return this._getFacets();case"filters":return this._getFilters(...args);case"groupBy":return this.getGroupBy();case"orderedBy":return this.getOrderedBy();case"timeRanges":return this.getTimeRanges();case"irFilterValues":return this.getIrFilterValues({type:"favorite"});}}
async load(){await Promise.all(this.labelPromises);}
prepareState(){Object.assign(this.state,{nextGroupId:1,nextGroupNumber:1,nextId:1,filters:{},query:[],});if(this.config.withSearchBar!==false){this._addFilters();this._activateDefaultFilters();}}
get activeComparison(){return this.state.query.find(queryElem=>queryElem.type==='comparison');}
addAutoCompletionValues({filterId,label,value,operator}){const queryElem=this.state.query.find(queryElem=>queryElem.filterId===filterId&&queryElem.value===value&&queryElem.operator===operator);if(!queryElem){const{groupId}=this.state.filters[filterId];this.state.query.push({filterId,groupId,label,value,operator});}else{queryElem.label=label;}}
clearQuery(){this.state.query=[];}
getIrFilterValues(preFilter){const groups=this._getGroups();const userContext=this.env.session.user_context;let controllerQueryParams;this.config.trigger("get-controller-query-params",params=>{controllerQueryParams=params;});controllerQueryParams=controllerQueryParams||{};controllerQueryParams.context=controllerQueryParams.context||{};const queryContext=this._getContext(groups);const context=pyUtils.eval('contexts',[userContext,controllerQueryParams.context,queryContext]);for(const key in userContext){delete context[key];}
const requireEvaluation=false;const domain=this._getDomain(groups);const groupBys=this._getGroupBy(groups);const timeRanges=this._getTimeRanges(requireEvaluation);const orderedBy=controllerQueryParams.orderedBy?controllerQueryParams.orderedBy:(this._getOrderedBy(groups)||[]);const userId=preFilter.isShared?false:this.env.session.uid;delete preFilter.isShared;Object.assign(preFilter,{context,domain,groupBys,groupNumber:userId?FAVORITE_PRIVATE_GROUP:FAVORITE_SHARED_GROUP,orderedBy,removable:true,userId,});if(timeRanges){preFilter.comparison=timeRanges;}
return this._favoriteToIrFilter(preFilter);}
async createNewFavorite(preFilter){const preFavorite=await this._saveQuery(preFilter);this.clearQuery();const filter=Object.assign(preFavorite,{groupId:this.state.nextGroupId,id:this.state.nextId,});this.state.filters[this.state.nextId]=filter;this.state.query.push({groupId:this.state.nextGroupId,filterId:this.state.nextId});this.state.nextGroupId++;this.state.nextId++;}
createNewFilters(prefilters){if(!prefilters.length){return[];}
const newFilterIdS=[];prefilters.forEach(preFilter=>{const filter=Object.assign(preFilter,{groupId:this.state.nextGroupId,groupNumber:this.state.nextGroupNumber,id:this.state.nextId,type:'filter',});this.state.filters[this.state.nextId]=filter;this.state.query.push({groupId:this.state.nextGroupId,filterId:this.state.nextId});newFilterIdS.push(this.state.nextId);this.state.nextId++;});this.state.nextGroupId++;this.state.nextGroupNumber++;return newFilterIdS;}
createNewGroupBy(field){const groupBy=Object.values(this.state.filters).find(f=>f.type==='groupBy');const filter={description:field.string||field.name,fieldName:field.name,fieldType:field.type,groupId:groupBy?groupBy.groupId:this.state.nextGroupId++,groupNumber:this.state.nextGroupNumber,id:this.state.nextId,type:'groupBy',custom:true,};this.state.filters[this.state.nextId]=filter;if(['date','datetime'].includes(field.type)){filter.hasOptions=true;filter.defaultOptionId=DEFAULT_INTERVAL;this.toggleFilterWithOptions(this.state.nextId);}else{this.toggleFilter(this.state.nextId);}
this.state.nextGroupNumber++;this.state.nextId++;}
deactivateGroup(groupId){this.state.query=this.state.query.filter(queryElem=>queryElem.groupId!==groupId);this._checkComparisonStatus();}
async deleteFavorite(filterId){const{serverSideId}=this.state.filters[filterId];await this.env.dataManager.delete_filter(serverSideId);const index=this.state.query.findIndex(queryElem=>queryElem.filterId===filterId);delete this.state.filters[filterId];if(index>=0){this.state.query.splice(index,1);}}
getContext(){const groups=this._getGroups();return this._getContext(groups);}
getDomain(){const groups=this._getGroups();const userContext=this.env.session.user_context;try{return Domain.prototype.stringToArray(this._getDomain(groups),userContext);}catch(err){throw new Error(`${this.env._t("Control panel model extension failed to evaluate domain")}:/n${JSON.stringify(err)}`);}}
getGroupBy(){const groups=this._getGroups();return this._getGroupBy(groups);}
getOrderedBy(){const groups=this._getGroups();return this._getOrderedBy(groups);}
getTimeRanges(){const requireEvaluation=true;return this._getTimeRanges(requireEvaluation);}
search(){}
toggleComparison(filterId){const{groupId,dateFilterId}=this.state.filters[filterId];const queryElem=this.state.query.find(queryElem=>queryElem.type==='comparison'&&queryElem.filterId===filterId);this.state.query=this.state.query.filter(queryElem=>queryElem.type!=='comparison');if(!queryElem){this.state.query.push({groupId,filterId,dateFilterId,type:'comparison',});}}
toggleFilter(filterId){const index=this.state.query.findIndex(queryElem=>queryElem.filterId===filterId);if(index>=0){this.state.query.splice(index,1);}else{const{groupId,type}=this.state.filters[filterId];if(type==='favorite'){this.state.query=[];}
this.state.query.push({groupId,filterId});}}
toggleFilterWithOptions(filterId,optionId){const filter=this.state.filters[filterId];optionId=optionId||filter.defaultOptionId;const option=this.optionGenerators.find(o=>o.id===optionId);const index=this.state.query.findIndex(queryElem=>queryElem.filterId===filterId&&queryElem.optionId===optionId);if(index>=0){this.state.query.splice(index,1);if(filter.type==='filter'&&!yearSelected(this._getSelectedOptionIds(filterId))){this.state.query=this.state.query.filter(queryElem=>queryElem.filterId!==filterId);}}else{this.state.query.push({groupId:filter.groupId,filterId,optionId});if(filter.type==='filter'&&!yearSelected(this._getSelectedOptionIds(filterId))){this.state.query.push({groupId:filter.groupId,filterId,optionId:option.defaultYearId,});}}
if(filter.type==='filter'){this._checkComparisonStatus();}}
_activateDefaultFilters(){if(this.defaultFavoriteId){this.toggleFilter(this.defaultFavoriteId);}else{Object.values(this.state.filters).filter((f)=>f.isDefault&&f.type!=='favorite').sort((f1,f2)=>(f1.defaultRank||100)-(f2.defaultRank||100)).forEach(f=>{if(f.hasOptions){this.toggleFilterWithOptions(f.id);}else if(f.type==='field'){let{operator,label,value}=f.defaultAutocompleteValue;this.addAutoCompletionValues({filterId:f.id,value,operator,label,});}else{this.toggleFilter(f.id);}});}}
_addFilters(){this._createGroupOfFavorites();this._createGroupOfFiltersFromArch();this._createGroupOfDynamicFilters();}
_checkComparisonStatus(){const activeComparison=this.activeComparison;if(!activeComparison){return;}
const{dateFilterId}=activeComparison;const dateFilterIsActive=this.state.query.some(queryElem=>queryElem.filterId===dateFilterId);if(!dateFilterIsActive){this.state.query=this.state.query.filter(queryElem=>queryElem.type!=='comparison');}}
_computeTimeRanges(comparisonFilter){const{filterId}=this.activeComparison;if(filterId!==comparisonFilter.id){return null;}
const{dateFilterId,comparisonOptionId}=comparisonFilter;const{fieldName,fieldType,description:dateFilterDescription,}=this.state.filters[dateFilterId];const selectedOptionIds=this._getSelectedOptionIds(dateFilterId);const{domain:range,description:rangeDescription}=constructDateDomain(this.referenceMoment,fieldName,fieldType,selectedOptionIds,);const{domain:comparisonRange,description:comparisonRangeDescription,}=constructDateDomain(this.referenceMoment,fieldName,fieldType,selectedOptionIds,comparisonOptionId);return{comparisonId:comparisonOptionId,fieldName,fieldDescription:dateFilterDescription,range,rangeDescription,comparisonRange,comparisonRangeDescription,};}
_createGroupOfComparisons(dateFilters){const preFilters=[];for(const dateFilter of dateFilters){for(const comparisonOption of this.comparisonOptions){const{id:dateFilterId,description}=dateFilter;const preFilter={type:'comparison',comparisonOptionId:comparisonOption.id,description:`${description}: ${comparisonOption.description}`,dateFilterId,};preFilters.push(preFilter);}}
this._createGroupOfFilters(preFilters);}
_createGroupOfDynamicFilters(){const dynamicFilters=this.config.dynamicFilters||[];const pregroup=dynamicFilters.map(filter=>{return{description:filter.description,domain:JSON.stringify(filter.domain),isDefault:true,type:'filter',};});this._createGroupOfFilters(pregroup);}
_createGroupOfFavorites(){const activateFavorite=DISABLE_FAVORITE in this.actionContext?!this.actionContext[DISABLE_FAVORITE]:true;this.favoriteFilters.forEach(irFilter=>{const favorite=this._irFilterToFavorite(irFilter);this._createGroupOfFilters([favorite]);if(activateFavorite&&favorite.isDefault){this.defaultFavoriteId=favorite.id;}});}
_createGroupOfFilters(pregroup){pregroup.forEach(preFilter=>{const filter=Object.assign(preFilter,{groupId:this.state.nextGroupId,id:this.state.nextId});this.state.filters[this.state.nextId]=filter;if(!this.defaultFavoriteId&&filter.isDefault&&filter.type==='field'){this._prepareDefaultLabel(filter);}
this.state.nextId++;});this.state.nextGroupId++;}
_createGroupOfFiltersFromArch(){const preFilters=this.config.archNodes.reduce((preFilters,child)=>{if(child.tag==='group'){return[...preFilters,...child.children.map(c=>this._evalArchChild(c))];}else{return[...preFilters,this._evalArchChild(child)];}},[]);preFilters.push({tag:'separator'});let currentTag;let currentGroup=[];let pregroupOfGroupBys=[];preFilters.forEach(preFilter=>{if(preFilter.tag!==currentTag||['separator','field'].includes(preFilter.tag)){if(currentGroup.length){if(currentTag==='groupBy'){pregroupOfGroupBys=[...pregroupOfGroupBys,...currentGroup];}else{this._createGroupOfFilters(currentGroup);}}
currentTag=preFilter.tag;currentGroup=[];this.state.nextGroupNumber++;}
if(preFilter.tag!=='separator'){const filter={type:preFilter.tag,};if(preFilter.attrs&&JSON.parse(preFilter.attrs.modifiers||'{}').invisible){filter.invisible=true;let preFilterFieldName=null;if(preFilter.tag==='filter'&&preFilter.attrs.date){preFilterFieldName=preFilter.attrs.date;}else if(preFilter.tag==='groupBy'){preFilterFieldName=preFilter.attrs.fieldName;}
if(preFilterFieldName&&!this.fields[preFilterFieldName]){return;}}
if(filter.type==='filter'||filter.type==='groupBy'){filter.groupNumber=this.state.nextGroupNumber;}
this._extractAttributes(filter,preFilter.attrs);currentGroup.push(filter);}});if(pregroupOfGroupBys.length){this._createGroupOfFilters(pregroupOfGroupBys);}
const dateFilters=Object.values(this.state.filters).filter((filter)=>filter.isDateFilter);if(dateFilters.length){this._createGroupOfComparisons(dateFilters);}}
_enrichFilterCopy(filter,filterQueryElements){const isActive=Boolean(filterQueryElements.length);const f=Object.assign({isActive},filter);function _enrichOptions(options){return options.map(o=>{const{description,id,groupNumber}=o;const isActive=filterQueryElements.some(a=>a.optionId===id);return{description,id,groupNumber,isActive};});}
switch(f.type){case'comparison':{const{dateFilterId}=filter;const dateFilterIsActive=this.state.query.some(queryElem=>queryElem.filterId===dateFilterId);if(!dateFilterIsActive){return null;}
break;}
case'filter':if(f.hasOptions){f.options=_enrichOptions(this.optionGenerators);}
break;case'groupBy':if(f.hasOptions){f.options=_enrichOptions(this.intervalOptions);}
break;case'field':f.autoCompleteValues=filterQueryElements.map(({label,value,operator})=>({label,value,operator}));break;}
return f;}
_evalArchChild(child){if(child.attrs.context){try{const context=pyUtils.eval('context',child.attrs.context);child.attrs.context=context;if(context.group_by){child.attrs.fieldName=context.group_by.split(':')[0];child.attrs.defaultInterval=context.group_by.split(':')[1];child.tag='groupBy';}}catch(e){}}
if(child.attrs.name in this.searchDefaults){child.attrs.isDefault=true;let value=this.searchDefaults[child.attrs.name];if(child.tag==='field'){child.attrs.defaultValue=this.fields[child.attrs.name].type==='many2one'&&Array.isArray(value)?value[0]:value;}else if(child.tag==='groupBy'){child.attrs.defaultRank=typeof value==='number'?value:100;}}
return child;}
_extractAttributes(filter,attrs){if(attrs.isDefault){filter.isDefault=attrs.isDefault;}
filter.description=attrs.string||attrs.help||attrs.name||attrs.domain||'Ω';switch(filter.type){case'filter':if(attrs.context){filter.context=attrs.context;}
if(attrs.date){filter.isDateFilter=true;filter.hasOptions=true;filter.fieldName=attrs.date;filter.fieldType=this.fields[attrs.date].type;filter.defaultOptionId=attrs.default_period||DEFAULT_PERIOD;}else{filter.domain=attrs.domain||'[]';}
if(filter.isDefault){filter.defaultRank=-5;}
break;case'groupBy':filter.fieldName=attrs.fieldName;filter.fieldType=this.fields[attrs.fieldName].type;if(['date','datetime'].includes(filter.fieldType)){filter.hasOptions=true;filter.defaultOptionId=attrs.defaultInterval||DEFAULT_INTERVAL;}
if(filter.isDefault){filter.defaultRank=attrs.defaultRank;}
break;case'field':{const field=this.fields[attrs.name];filter.fieldName=attrs.name;filter.fieldType=field.type;if(attrs.domain){filter.domain=attrs.domain;}
if(attrs.filter_domain){filter.filterDomain=attrs.filter_domain;}else if(attrs.operator){filter.operator=attrs.operator;}
if(attrs.context){filter.context=attrs.context;}
if(filter.isDefault){let operator=filter.operator;if(!operator){const type=attrs.widget||filter.fieldType;if(["char","html","many2many","one2many","text"].includes(type)){operator="ilike";}else{operator="=";}}
filter.defaultRank=-10;filter.defaultAutocompleteValue={operator,value:attrs.defaultValue,};}
break;}}
if(filter.fieldName&&!attrs.string){const{string}=this.fields[filter.fieldName];filter.description=string;}}
_favoriteToIrFilter(favorite){const irFilter={action_id:this.config.actionId,model_id:this.config.modelName,};if('description'in favorite){irFilter.name=favorite.description;}
if('domain'in favorite){irFilter.domain=favorite.domain;}
if('isDefault'in favorite){irFilter.is_default=favorite.isDefault;}
if('orderedBy'in favorite){const sort=favorite.orderedBy.map(ob=>ob.name+(ob.asc===false?" desc":""));irFilter.sort=JSON.stringify(sort);}
if('serverSideId'in favorite){irFilter.id=favorite.serverSideId;}
if('userId'in favorite){irFilter.user_id=favorite.userId;}
const context=Object.assign({},favorite.context);if('groupBys'in favorite){context.group_by=favorite.groupBys;}
if('comparison'in favorite){context.comparison=favorite.comparison;}
if(Object.keys(context).length){irFilter.context=context;}
return irFilter;}
_getAutoCompletionFilterDomain(filter,filterQueryElements){const domains=filterQueryElements.map(({label,value,operator})=>{let domain;if(filter.filterDomain){domain=Domain.prototype.stringToArray(filter.filterDomain,{self:label,raw_value:value,});}else{domain=[[filter.fieldName,operator,value]];}
return Domain.prototype.arrayToString(domain);});return pyUtils.assembleDomains(domains,'OR');}
_getContext(groups){const types=['filter','favorite','field'];const contexts=groups.reduce((contexts,group)=>{if(types.includes(group.type)){contexts.push(...this._getGroupContexts(group));}
return contexts;},[]);const evaluationContext=this.env.session.user_context;try{return pyUtils.eval('contexts',contexts,evaluationContext);}catch(err){throw new Error(this.env._t("Failed to evaluate search context")+":\n"+
JSON.stringify(err));}}
_getDateFilterDomain(filter,filterQueryElements,key='domain'){const{fieldName,fieldType}=filter;const selectedOptionIds=filterQueryElements.map(queryElem=>queryElem.optionId);const dateFilterRange=constructDateDomain(this.referenceMoment,fieldName,fieldType,selectedOptionIds,);return dateFilterRange[key];}
_getDomain(groups){const types=['filter','favorite','field'];const domains=[];for(const group of groups){if(types.includes(group.type)){domains.push(this._getGroupDomain(group));}}
return pyUtils.assembleDomains(domains,'AND');}
_getFacetDescriptions(activities,type){const facetDescriptions=[];if(type==='field'){for(const queryElem of activities[0].filterQueryElements){facetDescriptions.push(queryElem.label);}}else if(type==='groupBy'){for(const{filter,filterQueryElements}of activities){if(filter.hasOptions){for(const queryElem of filterQueryElements){const option=this.intervalOptions.find(o=>o.id===queryElem.optionId);facetDescriptions.push(filter.description+': '+option.description);}}else{facetDescriptions.push(filter.description);}}}else{let facetDescription;for(const{filter,filterQueryElements}of activities){facetDescription=filter.description;if(filter.isDateFilter){const description=this._getDateFilterDomain(filter,filterQueryElements,'description');facetDescription+=`: ${description}`;}
facetDescriptions.push(facetDescription);}}
return facetDescriptions;}
_getFacets(){const facets=this._getGroups().map(({activities,type,id})=>{const values=this._getFacetDescriptions(activities,type);const title=activities[0].filter.description;return{groupId:id,title,type,values};});return facets;}
_getFilters(predicate){const filters=[];Object.values(this.state.filters).forEach(filter=>{if((!predicate||predicate(filter))&&!filter.invisible){const filterQueryElements=this.state.query.filter(queryElem=>queryElem.filterId===filter.id);const enrichedFilter=this._enrichFilterCopy(filter,filterQueryElements);if(enrichedFilter){filters.push(enrichedFilter);}}});if(filters.some(f=>f.type==='favorite')){filters.sort((f1,f2)=>f1.groupNumber-f2.groupNumber);}
return filters;}
_getFilterContext(filter,filterQueryElements){let context=filter.context||{};if(filter.type==='field'&&filter.context){context=pyUtils.eval('context',filter.context,{self:filterQueryElements.map(({value})=>value)},);}
if(filter.type==='field'&&filter.isDefault&&filter.fieldType==='many2one'){context[`default_${filter.fieldName}`]=filter.defaultAutocompleteValue.value;}
return context;}
_getFilterDomain(filter,filterQueryElements){if(filter.type==='filter'&&filter.hasOptions){const{dateFilterId}=this.activeComparison||{};if(this.searchMenuTypes.includes('comparison')&&dateFilterId===filter.id){return"[]";}
return this._getDateFilterDomain(filter,filterQueryElements);}else if(filter.type==='field'){return this._getAutoCompletionFilterDomain(filter,filterQueryElements);}
return filter.domain;}
_getFilterGroupBys(filter,filterQueryElements){if(filter.type==='groupBy'){const fieldName=filter.fieldName;if(filter.hasOptions){return filterQueryElements.map(({optionId})=>`${fieldName}:${optionId}`);}else{return[fieldName];}}else{return filter.groupBys;}}
_getGroupBy(groups){const groupBys=groups.reduce((groupBys,group)=>{if(['groupBy','favorite'].includes(group.type)){groupBys.push(...this._getGroupGroupBys(group));}
return groupBys;},[]);const groupBy=groupBys.length?groupBys:(this.actionContext.group_by||[]);return typeof groupBy==='string'?[groupBy]:groupBy;}
_getGroupContexts(group){const contexts=group.activities.reduce((ctx,qe)=>[...ctx,this._getFilterContext(qe.filter,qe.filterQueryElements)],[]);return contexts;}
_getGroupDomain(group){const domains=group.activities.map(({filter,filterQueryElements})=>{return this._getFilterDomain(filter,filterQueryElements);});return pyUtils.assembleDomains(domains,'OR');}
_getGroupGroupBys(group){const groupBys=group.activities.reduce((gb,qe)=>[...gb,...this._getFilterGroupBys(qe.filter,qe.filterQueryElements)],[]);return groupBys;}
_getGroups(){const groups=this.state.query.reduce((groups,queryElem)=>{const{groupId,filterId}=queryElem;let group=groups.find(group=>group.id===groupId);const filter=this.state.filters[filterId];if(!group){const{type}=filter;group={id:groupId,type,activities:[]};groups.push(group);}
group.activities.push(queryElem);return groups;},[]);groups.forEach(g=>this._mergeActivities(g));return groups;}
_getOrderedBy(groups){return groups.reduce((orderedBy,group)=>{if(group.type==='favorite'){const favoriteOrderedBy=group.activities[0].filter.orderedBy;if(favoriteOrderedBy){orderedBy=[...favoriteOrderedBy,...orderedBy];}}
return orderedBy;},[]);}
_getSelectedOptionIds(dateFilterId){const selectedOptionIds=[];for(const queryElem of this.state.query){if(queryElem.filterId===dateFilterId){selectedOptionIds.push(queryElem.optionId);}}
return selectedOptionIds;}
_getTimeRanges(evaluation){let timeRanges;for(const queryElem of this.state.query.slice().reverse()){const filter=this.state.filters[queryElem.filterId];if(filter.type==='comparison'){timeRanges=this._computeTimeRanges(filter);break;}else if(filter.type==='favorite'&&filter.comparison){timeRanges=filter.comparison;break;}}
if(timeRanges){if(evaluation){timeRanges.range=Domain.prototype.stringToArray(timeRanges.range);timeRanges.comparisonRange=Domain.prototype.stringToArray(timeRanges.comparisonRange);}
return timeRanges;}
return null;}
_irFilterToFavorite(irFilter){let userId=irFilter.user_id||false;if(Array.isArray(userId)){userId=userId[0];}
const groupNumber=userId?FAVORITE_PRIVATE_GROUP:FAVORITE_SHARED_GROUP;const context=pyUtils.eval('context',irFilter.context,this.env.session.user_context);let groupBys=[];if(context.group_by){groupBys=context.group_by;delete context.group_by;}
let comparison;if(context.comparison){comparison=context.comparison;delete context.comparison;}
let sort;try{sort=JSON.parse(irFilter.sort);}catch(err){if(err instanceof SyntaxError){sort=[];}else{throw err;}}
const orderedBy=sort.map(order=>{let fieldName;let asc;const sqlNotation=order.split(' ');if(sqlNotation.length>1){fieldName=sqlNotation[0];asc=sqlNotation[1]==='asc';}else{fieldName=order[0]==='-'?order.slice(1):order;asc=order[0]==='-'?false:true;}
return{asc:asc,name:fieldName,};});const favorite={context,description:irFilter.name,domain:irFilter.domain,groupBys,groupNumber,orderedBy,removable:true,serverSideId:irFilter.id,type:'favorite',userId,};if(irFilter.is_default){favorite.isDefault=irFilter.is_default;}
if(comparison){favorite.comparison=comparison;}
return favorite;}
_mergeActivities(group){const{activities,type}=group;let res=[];switch(type){case'filter':case'groupBy':{for(const activity of activities){const{filterId}=activity;let a=res.find(({filter})=>filter.id===filterId);if(!a){a={filter:this.state.filters[filterId],filterQueryElements:[]};res.push(a);}
a.filterQueryElements.push(activity);}
break;}
case'favorite':case'field':case'comparison':{const{filterId}=group.activities[0];const filter=this.state.filters[filterId];res.push({filter,filterQueryElements:group.activities});break;}}
if(type==='groupBy'){res.forEach(activity=>{activity.filterQueryElements.sort((qe1,qe2)=>rankInterval(qe1.optionId)-rankInterval(qe2.optionId));});}
group.activities=res;}
_prepareDefaultLabel(filter){const{id,fieldType,fieldName,defaultAutocompleteValue}=filter;const{selection,context,relation}=this.fields[fieldName];if(fieldType==='selection'){defaultAutocompleteValue.label=selection.find(sel=>sel[0]===defaultAutocompleteValue.value)[1];}else if(fieldType==='many2one'){const updateLabel=label=>{const queryElem=this.state.query.find(({filterId})=>filterId===id);if(queryElem){queryElem.label=label;defaultAutocompleteValue.label=label;}};const promise=this.env.services.rpc({args:[defaultAutocompleteValue.value],context:context,method:'name_get',model:relation,}).then(results=>updateLabel(results[0][1])).guardedCatch(()=>updateLabel(defaultAutocompleteValue.value));this.labelPromises.push(promise);}else{defaultAutocompleteValue.label=defaultAutocompleteValue.value;}}
async _saveQuery(preFilter){const irFilter=this.getIrFilterValues(preFilter);const serverSideId=await this.env.dataManager.create_filter(irFilter);preFilter.serverSideId=serverSideId;return preFilter;}
static extractArchInfo(archs){const{attrs,children}=archs.search;const controlPanelInfo={attrs,children:[],};for(const child of children){if(child.tag!=="searchpanel"){controlPanelInfo.children.push(child);}}
return controlPanelInfo;}}
ActionModel.registry.add("ControlPanel",ControlPanelModelExtension,10);return ControlPanelModelExtension;});;

/* /web/static/src/legacy/js/control_panel/control_panel_x2many.js defined in bundle 'web.assets_backend' */
odoo.define('web.ControlPanelX2Many',function(require){const ControlPanel=require('web.ControlPanel');class ControlPanelX2Many extends ControlPanel{_shouldShowPager(){if(!this.props.pager||!this.props.pager.limit){return false;}
const{currentMinimum,limit,size}=this.props.pager;const maximum=Math.min(currentMinimum+limit-1,size);const singlePage=(1===currentMinimum)&&(maximum===size);return!singlePage;}}
ControlPanelX2Many.defaultProps={};ControlPanelX2Many.props={cp_content:{type:Object,optional:1},pager:Object,};ControlPanelX2Many.template='web.Legacy.ControlPanelX2Many';return ControlPanelX2Many;});;

/* /web/static/src/legacy/js/control_panel/custom_favorite_item.js defined in bundle 'web.assets_backend' */
odoo.define('web.CustomFavoriteItem',function(require){"use strict";const FavoriteMenu=require('web.FavoriteMenu');const{useAutofocus}=require('web.custom_hooks');const{useModel}=require('web.Model');const{Component,hooks,useState}=owl;const{useRef}=hooks;let favoriteId=0;class CustomFavoriteItem extends Component{constructor(){super(...arguments);const favId=favoriteId++;this.useByDefaultId=`o_favorite_use_by_default_${favId}`;this.shareAllUsersId=`o_favorite_share_all_users_${favId}`;this.descriptionRef=useRef('description');this.model=useModel('searchModel');this.interactive=true;this.state=useState({description:this.env.action.name||"",isDefault:false,isShared:false,});useAutofocus();}
saveFavorite(){if(!this.state.description.length){this.env.services.notification.notify({message:this.env._t("A name for your favorite filter is required."),type:'danger',});return this.descriptionRef.el.focus();}
const favorites=this.model.get('filters',f=>f.type==='favorite');if(favorites.some(f=>f.description===this.state.description)){this.env.services.notification.notify({message:this.env._t("Filter with same name already exists."),type:'danger',});return this.descriptionRef.el.focus();}
this.model.dispatch('createNewFavorite',{type:'favorite',description:this.state.description,isDefault:this.state.isDefault,isShared:this.state.isShared,});Object.assign(this.state,{description:this.env.action.name||"",isDefault:false,isShared:false,open:false,});}
onDefaultCheckboxChange(ev){const{checked}=ev.target;this.state.isDefault=checked;if(checked){this.state.isShared=false;}}
onShareCheckboxChange(ev){const{checked}=ev.target;this.state.isShared=checked;if(checked){this.state.isDefault=false;}}
onInputKeydown(ev){switch(ev.key){case'Enter':ev.preventDefault();this.saveFavorite();break;case'Escape':ev.preventDefault();ev.target.blur();break;}}
static shouldBeDisplayed(env){return true;}}
CustomFavoriteItem.props={};CustomFavoriteItem.template="web.CustomFavoriteItem";CustomFavoriteItem.groupNumber=3;FavoriteMenu.registry.add('favorite-generator-menu',CustomFavoriteItem,0);return CustomFavoriteItem;});;

/* /web/static/src/legacy/js/control_panel/custom_filter_item.js defined in bundle 'web.assets_backend' */
odoo.define('web.CustomFilterItem',function(require){"use strict";const{DatePicker,DateTimePicker}=require('web.DatePickerOwl');const Domain=require('web.Domain');const{FIELD_OPERATORS,FIELD_TYPES}=require('web.searchUtils');const field_utils=require('web.field_utils');const{useModel}=require('web.Model');const{Component,hooks}=owl;const{useState}=hooks;class CustomFilterItem extends Component{constructor(){super(...arguments);this.model=useModel('searchModel');this.conditions=useState([]);this.fields=Object.values(this.props.fields).filter(field=>this._validateField(field)).concat({string:'ID',type:'id',name:'id'}).sort(({string:a},{string:b})=>a>b?1:a<b?-1:0);this.DECIMAL_POINT=this.env._t.database.parameters.decimal_point;this.OPERATORS=FIELD_OPERATORS;this.FIELD_TYPES=FIELD_TYPES;this.addNewCondition();}
addNewCondition(){const lastCondition=[...this.conditions].pop();const condition=lastCondition?Object.assign({},lastCondition):{field:0,operator:0,};this._setDefaultValue(condition);this.conditions.push(condition);}
_validateField(field){return!field.deprecated&&field.searchable&&FIELD_TYPES[field.type]&&field.name!=='id';}
_setDefaultValue(condition){const fieldType=this.fields[condition.field].type;const genericType=FIELD_TYPES[fieldType];const operator=FIELD_OPERATORS[genericType][condition.operator];switch(genericType){case'id':case'number':condition.value=0;break;case'date':condition.value=[moment()];if(operator.symbol==='between'){condition.value.push(moment());}
break;case'datetime':condition.value=[moment('00:00:00','hh:mm:ss').utcOffset(0,true)];if(operator.symbol==='between'){condition.value.push(moment('23:59:59','hh:mm:ss').utcOffset(0,true));}
break;case'selection':const[firstValue]=this.fields[condition.field].selection[0];condition.value=firstValue;break;default:condition.value="";}
if(["float","monetary"].includes(fieldType)){condition.displayedValue=`0${this.DECIMAL_POINT}0`;}else{condition.displayedValue=String(condition.value);}}
onApply(){const preFilters=this.conditions.map(condition=>{const field=this.fields[condition.field];const type=this.FIELD_TYPES[field.type];const operator=this.OPERATORS[type][condition.operator];const descriptionArray=[field.string,operator.description];const domainArray=[];let domainValue;if('value'in operator){domainValue=[operator.value];}else if(['date','datetime'].includes(type)){domainValue=condition.value.map(val=>field_utils.parse[type](val,{type},{timezone:true}));const dateValue=condition.value.map(val=>field_utils.format[type](val,{type},{timezone:false}));descriptionArray.push(`"${dateValue.join(" " + this.env._t("and") + " ")}"`);}else if(type==="selection"){domainValue=[condition.value];const formattedValue=field_utils.format[type](condition.value,field);descriptionArray.push(`"${formattedValue}"`);}else{domainValue=[condition.value];descriptionArray.push(`"${condition.value}"`);}
if(operator.symbol==='between'){domainArray.push([field.name,'>=',domainValue[0]],[field.name,'<=',domainValue[1]]);}else{domainArray.push([field.name,operator.symbol,domainValue[0]]);}
const preFilter={description:descriptionArray.join(" "),domain:Domain.prototype.arrayToString(domainArray),type:'filter',};return preFilter;});this.model.dispatch('createNewFilters',preFilters);this.conditions.splice(0,this.conditions.length);this.addNewCondition();}
onDateChanged(condition,valueIndex,ev){condition.value[valueIndex]=ev.detail.date;}
onFieldSelect(condition,ev){Object.assign(condition,{field:ev.target.selectedIndex,operator:0,});this._setDefaultValue(condition);}
onOperatorSelect(condition,ev){condition.operator=ev.target.selectedIndex;this._setDefaultValue(condition);}
onRemoveCondition(conditionIndex){this.conditions.splice(conditionIndex,1);}
onValueChange(condition,ev){if(!ev.target.value){return this._setDefaultValue(condition);}
let{type}=this.fields[condition.field];if(type==="id"){type="integer";}
if(FIELD_TYPES[type]==="number"){try{condition.value=field_utils.parse[type](ev.target.value);condition.displayedValue=ev.target.value;}catch(err){ev.target.value=condition.displayedValue;}}else{condition.value=condition.displayedValue=ev.target.value;}}}
CustomFilterItem.components={DatePicker,DateTimePicker};CustomFilterItem.props={fields:Object};CustomFilterItem.template="web.CustomFilterItem";return CustomFilterItem;});;

/* /web/static/src/legacy/js/control_panel/custom_group_by_item.js defined in bundle 'web.assets_backend' */
odoo.define('web.CustomGroupByItem',function(require){"use strict";const{useModel}=require('web.Model');const{Component,hooks}=owl;const{useState}=hooks;class CustomGroupByItem extends Component{constructor(){super(...arguments);this.state=useState({fieldName:this.props.fields[0].name,});this.model=useModel('searchModel');}
onApply(){const field=this.props.fields.find(f=>f.name===this.state.fieldName);this.model.dispatch('createNewGroupBy',field);}}
CustomGroupByItem.template="web.CustomGroupByItem";CustomGroupByItem.props={fields:Array,};return CustomGroupByItem;});;

/* /web/static/src/legacy/js/control_panel/favorite_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.FavoriteMenu',function(require){"use strict";const Dialog=require('web.OwlDialog');const{FACET_ICONS}=require("web.searchUtils");const Registry=require('web.Registry');const{useModel}=require('web.Model');const{Component,useState}=owl;class FavoriteMenu extends Component{constructor(){super(...arguments);this.icon=FACET_ICONS.favorite;this.model=useModel('searchModel');this.state=useState({deletedFavorite:false});}
get items(){const favorites=this.model.get('filters',f=>f.type==='favorite');const registryMenus=this.constructor.registry.values().reduce((menus,Component)=>{if(Component.shouldBeDisplayed(this.env)){menus.push({key:Component.name,groupNumber:Component.groupNumber,Component,});}
return menus;},[]);return[...favorites,...registryMenus];}
openConfirmationDialog(id){const favorite=this.items.find(fav=>fav.id===id);this.state.deletedFavorite=favorite;}
onFavoriteSelected(ev){ev.stopPropagation();this.model.dispatch('toggleFilter',ev.detail.payload.itemId);}
async _onRemoveFavorite(){this.model.dispatch('deleteFavorite',this.state.deletedFavorite.id);this.state.deletedFavorite=false;}}
FavoriteMenu.registry=new Registry();FavoriteMenu.components={Dialog};FavoriteMenu.template='web.Legacy.FavoriteMenu';return FavoriteMenu;});;

/* /web/static/src/legacy/js/control_panel/filter_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.FilterMenu',function(require){"use strict";const CustomFilterItem=require('web.CustomFilterItem');const{FACET_ICONS}=require("web.searchUtils");const{useModel}=require('web.Model');const{Component}=owl;class FilterMenu extends Component{constructor(){super(...arguments);this.icon=FACET_ICONS.filter;this.model=useModel('searchModel');}
get items(){return this.model.get('filters',f=>f.type==='filter');}
onFilterSelected(ev){ev.stopPropagation();const{itemId,optionId}=ev.detail.payload;if(optionId){this.model.dispatch('toggleFilterWithOptions',itemId,optionId);}else{this.model.dispatch('toggleFilter',itemId);}}}
FilterMenu.components={CustomFilterItem};FilterMenu.props={fields:Object};FilterMenu.template="web.legacy.FilterMenu";return FilterMenu;});;

/* /web/static/src/legacy/js/control_panel/groupby_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.GroupByMenu',function(require){"use strict";const CustomGroupByItem=require('web.CustomGroupByItem');const{FACET_ICONS,GROUPABLE_TYPES}=require('web.searchUtils');const{useModel}=require('web.Model');const{Component}=owl;class GroupByMenu extends Component{constructor(){super(...arguments);this.icon=FACET_ICONS.groupBy;this.fields=Object.values(this.props.fields).filter(field=>this._validateField(field)).sort(({string:a},{string:b})=>a>b?1:a<b?-1:0);this.model=useModel('searchModel');}
get items(){return this.model.get('filters',f=>f.type==='groupBy');}
_validateField(field){return(field.sortable||(field.type==="many2many"&&field.store))&&field.name!=="id"&&GROUPABLE_TYPES.includes(field.type);}
onGroupBySelected(ev){ev.stopPropagation();const{itemId,optionId}=ev.detail.payload;if(optionId){this.model.dispatch('toggleFilterWithOptions',itemId,optionId);}else{this.model.dispatch('toggleFilter',itemId);}}}
GroupByMenu.components={CustomGroupByItem};GroupByMenu.props={fields:Object};GroupByMenu.template="web.GroupByMenu";return GroupByMenu;});;

/* /web/static/src/legacy/js/control_panel/search_bar.js defined in bundle 'web.assets_backend' */
odoo.define('web.SearchBar',function(require){"use strict";const Domain=require('web.Domain');const field_utils=require('web.field_utils');const{useAutofocus}=require('web.custom_hooks');const{useModel}=require('web.Model');const{fuzzyTest}=require('@web/core/utils/search');const CHAR_FIELDS=['char','html','many2many','many2one','one2many','text'];const{Component,hooks}=owl;const{useExternalListener,useRef,useState}=hooks;let sourceId=0;class SearchBar extends Component{constructor(){super(...arguments);this.focusOnUpdate=useAutofocus();this.inputRef=useRef('search-input');this.model=useModel('searchModel');this.state=useState({sources:[],focusedItem:0,inputValue:"",});this.autoCompleteSources=this.model.get('filters',f=>f.type==='field').map(filter=>this._createSource(filter));this.noResultItem=[null,this.env._t("(no result)")];useExternalListener(window,'click',this._onWindowClick);useExternalListener(window,'keydown',this._onWindowKeydown);}
mounted(){this.env.searchModel.on('search',this,this.focusOnUpdate);this.env.searchModel.on('focus-control-panel',this,()=>{this.inputRef.el.focus();});}
willUnmount(){this.env.searchModel.off('search',this);this.env.searchModel.off('focus-control-panel',this);}
_closeAutoComplete(){this.state.sources=[];this.state.focusedItem=0;this.state.inputValue="";this.inputRef.el.value="";this.focusOnUpdate();}
_createSource(filter){const field=this.props.fields[filter.fieldName];const type=field.type==="reference"?"char":field.type;const source={active:true,description:filter.description,filterId:filter.id,filterOperator:filter.operator,id:sourceId++,operator:CHAR_FIELDS.includes(type)?'ilike':'=',parent:false,type,};switch(type){case'selection':{source.active=false;source.selection=field.selection||[];break;}
case'boolean':{source.active=false;source.selection=[[true,this.env._t("Yes")],[false,this.env._t("No")],];break;}
case'many2one':{source.expand=true;source.expanded=false;source.context=field.context;source.relation=field.relation;if(filter.domain){source.domain=filter.domain;}}}
return source;}
_createSubSource(source,[value,label],active=true){const subSource={active,filterId:source.filterId,filterOperator:source.filterOperator,id:sourceId++,label,operator:'=',parent:source,value,};return subSource;}
async _expandSource(source,shouldExpand){source.expanded=shouldExpand;if(shouldExpand){let args=source.domain;if(typeof args==='string'){try{args=Domain.prototype.stringToArray(args);}catch(err){args=[];}}
const results=await this.rpc({kwargs:{args,context:source.context,limit:8,name:this.state.inputValue.trim(),},method:'name_search',model:source.relation,});const options=results.map(result=>this._createSubSource(source,result));const parentIndex=this.state.sources.indexOf(source);if(!options.length){options.push(this._createSubSource(source,this.noResultItem,false));}
this.state.sources.splice(parentIndex+1,0,...options);}else{this.state.sources=this.state.sources.filter(src=>src.parent!==source);}}
_filterSources(query){return this.autoCompleteSources.reduce((sources,source)=>{if(source.selection){const options=[];source.selection.forEach(result=>{if(fuzzyTest(query,result[1].toLowerCase())){options.push(this._createSubSource(source,result));}});if(options.length){sources.push(...options);}}else if(this._validateSource(query,source)){sources.push(source);}
if(source.expanded){source.expanded=false;}
return sources;},[]);}
_focusFacet(index){const facets=this.el.getElementsByClassName('o_searchview_facet');if(facets.length){facets[index].focus();}}
_parseWithSource(rawValue,{type}){const parser=field_utils.parse[type];let parsedValue;switch(type){case'date':case'datetime':{const parsedDate=parser(rawValue,{type},{timezone:true});const dateFormat=type==='datetime'?'YYYY-MM-DD HH:mm:ss':'YYYY-MM-DD';const momentValue=moment(parsedDate,dateFormat);if(!momentValue.isValid()){throw new Error('Invalid date');}
parsedValue=parsedDate.toJSON();break;}
case'many2one':{parsedValue=rawValue;break;}
default:{parsedValue=parser(rawValue);}}
return parsedValue;}
_selectSource(source){if(source.active){const labelValue=source.label||this.state.inputValue;this.model.dispatch('addAutoCompletionValues',{filterId:source.filterId,value:"value"in source?source.value:this._parseWithSource(labelValue,source),label:labelValue,operator:source.filterOperator||source.operator,});}
this._closeAutoComplete();}
_validateSource(query,source){try{this._parseWithSource(query,source);}catch(err){return false;}
return true;}
_onFacetKeydown(facet,facetIndex,ev){switch(ev.key){case'ArrowLeft':if(facetIndex===0){this.inputRef.el.focus();}else{this._focusFacet(facetIndex-1);}
break;case'ArrowRight':const facets=this.el.getElementsByClassName('o_searchview_facet');if(facetIndex===facets.length-1){this.inputRef.el.focus();}else{this._focusFacet(facetIndex+1);}
break;case'Backspace':this._onFacetRemove(facet);break;}}
_onFacetRemove(facet){this.model.dispatch('deactivateGroup',facet.groupId);}
_onSearchKeydown(ev){if(ev.isComposing){return;}
const currentItem=this.state.sources[this.state.focusedItem]||{};switch(ev.key){case'ArrowDown':ev.preventDefault();if(Object.keys(this.state.sources).length){let nextIndex=this.state.focusedItem+1;if(nextIndex>=this.state.sources.length){nextIndex=0;}
this.state.focusedItem=nextIndex;}else{this.env.bus.trigger('focus-view');}
break;case'ArrowLeft':if(currentItem.expanded){ev.preventDefault();this._expandSource(currentItem,false);}else if(currentItem.parent){ev.preventDefault();this.state.focusedItem=this.state.sources.indexOf(currentItem.parent);}else if(ev.target.selectionStart===0){this._focusFacet(this.model.get("facets").length-1);}
break;case'ArrowRight':if(ev.target.selectionStart===this.state.inputValue.length){if(currentItem.expand){ev.preventDefault();if(currentItem.expanded){this.state.focusedItem++;}else{this._expandSource(currentItem,true);}}else if(ev.target.selectionStart===this.state.inputValue.length){this._focusFacet(0);}}
break;case'ArrowUp':ev.preventDefault();let previousIndex=this.state.focusedItem-1;if(previousIndex<0){previousIndex=this.state.sources.length-1;}
this.state.focusedItem=previousIndex;break;case'Backspace':if(!this.state.inputValue.length){const facets=this.model.get("facets");if(facets.length){this._onFacetRemove(facets[facets.length-1]);}}
break;case'Enter':if(!this.state.inputValue.length){this.model.dispatch('search');break;}
case'Tab':if(this.state.inputValue.length){ev.preventDefault();this._selectSource(currentItem);}
break;case'Escape':if(this.state.sources.length){this._closeAutoComplete();}
break;}}
_onSearchInput(ev){this.state.inputValue=ev.target.value;const wasVisible=this.state.sources.length;const query=this.state.inputValue.trim().toLowerCase();if(query.length){this.state.sources=this._filterSources(query);}else if(wasVisible){this._closeAutoComplete();}}
_onSourceMousemove(resultIndex){this.state.focusedItem=resultIndex;}
_onWindowClick(ev){if(this.state.sources.length&&!this.el.contains(ev.target)){this._closeAutoComplete();}}
_onWindowKeydown(ev){if(ev.key==='Escape'&&this.state.sources.length){ev.preventDefault();ev.stopPropagation();this._closeAutoComplete();}}}
SearchBar.defaultProps={fields:{},};SearchBar.props={fields:Object,};SearchBar.template='web.Legacy.SearchBar';return SearchBar;});;

/* /web/static/src/legacy/js/control_panel/search_utils.js defined in bundle 'web.assets_backend' */
odoo.define('web.searchUtils',function(require){"use strict";const{_lt,_t}=require('web.core');const Domain=require('web.Domain');const pyUtils=require('web.py_utils');const FIELD_OPERATORS={binary:[{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],boolean:[{symbol:"=",description:_lt("is true"),value:true},{symbol:"!=",description:_lt("is false"),value:true},],char:[{symbol:"ilike",description:_lt("contains")},{symbol:"not ilike",description:_lt("doesn't contain")},{symbol:"=",description:_lt("is equal to")},{symbol:"!=",description:_lt("is not equal to")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],date:[{symbol:"=",description:_lt("is equal to")},{symbol:"!=",description:_lt("is not equal to")},{symbol:">",description:_lt("is after")},{symbol:"<",description:_lt("is before")},{symbol:">=",description:_lt("is after or equal to")},{symbol:"<=",description:_lt("is before or equal to")},{symbol:"between",description:_lt("is between")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],datetime:[{symbol:"between",description:_lt("is between")},{symbol:"=",description:_lt("is equal to")},{symbol:"!=",description:_lt("is not equal to")},{symbol:">",description:_lt("is after")},{symbol:"<",description:_lt("is before")},{symbol:">=",description:_lt("is after or equal to")},{symbol:"<=",description:_lt("is before or equal to")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],id:[{symbol:"=",description:_lt("is")},{symbol:"<=",description:_lt("less than or equal to")},{symbol:">",description:_lt("greater than")},],number:[{symbol:"=",description:_lt("is equal to")},{symbol:"!=",description:_lt("is not equal to")},{symbol:">",description:_lt("greater than")},{symbol:"<",description:_lt("less than")},{symbol:">=",description:_lt("greater than or equal to")},{symbol:"<=",description:_lt("less than or equal to")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],selection:[{symbol:"=",description:_lt("is")},{symbol:"!=",description:_lt("is not")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],};const FIELD_TYPES={binary:'binary',boolean:'boolean',char:'char',date:'date',datetime:'datetime',float:'number',id:'id',integer:'number',html:'char',many2many:'char',many2one:'char',monetary:'number',one2many:'char',text:'char',selection:'selection',};const DEFAULT_PERIOD='this_month';const QUARTERS={1:{description:_lt("Q1"),coveredMonths:[0,1,2]},2:{description:_lt("Q2"),coveredMonths:[3,4,5]},3:{description:_lt("Q3"),coveredMonths:[6,7,8]},4:{description:_lt("Q4"),coveredMonths:[9,10,11]},};const MONTH_OPTIONS={this_month:{id:'this_month',groupNumber:1,format:'MMMM',addParam:{},granularity:'month',},last_month:{id:'last_month',groupNumber:1,format:'MMMM',addParam:{months:-1},granularity:'month',},antepenultimate_month:{id:'antepenultimate_month',groupNumber:1,format:'MMMM',addParam:{months:-2},granularity:'month',},};const QUARTER_OPTIONS={fourth_quarter:{id:'fourth_quarter',groupNumber:1,description:QUARTERS[4].description,setParam:{quarter:4},granularity:'quarter',},third_quarter:{id:'third_quarter',groupNumber:1,description:QUARTERS[3].description,setParam:{quarter:3},granularity:'quarter',},second_quarter:{id:'second_quarter',groupNumber:1,description:QUARTERS[2].description,setParam:{quarter:2},granularity:'quarter',},first_quarter:{id:'first_quarter',groupNumber:1,description:QUARTERS[1].description,setParam:{quarter:1},granularity:'quarter',},};const YEAR_OPTIONS={this_year:{id:'this_year',groupNumber:2,format:'YYYY',addParam:{},granularity:'year',},last_year:{id:'last_year',groupNumber:2,format:'YYYY',addParam:{years:-1},granularity:'year',},antepenultimate_year:{id:'antepenultimate_year',groupNumber:2,format:'YYYY',addParam:{years:-2},granularity:'year',},};const PERIOD_OPTIONS=Object.assign({},MONTH_OPTIONS,QUARTER_OPTIONS,YEAR_OPTIONS);const GROUPABLE_TYPES=['boolean','char','date','datetime','integer','many2one','many2many','selection',];const DEFAULT_INTERVAL='month';const INTERVAL_OPTIONS={year:{description:_lt("Year"),id:'year',groupNumber:1},quarter:{description:_lt("Quarter"),id:'quarter',groupNumber:1},month:{description:_lt("Month"),id:'month',groupNumber:1},week:{description:_lt("Week"),id:'week',groupNumber:1},day:{description:_lt("Day"),id:'day',groupNumber:1}};const COMPARISON_OPTIONS={previous_period:{description:_lt("Previous Period"),id:'previous_period',},previous_year:{description:_lt("Previous Year"),id:'previous_year',addParam:{years:-1},},};const PER_YEAR={year:1,quarter:4,month:12,};const FACET_ICONS={filter:'fa fa-filter',groupBy:'fa fa-bars',favorite:'fa fa-star',comparison:'fa fa-adjust',};function constructDateDomain(referenceMoment,fieldName,fieldType,selectedOptionIds,comparisonOptionId){let addParam;let selectedOptions;if(comparisonOptionId){[addParam,selectedOptions]=getComparisonParams(referenceMoment,selectedOptionIds,comparisonOptionId);}else{selectedOptions=getSelectedOptions(referenceMoment,selectedOptionIds);}
const yearOptions=selectedOptions.year;const otherOptions=[...(selectedOptions.quarter||[]),...(selectedOptions.month||[])];sortPeriodOptions(yearOptions);sortPeriodOptions(otherOptions);const ranges=[];for(const yearOption of yearOptions){const constructRangeParams={referenceMoment,fieldName,fieldType,addParam,};if(otherOptions.length){for(const option of otherOptions){const setParam=Object.assign({},yearOption.setParam,option?option.setParam:{});const{granularity}=option;const range=constructDateRange(Object.assign({granularity,setParam},constructRangeParams));ranges.push(range);}}else{const{granularity,setParam}=yearOption;const range=constructDateRange(Object.assign({granularity,setParam},constructRangeParams));ranges.push(range);}}
const domain=pyUtils.assembleDomains(ranges.map(range=>range.domain),'OR');const description=ranges.map(range=>range.description).join("/");return{domain,description};}
function constructDateRange({referenceMoment,fieldName,fieldType,granularity,setParam,addParam,}){const date=referenceMoment.clone().set(setParam).add(addParam||{});let leftBound=date.clone().locale('en').startOf(granularity);let rightBound=date.clone().locale('en').endOf(granularity);if(fieldType==='date'){leftBound=leftBound.format('YYYY-MM-DD');rightBound=rightBound.format('YYYY-MM-DD');}else{leftBound=leftBound.utc().format('YYYY-MM-DD HH:mm:ss');rightBound=rightBound.utc().format('YYYY-MM-DD HH:mm:ss');}
const domain=Domain.prototype.arrayToString(['&',[fieldName,'>=',leftBound],[fieldName,'<=',rightBound]]);const descriptions=[date.format("YYYY")];const method=_t.database.parameters.direction==="rtl"?"push":"unshift";if(granularity==="month"){descriptions[method](date.format("MMMM"));}else if(granularity==="quarter"){descriptions[method](QUARTERS[date.quarter()].description);}
const description=descriptions.join(" ");return{domain,description,};}
function getComparisonOptions(){return getOptionsWithDescriptions(COMPARISON_OPTIONS);}
function getComparisonParams(referenceMoment,selectedOptionIds,comparisonOptionId){const comparisonOption=COMPARISON_OPTIONS[comparisonOptionId];const selectedOptions=getSelectedOptions(referenceMoment,selectedOptionIds);let addParam=comparisonOption.addParam;if(addParam){return[addParam,selectedOptions];}
addParam={};let globalGranularity='year';if(selectedOptions.month){globalGranularity='month';}else if(selectedOptions.quarter){globalGranularity='quarter';}
const granularityFactor=PER_YEAR[globalGranularity];const years=selectedOptions.year.map(o=>o.setParam.year);const yearMin=Math.min(...years);const yearMax=Math.max(...years);let optionMin=0;let optionMax=0;if(selectedOptions.quarter){const quarters=selectedOptions.quarter.map(o=>o.setParam.quarter);if(globalGranularity==='month'){delete selectedOptions.quarter;for(const quarter of quarters){for(const month of QUARTERS[quarter].coveredMonths){const monthOption=selectedOptions.month.find(o=>o.setParam.month===month);if(!monthOption){selectedOptions.month.push({setParam:{month,},granularity:'month',});}}}}else{optionMin=Math.min(...quarters);optionMax=Math.max(...quarters);}}
if(selectedOptions.month){const months=selectedOptions.month.map(o=>o.setParam.month);optionMin=Math.min(...months);optionMax=Math.max(...months);}
addParam[globalGranularity]=-1+
granularityFactor*(yearMin-yearMax)+
optionMin-optionMax;return[addParam,selectedOptions];}
function getIntervalOptions(){return getOptionsWithDescriptions(INTERVAL_OPTIONS);}
function getPeriodOptions(referenceMoment){const options=[];for(const option of Object.values(PERIOD_OPTIONS)){const{id,groupNumber,description,}=option;const res={id,groupNumber,};const date=referenceMoment.clone().set(option.setParam).add(option.addParam);if(description){res.description=description.toString();}else{res.description=date.format(option.format.toString());}
res.setParam=getSetParam(option,referenceMoment);res.defaultYear=date.year();options.push(res);}
for(const option of options){const yearOption=options.find(o=>o.setParam&&o.setParam.year===option.defaultYear);option.defaultYearId=yearOption.id;delete option.defaultYear;delete option.setParam;}
return options;}
function getOptionsWithDescriptions(OPTIONS){const options=[];for(const option of Object.values(OPTIONS)){const{id,groupNumber,description,}=option;const res={id,};if(description){res.description=description.toString();}
if(groupNumber){res.groupNumber=groupNumber;}
options.push(res);}
return options;}
function getSelectedOptions(referenceMoment,selectedOptionIds){const selectedOptions={year:[]};for(const optionId of selectedOptionIds){const option=PERIOD_OPTIONS[optionId];const setParam=getSetParam(option,referenceMoment);const granularity=option.granularity;if(!selectedOptions[granularity]){selectedOptions[granularity]=[];}
selectedOptions[granularity].push({granularity,setParam});}
return selectedOptions;}
function getSetParam(periodOption,referenceMoment){if(periodOption.setParam){return periodOption.setParam;}
const date=referenceMoment.clone().add(periodOption.addParam);const setParam={};setParam[periodOption.granularity]=date[periodOption.granularity]();return setParam;}
function rankInterval(intervalOptionId){return Object.keys(INTERVAL_OPTIONS).indexOf(intervalOptionId);}
function sortPeriodOptions(options){options.sort((o1,o2)=>{const granularity1=o1.granularity;const granularity2=o2.granularity;if(granularity1===granularity2){return o1.setParam[granularity1]-o2.setParam[granularity1];}
return granularity1<granularity2?-1:1;});}
function yearSelected(selectedOptionIds){return selectedOptionIds.some(optionId=>!!YEAR_OPTIONS[optionId]);}
return{COMPARISON_OPTIONS,DEFAULT_INTERVAL,DEFAULT_PERIOD,FACET_ICONS,FIELD_OPERATORS,FIELD_TYPES,GROUPABLE_TYPES,INTERVAL_OPTIONS,PERIOD_OPTIONS,constructDateRange,constructDateDomain,getComparisonOptions,getIntervalOptions,getPeriodOptions,rankInterval,yearSelected,};});;

/* /web/static/src/legacy/js/core/domain.js defined in bundle 'web.assets_backend' */
odoo.define("web.Domain",function(require){"use strict";var collections=require("web.collections");var pyUtils=require("web.py_utils");var py=window.py;const TRUE_LEAF=[1,'=',1];const FALSE_LEAF=[0,'=',1];const TRUE_DOMAIN=[TRUE_LEAF];const FALSE_DOMAIN=[FALSE_LEAF];function compare(a,b){return JSON.stringify(a)===JSON.stringify(b);}
var Domain=collections.Tree.extend({init:function(domain,evalContext){this._super.apply(this,arguments);if(_.isArray(domain)||_.isString(domain)){this._parse(this.normalizeArray(_.clone(this.stringToArray(domain,evalContext))));}else{this._data=!!domain;}},compute:function(values){if(this._data===true||this._data===false){return this._data;}else if(_.isArray(this._data)){var isParentField=false;var fieldName=this._data[0];let fieldValue;if(compare(this._data,FALSE_LEAF)||compare(this._data,TRUE_LEAF)){fieldValue=this._data[0];}else{var parentField=this._data[0].split('.');if('parent'in values&&parentField.length===2){fieldName=parentField[1];isParentField=parentField[0]==='parent'&&fieldName in values.parent;}
if(!(this._data[0]in values)&&!(isParentField)){throw new Error(_.str.sprintf("Unknown field %s in domain",this._data[0]));}
fieldValue=isParentField?values.parent[fieldName]:values[fieldName];}
switch(this._data[1]){case"=":case"==":return _.isEqual(fieldValue,this._data[2]);case"!=":case"<>":return!_.isEqual(fieldValue,this._data[2]);case"<":return(fieldValue<this._data[2]);case">":return(fieldValue>this._data[2]);case"<=":return(fieldValue<=this._data[2]);case">=":return(fieldValue>=this._data[2]);case"in":return _.intersection(_.isArray(this._data[2])?this._data[2]:[this._data[2]],_.isArray(fieldValue)?fieldValue:[fieldValue],).length!==0;case"not in":return _.intersection(_.isArray(this._data[2])?this._data[2]:[this._data[2]],_.isArray(fieldValue)?fieldValue:[fieldValue],).length===0;case"like":if(fieldValue===false){return false;}
return(fieldValue.indexOf(this._data[2])>=0);case"=like":if(fieldValue===false){return false;}
return new RegExp(this._data[2].replace(/%/g,'.*')).test(fieldValue);case"ilike":if(fieldValue===false){return false;}
return(fieldValue.toLowerCase().indexOf(this._data[2].toLowerCase())>=0);case"=ilike":if(fieldValue===false){return false;}
return new RegExp(this._data[2].replace(/%/g,'.*'),'i').test(fieldValue);default:throw new Error(_.str.sprintf("Domain %s uses an unsupported operator",this._data));}}else{switch(this._data){case"&":return _.every(this._children,function(child){return child.compute(values);});case"|":return _.some(this._children,function(child){return child.compute(values);});case"!":return!this._children[0].compute(values);}}},toArray:function(){if(this._data===false){throw new Error("'false' domain cannot be converted to array");}else if(this._data===true){return[];}else{var arr=[this._data];return arr.concat.apply(arr,_.map(this._children,function(child){return child.toArray();}));}},toString:function(){return Domain.prototype.arrayToString(this.toArray());},_parse:function(domain){this._data=(domain.length===0?true:domain[0]);if(domain.length<=1)return;var expected=1;for(var i=1;i<domain.length;i++){if(domain[i]==="&"||domain[i]==="|"){expected++;}else if(domain[i]!=="!"){expected--;}
if(!expected){i++;this._addSubdomain(domain.slice(1,i));this._addSubdomain(domain.slice(i));break;}}},_addSubdomain:function(domain){if(!domain.length)return;var subdomain=new Domain(domain);if(!subdomain._children.length||subdomain._data!==this._data){this._children.push(subdomain);}else{var self=this;_.each(subdomain._children,function(childDomain){self._children.push(childDomain);});}},arrayToString:function(domain){if(_.isString(domain))return domain;function jsToPy(p){switch(p){case null:return"None";case true:return"True";case false:return"False";default:if(Array.isArray(p)){return`[${p.map(jsToPy)}]`;}
return JSON.stringify(p);}}
return`[${(domain || []).map(jsToPy)}]`;},stringToArray:function(domain,evalContext){if(!_.isString(domain))return _.clone(domain);return pyUtils.eval("domain",domain?domain.replace(/%%/g,'%'):"[]",evalContext);},normalizeArray:function(domain){if(domain.length===0){return domain;}
var expected=1;_.each(domain,function(item){if(item==="&"||item==="|"){expected++;}else if(item!=="!"){expected--;}});if(expected<0){domain.unshift.apply(domain,_.times(Math.abs(expected),_.constant("&")));}else if(expected>0){throw new Error(_.str.sprintf("invalid domain %s (missing %d segment(s))",JSON.stringify(domain),expected));}
return domain;},domainToCondition:function(domain){if(!domain.length){return'True';}
var self=this;function consume(stack){var len=stack.length;if(len<=1){return stack;}else if(stack[len-1]==='|'||stack[len-1]==='&'||stack[len-2]==='|'||stack[len-2]==='&'){return stack;}else if(len==2){stack.splice(-2,2,stack[len-2]+' and '+stack[len-1]);}else if(stack[len-3]=='|'){if(len===3){stack.splice(-3,3,stack[len-2]+' or '+stack[len-1]);}else{stack.splice(-3,3,'('+stack[len-2]+' or '+stack[len-1]+')');}}else{stack.splice(-3,3,stack[len-2]+' and '+stack[len-1]);}
consume(stack);}
var stack=[];_.each(domain,function(dom){if(dom==='|'||dom==='&'){stack.push(dom);}else{var operator=dom[1]==='='?'==':dom[1];if(!operator){throw new Error('Wrong operator for this domain');}
if(operator==='!='&&dom[2]===false){stack.push(dom[0]);}else if(dom[2]===null||dom[2]===true||dom[2]===false){stack.push(dom[0]+' '+(operator==='!='?'is not ':'is ')+(dom[2]===null?'None':(dom[2]?'True':'False')));}else{stack.push(dom[0]+' '+operator+' '+JSON.stringify(dom[2]));}
consume(stack);}});if(stack.length!==1){throw new Error('Wrong domain');}
return stack[0];},conditionToDomain:function(condition){if(!condition||condition.match(/^\s*(True)?\s*$/)){return[];}
var ast=py.parse(py.tokenize(condition));function astToStackValue(node){switch(node.id){case'(name)':return node.value;case'.':return astToStackValue(node.first)+'.'+astToStackValue(node.second);case'(string)':return node.value;case'(number)':return node.value;case'(constant)':return node.value==='None'?null:node.value==='True'?true:false;case'(':case'[':return _.map(node.first,function(node){return astToStackValue(node);});}}
function astToStack(node){switch(node.id){case'(name)':return[[astToStackValue(node),'!=',false]];case'.':return[[astToStackValue(node.first)+'.'+astToStackValue(node.second),'!=',false]];case'not':return[[astToStackValue(node.first),'=',false]];case'or':return['|'].concat(astToStack(node.first)).concat(astToStack(node.second));case'and':return['&'].concat(astToStack(node.first)).concat(astToStack(node.second));case'(comparator)':if(node.operators.length!==1){throw new Error('Wrong condition to convert in domain');}
var right=astToStackValue(node.expressions[0]);var left=astToStackValue(node.expressions[1]);var operator=node.operators[0];switch(operator){case'is':operator='=';break;case'is not':operator='!=';break;case'==':operator='=';break;}
return[[right,operator,left]];default:throw"Condition cannot be transformed into domain";}}
return astToStack(ast);},});Domain.TRUE_LEAF=TRUE_LEAF;Domain.FALSE_LEAF=FALSE_LEAF;Domain.TRUE_DOMAIN=TRUE_DOMAIN;Domain.FALSE_DOMAIN=FALSE_DOMAIN;return Domain;});;

/* /web/static/src/legacy/js/core/mvc.js defined in bundle 'web.assets_backend' */
odoo.define('web.mvc',function(require){"use strict";var ajax=require('web.ajax');var Class=require('web.Class');var mixins=require('web.mixins');var ServicesMixin=require('web.ServicesMixin');var Widget=require('web.Widget');var Model=Class.extend(mixins.EventDispatcherMixin,ServicesMixin,{init:function(parent,params){mixins.EventDispatcherMixin.init.call(this);this.setParent(parent);},get:function(){},load:function(){return Promise.resolve();},});var Renderer=Widget.extend({init:function(parent,state,params){this._super(parent);this.state=state;},});var Controller=Widget.extend({init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.handle=params.handle||null;this.model=model;this.renderer=renderer;},start:function(){return Promise.all([this._super.apply(this,arguments),this._startRenderer()]);},_startRenderer:function(){return this.renderer.appendTo(this.$el);},});var Factory=Class.extend({config:{Model:Model,Renderer:Renderer,Controller:Controller,},init:function(){this.rendererParams={};this.controllerParams={};this.modelParams={};this.loadParams={};},getController:function(parent){var self=this;var model=this.getModel(parent);return Promise.all([this._loadData(model),ajax.loadLibs(this)]).then(function(result){const{state,handle}=result[0];var renderer=self.getRenderer(parent,state);var Controller=self.Controller||self.config.Controller;const initialState=model.get(handle);var controllerParams=_.extend({initialState,handle,},self.controllerParams);var controller=new Controller(parent,model,renderer,controllerParams);model.setParent(controller);renderer.setParent(controller);return controller;});},getModel:function(parent){var Model=this.config.Model;return new Model(parent,this.modelParams);},getRenderer:function(parent,state){var Renderer=this.config.Renderer;return new Renderer(parent,state,this.rendererParams);},_loadData:function(model,options={}){options.withSampleData='withSampleData'in options?options.withSampleData:true;return model.load(this.loadParams).then(function(handle){return{state:model.get(handle,options),handle};});},});return{Factory:Factory,Model:Model,Renderer:Renderer,Controller:Controller,};});;

/* /web/static/src/legacy/js/core/py_utils.js defined in bundle 'web.assets_backend' */
odoo.define('web.py_utils',function(require){"use strict";var core=require('web.core');var _t=core._t;var py=window.py;function wrap(value){if(value===null){return py.None;}
switch(typeof value){case'undefined':throw new Error("No conversion for undefined");case'boolean':return py.bool.fromJSON(value);case'number':return py.float.fromJSON(value);case'string':return py.str.fromJSON(value);}
switch(value.constructor){case Object:return wrapping_dict.fromJSON(value);case Array:return wrapping_list.fromJSON(value);}
throw new Error("ValueError: unable to wrap "+value);}
var wrapping_dict=py.type('wrapping_dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var k=key.toJSON();if(!(k in this._store)){throw new Error("KeyError: '"+k+"'");}
return wrap(this._store[k]);},__getattr__:function(key){return this.__getitem__(py.str.fromJSON(key));},__len__:function(){return Object.keys(this._store).length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);if(!(args.k.toJSON()in this._store)){return args.d;}
return this.__getitem__(args.k);},fromJSON:function(d){var instance=py.PY_call(wrapping_dict);instance._store=d;return instance;},toJSON:function(){return this._store;},});var wrapping_list=py.type('wrapping_list',null,{__init__:function(){this._store=[];},__getitem__:function(index){return wrap(this._store[index.toJSON()]);},__len__:function(){return this._store.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},fromJSON:function(ar){var instance=py.PY_call(wrapping_list);instance._store=ar;return instance;},toJSON:function(){return this._store;},});function wrap_context(context){for(var k in context){if(!context.hasOwnProperty(k)){continue;}
var val=context[k];if(val===null){continue;}
if(val.constructor===Array){context[k]=wrapping_list.fromJSON(val);}else if(val.constructor===Object&&!py.PY_isInstance(val,py.object)){context[k]=wrapping_dict.fromJSON(val);}}
return context;}
function eval_contexts(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});return _(contexts).reduce(function(result_context,ctx){if(_.isEmpty(ctx)){return result_context;}
if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
_.extend(evaluation_context,evaluated);return _.extend(result_context,evaluated);},{});}
function eval_domains(domains,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_domain=[];var need_normalization=(domains&&domains.length>0&&domains[0].length===1&&(domains[0][0]==="|"||domains[0][0]==="!"));_(domains).each(function(domain){if(_.isString(domain)){domain={__ref:'domain',__debug:domain};}
var domain_array_to_combine;switch(domain.__ref){case'domain':evaluation_context.context=evaluation_context;domain_array_to_combine=py.eval(domain.__debug,wrap_context(evaluation_context));break;default:domain_array_to_combine=domain;}
if(need_normalization){domain_array_to_combine=get_normalized_domain(domain_array_to_combine);}
result_domain.push.apply(result_domain,domain_array_to_combine);});return result_domain;}
function get_normalized_domain(domain_array){var expected=1;_.each(domain_array,function(item){if(item==="&"||item==="|"){expected++;}else if(item!=="!"){expected--;}});var new_explicit_ands=_.times(-expected,_.constant("&"));return new_explicit_ands.concat(domain_array);}
function eval_groupbys(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_group=[];_(contexts).each(function(ctx){if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var group;var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
group=evaluated.group_by;if(!group){return;}
if(typeof group==='string'){result_group.push(group);}else if(group instanceof Array){result_group.push.apply(result_group,group);}else{throw new Error('Got invalid groupby {{'
+JSON.stringify(group)+'}}');}
_.extend(evaluation_context,evaluated);});return result_group;}
function context_today(){var d=new Date();return py.PY_call(py.extras.datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}
function tz_offset(){var offset=new Date().getTimezoneOffset();var kwargs={minutes:py.float.fromJSON(offset)};return py.PY_call(py.extras.datetime.timedelta,[],kwargs);}
function pycontext(){const d=new Date();const today=`${
        String(d.getFullYear()).padStart(4, "0")}-${
        String(d.getMonth() + 1).padStart(2, "0")}-${
        String(d.getDate()).padStart(2, "0")}`;const now=`${
        String(d.getUTCFullYear()).padStart(4, "0")}-${
        String(d.getUTCMonth() + 1).padStart(2, "0")}-${
        String(d.getUTCDate()).padStart(2, "0")} ${
        String(d.getUTCHours()).padStart(2, "0")}:${
        String(d.getUTCMinutes()).padStart(2, "0")}:${
        String(d.getUTCSeconds()).padStart(2, "0")}`;const{datetime,relativedelta,time}=py.extras;return{current_date:today,datetime,time,now,today,relativedelta,context_today,tz_offset,};}
function pyeval(type,object,context){context=_.extend(pycontext(),context||{});switch(type){case'context':case'contexts':if(type==='context'){object=[object];}
return eval_contexts(object,context);case'domain':case'domains':if(type==='domain')
object=[object];return eval_domains(object,context);case'groupbys':return eval_groupbys(object,context);}
throw new Error("Unknow evaluation type "+type);}
function eval_arg(arg){if(typeof arg!=='object'||!arg.__ref){return arg;}
switch(arg.__ref){case'domain':return pyeval('domains',[arg]);case'context':case'compound_context':return pyeval('contexts',[arg]);default:throw new Error(_t("Unknown nonliteral type ")+' '+arg.__ref);}}
function ensure_evaluated(args,kwargs){for(var i=0;i<args.length;++i){args[i]=eval_arg(args[i]);}
for(var k in kwargs){if(!kwargs.hasOwnProperty(k)){continue;}
kwargs[k]=eval_arg(kwargs[k]);}}
function eval_domains_and_contexts(source){return{context:pyeval('contexts',source.contexts||[],source.eval_context),domain:pyeval('domains',source.domains,source.eval_context),group_by:pyeval('groupbys',source.group_by_seq||[],source.eval_context),};}
function py_eval(expr,context){return py.eval(expr,_.extend({},context||{},{"true":true,"false":false,"null":null}));}
function assembleDomains(domains,operator){var ASTs=domains.map(_getPyJSAST);if(operator==="OR"){operator=py.tokenize("'|'")[0];}else{operator=py.tokenize("'&'")[0];}
var result=_getPyJSAST("[]");var normalizedDomains=ASTs.filter(function(AST){return AST.first.length>0;}).map(_normalizeDomainAST);if(normalizedDomains.length>0){result.first=normalizedDomains.reduce(function(acc,ast){return acc.concat(ast.first);},_.times(normalizedDomains.length-1,_.constant(operator)));}
return _formatAST(result);}
function normalizeDomain(domain){return _formatAST(_normalizeDomainAST(_getPyJSAST(domain)));}
var BINDING_POWERS={or:30,and:40,not:50,};function _formatAST(ast,lbp){lbp=lbp||0;switch(ast.id){case"(number)":return String(ast.value);case"(string)":return JSON.stringify(ast.value);case"(constant)":return ast.value;case"(name)":return ast.value;case"[":if(ast.second){return _formatAST(ast.first)+'['+_formatAST(ast.second)+']';}else{var values=ast.first.map(_formatAST);return'['+values.join(', ')+']';}
case"{":var keyValues=ast.first.map(function(kv){return _formatAST(kv[0])+': '+_formatAST(kv[1]);});return'{'+keyValues.join(', ')+'}';case"=":return _formatAST(ast.first)+' '+ast.id+' '+_formatAST(ast.second);case"-":case"+":case"~":case"*":case"**":case"%":case"//":case"and":case"or":if(ast.second){var r=_formatAST(ast.first,ast.lbp)+' '+ast.id+' '+_formatAST(ast.second,ast.lbp);if(ast.lbp<lbp){r='('+r+')';}
return r;}
var actualBP=BINDING_POWERS[ast.id]||130;return ast.id+_formatAST(ast.first,actualBP);case"if":var t=_formatAST(ast.ifTrue)
+' if '+_formatAST(ast.condition)
+' else '+_formatAST(ast.ifFalse);return ast.lbp<lbp?'('+t+')':t;case".":return _formatAST(ast.first,ast.lbp)+'.'+_formatAST(ast.second);case"not":return"not "+_formatAST(ast.first);case"(comparator)":var operator=ast.operators[0];return _formatAST(ast.expressions[0])+' '+operator+' '+_formatAST(ast.expressions[1]);case"(":if(ast.second){return _formatAST(ast.first)+'('+ast.second.map(_formatAST).join(', ')+')';}else{return'('+ast.first.map(_formatAST).join(', ')+')';}}
throw new Error("Unimplemented python construct");}
function _getPyJSAST(domain){return py.parse(py.tokenize(domain));}
function _normalizeDomainAST(domain){var expected=1;for(var i=0;i<domain.first.length;i++){var value=domain.first[i].value;if(value==='&'||value==='|'){expected++;}else if(value!=='!'){expected--;}}
var andOperator=py.tokenize("'&'")[0];if(expected<0){domain.first.unshift.apply(domain.first,_.times(Math.abs(expected),_.constant(andOperator)));}
return domain;}
return{context:pycontext,ensure_evaluated:ensure_evaluated,eval:pyeval,eval_domains_and_contexts:eval_domains_and_contexts,py_eval:py_eval,normalizeDomain:normalizeDomain,assembleDomains:assembleDomains,_getPyJSAST:_getPyJSAST,_formatAST:_formatAST,_normalizeDomainAST:_normalizeDomainAST,};});;

/* /web/static/src/legacy/js/core/context.js defined in bundle 'web.assets_backend' */
odoo.define('web.Context',function(require){"use strict";var Class=require('web.Class');var pyUtils=require('web.py_utils');var Context=Class.extend({init:function(){this.__ref="compound_context";this.__contexts=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(context){this.__contexts.push(context);return this;},eval:function(){return pyUtils.eval('context',this);},set_eval_context:function(evalContext){for(var key in evalContext){if(evalContext[key]instanceof moment){evalContext[key]=evalContext[key].toJSON();}}
this.__eval_context=evalContext;return this;},});return Context;});;

/* /web/static/src/legacy/js/core/data_comparison_utils.js defined in bundle 'web.assets_backend' */
odoo.define('web.dataComparisonUtils',function(require){"use strict";var fieldUtils=require('web.field_utils');var Class=require('web.Class');var DateClasses=Class.extend({init:function(dateSets){this.dateSets=dateSets;this.referenceIndex=null;for(var i=0;i<dateSets.length;i++){var dateSet=dateSets[i];if(dateSet.length&&this.referenceIndex===null){this.referenceIndex=i;}}},dateClass:function(datesetIndex,date){return this.dateSets[datesetIndex].indexOf(date);},dateClassMembers:function(dateClass){return _.uniq(_.compact(this.dateSets.map(function(dateSet){return dateSet[dateClass];})));},representative:function(dateClass,index){index=index===undefined?this.referenceIndex:index;return this.dateSets[index][dateClass];},});function computeVariation(value,comparisonValue){if(isNaN(value)||isNaN(comparisonValue)){return NaN;}
if(comparisonValue===0){if(value===0){return 0;}else if(value>0){return 1;}else{return-1;}}
return(value-comparisonValue)/Math.abs(comparisonValue);}
function renderVariation(variation,field,options){var className='o_variation';var value;if(!isNaN(variation)){if(variation>0){className+=' o_positive text-success';}else if(variation<0){className+=' o_negative text-danger';}else{className+=' o_null';}
value=fieldUtils.format.percentage(variation,field,options);}else{value='-';}
return $('<div>',{class:className,html:value});}
function renderComparison($node,value,comparisonValue,variation,formatter,field,options){var $variation=renderVariation(variation,field,options);$node.append($variation);if(!isNaN(variation)){$node.append($('<div>',{class:'o_comparison'}).html(formatter(value,field,options)+' <span>vs</span> '+formatter(comparisonValue,field,options)));}}
return{computeVariation:computeVariation,DateClasses:DateClasses,renderComparison:renderComparison,renderVariation:renderVariation,};});;

/* /web/static/src/legacy/js/core/misc.js defined in bundle 'web.assets_backend' */
odoo.define('web.framework',function(require){"use strict";var core=require('web.core');var ajax=require('web.ajax');var Widget=require('web.Widget');const{sprintf}=require('web.utils')
var _t=core._t;var messages_by_seconds=function(){return[[0,_t("Loading...")],[20,_t("Still loading...")],[60,_t("Still loading...<br />Please be patient.")],[120,_t("Don't leave yet,<br />it's still loading...")],[300,_t("You may not believe it,<br />but the application is actually loading...")],[420,_t("Take a minute to get a coffee,<br />because it's loading...")],[3600,_t("Maybe you should consider reloading the application by pressing F5...")]];};var Throbber=Widget.extend({template:"Throbber",start:function(){this.start_time=new Date().getTime();this.act_message();},act_message:function(){var self=this;setTimeout(function(){if(self.isDestroyed())
return;var seconds=(new Date().getTime()-self.start_time)/1000;var mes;_.each(messages_by_seconds(),function(el){if(seconds>=el[0])
mes=el[1];});self.$(".oe_throbber_message").html(mes);self.act_message();},1000);},});if($.blockUI){$.blockUI.defaults.baseZ=1100;$.blockUI.defaults.message='<div class="openerp oe_blockui_spin_container" style="background-color: transparent;">';$.blockUI.defaults.css.border='0';$.blockUI.defaults.css["background-color"]='';}
function blockAccessKeys(){var elementWithAccessKey=[];elementWithAccessKey=document.querySelectorAll('[accesskey]');_.each(elementWithAccessKey,function(elem){elem.setAttribute("data-accesskey",elem.getAttribute('accesskey'));elem.removeAttribute('accesskey');});}
function unblockAccessKeys(){var elementWithDataAccessKey=[];elementWithDataAccessKey=document.querySelectorAll('[data-accesskey]');_.each(elementWithDataAccessKey,function(elem){elem.setAttribute('accesskey',elem.getAttribute('data-accesskey'));elem.removeAttribute('data-accesskey');});}
var throbbers=[];function blockUI(){var tmp=$.blockUI.apply($,arguments);var throbber=new Throbber();throbbers.push(throbber);throbber.appendTo($(".oe_blockui_spin_container"));$(document.body).addClass('o_ui_blocked');blockAccessKeys();return tmp;}
function unblockUI(){_.invoke(throbbers,'destroy');throbbers=[];$(document.body).removeClass('o_ui_blocked');unblockAccessKeys();return $.unblockUI.apply($,arguments);}
function redirect(url,wait){var load=function(){var old=""+window.location;var old_no_hash=old.split("#")[0];var url_no_hash=url.split("#")[0];location.assign(url);if(old_no_hash===url_no_hash){location.reload(true);}};var wait_server=function(){ajax.rpc("/web/webclient/version_info",{}).then(load).guardedCatch(function(){setTimeout(wait_server,250);});};if(wait){setTimeout(wait_server,1000);}else{load();}}
function Reload(parent,action){var params=action.params||{};var menu_id=params.menu_id||false;var l=window.location;var sobj=$.deparam(l.search.substr(1));if(params.url_search){sobj=_.extend(sobj,params.url_search);}
var search='?'+$.param(sobj);var hash=l.hash;if(menu_id){hash="#menu_id="+menu_id;}
var url=l.protocol+"//"+l.host+l.pathname+search+hash;core.bus.trigger('clear_cache');redirect(url,params.wait);}
core.action_registry.add("reload",Reload);function Home(parent,action){var url='/'+(window.location.search||'');redirect(url,action&&action.params&&action.params.wait);}
core.action_registry.add("home",Home);function login(){redirect('/web/login');}
core.action_registry.add("login",login);function logout(){redirect('/web/session/logout');}
core.action_registry.add("logout",logout);function displayNotification(parent,action){let{title='',message='',links=[],type='info',sticky=false,next}=action.params||{};links=links.map(({url,label})=>`<a href="${_.escape(url)}" target="_blank">${_.escape(label)}</a>`)
parent.displayNotification({title,message:sprintf(_.escape(message),...links),type,sticky,messageIsHtml:true,});return next;}
core.action_registry.add("display_notification",displayNotification);function ReloadContext(parent,action){ajax.rpc("/web/session/get_session_info",{}).then(function(){Reload(parent,action);});}
core.action_registry.add("reload_context",ReloadContext);if(!document.contains){document.contains=function contains(node){if(!(0 in arguments)){throw new TypeError('1 argument is required');}
do{if(this===node){return true;}}while(node=node&&node.parentNode);return false;};}
return{blockUI:blockUI,unblockUI:unblockUI,redirect:redirect,};});;

/* /web/static/src/legacy/js/core/profiling_qweb_view.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/core/profiling_qweb_view',async function(require){'use strict';let __exports={};const registry=require("web.field_registry");const basicFfields=require("web.basic_fields");const core=require("web.core");const qweb=core.qweb;const ProfilingQwebView=basicFfields.AceEditor.extend({template:"web.ProfilingQwebView",xmlDependencies:["/web/static/src/xml/debug.xml"],events:_.extend({},basicFfields.AceEditor.prototype.events,{"click .dropdown-menu a":"_onSelectView",}),init:function(){this._super.apply(this,arguments);const results=(this.value&&JSON.parse(this.value)[0].results)||{archs:{},data:[],};this.profileLines=results.data;this.viewArch=results.archs;this.viewIDs=Array.from(new Set(this.profileLines.map((line)=>line.view_id)));for(const line of this.profileLines){line.xpath=line.xpath.replace(/([^\]])\//g,"$1[1]/").replace(/([^\]])$/g,"$1[1]");}
this.viewID=this.profileLines.length?this.profileLines[0].view_id:0;this.mode="readonly";},willStart:async function(){const _super=this._super;this.views=await this._rpc({model:"ir.ui.view",method:"search_read",fields:["id","display_name","key"],domain:[["id","in",this.viewIDs]],});for(const view of this.views){view.delay=0;view.query=0;const lines=this.profileLines.filter((l)=>l.view_id===view.id);const root=lines.find((l)=>l.xpath==="");if(root){view.delay+=root.delay;view.query+=root.query;}else{view.delay=lines.map((l)=>l.delay).reduce((a,b)=>a+b);view.query=lines.map((l)=>l.query).reduce((a,b)=>a+b);}
view.delay=Math.ceil(view.delay*10)/10;}
await _super.call(this);},_render:function(){this.view=this.views.find((view)=>view.id===this.viewID);if(this.view){const content=this.$(".dropdown-menu a[data-id="+this.view.id+"]").html();this.$(".dropdown-toggle").empty().append(content);const arch=this.viewArch[this.view.id]||"";if(this.aceSession.getValue()!==arch){this.aceSession.setValue(arch);}}else{this.aceSession.setValue("");}},_renderProfilingInformation:function(){let flat={};let arch=[{xpath:"",children:[]}];const $rows=this.$(".ace_gutter .ace_gutter-cell");$rows.find(".o_info").remove();this.$(".ace_tag-open, .ace_end-tag-close, .ace_end-tag-open, .ace_qweb").each((i,node)=>{const $node=$(node);const parent=arch[arch.length-1];let xpath=parent.xpath;if($node.hasClass("ace_end-tag-close")){const tag=$node.prevAll(".ace_tag-name:first").text();if(parent.tag===tag){arch.pop();}}else if($node.hasClass("ace_end-tag-open")){const tag=$node.next().text();if(parent.tag===tag){arch.pop();}}else if($node.hasClass("ace_qweb")){const directive=$node.text();parent.directive.push({el:node,directive:directive,});let delay=0;let query=0;for(const line of this.profileLines){if(line.view_id===this.viewID&&line.xpath===xpath&&line.directive.includes(directive)){delay+=line.delay;query+=line.query;}}
if((delay||query)&&!$node.children(".o_info").length){$(qweb.render("web.ProfilingQwebView.hover",{delay:this._formatDelay(delay),query:query,})).prependTo($node);}}else if($node.hasClass("ace_tag-open")){const $tag=$node.next(".ace_tag-name");const tag=$tag.text();const $row=$($rows[$tag.parent(".ace_line").index()]);xpath+="/"+tag;let i=1;while(flat[xpath+"["+i+"]"]){i++;}
xpath+="["+i+"]";flat[xpath]={xpath:xpath,tag:tag,children:[],directive:[]};arch.push(flat[xpath]);parent.children.push(flat[xpath]);const closed=!!$row.find(".ace_closed").length;const delays=[];const querys=[];const groups={};let displayDetail=false;for(const line of this.profileLines){if(line.view_id===this.viewID&&(closed?line.xpath.startsWith(xpath):line.xpath===xpath)){delays.push(line.delay);querys.push(line.query);const directive=line.directive.split("=")[0];if(!groups[directive]){groups[directive]={delays:[],querys:[],};}else{displayDetail=true;}
groups[directive].delays.push(this._formatDelay(line.delay));groups[directive].querys.push(line.query);}}
if(delays.length&&!$row.children(".o_info").length){$(qweb.render("web.ProfilingQwebView.info",{delay:this._formatDelay(delays.reduce((a,b)=>a+b,0)),query:querys.reduce((a,b)=>a+b,0)||".",detail:displayDetail,groups:groups,})).prependTo($row);}}
$node.attr("data-xpath",xpath);});},_formatDelay:function(delay){return delay?_.str.sprintf("%.1f",Math.ceil(delay*10)/10):".";},_startAce:function(node){this.aceEditor=window.ace.edit(node);this.aceEditor.setOptions({maxLines:Infinity,showPrintMargin:false,highlightActiveLine:false,highlightGutterLine:true,readOnly:true,});this.aceEditor.renderer.setOptions({displayIndentGuides:true,showGutter:true,});this.aceEditor.renderer.$gutter.removeAttribute("aria-hidden");this.aceEditor.renderer.$cursorLayer.element.style.display="none";this.aceEditor.$blockScrolling=true;this.aceSession=this.aceEditor.getSession();this.aceSession.setOptions({useWorker:false,mode:"ace/mode/qweb",tabSize:2,useSoftTabs:true,});this.aceEditor.renderer.on("afterRender",this._renderProfilingInformation.bind(this));},_onSelectView:function(ev){ev.preventDefault();this.viewID=+$(ev.currentTarget).data("id");this._render();},});registry.add("profiling_qweb_view",ProfilingQwebView);return __exports;});;

/* /web/static/src/legacy/js/fields/abstract_field.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractField',function(require){"use strict";var field_utils=require('web.field_utils');var Widget=require('web.Widget');var AbstractField=Widget.extend({events:{'keydown':'_onKeydown',},custom_events:{navigation_move:'_onNavigationMove',},isQuickEditable:false,quickEditExclusion:[],fieldDependencies:{},resetOnAnyFieldChange:false,specialData:false,supportedFieldTypes:[],description:"",noLabel:false,label:'',init:function(parent,name,record,options){this._super(parent);options=options||{};this.name=name;this.record=record;this.field=record.fields[name];this.viewType=options.viewType||'default';var fieldsInfo=record.fieldsInfo[this.viewType];this.attrs=options.attrs||(fieldsInfo&&fieldsInfo[name])||{};this.additionalContext=options.additionalContext||{};this.value=record.data[name];this.recordData=record.data;this.string=this.attrs.string||this.field.string||this.name;this.nodeOptions=this.attrs.options||{};this.dataPointID=record.id;this.res_id=record.res_id;this.model=record.model;this.mode=options.mode||"readonly";this.hasReadonlyModifier=options.hasReadonlyModifier||false;this._isValid=true;this.lastSetValue=undefined;this.formatType=this.attrs.widget in field_utils.format?this.attrs.widget:this.field.type;this.formatOptions={};this.parseOptions={};if(this.attrs.decorations){this.resetOnAnyFieldChange=true;}
this._canQuickEdit=this.isQuickEditable;},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.attr('name',self.name);self.$el.addClass('o_field_widget');self.$el.toggleClass('o_quick_editable',self._canQuickEdit);if(self.viewType==='form'){self.$el.on('click',self._onClick.bind(self));}
return self._render();});},activate:function(options){if(this.isFocusable()){var $focusable=this.getFocusableElement();$focusable.focus();if($focusable.is('input[type="text"], textarea')){$focusable[0].selectionStart=$focusable[0].selectionEnd=$focusable[0].value.length;if(options&&!options.noselect){$focusable.select();}}
return true;}
return false;},commitChanges:function(){},quickEdit:function(extraInfo){if(this._canQuickEdit&&this.mode!=="readonly"){this._quickEdit(extraInfo);}},getFocusableElement:function(){return $();},isEmpty:function(){return!this.isSet();},isFocusable:function(){var $focusable=this.getFocusableElement();return $focusable.length&&$focusable.is(':visible');},isSet:function(){return!!this.value;},isValid:function(){return this._isValid;},reset:function(record,event){this._reset(record,event);return this._render()||Promise.resolve();},removeInvalidClass:function(){this.$el.removeClass('o_field_invalid');this.$el.removeAttr('aria-invalid');},setIDForLabel:function(id){this.getFocusableElement().attr('id',id);},setInvalidClass:function(){this.$el.addClass('o_field_invalid');this.$el.attr('aria-invalid','true');},updateModifiersValue:function(modifiers){this.attrs.modifiersValue=modifiers||{};},_applyDecorations:function(){var self=this;this.attrs.decorations.forEach(function(dec){var isToggled=py.PY_isTrue(py.evaluate(dec.expression,self.record.evalContext));const className=self._getClassFromDecoration(dec.name);self.$el.toggleClass(className,isToggled);});},_quickEdit:function(extraInfo){this.activate({noAutomaticCreate:true});},_formatValue:function(value,formatType){var options=_.extend({},this.nodeOptions,{data:this.recordData},this.formatOptions);return field_utils.format[formatType||this.formatType](value,this.field,options);},_getClassFromDecoration:function(decoration){return`text-${decoration.split('-')[1]}`;},_getQuickEditExtraInfo(ev){return{};},_isLastSetValue:function(value){return this.lastSetValue===value||(this.value===false&&value==='');},_isSameValue:function(value){return this.value===value;},_parseValue:function(value){return field_utils.parse[this.formatType](value,this.field,this.parseOptions);},_render:function(){if(this.attrs.decorations){this._applyDecorations();}
if(this.mode==='edit'){return this._renderEdit();}else if(this.mode==='readonly'){return this._renderReadonly();}},_renderEdit:function(){},_renderReadonly:function(){},_reset:function(record,event){this.lastSetValue=undefined;this.record=record;this.value=record.data[this.name];this.recordData=record.data;},_setValue:function(value,options){if(this._isLastSetValue(value)){return Promise.resolve();}
this.lastSetValue=value;try{value=this._parseValue(value);this._isValid=true;}catch(e){this._isValid=false;this.trigger_up('set_dirty',{dataPointID:this.dataPointID});return Promise.reject({message:"Value set is not valid"});}
if(!(options&&options.forceChange)&&this._isSameValue(value)){return Promise.resolve();}
var self=this;return new Promise(function(resolve,reject){var changes={};changes[self.name]=value;self.trigger_up('field_changed',{dataPointID:self.dataPointID,changes:changes,viewType:self.viewType,doNotSetDirty:options&&options.doNotSetDirty,notifyChange:!options||options.notifyChange!==false,allowWarning:options&&options.allowWarning,onSuccess:resolve,onFailure:reject,});});},_onClick:function(ev){if(!this.hasReadonlyModifier&&this._canQuickEdit&&this.mode==='readonly'&&!this.quickEditExclusion.some(x=>ev.target.closest(x))){this.trigger_up('quick_edit',{fieldName:this.name,target:this.el,extraInfo:this._getQuickEditExtraInfo(ev),});}},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.TAB:var event=this.trigger_up('navigation_move',{direction:ev.shiftKey?'previous':'next',});if(event.is_stopped()){ev.preventDefault();ev.stopPropagation();}
break;case $.ui.keyCode.ENTER:ev.preventDefault();ev.stopPropagation();this.trigger_up('navigation_move',{direction:'next_line'});break;case $.ui.keyCode.ESCAPE:this.trigger_up('navigation_move',{direction:'cancel',originalEvent:ev});break;case $.ui.keyCode.UP:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'up'});break;case $.ui.keyCode.RIGHT:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'right'});break;case $.ui.keyCode.DOWN:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'down'});break;case $.ui.keyCode.LEFT:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'left'});break;}},_onNavigationMove:function(ev){ev.data.target=this;},});return AbstractField;});;

/* /web/static/src/legacy/js/fields/abstract_field_owl.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractFieldOwl',function(require){"use strict";const field_utils=require('web.field_utils');const{useListener}=require('web.custom_hooks');const{useEffect}=require("@web/core/utils/hooks");class AbstractField extends owl.Component{constructor(){super(...arguments);this._canQuickEdit=this.constructor.isQuickEditable;this._isValid=true;this._lastSetValue=undefined;useListener('click',this._onClick);useListener('keydown',this._onKeydown);useListener('navigation-move',this._onNavigationMove);useEffect(()=>this._applyDecorations());}
__patch(){const res=super.__patch(...arguments);this.el.setAttribute('name',this.name);this.el.classList.add('o_field_widget');this.el.classList.toggle('o_quick_editable',this._canQuickEdit);return res;}
async willUpdateProps(nextProps){this._lastSetValue=undefined;return super.willUpdateProps(nextProps);}
get additionalContext(){return this.options.additionalContext||{};}
get attrs(){const fieldsInfo=this.record.fieldsInfo[this.viewType];return this.options.attrs||(fieldsInfo&&fieldsInfo[this.name])||{};}
get dataPointId(){return this.record.id;}
get field(){return this.record.fields[this.name];}
get focusableElement(){return null;}
get formatOptions(){return{};}
get formatType(){return this.attrs.widget in field_utils.format?this.attrs.widget:this.field.type;}
get hasReadonlyModifier(){return this.options.hasReadonlyModifier||false;}
get isEmpty(){return!this.isSet;}
get isFocusable(){const focusable=this.focusableElement;return focusable&&!!(focusable.offsetWidth||focusable.offsetHeight||focusable.getClientRects().length);}
get isSet(){return!!this.value;}
get isValid(){return this._isValid;}
get mode(){return this.options.mode||"readonly";}
get model(){return this.record.model;}
get name(){return this.props.fieldName;}
get nodeOptions(){return this.attrs.options||{};}
get options(){return this.props.options||{};}
get parseOptions(){return{};}
get record(){return this.props.record;}
get recordData(){return this.record.data;}
get resetOnAnyFieldChange(){return!!this.attrs.decorations;}
get resId(){return this.record.res_id;}
get string(){return this.attrs.string||this.field.string||this.name;}
get value(){return this.record.data[this.name];}
get viewType(){return this.options.viewType||'default';}
activate(options){if(this.isFocusable){const focusable=this.focusableElement;focusable.focus();if(focusable.matches('input[type="text"], textarea')){focusable.selectionStart=focusable.selectionEnd=focusable.value.length;if(options&&!options.noselect){focusable.select();}}
return true;}
return false;}
commitChanges(){}
quickEdit(extraInfo){if(this._canQuickEdit&&this.mode!=='readonly'){this._quickEdit(extraInfo);}}
removeInvalidClass(){this.el.classList.remove('o_field_invalid');this.el.removeAttribute('aria-invalid');}
setIdForLabel(id){if(this.focusableElement){this.focusableElement.setAttribute('id',id);}}
setInvalidClass(){this.el.classList.add('o_field_invalid');this.el.setAttribute('aria-invalid','true');}
_applyDecorations(){for(const dec of this.attrs.decorations||[]){const isToggled=py.PY_isTrue(py.evaluate(dec.expression,this.record.evalContext));const className=this._getClassFromDecoration(dec.name);this.el.classList.toggle(className,isToggled);}}
_quickEdit(extraInfo){this.activate({noAutomaticCreate:true});}
_formatValue(value){const options=Object.assign({},this.nodeOptions,{data:this.recordData},this.formatOptions);return field_utils.format[this.formatType](value,this.field,options);}
_getClassFromDecoration(decoration){return`text-${decoration.split('-')[1]}`;}
_getQuickEditExtraInfo(ev){return{};}
_isLastSetValue(value){return this._lastSetValue===value||(this.value===false&&value==='');}
_isSameValue(value){return this.value===value;}
_parseValue(value){return field_utils.parse[this.formatType](value,this.field,this.parseOptions);}
_setValue(value,options){if(this._isLastSetValue(value)){return Promise.resolve();}
this._lastSetValue=value;try{value=this._parseValue(value);this._isValid=true;}catch(e){this._isValid=false;this.trigger('set-dirty',{dataPointID:this.dataPointId});return Promise.reject({message:"Value set is not valid"});}
if(!(options&&options.forceChange)&&this._isSameValue(value)){return Promise.resolve();}
return new Promise((resolve,reject)=>{const changes={};changes[this.name]=value;this.trigger('field-changed',{dataPointID:this.dataPointId,changes:changes,viewType:this.viewType,doNotSetDirty:options&&options.doNotSetDirty,notifyChange:!options||options.notifyChange!==false,allowWarning:options&&options.allowWarning,onSuccess:resolve,onFailure:reject,});});}
_onClick(ev){if(this._canQuickEdit&&!this.constructor.quickEditExclusion.some(x=>ev.target.closest(x))){this.trigger('quick-edit',{fieldName:this.name,target:this.el,extraInfo:this._getQuickEditExtraInfo(ev),});}}
_onKeydown(ev){switch(ev.which){case $.ui.keyCode.TAB:this.trigger('navigation-move',{direction:ev.shiftKey?'previous':'next',originalEvent:ev,});break;case $.ui.keyCode.ENTER:ev.preventDefault();ev.stopPropagation();this.trigger('navigation-move',{direction:'next_line'});break;case $.ui.keyCode.ESCAPE:this.trigger('navigation-move',{direction:'cancel',originalEvent:ev});break;case $.ui.keyCode.UP:ev.stopPropagation();this.trigger('navigation-move',{direction:'up'});break;case $.ui.keyCode.RIGHT:ev.stopPropagation();this.trigger('navigation-move',{direction:'right'});break;case $.ui.keyCode.DOWN:ev.stopPropagation();this.trigger('navigation-move',{direction:'down'});break;case $.ui.keyCode.LEFT:ev.stopPropagation();this.trigger('navigation-move',{direction:'left'});break;}}
_onNavigationMove(ev){ev.detail.target=this;}}
AbstractField.fieldDependencies={};AbstractField.specialData=false;AbstractField.supportedFieldTypes=[];AbstractField.description="";AbstractField.noLabel=false;AbstractField.label="";AbstractField.isQuickEditable=false;AbstractField.quickEditExclusion=[];return AbstractField;});;

/* /web/static/src/legacy/js/fields/basic_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.basic_fields',function(require){"use strict";var AbstractField=require('web.AbstractField');var config=require('web.config');var core=require('web.core');var datepicker=require('web.datepicker');var deprecatedFields=require('web.basic_fields.deprecated');var dom=require('web.dom');var Domain=require('web.Domain');var DomainSelector=require('web.DomainSelector');var DomainSelectorDialog=require('web.DomainSelectorDialog');var framework=require('web.framework');var py_utils=require('web.py_utils');var session=require('web.session');var utils=require('web.utils');var view_dialogs=require('web.view_dialogs');var field_utils=require('web.field_utils');var time=require('web.time');const{ColorpickerDialog}=require('web.Colorpicker');const{hidePDFJSButtons}=require('@web/legacy/js/libs/pdfjs');let FieldBoolean=deprecatedFields.FieldBoolean;require("web.zoomodoo");var qweb=core.qweb;var _t=core._t;var _lt=core._lt;var TranslatableFieldMixin={_renderTranslateButton:function(){if(_t.database.multi_lang&&this.field.translate){var lang=_t.database.parameters.code.split('_')[0].toUpperCase();return $(`<span class="o_field_translate btn btn-link">${lang}</span>`).on('click',this._onTranslate.bind(this));}
return $();},_onTranslate:function(ev){ev.preventDefault();this.trigger_up('translate',{fieldName:this.name,id:this.dataPointID,isComingFromTranslationAlert:false,});},};var DebouncedField=AbstractField.extend({DEBOUNCE:1000000000,init:function(){this._super.apply(this,arguments);this._isDirty=false;if(this.mode==='edit'){if(this.DEBOUNCE){this._doDebouncedAction=_.debounce(this._doAction,this.DEBOUNCE);}else{this._doDebouncedAction=this._doAction;}
var self=this;var debouncedFunction=this._doDebouncedAction;this._doDebouncedAction=function(){self._isDirty=true;debouncedFunction.apply(self,arguments);};}},commitChanges:function(){if(this._isDirty&&this.mode==='edit'){return this._doAction();}},_doAction:function(){if(!this.isDestroyed()){return this._setValue(this._getValue());}},_getValue:function(){},_onBlur:function(){},});var InputField=DebouncedField.extend({custom_events:_.extend({},DebouncedField.prototype.custom_events,{field_changed:'_onFieldChanged',}),events:_.extend({},DebouncedField.prototype.events,{'input':'_onInput','change':'_onChange','blur':'_onBlur',}),init:function(){this._super.apply(this,arguments);this.nodeOptions.isPassword='password'in this.attrs;if(this.mode==='edit'){this.tagName='input';}
this.isDirty=false;this.lastChangeEvent=undefined;},getFocusableElement:function(){return this.$input||$();},reset:function(record,event){this._reset(record,event);if(!event||event===this.lastChangeEvent){this.isDirty=false;}
if(this.isDirty||(event&&event.target===this&&event.data.changes&&event.data.changes[this.name]===this.value)){if(this.attrs.decorations){this._applyDecorations();}
return Promise.resolve();}else{return this._render();}},_getValue:function(){return this.$input.val();},_notifyChanges(){this.isDirty=!this._isLastSetValue(this.$input.val());this._doDebouncedAction();},_prepareInput:function($input){this.$input=$input||$("<input/>");this.$input.addClass('o_input');var inputAttrs={placeholder:this.attrs.placeholder||""};var inputVal;if(this.nodeOptions.isPassword){inputAttrs=_.extend(inputAttrs,{type:'password',autocomplete:this.attrs.autocomplete||'new-password'});inputVal=this.value||'';}else{inputAttrs=_.extend(inputAttrs,{type:'text',autocomplete:this.attrs.autocomplete||'off'});inputVal=this._formatValue(this.value);}
this.$input.attr(inputAttrs);this.$input.val(inputVal);return this.$input;},_renderEdit:function(){this._prepareInput(this.$el);},_renderReadonly:function(){this.$el.text(this._formatValue(this.value));},_onChange:function(){this._doAction();},_onFieldChanged:function(event){this.lastChangeEvent=event;},_onInput(){this._notifyChanges();},_onNavigationMove:function(ev){this._super.apply(this,arguments);if(this.mode==='edit'&&ev.data.direction!=='cancel'){var input=this.$input[0];var selecting=(input.selectionEnd!==input.selectionStart);if((ev.data.direction==="left"&&(selecting||input.selectionStart!==0))||(ev.data.direction==="right"&&(selecting||input.selectionStart!==input.value.length))){ev.stopPropagation();}
if(ev.data.direction==='next'&&this.attrs.modifiersValue&&this.attrs.modifiersValue.required&&this.viewType!=='list'){if(!this.$input.val()){this.setInvalidClass();ev.stopPropagation();}else{this.removeInvalidClass();}}}},});var NumericField=InputField.extend({tagName:'span',init(){this._super.apply(this,arguments);this.shouldFormat=Boolean(JSON.parse('format'in this.nodeOptions?this.nodeOptions.format:true));},isSet:function(){return this.value===0||this._super.apply(this,arguments);},_evalFormula:function(expr,context){var val=expr.replace(new RegExp(/( )/g),'');var safeEvalString='';for(let v of val.split(new RegExp(/([-+*/()^])/g))){if(!['+','-','*','/','(',')','^'].includes(v)&&v.length){v=field_utils.parse.float(v);}
if(v==='^'){v='**';}
safeEvalString+=v;};return py_utils.py_eval(safeEvalString,context);},_formatValue:function(value){if(!this.shouldFormat||(this.mode==='edit'&&this.nodeOptions.type==='number')){return value;}
return this._super.apply(this,arguments);},_parseValue:function(value){if(this.mode==='edit'&&this.nodeOptions.type==='number'){return Number(value);}
return this._super.apply(this,arguments);},_prepareInput:function($input){var result=this._super.apply(this,arguments);if(this.nodeOptions.type==='number'){this.$input.attr({type:'number'});}
if(this.nodeOptions.step){this.$input.attr({step:this.nodeOptions.step});}
return result;},_setValue:function(value,options){var originalValue=value;value=value.trim();if(value.startsWith('=')){try{value=this._evalFormula(value.substr(1));value=this._formatValue(value);this.$input.val(value);}catch(err){value=originalValue;}}
return this._super(value,options);},_onKeydown(ev){const kbdEvt=ev.originalEvent;if(kbdEvt&&utils.isNumpadDecimalSeparatorKey(kbdEvt)){const inputField=this.$input[0];const curVal=inputField.value;const from=inputField.selectionStart;const to=inputField.selectionEnd;const point=_t.database.parameters.decimal_point;inputField.value=curVal.slice(0,from)+point+curVal.slice(to);inputField.selectionStart=inputField.selectionEnd=from+point.length;this._notifyChanges();kbdEvt.preventDefault();return;}
return this._super(...arguments);},});var FieldChar=InputField.extend(TranslatableFieldMixin,{description:_lt("Text"),className:'o_field_char',tagName:'span',supportedFieldTypes:['char'],isQuickEditable:true,_renderEdit:function(){var def=this._super.apply(this,arguments);if(this.field.size&&this.field.size>0){this.$el.attr('maxlength',this.field.size);}
if(this.field.translate){this.$el=this.$el.add(this._renderTranslateButton());this.$el.addClass('o_field_translate');}
return def;},_setValue:function(value,options){if(this.field.trim){value=value.trim();}
return this._super(value,options);},});var LinkButton=AbstractField.extend({events:_.extend({},AbstractField.prototype.events,{'click':'_onClick'}),_render:function(){if(this.value){var className=this.attrs.icon||'fa-globe';this.$el.html("<span role='img'/>");this.$el.addClass("fa "+className);this.$el.attr('title',this.value);this.$el.attr('aria-label',this.value);}},_onClick:function(event){event.stopPropagation();window.open(this.value,'_blank');},});var FieldDateRange=InputField.extend({className:'o_field_date_range',tagName:'span',jsLibs:['/web/static/lib/daterangepicker/daterangepicker.js','/web/static/src/legacy/js/libs/daterangepicker.js',],supportedFieldTypes:['date','datetime'],isQuickEditable:true,init:function(){this._super.apply(this,arguments);this.isDateField=this.formatType==='date';this.dateRangePickerOptions=_.defaults({},this.nodeOptions.picker_options||{},{timePicker:!this.isDateField,timePicker24Hour:_t.database.parameters.time_format.search('%H')!==-1,autoUpdateInput:false,timePickerIncrement:5,locale:{applyLabel:_t('Apply'),cancelLabel:_t('Cancel'),format:this.isDateField?time.getLangDateFormat():time.getLangDatetimeFormat(),},});this.relatedEndDate=this.nodeOptions.related_end_date;this.relatedStartDate=this.nodeOptions.related_start_date;},destroy:function(){if(this.$pickerContainer){this.$pickerContainer.remove();}
if(this._onScroll){window.removeEventListener('scroll',this._onScroll,true);}
this._super.apply(this,arguments);},isValid:function(){const value=this.mode==="readonly"?this.value:this.$input.val();try{return field_utils.parse[this.formatType](value,this.field,{timezone:true})||true;}catch(error){return false;}},_getValue:function(){try{this.removeInvalidClass();return field_utils.parse[this.formatType](this.$input.val(),this.field,{timezone:true});}catch(error){this.setInvalidClass();return false;}},_applyChanges:function(ev,picker){var changes={};var displayStartDate=field_utils.format[this.formatType](picker.startDate,{},{timezone:false});var displayEndDate=field_utils.format[this.formatType](picker.endDate,{},{timezone:false});var changedStartDate=picker.startDate;var changedEndDate=picker.endDate;if(this.isDateField){changedStartDate=picker.startDate.add(session.getTZOffset(picker.startDate),'minutes');changedEndDate=picker.endDate.startOf('day').add(session.getTZOffset(picker.endDate),'minutes');}
if(this.relatedEndDate){this.$el.val(displayStartDate);changes[this.name]=this._parseValue(changedStartDate);changes[this.relatedEndDate]=this._parseValue(changedEndDate);}
if(this.relatedStartDate){this.$el.val(displayEndDate);changes[this.name]=this._parseValue(changedEndDate);changes[this.relatedStartDate]=this._parseValue(changedStartDate);}
this.trigger_up('field_changed',{dataPointID:this.dataPointID,viewType:this.viewType,changes:changes,});},_renderEdit:function(){this._super.apply(this,arguments);var self=this;var startDate;var endDate;if(this.relatedEndDate){startDate=this._formatValue(this.value);endDate=this._formatValue(this.recordData[this.relatedEndDate]);}
if(this.relatedStartDate){startDate=this._formatValue(this.recordData[this.relatedStartDate]);endDate=this._formatValue(this.value);}
this.dateRangePickerOptions.startDate=startDate||moment();this.dateRangePickerOptions.endDate=endDate||moment();this.$el.daterangepicker(this.dateRangePickerOptions);this.$el.on('apply.daterangepicker',this._applyChanges.bind(this));this.$el.on('show.daterangepicker',this._onDateRangePickerShow.bind(this));this.$el.on('hide.daterangepicker',this._onDateRangePickerHide.bind(this));this.$el.off('keyup.daterangepicker');this.$pickerContainer=this.$el.data('daterangepicker').container;this.$pickerContainer.on('click',function(ev){ev.stopPropagation();if($(ev.target).hasClass('applyBtn')){self.$el.data('daterangepicker').hide();}});this.$pickerContainer.on('focusin.bs.modal','select',function(ev){ev.stopPropagation();});},_quickEdit:function(){if(this.$el){this.$el.click()}},_onDateRangePickerHide(){if(this._onScroll){window.removeEventListener('scroll',this._onScroll,true);}},_onDateRangePickerShow(){this._onScroll=ev=>{if(!config.device.isMobile&&!this.$pickerContainer.get(0).contains(ev.target)){this.$el.data('daterangepicker').hide();}};window.addEventListener('scroll',this._onScroll,true);},});var FieldDate=InputField.extend({description:_lt("Date"),className:"o_field_date",tagName:"span",supportedFieldTypes:['date','datetime'],isQuickEditable:true,events:AbstractField.prototype.events,init:function(){this._super.apply(this,arguments);this.formatOptions.timezone=true;this.datepickerOptions=_.defaults({},this.nodeOptions.datepicker||{},{defaultDate:this.value});},start:function(){var self=this;var prom;if(this.mode==='edit'){this.datewidget=this._makeDatePicker();this.datewidget.on('datetime_changed',this,function(){var value=this._getValue();if((!value&&this.value)||(value&&!this._isSameValue(value))){this._setValue(value);}});prom=this.datewidget.appendTo('<div>').then(function(){self.datewidget.$el.addClass(self.$el.attr('class'));self._prepareInput(self.datewidget.$input);self._replaceElement(self.datewidget.$el);});}
return Promise.resolve(prom).then(this._super.bind(this));},activate:function(){if(this.isFocusable()&&this.datewidget){this.datewidget.$input.focus();this.datewidget.$input.select();return true;}
return false;},_doDebouncedAction:function(){this.datewidget.changeDatetime();},_quickEdit:function(){if(this.datewidget){this.datewidget.$input.click();}},_getValue:function(){return this.datewidget.getValue();},_isSameValue:function(value){if(this.value===false||value===false){return this.value===value;}
return value.isSame(this.value,'day');},_makeDatePicker:function(){return new datepicker.DateWidget(this,this.datepickerOptions);},_renderEdit:function(){this.datewidget.setValue(this.value);this.$input=this.datewidget.$input;},async _onKeydown(ev){this._super(...arguments);if(ev.which===$.ui.keyCode.ENTER){await this._setValue(this.$input.val());this._render();}},});var FieldDateTime=FieldDate.extend({description:_lt("Date & Time"),supportedFieldTypes:['datetime'],isQuickEditable:true,init:function(){this._super.apply(this,arguments);if(this.value){var offset=this.getSession().getTZOffset(this.value);var displayedValue=this.value.clone().add(offset,'minutes');this.datepickerOptions.defaultDate=displayedValue;}},_getValue:function(){var value=this.datewidget.getValue();return value&&value.add(-this.getSession().getTZOffset(value),'minutes');},_isSameValue:function(value){if(this.value===false||value===false){return this.value===value;}
return value.isSame(this.value);},_makeDatePicker:function(){return new datepicker.DateTimeWidget(this,this.datepickerOptions);},_renderEdit:function(){var value=this.value&&this.value.clone().add(this.getSession().getTZOffset(this.value),'minutes');this.datewidget.setValue(value);this.$input=this.datewidget.$input;},});const RemainingDays=AbstractField.extend({description:_lt("Remaining Days"),supportedFieldTypes:['date','datetime'],init(){this._super(...arguments);this.formatOptions.timezone=true;},getFocusableElement(){return this.datewidget&&this.datewidget.$input||$();},_getValue(){let value=this.datewidget.getValue();if(this.field.type==="datetime"){value=value&&value.add(-this.getSession().getTZOffset(value),'minutes');}
return value;},_makeDatePicker(){this.datepickerOptions=_.defaults({},{defaultDate:this.value});if(this.field.type==="datetime"&&this.value){const offset=this.getSession().getTZOffset(this.value);const displayedValue=this.value.clone().add(offset,'minutes');this.datepickerOptions.defaultDate=displayedValue;}
if(this.field.type==="date"){return new datepicker.DateWidget(this,this.datepickerOptions);}
return new datepicker.DateTimeWidget(this,this.datepickerOptions);},async _renderEdit(){await this._super(...arguments);if(this.datewidget){this.datewidget.destroy();}
this.datewidget=this._makeDatePicker();this.datewidget.on('datetime_changed',this,()=>{const value=this._getValue();if((!value&&this.value)||(value&&!this._isSameValue(value))){this._setValue(value);}});await this.datewidget.appendTo('<div>');this.$el.append(this.datewidget.$el);},_renderReadonly(){if(this.value===false){this.$el.removeClass('font-weight-bold text-danger text-warning');return;}
const nowUTC=moment().utc();const nowUserTZ=nowUTC.clone().add(session.getTZOffset(nowUTC),'minutes');const fieldValue=this.field.type=="datetime"?this.value.clone().add(session.getTZOffset(this.value),'minutes'):this.value;const diffDays=fieldValue.startOf('day').diff(nowUserTZ.startOf('day'),'days');let text;if(Math.abs(diffDays)>99){text=this._formatValue(this.value,'date');}else if(diffDays===0){text=_t("Today");}else if(diffDays<0){text=diffDays===-1?_t("Yesterday"):_.str.sprintf(_t('%s days ago'),-diffDays);}else{text=diffDays===1?_t("Tomorrow"):_.str.sprintf(_t('In %s days'),diffDays);}
this.$el.text(text).attr('title',this._formatValue(this.value,'date'));this.$el.toggleClass('font-weight-bold',diffDays<=0);this.$el.toggleClass('text-danger',diffDays<0);this.$el.toggleClass('text-warning',diffDays===0);},});var FieldMonetary=NumericField.extend({description:_lt("Monetary"),className:'o_field_monetary o_field_number',tagName:'span',supportedFieldTypes:['float','monetary'],resetOnAnyFieldChange:true,isQuickEditable:true,init:function(){this._super.apply(this,arguments);this._setCurrency();if(this.mode==='edit'){this.tagName='div';this.className+=' o_input';this.formatOptions.noSymbol=true;}
this.formatOptions.currency=this.currency;this.formatOptions.digits=[16,2];this.formatOptions.field_digits=this.nodeOptions.field_digits;},isSet:function(){return this.value===0||this._super.apply(this,arguments);},_renderEdit:function(){this.$el.empty();var def=this._prepareInput(this.$input).appendTo(this.$el);if(this.currency){var $currencySymbol=$('<span>',{text:this.currency.symbol});if(this.currency.position==="after"){this.$el.append($currencySymbol);}else{this.$el.prepend($currencySymbol);}}
return def;},_renderReadonly:function(){this.$el.html(this._formatValue(this.value));},_reset:function(){this._super.apply(this,arguments);this._setCurrency();},_setCurrency:function(){var currencyField=this.nodeOptions.currency_field||this.field.currency_field||'currency_id';var currencyID=this.record.data[currencyField]&&this.record.data[currencyField].res_id;this.currency=session.get_currency(currencyID);this.formatOptions.currency=this.currency;},});var FieldInteger=NumericField.extend({description:_lt("Integer"),className:'o_field_integer o_field_number',supportedFieldTypes:['integer'],isQuickEditable:true,_formatValue:function(value){if(typeof value==='string'){if(!/^[0-9]+-/.test(value)){throw new Error('"'+value+'" is not an integer or a virtual id');}
return value;}
return this._super.apply(this,arguments);},});var FieldFloat=NumericField.extend({description:_lt("Decimal"),className:'o_field_float o_field_number',supportedFieldTypes:['float'],isQuickEditable:true,init:function(){this._super.apply(this,arguments);if(this.attrs.digits){this.nodeOptions.digits=JSON.parse(this.attrs.digits);}},});var FieldFloatTime=FieldFloat.extend({description:_lt("Time"),formatType:'float_time',isQuickEditable:true,init:function(){this._super.apply(this,arguments);this.formatType='float_time';},async reset(){await this._super(...arguments);if(!this.isDirty){await this._render();}},});var FieldFloatFactor=FieldFloat.extend({supportedFieldTypes:['float'],className:'o_field_float_factor',formatType:'float_factor',isQuickEditable:true,init:function(){this._super.apply(this,arguments);if(!this.nodeOptions.factor){this.nodeOptions.factor=1;}
this.parseOptions=this.nodeOptions;}});var FieldFloatToggle=AbstractField.extend({supportedFieldTypes:['float'],formatType:'float_factor',className:'o_field_float_toggle',tagName:'span',events:{click:'_onClick'},init:function(){this._super.apply(this,arguments);this.formatType='float_factor';if(this.mode==='edit'||this.nodeOptions.force_button){this.tagName='button';}
if(this.attrs.digits){this.nodeOptions.digits=JSON.parse(this.attrs.digits);}
if(!this.nodeOptions.factor){this.nodeOptions.factor=1;}
if(!this.nodeOptions.range){this.nodeOptions.range=[0.0,0.5,1.0];}
this.parseOptions=this.nodeOptions;},_getDisplayedValue:function(){var usrFormatValue=this._formatValue(this.value);return field_utils.parse['float'](usrFormatValue);},_renderEdit:function(){this.$el.text(this._formatValue(this.value));},_renderReadonly:function(){this.$el.text(this._formatValue(this.value));},_nextValue:function(){var range=this.nodeOptions.range;var val=utils.closestNumber(this._getDisplayedValue(),range);var index=_.indexOf(range,val);if(index!==-1){if(index+1<range.length){return range[index+1];}}
return range[0];},_onClick:function(ev){if(this.mode==='edit'||this.nodeOptions.force_button){ev.stopPropagation();var next_val=this._nextValue();next_val=field_utils.format['float'](next_val);this._setValue(next_val);}},isSet:function(){return this.value===0||this._super(...arguments);},});var FieldPercentage=FieldFloat.extend({className:'o_field_float_percentage o_field_number',description:_lt("Percentage"),init(){this._super(...arguments);if(this.mode==='edit'){this.tagName='div';this.className+=' o_input';this.formatOptions.noSymbol=true;}},_renderEdit(){this.$el.empty();this._prepareInput(this.$input).appendTo(this.$el);const $percentageSymbol=$('<span>',{text:'%'});this.$el.append($percentageSymbol);},});var FieldText=InputField.extend(TranslatableFieldMixin,{description:_lt("Multiline Text"),className:'o_field_text',supportedFieldTypes:['text','html'],tagName:'span',isQuickEditable:true,init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.tagName='textarea';}
this.autoResizeOptions={parent:this};},start:function(){if(this.mode==='edit'){dom.autoresize(this.$el,this.autoResizeOptions);if(this.field.translate){this.$el=this.$el.add(this._renderTranslateButton());this.$el.addClass('o_field_translate');}}
return this._super();},reset:function(){var self=this;return Promise.resolve(this._super.apply(this,arguments)).then(function(){if(self.mode==='edit'){self.$input.trigger('change');}});},_quickEdit:function(){this.activate({noselect:true,noAutomaticCreate:true});},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ENTER){ev.stopPropagation();return;}
this._super.apply(this,arguments);},});var ListFieldText=FieldText.extend({init:function(){this._super.apply(this,arguments);this.autoResizeOptions.min_height=0;},});var HandleWidget=AbstractField.extend({description:_lt("Handle"),noLabel:true,className:'o_row_handle fa fa-sort ui-sortable-handle',widthInList:'33px',tagName:'span',supportedFieldTypes:['integer'],isSet:function(){return true;},});var FieldEmail=InputField.extend({description:_lt("Email"),className:'o_field_email',events:_.extend({},InputField.prototype.events,{'click':'_onClick',}),prefix:'mailto',supportedFieldTypes:['char'],isQuickEditable:true,init:function(){this._super.apply(this,arguments);this.tagName=this.mode==='readonly'?'div':'input';},getFocusableElement:function(){return this.mode==='readonly'?this.$el.find('a'):this._super.apply(this,arguments);},_renderReadonly:function(){if(this.value){this.el.innerHTML='';this.el.classList.add("o_form_uri","o_text_overflow");const anchorEl=Object.assign(document.createElement('a'),{text:this.value,href:`${this.prefix}:${this.value}`,});this.el.appendChild(anchorEl);}},_setValue:function(value,options){if(this.field.trim){value=value.trim();}
return this._super(value,options);},_onClick:function(ev){ev.stopPropagation();},});var FieldPhone=FieldEmail.extend({description:_lt("Phone"),className:'o_field_phone',prefix:'tel',_renderReadonly:function(){this._super();this.$el.removeClass('o_text_overflow');},});var UrlWidget=InputField.extend({description:_lt("URL"),className:'o_field_url',events:_.extend({},InputField.prototype.events,{'click':'_onClick',}),supportedFieldTypes:['char'],isQuickEditable:true,init:function(){this._super.apply(this,arguments);this.tagName=this.mode==='readonly'?'div':'input';this.websitePath=this.nodeOptions.website_path||false;},getFocusableElement:function(){return this.mode==='readonly'?this.$el.find('a'):this._super.apply(this,arguments);},_renderReadonly:function(){if(!this.value){return;}
let href=this.value;if(this.value&&!this.websitePath){const regex=/^((ftp|http)s?:\/)?\//i;href=!regex.test(this.value)?`http://${href}`:href;}
this.el.classList.add("o_form_uri","o_text_overflow");const anchorEl=Object.assign(document.createElement('a'),{text:this.attrs.text||this.value,href:href,target:'_blank',});this.el.textContent='';this.el.appendChild(anchorEl);},_onClick:function(ev){ev.stopPropagation();},});var CopyClipboard={quickEditExclusion:['.o_clipboard_button',],destroy:function(){this._super.apply(this,arguments);if(this.clipboard){this.clipboard.destroy();}},_initClipboard:function(){var self=this;var $clipboardBtn=this.$('.o_clipboard_button');$clipboardBtn.tooltip({title:_t('Copied !'),trigger:'manual',placement:'right'});this.clipboard=new ClipboardJS($clipboardBtn[0],{text:function(){return self.value.trim();},container:self.$el[0]});this.clipboard.on('success',function(){_.defer(function(){$clipboardBtn.tooltip('show');_.delay(function(){$clipboardBtn.tooltip('hide');},800);});});},_renderReadonly:function(){this._super.apply(this,arguments);if(this.value){this.$el.append($(qweb.render(this.clipboardTemplate)));this._initClipboard();}}};var TextCopyClipboard=FieldText.extend(CopyClipboard,{description:_lt("Copy to Clipboard"),clipboardTemplate:'CopyClipboardText',className:"o_field_copy",});var CharCopyClipboard=FieldChar.extend(CopyClipboard,{description:_lt("Copy to Clipboard"),clipboardTemplate:'CopyClipboardChar',className:'o_field_copy o_text_overflow',});var URLCopyClipboard=FieldChar.extend(CopyClipboard,{description:_lt("Copy to Clipboard"),clipboardTemplate:'CopyClipboardChar',className:'o_field_copy o_text_overflow o_field_copy_url',events:_.extend({},FieldChar.prototype.events,{'click':'_onClick',}),_onClick:function(ev){if(ev.target.className.includes('o_field_copy_url')){ev.stopPropagation();window.open(this.value,'_blank');}}});var AbstractFieldBinary=AbstractField.extend({events:_.extend({},AbstractField.prototype.events,{'change .o_input_file':'on_file_change','click .o_select_file_button':function(){this.$('.o_input_file').click();},'click .o_clear_file_button':'_onClearClick',}),init:function(parent,name,record){this._super.apply(this,arguments);this.fields=record.fields;this.useFileAPI=!!window.FileReader;this.max_upload_size=session.max_file_upload_size||128*1024*1024;this.accepted_file_extensions=(this.nodeOptions&&this.nodeOptions.accepted_file_extensions)||this.accepted_file_extensions||'*';if(!this.useFileAPI){var self=this;this.fileupload_id=_.uniqueId('o_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.on_file_uploaded.apply(self,args);});}},destroy:function(){if(this.fileupload_id){$(window).off(this.fileupload_id);}
this._super.apply(this,arguments);},on_file_change:function(e){var self=this;var file_node=e.target;if((this.useFileAPI&&file_node.files.length)||(!this.useFileAPI&&$(file_node).val()!=='')){if(this.useFileAPI){var file=file_node.files[0];if(file.size>this.max_upload_size){var msg=_t("The selected file exceed the maximum file size of %s.");this.displayNotification({title:_t("File upload"),message:_.str.sprintf(msg,utils.human_size(this.max_upload_size)),type:'danger'});return false;}
utils.getDataURLFromFile(file).then(function(data){data=data.split(',')[1];self.on_file_uploaded(file.size,file.name,file.type,data);});}else{this.$('form.o_form_binary_form').submit();}
this.$('.o_form_binary_progress').show();this.$('button').hide();}},on_file_uploaded:function(size,name){if(size===false){this.displayNotification({message:_t("There was a problem while uploading your file"),type:'danger'});console.warn("Error while uploading file : ",name);}else{this.on_file_uploaded_and_valid.apply(this,arguments);}
this.$('.o_form_binary_progress').hide();this.$('button').show();},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){this.set_filename(name);this._setValue(file_base64);this._render();},set_filename:function(value){var filename=this.attrs.filename;if(filename&&filename in this.fields){var changes={};changes[filename]=value;this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:changes,viewType:this.viewType,});}},_clearFile:function(){var self=this;this.$('.o_input_file').val('');this.set_filename('');if(!this.isDestroyed()){this._setValue(false).then(function(){self._render();});}},_onClearClick:function(ev){this._clearFile();},});var FieldBinaryImage=AbstractFieldBinary.extend({description:_lt("Image"),fieldDependencies:_.extend({},AbstractFieldBinary.prototype.fieldDependencies,{__last_update:{type:'datetime'},}),template:'FieldBinaryImage',placeholder:"/web/static/img/placeholder.png",events:_.extend({},AbstractFieldBinary.prototype.events,{'click img':function(){if(this.mode==="readonly"){this.trigger_up('bounce_edit');}},}),supportedFieldTypes:['binary'],file_type_magic_word:{'/':'jpg','R':'gif','i':'png','P':'svg+xml',},accepted_file_extensions:'image/*',_getImageUrl:function(model,res_id,field,unique){return session.url('/web/image',{model:model,id:JSON.stringify(res_id),field:field,unique:field_utils.format.datetime(unique).replace(/[^0-9]/g,''),});},_render:function(){var self=this;var url=this.placeholder;if(this.value){if(!utils.is_bin_size(this.value)){url='data:image/'+(this.file_type_magic_word[this.value[0]]||'png')+';base64,'+this.value;}else{var field=this.nodeOptions.preview_image||this.name;var unique=this.recordData.__last_update;url=this._getImageUrl(this.model,this.res_id,field,unique);}}
var $img=$(qweb.render("FieldBinaryImage-img",{widget:this,url:url}));var width=this.nodeOptions.size?this.nodeOptions.size[0]:this.attrs.width;var height=this.nodeOptions.size?this.nodeOptions.size[1]:this.attrs.height;if(width){$img.attr('width',width);$img.css('max-width',width+'px');}
if(height){$img.attr('height',height);$img.css('max-height',height+'px');}
this.$('> img').remove();this.$el.prepend($img);$img.one('error',function(){$img.attr('src',self.placeholder);self.displayNotification({message:_t("Could not display the selected image"),type:'danger'});});return this._super.apply(this,arguments);},_renderReadonly:function(){this._super.apply(this,arguments);var unique=this.recordData.__last_update;var url=this._getImageUrl(this.model,this.res_id,'image_1920',unique);var $img;var imageField=_.find(Object.keys(this.recordData),function(o){return o.startsWith('image_');});if(this.nodeOptions.background)
{if('tag'in this.nodeOptions){this.tagName=this.nodeOptions.tag;}
if('class'in this.attrs){this.$el.addClass(this.attrs.class);}
var urlThumb=this._getImageUrl(this.model,this.res_id,this.name,unique);this.$el.empty();$img=this.$el;$img.css('backgroundImage','url('+urlThumb+')');}else{$img=this.$('img');}
if(this.nodeOptions.zoom){var zoomDelay=0;if(this.nodeOptions.zoom_delay){zoomDelay=this.nodeOptions.zoom_delay;}
if(this.recordData[imageField]){$img.attr('data-zoom',1);$img.attr('data-zoom-image',url);$img.zoomOdoo({event:'mouseenter',timer:zoomDelay,attach:'.o_content',attachToTarget:true,disabledOnMobile:false,onShow:function(){var zoomHeight=Math.ceil(this.$zoom.height());var zoomWidth=Math.ceil(this.$zoom.width());if(zoomHeight<128&&zoomWidth<128){this.hide();}
core.bus.on('keydown',this,this.hide);core.bus.on('click',this,this.hide);},beforeAttach:function(){this.$flyout.css({width:'512px',height:'512px'});},preventClicks:this.nodeOptions.preventClicks,});}}},});var CharImageUrl=AbstractField.extend({className:'o_field_image',description:_lt("Image"),supportedFieldTypes:['char'],placeholder:"/web/static/img/placeholder.png",_renderReadonly:function(){var self=this;const url=this.value;if(url){var $img=$(qweb.render("FieldBinaryImage-img",{widget:this,url:url}));const width=this.nodeOptions.size?this.nodeOptions.size[0]:this.attrs.width;const height=this.nodeOptions.size?this.nodeOptions.size[1]:this.attrs.height;if(width){$img.attr('width',width);$img.css('max-width',width+'px');}
if(height){$img.attr('height',height);$img.css('max-height',height+'px');}
this.$('> img').remove();this.$el.prepend($img);$img.one('error',function(){$img.attr('src',self.placeholder);self.displayNotification({type:'info',message:_t("Could not display the specified image url."),});});}
return this._super.apply(this,arguments);},});var KanbanFieldBinaryImage=FieldBinaryImage.extend({events:{},});var KanbanCharImageUrl=CharImageUrl.extend({events:{},});var FieldBinaryFile=AbstractFieldBinary.extend({description:_lt("File"),template:'FieldBinaryFile',events:_.extend({},AbstractFieldBinary.prototype.events,{'click':function(event){if(this.mode==='readonly'&&this.value&&this.recordData.id){this.on_save_as(event);}},'click .o_input':function(){this.$('.o_input_file').click();},}),supportedFieldTypes:['binary'],init:function(){this._super.apply(this,arguments);this.filename_value=this.recordData[this.attrs.filename];},_renderReadonly:function(){var visible=!!(this.value&&this.res_id);this.$el.empty().css('cursor','not-allowed');this.do_toggle(visible);if(visible){this.$el.css('cursor','pointer').text(this.filename_value||'').prepend($('<span class="fa fa-download"/>'),' ');}},_renderEdit:function(){if(this.value){this.$el.children().removeClass('o_hidden');this.$('.o_select_file_button').first().addClass('o_hidden');this.$('.o_input').eq(0).val(this.filename_value||this.value);}else{this.$el.children().addClass('o_hidden');this.$('.o_select_file_button').first().removeClass('o_hidden');}},set_filename:function(value){this._super.apply(this,arguments);this.filename_value=value;this.$('.o_save_file_button').prop('disabled',true);},on_save_as:function(ev){if(!this.value){this.displayNotification({message:_t("The field is empty, there's nothing to save."),type:'danger'});ev.stopPropagation();}else if(this.res_id){framework.blockUI();var filename_fieldname=this.attrs.filename;this.getSession().get_file({complete:framework.unblockUI,data:{'model':this.model,'id':this.res_id,'field':this.name,'filename_field':filename_fieldname,'filename':this.recordData[filename_fieldname]||"",'download':true,'data':utils.is_bin_size(this.value)?null:this.value,},error:(error)=>this.call('crash_manager','rpc_error',error),url:'/web/content',});ev.stopPropagation();}},});var FieldPdfViewer=FieldBinaryFile.extend({description:_lt("PDF Viewer"),supportedFieldTypes:['binary'],template:'FieldPdfViewer',accepted_file_extensions:'application/pdf',init:function(){this._super.apply(this,arguments);this.PDFViewerApplication=false;},_getURI:function(fileURI){var page=this.recordData[this.name+'_page']||1;if(!fileURI){var queryObj={model:this.model,field:this.name,id:this.res_id,};var queryString=$.param(queryObj);fileURI='/web/content?'+queryString;}
fileURI=encodeURIComponent(fileURI);var viewerURL='/web/static/lib/pdfjs/web/viewer.html?file=';return viewerURL+fileURI+'#page='+page;},_render:function(){var self=this;var $pdfViewer=this.$('.o_form_pdf_controls').children().add(this.$('.o_pdfview_iframe'));var $selectUpload=this.$('.o_select_file_button').first();var $iFrame=this.$('.o_pdfview_iframe');$iFrame.on('load',function(){self.PDFViewerApplication=this.contentWindow.window.PDFViewerApplication;});if(this.mode==="readonly"&&this.value){$iFrame.attr('src',this._getURI());}else{if(this.value){var binSize=utils.is_bin_size(this.value);$pdfViewer.removeClass('o_hidden');$selectUpload.addClass('o_hidden');if(binSize){$iFrame.attr('src',this._getURI());}}else{$pdfViewer.addClass('o_hidden');$selectUpload.removeClass('o_hidden');}}
hidePDFJSButtons($iFrame[0]);},on_file_change:function(ev){this._super.apply(this,arguments);var files=ev.target.files;if(!files||files.length===0){return;}
var fileURI=URL.createObjectURL(files[0]);if(this.PDFViewerApplication){this.PDFViewerApplication.open(fileURI,0);}else{this.$('.o_pdfview_iframe').attr('src',this._getURI(fileURI));}},on_save_as:function(ev){ev.stopPropagation();},});var PriorityWidget=AbstractField.extend({description:_lt("Priority"),className:"o_priority",attributes:{'role':'radiogroup',},events:{'mouseover > a':'_onMouseOver','mouseout > a':'_onMouseOut','click > a':'_onPriorityClick','keydown > a':'_onKeydown',},supportedFieldTypes:['selection'],isSet:function(){return true;},getFocusableElement:function(){var checked=this.$("[aria-checked='true']");return checked.length?checked:this.$("[data-index='1']");},on_attach_callback(){const self=this;if(self.viewType==="form"){let provide=()=>{return self.field.selection.map((value)=>({name:value[1],action:()=>{this._setValue(value[0]);}}))}
let getCommandDefinition=(env)=>({name:env._t("Set priority..."),options:{activeElement:env.services.ui.getActiveElementOf(self.el),category:"smart_action",hotkey:"alt+r",},action(){return env.services.command.openPalette({placeholder:env._t("Set a priority..."),providers:[{provide}],})},});core.bus.trigger("set_legacy_command","web.PriorityWidget.setPriority",getCommandDefinition);}},on_detach_callback(){core.bus.trigger("remove_legacy_command","web.PriorityWidget.setPriority");},_render:function(){var self=this;var index_value=this.value?_.findIndex(this.field.selection,function(v){return v[0]===self.value;}):0;this.$el.empty();this.empty_value=this.field.selection[0][0];this.$el.attr('aria-label',this.string);const isReadonly=this.record.evalModifiers(this.attrs.modifiers).readonly;_.each(this.field.selection.slice(1),function(choice,index){const tag=isReadonly?'<span>':'<a href="#">';self.$el.append(self._renderStar(tag,index_value>=index+1,index+1,choice[1],index_value));});},_renderStar:function(tag,isFull,index,tip,indexValue){var isChecked=indexValue===index;var defaultFocus=indexValue===0&&index===1;return $(tag).attr('role','radio').attr('aria-checked',isChecked).attr('title',tip).attr('aria-label',tip).attr('tabindex',isChecked||defaultFocus?0:-1).attr('data-index',index).addClass('o_priority_star fa').toggleClass('fa-star',isFull).toggleClass('fa-star-o',!isFull);},_onPriorityClick:function(event){event.preventDefault();event.stopPropagation();var index=$(event.currentTarget).data('index');var newValue=this.field.selection[index][0];if(newValue===this.value){newValue=this.empty_value;}
this._setValue(newValue);},_onMouseOut:function(){clearTimeout(this.hoverTimer);var self=this;this.hoverTimer=setTimeout(function(){self._render();},200);},_onMouseOver:function(event){clearTimeout(this.hoverTimer);this.$('.o_priority_star').removeClass('fa-star-o').addClass('fa-star');$(event.currentTarget).nextAll().removeClass('fa-star').addClass('fa-star-o');},_onKeydown:function(event){if(event.which===$.ui.keyCode.ENTER){return;}
this._super.apply(this,arguments);},_onNavigationMove:function(ev){var $curControl=this.$('a:focus');var $nextControl;if(ev.data.direction==='right'||ev.data.direction==='down'){$nextControl=$curControl.next('a');}else if(ev.data.direction==='left'||ev.data.direction==='up'){$nextControl=$curControl.prev('a');}
if($nextControl&&$nextControl.length){ev.stopPropagation();$nextControl.focus();return;}
this._super.apply(this,arguments);},});var AttachmentImage=AbstractField.extend({className:'o_attachment_image',events:_.omit(AbstractField.prototype.events,'click'),_render:function(){if(this.value){this.$el.empty().append($('<img>/',{src:"/web/image/"+this.value.data.id+"?unique=1",title:this.value.data.display_name,alt:_t("Image")}));}}});var StateSelectionWidget=AbstractField.extend({template:'FormSelection',events:{'click .dropdown-item':'_setSelection',},supportedFieldTypes:['selection'],getFocusableElement:function(){return this.$("a[data-toggle='dropdown']");},on_attach_callback(){const self=this;if(self.viewType==="form"){let provide=()=>{return self.field.selection.map((value)=>({name:value[1],action:()=>{this._setValue(value[0]);}}))}
let getCommandDefinition=(env)=>({name:env._t("Set kanban state..."),options:{activeElement:env.services.ui.getActiveElementOf(self.el),category:"smart_action",hotkey:"alt+shift+r",},action(){return env.services.command.openPalette({placeholder:env._t("Set a kanban state..."),providers:[{provide}],})},});core.bus.trigger("set_legacy_command","web.StateSelectionWidget.setKanbanState",getCommandDefinition);}},on_detach_callback(){core.bus.trigger("remove_legacy_command","web.StateSelectionWidget.setKanbanState");},_prepareDropdownValues:function(){var self=this;var _data=[];var current_stage_id=self.recordData.stage_id&&self.recordData.stage_id[0];var stage_data={id:current_stage_id,legend_normal:this.recordData.legend_normal||undefined,legend_blocked:this.recordData.legend_blocked||undefined,legend_done:this.recordData.legend_done||undefined,};_.map(this.field.selection||[],function(selection_item){var value={'name':selection_item[0],'tooltip':selection_item[1],};if(selection_item[0]==='normal'){value.state_name=stage_data.legend_normal?stage_data.legend_normal:selection_item[1];}else if(selection_item[0]==='done'){value.state_class='o_status_green';value.state_name=stage_data.legend_done?stage_data.legend_done:selection_item[1];}else{value.state_class='o_status_red';value.state_name=stage_data.legend_blocked?stage_data.legend_blocked:selection_item[1];}
_data.push(value);});return _data;},_render:function(){var states=this._prepareDropdownValues();var currentState=_.findWhere(states,{name:this.value})||states[0];this.$('.o_status').removeClass('o_status_red o_status_green').addClass(currentState.state_class).prop('special_click',true).parent().attr('title',currentState.state_name).attr('aria-label',this.string+": "+currentState.state_name);var $items=$(qweb.render('FormSelection.items',{states:_.without(states,currentState)}));var $dropdown=this.$('.dropdown-menu');$dropdown.children().remove();$items.appendTo($dropdown);var isReadonly=this.record.evalModifiers(this.attrs.modifiers).readonly;this.$('a[data-toggle=dropdown]').toggleClass('disabled',isReadonly||false);},_setSelection:function(ev){ev.preventDefault();if(this.mode!=='edit'){ev.stopPropagation();}
var $item=$(ev.currentTarget);var value=String($item.data('value'));this._setValue(value);if(this.mode==='edit'){this._render();}},});const ListStateSelectionWidget=StateSelectionWidget.extend({_render(){this._super.apply(this,arguments);const hideLabel=utils.toBoolElse(this.nodeOptions.hide_label||'',false);if(!hideLabel){const states=this._prepareDropdownValues();const currentState=states.find(state=>state.name===this.value)||states[0];const statusEL=this.el.querySelector('.o_status_label');if(statusEL){statusEL.innerText=currentState.state_name;}else{const labelEL=Object.assign(document.createElement('span'),{innerText:currentState.state_name,className:'o_status_label align-middle',});this.el.appendChild(labelEL);}}},});var FavoriteWidget=AbstractField.extend({className:'o_favorite',events:{'click':'_setFavorite'},supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){var tip=this.value?_t('Remove from Favorites'):_t('Add to Favorites');var template=this.attrs.nolabel?'<a href="#"><i class="fa %s" title="%s" aria-label="%s" role="img"></i></a>':'<a href="#"><i class="fa %s" role="img" aria-label="%s"></i> %s</a>';this.$el.empty().append(_.str.sprintf(template,this.value?'fa-star':'fa-star-o',tip,tip));},_setFavorite:function(event){event.preventDefault();event.stopPropagation();this._setValue(!this.value);},});var LabelSelection=AbstractField.extend({supportedFieldTypes:['selection'],_render:function(){this.classes=this.nodeOptions&&this.nodeOptions.classes||{};var labelClass=this.classes[this.value]||'primary';this.$el.addClass('badge badge-'+labelClass).text(this._formatValue(this.value));},});var BooleanToggle=FieldBoolean.extend({description:_lt("Toggle"),className:FieldBoolean.prototype.className+' o_boolean_toggle',isQuickEditable:true,events:{'click':'_onClick'},async _render(){await this._super(...arguments);const classToApply=this.value?'fa-check-circle':'fa-times-circle';if(this.el.querySelector('i')){this.el.querySelector('i').remove();}
const i=document.createElement("i");i.setAttribute('class',`fa ${classToApply}`);this.el.querySelector('label').appendChild(i);},_onClick:async function(event){event.stopPropagation();await this._setValue(!this.value);this._render();},});var StatInfo=AbstractField.extend({supportedFieldTypes:['integer','float'],isSet:function(){return true;},_render:function(){var options={value:this._formatValue(this.value||0),};if(!this.attrs.nolabel){if(this.nodeOptions.label_field&&this.recordData[this.nodeOptions.label_field]){options.text=this.recordData[this.nodeOptions.label_field];}else{options.text=this.string;}}
this.$el.html(qweb.render("StatInfo",options));this.$el.addClass('o_stat_info');},});var FieldPercentPie=AbstractField.extend({description:_lt("Percentage Pie"),template:'FieldPercentPie',supportedFieldTypes:['integer','float'],isQuickEditable:true,start:function(){this.$leftMask=this.$('.o_mask').first();this.$rightMask=this.$('.o_mask').last();this.$pieValue=this.$('.o_pie_value');return this._super();},isSet:function(){return true;},_render:function(){var value=this.value||0;var degValue=360*value/100;this.$rightMask.toggleClass('o_full',degValue>=180);var leftDeg='rotate('+((degValue<180)?180:degValue)+'deg)';var rightDeg='rotate('+((degValue<180)?degValue:0)+'deg)';this.$leftMask.css({transform:leftDeg,msTransform:leftDeg,mozTransform:leftDeg,webkitTransform:leftDeg});this.$rightMask.css({transform:rightDeg,msTransform:rightDeg,mozTransform:rightDeg,webkitTransform:rightDeg});this.$pieValue.text(Math.round(value)+'%');},});var FieldProgressBar=AbstractField.extend({description:_lt("Progress Bar"),template:"ProgressBar",events:{'change input':'on_change_input','input input':'on_change_input','keyup input':function(e){if(e.which===$.ui.keyCode.ENTER){this.on_change_input(e);}},},supportedFieldTypes:['integer','float'],init:function(){this._super.apply(this,arguments);if(this.recordData[this.nodeOptions.current_value]){this.value=this.recordData[this.nodeOptions.current_value];}
this.editable_readonly=!!this.nodeOptions.editable_readonly;this.readonly=this.nodeOptions.readonly||!this.nodeOptions.editable;this.canWrite=!this.readonly&&(this.mode==='edit'||(this.editable_readonly&&this.mode==='readonly')||(this.viewType==='kanban'));this.edit_max_value=!!this.nodeOptions.edit_max_value;this.max_value=this.recordData[this.nodeOptions.max_value]||100;this.title=_t(this.attrs.title||this.nodeOptions.title)||'';this.enableBarAsInput=false;this.edit_on_click=this.enableBarAsInput&&this.mode==='readonly'&&!this.edit_max_value;this.write_mode=false;},_render:function(){var self=this;this._render_value();if(this.canWrite){if(this.edit_on_click){this.$el.on('click','.o_progress',function(e){var $target=$(e.currentTarget);var numValue=Math.floor((e.pageX-$target.offset().left)/$target.outerWidth()*self.max_value);self.on_update(numValue);self._render_value();});}else{this.$el.on('click',function(){if(!self.write_mode){var $input=$('<input>',{type:'text',class:'o_progressbar_value o_input'});$input.on('blur',self.on_change_input.bind(self));self.$('.o_progressbar_value').replaceWith($input);self.write_mode=true;self._render_value();}});}}
return this._super();},on_update:function(value){if(this.edit_max_value){this.max_value=value;this._isValid=true;var changes={};changes[this.nodeOptions.max_value]=this.max_value;this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:changes,});}else{var formattedValue=this._formatValue(value);this._setValue(formattedValue);}},on_change_input:function(e){var $input=$(e.target);if(e.type==='change'&&!$input.is(':focus')){return;}
var parsedValue;try{parsedValue=field_utils.parse.float($input.val());}catch(error){this.displayNotification({message:_t("Please enter a numerical value"),type:'danger'});}
if(parsedValue!==undefined){if(e.type==='input'){this._render_value(parsedValue);if(parsedValue===0){$input.select();}}else{if(this.edit_max_value){parsedValue=parsedValue||100;}
var $div=$('<div>',{class:'o_progressbar_value'});this.$('.o_progressbar_value').replaceWith($div);this.write_mode=false;this.on_update(parsedValue);this._render_value();}}},_render_value:function(v){var value=this.value;var max_value=this.max_value;if(!isNaN(v)){if(this.edit_max_value){max_value=v;}else{value=v;}}
value=value||0;max_value=max_value||0;var widthComplete;if(value<=max_value){widthComplete=value/max_value*100;}else{widthComplete=100;}
this.$('.o_progress').toggleClass('o_progress_overflow',value>max_value).attr('aria-valuemin','0').attr('aria-valuemax',max_value).attr('aria-valuenow',value);this.$('.o_progressbar_complete').css('width',widthComplete+'%');if(!this.write_mode){if(max_value!==100){this.$('.o_progressbar_value').text(utils.human_number(value)+" / "+utils.human_number(max_value));}else{this.$('.o_progressbar_value').text(utils.human_number(value)+"%");}}else if(isNaN(v)){this.$('.o_progressbar_value').val(this.edit_max_value?max_value:value);this.$('.o_progressbar_value').focus().select();}},_reset:function(){this._super.apply(this,arguments);var new_max_value=this.recordData[this.nodeOptions.max_value];this.max_value=new_max_value!==undefined?new_max_value:this.max_value;},isSet:function(){return true;},});var FieldToggleBoolean=AbstractField.extend({description:_lt("Button"),template:"toggle_button",events:{'click':'_onToggleButton'},supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){this.$('i').toggleClass('o_toggle_button_success',!!this.value).toggleClass('text-muted',!this.value);const isReadonly=this.record.evalModifiers(this.attrs.modifiers).readonly;if(isReadonly){this.el.setAttribute('disabled',isReadonly);}
var title=this.value?this.attrs.options.active:this.attrs.options.inactive;this.$el.attr('title',title);this.$el.attr('aria-pressed',this.value);},_onToggleButton:function(event){event.stopPropagation();this._setValue(!this.value);},});var JournalDashboardGraph=AbstractField.extend({className:"o_dashboard_graph",jsLibs:['/web/static/lib/Chart/Chart.js',],init:function(){this._super.apply(this,arguments);this.graph_type=this.attrs.graph_type;this.data=JSON.parse(this.value);},on_attach_callback:function(){this._isInDOM=true;this._renderInDOM();},on_detach_callback:function(){this._isInDOM=false;},_render:function(){if(this._isInDOM){return this._renderInDOM();}
return Promise.resolve();},_renderInDOM:function(){this.$el.empty();var config,cssClass;if(this.graph_type==='line'){config=this._getLineChartConfig();cssClass='o_graph_linechart';}else if(this.graph_type==='bar'){config=this._getBarChartConfig();cssClass='o_graph_barchart';}
this.$canvas=$('<canvas/>');this.$el.addClass(cssClass);this.$el.empty();this.$el.append(this.$canvas);var context=this.$canvas[0].getContext('2d');this.chart=new Chart(context,config);},_getLineChartConfig:function(){var labels=this.data[0].values.map(function(pt){return pt.x;});var borderColor=this.data[0].is_sample_data?'#dddddd':'#875a7b';var backgroundColor=this.data[0].is_sample_data?'#ebebeb':'#dcd0d9';return{type:'line',data:{labels:labels,datasets:[{data:this.data[0].values,fill:'start',label:this.data[0].key,backgroundColor:backgroundColor,borderColor:borderColor,borderWidth:2,}]},options:{legend:{display:false},scales:{yAxes:[{display:false}],xAxes:[{display:false}]},maintainAspectRatio:false,elements:{line:{tension:0.000001}},tooltips:{intersect:false,position:'nearest',caretSize:0,},},};},_getBarChartConfig:function(){var data=[];var labels=[];var backgroundColor=[];this.data[0].values.forEach(function(pt){data.push(pt.value);labels.push(pt.label);var color=pt.type==='past'?'#ccbdc8':(pt.type==='future'?'#a5d8d7':'#ebebeb');backgroundColor.push(color);});return{type:'bar',data:{labels:labels,datasets:[{data:data,fill:'start',label:this.data[0].key,backgroundColor:backgroundColor,}]},options:{legend:{display:false},scales:{yAxes:[{display:false}],},maintainAspectRatio:false,tooltips:{intersect:false,position:'nearest',caretSize:0,},elements:{line:{tension:0.000001}},},};},});var FieldDomain=AbstractField.extend({resetOnAnyFieldChange:true,events:_.extend({},AbstractField.prototype.events,{"click .o_domain_show_selection_button":"_onShowSelectionButtonClick","click .o_field_domain_dialog_button":"_onDialogEditButtonClick","click .o_refresh_count":"_onRefreshCountClick",}),custom_events:_.extend({},AbstractField.prototype.custom_events,{domain_changed:"_onDomainSelectorValueChange",domain_selected:"_onDomainSelectorDialogValueChange",open_record:"_onOpenRecord",}),init:function(){this._super.apply(this,arguments);this.inDialog=!!this.nodeOptions.in_dialog;this.fsFilters=this.nodeOptions.fs_filters||{};this.className="o_field_domain";if(this.mode==="edit"){this.className+=" o_edit_mode";}
if(!this.inDialog){this.className+=" o_inline_mode";}
this._setState();this._isValidForModel=true;this.nbRecords=null;this.lastCountFetchKey=null;this.debugEdition=false;},on_attach_callback(){if(this.domainSelector&&!this.inDialog){this.domainSelector.on_attach_callback();}},commitChanges(){if(this.debugEdition){return this._fetchCount();}},isSet:function(){return true;},isValid:function(){return(this._super.apply(this,arguments)&&(!this.domainSelector||this.domainSelector.isValid())&&this._isValidForModel);},_fetchCount(force=false){if(!this._domainModel){this._isValidForModel=true;this.nbRecords=0;return Promise.resolve();}
const value=this.value||"[]";const key=`${this._domainModel}/${value}`;if(!force&&this.lastCountFetchKey===key){return this.lastCountFetchProm;}
this.lastCountFetchKey=key;this.nbRecords=null;const context=this.record.getContext({fieldName:this.name});this.lastCountFetchProm=new Promise((resolve)=>{this._rpc({model:this._domainModel,method:'search_count',args:[Domain.prototype.stringToArray(value,this.record.evalContext)],context:context},{shadow:true}).then((nbRecords)=>{this._isValidForModel=true;this.nbRecords=nbRecords;resolve();}).guardedCatch((reason)=>{reason.event.preventDefault();this._isValidForModel=false;this.nbRecords=0;resolve();});});return this.lastCountFetchProm;},_render:async function(){if(!this._domainModel){this._replaceContent();return Promise.resolve();}
var value=this.value||"[]";var def;if(!this.domainSelector){this.domainSelector=new DomainSelector(this,this._domainModel,value,{readonly:this.mode==="readonly"||this.inDialog,filters:this.fsFilters,debugMode:config.isDebug(),});def=this.domainSelector.prependTo(this.$el);}else if(!this.debugEdition){def=this.domainSelector.setDomain(value);}
await Promise.resolve(def);this._replaceContent();if(!this.debugEdition){this._fetchCount().then(()=>this._replaceContent());}},_replaceContent:function(){if(this._$content){this._$content.remove();}
this._$content=$(qweb.render("FieldDomain.content",{hasModel:!!this._domainModel,isValid:!!this._isValidForModel,nbRecords:this.nbRecords,inDialog:this.inDialog,editMode:this.mode==="edit",isDebug:config.isDebug(),}));this._$content.appendTo(this.$el);},_reset:function(record,ev){this._super.apply(this,arguments);var oldDomainModel=this._domainModel;this._setState();if(this.domainSelector&&this._domainModel!==oldDomainModel){this.domainSelector.destroy();this.domainSelector=null;}
if(!ev||ev.target!==this){this.debugEdition=false;}},_setState:function(){let domainModel=this.nodeOptions.model;if(Object.prototype.hasOwnProperty.call(this.record.data,domainModel)){domainModel=this.record.data[domainModel];}
this._domainModel=domainModel;},async _onRefreshCountClick(ev){ev.stopPropagation();ev.currentTarget.setAttribute("disabled","disabled");await this._fetchCount(true);this._replaceContent();},_onShowSelectionButtonClick:function(e){e.preventDefault();new view_dialogs.SelectCreateDialog(this,{title:_t("Selected records"),res_model:this._domainModel,context:this.record.getContext({fieldName:this.name,viewType:this.viewType}),domain:this.value||"[]",no_create:true,readonly:true,disable_multiple_selection:true,}).open();},_onDialogEditButtonClick:function(e){e.preventDefault();new DomainSelectorDialog(this,this._domainModel,this.value||"[]",{readonly:this.mode==="readonly",filters:this.fsFilters,debugMode:config.isDebug(),}).open();},_onDomainSelectorValueChange:function(e){this.debugEdition=!!e.data.debug;this._setValue(e.data.domain);},_onDomainSelectorDialogValueChange:function(e){this._setValue(Domain.prototype.arrayToString(e.data.domain));},_onOpenRecord:function(event){event.stopPropagation();},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ENTER&&ev.target.tagName==="TEXTAREA"){ev.stopPropagation();return;}
this._super.apply(this,arguments);},});var AceEditor=DebouncedField.extend({template:"AceEditor",jsLibs:['/web/static/lib/ace/ace.js',['/web/static/lib/ace/mode-python.js','/web/static/lib/ace/mode-xml.js','/web/static/lib/ace/mode-qweb.js']],events:{},start:function(){this._startAce(this.$('.ace-view-editor')[0]);return this._super.apply(this,arguments);},destroy:function(){if(this.aceEditor){this.aceEditor.destroy();}
this._super.apply(this,arguments);},_formatValue:function(value){return this._super.apply(this,arguments)||'';},_getValue:function(){return this.aceSession.getValue();},_render:function(){var newValue=this._formatValue(this.value);if(this.aceSession.getValue()!==newValue){this.aceSession.setValue(newValue);}},_startAce:function(node){this.aceEditor=ace.edit(node);this.aceEditor.setOptions({maxLines:Infinity,showPrintMargin:false,});if(this.mode==='readonly'){this.aceEditor.renderer.setOptions({displayIndentGuides:false,showGutter:false,});this.aceEditor.setOptions({highlightActiveLine:false,highlightGutterLine:false,readOnly:true,});this.aceEditor.renderer.$cursorLayer.element.style.display="none";}
this.aceEditor.$blockScrolling=true;this.aceSession=this.aceEditor.getSession();const mode=this.nodeOptions.mode||'qweb';this.aceSession.setOptions({useWorker:false,mode:"ace/mode/"+(mode==='xml'?'qweb':mode),tabSize:2,useSoftTabs:true,});if(this.mode==="edit"){this.aceEditor.on("change",this._doDebouncedAction.bind(this));this.aceEditor.on("blur",this._doAction.bind(this));}},});var FieldColor=AbstractField.extend({template:'FieldColor',events:_.extend({},AbstractField.prototype.events,{'click .o_field_color':'_onColorClick',}),custom_events:_.extend({},AbstractField.prototype.custom_events,{'colorpicker:saved':'_onColorpickerSaved',}),getFocusableElement:function(){return this.$('.o_field_color');},_render:function(){this.$('.o_field_color').data('value',this.value).css('background-color',this.value).attr('title',this.value);return this._super.apply(this,arguments);},_onColorClick:function(){if(this.mode==='edit'){const dialog=new ColorpickerDialog(this,{defaultColor:this.value,noTransparency:true,}).open();dialog.on('closed',this,()=>{Promise.resolve().then(()=>{this.getFocusableElement().focus();});});}},_onColorpickerSaved:function(ev){this._setValue(ev.data.hex);},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ENTER){ev.preventDefault();ev.stopPropagation();this._onColorClick(ev);}else{this._super.apply(this,arguments);}},});var FieldColorPicker=FieldInteger.extend({RECORD_COLORS:[_t('No color'),_t('Red'),_t('Orange'),_t('Yellow'),_t('Light blue'),_t('Dark purple'),_t('Salmon pink'),_t('Medium blue'),_t('Dark blue'),_t('Fushia'),_t('Green'),_t('Purple'),],init:function(){this._super.apply(this,arguments);this.tagName='div';},_renderEdit:function(){this.$el.html(qweb.render('ColorPicker'));this._setupColorPicker();this._highlightSelectedColor();},_renderReadonly:function(){var selectedColorName=this.RECORD_COLORS[this.value];this.$el.html(qweb.render('ColorPickerReadonly',{active_color:this.value,name_color:selectedColorName}));this.$el.on('click','a',function(ev){ev.preventDefault();});},_setupColorPicker:function(){var $colorpicker=this.$('ul');if(!$colorpicker.length){return;}
$colorpicker.html(qweb.render('KanbanColorPicker',{colors:this.RECORD_COLORS}));$colorpicker.on('click','a',this._onColorChanged.bind(this));},_getValue:function(){return this.value;},_onColorChanged:function(ev){ev.preventDefault();var color=null;if(ev.currentTarget&&ev.currentTarget.dataset&&ev.currentTarget.dataset.color){color=ev.currentTarget.dataset.color;}
if(color){this.value=color;this._onChange();this._renderEdit();}},_highlightSelectedColor:function(){try{$(this.$('li')[parseInt(this.value)]).css('border','2px solid teal');}catch(err){}},_onNavigationMove(){}});return{TranslatableFieldMixin:TranslatableFieldMixin,DebouncedField:DebouncedField,FieldEmail:FieldEmail,FieldBinaryFile:FieldBinaryFile,FieldPdfViewer:FieldPdfViewer,AbstractFieldBinary:AbstractFieldBinary,FieldBinaryImage:FieldBinaryImage,KanbanFieldBinaryImage:KanbanFieldBinaryImage,CharImageUrl:CharImageUrl,KanbanCharImageUrl:KanbanCharImageUrl,FieldBoolean:FieldBoolean,BooleanToggle:BooleanToggle,FieldChar:FieldChar,LinkButton:LinkButton,FieldDate:FieldDate,FieldDateTime:FieldDateTime,FieldDateRange:FieldDateRange,RemainingDays:RemainingDays,FieldDomain:FieldDomain,FieldFloat:FieldFloat,FieldFloatTime:FieldFloatTime,FieldFloatFactor:FieldFloatFactor,FieldFloatToggle:FieldFloatToggle,FieldPercentage:FieldPercentage,FieldInteger:FieldInteger,FieldMonetary:FieldMonetary,FieldPercentPie:FieldPercentPie,FieldPhone:FieldPhone,FieldProgressBar:FieldProgressBar,FieldText:FieldText,ListFieldText:ListFieldText,FieldToggleBoolean:FieldToggleBoolean,HandleWidget:HandleWidget,InputField:InputField,NumericField:NumericField,AttachmentImage:AttachmentImage,LabelSelection:LabelSelection,StateSelectionWidget:StateSelectionWidget,ListStateSelectionWidget:ListStateSelectionWidget,FavoriteWidget:FavoriteWidget,PriorityWidget:PriorityWidget,StatInfo:StatInfo,UrlWidget:UrlWidget,TextCopyClipboard:TextCopyClipboard,CharCopyClipboard:CharCopyClipboard,URLCopyClipboard:URLCopyClipboard,JournalDashboardGraph:JournalDashboardGraph,AceEditor:AceEditor,FieldColor:FieldColor,FieldColorPicker:FieldColorPicker,};});;

/* /web/static/src/legacy/js/fields/basic_fields_owl.js defined in bundle 'web.assets_backend' */
odoo.define('web.basic_fields_owl',function(require){"use strict";const AbstractField=require('web.AbstractFieldOwl');const CustomCheckbox=require('web.CustomCheckbox');const{_lt}=require('web.translation');class FieldBadge extends AbstractField{_getClassFromDecoration(decoration){return`bg-${decoration.split('-')[1]}-light`;}}
FieldBadge.description=_lt("Badge");FieldBadge.supportedFieldTypes=['selection','many2one','char'];FieldBadge.template='web.FieldBadge';class FieldBoolean extends AbstractField{patched(){super.patched();if(this.props.event&&this.props.event.target===this){this.activate();}}
get focusableElement(){return this.mode==='readonly'?null:this.el.querySelector('input');}
get isSet(){return true;}
activate(options){const activated=super.activate(options);if(activated&&options&&options.event&&options.event.target.closest('.custom-control.custom-checkbox')){this._setValue(!this.value);}
return activated;}
setIdForLabel(id){super.setIdForLabel(id);this.el.querySelector('label').setAttribute('for',id);}
_quickEdit(extraInfo){super._quickEdit(...arguments);this._setValue(extraInfo.value===undefined?!this.value:extraInfo.value);}
_getQuickEditExtraInfo(){return{value:!this.value,};}
_onChange(ev){this._setValue(ev.target.checked);}
_onKeydown(ev){switch(ev.which){case $.ui.keyCode.ENTER:ev.preventDefault();this._setValue(!this.value);return;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:ev.preventDefault();}
super._onKeydown(ev);}}
FieldBoolean.components={CustomCheckbox};FieldBoolean.description=_lt("Checkbox");FieldBoolean.supportedFieldTypes=['boolean'];FieldBoolean.template='web.FieldBoolean';FieldBoolean.isQuickEditable=true;return{FieldBadge,FieldBoolean,};});;

/* /web/static/src/legacy/js/fields/field_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.field_registry',function(require){"use strict";const Registry=require('web.Registry');return new Registry(null,(value)=>!(value.prototype instanceof owl.Component));});odoo.define('web._field_registry',function(require){"use strict";var AbstractField=require('web.AbstractField');var basic_fields=require('web.basic_fields');var relational_fields=require('web.relational_fields');var registry=require('web.field_registry');var special_fields=require('web.special_fields');registry.add('abstract',AbstractField).add('input',basic_fields.InputField).add('integer',basic_fields.FieldInteger).add('boolean',basic_fields.FieldBoolean).add('date',basic_fields.FieldDate).add('datetime',basic_fields.FieldDateTime).add('daterange',basic_fields.FieldDateRange).add('remaining_days',basic_fields.RemainingDays).add('domain',basic_fields.FieldDomain).add('text',basic_fields.FieldText).add('list.text',basic_fields.ListFieldText).add('html',basic_fields.FieldText).add('float',basic_fields.FieldFloat).add('char',basic_fields.FieldChar).add('link_button',basic_fields.LinkButton).add('handle',basic_fields.HandleWidget).add('email',basic_fields.FieldEmail).add('phone',basic_fields.FieldPhone).add('url',basic_fields.UrlWidget).add('CopyClipboardText',basic_fields.TextCopyClipboard).add('CopyClipboardChar',basic_fields.CharCopyClipboard).add('CopyClipboardURL',basic_fields.URLCopyClipboard).add('image',basic_fields.FieldBinaryImage).add('image_url',basic_fields.CharImageUrl).add('kanban.image',basic_fields.KanbanFieldBinaryImage).add('kanban.image_url',basic_fields.KanbanCharImageUrl).add('binary',basic_fields.FieldBinaryFile).add('pdf_viewer',basic_fields.FieldPdfViewer).add('monetary',basic_fields.FieldMonetary).add('percentage',basic_fields.FieldPercentage).add('priority',basic_fields.PriorityWidget).add('attachment_image',basic_fields.AttachmentImage).add('label_selection',basic_fields.LabelSelection).add('kanban_label_selection',basic_fields.LabelSelection).add('state_selection',basic_fields.StateSelectionWidget).add('list.state_selection',basic_fields.ListStateSelectionWidget).add('kanban_state_selection',basic_fields.StateSelectionWidget).add('boolean_favorite',basic_fields.FavoriteWidget).add('boolean_toggle',basic_fields.BooleanToggle).add('statinfo',basic_fields.StatInfo).add('percentpie',basic_fields.FieldPercentPie).add('float_time',basic_fields.FieldFloatTime).add('float_factor',basic_fields.FieldFloatFactor).add('float_toggle',basic_fields.FieldFloatToggle).add('progressbar',basic_fields.FieldProgressBar).add('toggle_button',basic_fields.FieldToggleBoolean).add('dashboard_graph',basic_fields.JournalDashboardGraph).add('ace',basic_fields.AceEditor).add('color',basic_fields.FieldColor).add('many2one_reference',basic_fields.FieldInteger).add('color_picker',basic_fields.FieldColorPicker);registry.add('selection',relational_fields.FieldSelection).add('radio',relational_fields.FieldRadio).add('selection_badge',relational_fields.FieldSelectionBadge).add('many2one',relational_fields.FieldMany2One).add('many2one_barcode',relational_fields.Many2oneBarcode).add('list.many2one',relational_fields.ListFieldMany2One).add('kanban.many2one',relational_fields.KanbanFieldMany2One).add('many2one_avatar',relational_fields.Many2OneAvatar).add('many2many',relational_fields.FieldMany2Many).add('many2many_binary',relational_fields.FieldMany2ManyBinaryMultiFiles).add('many2many_tags',relational_fields.FieldMany2ManyTags).add('many2many_tags_avatar',relational_fields.FieldMany2ManyTagsAvatar).add('kanban.many2many_tags_avatar',relational_fields.KanbanMany2ManyTagsAvatar).add('list.many2many_tags_avatar',relational_fields.ListMany2ManyTagsAvatar).add('form.many2many_tags',relational_fields.FormFieldMany2ManyTags).add('kanban.many2many_tags',relational_fields.KanbanFieldMany2ManyTags).add('many2many_checkboxes',relational_fields.FieldMany2ManyCheckBoxes).add('one2many',relational_fields.FieldOne2Many).add('statusbar',relational_fields.FieldStatus).add('reference',relational_fields.FieldReference).add('font',relational_fields.FieldSelectionFont);registry.add('timezone_mismatch',special_fields.FieldTimezoneMismatch).add('report_layout',special_fields.FieldReportLayout).add('iframe_wrapper',special_fields.IframeWrapper)});;

/* /web/static/src/legacy/js/fields/field_registry_owl.js defined in bundle 'web.assets_backend' */
odoo.define('web.field_registry_owl',function(require){"use strict";const Registry=require('web.Registry');return new Registry(null,(value)=>value.prototype instanceof owl.Component);});odoo.define('web._field_registry_owl',function(require){"use strict";const basicFields=require('web.basic_fields_owl');const registry=require('web.field_registry_owl');registry.add('badge',basicFields.FieldBadge).add('boolean',basicFields.FieldBoolean);});;

/* /web/static/src/legacy/js/fields/field_utils.js defined in bundle 'web.assets_backend' */
odoo.define('web.field_utils',function(require){"use strict";var core=require('web.core');var dom=require('web.dom');var session=require('web.session');var time=require('web.time');var utils=require('web.utils');var _t=core._t;function formatBinary(value,field,options){if(!value){return'';}
return utils.binaryToBinsize(value);}
function formatBoolean(value,field,options){if(options&&options.forceString){return value?_t('True'):_t('False');}
return dom.renderCheckbox({prop:{checked:value,disabled:true,},});}
function formatChar(value,field,options){value=typeof value==='string'?value:'';if(options&&options.isPassword){return _.str.repeat('*',value?value.length:0);}
if(options&&options.escape){value=_.escape(value);}
return value;}
function formatDate(value,field,options){if(value===false||isNaN(value)){return"";}
if(field&&field.type==='datetime'){if(!options||!('timezone'in options)||options.timezone){value=value.clone().add(session.getTZOffset(value),'minutes');}}
var date_format=time.getLangDateFormat();return value.format(date_format);}
function formatDateTime(value,field,options){if(value===false){return"";}
if(!options||!('timezone'in options)||options.timezone){value=value.clone().add(session.getTZOffset(value),'minutes');}
return value.format(time.getLangDatetimeFormat());}
function formatFloat(value,field,options){options=options||{};if(value===false){return"";}
if(options.humanReadable&&options.humanReadable(value)){return utils.human_number(value,options.decimals,options.minDigits,options.formatterCallback);}
var l10n=core._t.database.parameters;var precision;if(options.digits){precision=options.digits[1];}else if(field&&field.digits){precision=field.digits[1];}else{precision=2;}
var formatted=_.str.sprintf('%.'+precision+'f',value||0).split('.');formatted[0]=utils.insert_thousand_seps(formatted[0]);return formatted.join(l10n.decimal_point);}
function formatFloatFactor(value,field,options){var factor=options.factor||1;return formatFloat(value*factor,field,options);}
function formatFloatTime(value,field,options){options=options||{};var pattern=options.noLeadingZeroHour?'%1d:%02d':'%02d:%02d';if(value<0){value=Math.abs(value);pattern='-'+pattern;}
var hour=Math.floor(value);var min=Math.round((value%1)*60);if(min===60){min=0;hour=hour+1;}
return _.str.sprintf(pattern,hour,min);}
function formatInteger(value,field,options){options=options||{};if(options.isPassword){return _.str.repeat('*',String(value).length);}
if(!value&&value!==0){return"";}
if(options.humanReadable&&options.humanReadable(value)){return utils.human_number(value,options.decimals,options.minDigits,options.formatterCallback);}
return utils.insert_thousand_seps(_.str.sprintf('%d',value));}
function formatMany2one(value,field,options){if(!value){value='';}else if(_.isArray(value)){value=value[1];}else{while(value.data){value=value.data.display_name||'';}}
if(options&&options.escape){value=_.escape(value);}
return value;}
function formatX2Many(value){if(value.data.length===0){return _t('No records');}else if(value.data.length===1){return _t('1 record');}else{return value.data.length+_t(' records');}}
function formatMonetary(value,field,options){if(value===false){return"";}
options=Object.assign({forceString:false},options);var currency=options.currency;if(!currency){var currency_id=options.currency_id;if(!currency_id&&options.data){var currency_field=options.currency_field||field.currency_field||'currency_id';currency_id=options.data[currency_field]&&options.data[currency_field].res_id;}
currency=session.get_currency(currency_id);}
var digits=(currency&&currency.digits)||options.digits;if(options.field_digits===true){digits=field.digits||digits;}
var formatted_value=formatFloat(value,field,_.extend({},options,{digits:digits}));if(!currency||options.noSymbol){return formatted_value;}
const val=currency.position==='after'?[formatted_value,currency.symbol]:[currency.symbol,formatted_value];if(options.forceString){return val.join(' ');}
return utils.Markup(val.map((v)=>_.escape(v)).join('&nbsp;'));}
function formatPercentage(value,field,options){options=options||{};let result=formatFloat(value*100,field,options)||'0';if(!options.humanReadable||!options.humanReadable(value*100)){result=parseFloat(result).toString().replace('.',_t.database.parameters.decimal_point);}
return result+(options.noSymbol?'':'%');}
function formatSelection(value,field,options){var val=_.find(field.selection,function(option){return option[0]===value;});if(!val){return'';}
value=val[1];if(options&&options.escape){value=_.escape(value);}
return value;}
function parseSmartDateInput(value){const units={d:'days',m:'months',w:'weeks',y:'years',};const re=new RegExp(`^([+-])(\\d+)([${Object.keys(units).join('')}]?)$`);const match=re.exec(value);if(match){let date=moment();const offset=parseInt(match[2],10);const unit=units[match[3]||'d'];if(match[1]==='+'){date.add(offset,unit);}else{date.subtract(offset,unit);}
return date;}
return false;}
function parseDate(value,field,options){if(!value){return false;}
var datePattern=time.getLangDateFormat();var datePatternWoZero=time.getLangDateFormatWoZero();var date;const smartDate=parseSmartDateInput(value);if(smartDate){date=smartDate;}else{if(options&&options.isUTC){value=value.padStart(10,"0");date=moment.utc(value);}else{date=moment.utc(value,[datePattern,datePatternWoZero,moment.ISO_8601]);}}
if(date.isValid()){if(date.year()===0){date.year(moment.utc().year());}
if(date.year()>=1000){date.toJSON=function(){return this.clone().locale('en').format('YYYY-MM-DD');};return date;}}
throw new Error(_.str.sprintf(core._t("'%s' is not a correct date"),value));}
function parseDateTime(value,field,options){if(!value){return false;}
const datePattern=time.getLangDateFormat();const timePattern=time.getLangTimeFormat();const datePatternWoZero=time.getLangDateFormatWoZero();const timePatternWoZero=time.getLangTimeFormatWoZero();var pattern1=datePattern+' '+timePattern;var pattern2=datePatternWoZero+' '+timePatternWoZero;var datetime;const smartDate=parseSmartDateInput(value);if(smartDate){datetime=smartDate;}else{if(options&&options.isUTC){value=value.padStart(19,"0");datetime=moment.utc(value.replace(' ','T')+'Z');}else{datetime=moment.utc(value,[pattern1,pattern2,moment.ISO_8601]);if(options&&options.timezone){datetime.add(-session.getTZOffset(datetime),'minutes');}}}
if(datetime.isValid()){if(datetime.year()===0){datetime.year(moment.utc().year());}
if(datetime.year()>=1000){datetime.toJSON=function(){return this.clone().locale('en').format('YYYY-MM-DD HH:mm:ss');};return datetime;}}
throw new Error(_.str.sprintf(core._t("'%s' is not a correct datetime"),value));}
function parseNumber(value){if(core._t.database.parameters.thousands_sep){var escapedSep=_.str.escapeRegExp(core._t.database.parameters.thousands_sep);value=value.replace(new RegExp(escapedSep,'g'),'');}
if(core._t.database.parameters.decimal_point){value=value.replace(core._t.database.parameters.decimal_point,'.');}
return Number(value);}
function parseFloat(value){var parsed=parseNumber(value);if(isNaN(parsed)){throw new Error(_.str.sprintf(core._t("'%s' is not a correct float"),value));}
return parsed;}
function parseMonetary(value,field,options){var values=value.split('&nbsp;');if(values.length===1){return parseFloat(value);}
else if(values.length!==2){throw new Error(_.str.sprintf(core._t("'%s' is not a correct monetary field"),value));}
options=options||{};var currency=options.currency;if(!currency){var currency_id=options.currency_id;if(!currency_id&&options.data){var currency_field=options.currency_field||field.currency_field||'currency_id';currency_id=options.data[currency_field]&&options.data[currency_field].res_id;}
currency=session.get_currency(currency_id);}
return parseFloat(values[0]===currency.symbol?values[1]:values[0]);}
function parseFloatFactor(value,field,options){var parsed=parseFloat(value);var factor=options.factor||1.0;return parsed/factor;}
function parseFloatTime(value){var factor=1;if(value[0]==='-'){value=value.slice(1);factor=-1;}
var float_time_pair=value.split(":");if(float_time_pair.length!==2)
return factor*parseFloat(value);var hours=parseInteger(float_time_pair[0]);var minutes=parseInteger(float_time_pair[1]);return factor*(hours+(minutes/60));}
function parsePercentage(value){return parseFloat(value)/100;}
function parseInteger(value){var parsed=parseNumber(value);if(isNaN(parsed)||parsed%1||parsed<-2147483648||parsed>2147483647){throw new Error(_.str.sprintf(core._t("'%s' is not a correct integer"),value));}
return parsed;}
function parseMany2one(value){if(_.isArray(value)){return{id:value[0],display_name:value[1],};}
if(_.isNumber(value)||_.isString(value)){return{id:parseInt(value,10),};}
return value;}
return{format:{binary:formatBinary,boolean:formatBoolean,char:formatChar,date:formatDate,datetime:formatDateTime,float:formatFloat,float_factor:formatFloatFactor,float_time:formatFloatTime,html:_.identity,integer:formatInteger,many2many:formatX2Many,many2one:formatMany2one,many2one_reference:formatInteger,monetary:formatMonetary,one2many:formatX2Many,percentage:formatPercentage,reference:formatMany2one,selection:formatSelection,text:formatChar,},parse:{binary:_.identity,boolean:_.identity,char:_.identity,date:parseDate,datetime:parseDateTime,float:parseFloat,float_factor:parseFloatFactor,float_time:parseFloatTime,html:_.identity,integer:parseInteger,many2many:_.identity,many2one:parseMany2one,many2one_reference:parseInteger,monetary:parseMonetary,one2many:_.identity,percentage:parsePercentage,reference:parseMany2one,selection:_.identity,text:_.identity,},};});;

/* /web/static/src/legacy/js/fields/field_wrapper.js defined in bundle 'web.assets_backend' */
odoo.define('web.FieldWrapper',function(require){"use strict";const{ComponentWrapper}=require('web.OwlCompatibility');const field_utils=require('web.field_utils');class FieldWrapper extends ComponentWrapper{constructor(){super(...arguments);this._data={};const options=this.props.options||{};const record=this.props.record;this._data.name=this.props.fieldName;this._data.record=record;this._data.field=record.fields[this._data.name];this._data.viewType=options.viewType||'default';const fieldsInfo=record.fieldsInfo[this._data.viewType];this._data.attrs=options.attrs||(fieldsInfo&&fieldsInfo[this._data.name])||{};this._data.additionalContext=options.additionalContext||{};this._data.value=record.data[this._data.name];this._data.recordData=record.data;this._data.string=this._data.attrs.string||this._data.field.string||this._data.name;this._data.nodeOptions=this._data.attrs.options||{};this._data.dataPointID=record.id;this._data.res_id=record.res_id;this._data.model=record.model;this._data.mode=options.mode||"readonly";this._data.formatType=this._data.attrs.widget in field_utils.format?this._data.attrs.widget:this._data.field.type;this._data.formatOptions={};this._data.parseOptions={};if(this._data.attrs.decorations){this._data.resetOnAnyFieldChange=true;}
for(let key in this._data){Object.defineProperty(this,key,{get:()=>{if(this.el){if(key==='dataPointID'){return this.componentRef.comp.dataPointId;}else if(key==='res_id'){return this.componentRef.comp.resId;}}
return(this.el?this.componentRef.comp:this._data)[key];},});}}
mounted(){super.mounted(...arguments);this.componentRef.comp.__node=this.__node;}
get fieldDependencies(){return this.Component.fieldDependencies;}
get specialData(){return this.Component.specialData;}
get supportedFieldTypes(){return this.Component.supportedFieldTypes;}
get description(){return this.Component.description;}
get noLabel(){return this.Component.noLabel;}
get isQuickEditable(){return this.Component.isQuickEditable;}
activate(){return this.componentRef.comp.activate(...arguments);}
commitChanges(){return this.componentRef.comp.commitChanges(...arguments);}
quickEdit(){return this.componentRef.comp.quickEdit(...arguments);}
getFocusableElement(){return $(this.componentRef.comp.focusableElement);}
isEmpty(){return this.componentRef.comp.isEmpty;}
isFocusable(){return this.componentRef.comp.isFocusable;}
isSet(){if(this.componentRef.comp){return this.componentRef.comp.isSet;}
const c=new this.Component(null,this.props);const isSet=c.isSet;c.destroy();return isSet;}
isValid(){if(this.componentRef.comp){return this.componentRef.comp.isValid;}
const c=new this.Component(null,this.props);const isValid=c.isValid;c.destroy();return isValid;}
removeInvalidClass(){return this.componentRef.comp.removeInvalidClass(...arguments);}
reset(record,event){return this.update({record,event});}
setIDForLabel(){return this.componentRef.comp.setIdForLabel(...arguments);}
setInvalidClass(){return this.componentRef.comp.setInvalidClass(...arguments);}
updateModifiersValue(modifiers){if(this.props.options.attrs){this.props.options.attrs.modifiersValue=modifiers||{};}else{const viewType=this.props.options.viewType||'default';const fieldsInfo=this.props.record.fieldsInfo[viewType];fieldsInfo[this.props.fieldName].modifiersValue=modifiers||{};}
this.componentRef.comp.props=this.props;}}
return FieldWrapper;});;

/* /web/static/src/legacy/js/fields/relational_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.relational_fields',function(require){"use strict";var AbstractField=require('web.AbstractField');var basicFields=require('web.basic_fields');var concurrency=require('web.concurrency');const ControlPanelX2Many=require('web.ControlPanelX2Many');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var dialogs=require('web.view_dialogs');var dom=require('web.dom');const Domain=require('web.Domain');var KanbanRecord=require('web.KanbanRecord');var KanbanRenderer=require('web.KanbanRenderer');var ListRenderer=require('web.ListRenderer');const{ComponentWrapper,WidgetAdapterMixin}=require('web.OwlCompatibility');const{sprintf,toBoolElse}=require("web.utils");const{escape}=owl.utils;var _t=core._t;var _lt=core._lt;var qweb=core.qweb;var M2ODialog=Dialog.extend({template:"M2ODialog",init:function(parent,name,value){this.name=name;this.value=value;this._super(parent,{title:_.str.sprintf(_t("New %s"),this.name),size:'medium',buttons:[{text:_t('Create'),classes:'btn-primary',close:true,click:function(){this.trigger_up('quick_create',{value:this.value});},},{text:_t('Discard'),close:true,}],});},close:function(isSet){this.isSet=isSet;this._super.apply(this,arguments);},destroy:function(){if(!this.isSet){this.trigger_up('closed_unset');}
this._super.apply(this,arguments);},});var FieldMany2One=AbstractField.extend({description:_lt("Many2one"),supportedFieldTypes:['many2one'],template:'FieldMany2One',custom_events:_.extend({},AbstractField.prototype.custom_events,{'closed_unset':'_onDialogClosedUnset','field_changed':'_onFieldChanged','quick_create':'_onQuickCreate',}),events:_.extend({},AbstractField.prototype.events,{'click input':'_onInputClick','click':'_onLinkClick','focusout input':'_onInputFocusout','keyup input':'_onInputKeyup','click .o_external_button':'_onExternalButtonClick',}),quickEditExclusion:['.o_form_uri',],AUTOCOMPLETE_DELAY:200,SEARCH_MORE_LIMIT:320,isQuickEditable:true,init:function(parent,name,record,options){options=options||{};this._super.apply(this,arguments);this.limit=7;this.orderer=new concurrency.DropMisordered();const canCreate='can_create'in this.attrs?JSON.parse(this.attrs.can_create):true;this.can_create=canCreate&&!this.nodeOptions.no_create&&!options.noCreate;this.can_write='can_write'in this.attrs?JSON.parse(this.attrs.can_write):true;this.nodeOptions=_.defaults(this.nodeOptions,{quick_create:true,});this.noOpen='noOpen'in options?options.noOpen:this.nodeOptions.no_open;this.m2o_value=this._formatValue(this.value);this.recordParams={fieldName:this.name,viewType:this.viewType};this.isDirty=false;this.lastChangeEvent=undefined;this._autocompleteSources=[];this._addAutocompleteSource(this._search,{placeholder:_t('Loading...'),order:1});this.suggestions=[];this.ignoreTabSelect=false;this.dp=new concurrency.DropPrevious();this.createDef=undefined;},start:function(){this.floating=false;this.$input=this.$('input');this.$external_button=this.$('.o_external_button');return this._super.apply(this,arguments);},destroy:function(){if(this._onScroll){window.removeEventListener('scroll',this._onScroll,true);}
this._super.apply(this,arguments);},commitChanges:function(){return Promise.resolve(this.createDef);},getFocusableElement:function(){return this.mode==='edit'&&this.$input||this.$el;},reinitialize:function(value){this.isDirty=false;this.floating=false;return this._setValue(value);},reset:function(record,event){this._reset(record,event);if(!event||event===this.lastChangeEvent){this.isDirty=false;}
if(this.isDirty){return Promise.resolve();}else{return this._render();}},_addAutocompleteSource:function(method,params){this._autocompleteSources.push({method:method,placeholder:(params.placeholder?_t(params.placeholder):_t('Loading...'))+'<i class="fa fa-spin fa-circle-o-notch pull-right"></i>',validation:params.validation,loading:false,order:params.order||999});this._autocompleteSources=_.sortBy(this._autocompleteSources,'order');},_bindAutoComplete:function(){var self=this;if($.browser.chrome&&this.$input.attr('placeholder')){this.$input.attr('placeholder',function(index,val){return val.split('').join('\ufeff');});}
this.$input.autocomplete({source:function(req,resp){self.suggestions=[];_.each(self._autocompleteSources,function(source){source.results=[];const search=req.term.trim();if(!source.validation||source.validation.call(self,search)){source.loading=true;Promise.resolve(source.method.call(self,search)).then(function(results){source.results=results;source.loading=false;self.suggestions=self._concatenateAutocompleteResults();resp(self.suggestions);});}});},select:function(event,ui){if(!self.floating&&event.key==="Tab"&&self.ignoreTabSelect){return false;}
if(event.key==="Enter"){event.stopImmediatePropagation();event.preventDefault();}
var item=ui.item;self.floating=false;if(item.id){self.reinitialize({id:item.id,display_name:item.name});}else if(item.action){item.action();}
return false;},focus:function(event){event.preventDefault();if(event.key==="ArrowUp"||event.key==="ArrowDown"){self.ignoreTabSelect=false;}},open:function(event){self._onScroll=function(ev){if(ev.target!==self.$input.get(0)&&self.$input.hasClass('ui-autocomplete-input')){self.$input.autocomplete('close');}};window.addEventListener('scroll',self._onScroll,true);},close:function(event){self.ignoreTabSelect=false;if(event.which===$.ui.keyCode.ESCAPE){event.stopPropagation();}
if(self._onScroll){window.removeEventListener('scroll',self._onScroll,true);}},autoFocus:true,html:true,minLength:0,delay:this.AUTOCOMPLETE_DELAY,classes:{"ui-autocomplete":"dropdown-menu",},create:function(){$(this).data('ui-autocomplete')._renderMenu=function(ulWrapper,entries){var render=this;$.each(entries,function(index,entry){render._renderItemData(ulWrapper,entry);});$(ulWrapper).find("li > a").addClass("dropdown-item");}},});this.$input.autocomplete("option","position",{my:"left top",at:"left bottom"});this.autocomplete_bound=true;},_concatenateAutocompleteResults:function(){var results=[];_.each(this._autocompleteSources,function(source){if(source.results&&source.results.length){results=results.concat(source.results);}else if(source.loading){results.push({label:source.placeholder});}});return results;},_createContext:function(name){var tmp={};var field=this.nodeOptions.create_name_field;if(field===undefined){field="name";}
if(field!==false&&name&&this.nodeOptions.quick_create!==false){tmp["default_"+field]=name;}
return tmp;},_quickEdit:function(){this._super(...arguments);this._toggleAutoComplete();},_getSearchBlacklist:function(){return[];},_getDisplayName:function(value){return value.split('\n')[0];},_getSearchCreatePopupOptions:function(view,ids,context,dynamicFilters){var self=this;return{res_model:this.field.relation,domain:this.record.getDomain({fieldName:this.name}),context:_.extend({},this.record.getContext(this.recordParams),context||{}),_createContext:this._createContext.bind(this),dynamicFilters:dynamicFilters||[],title:_.str.sprintf((view==='search'?_t("Search: %s"):_t("Create: %s")),this.string),initial_ids:ids,initial_view:view,disable_multiple_selection:true,no_create:!self.can_create,kanban_view_ref:this.attrs.kanban_view_ref,on_selected:function(records){self.reinitialize(records[0]);},on_closed:function(){self.activate();},};},_manageSearchMore:function(values,search_val,domain,context){var self=this;values=values.slice(0,this.limit);values.push({label:_t("Search More..."),action:function(){var prom;if(search_val!==''){prom=self._rpc({model:self.field.relation,method:'name_search',kwargs:{name:search_val,args:domain,operator:"ilike",limit:self.SEARCH_MORE_LIMIT,context:context,},});}
Promise.resolve(prom).then(function(results){var dynamicFilters;if(results){var ids=_.map(results,function(x){return x[0];});dynamicFilters=[{description:_.str.sprintf(_t('Quick search: %s'),search_val),domain:[['id','in',ids]],}];}
self._searchCreatePopup("search",false,{},dynamicFilters);});},classname:'o_m2o_dropdown_option',});return values;},_toggleAutoComplete:function(){if(this.$input.autocomplete("widget").is(":visible")){this.$input.autocomplete("close");}else if(this.floating){this.$input.autocomplete("search");}else{this.$input.autocomplete("search",'');}},_onFieldChanged:function(event){this.lastChangeEvent=event;},_quickCreate:function(name){var self=this;var createDone;var def=new Promise(function(resolve,reject){self.createDef=new Promise(function(innerResolve){createDone=function(){innerResolve();resolve();self.createDef=undefined;};});var slowCreate=function(){var dialog=self._searchCreatePopup("form",false,self._createContext(name));dialog.on('closed',self,createDone);};if(self.nodeOptions.quick_create){const prom=self.reinitialize({id:false,display_name:name});prom.guardedCatch(reason=>{reason.event.preventDefault();slowCreate();});self.dp.add(prom).then(createDone).guardedCatch(reject);}else{slowCreate();}});return def;},_renderEdit:function(){var value=this.m2o_value;this.$('.o_field_many2one_extra').html(this._renderValueLines(false));if(this.nodeOptions.always_reload){value=this._getDisplayName(value);}
this.$input.val(value);if(!this.autocomplete_bound){this._bindAutoComplete();}
this._updateExternalButton();},_renderValueLines:function(needFirstLine){const escapedValue=_.escape((this.m2o_value||"").trim());const lines=escapedValue.split('\n');if(!needFirstLine){lines.shift();}
return lines.map((line)=>`<span>${line}</span>`).join('<br/>');},_renderReadonly:function(){this.$el.html(this._renderValueLines(true));if(!this.noOpen&&this.value){this.$el.attr('href',_.str.sprintf('#id=%s&model=%s',this.value.res_id,this.field.relation));this.$el.addClass('o_form_uri');}},_reset:function(){this._super.apply(this,arguments);this.floating=false;this.m2o_value=this._formatValue(this.value);},_search:async function(searchValue=""){const value=searchValue.trim();const domain=this.record.getDomain(this.recordParams);const context=Object.assign(this.record.getContext(this.recordParams),this.additionalContext);const blackListedIds=this._getSearchBlacklist();if(blackListedIds.length){domain.push(['id','not in',blackListedIds]);}
const nameSearch=this._rpc({model:this.field.relation,method:"name_search",kwargs:{name:value,args:domain,operator:"ilike",limit:this.limit+1,context,}});const results=await this.orderer.add(nameSearch);let values=results.map((result)=>{const[id,fullName]=result;const displayName=this._getDisplayName(fullName).trim();result[1]=displayName;return{id,label:escape(displayName)||data.noDisplayContent,value:displayName,name:displayName,};});if(this.limit<values.length){values=this._manageSearchMore(values,value,domain,context);}
const canQuickCreate=this.can_create&&!this.nodeOptions.no_quick_create;const canCreateEdit=this.can_create&&!this.nodeOptions.no_create_edit;if(value.length){const nameExists=results.some((result)=>result[1]===value);if(canQuickCreate&&!nameExists){values.push({label:sprintf(_t(`Create "<strong>%s</strong>"`),escape(value)),action:()=>this._quickCreate(value),classname:'o_m2o_dropdown_option'});}
if(canCreateEdit){const valueContext=this._createContext(value);values.push({label:_t("Create and Edit..."),action:()=>{this.el.querySelector(':scope input').value="";return this._searchCreatePopup('form',false,valueContext);},classname:'o_m2o_dropdown_option',});}
if(!values.length){values.push({label:_t("No records"),classname:'o_m2o_no_result',});}}else if(!this.value&&(canQuickCreate||canCreateEdit)){values.push({label:_t("Start typing..."),classname:'o_m2o_start_typing',});}
return values;},_searchCreatePopup:function(view,ids,context,dynamicFilters){var options=this._getSearchCreatePopupOptions(view,ids,context,dynamicFilters);return new dialogs.SelectCreateDialog(this,_.extend({},this.nodeOptions,options)).open();},_updateExternalButton:function(){var has_external_button=!this.noOpen&&!this.floating&&this.isSet();this.$external_button.toggle(has_external_button);this.$el.toggleClass('o_with_button',has_external_button);},_onLinkClick:function(event){var self=this;if(this.mode==='readonly'){event.preventDefault();if(!this.noOpen){event.stopPropagation();this._rpc({model:this.field.relation,method:'get_formview_action',args:[[this.value.res_id]],context:this.record.getContext(this.recordParams),}).then(function(action){self.trigger_up('do_action',{action:action});});}}},_onDialogClosedUnset:function(){this.isDirty=false;this.floating=false;this._render();},_onExternalButtonClick:function(){if(!this.value){this.activate();return;}
var self=this;var context=this.record.getContext(this.recordParams);this._rpc({model:this.field.relation,method:'get_formview_id',args:[[this.value.res_id]],context:context,}).then(function(view_id){new dialogs.FormViewDialog(self,{res_model:self.field.relation,res_id:self.value.res_id,context:context,title:_t("Open: ")+self.string,view_id:view_id,readonly:!self.can_write,on_saved:function(record,changed){if(changed){const _setValue=self._setValue.bind(self,self.value.data,{forceChange:true,});self.trigger_up('reload',{db_id:self.value.id,onSuccess:_setValue,onFailure:_setValue,});}},}).open();});},_onInputClick:function(){if(this.autocomplete_bound&&!this.$input.autocomplete("widget").is(":visible")){this.ignoreTabSelect=true;}
this._toggleAutoComplete();},_onInputFocusout:function(){if(!this.floating){return;}
const firstValue=this.suggestions.find(s=>s.id);if(firstValue){this.reinitialize({id:firstValue.id,display_name:firstValue.name});}else if(this.can_create){new M2ODialog(this,this.string,this.$input.val()).open();}else{this.$input.val("");}},_onInputKeyup:function(ev){const $autocomplete=this.$input.autocomplete("widget");if(ev.which===$.ui.keyCode.TAB&&$autocomplete.is(":visible")&&!$autocomplete.find('.ui-menu-item .ui-state-active').length){this.$input.autocomplete("close");}
if(ev.which===$.ui.keyCode.ENTER||ev.which===$.ui.keyCode.TAB){return;}
this.isDirty=true;if(this.$input.val()===""){if(ev.key==="Backspace"||ev.key==="Delete"){this.ignoreTabSelect=true;}
this.reinitialize(false);}else if(this._getDisplayName(this.m2o_value)!==this.$input.val()){this.floating=true;this._updateExternalButton();}},_onQuickCreate:function(event){this._quickCreate(event.data.value);},});var Many2oneBarcode=FieldMany2One.extend({});var ListFieldMany2One=FieldMany2One.extend({events:_.extend({},FieldMany2One.prototype.events,{'focusin input':'_onInputFocusin',}),init:function(){this._super.apply(this,arguments);this.mustSetValue=false;this.m2oDialogFocused=false;},activate:function(){if(this.mode==='readonly'){return false;}
return this._super.apply(this,arguments);},reinitialize:function(){this.mustSetValue=false;return this._super.apply(this,arguments);},_renderReadonly:function(){this.$el.text(this.m2o_value);},_searchCreatePopup:function(){this.m2oDialogFocused=true;return this._super.apply(this,arguments);},_onInputFocusin:function(){this.m2oDialogFocused=false;},_onInputFocusout:function(){if(this.can_create&&this.floating){var attachedEvents=['click','mousedown'];var stopNextClick=(function(ev){ev.stopPropagation();attachedEvents.forEach(function(eventName){window.removeEventListener(eventName,stopNextClick,true);});}).bind(this);attachedEvents.forEach(function(eventName){window.addEventListener(eventName,stopNextClick,true);});}
this._super.apply(this,arguments);if(!this.m2oDialogFocused&&this.$input.val()===""&&this.mustSetValue){this.reinitialize(false);}},_onInputKeyup:function(){if(this.$input.val()!==""){this._super.apply(this,arguments);}else{this.mustSetValue=true;}},});var KanbanFieldMany2One=AbstractField.extend({tagName:'span',init:function(){this._super.apply(this,arguments);this.m2o_value=this._formatValue(this.value);},_render:function(){this.$el.text(this.m2o_value);},});const Many2OneAvatar=FieldMany2One.extend({_template:'web.Many2OneAvatar',init(){this._super.apply(this,arguments);if(this.mode==='readonly'){this.template=null;this.tagName='div';this.noOpen=true;}},start(){this.el.classList.add('o_field_many2one_avatar');return this._super(...arguments);},_render(){const m2oAvatar=qweb.render(this._template,{url:`/web/image/${this.field.relation}/${this.value.res_id}/avatar_128`,value:this.m2o_value,widget:this,});if(this.mode==='edit'){this._super(...arguments);if(this.el.querySelector('.o_m2o_avatar')){this.el.querySelector('.o_m2o_avatar').remove();}
dom.prepend(this.$('.o_field_many2one_selection'),m2oAvatar);}
if(this.mode==='readonly'){this.$el.empty();dom.append(this.$el,m2oAvatar);}},});var FieldX2Many=AbstractField.extend(WidgetAdapterMixin,{tagName:'div',custom_events:_.extend({},AbstractField.prototype.custom_events,{add_record:'_onAddRecord',discard_changes:'_onDiscardChanges',edit_line:'_onEditLine',field_changed:'_onFieldChanged',open_record:'_onOpenRecord',kanban_record_delete:'_onRemoveRecord',list_record_remove:'_onRemoveRecord',resequence_records:'_onResequenceRecords',save_line:'_onSaveLine',toggle_column_order:'_onToggleColumnOrder',activate_next_widget:'_onActiveNextWidget',navigation_move:'_onNavigationMove',save_optional_fields:'_onSaveOrLoadOptionalFields',load_optional_fields:'_onSaveOrLoadOptionalFields',pager_changed:'_onPagerChanged',}),resetOnAnyFieldChange:true,useSubview:true,isQuickEditable:true,quickEditExclusion:['.o_x2m_control_panel','thead','.o_widget',],init:function(parent,name,record,options){this._super.apply(this,arguments);this.createText=this.attrs['add-label']||_t('Add');this.operations=[];this.isReadonly=this.mode==='readonly';this.view=this.attrs.views[this.attrs.mode];this.isMany2Many=this.field.type==='many2many'||this.attrs.widget==='many2many';this.activeActions={};this.recordParams={fieldName:this.name,viewType:this.viewType};this.pagingState={currentMinimum:this.value.offset+1,limit:this.value.limit,size:this.value.count,validate:()=>{return this.view.arch.tag==='tree'?this.renderer.unselectRow():Promise.resolve();},withAccessKey:false,};var arch=this.view&&this.view.arch;if(arch){this.activeActions.create=arch.attrs.create?!!JSON.parse(arch.attrs.create):true;this.activeActions.delete=arch.attrs.delete?!!JSON.parse(arch.attrs.delete):true;this.editable=arch.attrs.editable;this._canQuickEdit=arch.tag==='tree';}else{this._canQuickEdit=false;}
this._computeAvailableActions(record);if(this.attrs.columnInvisibleFields){this._processColumnInvisibleFields();}},start:async function(){const _super=this._super.bind(this);if(this.view){this._renderButtons();this._controlPanelWrapper=new ComponentWrapper(this,ControlPanelX2Many,{cp_content:{$buttons:this.$buttons},pager:this.pagingState,});await this._controlPanelWrapper.mount(this.el,{position:'first-child'});}
return _super(...arguments);},destroy:function(){WidgetAdapterMixin.destroy.call(this);this._super();},on_attach_callback:function(){this.isInDOM=true;WidgetAdapterMixin.on_attach_callback.call(this);if(this.renderer){this.renderer.on_attach_callback();}},on_detach_callback:function(){this.isInDOM=false;WidgetAdapterMixin.on_detach_callback.call(this);if(this.renderer){this.renderer.on_detach_callback();}},commitChanges:function(){var self=this;var inEditionRecordID=this.renderer&&this.renderer.viewType==="list"&&this.renderer.getEditableRecordID();if(inEditionRecordID){return this.renderer.commitChanges(inEditionRecordID).then(function(){return self._saveLine(inEditionRecordID);});}
return this._super.apply(this,arguments);},isSet:function(){return true;},reset:function(record,ev,fieldChanged){const oldCanCreate=this.canCreate;const oldCanDelete=this.canDelete;const oldCanLink=this.canLink;const oldCanUnlink=this.canUnlink;this._computeAvailableActions(record);const actionsChanged=this.canCreate!==oldCanCreate||this.canDelete!==oldCanDelete||this.canLink!==oldCanLink||this.canUnlink!==oldCanUnlink;if(!fieldChanged&&!actionsChanged){var newEval=this._evalColumnInvisibleFields();if(_.isEqual(this.currentColInvisibleFields,newEval)){this._reset(record,ev);return Promise.resolve();}}else if(ev&&ev.target===this&&ev.data.changes&&this.view.arch.tag==='tree'){var command=ev.data.changes[this.name];if(command&&command.operation==='UPDATE'&&command.data){var state=record.data[this.name];var fieldNames=state.getFieldNames({viewType:'list'});this._reset(record,ev);return this.renderer.confirmUpdate(state,command.id,fieldNames,ev.initialEvent);}}
return this._super.apply(this,arguments);},getFocusableElement:function(){return(this.mode==='edit'&&this.$input)||this.$el;},activate:function(options){if(!this.activeActions.create||this.isReadonly||!this.$el.is(":visible")){return false;}
if(this.view.type==='kanban'){this.$buttons.find(".o-kanban-button-new").focus();}
if(this.view.arch.tag==='tree'){if(options&&options.noAutomaticCreate){this.renderer.$('.o_field_x2many_list_row_add a:first').focus();}else{this.renderer.$('.o_field_x2many_list_row_add a:first').click();}}
return true;},_computeAvailableActions:function(record){const evalContext=record.evalContext;this.canCreate='create'in this.nodeOptions?new Domain(this.nodeOptions.create,evalContext).compute(evalContext):true;this.canDelete='delete'in this.nodeOptions?new Domain(this.nodeOptions.delete,evalContext).compute(evalContext):true;this.canLink='link'in this.nodeOptions?new Domain(this.nodeOptions.link,evalContext).compute(evalContext):true;this.canUnlink='unlink'in this.nodeOptions?new Domain(this.nodeOptions.unlink,evalContext).compute(evalContext):true;},_quickEdit:function(extraInfo){if(extraInfo.type==='remove'){this._removeRecord(extraInfo.recordId);}else if(extraInfo.type==='edit'){const parts=[];if(extraInfo.row){parts.push(`.o_data_row[data-id="${extraInfo.row}"]`);}
if(extraInfo.subFieldName){parts.push(`[name="${extraInfo.subFieldName}"]`);}
if(parts.length){const el=this.el.querySelector(parts.join(' '));if(el){el.click();}}}},_evalColumnInvisibleFields:function(){var self=this;return _.mapObject(this.columnInvisibleFields,function(domains){return self.record.evalModifiers({column_invisible:domains,}).column_invisible;});},_getButtonsRenderingContext(){return{btnClass:'btn-secondary',create_text:this.createText,};},_getQuickEditExtraInfo:function(ev){const row=ev.target.closest('.o_data_row');const field=ev.target.closest('.o_data_row .o_field_widget')||ev.target.closest('.o_field_cell');return{type:'edit',row:row&&row.dataset.id,subFieldName:row&&field&&field.getAttribute('name'),};},_getRenderer:function(){if(this.view.arch.tag==='tree'){return ListRenderer;}
if(this.view.arch.tag==='kanban'){return KanbanRenderer;}},_hasCreateLine:function(){return!this.hasReadonlyModifier&&((!this.isMany2Many&&this.activeActions.create&&this.canCreate)||(this.isMany2Many&&this.canLink));},_hasTrashIcon:function(){return!this.hasReadonlyModifier&&((!this.isMany2Many&&this.activeActions.delete&&this.canDelete)||(this.isMany2Many&&this.canUnlink));},_removeRecord:function(recordId){this._setValue({operation:this.isMany2Many?'FORGET':'DELETE',ids:[recordId],});},_render:function(){var self=this;if(!this.view){return this._super();}
if(this.renderer){this.currentColInvisibleFields=this._evalColumnInvisibleFields();return this.renderer.updateState(this.value,{addCreateLine:this._hasCreateLine(),addTrashIcon:this._hasTrashIcon(),columnInvisibleFields:this.currentColInvisibleFields,keepWidths:true,}).then(()=>{return this._updateControlPanel({size:this.value.count});});}
var arch=this.view.arch;var viewType;var rendererParams={arch:arch,};if(arch.tag==='tree'){viewType='list';this.currentColInvisibleFields=this._evalColumnInvisibleFields();_.extend(rendererParams,{editable:this.mode==='edit'&&arch.attrs.editable,addCreateLine:this._hasCreateLine(),addTrashIcon:this._hasTrashIcon(),isMany2Many:this.isMany2Many,no_open:((this.isReadonly&&!this.hasReadonlyModifier)&&this._canQuickEdit)||toBoolElse(arch.attrs.no_open||'',false),columnInvisibleFields:this.currentColInvisibleFields,});}
if(arch.tag==='kanban'){viewType='kanban';var record_options={editable:false,deletable:false,read_only_mode:this.isReadonly,};_.extend(rendererParams,{record_options:record_options,readOnlyMode:this.isReadonly,});}
_.extend(rendererParams,{viewType:viewType,});var Renderer=this._getRenderer();this.renderer=new Renderer(this,this.value,rendererParams);this.$el.addClass('o_field_x2many o_field_x2many_'+viewType);if(this.renderer){return this.renderer.appendTo(document.createDocumentFragment()).then(function(){dom.append(self.$el,self.renderer.$el,{in_DOM:self.isInDOM,callbacks:[{widget:self.renderer}],});});}else{return this._super();}},_renderButtons:function(){if(!this.isReadonly&&this.view.arch.tag==='kanban'){const renderingContext=this._getButtonsRenderingContext();this.$buttons=$(qweb.render('KanbanView.buttons',renderingContext));this.$buttons.on('click','button.o-kanban-button-new',this._onAddRecord.bind(this));}},_saveLine:function(recordID){var self=this;return new Promise(function(resolve,reject){var fieldNames=self.renderer.canBeSaved(recordID);if(fieldNames.length){self.trigger_up('discard_changes',{recordID:recordID,onSuccess:resolve,onFailure:reject,});}else{self.renderer.setRowMode(recordID,'readonly').then(resolve);}}).then(async function(){self._updateControlPanel({size:self.value.count});var newEval=self._evalColumnInvisibleFields();if(!_.isEqual(self.currentColInvisibleFields,newEval)){self.currentColInvisibleFields=newEval;self.renderer.updateState(self.value,{columnInvisibleFields:self.currentColInvisibleFields,});}});},_updateControlPanel:function(pagingState){if(this._controlPanelWrapper){this._renderButtons();const pagerProps=Object.assign(this.pagingState,pagingState,{limit:Math.max(this.value.limit,this.value.data.length),});const newProps={cp_content:{$buttons:this.$buttons},pager:pagerProps,};return this._controlPanelWrapper.update(newProps);}},_processColumnInvisibleFields:function(){var columnInvisibleFields={};_.each(this.attrs.columnInvisibleFields,function(domains,fieldName){if(_.isArray(domains)){columnInvisibleFields[fieldName]=_.map(domains,function(domain){if(_.isArray(domain)){return[domain[0].split('.')[1]].concat(domain.slice(1));}
return domain;});}});this.columnInvisibleFields=columnInvisibleFields;},_onAddRecord:function(){},_onRemoveRecord:function(ev){ev.stopPropagation();if(this._canQuickEdit&&this.isReadonly){this.trigger_up('quick_edit',{fieldName:this.name,target:this.el,extraInfo:{type:'remove',recordId:ev.data.id,},});}else{this._removeRecord(ev.data.id);}},_onDiscardChanges:function(ev){if(ev.target!==this){ev.stopPropagation();this.trigger_up('discard_changes',_.extend({},ev.data,{fieldName:this.name}));}},_onEditLine:function(ev){ev.stopPropagation();this.trigger_up('edited_list',{id:this.value.id});this.renderer.setRowMode(ev.data.recordId,'edit').then(ev.data.onSuccess);},_onFieldChanged:function(ev){if(ev.target===this){ev.initialEvent=this.lastInitialEvent;return;}
ev.stopPropagation();var changes=ev.data.changes;this.lastInitialEvent=undefined;if(Object.keys(changes).length){this.lastInitialEvent=ev;this._setValue({operation:'UPDATE',id:ev.data.dataPointID,data:changes,}).then(function(){if(ev.data.onSuccess){ev.data.onSuccess();}}).guardedCatch(function(reason){if(ev.data.onFailure){ev.data.onFailure(reason);}});}},_onNavigationMove:function(ev){if(this.view.arch.tag==='tree'){var $curControl=this.renderer.$('.o_field_x2many_list_row_add a:focus');if($curControl.length){var $nextControl;if(ev.data.direction==='right'){$nextControl=$curControl.next('a');}else if(ev.data.direction==='left'){$nextControl=$curControl.prev('a');}
if($nextControl&&$nextControl.length){ev.stopPropagation();$nextControl.focus();return;}}}
this._super.apply(this,arguments);},_onOpenRecord:function(){},_onPagerChanged:function(ev){ev.stopPropagation();const{currentMinimum,limit}=ev.data;this._updateControlPanel({currentMinimum,limit});this.trigger_up('load',{id:this.value.id,limit,offset:currentMinimum-1,on_success:value=>{this.value=value;this.pagingState.limit=value.limit;this.pagingState.size=value.count;this._render();},});},_onSaveLine:function(ev){var self=this;ev.stopPropagation();this.renderer.commitChanges(ev.data.recordID).then(function(){self.trigger_up('mutexify',{action:function(){return self._saveLine(ev.data.recordID).then(ev.data.onSuccess).guardedCatch(ev.data.onFailure);},});});},_onSaveOrLoadOptionalFields:function(ev){ev.data.keyParts.relationalField=this.name;ev.data.keyParts.subViewId=this.view.view_id;ev.data.keyParts.subViewType=this.view.type;},_onResequenceRecords:function(ev){ev.stopPropagation();var self=this;if(this.view.arch.tag==='tree'){this.trigger_up('edited_list',{id:this.value.id});}
var handleField=ev.data.handleField;var offset=ev.data.offset;var recordIds=ev.data.recordIds.slice();var recordId=recordIds.pop();var proms=recordIds.map(function(recordId,index){var data={};data[handleField]=offset+index;return self._setValue({operation:'UPDATE',id:recordId,data:data,},{notifyChange:false,});});Promise.all(proms).then(function(){function always(){if(self.view.arch.tag==='tree'){self.trigger_up('toggle_column_order',{id:self.value.id,name:handleField,});}}
var data={};data[handleField]=offset+recordIds.length;self._setValue({operation:'UPDATE',id:recordId,data:data,}).then(always).guardedCatch(always);});},_onToggleColumnOrder:function(ev){ev.data.field=this.name;},_onActiveNextWidget:function(e){e.stopPropagation();this.renderer.unselectRow();this.trigger_up('navigation_move',{direction:e.data.direction||'next',});},});var One2ManyKanbanRecord=KanbanRecord.extend({_postProcessObjectButtons:function(){var self=this;if(!this.state.res_id){this.$('.oe_kanban_action[data-type=object]').each(function(index,button){var $button=$(button);if($button.attr('warn')){$button.on('click',function(e){e.stopPropagation();self.displayNotification({message:_t('Please click on the "save" button first'),type:'danger'});});}else{$button.attr('disabled','disabled');}});}},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self._postProcessObjectButtons();});},});var One2ManyKanbanRenderer=KanbanRenderer.extend({config:_.extend({},KanbanRenderer.prototype.config,{KanbanRecord:One2ManyKanbanRecord,}),});var FieldOne2Many=FieldX2Many.extend({description:_lt("One2many"),className:'o_field_one2many',supportedFieldTypes:['one2many'],init:function(){this._super.apply(this,arguments);this.creatingRecord=false;},reset:function(record,ev){var self=this;return this._super.apply(this,arguments).then(()=>{if(ev&&ev.target===self&&ev.data.changes&&self.view.arch.tag==='tree'){if(ev.data.changes[self.name]&&ev.data.changes[self.name].operation==='CREATE'){var index=0;if(self.editable!=='top'){index=self.value.data.length-1;}
var newID=self.value.data[index].id;return self.renderer.editRecord(newID);}}});},_addCreateRecordRow(data){const self=this;if(this.editable||data.forceEditable){if(!this.activeActions.create){if(data.onFail){data.onFail();}}else if(!this.creatingRecord){this.creatingRecord=true;this.trigger_up('edited_list',{id:this.value.id});this._setValue({operation:'CREATE',position:this.editable||data.forceEditable,context:data.context,},{allowWarning:data.allowWarning}).then(function(){self.creatingRecord=false;}).then(function(){if(data.onSuccess){data.onSuccess();}}).guardedCatch(function(){self.creatingRecord=false;});}}else{this._openFormDialog({context:data.context&&data.context[0],disable_multiple_selection:data.disable_multiple_selection,on_saved:function(record){self._setValue({operation:'ADD',id:record.id});},});}},_quickEdit:function(extraInfo){if(extraInfo.type==='add'){this._addCreateRecordRow(extraInfo.data);}else{this._super(...arguments);}},_getButtonsRenderingContext(){const renderingContext=this._super(...arguments);renderingContext.noCreate=!this.canCreate;return renderingContext;},_getRenderer:function(){if(this.view.arch.tag==='kanban'){return One2ManyKanbanRenderer;}
return this._super.apply(this,arguments);},_renderButtons:function(){if(this.activeActions.create){return this._super(...arguments);}},_openFormDialog:function(params){var context=this.record.getContext(_.extend({},this.recordParams,{additionalContext:params.context}));if(this.nodeOptions.no_open){return;}
this.trigger_up('open_one2many_record',_.extend(params,{domain:this.record.getDomain(this.recordParams),context:context,field:this.field,fields_view:this.attrs.views&&this.attrs.views.form,parentID:this.value.id,viewInfo:this.view,deletable:this.activeActions.delete&&params.deletable&&this.canDelete,editable:!this.hasReadonlyModifier,disable_multiple_selection:params.disable_multiple_selection,}));},_onAddRecord:function(ev){const data=ev.data||{};ev.stopPropagation();if(this._canQuickEdit&&this.isReadonly){this.trigger_up('quick_edit',{fieldName:this.name,target:this.el,extraInfo:{type:'add',data},});}else{this._addCreateRecordRow(data);}},_onOpenRecord:function(ev){var self=this;ev.stopPropagation();var id=ev.data.id;var onSaved=function(record){if(_.some(self.value.data,{id:record.id})){self._setValue({operation:'UPDATE',id:record.id});}else{self._setValue({operation:'ADD',id:record.id});}};this._openFormDialog({id:id,on_saved:onSaved,on_remove:function(){self._setValue({operation:'DELETE',ids:[id]});},deletable:this.activeActions.delete&&this.view.arch.tag!=='tree'&&this.canDelete,readonly:this.mode==='readonly',});},});var FieldMany2Many=FieldX2Many.extend({description:_lt("Many2many"),className:'o_field_many2many',supportedFieldTypes:['many2many'],onAddRecordOpenDialog:function(){var self=this;var domain=this.record.getDomain({fieldName:this.name});new dialogs.SelectCreateDialog(this,{res_model:this.field.relation,domain:domain.concat(["!",["id","in",this.value.res_ids]]),context:this.record.getContext(this.recordParams),title:_t("Add: ")+this.string,no_create:this.nodeOptions.no_create||!this.activeActions.create||!this.canCreate,fields_view:this.attrs.views.form,kanban_view_ref:this.attrs.kanban_view_ref,on_selected:function(records){var resIDs=_.pluck(records,'id');var newIDs=_.difference(resIDs,self.value.res_ids);if(newIDs.length){var values=_.map(newIDs,function(id){return{id:id};});self._setValue({operation:'ADD_M2M',ids:values,});}}}).open();},_getButtonsRenderingContext(){const renderingContext=this._super(...arguments);renderingContext.noCreate=!this.canLink;return renderingContext;},_quickEdit:function(extraInfo){if(extraInfo.type==='add'){this.onAddRecordOpenDialog();}else{this._super(...arguments);}},_onAddRecord:function(ev){ev.stopPropagation();if(this._canQuickEdit&&this.isReadonly){this.trigger_up('quick_edit',{fieldName:this.name,target:this.el,extraInfo:{type:'add'},});}else{this.onAddRecordOpenDialog();}},_onOpenRecord:function(ev){var self=this;_.extend(ev.data,{context:this.record.getContext(this.recordParams),domain:this.record.getDomain(this.recordParams),fields_view:this.attrs.views&&this.attrs.views.form,on_saved:function(){self._setValue({operation:'TRIGGER_ONCHANGE'},{forceChange:true}).then(function(){self.trigger_up('reload',{db_id:ev.data.id});});},on_remove:function(){self._setValue({operation:'FORGET',ids:[ev.data.id]});},readonly:this.mode==='readonly',deletable:this.activeActions.delete&&this.view.arch.tag!=='tree'&&this.canDelete,string:this.string,});},});var FieldMany2ManyBinaryMultiFiles=AbstractField.extend({template:"FieldBinaryFileUploader",template_files:"FieldBinaryFileUploader.files",supportedFieldTypes:['many2many'],fieldsToFetch:{name:{type:'char'},mimetype:{type:'char'},},events:{'click .o_attach':'_onAttach','click .o_attachment_delete':'_onDelete','change .o_input_file':'_onFileChanged',},init:function(){this._super.apply(this,arguments);if(this.field.type!=='many2many'||this.field.relation!=='ir.attachment'){var msg=_t("The type of the field '%s' must be a many2many field with a relation to 'ir.attachment' model.");throw _.str.sprintf(msg,this.field.string);}
this.uploadedFiles={};this.uploadingFiles=[];this.fileupload_id=_.uniqueId('oe_fileupload_temp');this.accepted_file_extensions=(this.nodeOptions&&this.nodeOptions.accepted_file_extensions)||this.accepted_file_extensions||'*';$(window).on(this.fileupload_id,this._onFileLoaded.bind(this));this.metadata={};},destroy:function(){this._super();$(window).off(this.fileupload_id);},_getFileUrl:function(attachment){return'/web/content/'+attachment.id+'?download=true';},_generatedMetadata:function(){var self=this;_.each(this.value.data,function(record){self.metadata[record.id]={allowUnlink:self.uploadedFiles[record.data.id]||false,url:self._getFileUrl(record.data),};});},_render:function(){this._generatedMetadata();this.$('.oe_placeholder_files, .o_attachments').replaceWith($(qweb.render(this.template_files,{widget:this,})));this.$('.oe_fileupload').show();this.$('.o_image[data-mimetype^="image"]').each(function(){var $img=$(this);if(/gif|jpe|jpg|png/.test($img.data('mimetype'))&&$img.data('src')){$img.css('background-image',"url('"+$img.data('src')+"')");}});},_onAttach:function(){this.$('.o_input_file').click();},_onDelete:function(ev){ev.preventDefault();ev.stopPropagation();var fileID=$(ev.currentTarget).data('id');var record=_.findWhere(this.value.data,{res_id:fileID});if(record){this._setValue({operation:'FORGET',ids:[record.id],});var metadata=this.metadata[record.id];if(!metadata||metadata.allowUnlink){this._rpc({model:'ir.attachment',method:'unlink',args:[record.res_id],});}}},_onFileChanged:function(ev){var self=this;ev.stopPropagation();var files=ev.target.files;var attachment_ids=this.value.res_ids;if(files.length===0)
return;_.each(files,function(file){var record=_.find(self.value.data,function(attachment){return attachment.data.name===file.name;});if(record){var metadata=self.metadata[record.id];if(!metadata||metadata.allowUnlink){attachment_ids=_.without(attachment_ids,record.res_id);self._rpc({model:'ir.attachment',method:'unlink',args:[record.res_id],});}}
self.uploadingFiles.push(file);});this._setValue({operation:'REPLACE_WITH',ids:attachment_ids,});this.$('form.o_form_binary_form').submit();this.$('.oe_fileupload').hide();ev.target.value="";},_onFileLoaded:function(){var self=this;var files=Array.prototype.slice.call(arguments,1);this.uploadingFiles=[];var attachment_ids=this.value.res_ids;_.each(files,function(file){if(file.error){self.displayNotification({title:_t('Uploading Error'),message:file.error,type:'danger'});}else{attachment_ids.push(file.id);self.uploadedFiles[file.id]=true;}});this._setValue({operation:'REPLACE_WITH',ids:attachment_ids,});},});var FieldMany2ManyTags=AbstractField.extend({description:_lt("Tags"),tag_template:"FieldMany2ManyTag",className:"o_field_many2manytags",supportedFieldTypes:['many2many'],custom_events:_.extend({},AbstractField.prototype.custom_events,{field_changed:'_onFieldChanged',}),events:_.extend({},AbstractField.prototype.events,{'click .o_delete':'_onDeleteTag',}),fieldsToFetch:{display_name:{type:'char'},},limit:1000,init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.className+=' o_input';}
this.colorField=this.nodeOptions.color_field;this.hasDropdown=false;this._computeAvailableActions(this.record);this.resetOnAnyFieldChange=this.resetOnAnyFieldChange||'create'in this.nodeOptions;},activate:function(){return this.many2one?this.many2one.activate():false;},getFocusableElement:function(){return this.many2one?this.many2one.getFocusableElement():$();},isSet:function(){return!!this.value&&this.value.count;},reset:function(record,event){var self=this;this._computeAvailableActions(record);return this._super.apply(this,arguments).then(function(){if(event&&event.target===self){self.activate();}});},_addTag:function(data){if(!_.contains(this.value.res_ids,data.id)){return this._setValue({operation:'ADD_M2M',ids:data});}
return Promise.resolve();},_computeAvailableActions:function(record){const evalContext=record.evalContext;this.canCreate='create'in this.nodeOptions?new Domain(this.nodeOptions.create,evalContext).compute(evalContext):true;},_getRenderTagsContext:function(){var elements=this.value?_.pluck(this.value.data,'data'):[];return{colorField:this.colorField,elements:elements,hasDropdown:this.hasDropdown,readonly:this.mode==="readonly",};},_removeTag:function(id){var record=_.findWhere(this.value.data,{res_id:id});this._setValue({operation:'FORGET',ids:[record.id],});},_renderEdit:function(){var self=this;this._renderTags();if(this.many2one){this.many2one.destroy();}
this.many2one=new FieldMany2One(this,this.name,this.record,{mode:'edit',noOpen:true,noCreate:!this.canCreate,viewType:this.viewType,attrs:this.attrs,});this.many2one.value=false;this.many2one.m2o_value='';this.many2one._getSearchBlacklist=function(){return self.value.res_ids;};var _getSearchCreatePopupOptions=this.many2one._getSearchCreatePopupOptions;this.many2one._getSearchCreatePopupOptions=function(view,ids,context,dynamicFilters){var options=_getSearchCreatePopupOptions.apply(this,arguments);var domain=this.record.getDomain({fieldName:this.name});var m2mRecords=[];return _.extend({},options,{domain:domain.concat(["!",["id","in",self.value.res_ids]]),disable_multiple_selection:false,on_selected:function(records){m2mRecords.push(...records);},on_closed:function(){self.many2one.reinitialize(m2mRecords);},});};return this.many2one.appendTo(this.$el);},_renderReadonly:function(){this._renderTags();},_renderTags:function(){this.$el.html(qweb.render(this.tag_template,this._getRenderTagsContext()));},_onDeleteTag:function(event){event.preventDefault();event.stopPropagation();this._removeTag($(event.target).parent().data('id'));},_onFieldChanged:function(ev){if(ev.target!==this.many2one){return;}
ev.stopPropagation();var newValue=ev.data.changes[this.name];if(newValue){this._addTag(newValue).then(ev.data.onSuccess||function(){}).guardedCatch(ev.data.onFailure||function(){});this.many2one.reinitialize(false);}},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.BACKSPACE&&this.$('input').val()===""){var $badges=this.$('.badge');if($badges.length){this._removeTag($badges.last().data('id'));return;}}
this._super.apply(this,arguments);},_onQuickCreate:function(event){this._quickCreate(event.data.value);},});var FieldMany2ManyTagsAvatar=FieldMany2ManyTags.extend({tag_template:'FieldMany2ManyTagAvatar',className:'o_field_many2manytags avatar',_getRenderTagsContext:function(){var result=this._super.apply(this,arguments);result.avatarModel=this.nodeOptions.avatarModel||this.field.relation;result.avatarField=this.nodeOptions.avatarField||'avatar_128';return result;},});const{click,...M2MAvatarMixinEvents}=AbstractField.prototype.events;const M2MAvatarMixin={visibleAvatarCount:3,events:M2MAvatarMixinEvents,_bindPopover(ev){this.$('.o_m2m_avatar_empty').popover({container:this.$el,trigger:'hover',html:true,placement:'auto',content:()=>{const elements=this.value?_.pluck(this.value.data,'data'):[];return qweb.render('Many2ManyTagAvatarPopover',{elements:elements.slice(this.visibleAvatarCount-1),});},});},_getRenderTagsContext(){const result=this._super(...arguments);result['widget']=this;return result;},_renderReadonly(){this.$el.addClass('o_field_many2manytags_multi');return this._super(...arguments);},_renderTags(){this._super(...arguments);this._bindPopover();},}
const KanbanMany2ManyTagsAvatar=FieldMany2ManyTagsAvatar.extend(M2MAvatarMixin,{tag_template:'KanbanMany2ManyTagAvatar',});const ListMany2ManyTagsAvatar=FieldMany2ManyTagsAvatar.extend(M2MAvatarMixin,{tag_template:'ListMany2ManyTagAvatar',visibleAvatarCount:5,});var FormFieldMany2ManyTags=FieldMany2ManyTags.extend({events:_.extend({},FieldMany2ManyTags.prototype.events,{'click .dropdown-toggle':'_onOpenColorPicker','mousedown .o_colorpicker a':'_onUpdateColor','mousedown .o_colorpicker .o_hide_in_kanban':'_onUpdateColor',}),isQuickEditable:true,quickEditExclusion:['.dropdown-toggle'],init:function(){this._super.apply(this,arguments);this.hasDropdown=!!this.colorField;this._canQuickEdit=!this.nodeOptions.no_edit_color;},_quickEdit:function(){this._super(...arguments);this.many2one.$input.click();},_onOpenColorPicker:function(ev){ev.preventDefault();if(this.nodeOptions.no_edit_color){ev.stopPropagation();return;}
var tagID=$(ev.currentTarget).parent().data('id');var tagColor=$(ev.currentTarget).parent().data('color');var tag=_.findWhere(this.value.data,{res_id:tagID});if(tag&&this.colorField in tag.data){this.$color_picker=$(qweb.render('FieldMany2ManyTag.colorpicker',{'widget':this,'tag_id':tagID,}));$(ev.currentTarget).after(this.$color_picker);this.$color_picker.dropdown();this.$color_picker.attr("tabindex",1).focus();if(!tagColor){this.$('.custom-checkbox input').prop('checked',true);}}},_onUpdateColor:function(ev){ev.preventDefault();var $target=$(ev.currentTarget);var color=$target.data('color');var id=$target.data('id');var $tag=this.$(".badge[data-id='"+id+"']");var currentColor=$tag.data('color');var changes={};if($target.is('.o_hide_in_kanban')){var $checkbox=$('.o_hide_in_kanban .custom-checkbox input');$checkbox.prop('checked',!$checkbox.prop('checked'));this.prevColors=this.prevColors?this.prevColors:{};if($checkbox.is(':checked')){this.prevColors[id]=currentColor;}else{color=this.prevColors[id]?this.prevColors[id]:1;}}else if($target.is('[class^="o_tag_color"]')){if(color===currentColor){return;}}
changes[this.colorField]=color;this.trigger_up('field_changed',{dataPointID:_.findWhere(this.value.data,{res_id:id}).id,changes:changes,force_save:true,});},});var KanbanFieldMany2ManyTags=FieldMany2ManyTags.extend({events:_.omit(AbstractField.prototype.events,'click'),_render:function(){var self=this;if(this.$el){this.$el.empty().addClass('o_field_many2manytags o_kanban_tags');}
_.each(this.value.data,function(m2m){if(self.colorField in m2m.data&&!m2m.data[self.colorField]){return;}
$('<span>',{class:'o_tag o_tag_color_'+(m2m.data[self.colorField]||0),text:m2m.data.display_name,}).prepend('<span>').appendTo(self.$el);});},});var FieldMany2ManyCheckBoxes=AbstractField.extend({description:_lt("Checkboxes"),template:'FieldMany2ManyCheckBoxes',events:_.extend({},AbstractField.prototype.events,{change:'_onChange',}),specialData:"_fetchSpecialRelation",supportedFieldTypes:['many2many'],isQuickEditable:true,limit:100000,init:function(){this._super.apply(this,arguments);this.m2mValues=this.record.specialData[this.name];},getFocusableElement:function(){return this.$el;},isSet:function(){return true;},_getQuickEditExtraInfo(e){const ids=new Set(this.value.res_ids);let input=$(e.target);if(e.target.matches('label')){input=this.$(`input#${e.target.getAttribute('for')}`);}
const id=input.data('record-id');if(ids.has(id)){ids.delete(id);}else{ids.add(id);}
return{ids:Array.from(ids),};},_quickEdit(extraInfo){if(extraInfo.hasOwnProperty('ids')){this._setValue({operation:'REPLACE_WITH',ids:extraInfo.ids,});}},_render:function(){var self=this;this.m2mValues=this.record.specialData[this.name];this.$el.html(qweb.render(this.template,{widget:this}));_.each(this.value.res_ids,function(id){self.$('input[data-record-id="'+id+'"]').prop('checked',true);});this.$("input").prop("disabled",this.hasReadonlyModifier);},_onChange:function(){if(this.mode!=='readonly'){var ids=_.map(this.$('input:checked'),function(input){return $(input).data("record-id");});const displayedIds=this.m2mValues.map(v=>v[0]);const idsInRelation=this.value.res_ids;ids=ids.concat(idsInRelation.filter(a=>!displayedIds.includes(a)));this._setValue({operation:'REPLACE_WITH',ids:ids,});}},});var FieldStatus=AbstractField.extend({className:'o_statusbar_status',events:{'click button:not(.dropdown-toggle)':'_onClickStage',},specialData:"_fetchSpecialStatus",supportedFieldTypes:['selection','many2one'],init:function(){this._super.apply(this,arguments);this._setState();this._onClickStage=_.debounce(this._onClickStage,300,true);try{this.isClickable=!!JSON.parse(this.attrs.clickable);}catch(_){this.isClickable=!!this.nodeOptions.clickable;}},isEmpty:function(){return false;},_reset:function(){this._super.apply(this,arguments);this._setState();},_setState:function(){var self=this;if(this.field.type==='many2one'){this.status_information=_.map(this.record.specialData[this.name],function(info){return _.extend({selected:info.id===self.value.res_id,},info);});}else{var selection=this.field.selection;if(this.attrs.statusbar_visible){var restriction=this.attrs.statusbar_visible.split(",");selection=_.filter(selection,function(val){return _.contains(restriction,val[0])||val[0]===self.value;});}
this.status_information=_.map(selection,function(val){return{id:val[0],display_name:val[1],selected:val[0]===self.value,fold:false};});}},_render:function(){var selections=_.partition(this.status_information,function(info){return(info.selected||!info.fold);});this.$el.html(qweb.render("FieldStatus.content",{selection_unfolded:selections[0],selection_folded:selections[1],clickable:this.isClickable,}));},_onClickStage:function(e){this._setValue($(e.currentTarget).data("value"));},});var FieldSelection=AbstractField.extend({description:_lt("Selection"),template:'FieldSelection',specialData:"_fetchSpecialRelation",supportedFieldTypes:['selection'],events:_.extend({},AbstractField.prototype.events,{'change':'_onChange',}),isQuickEditable:true,init:function(){this._super.apply(this,arguments);this._setValues();},getFocusableElement:function(){return this.$el&&this.$el.is('select')?this.$el:$();},isSet:function(){return this.value!==false;},updateModifiersValue:function(){this._super.apply(this,arguments);if(!this.attrs.modifiersValue.invisible&&this.mode!=='readonly'){this._setValues();this._render();}},_renderEdit:function(){this.$el.empty();var required=this.attrs.modifiersValue&&this.attrs.modifiersValue.required;for(var i=0;i<this.values.length;i++){var disabled=required&&this.values[i][0]===false;this.$el.append($('<option/>',{value:JSON.stringify(this.values[i][0]),text:this.values[i][1],style:disabled?"display: none":"",}));}
this.$el.val(JSON.stringify(this._getRawValue()));},_renderReadonly:function(){this.$el.empty().text(this._formatValue(this.value));this.$el.attr('raw-value',this._getRawValue());},_getRawValue:function(){var raw_value=this.value;if(this.field.type==='many2one'&&raw_value){raw_value=raw_value.data.id;}
return raw_value;},_reset:function(){this._super.apply(this,arguments);this._setValues();},_setValues:function(){if(this.field.type==='many2one'){this.values=this.record.specialData[this.name];this.formatType='many2one';}else{this.values=_.reject(this.field.selection,function(v){return v[0]===false&&v[1]==='';});}
this.values=[[false,this.attrs.placeholder||'']].concat(this.values);},_onChange:function(){var res_id=JSON.parse(this.$el.val());if(this.field.type==='many2one'){var value=_.find(this.values,function(val){return val[0]===res_id;});this._setValue({id:res_id,display_name:value[1]});}else{this._setValue(res_id);}},});var FieldRadio=FieldSelection.extend({description:_lt("Radio"),template:null,className:'o_field_radio',tagName:'div',specialData:"_fetchSpecialMany2ones",supportedFieldTypes:['selection','many2one'],events:_.extend({},AbstractField.prototype.events,{'click input':'_onInputClick',}),isQuickEditable:true,init:function(){this._super.apply(this,arguments);this.className+=this.nodeOptions.horizontal?' o_horizontal':' o_vertical';this.unique_id=_.uniqueId("radio");this._setValues();},getFocusableElement:function(){var checked=this.$("[checked='true']");return checked.length?checked:this.$("[data-index='0']");},isSet:function(){return true;},setIDForLabel:function(id){this.$el.attr('id',id);},_getQuickEditExtraInfo:function(ev){const $target=ev.target.nodeName==='INPUT'?$(ev.target):$(ev.target).siblings('input');const index=$target.data('index');const value=this.values[index];return{value};},_quickEdit:function(extraInfo){if(extraInfo.value){this._saveValue(extraInfo.value);}
return this._super.apply(this,arguments);},_render:function(){var self=this;var currentValue;if(this.field.type==='many2one'){currentValue=this.value&&this.value.data.id;}else{currentValue=this.value;}
this.$el.empty();this.$el.attr('role','radiogroup').attr('aria-label',this.string);_.each(this.values,function(value,index){self.$el.append(qweb.render('FieldRadio.button',{checked:value[0]===currentValue,id:self.unique_id+'_'+value[0],index:index,name:self.unique_id,value:value,disabled:self.hasReadonlyModifier,}));});},_reset:function(){this._super.apply(this,arguments);this._setValues();},_setValues:function(){if(this.field.type==='selection'){this.values=this.field.selection||[];}else if(this.field.type==='many2one'){this.values=_.map(this.record.specialData[this.name],function(val){return[val.id,val.display_name];});}},_saveValue:function(value){if(this.field.type==='many2one'){this._setValue({id:value[0],display_name:value[1]});}else{this._setValue(value[0]);}},_onInputClick:function(event){if(this.mode==='readonly'){this._onClick(...arguments);}else{const index=$(event.currentTarget).data('index');const value=this.values[index];this._saveValue(value);}},});var FieldSelectionBadge=FieldSelection.extend({description:_lt("Badges"),template:null,className:'o_field_selection_badge',tagName:'span',specialData:"_fetchSpecialMany2ones",events:_.extend({},AbstractField.prototype.events,{'click span.o_selection_badge':'_onBadgeClicked',}),_renderEdit:function(){this.currentValue=this.value;if(this.field.type==='many2one'){this.currentValue=this.value&&this.value.data.id;}
this.$el.empty();this.$el.html(qweb.render('FieldSelectionBadge',{'values':this.values,'current_value':this.currentValue}));},_setValues:function(){if(this.field.type==='selection'){this.values=this.field.selection||[];}else if(this.field.type==='many2one'){this.values=_.map(this.record.specialData[this.name],function(val){return[val.id,val.display_name];});}},_onBadgeClicked:function(event){var index=$(event.target).data('index');var value=this.values[index];if(value[0]!==this.currentValue){if(this.field.type==='many2one'){this._setValue({id:value[0],display_name:value[1]});}else{this._setValue(value[0]);}}else{this._setValue(false);}},});var FieldSelectionFont=FieldSelection.extend({_renderEdit:function(){this._super.apply(this,arguments);this.$('option').each(function(i,option){if(!option.label){$(option).remove();}
$(option).css('font-family',option.value);});this.$el.css('font-family',this.value);},});var FieldReference=FieldMany2One.extend({specialData:"_fetchSpecialReference",supportedFieldTypes:['reference'],template:'FieldReference',events:_.extend({},FieldMany2One.prototype.events,{'change select':'_onSelectionChange',}),init:function(){this._super.apply(this,arguments);this.field=_.extend({},this.field);this.resetOnAnyFieldChange=this.resetOnAnyFieldChange||this.nodeOptions.model_field;this._setState(false);},start:function(){this.modelName=this.field.relation;if(this.el.querySelector('select')){this.el.querySelector('select').value=this.modelName;}
return this._super.apply(this,arguments);},getFocusableElement:function(){if(this.mode==='edit'&&!this.field.relation){return this.$('select');}
return this._super.apply(this,arguments);},_formatValue:function(){var value;if(this.field.type==='char'){value=this.record.specialData[this.name];}else{value=this.value;}
return value&&value.data&&value.data.display_name||'';},_applyModelField:function(initRecord){let resourceRef=this.record.specialData[this.name];if(resourceRef){if(initRecord&&resourceRef.hasChanged&&resourceRef.modelName!==this.modelName){this.reinitialize(false);}
this.modelName=resourceRef.modelName;}},_renderEdit:function(){this._super.apply(this,arguments);if(this.modelName){this.$('.o_input_dropdown').show();if(!this.nodeOptions.model_field){if(this.nodeOptions.hide_model){this.$el.addClass('o_row');}
this.$el.find('.o_field_many2one_selection').addClass('o_row');}}else{this.$('.o_input_dropdown').hide();}},_reset:function(){this._super.apply(this,arguments);this._setState(true);if(this.el.querySelector('select')){this.el.querySelector('select').value=this.modelName;}},_setRelation:function(model){this.field.relation=model;},_setState:function(initRecord){if(this.field.type==='char'){this.value=this.record.specialData[this.name];}
if(this.nodeOptions.model_field){this._applyModelField(initRecord);}
if(this.value&&this.value.model){this.modelName=this.value.model;}
if(this.modelName){this._setRelation(this.modelName);}},_setValue:function(value,options){value=value||{};value.model=this.modelName;return this._super(value,options);},_onSelectionChange:function(){this.modelName=this.el.querySelector('select').value||'';this.reinitialize(false);this._setRelation(this.modelName);},});return{FieldMany2One:FieldMany2One,Many2oneBarcode:Many2oneBarcode,KanbanFieldMany2One:KanbanFieldMany2One,ListFieldMany2One:ListFieldMany2One,Many2OneAvatar:Many2OneAvatar,FieldX2Many:FieldX2Many,FieldOne2Many:FieldOne2Many,FieldMany2Many:FieldMany2Many,FieldMany2ManyBinaryMultiFiles:FieldMany2ManyBinaryMultiFiles,FieldMany2ManyCheckBoxes:FieldMany2ManyCheckBoxes,FieldMany2ManyTags:FieldMany2ManyTags,FieldMany2ManyTagsAvatar:FieldMany2ManyTagsAvatar,KanbanMany2ManyTagsAvatar:KanbanMany2ManyTagsAvatar,ListMany2ManyTagsAvatar:ListMany2ManyTagsAvatar,FormFieldMany2ManyTags:FormFieldMany2ManyTags,KanbanFieldMany2ManyTags:KanbanFieldMany2ManyTags,FieldRadio:FieldRadio,FieldSelectionBadge:FieldSelectionBadge,FieldSelection:FieldSelection,FieldStatus:FieldStatus,FieldSelectionFont:FieldSelectionFont,FieldReference:FieldReference,};});;

/* /web/static/src/legacy/js/fields/signature.js defined in bundle 'web.assets_backend' */
odoo.define('web.Signature',function(require){"use strict";var AbstractFieldBinary=require('web.basic_fields').AbstractFieldBinary;var core=require('web.core');var field_utils=require('web.field_utils');var registry=require('web.field_registry');var session=require('web.session');const SignatureDialog=require('web.signature_dialog');var utils=require('web.utils');var qweb=core.qweb;var _t=core._t;var _lt=core._lt;var FieldBinarySignature=AbstractFieldBinary.extend({description:_lt("Signature"),fieldDependencies:_.extend({},AbstractFieldBinary.prototype.fieldDependencies,{__last_update:{type:'datetime'},}),resetOnAnyFieldChange:true,custom_events:_.extend({},AbstractFieldBinary.prototype.custom_events,{upload_signature:'_onUploadSignature',}),events:_.extend({},AbstractFieldBinary.prototype.events,{'click .o_signature':'_onClickSignature',}),template:null,supportedFieldTypes:['binary'],file_type_magic_word:{'/':'jpg','R':'gif','i':'png','P':'svg+xml',},isSet:function(){return this.value;},_render:function(){var self=this;var displaySignatureRatio=3;var url;var $img;var width=this.nodeOptions.size?this.nodeOptions.size[0]:this.attrs.width;var height=this.nodeOptions.size?this.nodeOptions.size[1]:this.attrs.height;if(this.value){if(!utils.is_bin_size(this.value)){url='data:image/'+(this.file_type_magic_word[this.value[0]]||'png')+';base64,'+this.value;}else{url=session.url('/web/image',{model:this.model,id:JSON.stringify(this.res_id),field:this.nodeOptions.preview_image||this.name,unique:field_utils.format.datetime(this.recordData.__last_update).replace(/[^0-9]/g,''),});}
$img=$(qweb.render("FieldBinarySignature-img",{widget:this,url:url}));}else{$img=$('<div class="o_signature o_signature_empty"><svg></svg><p>'+_t('SIGNATURE')+'</p></div>');if(width&&height){width=Math.min(width,displaySignatureRatio*height);height=width/displaySignatureRatio;}else if(width){height=width/displaySignatureRatio;}else if(height){width=height*displaySignatureRatio;}}
if(width){$img.attr('width',width);$img.css('max-width',width+'px');}
if(height){$img.attr('height',height);$img.css('max-height',height+'px');}
this.$('> div').remove();this.$('> img').remove();this.$el.prepend($img);$img.on('error',function(){self._clearFile();$img.attr('src',self.placeholder);self.displayNotification({message:_t("Could not display the selected image"),type:'danger'});});},_onClickSignature:function(){var self=this;if(this.mode==='edit'){var nameAndSignatureOptions={mode:'draw',displaySignatureRatio:3,signatureType:'signature',noInputName:true,};if(this.nodeOptions.full_name){var signName;if(this.fields[this.nodeOptions.full_name].type==='many2one'){signName=this.recordData[this.nodeOptions.full_name]&&this.recordData[this.nodeOptions.full_name].data.display_name;}else{signName=this.recordData[this.nodeOptions.full_name];}
nameAndSignatureOptions.defaultName=(signName==='')?undefined:signName;}
nameAndSignatureOptions.defaultFont=this.nodeOptions.default_font||'';this.signDialog=new SignatureDialog(self,{nameAndSignatureOptions:nameAndSignatureOptions});this.signDialog.open();}},_onUploadSignature:function(ev){var signatureImage=ev.data.signatureImage;if(signatureImage!==this.signDialog.emptySignature){var data=signatureImage[1];var type=signatureImage[0].split('/')[1];this.on_file_uploaded(data.length,ev.data.name,type,data);}
this.signDialog.close();}});registry.add('signature',FieldBinarySignature);});;

/* /web/static/src/legacy/js/fields/special_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.special_fields',function(require){"use strict";var core=require('web.core');var field_utils=require('web.field_utils');var relational_fields=require('web.relational_fields');var AbstractField=require('web.AbstractField');var FieldSelection=relational_fields.FieldSelection;var _t=core._t;var _lt=core._lt;var FieldTimezoneMismatch=FieldSelection.extend({start:function(){var interval=navigator.platform.toUpperCase().indexOf('MAC')>=0?60000:1000;this._datetime=setInterval(this._renderDateTimeTimezone.bind(this),interval);return this._super.apply(this,arguments);},destroy:function(){clearInterval(this._datetime);return this._super();},_render:function(){this._super.apply(this,arguments);this._renderTimezoneMismatch();},_renderDateTimeTimezone:function(){if(!this.mismatch||!this.$option.html()){return;}
var offset=this.recordData.tz_offset.match(/([+-])([0-9]{2})([0-9]{2})/);offset=(offset[1]==='-'?-1:1)*(parseInt(offset[2])*60+parseInt(offset[3]));var datetime=field_utils.format.datetime(moment.utc().add(offset,'minutes'),this.field,{timezone:false});var content=this.$option.html().split(' ')[0];content+='    ('+datetime+')';this.$option.html(content);},_renderTimezoneMismatch:function(){this.$el.last().filter('.o_tz_warning').remove();this.$el=this.$el.first();var value=this.$el.val();var $span=$('<span class="fa fa-exclamation-triangle o_tz_warning"/>');if(this.$option&&this.$option.html()){this.$option.html(this.$option.html().split(' ')[0]);}
var userOffset=this.recordData.tz_offset;this.mismatch=false;if(userOffset&&value!==""&&value!=="false"){var offset=-(new Date().getTimezoneOffset());var browserOffset=(offset<0)?"-":"+";browserOffset+=_.str.sprintf("%02d",Math.abs(offset/60));browserOffset+=_.str.sprintf("%02d",Math.abs(offset%60));this.mismatch=(browserOffset!==userOffset);}
if(this.mismatch){$span.insertAfter(this.$el);if(this.nodeOptions.mismatch_title){$span.attr('title',this.nodeOptions.mismatch_title);}
else{$span.attr('title',_t("Timezone Mismatch : This timezone is different from that of your browser.\nPlease, set the same timezone as your browser's to avoid time discrepancies in your system."));}
this.$el=this.$el.add($span);this.$option=this.$('option').filter(function(){return $(this).attr('value')===value;});this._renderDateTimeTimezone();}else if(value=="false"){$span.insertAfter(this.$el);$span.attr('title',_t("Set a timezone on your user"));this.$el=this.$el.add($span);}},_renderEdit:function(){var $otherEl=this.$el.not('select');this.$el=this.$el.first();this._super.apply(this,arguments);$otherEl.insertAfter(this.$el);this.$el=this.$el.add($otherEl);},});var FieldReportLayout=relational_fields.FieldMany2One.extend({events:_.extend({},relational_fields.FieldMany2One.prototype.events,{'click img':'_onImgClicked',}),willStart:function(){var self=this;this.previews={};return this._super().then(function(){return self._rpc({model:'report.layout',method:"search_read"}).then(function(values){self.previews=values;});});},_render:function(){var self=this;this.$el.empty();var value=_.isObject(this.value)?this.value.data.id:this.value;_.each(this.previews,function(val){var $container=$('<div>').addClass('col-3 text-center');var $img=$('<img>').addClass('img img-fluid img-thumbnail ml16').toggleClass('btn-info',val.view_id[0]===value).attr('src',val.image).data('key',val.view_id[0]);$container.append($img);if(val.pdf){var $previewLink=$('<a>').text('Example').attr('href',val.pdf).attr('target','_blank');$container.append($previewLink);}
self.$el.append($container);});},_onImgClicked:function(event){this._setValue($(event.currentTarget).data('key'));},});const IframeWrapper=AbstractField.extend({description:_lt("Wrap raw html within an iframe"),supportedFieldTypes:['text','html'],template:"web.IframeWrapper",_render(){const spinner=this.el.querySelector('.o_iframe_wrapper_spinner');const iframe=this.el.querySelector('.o_preview_iframe');iframe.style.display='none';spinner.style.display='block';let resolver;$(iframe).data('ready',new Promise((resolve)=>{resolver=resolve;}));const onloadReplacement=setInterval(()=>{const iframeDoc=iframe.contentDocument;if(iframeDoc&&(iframeDoc.readyState==='complete'||iframeDoc.readyState==='interactive')){iframeDoc.open();iframeDoc.write(this.value);iframeDoc.close();iframe.style.display='block';spinner.style.display='none';resolver();clearInterval(onloadReplacement);}},100);}});return{FieldTimezoneMismatch:FieldTimezoneMismatch,FieldReportLayout:FieldReportLayout,IframeWrapper,};});;

/* /web_enterprise/static/src/legacy/js/apps.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.apps',function(require){"use strict";var Apps=require('web.Apps');Apps.include({_on_update_count:function(){},});});;

/* /web/static/src/legacy/js/report/utils.js defined in bundle 'web.assets_backend' */
odoo.define('report.utils',function(require){'use strict';function get_protocol_from_url(url){var a=document.createElement('a');a.href=url;return a.protocol;}
function get_host_from_url(url){var a=document.createElement('a');a.href=url;return a.host;}
function build_origin(protocol,host){return protocol+'//'+host;}
return{'get_protocol_from_url':get_protocol_from_url,'get_host_from_url':get_host_from_url,'build_origin':build_origin,};});;

/* /web/static/src/legacy/js/report/client_action.js defined in bundle 'web.assets_backend' */
odoo.define('report.client_action',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var core=require('web.core');var session=require('web.session');var utils=require('report.utils');var QWeb=core.qweb;var AUTHORIZED_MESSAGES=['report:do_action',];var ReportAction=AbstractAction.extend({hasControlPanel:true,contentTemplate:'report.client_action',init:function(parent,action,options){this._super.apply(this,arguments);options=options||{};this.action_manager=parent;this._title=options.display_name||options.name;this.report_url=options.report_url;this.report_name=options.report_name;this.report_file=options.report_file;this.data=options.data||{};this.context=options.context||{};},start:function(){var self=this;this.iframe=this.$('iframe')[0];this.$buttons=$(QWeb.render('report.client_action.ControlButtons',{}));this.$buttons.on('click','.o_report_print',this.on_click_print);this.controlPanelProps.cp_content={$buttons:this.$buttons,};return Promise.all([this._super.apply(this,arguments),session.is_bound]).then(async function(){var web_base_url=window.origin;var trusted_host=utils.get_host_from_url(web_base_url);var trusted_protocol=utils.get_protocol_from_url(web_base_url);self.trusted_origin=utils.build_origin(trusted_protocol,trusted_host);self.iframe.src=self.report_url;});},on_attach_callback:function(){$(window).on('message',this,this.on_message_received);this._super();},on_detach_callback:function(){$(window).off('message',this.on_message_received);this._super();},on_message_received:function(ev){var message_origin=utils.build_origin(ev.originalEvent.source.location.protocol,ev.originalEvent.source.location.host);if(message_origin===this.trusted_origin){var message=ev.originalEvent.data;if(_.isObject(message)){message=message.message;}
if(!_.isString(message)||(_.isString(message)&&!_.contains(AUTHORIZED_MESSAGES,message))){return;}
switch(message){case'report:do_action':return this.do_action(ev.originalEvent.data.action);default:}}},_post_message:function(message){this.iframe.contentWindow.postMessage(message,this.trusted_origin);},on_click_print:function(){var action={'type':'ir.actions.report','report_type':'qweb-pdf','report_name':this.report_name,'report_file':this.report_file,'data':this.data,'context':this.context,'display_name':this.title,};return this.do_action(action);},});core.action_registry.add('report.client_action',ReportAction);return ReportAction;});;

/* /web/static/src/legacy/js/services/data_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataManager',function(require){"use strict";var config=require('web.config');var core=require('web.core');var rpc=require('web.rpc');var session=require('web.session');var utils=require('web.utils');return core.Class.extend({init:function(){this._init_cache();core.bus.on('clear_cache',this,this.invalidate.bind(this));},_init_cache:function(){this._cache={actions:{},filters:{},views:{},};},invalidate:function(dataManager){if(dataManager===this){return;}
session.invalidateCacheKey('load_menus');this._init_cache();},load_action:function(action_id,additional_context){var self=this;var key=this._gen_key(action_id,additional_context||{});if(config.isDebug('assets')||!this._cache.actions[key]){this._cache.actions[key]=rpc.query({route:"/web/action/load",params:{action_id:action_id,additional_context:additional_context,},}).then(function(action){self._cache.actions[key]=action.no_cache?null:self._cache.actions[key];return action;}).guardedCatch(()=>this._invalidate('actions',key));}
return this._cache.actions[key].then(function(action){return $.extend(true,{},action);});},load_views:async function({model,context,views_descr},options={}){const viewsKey=this._gen_key(model,views_descr,options,context);const filtersKey=this._gen_key(model,options.action_id);const withFilters=Boolean(options.load_filters);const shouldLoadViews=config.isDebug('assets')||!this._cache.views[viewsKey];const shouldLoadFilters=config.isDebug('assets')||(withFilters&&!this._cache.filters[filtersKey]);if(shouldLoadViews){options.load_filters=shouldLoadFilters;this._cache.views[viewsKey]=rpc.query({args:[],kwargs:{context,options,views:views_descr},model,method:'load_views',}).then(result=>{utils.deepFreeze(result.fields);for(const[viewId,viewType]of views_descr){const fvg=result.fields_views[viewType];fvg.viewFields=fvg.fields;fvg.fields=result.fields;}
if(shouldLoadFilters){this._cache.filters[filtersKey]=Promise.resolve(result.filters);}
return result.fields_views;}).guardedCatch(()=>this._invalidate('views',viewsKey));}
const result=await this._cache.views[viewsKey];if(withFilters&&result.search){if(shouldLoadFilters){await this.load_filters({actionId:options.action_id,context,forceReload:false,modelName:model,});}
result.search.favoriteFilters=await this._cache.filters[filtersKey];}
return result;},load_filters:function(params){const key=this._gen_key(params.modelName,params.actionId);const forceReload=params.forceReload!==false&&config.isDebug('assets');if(forceReload||!this._cache.filters[key]){this._cache.filters[key]=rpc.query({args:[params.modelName,params.actionId],kwargs:{context:params.context||{},},model:'ir.filters',method:'get_filters',}).guardedCatch(()=>this._invalidate('filters',key));}
return this._cache.filters[key];},create_filter:function(filter){return rpc.query({args:[filter],model:'ir.filters',method:'create_or_replace',}).then(filterId=>{const filtersKey=this._gen_key(filter.model_id,filter.action_id);this._invalidate('filters',filtersKey);return filterId;});},delete_filter:function(filterId){return rpc.query({args:[filterId],model:'ir.filters',method:'unlink',}).then(()=>this._invalidate('filters'));},_gen_key:function(){return _.map(Array.prototype.slice.call(arguments),function(arg){if(!arg){return false;}
return _.isObject(arg)?JSON.stringify(arg):arg;}).join(',');},_invalidate(section,key){core.bus.trigger("clear_cache",this);if(key){delete this._cache[section][key];}else{this._cache[section]={};}},});});odoo.define('web.data_manager',function(require){"use strict";var DataManager=require('web.DataManager');var data_manager=new DataManager();return data_manager;});;

/* /web/static/src/legacy/js/services/report_service.js defined in bundle 'web.assets_backend' */
odoo.define('web.ReportService',function(require){"use strict";var AbstractService=require('web.AbstractService');var core=require('web.core');var ReportService=AbstractService.extend({dependencies:['ajax'],checkWkhtmltopdf:function(){if(!this.wkhtmltopdfState){this.wkhtmltopdfState=this._rpc({route:'/report/check_wkhtmltopdf'});}
return this.wkhtmltopdfState;},});core.serviceRegistry.add('report',ReportService);return ReportService;});;

/* /web/static/src/legacy/js/services/session.js defined in bundle 'web.assets_backend' */
odoo.define('web.session',function(require){"use strict";var Session=require('web.Session');var session=new Session(undefined,undefined,{use_cors:false});session.is_bound=session.session_bind();return session;});;

/* /web/static/src/legacy/js/tools/tools.js defined in bundle 'web.assets_backend' */
odoo.define('web.tools',function(require){"use strict";function deprecated(fn,message){return function(){console.warn(message||(fn.name+' is deprecated.'));return fn.apply(this,arguments);};}
return{deprecated:deprecated,};});;

/* /web/static/src/legacy/js/views/abstract_controller.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/abstract_controller',async function(require){'use strict';let __exports={};const ActionMixin=require('web.ActionMixin');const ajax=require('web.ajax');const concurrency=require('web.concurrency');const{ComponentWrapper}=require('web.OwlCompatibility');const mvc=require('web.mvc');const session=require('web.session');var AbstractController=mvc.Controller.extend(ActionMixin,{custom_events:_.extend({},ActionMixin.custom_events,{navigation_move:'_onNavigationMove',open_record:'_onOpenRecord',switch_view:'_onSwitchView',}),events:{'click a[type="action"]':'_onActionClicked',},init:function(parent,model,renderer,params){this._super.apply(this,arguments);this._title=params.displayName;this.modelName=params.modelName;this.activeActions=params.activeActions;this.controllerID=params.controllerID;this.initialState=params.initialState;this.bannerRoute=params.bannerRoute;this.actionViews=params.actionViews;this.viewType=params.viewType;this.dp=new concurrency.DropPrevious();this.withControlPanel=params.withControlPanel;this.withSearchPanel=params.withSearchPanel;if(params.searchModel){this.searchModel=params.searchModel;}
if(this.withControlPanel){const{Component,props}=params.controlPanel;this.ControlPanel=Component;this.controlPanelProps=props;}
if(this.withSearchPanel){const{Component,props}=params.searchPanel;this.SearchPanel=Component;this.searchPanelProps=props;}},start:async function(){this.$el.addClass('o_view_controller');this.renderButtons();const promises=[this._super(...arguments)];if(this.withControlPanel){this._updateControlPanelProps(this.initialState);this._controlPanelWrapper=new ComponentWrapper(this,this.ControlPanel,this.controlPanelProps);this._controlPanelWrapper.env.bus.on('focus-view',this,()=>this._giveFocus());promises.push(this._controlPanelWrapper.mount(this.el,{position:'first-child'}));}
if(this.withSearchPanel){this._searchPanelWrapper=new ComponentWrapper(this,this.SearchPanel,this.searchPanelProps);const content=this.el.querySelector(':scope .o_content');content.classList.add('o_controller_with_searchpanel');promises.push(this._searchPanelWrapper.mount(content,{position:'first-child'}));}
await Promise.all(promises);await this._update(this.initialState,{shouldUpdateSearchComponents:false});this.updateButtons();this.el.classList.toggle('o_view_sample_data',this.model.isInSampleMode());},destroy:function(){if(this.$buttons){this.$buttons.off();}
ActionMixin.destroy.call(this);this._super.apply(this,arguments);},on_attach_callback:function(){ActionMixin.on_attach_callback.call(this);this.searchModel.on('search',this,this._onSearch);if(this.withControlPanel){this.searchModel.on('get-controller-query-params',this,this._onGetOwnedQueryParams);}
if(!(this.renderer instanceof owl.Component)){this.renderer.on_attach_callback();}},on_detach_callback:function(){ActionMixin.on_detach_callback.call(this);this.searchModel.off('search',this);if(this.withControlPanel){this.searchModel.off('get-controller-query-params',this);}
if(!(this.renderer instanceof owl.Component)){this.renderer.on_detach_callback();}},discardChanges:function(recordID,options){return Promise.resolve();},exportState(){const exported={searchModel:this.searchModel.exportState(),};if(this.withSearchPanel){const searchPanel=this._searchPanelWrapper.componentRef.comp;exported.searchPanel=searchPanel.exportState();}
return exported;},importState(state){this.searchModel.importState(state.searchModel);if(this.withSearchPanel){const searchPanel=this._searchPanelWrapper.componentRef.comp;searchPanel.importState(state.searchPanel);}},is_action_enabled:function(action){return this.activeActions[action];},reload:async function(params={}){if(params.controllerState){this.importState(params.controllerState);Object.assign(params,this.searchModel.get('query'));}
return this.update(params,{});},async update(params,options={}){const shouldReload='reload'in options?options.reload:true;if(shouldReload){this.handle=await this.dp.add(this.model.reload(this.handle,params));}
const localState=this.renderer.getLocalState();const state=this.model.get(this.handle,{withSampleData:true});const promises=[this._updateRendererState(state,params).then(()=>{this.renderer.setLocalState(localState);}),this._update(this.model.get(this.handle),params)];await this.dp.add(Promise.all(promises));this.updateButtons();this.el.classList.toggle('o_view_sample_data',this.model.isInSampleMode());},_getPagingInfo:function(state){return null;},_getActionMenuItems:function(state){return null;},_giveFocus(){if(!this.model.isInSampleMode()){this.renderer.giveFocus();}},_pushState:function(){this.trigger_up('push_state',{controllerID:this.controllerID,state:this.getState(),});},async _removeSampleData(callback){this.model.leaveSampleMode();if(callback){await callback();}
this.el.classList.remove('o_view_sample_data');},_renderBanner:async function(){if(this.bannerRoute!==undefined){const response=await this._rpc({route:this.bannerRoute,params:{context:session.user_context},});if(!response.html){this.$el.removeClass('o_has_banner');return Promise.resolve();}
this.$el.addClass('o_has_banner');var $banner=$(response.html);if(this._$banner&&this._$banner.remove){this._$banner.remove();}
var defs=[];$('link[rel="stylesheet"]',$banner).each(function(i,link){defs.push(ajax.loadCSS(link.href));link.remove();});$('script[type="text/javascript"]',$banner).each(function(i,js){defs.push(ajax.loadJS(js.src));js.remove();});await Promise.all(defs);$banner.insertBefore(this.$('> .o_content'));this._$banner=$banner;}},_startRenderer:function(){if(this.renderer instanceof owl.Component){return this.renderer.mount(this.$('.o_content')[0]);}
return this.renderer.appendTo(this.$('.o_content'));},async _update(state,params){if(!this.$buttons){this.renderButtons();}
const promises=[this._renderBanner()];if(params.shouldUpdateSearchComponents!==false){if(this.withControlPanel){this._updateControlPanelProps(state);if(params.breadcrumbs){this.controlPanelProps.breadcrumbs=params.breadcrumbs;}
promises.push(this.updateControlPanel());}
if(this.withSearchPanel){this._updateSearchPanel();}}
this._pushState();await Promise.all(promises);},_updateControlPanelProps(state){if(!this.controlPanelProps.cp_content){this.controlPanelProps.cp_content={};}
if(this.$buttons){this.controlPanelProps.cp_content.$buttons=this.$buttons;}
Object.assign(this.controlPanelProps,{actionMenus:this._getActionMenuItems(state),pager:this._getPagingInfo(state),title:this.getTitle(),});},_updatePaging:async function(state,newProps){const pagingInfo=this._getPagingInfo(state);if(pagingInfo){Object.assign(pagingInfo,newProps);return this.updateControlPanel({pager:pagingInfo});}},_updateRendererState(state,params={}){if(this.renderer instanceof owl.Component){return this.renderer.update(state);}
return this.renderer.updateState(state,params);},async _updateSearchPanel(newProps){Object.assign(this.searchPanelProps,newProps);await this._searchPanelWrapper.update(this.searchPanelProps);},_onActionClicked:function(ev){ev.preventDefault();var $target=$(ev.currentTarget);var self=this;var data=$target.data();if(data.method!==undefined&&data.model!==undefined){var options={};if(data.reloadOnClose){options.on_close=function(){self.trigger_up('reload');};}
this.dp.add(this._rpc({model:data.model,method:data.method,context:session.user_context,})).then(function(action){if(action!==undefined){self.do_action(action,options);}});}else if($target.attr('name')){this.do_action($target.attr('name'),data.context&&{additional_context:data.context});}else{this.do_action({name:$target.attr('title')||_.str.strip($target.text()),type:'ir.actions.act_window',res_model:data.model||this.modelName,res_id:data.resId,target:'current',views:data.views||(data.resId?[[false,'form']]:[[false,'list'],[false,'form']]),domain:data.domain||[],},{additional_context:_.extend({},data.context)});}},_onNavigationMove:function(ev){switch(ev.data.direction){case'up':ev.stopPropagation();this.searchModel.trigger('focus-control-panel');break;case'down':ev.stopPropagation();this._giveFocus();break;}},_onOpenRecord:function(ev){ev.stopPropagation();var record=this.model.get(ev.data.id,{raw:true});this.trigger_up('switch_view',{view_type:'form',res_id:record.res_id,mode:ev.data.mode||'readonly',model:this.modelName,});},_onSearch:function(searchQuery){this.reload(_.extend({offset:0,groupsOffset:0},searchQuery));},_onSwitchView:function(ev){ev.data.controllerID=this.controllerID;},});__exports[Symbol.for("default")]=AbstractController;return __exports;});odoo.define(`web.AbstractController`,async function(require){return require('@web/legacy/js/views/abstract_controller')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/abstract_model.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/abstract_model',async function(require){'use strict';let __exports={};const fieldUtils=require('web.field_utils');const mvc=require('web.mvc');const SampleServer=require('web.SampleServer');var AbstractModel=mvc.Model.extend({init(parent,params={}){this._super(...arguments);this.useSampleModel=params.useSampleModel||false;if(params.isSampleModel){this.isSampleModel=true;this.sampleServer=new SampleServer(params.modelName,params.fields);}else if(this.useSampleModel){const sampleModelParams=Object.assign({},params,{isSampleModel:true,SampleModel:null,useSampleModel:false,});this.sampleModel=new params.SampleModel(this,sampleModelParams);this._isInSampleMode=false;}},get(_,options){let state;if(options&&options.withSampleData&&this._isInSampleMode){state=this.sampleModel.__get(...arguments);}else{state=this.__get(...arguments);}
return state;},isInSampleMode(){return!!this._isInSampleMode;},leaveSampleMode(){if(this.useSampleModel){this.useSampleModel=false;this._isInSampleMode=false;this.sampleModel.destroy();}},async load(params){this.loadParams=params;const handle=await this.__load(...arguments);await this._callSampleModel('__load',handle,...arguments);return handle;},async reload(_,params){const handle=await this.__reload(...arguments);if(this._isInSampleMode){if(!this._haveParamsChanged(params)){await this._callSampleModel('__reload',handle,...arguments);}else{this.leaveSampleMode();}}
return handle;},async _callSampleModel(method,handle,...args){if(this.useSampleModel&&this._isEmpty(handle)){try{if(method==='__load'){await this.sampleModel.__load(...args);}else if(method==='__reload'){await this.sampleModel.__reload(...args);}
this._isInSampleMode=true;}catch(error){if(error instanceof SampleServer.UnimplementedRouteError){this.leaveSampleMode();}else{throw error;}}}else{this.leaveSampleMode();}},__get(){return{};},_isEmpty(){return false;},async __load(){return Promise.resolve();},_parseServerValue:function(field,value){if(field.type==='date'||field.type==='datetime'){value=fieldUtils.parse[field.type](value,field,{isUTC:true});}else if(field.type==='selection'&&value===false){var hasKey0=_.find(field.selection,function(option){return option[0]===0;});value=hasKey0?0:value;}
return value;},async __reload(){return Promise.resolve();},_haveParamsChanged(params={}){for(const key of['context','domain','timeRanges']){if(key in params){const diff=JSON.stringify(params[key])!==JSON.stringify(this.loadParams[key]);if(diff){return true;}}}
if(this.useSampleModel&&'groupBy'in params){return JSON.stringify(params.groupBy)!==JSON.stringify(this.loadParams.groupedBy);}},async _rpc(){if(this.isSampleModel){return this.sampleServer.mockRpc(...arguments);}
return this._super(...arguments);},});__exports[Symbol.for("default")]=AbstractModel;return __exports;});odoo.define(`web.AbstractModel`,async function(require){return require('@web/legacy/js/views/abstract_model')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/abstract_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/abstract_renderer',async function(require){'use strict';let __exports={};const mvc=require('web.mvc');const FOCUSABLE_ELEMENTS=['a','button','input','select','textarea','[tabindex="0"]'].map((sel)=>`:scope ${sel}`).join(', ');__exports[Symbol.for("default")]=mvc.Renderer.extend({sampleDataTargets:[],init:function(parent,state,params){this._super.apply(this,arguments);this.arch=params.arch;this.noContentHelp=params.noContentHelp;this.withSearchPanel=params.withSearchPanel;},async start(){this.$el.addClass(this.arch.attrs.class);if(this.withSearchPanel){this.$el.addClass('o_renderer_with_searchpanel');}
await Promise.all([this._render(),this._super()]);},on_attach_callback:function(){},on_detach_callback:function(){},getLocalState:function(){},giveFocus:function(){},resetLocalState(){},setLocalState:function(localState){},async updateState(state,params){this._setState(state);if(!params.noRender){await this._render();}},async _render(){await this._renderView();this._suppressFocusableElements();},_renderNoContentHelper:function(context){let templateName;if(!context&&this.noContentHelp){templateName="web.ActionHelper";context={noContentHelp:this.noContentHelp};}else{templateName="web.NoContentHelper";}
const template=document.createElement('template');const owlQWeb=owl.Component.env.qweb;template.innerHTML=owlQWeb.renderToString(templateName,context);this.el.append(template.content.firstChild);},async _renderView(){},_setState(state=false){if(state!==false){this.state=state;}},_suppressFocusableElements(){if(!this.state.isSample||this.isEmbedded){return;}
const rootEls=[];for(const selector of this.sampleDataTargets){rootEls.push(...this.el.querySelectorAll(`:scope ${selector}`));}
const focusableEls=new Set(rootEls);for(const rootEl of rootEls){rootEl.classList.add('o_sample_data_disabled');for(const focusableEl of rootEl.querySelectorAll(FOCUSABLE_ELEMENTS)){focusableEls.add(focusableEl);}}
for(const focusableEl of focusableEls){focusableEl.setAttribute('tabindex',-1);if(focusableEl.classList.contains('dropdown-item')){focusableEl.classList.add('disabled');}}},});return __exports;});odoo.define(`web.AbstractRenderer`,async function(require){return require('@web/legacy/js/views/abstract_renderer')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/abstract_renderer_owl.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/abstract_renderer_owl',async function(require){'use strict';let __exports={};const FOCUSABLE_ELEMENTS=['a','button','input','select','textarea','[tabindex="0"]'].map((sel)=>`:scope ${sel}`).join(', ');class AbstractRenderer extends owl.Component{constructor(){super(...arguments);this.sampleDataTargets=[];}
mounted(){this._suppressFocusableElements();}
patched(){this._suppressFocusableElements();}
_suppressFocusableElements(){if(!this.props.isSample||this.props.isEmbedded){const disabledEls=this.el.querySelectorAll(`.o_sample_data_disabled`);disabledEls.forEach(el=>el.classList.remove('o_sample_data_disabled'));return;}
const rootEls=[];for(const selector of this.sampleDataTargets){rootEls.push(...this.el.querySelectorAll(`:scope ${selector}`));}
const focusableEls=new Set(rootEls);for(const rootEl of rootEls){rootEl.classList.add('o_sample_data_disabled');for(const focusableEl of rootEl.querySelectorAll(FOCUSABLE_ELEMENTS)){focusableEls.add(focusableEl);}}
for(const focusableEl of focusableEls){focusableEl.setAttribute('tabindex',-1);if(focusableEl.classList.contains('dropdown-item')){focusableEl.classList.add('disabled');}}}}
__exports[Symbol.for("default")]=AbstractRenderer;return __exports;});odoo.define(`web.AbstractRendererOwl`,async function(require){return require('@web/legacy/js/views/abstract_renderer_owl')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/abstract_view.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/abstract_view',async function(require){'use strict';let __exports={};const ActionModel=require("web.ActionModel");const AbstractModel=require("@web/legacy/js/views/abstract_model")[Symbol.for("default")];const AbstractRenderer=require("@web/legacy/js/views/abstract_renderer")[Symbol.for("default")];const AbstractController=require("@web/legacy/js/views/abstract_controller")[Symbol.for("default")];const ControlPanel=require('web.ControlPanel');const SearchPanel=require("web.searchPanel");const mvc=require('web.mvc');const viewUtils=require('web.viewUtils');const{Component}=owl;var Factory=mvc.Factory;var AbstractView=Factory.extend({display_name:'',mobile_friendly:false,icon:'fa-question',multi_record:true,viewType:undefined,withSearchBar:true,searchMenuTypes:['filter','groupBy','favorite'],withControlPanel:true,withSearchPanel:true,config:_.extend({},Factory.prototype.config,{Model:AbstractModel,Renderer:AbstractRenderer,Controller:AbstractController,ControlPanel,SearchPanel,}),init:function(viewInfo,params){this._super.apply(this,arguments);var action=params.action||{};params=_.defaults(params,this._extractParamsFromAction(action));if(typeof viewInfo.arch==='string'){this.fieldsView=this._processFieldsView(viewInfo);}else{this.fieldsView=viewInfo;}
this.arch=this.fieldsView.arch;this.fields=this.fieldsView.viewFields;this.userContext=params.userContext||{};var isEmbedded=params.isEmbedded||false;var help=params.noContentHelp||"";var htmlHelp=document.createElement("div");htmlHelp.innerHTML=help;this.rendererParams={arch:this.arch,isEmbedded:isEmbedded,noContentHelp:htmlHelp.innerText.trim()?help:"",};this.controllerParams={actionViews:params.actionViews,activeActions:{edit:typeof params.editable==='boolean'?params.editable:this.arch.attrs.edit?!!JSON.parse(this.arch.attrs.edit):true,create:this.arch.attrs.create?!!JSON.parse(this.arch.attrs.create):true,delete:this.arch.attrs.delete?!!JSON.parse(this.arch.attrs.delete):true,duplicate:this.arch.attrs.duplicate?!!JSON.parse(this.arch.attrs.duplicate):true,},bannerRoute:this.arch.attrs.banner_route,controllerID:params.controllerID,displayName:params.displayName,isEmbedded:isEmbedded,modelName:params.modelName,viewType:this.viewType,};var controllerState=params.controllerState||{};var currentId=controllerState.currentId||params.currentId;this.loadParams={context:params.context,count:params.count||((this.controllerParams.ids!==undefined)&&this.controllerParams.ids.length)||0,domain:params.domain,modelName:params.modelName,res_id:currentId,res_ids:controllerState.resIds||params.ids||(currentId?[currentId]:undefined),};const useSampleModel='useSampleModel'in params?params.useSampleModel:!!(this.arch.attrs.sample&&JSON.parse(this.arch.attrs.sample));this.modelParams={fields:this.fields,modelName:params.modelName,useSampleModel,};if(useSampleModel){this.modelParams.SampleModel=this.config.Model;}
var defaultOrder=this.arch.attrs.default_order;if(defaultOrder){this.loadParams.orderedBy=_.map(defaultOrder.split(','),function(order){order=order.trim().split(' ');return{name:order[0],asc:order[1]!=='desc'};});}
if(params.searchQuery){this._updateMVCParams(params.searchQuery);}
this.withControlPanel=this.withControlPanel&&params.withControlPanel;this.withSearchPanel=this.withSearchPanel&&this.multi_record&&params.withSearchPanel&&!('search_panel'in params.context&&!params.search_panel);const searchModelParams=Object.assign({},params,{action});if(this.withControlPanel||this.withSearchPanel){const{arch,fields,favoriteFilters}=params.controlPanelFieldsView||{};const archInfo=ActionModel.extractArchInfo({search:arch},this.viewType);const controlPanelInfo=archInfo[this.config.ControlPanel.modelExtension];const searchPanelInfo=archInfo[this.config.SearchPanel.modelExtension];this.withSearchPanel=this.withSearchPanel&&Boolean(searchPanelInfo);Object.assign(searchModelParams,{fields,favoriteFilters,controlPanelInfo,searchPanelInfo,});}
const searchModel=this._createSearchModel(searchModelParams);this.controllerParams.searchModel=searchModel;if(this.controllerParams.controlPanel){this.controllerParams.controlPanel.props.searchModel=searchModel;}
if(this.controllerParams.searchPanel){this.controllerParams.searchPanel.props.searchModel=searchModel;}},_createSearchModel:function(params,extraExtensions){const{fields,favoriteFilters,controlPanelInfo,searchPanelInfo}=params;const extensions=Object.assign({},extraExtensions);const importedState=params.controllerState||{};if(this.withControlPanel){const ControlPanelComponent=this.config.ControlPanel;if(this.withSearchBar){extensions[ControlPanelComponent.modelExtension]={actionId:params.action.id,activateDefaultFavorite:params.activateDefaultFavorite,archNodes:controlPanelInfo.children,dynamicFilters:params.dynamicFilters,favoriteFilters,withSearchBar:params.withSearchBar,};}
this.controllerParams.withControlPanel=true;const controlPanelProps={action:params.action,breadcrumbs:params.breadcrumbs,fields,searchMenuTypes:params.searchMenuTypes,view:this.fieldsView,views:params.action.views&&params.action.views.filter(v=>v.multiRecord===this.multi_record),withBreadcrumbs:params.withBreadcrumbs,withSearchBar:params.withSearchBar,};this.controllerParams.controlPanel={Component:ControlPanelComponent,props:controlPanelProps,};}
if(this.withSearchPanel){const SearchPanelComponent=this.config.SearchPanel;extensions[SearchPanelComponent.modelExtension]={archNodes:searchPanelInfo.children,};this.controllerParams.withSearchPanel=true;this.rendererParams.withSearchPanel=true;const searchPanelProps={importedState:importedState.searchPanel,};if(searchPanelInfo.attrs.class){searchPanelProps.className=searchPanelInfo.attrs.class;}
this.controllerParams.searchPanel={Component:SearchPanelComponent,props:searchPanelProps,};}
const searchModel=new ActionModel(extensions,{env:Component.env,modelName:params.modelName,context:Object.assign({},this.loadParams.context),domain:this.loadParams.domain||[],importedState:importedState.searchModel,searchMenuTypes:params.searchMenuTypes,searchQuery:params.searchQuery,fields,});return searchModel;},getController:async function(){const _super=this._super.bind(this);const{searchModel}=this.controllerParams;await searchModel.load();this._updateMVCParams(searchModel.get("query"));const modelParent=this.model&&this.model.getParent();const[controller]=await Promise.all([_super(...arguments),searchModel.isReady(),]);if(modelParent){this.model.setParent(modelParent);}
return controller;},getModel:function(){if(!this.model){this.model=this._super.apply(this,arguments);}
return this.model;},setController:function(Controller){this.Controller=Controller;},_extractParamsFromAction:function(action){action=action||{};var context=action.context||{};var inline=action.target==='inline';const params={actionId:action.id||false,actionViews:action.views||[],activateDefaultFavorite:!context.active_id&&!context.active_ids,context:action.context||{},controlPanelFieldsView:action.controlPanelFieldsView,currentId:action.res_id?action.res_id:undefined,displayName:action.display_name||action.name,domain:action.domain||[],limit:action.limit,modelName:action.res_model,noContentHelp:action.help,searchMenuTypes:inline?[]:this.searchMenuTypes,withBreadcrumbs:'no_breadcrumbs'in context?!context.no_breadcrumbs:true,withControlPanel:this.withControlPanel,withSearchBar:inline?false:this.withSearchBar,withSearchPanel:this.withSearchPanel,};if('useSampleModel'in action){params.useSampleModel=action.useSampleModel;}
return params;},_processFieldsView:function(fieldsView){var fv=_.extend({},fieldsView);fv.arch=viewUtils.parseArch(fv.arch);fv.viewFields=_.defaults({},fv.viewFields,fv.fields);return fv;},_updateMVCParams:function(searchQuery){this.loadParams=_.extend(this.loadParams,{context:searchQuery.context,domain:searchQuery.domain,groupedBy:searchQuery.groupBy,});this.loadParams.orderedBy=Array.isArray(searchQuery.orderedBy)&&searchQuery.orderedBy.length?searchQuery.orderedBy:this.loadParams.orderedBy;if(searchQuery.timeRanges){this.loadParams.timeRanges=searchQuery.timeRanges;this.rendererParams.timeRanges=searchQuery.timeRanges;}},});__exports[Symbol.for("default")]=AbstractView;return __exports;});odoo.define(`web.AbstractView`,async function(require){return require('@web/legacy/js/views/abstract_view')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/action_model.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/action_model',async function(require){'use strict';let __exports={};const Domain=require("web.Domain");const{FACET_ICONS}=require("web.searchUtils");const{Model}=require("web.Model");const{parseArch}=require("web.viewUtils");const pyUtils=require("web.py_utils");const Registry=require("web.Registry");const isNotNull=(value)=>value!==null&&value!==undefined;const isObject=(obj)=>typeof obj==="object"&&obj!==null;class ActionModelExtension extends Model.Extension{async callLoad(){this.loadPromise=super.callLoad(...arguments);await this.loadPromise;}
async isReady(){await this.loadPromise;}
static extractArchInfo(){return null;}}
class ActionModel extends Model{get(property){switch(property){case"query":return this.config.searchQuery||this._getQuery();case"facets":return this._getFacets();}
return super.get(...arguments);}
async isReady(){await this._awaitExtensions();}
async _awaitExtensions(){await Promise.all(this.extensions.flat().map((extension)=>extension.isReady()));}
__get(excluded,property){const results=super.__get(...arguments);switch(property){case"domain":return[this.config.domain,...results];case"context":return[this.config.context,...results];}
return results;}
_getFacets(){const types=this.config.searchMenuTypes||[];const isValidType=(type)=>(!['groupBy','comparison'].includes(type)||types.includes(type));const facets=[];for(const extension of this.extensions.flat()){for(const facet of extension.get("facets")||[]){if(!isValidType(facet.type)){continue;}
facet.separator=facet.type==='groupBy'?">":this.env._t("or");if(facet.type in FACET_ICONS){facet.icon=FACET_ICONS[facet.type];}
facets.push(facet);}}
return facets;}
_getQuery(){const evalContext=this.env.session.user_context;const contexts=this.__get(null,"context");const domains=this.__get(null,"domain");const query={context:pyUtils.eval("contexts",contexts,evalContext),domain:Domain.prototype.normalizeArray(pyUtils.eval("domains",domains,evalContext)),orderedBy:this.get("orderedBy")||[],};const searchMenuTypes=this.config.searchMenuTypes||[];if(searchMenuTypes.includes("groupBy")){query.groupBy=this.get("groupBy")||[];}else{query.groupBy=[];}
if(searchMenuTypes.includes("comparison")){query.timeRanges=this.get("timeRanges")||{};}
return query;}
async _loadExtensions({isInitialLoad}){await super._loadExtensions(...arguments);if(!isInitialLoad){this.trigger("search",this.get("query"));await this._awaitExtensions();}}
static extractArchInfo(archs,viewType=null){const parsedArchs={};if(!archs.search){archs.search="<search/>";}
for(const key in archs){const{attrs,children}=parseArch(archs[key]);const objectChildren=children.filter(isObject);parsedArchs[key]={attrs,children:objectChildren,};}
const archInfo={};for(const key of this.registry.keys()){const extension=this.registry.get(key);const result=extension.extractArchInfo(parsedArchs,viewType);if(isNotNull(result)){archInfo[key]=result;}}
return archInfo;}}
ActionModel.Extension=ActionModelExtension;ActionModel.registry=new Registry(null,(value)=>value.prototype instanceof ActionModel.Extension);__exports[Symbol.for("default")]=ActionModel;return __exports;});odoo.define(`web.ActionModel`,async function(require){return require('@web/legacy/js/views/action_model')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/basic/basic_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var Dialog=require('web.Dialog');var FieldManagerMixin=require('web.FieldManagerMixin');var{Markup}=require('web.utils');var TranslationDialog=require('web.TranslationDialog');var _t=core._t;var BasicController=AbstractController.extend(FieldManagerMixin,{events:Object.assign({},AbstractController.prototype.events,{'click .o_content':'_onContentClicked',}),custom_events:_.extend({},AbstractController.prototype.custom_events,FieldManagerMixin.custom_events,{discard_changes:'_onDiscardChanges',pager_changed:'_onPagerChanged',reload:'_onReload',resequence_records:'_onResequenceRecords',set_dirty:'_onSetDirty',load_optional_fields:'_onLoadOptionalFields',save_optional_fields:'_onSaveOptionalFields',translate:'_onTranslate',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.archiveEnabled=params.archiveEnabled;this.confirmOnDelete=params.confirmOnDelete;this.hasButtons=params.hasButtons;FieldManagerMixin.init.call(this,this.model);this.mode=params.mode||'readonly';this.savingDef=Promise.resolve();this.viewId=params.viewId;this.pendingChanges=[];},start:async function(){this.$el.toggleClass('o_cannot_create',!this.activeActions.create);await this._super(...arguments);},destroy:function(){this._super(...arguments);if(this._boundOnBeforeUnload){window.removeEventListener("beforeunload",this._boundOnBeforeUnload);}},on_attach_callback:function(){this._super(...arguments);this._boundOnBeforeUnload=this._onBeforeUnload.bind(this);window.addEventListener("beforeunload",this._boundOnBeforeUnload);},on_detach_callback:function(){this._super(...arguments);if(this._boundOnBeforeUnload){window.removeEventListener("beforeunload",this._boundOnBeforeUnload);}
this.renderer.resetLocalState();},canBeRemoved:function(){return this.saveChanges(this.handle);},canBeDiscarded:function(recordID){return Promise.resolve(true);},canBeSaved:function(recordID){var fieldNames=this.renderer.canBeSaved(recordID||this.handle);if(fieldNames.length){this._notifyInvalidFields(fieldNames);return false;}
return true;},discardChanges:function(recordID,options){return Promise.all([this.mutex.getUnlockedDef(),this.savingDef]).then(this._discardChanges.bind(this,recordID||this.handle,options));},getSelectedIds:function(){return[];},isDirty:function(recordID){return this.model.isDirty(recordID||this.handle);},saveChanges:async function(recordId){recordId=recordId||this.handle;if(this.isDirty(recordId)){await Promise.all([this.mutex.getUnlockedDef(),this.savingDef]);await this.saveRecord(recordId,{stayInEdit:true,reload:false,});}},saveRecord:function(recordID,options){var self=this;var unlockedMutex=this.mutex.getUnlockedDef().then(function(){return self.renderer.commitChanges(recordID||self.handle);}).then(function(){return self.mutex.exec(self._saveRecord.bind(self,recordID,options));});this.savingDef=new Promise(function(resolve){unlockedMutex.then(resolve).guardedCatch(resolve);});return unlockedMutex;},update:async function(params,options){this.mode=params.mode||this.mode;return this._super(params,options);},reload:function(params){if(params&&params.controllerState){if(params.controllerState.currentId){params.currentId=params.controllerState.currentId;}
params.ids=params.controllerState.resIds;}
return this._super.apply(this,arguments);},_abandonRecord:function(recordID){recordID=recordID||this.handle;if(recordID===this.handle){this.trigger_up('history_back');}else{this.model.removeLine(recordID);}},_applyChanges:function(dataPointID,changes,event){this.pendingChanges.push({dataPointID,changes,event});var _super=FieldManagerMixin._applyChanges.bind(this);return this.mutex.exec(()=>{this.pendingChanges.shift();return _super(dataPointID,changes,event);});},_archive:async function(ids,archive){if(ids.length===0){return Promise.resolve();}
if(archive){await this.model.actionArchive(ids,this.handle);}else{await this.model.actionUnarchive(ids,this.handle);}
return this.update({},{reload:false});},_callButtonAction:function(attrs,record){record=record||this.model.get(this.handle);const actionData=Object.assign({},attrs,{context:record.getContext({additionalContext:attrs.context||{}})});const recordData={context:record.getContext(),currentID:record.data.id,model:record.model,resIDs:record.res_ids,};return this._executeButtonAction(actionData,recordData);},_confirmChange:function(id,fields,e){if(e.name==='discard_changes'&&e.target.reset){return e.target.reset(this.model.get(e.target.dataPointID),e,true);}
var state=this.model.get(this.handle);return this.renderer.confirmChange(state,id,fields,e);},_confirmSaveNewRecord:function(){var self=this;var def=new Promise(function(resolve,reject){var message=_t("You need to save this new record before editing the translation. Do you want to proceed?");var dialog=Dialog.confirm(self,message,{title:_t("Warning"),confirm_callback:resolve.bind(self,true),cancel_callback:reject,});dialog.on('closed',self,reject);});return def;},_deleteRecords:function(ids){var self=this;function doIt(){return self.model.deleteRecords(ids,self.modelName).then(self._onDeletedRecords.bind(self,ids));}
if(this.confirmOnDelete){const message=ids.length>1?_t("Are you sure you want to delete these records?"):_t("Are you sure you want to delete this record?");let dialog;const confirmCallback=()=>{doIt().guardedCatch(()=>dialog.destroy());};dialog=Dialog.confirm(this,message,{confirm_callback:confirmCallback});}else{doIt();}},_disableButtons:function(){if(this.$buttons){this.$buttons.find('button').attr('disabled',true);}},_discardChanges:function(recordID,options){var self=this;recordID=recordID||this.handle;options=options||{};return this.canBeDiscarded(recordID).then(function(needDiscard){if(options.readonlyIfRealDiscard&&!needDiscard){return;}
self.model.discardChanges(recordID);if(options.noAbandon){return;}
if(self.model.canBeAbandoned(recordID)){self._abandonRecord(recordID);return;}
return self._confirmSave(recordID);});},_enableButtons:function(){if(this.$buttons){this.$buttons.find('button').removeAttr('disabled');}},async _executeButtonAction(actionData,recordData){const prom=new Promise((resolve,reject)=>{this.trigger_up('execute_action',{action_data:actionData,env:recordData,on_closed:()=>this.isDestroyed()?Promise.resolve():this.reload(),on_success:resolve,on_fail:()=>this.update({},{reload:false}).then(reject).guardedCatch(reject)});});return this.alive(prom);},exportState:function(){var state=this._super.apply(this,arguments);var env=this.model.get(this.handle,{env:true});return _.extend(state,{currentId:env.currentId,resIds:env.ids,});},_getOptionalFieldsLocalStorageKey:function(keyParts){keyParts.model=this.modelName;keyParts.viewType=this.viewType;keyParts.viewId=this.viewId;var parts=['model','viewType','viewId','relationalField','subViewType','subViewId',];var viewIdentifier=parts.reduce(function(identifier,partName){if(partName in keyParts){return identifier+','+keyParts[partName];}
return identifier;},'optional_fields');viewIdentifier=keyParts.fields.sort(this._nameSortComparer).reduce(function(identifier,field){return identifier+','+field.name;},viewIdentifier);return viewIdentifier;},_getPagingInfo:function(state){const isGrouped=state.groupedBy&&state.groupedBy.length;return{currentMinimum:(isGrouped?state.groupsOffset:state.offset)+1,limit:isGrouped?state.groupsLimit:state.limit,size:isGrouped?state.groupsCount:state.count,};},_getActionMenuItems:function(state){return{activeIds:this.getSelectedIds(),context:state.getContext(),};},_nameSortComparer:function(left,right){return left.name<right.name?-1:1;},_notifyInvalidFields:function(invalidFields){var record=this.model.get(this.handle,{raw:true});var fields=record.fields;var warnings=invalidFields.map(function(fieldName){var fieldStr=fields[fieldName].string;return _.str.sprintf('<li>%s</li>',_.escape(fieldStr));});warnings.unshift('<ul>');warnings.push('</ul>');this.displayNotification({title:_t("Invalid fields:"),message:Markup(warnings.join('')),type:'danger',});},_onDeletedRecords:function(ids){this.update({});},_saveRecord:function(recordID,options){recordID=recordID||this.handle;options=_.defaults(options||{},{stayInEdit:false,reload:true,savePoint:false,});if(this.canBeSaved(recordID)){var self=this;var saveDef=this.model.save(recordID,{reload:options.reload,savePoint:options.savePoint,viewType:options.viewType,});if(!options.stayInEdit){saveDef=saveDef.then(function(fieldNames){var def=fieldNames.length?self._confirmSave(recordID):self._setMode('readonly',recordID);return def.then(function(){return fieldNames;});});}
return saveDef;}else{return Promise.reject("SaveRecord: this.canBeSave is false");}},_setMode:function(mode,recordID){if((recordID||this.handle)===this.handle){return this.update({mode:mode},{reload:false}).then(function(){core.bus.trigger('DOM_updated');});}
return Promise.resolve();},_shouldBounceOnClick:function(){return false;},_updateControlPanel:function(newProps={}){const state=this.model.get(this.handle);const props=Object.assign(newProps,{actionMenus:this._getActionMenuItems(state),pager:this._getPagingInfo(state),title:this.getTitle(),});return this.updateControlPanel(props);},_urgentSave(recordID){this.model.executeDirectly(()=>{this.renderer.commitChanges(recordID);for(const key in this.pendingChanges){const{changes,dataPointID,event}=this.pendingChanges[key];const options={context:event.data.context,viewType:event.data.viewType,notifyChange:false,};this.model.notifyChanges(dataPointID,changes,options);this._confirmChange(dataPointID,Object.keys(changes),event);}
if(this.isDirty()){this._saveRecord(recordID,{reload:false,stayInEdit:true});}});},_onContentClicked(ev){if(this.$buttons&&this._shouldBounceOnClick(ev.target)){this.$buttons.find('.btn-primary:visible:first').odooBounce();}},_onDiscardChanges:function(ev){var self=this;ev.stopPropagation();var recordID=ev.data.recordID;this._discardChanges(recordID).then(function(){self._confirmChange(recordID,[ev.data.fieldName],ev).then(ev.data.onSuccess).guardedCatch(ev.data.onSuccess);}).guardedCatch(ev.data.onFailure);},_onFieldChanged:function(ev){if(this.mode==='readonly'&&!('force_save'in ev.data)){ev.data.force_save=true;}
FieldManagerMixin._onFieldChanged.apply(this,arguments);},_onPagerChanged:async function(ev){ev.stopPropagation();const{currentMinimum,limit}=ev.data;const state=this.model.get(this.handle,{raw:true});const reloadParams=state.groupedBy&&state.groupedBy.length?{groupsLimit:limit,groupsOffset:currentMinimum-1,}:{limit,offset:currentMinimum-1,};await this.reload(reloadParams);if(state.limit===limit){this.trigger_up('scrollTo',{top:0});}},_onBeforeUnload:function(){},_onReload:function(ev){ev.stopPropagation();var data=ev&&ev.data||{};var handle=data.db_id;var prom;if(handle){prom=this.model.reload(handle).then(this._confirmSave.bind(this,handle));}else{prom=this.reload({fieldNames:data.fieldNames,keepChanges:data.keepChanges||false,});}
prom.then(ev.data.onSuccess).guardedCatch(ev.data.onFailure);},_onResequenceRecords:function(ev){ev.stopPropagation();this.trigger_up('mutexify',{action:async()=>{let state=this.model.get(this.handle);const resIDs=ev.data.recordIds.map(recordID=>state.data.find(d=>d.id===recordID).res_id);const options={offset:ev.data.offset,field:ev.data.handleField,};await this.model.resequence(this.modelName,resIDs,this.handle,options);this._updateControlPanel();state=this.model.get(this.handle);return this._updateRendererState(state,{noRender:true});},});},_onLoadOptionalFields:function(ev){var res=this.call('local_storage','getItem',this._getOptionalFieldsLocalStorageKey(ev.data.keyParts));ev.data.callback(res);},_onSaveOptionalFields:function(ev){this.call('local_storage','setItem',this._getOptionalFieldsLocalStorageKey(ev.data.keyParts),ev.data.optionalColumnsEnabled);},_onSetDirty:function(ev){ev.stopPropagation();this.model.setDirty(ev.data.dataPointID);},_onTranslate:async function(ev){ev.stopPropagation();if(this.model.isNew(ev.data.id)){await this._confirmSaveNewRecord();var updatedFields=await this.saveRecord(ev.data.id,{stayInEdit:true});await this._confirmChange(ev.data.id,updatedFields,ev);}
var record=this.model.get(ev.data.id,{raw:true});var res_id=record.res_id||record.res_ids[0];var result=await this._rpc({route:'/web/dataset/call_button',params:{model:'ir.translation',method:'translate_fields',args:[record.model,res_id,ev.data.fieldName],kwargs:{context:record.getContext()},}});this.translationDialog=new TranslationDialog(this,{domain:result.domain,searchName:result.context.search_default_name,fieldName:ev.data.fieldName,userLanguageValue:ev.target.value||'',dataPointID:record.id,isComingFromTranslationAlert:ev.data.isComingFromTranslationAlert,isText:result.context.translation_type==='text',showSrc:result.context.translation_show_src,});return this.translationDialog.open();},});return BasicController;});;

/* /web/static/src/legacy/js/views/basic/basic_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var Context=require('web.Context');var core=require('web.core');var Domain=require('web.Domain');const pyUtils=require('web.py_utils');var session=require('web.session');var utils=require('web.utils');var viewUtils=require('web.viewUtils');var localStorage=require('web.local_storage');var _t=core._t;const AGGREGATABLE_TYPES=['float','integer','monetary'];var x2ManyCommands={CREATE:0,create:function(virtualID,values){delete values.id;return[x2ManyCommands.CREATE,virtualID||false,values];},UPDATE:1,update:function(id,values){delete values.id;return[x2ManyCommands.UPDATE,id,values];},DELETE:2,delete:function(id){return[x2ManyCommands.DELETE,id,false];},FORGET:3,forget:function(id){return[x2ManyCommands.FORGET,id,false];},LINK_TO:4,link_to:function(id){return[x2ManyCommands.LINK_TO,id,false];},DELETE_ALL:5,delete_all:function(){return[5,false,false];},REPLACE_WITH:6,replace_with:function(ids){return[6,false,ids];}};var BasicModel=AbstractModel.extend({OPEN_GROUP_LIMIT:10,noCacheModels:['ir.actions.act_window','ir.filters','ir.ui.view','res.currency',],init:function(){this.mutex=new concurrency.Mutex();this.bypassMutex=false;this.batchedRPCsRequests=[];this.localData=Object.create(null);this.__id=0;this._super.apply(this,arguments);},addDefaultRecord:function(listID,options){var self=this;var list=this.localData[listID];var context=_.extend({},this._getDefaultContext(list),this._getContext(list));var position=(options&&options.position)||'top';var params={context:context,fields:list.fields,fieldsInfo:list.fieldsInfo,parentID:list.id,position:position,viewType:list.viewType,};return this._makeDefaultRecord(list.model,params).then(function(id){list.count++;if(position==='top'){list.data.unshift(id);}else{list.data.push(id);}
var record=self.localData[id];list._cache[record.res_id]=id;return id;});},addFieldsInfo:async function(dataPointID,viewInfo){var dataPoint=this.localData[dataPointID];dataPoint.fields=_.extend({},dataPoint.fields,viewInfo.fields);dataPoint.fieldsInfo=dataPoint.fieldsInfo||{};const mainFieldInfo=dataPoint.fieldsInfo[dataPoint[viewInfo.viewType]];dataPoint.fieldsInfo[viewInfo.viewType]=_.defaults({},viewInfo.fieldInfo,mainFieldInfo);if(dataPoint.type==='record'){await this.applyRawChanges(dataPointID,viewInfo.viewType);}
const proms=[];const fieldInfo=dataPoint.fieldsInfo[viewInfo.viewType];if(dataPoint.type==='list'){Object.values(dataPoint._cache).forEach(subDataPointID=>{proms.push(this.addFieldsInfo(subDataPointID,{fields:dataPoint.fields,fieldInfo:dataPoint.fieldsInfo[viewInfo.viewType],viewType:viewInfo.viewType,}));});}else{const values=_.extend({},dataPoint.data,dataPoint._changes);Object.keys(fieldInfo).forEach(fieldName=>{const fieldType=dataPoint.fields[fieldName].type;if(fieldType==='one2many'||fieldType==='many2many'){const mode=fieldInfo[fieldName].mode;const views=fieldInfo[fieldName].views;const x2mDataPointID=values[fieldName];if(views[mode]&&x2mDataPointID){proms.push(this.addFieldsInfo(x2mDataPointID,{fields:views[mode].fields,fieldInfo:views[mode].fieldsInfo[mode],viewType:mode,}));}}});}
return Promise.all(proms);},applyRawChanges:function(recordID,viewType){var record=this.localData[recordID];return this._applyOnChange(record._rawChanges,record,{viewType}).then(function(){return record.id;});},canBeAbandoned:function(id){if(this.localData[id]._noAbandon){return false;}
var record=this.localData[id];var parent=this.localData[record.parentID];if(parent){var entry=_.findWhere(parent._savePoint,{operation:'ADD',id:id});if(entry){if(!entry.isNew){return false;}
var lastEntry=_.last(parent._savePoint);if(lastEntry.operation==='UPDATE'&&lastEntry.id===id){return false;}}}
return this.isNew(id);},deleteRecords:function(recordIds,modelName){var self=this;var records=_.map(recordIds,function(id){return self.localData[id];});var context=_.extend(records[0].getContext(),session.user_context);return this._rpc({model:modelName,method:'unlink',args:[_.pluck(records,'res_id')],context:context,}).then(function(){_.each(records,function(record){var parent=record.parentID&&self.localData[record.parentID];if(parent&&parent.type==='list'){parent.data=_.without(parent.data,record.id);delete self.localData[record.id];if(!parent.data.length&&parent.offset>0){parent.offset=Math.max(parent.offset-parent.limit,0);}}else{record.res_ids.splice(record.offset,1);record.offset=Math.min(record.offset,record.res_ids.length-1);record.res_id=record.res_ids[record.offset];record.count--;}});self._invalidateCache(records[0]);});},discardChanges:function(id,options){options=options||{};var element=this.localData[id];var isNew=this.isNew(id);var rollback='rollback'in options?options.rollback:isNew;var initialOffset=element.offset;element._domains={};this._visitChildren(element,function(elem){if(rollback&&elem._savePoint){if(elem._savePoint instanceof Array){elem._changes=elem._savePoint.slice(0);}else{elem._changes=_.extend({},elem._savePoint);}
elem._isDirty=!isNew;}else{elem._changes=null;elem._isDirty=false;}
elem.offset=0;if(elem.tempLimitIncrement){elem.limit-=elem.tempLimitIncrement;delete elem.tempLimitIncrement;}});element.offset=initialOffset;},duplicateRecord:function(recordID){var self=this;var record=this.localData[recordID];var context=this._getContext(record);return this._rpc({model:record.model,method:'copy',args:[record.data.id],context:context,}).then(function(res_id){var index=record.res_ids.indexOf(record.res_id);record.res_ids.splice(index+1,0,res_id);return self.load({fieldsInfo:record.fieldsInfo,fields:record.fields,modelName:record.model,res_id:res_id,res_ids:record.res_ids.slice(0),viewType:record.viewType,context:context,});});},executeDirectly(callback){this.bypassMutex=true;callback();this.bypassMutex=false;},freezeOrder:function(listID){var list=this.localData[listID];if(list.type==='record'){return;}
list=this._applyX2ManyOperations(list);this._sortList(list);this.localData[listID].orderedResIDs=list.res_ids;},__get:function(id,options){var self=this;options=options||{};if(!(id in this.localData)){return null;}
var element=this.localData[id];if(options.env){var env={ids:element.res_ids?element.res_ids.slice(0):[],};if(element.type==='record'){env.currentId=this.isNew(element.id)?undefined:element.res_id;}
return env;}
if(element.type==='record'){var data=_.extend({},element.data,element._changes);var relDataPoint;for(var fieldName in data){var field=element.fields[fieldName];if(data[fieldName]===null){data[fieldName]=false;}
if(!field){continue;}
if(field.type==='many2one'){if(options.raw){relDataPoint=this.localData[data[fieldName]];data[fieldName]=relDataPoint?relDataPoint.res_id:false;}else{data[fieldName]=this.__get(data[fieldName])||false;}}else if(field.type==='reference'){if(options.raw){relDataPoint=this.localData[data[fieldName]];data[fieldName]=relDataPoint?relDataPoint.model+','+relDataPoint.res_id:false;}else{data[fieldName]=this.__get(data[fieldName])||false;}}else if(field.type==='one2many'||field.type==='many2many'){if(options.raw){if(typeof data[fieldName]==='string'){relDataPoint=this.localData[data[fieldName]];relDataPoint=this._applyX2ManyOperations(relDataPoint);data[fieldName]=relDataPoint.res_ids;}else{data[fieldName]=data[fieldName]||[];}}else{data[fieldName]=this.__get(data[fieldName])||[];}}}
var record={context:_.extend({},element.context),count:element.count,data:data,domain:element.domain.slice(0),evalModifiers:element.evalModifiers,fields:element.fields,fieldsInfo:element.fieldsInfo,getContext:element.getContext,getDomain:element.getDomain,getFieldNames:element.getFieldNames,id:element.id,isDirty:element.isDirty,isNew:element.isNew,limit:element.limit,model:element.model,offset:element.offset,ref:element.ref,res_ids:element.res_ids.slice(0),specialData:_.extend({},element.specialData),type:'record',viewType:element.viewType,};if(!this.isNew(element.id)){record.res_id=element.res_id;}
var evalContext;Object.defineProperty(record,'evalContext',{get:function(){evalContext=evalContext||self._getEvalContext(element);return evalContext;},});return record;}
element=this._applyX2ManyOperations(element);this._sortList(element);if(!element.orderedResIDs&&element._changes){_.each(element._changes,function(change){if(change.operation==='ADD'&&change.isNew){element.data=_.without(element.data,change.id);if(change.position==='top'){element.data.unshift(change.id);}else{element.data.push(change.id);}}});}
var list={aggregateValues:_.extend({},element.aggregateValues),context:_.extend({},element.context),count:element.count,data:_.map(element.data,function(elemID){return self.__get(elemID,options);}),domain:element.domain.slice(0),fields:element.fields,getContext:element.getContext,getDomain:element.getDomain,getFieldNames:element.getFieldNames,groupedBy:element.groupedBy,groupsCount:element.groupsCount,groupsLimit:element.groupsLimit,groupsOffset:element.groupsOffset,id:element.id,isDirty:element.isDirty,isM2MGrouped:element.isM2MGrouped,isNew:element.isNew,isOpen:element.isOpen,isSample:this.isSampleModel,limit:element.limit,model:element.model,offset:element.offset,orderedBy:element.orderedBy,res_id:element.res_id,res_ids:element.res_ids.slice(0),type:'list',value:element.value,range:element.range,viewType:element.viewType,};if(element.fieldsInfo){list.fieldsInfo=element.fieldsInfo;}
return list;},generateDefaultValues(recordID,options={}){const record=this.localData[recordID];const viewType=options.viewType||record.viewType;const fieldNames=options.fieldNames||Object.keys(record.fieldsInfo[viewType]);const numericFields=['float','integer','monetary'];const proms=[];record._changes=record._changes||{};fieldNames.forEach(fieldName=>{record.data[fieldName]=null;if(!(fieldName in record._changes)){const field=record.fields[fieldName];if(numericFields.includes(field.type)){record._changes[fieldName]=0;}else if(field.type==='one2many'||field.type==='many2many'){proms.push(this._processX2ManyCommands(record,fieldName,[],options));}else{record._changes[fieldName]=null;}}});return Promise.all(proms);},getName:function(id){var record=this.localData[id];var returnValue='';if(record._changes&&'display_name'in record._changes){returnValue=record._changes.display_name;}
else if('display_name'in record.data){returnValue=record.data.display_name;}
return returnValue||_t("New");},isDirty:function(id){var isDirty=false;this._visitChildren(this.localData[id],function(r){if(r._isDirty){isDirty=true;}});return isDirty;},_isEmpty(dataPointID){const dataPoint=this.localData[dataPointID];if(dataPoint.type==='list'){const hasRecords=dataPoint.count===0;if(dataPoint.groupedBy.length){return dataPoint.data.length>0&&hasRecords;}else{return hasRecords;}}
return false;},isNew:function(id){var data=this.localData[id];if(data.type!=="record"){return false;}
var res_id=data.res_id;if(typeof res_id==='number'){return false;}else if(typeof res_id==='string'&&/^[0-9]+-/.test(res_id)){return false;}
return true;},__load:async function(params){await this._super(...arguments);params.type=params.type||(params.res_id!==undefined?'record':'list');params.viewType=params.viewType||'default';if(!params.fieldsInfo){var fieldsInfo={};for(var fieldName in params.fieldNames){fieldsInfo[params.fieldNames[fieldName]]={};}
params.fieldsInfo={};params.fieldsInfo[params.viewType]=fieldsInfo;}
if(params.type==='record'&&params.res_id===undefined){params.allowWarning=true;return this._makeDefaultRecord(params.modelName,params);}
var dataPoint=this._makeDataPoint(params);return this._load(dataPoint).then(function(){return dataPoint.id;});},localIdsToResIds:function(localIds){return localIds.map(localId=>this.localData[localId].res_id);},makeRecord:function(model,fields,fieldInfo){var self=this;var defs=[];var record_fields={};_.each(fields,function(field){record_fields[field.name]=_.pick(field,'type','relation','domain','selection');});fieldInfo=fieldInfo||{};var fieldsInfo={};fieldsInfo.default={};_.each(fields,function(field){fieldsInfo.default[field.name]=fieldInfo[field.name]||{};});var record=this._makeDataPoint({modelName:model,fields:record_fields,fieldsInfo:fieldsInfo,viewType:'default',});_.each(fields,function(field){var dataPoint;record.data[field.name]=null;if(field.type==='many2one'){if(field.value){var id=_.isArray(field.value)?field.value[0]:field.value;var display_name=_.isArray(field.value)?field.value[1]:undefined;dataPoint=self._makeDataPoint({modelName:field.relation,data:{id:id,display_name:display_name,},parentID:record.id,});record.data[field.name]=dataPoint.id;if(display_name===undefined){defs.push(self._fetchNameGet(dataPoint));}}}else if(field.type==='reference'&&field.value){const ref=field.value.split(',');dataPoint=self._makeDataPoint({context:record.context,data:{id:parseInt(ref[1],10)},modelName:ref[0],parentID:record.id,});defs.push(self._fetchNameGet(dataPoint));record.data[field.name]=dataPoint.id;}else if(field.type==='one2many'||field.type==='many2many'){var relatedFieldsInfo={};relatedFieldsInfo.default={};_.each(field.fields,function(field){relatedFieldsInfo.default[field.name]={};});var dpParams={fieldsInfo:relatedFieldsInfo,modelName:field.relation,parentID:record.id,static:true,type:'list',viewType:'default',};var needLoad=false;if(field.value&&field.value.length){if(_.isObject(field.value[0])){dpParams.res_ids=_.pluck(field.value,'id');dataPoint=self._makeDataPoint(dpParams);_.each(field.value,function(data){var recordDP=self._makeDataPoint({data:data,modelName:field.relation,parentID:dataPoint.id,type:'record',});dataPoint.data.push(recordDP.id);dataPoint._cache[recordDP.res_id]=recordDP.id;});}else{dpParams.res_ids=field.value;dataPoint=self._makeDataPoint(dpParams);needLoad=true;}}else{dpParams.res_ids=[];dataPoint=self._makeDataPoint(dpParams);}
if(needLoad){defs.push(self._load(dataPoint));}
record.data[field.name]=dataPoint.id;}else if(field.value){record.data[field.name]=field.value;}});return Promise.all(defs).then(function(){return record.id;});},notifyChanges:function(record_id,changes,options){const notifyChanges=()=>this._applyChange(record_id,changes,options);if(this.bypassMutex){return notifyChanges();}
return this.mutex.exec(notifyChanges);},__reload:async function(id,options){await this._super(...arguments);return this.mutex.exec(this._reload.bind(this,id,options));},removeLine:function(elementID){var record=this.localData[elementID];var parent=this.localData[record.parentID];if(parent.static){parent._changes=_.filter(parent._changes,function(change){if(change.id===elementID&&change.operation==='ADD'&&parent.tempLimitIncrement){parent.tempLimitIncrement--;parent.limit--;}
return change.id!==elementID;});}else{parent.data=_.without(parent.data,elementID);parent.count--;}},resequence:function(modelName,resIDs,parentID,options){options=options||{};if((resIDs.length<=1)){return Promise.resolve(parentID);}
var self=this;var data=this.localData[parentID];var params={model:modelName,ids:resIDs,context:data.getContext(),};if(options.offset){params.offset=options.offset;}
if(options.field){params.field=options.field;}
return this._rpc({route:'/web/dataset/resequence',params:params,}).then(function(wasResequenced){if(!wasResequenced){return Promise.resolve();}
var field=params.field?params.field:'sequence';return self._rpc({model:modelName,method:'read',args:[resIDs,[field]],context:data.getContext(),}).then(function(records){if(data.data.length){var dataType=self.localData[data.data[0]].type;if(dataType==='record'){_.each(data.data,function(dataPoint){var recordData=self.localData[dataPoint].data;var inRecords=_.findWhere(records,{id:recordData.id});if(inRecords){recordData[field]=inRecords[field];}});data.data=_.sortBy(data.data,function(d){return self.localData[d].data[field];});}
if(dataType==='list'){data.data=_.sortBy(data.data,function(d){return _.indexOf(resIDs,self.localData[d].res_id)});}}
data.res_ids=[];_.each(data.data,function(d){var dataPoint=self.localData[d];if(dataPoint.type==='record'){data.res_ids.push(dataPoint.res_id);}else{data.res_ids=data.res_ids.concat(dataPoint.res_ids);}});self._updateParentResIDs(data);return parentID;})});},save:function(recordID,options){var self=this;function _save(){options=options||{};var record=self.localData[recordID];if(options.savePoint){self._visitChildren(record,function(rec){var newValue=rec._changes||rec.data;if(newValue instanceof Array){rec._savePoint=newValue.slice(0);}else{rec._savePoint=_.extend({},newValue);}});for(let fieldName in(record._changes||{})){record._editionViewType[fieldName]=options.viewType;}}
var shouldReload='reload'in options?options.reload:true;var method=self.isNew(recordID)?'create':'write';if(record._changes){delete record._changes.id;}
var changes=self._generateChanges(record,{viewType:options.viewType,changesOnly:method!=='create'});delete changes.id;if(method==='create'){var fieldNames=record.getFieldNames();_.each(fieldNames,function(name){if(changes[name]===null){delete changes[name];}});}
var prom=new Promise(function(resolve,reject){var changedFields=Object.keys(changes);if(options.savePoint){resolve(changedFields);return;}
if(method==='create'||changedFields.length){var args=method==='write'?[[record.data.id],changes]:[changes];self._rpc({model:record.model,method:method,args:args,context:record.getContext(),}).then(function(id){if(method==='create'){record.res_id=id;record.data.id=id;record.offset=record.res_ids.length;record.res_ids.push(id);record.count++;}
var _changes=record._changes;record._changes={};self._invalidateCache(record);self.unfreezeOrder(record.id);if(shouldReload){self._fetchRecord(record).then(function(){resolve(changedFields);});}else{_.extend(record.data,_changes);resolve(changedFields);}}).guardedCatch(reject);}else{resolve(changedFields);}});prom.then(function(){self._updateDuplicateRecords(record.id,(id)=>{Object.assign(self.localData[id].data,record.data);});record._isDirty=false;});return prom;}
if(this.bypassMutex){return _save();}else{return this.mutex.exec(_save);}},setDirty:function(id){this.localData[id]._isDirty=true;},setSort:function(list_id,fieldName){var list=this.localData[list_id];if(list.type==='record'){return;}else if(list._changes){_.each(list._changes,function(change){delete change.isNew;});}
if(list.orderedBy.length===0){list.orderedBy.push({name:fieldName,asc:true});}else if(list.orderedBy[0].name===fieldName){if(!list.orderedResIDs){list.orderedBy[0].asc=!list.orderedBy[0].asc;}}else{var orderedBy=_.reject(list.orderedBy,function(o){return o.name===fieldName;});list.orderedBy=[{name:fieldName,asc:true}].concat(orderedBy);}
list.orderedResIDs=null;if(list.static){return this._fetchUngroupedList(list);}
return Promise.resolve();},getActiveField:function(record){const fields=Object.keys(record.fields);const has_active=fields.includes('active');if(has_active){return'active';}
const has_x_active=fields.includes('x_active');return has_x_active?'x_active':undefined},toggleActive:function(recordIDs,parentID){var self=this;var parent=this.localData[parentID];var resIDs=_.map(recordIDs,function(recordID){return self.localData[recordID].res_id;});return this._rpc({model:parent.model,method:'toggle_active',args:[resIDs],}).then(function(action){self._invalidateCache(parent);if(!_.isEmpty(action)){return self.do_action(action,{on_close:function(){return self.trigger_up('reload');}});}else{return self.reload(parentID);}});},actionArchive:function(resIDs,parentID){var self=this;var parent=this.localData[parentID];return this._rpc({model:parent.model,method:'action_archive',args:[resIDs],}).then(function(action){self._invalidateCache(parent);if(!_.isEmpty(action)){return new Promise(function(resolve,reject){self.do_action(action,{on_close:function(result){return self.trigger_up('reload',{onSuccess:resolve,});}});});}else{return self.reload(parentID);}}).then(function(datapoint){if(parent&&parent.type==='list'&&!parent.data.length&&parent.offset>0){parent.offset=Math.max(parent.offset-parent.limit,0);return self.reload(parentID);}
return datapoint;});},actionUnarchive:function(resIDs,parentID){var self=this;var parent=this.localData[parentID];return this._rpc({model:parent.model,method:'action_unarchive',args:[resIDs],}).then(function(action){self._invalidateCache(parent);if(!_.isEmpty(action)){return new Promise(function(resolve,reject){self.do_action(action,{on_close:function(){return self.trigger_up('reload',{onSuccess:resolve,});}});});}else{return self.reload(parentID);}}).then(function(datapoint){if(parent&&parent.type==='list'&&!parent.data.length&&parent.offset>0){parent.offset=Math.max(parent.offset-parent.limit,0);return self.reload(parentID);}
return datapoint;});},toggleGroup:function(groupId){var self=this;var group=this.localData[groupId];if(group.isOpen){group.isOpen=false;group.data=[];group.res_ids=[];group.offset=0;this._updateParentResIDs(group);return Promise.resolve(groupId);}
if(!group.isOpen){group.isOpen=true;var def;if(group.count>0){def=this._load(group).then(function(){self._updateParentResIDs(group);});}
return Promise.resolve(def).then(function(){return groupId;});}},unfreezeOrder:function(elementID){var list=this.localData[elementID];if(list.type==='record'){var data=_.extend({},list.data,list._changes);for(var fieldName in data){var field=list.fields[fieldName];if(!field||!data[fieldName]){continue;}
if(field.type==='one2many'||field.type==='many2many'){var recordlist=this.localData[data[fieldName]];recordlist.orderedResIDs=null;for(var index in recordlist.data){this.unfreezeOrder(recordlist.data[index]);}}}
return;}
list.orderedResIDs=null;this._sortList(list);},_addX2ManyDefaultRecord:function(list,options){var self=this;var position=options&&options.position||'top';var params={fields:list.fields,fieldsInfo:list.fieldsInfo,parentID:list.id,position:position,viewType:options.viewType||list.viewType,allowWarning:options&&options.allowWarning};var additionalContexts=options&&options.context;var makeDefaultRecords=[];if(additionalContexts){_.each(additionalContexts,function(context){params.context=self._getContext(list,{additionalContext:context});makeDefaultRecords.push(self._makeDefaultRecord(list.model,params));});}else{params.context=self._getContext(list);makeDefaultRecords.push(self._makeDefaultRecord(list.model,params));}
return Promise.all(makeDefaultRecords).then(function(resultIds){var ids=[];_.each(resultIds,function(id){ids.push(id);list._changes.push({operation:'ADD',id:id,position:position,isNew:true});var record=self.localData[id];list._cache[record.res_id]=id;if(list.orderedResIDs){var index=list.offset+(position!=='top'?list.limit:0);list.orderedResIDs.splice(index,0,record.res_id);self.localData[list.id].orderedResIDs=list.orderedResIDs;}});return ids;});},_applyChange:function(recordID,changes,options){var self=this;var record=this.localData[recordID];var field;var defs=[];options=options||{};record._changes=record._changes||{};if(!options.doNotSetDirty){record._isDirty=true;}
var initialData={};this._visitChildren(record,function(elem){initialData[elem.id]=$.extend(true,{},_.pick(elem,'data','_changes'));});for(var fieldName in changes){field=record.fields[fieldName];if(field&&(field.type==='one2many'||field.type==='many2many')){defs.push(this._applyX2ManyChange(record,fieldName,changes[fieldName],options));}else if(field&&(field.type==='many2one'||field.type==='reference')){defs.push(this._applyX2OneChange(record,fieldName,changes[fieldName],options));}else{record._changes[fieldName]=changes[fieldName];}}
if(options.notifyChange===false){return Promise.all(defs).then(function(){return Promise.resolve(_.keys(changes));});}
return Promise.all(defs).then(function(){var onChangeFields=[];for(var fieldName in changes){field=record.fields[fieldName];if(field&&field.onChange){var isX2Many=field.type==='one2many'||field.type==='many2many';if(!isX2Many||(self._isX2ManyValid(record._changes[fieldName]||record.data[fieldName]))){onChangeFields.push(fieldName);}}}
return new Promise(function(resolve,reject){if(onChangeFields.length){self._performOnChange(record,onChangeFields,{viewType:options.viewType}).then(function(result){delete record._warning;resolve(_.keys(changes).concat(Object.keys(result&&result.value||{})));}).guardedCatch(function(){self._visitChildren(record,function(elem){_.extend(elem,initialData[elem.id]);});reject();});}else{resolve(_.keys(changes));}}).then(function(fieldNames){return self._fetchSpecialData(record).then(function(fieldNames2){return _.union(fieldNames,fieldNames2);});});});},_applyX2OneChange:async function(record,fieldName,data,options){options=options||{};var self=this;if(!data||(!data.id&&!data.display_name)){record._changes[fieldName]=false;return Promise.resolve();}
const field=record.fields[fieldName];const coModel=field.type==='reference'?data.model:field.relation;const allowedTypes=['many2one','reference'];if(allowedTypes.includes(field.type)&&!data.id&&data.display_name){const result=await this._rpc({model:coModel,method:'name_create',args:[data.display_name],context:this._getContext(record,{fieldName:fieldName,viewType:options.viewType}),});if(!result){record._changes[fieldName]=false;return Promise.resolve();}
data={id:result[0],display_name:result[1]};}
var relatedID;if(record._changes&&fieldName in record._changes){relatedID=record._changes[fieldName];}else{relatedID=record.data[fieldName];}
var relatedRecord=this.localData[relatedID];if(relatedRecord&&(data.id===this.localData[relatedID].res_id)){return Promise.resolve();}
var rel_data=_.pick(data,'id','display_name');const viewType=options.viewType||record.viewType;const fieldInfo=record.fieldsInfo[viewType][fieldName]||{};const fieldOptions=fieldInfo.options||{};var def;if(rel_data.display_name===undefined||fieldOptions.always_reload){def=this._rpc({model:coModel,method:'name_get',args:[data.id],context:this._getContext(record,{fieldName,viewType}),}).then(function(result){rel_data.display_name=result[0][1];});}
return Promise.resolve(def).then(function(){var rec=self._makeDataPoint({context:record.context,data:rel_data,fields:{},fieldsInfo:{},modelName:coModel,parentID:record.id,});record._changes[fieldName]=rec.id;});},_applyOnChange:function(values,record,options={}){var self=this;var defs=[];var rec;const viewType=options.viewType||record.viewType;record._changes=record._changes||{};for(let name in(values||{})){const val=values[name];var field=record.fields[name];if(!field){record._rawChanges[name]=val;continue;}
if(record._rawChanges[name]){delete record._rawChanges[name];}
var oldValue=name in record._changes?record._changes[name]:record.data[name];var id;if(field.type==='many2one'){id=false;if(val){var data=_.isArray(val)?{id:val[0],display_name:val[1]}:{id:val};if(!oldValue||(self.localData[oldValue].res_id!==data.id)){rec=self._makeDataPoint({context:record.context,data:data,modelName:field.relation,parentID:record.id,});id=rec.id;record._changes[name]=id;}}else{record._changes[name]=false;}}else if(field.type==='reference'){id=false;if(val){var ref=val.split(',');var modelName=ref[0];var resID=parseInt(ref[1]);if(!oldValue||self.localData[oldValue].res_id!==resID||self.localData[oldValue].model!==modelName){rec=self._makeDataPoint({context:record.context,data:{id:parseInt(ref[1])},modelName:modelName,parentID:record.id,});defs.push(self._fetchNameGet(rec));id=rec.id;record._changes[name]=id;}}else{record._changes[name]=id;}}else if(field.type==='one2many'||field.type==='many2many'){var listId=record._changes[name]||record.data[name];var list;if(listId){list=self.localData[listId];}else{var fieldInfo=record.fieldsInfo[viewType][name];if(!fieldInfo){continue;}
var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];list=self._makeDataPoint({fields:view?view.fields:fieldInfo.relatedFields,fieldsInfo:view?view.fieldsInfo:fieldInfo.fieldsInfo,limit:fieldInfo.limit,modelName:field.relation,parentID:record.id,static:true,type:'list',viewType:view?view.type:fieldInfo.viewType,});}
record._changes[name]=list.id;list._changes=list._changes||[];var oldChanges=list._changes;_.each(val,function(command){var rec,recID;if(command[0]===0||command[0]===1){if(command[0]===0&&command[1]){var previousChange=_.find(oldChanges,function(operation){var child=self.localData[operation.id];return child&&(child.ref===command[1]);});recID=previousChange&&previousChange.id;rec=self.localData[recID];}
if(command[0]===1&&command[1]){rec=self.localData[list._cache[command[1]]];}
if(!rec){var params={context:list.context,fields:list.fields,fieldsInfo:list.fieldsInfo,modelName:list.model,parentID:list.id,viewType:list.viewType,ref:command[1],};if(command[0]===1){params.res_id=command[1];}
rec=self._makeDataPoint(params);list._cache[rec.res_id]=rec.id;if(options.firstOnChange){rec.getFieldNames().forEach(fieldName=>{if(!(fieldName in rec.data)){rec.data[fieldName]=null;}});}}
rec._noAbandon=!list._savePoint;list._changes.push({operation:'ADD',id:rec.id});if(command[0]===1){list._changes.push({operation:'UPDATE',id:rec.id});}
defs.push(self._applyOnChange(command[2],rec,{firstOnChange:options.firstOnChange,}));}else if(command[0]===4){linkRecord(list,command[1]);}else if(command[0]===5){list._changes=[{operation:'REMOVE_ALL'}];}else if(command[0]===6){list._changes=[{operation:'REMOVE_ALL'}];_.each(command[2],function(resID){linkRecord(list,resID);});}});var def=self._readUngroupedList(list).then(function(){var x2ManysDef=self._fetchX2ManysBatched(list);var referencesDef=self._fetchReferencesBatched(list);return Promise.all([x2ManysDef,referencesDef]);});defs.push(def);}else{var newValue=self._parseServerValue(field,val);if(newValue!==oldValue){record._changes[name]=newValue;}}}
return Promise.all(defs);function linkRecord(list,resID){rec=self.localData[list._cache[resID]];if(rec){self.discardChanges(rec.id);}
list._changes.push({operation:'ADD',id:rec?rec.id:null,resID:resID,});}},_applyX2ManyChange:async function(record,fieldName,command,options){if(command.operation==='TRIGGER_ONCHANGE'){return Promise.resolve();}
var self=this;var localID=(record._changes&&record._changes[fieldName])||record.data[fieldName];var list=this.localData[localID];var field=record.fields[fieldName];var viewType=(options&&options.viewType)||record.viewType;var fieldInfo=record.fieldsInfo[viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var def,rec;var defs=[];list._changes=list._changes||[];switch(command.operation){case'ADD':var newRecord=this.localData[command.id];_.defaults(list.fields,newRecord.fields);_.defaults(list.fieldsInfo,newRecord.fieldsInfo);newRecord.fields=list.fields;newRecord.fieldsInfo=list.fieldsInfo;newRecord.viewType=list.viewType;list._cache[newRecord.res_id]=newRecord.id;list._changes.push(command);break;case'ADD_M2M':list._forceM2MLink=true;var data=_.isArray(command.ids)?command.ids:[command.ids];for(const r of data){if(!r.id&&r.display_name){const prom=this._rpc({model:field.relation,method:'name_create',args:[r.display_name],context:this._getContext(record,{fieldName:fieldName,viewType:options.viewType}),}).then(result=>{r.id=result[0];r.display_name=result[1];});defs.push(prom);}}
await Promise.all(defs);if(data.length+list.res_ids.length>list.limit){list.limit=data.length+list.res_ids.length;}
var list_records={};_.each(data,function(d){rec=self._makeDataPoint({context:record.context,modelName:field.relation,fields:view?view.fields:fieldInfo.relatedFields,fieldsInfo:view?view.fieldsInfo:fieldInfo.fieldsInfo,res_id:d.id,data:d,viewType:view?view.type:fieldInfo.viewType,parentID:list.id,});list_records[d.id]=rec;list._cache[rec.res_id]=rec.id;list._changes.push({operation:'ADD',id:rec.id});});var fieldNames=list.getFieldNames();if(fieldNames.length){def=this._rpc({model:list.model,method:'read',args:[_.pluck(data,'id'),fieldNames],context:_.extend({},record.context,field.context),}).then(function(records){_.each(records,function(record){list_records[record.id].data=record;self._parseServerData(fieldNames,list,record);});return Promise.all([self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list)]);});defs.push(def);}
break;case'CREATE':var createOptions=_.extend({context:command.context,position:command.position},options||{});createOptions.viewType=fieldInfo.mode;def=this._addX2ManyDefaultRecord(list,createOptions).then(function(ids){_.each(ids,function(id){if(command.position==='bottom'&&list.orderedResIDs&&list.orderedResIDs.length>=list.limit){list.tempLimitIncrement=(list.tempLimitIncrement||0)+1;list.limit+=1;}
if(command.data){return self._applyChange(id,command.data);}});});defs.push(def);break;case'UPDATE':list._changes.push({operation:'UPDATE',id:command.id});if(command.data){defs.push(this._applyChange(command.id,command.data,{viewType:view&&view.type,}));}
break;case'FORGET':list._forceM2MUnlink=true;case'DELETE':var idsToRemove=command.ids;list._changes=_.reject(list._changes,function(change,index){var idInCommands=_.contains(command.ids,change.id);if(idInCommands&&change.operation==='ADD'){idsToRemove=_.without(idsToRemove,change.id);}
return idInCommands;});_.each(idsToRemove,function(id){var operation=list._forceM2MUnlink?'FORGET':'DELETE';list._changes.push({operation:operation,id:id});});break;case'DELETE_ALL':list._changes=_.reject(list._changes,function(change){return change.operation==='ADD';});return this._applyX2ManyChange(record,fieldName,{operation:'DELETE',ids:list.res_ids},options);case'REPLACE_WITH':list._changes=[];var newIds=_.difference(command.ids,list.res_ids);var removedIds=_.difference(list.res_ids,command.ids);var addDef,removedDef,values;if(newIds.length){values=_.map(newIds,function(id){return{id:id};});addDef=this._applyX2ManyChange(record,fieldName,{operation:'ADD_M2M',ids:values},options);}
if(removedIds.length){var listData=_.map(list.data,function(localId){return self.localData[localId];});removedDef=this._applyX2ManyChange(record,fieldName,{operation:'DELETE',ids:_.map(removedIds,function(resID){if(resID in list._cache){return list._cache[resID];}
return _.findWhere(listData,{res_id:resID}).id;}),},options);}
return Promise.all([addDef,removedDef]);case'MULTI':_.each(command.commands,function(innerCommand){defs.push(self._applyX2ManyChange(record,fieldName,innerCommand,options));});break;}
return Promise.all(defs).then(function(){return self._readUngroupedList(list).then(function(){return self._fetchX2ManysBatched(list);});});},_applyX2ManyOperations:function(list,options){if(!list.static){return list;}
var self=this;list=_.extend({},list);list.res_ids=list.res_ids.slice(0);var changes=list._changes||[];if(options){var to=options.to===0?0:(options.to||changes.length);changes=changes.slice(options.from||0,to);}
_.each(changes,function(change){var relRecord;if(change.id){relRecord=self.localData[change.id];}
switch(change.operation){case'ADD':list.count++;var resID=relRecord?relRecord.res_id:change.resID;if(change.position==='top'&&(options?options.position!=='bottom':true)){list.res_ids.unshift(resID);}else{list.res_ids.push(resID);}
break;case'FORGET':case'DELETE':list.count--;var deletedResID=relRecord?relRecord.res_id:change.id;list.res_ids=_.without(list.res_ids,deletedResID);break;case'REMOVE_ALL':list.count=0;list.res_ids=[];break;case'UPDATE':break;}});this._setDataInRange(list);return list;},_buildOnchangeSpecs:function(record,viewType){let hasOnchange=false;const onchangeSpec={};var fieldsInfo=record.fieldsInfo[viewType||record.viewType];generateSpecs(fieldsInfo,record.fields);function generateSpecs(fieldsInfo,fields,prefix){prefix=prefix||'';_.each(Object.keys(fieldsInfo),function(name){var field=fields[name];var fieldInfo=fieldsInfo[name];var key=prefix+name;onchangeSpec[key]=(field.onChange)||"";if(field.onChange){hasOnchange=true;}
if(field.type==='one2many'||field.type==='many2many'){_.each(fieldInfo.views,function(view){generateSpecs(view.fieldsInfo[view.type],view.fields,key+'.');});}});}
return{hasOnchange,onchangeSpec};},async _callSampleModel(){await this._super(...arguments);if(this._isInSampleMode){this.__id=this.sampleModel.__id;}},_computeOverrideDefaultFields:function(listID,position){var list=this.localData[listID];var handleField;if(!list){return{};}
position=position||'bottom';if(!list.fieldsInfo){return{};}
for(var field in list.fieldsInfo.list){if(list.fieldsInfo.list[field].widget==='handle'){handleField=field;break;}}
if(!handleField){return{};}
var isOrderedByHandle=list.orderedBy&&list.orderedBy.length&&list.orderedBy[0].asc===true&&list.orderedBy[0].name===handleField;if(!isOrderedByHandle){return{};}
var computedList=this.get(list.id,{raw:true});if(!computedList||!computedList.data||!computedList.data.length){return{};}
var index=Math.min(computedList.data.length-1,position!=='top'?list.limit-1:0);var handleFieldValue=computedList.data[index].data[handleField];if(position==='top'){handleFieldValue--;}else if(list.count<=list.offset+list.limit-(list.tempLimitIncrement||0)){handleFieldValue++;}
return{field:handleField,value:handleFieldValue,};},_evalModifiers:function(element,modifiers){let evalContext=null;const evaluated={};for(const k of['invisible','column_invisible','readonly','required']){const mod=modifiers[k];if(mod===undefined||mod===false||mod===true){if(k in modifiers){evaluated[k]=!!mod;}
continue;}
try{evalContext=evalContext||this._getEvalContext(element);evaluated[k]=new Domain(mod,evalContext).compute(evalContext);}catch(e){throw new Error(_.str.sprintf('for modifier "%s": %s',k,e.message));}}
return evaluated;},_fetchModelFieldReference:async function(record,fieldName,fieldInfo){const modelField=fieldInfo.options.model_field;const value=record._changes&&record._changes[modelField]||record.data[modelField];if(value){if(record.fields[modelField].type!=="many2one"||record.fields[modelField].relation!=='ir.model'){throw new Error(`The model_field of the reference field
                                 ${fieldName} must be a many2one('ir.model').`);}
const modelId=this.localData[value].res_id;const resourceRef=record.specialData[fieldName];if(resourceRef&&modelId===resourceRef.modelId){resourceRef.hasChanged=false;return Promise.resolve(resourceRef);}else{const result=await this._rpc({model:'ir.model',method:'read',args:[modelId,['id','model']],});if(!record._changes&&record.data[fieldName]&&result[0].model!==this.localData[record.data[fieldName]].model){const modelFieldName=record.fields[modelField].string;const referenceFieldName=record.fields[fieldName].string;this.displayNotification({title:_.str.sprintf(_t(`'%s' is unsynchronized with '%s'.`),referenceFieldName,modelFieldName,),message:_.str.sprintf(_t(`If you change %s or %s, the synchronization will be reapplied and the data will be modified.`),modelFieldName,referenceFieldName,),sticky:true,type:'danger',});return false;}
return{modelName:result[0].model,modelId:result[0].id,hasChanged:true,};}}},_fetchNameGet:function(dataPoint){return this._rpc({model:dataPoint.model,method:'name_get',args:[dataPoint.res_id],context:dataPoint.getContext(),}).then(function(result){dataPoint.data.display_name=result[0][1];});},_fetchNameGets:function(list,fieldName){var self=this;var model=list.fields[fieldName].relation;var records=[];var ids=[];list=this._applyX2ManyOperations(list);_.each(list.data,function(localId){var record=self.localData[localId];var data=record._changes||record.data;var many2oneId=data[fieldName];if(!many2oneId){return;}
var many2oneRecord=self.localData[many2oneId];records.push(many2oneRecord);ids.push(many2oneRecord.res_id);model=many2oneRecord.model;});if(!ids.length){return Promise.resolve();}
return this._rpc({model:model,method:'name_get',args:[_.uniq(ids)],context:list.context,}).then(function(name_gets){_.each(records,function(record){var nameGet=_.find(name_gets,function(nameGet){return nameGet[0]===record.data.id;});record.data.display_name=nameGet[1];});});},_fetchRecord:function(record,options){var self=this;options=options||{};var fieldNames=options.fieldNames||record.getFieldNames(options);fieldNames=_.uniq(fieldNames.concat(['display_name']));return this._rpc({model:record.model,method:'read',args:[[record.res_id],fieldNames],context:_.extend({bin_size:true},record.getContext()),}).then(function(result){if(result.length===0){return Promise.reject();}
result=result[0];record.data=_.extend({},record.data,result);}).then(function(){self._parseServerData(fieldNames,record,record.data);}).then(function(){return Promise.all([self._fetchX2Manys(record,options),self._fetchReferences(record,options)]).then(function(){return self._postprocess(record,options);});});},_fetchReference:function(record,fieldName){var self=this;var def;var value=record._changes&&record._changes[fieldName]||record.data[fieldName];var model=value&&value.split(',')[0];var resID=value&&parseInt(value.split(',')[1]);if(model&&model!=='False'&&resID){def=self._rpc({model:model,method:'name_get',args:[resID],context:record.getContext({fieldName:fieldName}),}).then(function(result){return self._makeDataPoint({data:{id:result[0][0],display_name:result[0][1],},modelName:model,parentID:record.id,});});}
return Promise.resolve(def);},_fetchReferenceData:function(datapoints,model,fieldName){var self=this;var ids=_.map(Object.keys(datapoints),function(id){return parseInt(id);});var parent=datapoints[ids[0]][0];var def=self._rpc({model:model,method:'name_get',args:[ids],context:self.localData[parent].getContext({fieldName:fieldName}),}).then(function(result){_.each(result,function(el){var parentIDs=datapoints[el[0]];_.each(parentIDs,function(parentID){var parent=self.localData[parentID];var referenceDp=self._makeDataPoint({data:{id:el[0],display_name:el[1],},modelName:model,parentID:parent.id,});parent.data[fieldName]=referenceDp.id;});});});return def;},_fetchReferences:function(record,options){var self=this;var defs=[];var fieldNames=options&&options.fieldNames||record.getFieldNames();_.each(fieldNames,function(fieldName){var field=record.fields[fieldName];if(field.type==='reference'){var def=self._fetchReference(record,fieldName).then(function(dataPoint){if(dataPoint){record.data[fieldName]=dataPoint.id;}});defs.push(def);}});return Promise.all(defs);},_fetchReferenceBatched:function(list,fieldName){var self=this;list=this._applyX2ManyOperations(list);this._sortList(list);var toFetch=this._getDataToFetchByModel(list,fieldName);var defs=[];_.each(toFetch,function(datapoints,model){defs.push(self._fetchReferenceData(datapoints,model,fieldName));});return Promise.all(defs);},_fetchReferencesBatched:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var i=0;i<fieldNames.length;i++){var field=list.fields[fieldNames[i]];if(field.type==='reference'){defs.push(this._fetchReferenceBatched(list,fieldNames[i]));}}
return Promise.all(defs);},_fetchReferenceSingleBatch:function(list,fieldName){var self=this;var toFetch={};_.each(list.data,function(groupIndex){var group=self.localData[groupIndex];self._getDataToFetchByModel(group,fieldName,toFetch);});var defs=[];_.each(toFetch,function(datapoints,model){defs.push(self._fetchReferenceData(datapoints,model,fieldName));});return Promise.all(defs);},_fetchReferencesSingleBatch:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var fIndex in fieldNames){var field=list.fields[fieldNames[fIndex]];if(field.type==='reference'){defs.push(this._fetchReferenceSingleBatch(list,fieldNames[fIndex]));}}
return Promise.all(defs);},_fetchRelatedData:function(list,toFetch,fieldName){var self=this;var ids=_.keys(toFetch);for(var i=0;i<ids.length;i++){ids[i]=Number(ids[i]);}
var fieldInfo=list.fieldsInfo[list.viewType][fieldName];if(!ids.length||fieldInfo.__no_fetch){return Promise.resolve();}
var def;var fieldNames=_.keys(fieldInfo.relatedFields);if(fieldNames.length){var field=list.fields[fieldName];def=this._rpc({model:field.relation,method:'read',args:[ids,fieldNames],context:list.getContext()||{},});}else{def=Promise.resolve(_.map(ids,function(id){return{id:id};}));}
return def.then(function(result){var records=_.uniq(_.flatten(_.values(toFetch)));self._updateRecordsData(records,fieldName,result);});},_fetchSpecialData:function(record,options){var self=this;var specialFieldNames=[];var fieldNames=(options&&options.fieldNames)||record.getFieldNames();return Promise.all(_.map(fieldNames,function(name){var viewType=(options&&options.viewType)||record.viewType;var fieldInfo=record.fieldsInfo[viewType][name]||{};var Widget=fieldInfo.Widget;if(Widget&&Widget.prototype.specialData){return self[Widget.prototype.specialData](record,name,fieldInfo).then(function(data){if(data===undefined){return;}
record.specialData[name]=data;specialFieldNames.push(name);});}})).then(function(){return specialFieldNames;});},_fetchSpecialMany2ones:function(record,fieldName,fieldInfo,fieldsToRead){var field=record.fields[fieldName];if(field.type!=="many2one"){return Promise.resolve();}
var context=record.getContext({fieldName:fieldName});var domain=record.getDomain({fieldName:fieldName});if(domain.length){var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];if(localID){var element=this.localData[localID];domain=["|",["id","=",element.data.id]].concat(domain);}}
var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domain:domain,});if(!hasChanged){return Promise.resolve();}
var self=this;return this._rpc({model:field.relation,method:'search_read',fields:["id"].concat(fieldsToRead||[]),context:context,domain:domain,}).then(function(records){var ids=_.pluck(records,'id');return self._rpc({model:field.relation,method:'name_get',args:[ids],context:context,}).then(function(name_gets){_.each(records,function(rec){var name_get=_.find(name_gets,function(n){return n[0]===rec.id;});rec.display_name=name_get[1];});return records;});});},_fetchSpecialRelation:function(record,fieldName){var field=record.fields[fieldName];if(!_.contains(["many2one","many2many","one2many"],field.type)){return Promise.resolve();}
var context=record.getContext({fieldName:fieldName});var domain=record.getDomain({fieldName:fieldName});var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domain:domain,});if(!hasChanged){return Promise.resolve();}
return this._rpc({model:field.relation,method:'name_search',args:["",domain],context:context});},_fetchSpecialReference:function(record,fieldName,fieldInfo){var field=record.fields[fieldName];if(field.type==='char'){return Promise.resolve(this._fetchReference(record,fieldName));}else if(fieldInfo.options.model_field){return this._fetchModelFieldReference(record,fieldName,fieldInfo);}
return Promise.resolve();},_fetchSpecialStatus:function(record,fieldName,fieldInfo){var foldField=fieldInfo.options.fold_field;var fieldsToRead=foldField?[foldField]:[];return this._fetchSpecialMany2ones(record,fieldName,fieldInfo,fieldsToRead).then(function(m2os){_.each(m2os,function(m2o){m2o.fold=foldField?m2o[foldField]:false;});return m2os;});},_fetchUngroupedList:function(list,options){options=_.defaults(options||{},{enableRelationalFetch:true});var self=this;var def;if(list.static){def=this._readUngroupedList(list).then(function(){if(list.parentID&&self.isNew(list.parentID)){var many2ones=self._getMany2OneFieldNames(list);var defs=_.map(many2ones,function(name){return self._fetchNameGets(list,name);});return Promise.all(defs);}});}else{def=this._searchReadUngroupedList(list);}
return def.then(function(){if(options.enableRelationalFetch){return Promise.all([self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list)]);}}).then(function(){return list;});},_fetchX2ManyBatched:function(list,fieldName){list=this._applyX2ManyOperations(list);this._sortList(list);var toFetch=this._getDataToFetch(list,fieldName);return this._fetchRelatedData(list,toFetch,fieldName);},_fetchX2Manys:function(record,options){var self=this;var defs=[];options=options||{};var fieldNames=options.fieldNames||record.getFieldNames(options);var viewType=options.viewType||record.viewType;_.each(fieldNames,function(fieldName){var field=record.fields[fieldName];if(field.type==='one2many'||field.type==='many2many'){var fieldInfo=record.fieldsInfo[viewType][fieldName];var rawContext=fieldInfo&&fieldInfo.context;var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:(fieldInfo.fieldsInfo||{});var ids=record.data[fieldName]||[];var list=self._makeDataPoint({count:ids.length,context:_.extend({},record.context,field.context),fieldsInfo:fieldsInfo,fields:view?view.fields:fieldInfo.relatedFields,limit:fieldInfo.limit,modelName:field.relation,res_ids:ids,static:true,type:'list',orderedBy:fieldInfo.orderedBy,parentID:record.id,rawContext:rawContext,relationField:field.relation_field,viewType:view?view.type:fieldInfo.viewType,});record.data[fieldName]=list.id;if(!fieldInfo.__no_fetch){var def=self._readUngroupedList(list).then(function(){return Promise.all([self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list)]);});defs.push(def);}}});return Promise.all(defs);},_fetchX2ManysBatched:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var i=0;i<fieldNames.length;i++){var field=list.fields[fieldNames[i]];if(field.type==='many2many'||field.type==='one2many'){defs.push(this._fetchX2ManyBatched(list,fieldNames[i]));}}
return Promise.all(defs);},_fetchX2ManySingleBatch:function(list,fieldName){var self=this;var toFetch={};_.each(list.data,function(groupIndex){var group=self.localData[groupIndex];var nextDataToFetch=self._getDataToFetch(group,fieldName);_.each(_.keys(nextDataToFetch),function(id){if(toFetch[id]){toFetch[id]=toFetch[id].concat(nextDataToFetch[id]);}else{toFetch[id]=nextDataToFetch[id];}});});return self._fetchRelatedData(list,toFetch,fieldName);},_fetchX2ManysSingleBatch:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var i=0;i<fieldNames.length;i++){var field=list.fields[fieldNames[i]];if(field.type==='many2many'||field.type==='one2many'){defs.push(this._fetchX2ManySingleBatch(list,fieldNames[i]));}}
return Promise.all(defs);},_generateChanges:function(record,options){options=options||{};var viewType=options.viewType||record.viewType;var changes;const changesOnly='changesOnly'in options?!!options.changesOnly:true;if(!changesOnly){changes=_.extend({},record.data,record._changes);}else{changes=_.extend({},record._changes);}
var withReadonly=options.withReadonly||false;var commands=this._generateX2ManyCommands(record,{changesOnly:changesOnly,withReadonly:withReadonly,});for(var fieldName in record.fields){if(!withReadonly&&fieldName in changes||fieldName in commands){var editionViewType=record._editionViewType[fieldName]||viewType;if(this._isFieldProtected(record,fieldName,editionViewType)){delete changes[fieldName];continue;}}
var type=record.fields[fieldName].type;var value;if(type==='one2many'||type==='many2many'){if(!changesOnly||(commands[fieldName]&&commands[fieldName].length)){changes[fieldName]=commands[fieldName];}else{delete changes[fieldName];}}else if(type==='many2one'&&fieldName in changes){value=changes[fieldName];changes[fieldName]=value?this.localData[value].res_id:false;}else if(type==='reference'&&fieldName in changes){value=changes[fieldName];changes[fieldName]=value?this.localData[value].model+','+this.localData[value].res_id:false;}else if(type==='char'&&changes[fieldName]===''){changes[fieldName]=false;}else if(changes[fieldName]===null){changes[fieldName]=false;}}
return changes;},_generateOnChangeData:function(record,options){options=_.extend({},options||{},{withReadonly:true});var data={};if(!options.firstOnChange){var commands=this._generateX2ManyCommands(record,options);data=_.extend(this.get(record.id,{raw:true}).data,commands);var hasDisplayName=_.some(record.fieldsInfo,function(fieldsInfo){return'display_name'in fieldsInfo;});if(!hasDisplayName){delete data.display_name;}}
if(record.parentID){var parent=this.localData[record.parentID];if(parent.parentID&&parent.relationField){var parentRecord=this.localData[parent.parentID];data[parent.relationField]=this._generateOnChangeData(parentRecord);}}
return data;},_generateX2ManyCommands:function(record,options){var self=this;options=options||{};var fields=record.fields;if(options.fieldNames){fields=_.pick(fields,options.fieldNames);}
var commands={};var data=_.extend({},record.data,record._changes);var type;for(var fieldName in fields){type=fields[fieldName].type;if(type==='many2many'||type==='one2many'){if(!data[fieldName]){continue;}
commands[fieldName]=[];var list=this.localData[data[fieldName]];if(options.changesOnly&&(!list._changes||!list._changes.length)){continue;}
var oldResIDs=list.res_ids.slice(0);var relRecordAdded=[];var relRecordUpdated=[];_.each(list._changes,function(change){if(change.operation==='ADD'&&change.id){relRecordAdded.push(self.localData[change.id]);}else if(change.operation==='UPDATE'&&!self.isNew(change.id)){relRecordUpdated.push(self.localData[change.id]);}});list=this._applyX2ManyOperations(list);this._sortList(list);if(type==='many2many'||list._forceM2MLink){var relRecordCreated=_.filter(relRecordAdded,function(rec){return typeof rec.res_id==='string';});var realIDs=_.difference(list.res_ids,_.pluck(relRecordCreated,'res_id'));commands[fieldName].push(x2ManyCommands.replace_with(realIDs));_.each(relRecordCreated,function(relRecord){var changes=self._generateChanges(relRecord,options);commands[fieldName].push(x2ManyCommands.create(relRecord.ref,changes));});_.each(relRecordUpdated,function(relRecord){var changes=self._generateChanges(relRecord,options);if(!_.isEmpty(changes)){var command=x2ManyCommands.update(relRecord.res_id,changes);commands[fieldName].push(command);}});}else if(type==='one2many'){var removedIds=_.difference(oldResIDs,list.res_ids);var addedIds=_.difference(list.res_ids,oldResIDs);var keptIds=_.intersection(oldResIDs,list.res_ids);var didChange=false;var changes,command,relRecord;for(var i=0;i<list.res_ids.length;i++){if(_.contains(keptIds,list.res_ids[i])){relRecord=_.findWhere(relRecordUpdated,{res_id:list.res_ids[i]});changes=relRecord?this._generateChanges(relRecord,options):{};if(!_.isEmpty(changes)){command=x2ManyCommands.update(relRecord.res_id,changes);didChange=true;}else{command=x2ManyCommands.link_to(list.res_ids[i]);}
commands[fieldName].push(command);}else if(_.contains(addedIds,list.res_ids[i])){relRecord=_.findWhere(relRecordAdded,{res_id:list.res_ids[i]});if(!relRecord){commands[fieldName].push(x2ManyCommands.link_to(list.res_ids[i]));continue;}
changes=this._generateChanges(relRecord,options);if(!this.isNew(relRecord.id)){commands[fieldName].push(x2ManyCommands.link_to(relRecord.res_id));if(this.isDirty(relRecord.id)){delete changes.id;commands[fieldName].push(x2ManyCommands.update(relRecord.res_id,changes));}}else{const rawChangesEntries=Object.entries(relRecord._rawChanges);for(const[fieldName,value]of rawChangesEntries){const isMany2OneValue=Array.isArray(value)&&value.length===2&&Number.isInteger(value[0])&&typeof value[1]==='string';changes[fieldName]=isMany2OneValue?value[0]:value;}
commands[fieldName].push(x2ManyCommands.create(relRecord.ref,changes));}}}
if(options.changesOnly&&!didChange&&addedIds.length===0&&removedIds.length===0){commands[fieldName]=[];}
for(i=0;i<removedIds.length;i++){if(list._forceM2MUnlink){commands[fieldName].push(x2ManyCommands.forget(removedIds[i]));}else{commands[fieldName].push(x2ManyCommands.delete(removedIds[i]));}}}}}
return commands;},_getContext:function(element,options){options=options||{};var context=new Context(session.user_context);context.set_eval_context(this._getEvalContext(element));if(options.full||!(options.fieldName||options.additionalContext)){context.add(element.context);}
if(options.fieldName){var viewType=options.viewType||element.viewType;var fieldInfo=element.fieldsInfo[viewType][options.fieldName];if(fieldInfo&&fieldInfo.context){context.add(fieldInfo.context);}else{var fieldParams=element.fields[options.fieldName];if(fieldParams.context){context.add(fieldParams.context);}}}
if(options.additionalContext){context.add(options.additionalContext);}
if(element.rawContext){var rawContext=new Context(element.rawContext);var evalContext=this._getEvalContext(this.localData[element.parentID]);evalContext.id=evalContext.id||false;rawContext.set_eval_context(evalContext);context.add(rawContext);}
return context.eval();},_getDataToFetch:function(list,fieldName){var self=this;var field=list.fields[fieldName];var fieldInfo=list.fieldsInfo[list.viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:fieldInfo.fieldsInfo;var fields=view?view.fields:fieldInfo.relatedFields;var viewType=view?view.type:fieldInfo.viewType;var toFetch={};let dataPointIds=list.data;for(let i=0;i<list.groupedBy.length;i++){dataPointIds=dataPointIds.reduce((acc,groupId)=>acc.concat(this.localData[groupId].data),[]);}
dataPointIds.forEach(function(dataPoint){var record=self.localData[dataPoint];if(typeof record.data[fieldName]==='string'){return;}
_.each(record.data[fieldName],function(id){toFetch[id]=toFetch[id]||[];toFetch[id].push(record);});var m2mList=self._makeDataPoint({fieldsInfo:fieldsInfo,fields:fields,modelName:field.relation,parentID:record.id,res_ids:record.data[fieldName],static:true,type:'list',viewType:viewType,});record.data[fieldName]=m2mList.id;});return toFetch;},_getDataToFetchByModel:function(list,fieldName,toFetchAcc){var self=this;var toFetch=toFetchAcc||{};_.each(list.data,function(dataPoint){var record=self.localData[dataPoint];var value=record.data[fieldName];if(value&&!self.localData[value]){var model=value.split(',')[0];var resID=value.split(',')[1];if(!(model in toFetch)){toFetch[model]={};}
if(toFetch[model][resID]){toFetch[model][resID].push(dataPoint);}else{toFetch[model][resID]=[dataPoint];}}});return toFetch;},_getDefaultContext:function(dataPoint){var defaultContext={};while(dataPoint.parentID){var parent=this.localData[dataPoint.parentID];var groupByField=parent.groupedBy[0].split(':')[0];var value=viewUtils.getGroupValue(dataPoint,groupByField);if(value){defaultContext['default_'+groupByField]=value;}
dataPoint=parent;}
return defaultContext;},_getDomain:function(element,options){if(options&&options.fieldName){if(element._domains[options.fieldName]){return Domain.prototype.stringToArray(element._domains[options.fieldName],this._getEvalContext(element,true));}
var viewType=options.viewType||element.viewType;var fieldInfo=element.fieldsInfo[viewType][options.fieldName];if(fieldInfo&&fieldInfo.domain){return Domain.prototype.stringToArray(fieldInfo.domain,this._getEvalContext(element,true));}
var fieldParams=element.fields[options.fieldName];if(fieldParams.domain){return Domain.prototype.stringToArray(fieldParams.domain,this._getEvalContext(element,true));}
return[];}
return Domain.prototype.stringToArray(element.domain,this._getEvalContext(element,true));},_getEvalContext:function(element,forDomain){var evalContext=element.type==='record'?this._getRecordEvalContext(element,forDomain):{};if(element.parentID){var parent=this.localData[element.parentID];if(parent.type==='list'&&parent.parentID){parent=this.localData[parent.parentID];}
if(parent.type==='record'){evalContext.parent=this._getRecordEvalContext(parent,forDomain);}}
let current_company_id;if(session.user_context.allowed_company_ids){current_company_id=session.user_context.allowed_company_ids[0];}else{current_company_id=session.user_companies?session.user_companies.current_company:false;}
return Object.assign({active_id:evalContext.id||false,active_ids:evalContext.id?[evalContext.id]:[],active_model:element.model,current_company_id,id:evalContext.id||false,},pyUtils.context(),session.user_context,element.context,evalContext,);},_getFieldNames:function(element,options){var fieldsInfo=element.fieldsInfo;var viewType=options&&options.viewType||element.viewType;return Object.keys(fieldsInfo&&fieldsInfo[viewType]||{});},_getGroupedListPropsToKeep(list,options){const{isOpen,offset,id}=list;let propsToKeep={isOpen,offset,id};if(options.onlyGroup||isOpen&&options.hasSubgroups){propsToKeep.data=list.data;if(options.onlyGroup){propsToKeep.res_ids=list.res_ids;propsToKeep.count=list.count;}}
return propsToKeep;},_getMany2OneFieldNames:function(datapoint){var many2ones=[];_.each(datapoint.fields,function(field,name){if(field.type==='many2one'){many2ones.push(name);}});return many2ones;},_getRecordEvalContext:function(record,forDomain){var self=this;var relDataPoint;var context=_.extend({},record.data,record._changes);function _generateX2ManyCommands(fieldName){var commands=self._generateX2ManyCommands(record,{fieldNames:[fieldName]});return commands[fieldName];}
for(var fieldName in context){var field=record.fields[fieldName];if(context[fieldName]===null){context[fieldName]=false;}
if(!field||field.name==='id'){continue;}
if(field.type==='date'||field.type==='datetime'){if(context[fieldName]){context[fieldName]=JSON.parse(JSON.stringify(context[fieldName]));}
continue;}
if(field.type==='many2one'){relDataPoint=this.localData[context[fieldName]];context[fieldName]=relDataPoint?relDataPoint.res_id:false;continue;}
if(field.type==='one2many'||field.type==='many2many'){var ids;if(!context[fieldName]||_.isArray(context[fieldName])){ids=context[fieldName]?context[fieldName].slice(0):[];}else{relDataPoint=this._applyX2ManyOperations(this.localData[context[fieldName]]);ids=relDataPoint.res_ids.slice(0);}
if(!forDomain){ids.toJSON=_generateX2ManyCommands.bind(null,fieldName);}else if(field.type==='one2many'){ids=_.filter(ids,function(id){return typeof id!=='string';});}
context[fieldName]=ids;}}
return context;},_getUngroupedListDomain(list){return list.domain||[];},_invalidateCache:function(dataPoint){while(dataPoint.parentID){dataPoint=this.localData[dataPoint.parentID];}
if(dataPoint.model==='res.currency'){session.reloadCurrencies();}
if(dataPoint.model==='res.company'&&!localStorage.getItem('running_tour')){this.do_action('reload_context');}
if(_.contains(this.noCacheModels,dataPoint.model)){core.bus.trigger('clear_cache');}},_isFieldProtected:function(record,fieldName,viewType){viewType=viewType||record.viewType;var fieldInfo=viewType&&record.fieldsInfo&&record.fieldsInfo[viewType][fieldName];if(fieldInfo){var rawModifiers=fieldInfo.modifiers||{};var modifiers=this._evalModifiers(record,_.pick(rawModifiers,'readonly'));return modifiers.readonly&&!fieldInfo.force_save;}else{return false;}},_isFieldSet:function(value,fieldType){switch(fieldType){case'boolean':return true;case'one2many':case'many2many':return value.length>0;default:return value!==false;}},_isX2ManyValid:function(id){var self=this;var isValid=true;var element=this.localData[id];_.each(element._changes,function(command){if(command.operation==='DELETE'||command.operation==='FORGET'||(command.operation==='ADD'&&!command.isNew)||command.operation==='REMOVE_ALL'){return;}
var recordData=self.get(command.id,{raw:true}).data;var record=self.localData[command.id];_.each(element.getFieldNames(),function(fieldName){var field=element.fields[fieldName];var fieldInfo=element.fieldsInfo[element.viewType][fieldName];var rawModifiers=fieldInfo.modifiers||{};var modifiers=self._evalModifiers(record,_.pick(rawModifiers,'required'));if(modifiers.required&&!self._isFieldSet(recordData[fieldName],field.type)){isValid=false;}});});return isValid;},_load:function(dataPoint,options){if(options&&options.onlyGroups&&!(dataPoint.type==='list'&&dataPoint.groupedBy.length)){return Promise.resolve(dataPoint);}
if(dataPoint.type==='record'){return this._fetchRecord(dataPoint,options);}
if(dataPoint.type==='list'&&dataPoint.groupedBy.length){return this._readGroup(dataPoint,options);}
if(dataPoint.type==='list'&&!dataPoint.groupedBy.length){return this._fetchUngroupedList(dataPoint,options);}},_makeDataPoint:function(params){var type=params.type||('domain'in params&&'list')||'record';var res_id,value;var res_ids=params.res_ids||[];var data=params.data||(type==='record'?{}:[]);var context=params.context;var fields=_.extend({display_name:{type:'char'},id:{type:'integer'},},params.fields);const groupedBy=params.groupedBy||[];let isM2MGrouped=false;if(type==='record'){res_id=params.res_id||(params.data&&params.data.id);if(res_id){data.id=res_id;}else{res_id=_.uniqueId('virtual_');}
context=_.omit(context,['orderedBy','group_by']);}else{var isValueArray=params.value instanceof Array;res_id=isValueArray?params.value[0]:undefined;value=isValueArray?params.value[1]:params.value;isM2MGrouped=groupedBy.some((group)=>{const[fieldName]=group.split(':');return fields[fieldName].type==="many2many";});}
var dataPoint={_cache:type==='list'?{}:undefined,_changes:null,_domains:{},_rawChanges:{},aggregateValues:params.aggregateValues||{},context:context,count:params.count||res_ids.length,data:data,domain:params.domain||[],fields:fields,fieldsInfo:params.fieldsInfo,groupedBy,groupsCount:0,groupsLimit:type==='list'&&params.groupsLimit||null,groupsOffset:0,id:`${params.modelName}_${++this.__id}`,isM2MGrouped,isOpen:params.isOpen,limit:type==='record'?1:(params.limit||Number.MAX_SAFE_INTEGER),loadMoreOffset:0,model:params.modelName,offset:params.offset||(type==='record'?_.indexOf(res_ids,res_id):0),openGroupByDefault:params.openGroupByDefault,orderedBy:params.orderedBy||[],orderedResIDs:params.orderedResIDs,parentID:params.parentID,rawContext:params.rawContext,ref:params.ref||res_id,relationField:params.relationField,res_id:res_id,res_ids:res_ids,specialData:{},_specialDataCache:{},static:params.static||false,type:type,value:value,range:params.range,viewType:params.viewType,};dataPoint._editionViewType={};dataPoint.evalModifiers=this._evalModifiers.bind(this,dataPoint);dataPoint.getContext=this._getContext.bind(this,dataPoint);dataPoint.getDomain=this._getDomain.bind(this,dataPoint);dataPoint.getFieldNames=this._getFieldNames.bind(this,dataPoint);dataPoint.isDirty=this.isDirty.bind(this,dataPoint.id);dataPoint.isNew=this.isNew.bind(this,dataPoint.id);this.localData[dataPoint.id]=dataPoint;return dataPoint;},async _makeDefaultRecord(modelName,params){var targetView=params.viewType;var fields=params.fields;var fieldsInfo=params.fieldsInfo;var fieldNames=Object.keys(fieldsInfo[targetView]);var parentRecord=params.parentID&&this.localData[params.parentID].type==='list'?this.localData[params.parentID]:null;if(parentRecord&&parentRecord.viewType in parentRecord.fieldsInfo){var originView=parentRecord.viewType;fieldNames=_.union(fieldNames,Object.keys(parentRecord.fieldsInfo[originView]));fieldsInfo[targetView]=_.defaults({},fieldsInfo[targetView],parentRecord.fieldsInfo[originView]);fields=_.defaults({},fields,parentRecord.fields);}
var record=this._makeDataPoint({modelName:modelName,fields:fields,fieldsInfo:fieldsInfo,context:params.context,parentID:params.parentID,res_ids:params.res_ids,viewType:targetView,});await this.generateDefaultValues(record.id,{},{fieldNames});try{await this._performOnChange(record,[],{firstOnChange:true});}finally{if(record._warning&&params.allowWarning){delete record._warning;}}
if(record._warning){return Promise.reject();}
var overrideDefaultFields=this._computeOverrideDefaultFields(params.parentID,params.position);if(overrideDefaultFields.field){record._changes[overrideDefaultFields.field]=overrideDefaultFields.value;}
await this._postprocess(record);this.save(record.id,{savePoint:true});return record.id;},_parseServerData:function(fieldNames,element,data){var self=this;_.each(fieldNames,function(fieldName){var field=element.fields[fieldName];var val=data[fieldName];if(field.type==='many2one'){if(val!==false){var r=self._makeDataPoint({modelName:field.relation,fields:{display_name:{type:'char'},id:{type:'integer'},},data:{display_name:val[1],id:val[0],},parentID:element.id,});data[fieldName]=r.id;}else{data[fieldName]=false;}}else{data[fieldName]=self._parseServerValue(field,val);}});},async _performOnChange(record,fields,options={}){const firstOnChange=options.firstOnChange;let{hasOnchange,onchangeSpec}=this._buildOnchangeSpecs(record,options.viewType);if(!firstOnChange&&!hasOnchange){return;}
var idList=record.data.id?[record.data.id]:[];const ctxOptions={full:true,};if(fields.length===1){fields=fields[0];ctxOptions.fieldName=fields;}
var context=this._getContext(record,ctxOptions);var currentData=this._generateOnChangeData(record,{changesOnly:false,firstOnChange,});const result=await this._rpc({model:record.model,method:'onchange',args:[idList,currentData,fields,onchangeSpec],context:context,});if(!record._changes){return;}
if(result.warning){this.trigger_up('warning',result.warning);record._warning=true;}
if(result.domain){record._domains=Object.assign(record._domains,result.domain);}
await this._applyOnChange(result.value,record,{firstOnChange});return result;},_performRPC:function(params){var self=this;var request=_.extend({},params);var prom=new Promise(function(resolve,reject){request.resolve=resolve;request.reject=reject;});this.batchedRPCsRequests.push(request);Promise.resolve().then(function(){if(!self.batchedRPCsRequests.length){return;}
var batchedRPCsRequests=self.batchedRPCsRequests;self.batchedRPCsRequests=[];var batches={};var key;for(var i=0;i<batchedRPCsRequests.length;i++){var request=batchedRPCsRequests[i];key=request.model+','+JSON.stringify(request.context);if(!batches[key]){batches[key]=_.extend({},request,{requests:[request]});}else{batches[key].ids=_.uniq(batches[key].ids.concat(request.ids));batches[key].fieldNames=_.uniq(batches[key].fieldNames.concat(request.fieldNames));batches[key].requests.push(request);}}
function onSuccess(batch,results){for(var i=0;i<batch.requests.length;i++){var request=batch.requests[i];var fieldNames=request.fieldNames.concat(['id']);var filteredResults=results.filter(function(record){return request.ids.indexOf(record.id)>=0;}).map(function(record){return _.pick(record,fieldNames);});request.resolve(filteredResults);}}
function onFailure(batch,error){for(var i=0;i<batch.requests.length;i++){var request=batch.requests[i];request.reject(error);}}
for(key in batches){var batch=batches[key];self._rpc({model:batch.model,method:'read',args:[batch.ids,batch.fieldNames],context:batch.context,}).then(onSuccess.bind(null,batch)).guardedCatch(onFailure.bind(null,batch));}});return prom;},_postprocess:function(record,options){var self=this;var viewType=options&&options.viewType||record.viewType;var defs=[];_.each(record.getFieldNames(options),function(name){var field=record.fields[name];var fieldInfo=record.fieldsInfo[viewType][name]||{};var options=fieldInfo.options||{};if(options.always_reload){if(record.fields[name].type==='many2one'){const _changes=record._changes||{};const relRecordId=_changes[name]||record.data[name];if(!relRecordId){return;}
var relRecord=self.localData[relRecordId];defs.push(self._rpc({model:field.relation,method:'name_get',args:[relRecord.data.id],context:self._getContext(record,{fieldName:name,viewType:viewType}),}).then(function(result){relRecord.data.display_name=result[0][1];}));}}});defs.push(this._fetchSpecialData(record,options));return Promise.all(defs).then(function(){return record;});},_processX2ManyCommands:function(record,fieldName,commands,options){var self=this;options=options||{};var defs=[];var field=record.fields[fieldName];var fieldInfo=record.fieldsInfo[options.viewType||record.viewType][fieldName]||{};var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:fieldInfo.fieldsInfo;var fields=view?view.fields:fieldInfo.relatedFields;var viewType=view?view.type:fieldInfo.viewType;var parentContext=_.omit(record.context,function(val,key){return _.str.startsWith(key,'default_');});var x2manyList=self._makeDataPoint({context:parentContext,fieldsInfo:fieldsInfo,fields:fields,limit:fieldInfo.limit,modelName:field.relation,parentID:record.id,rawContext:fieldInfo&&fieldInfo.context,relationField:field.relation_field,res_ids:[],static:true,type:'list',viewType:viewType,});record._changes[fieldName]=x2manyList.id;x2manyList._changes=[];var many2ones={};var r;commands=commands||[];var isCommandList=commands.length&&_.isArray(commands[0]);if(!isCommandList){commands=[[6,false,commands]];}
_.each(commands,function(value){if(value[0]===0){r=self._makeDataPoint({modelName:x2manyList.model,context:x2manyList.context,fieldsInfo:fieldsInfo,fields:fields,parentID:x2manyList.id,viewType:viewType,});r._noAbandon=true;x2manyList._changes.push({operation:'ADD',id:r.id});x2manyList._cache[r.res_id]=r.id;_.each(r.getFieldNames(),function(fieldName){r.data[fieldName]=null;});r._changes=_.defaults(value[2],r.data);for(var fieldName in r._changes){if(!r._changes[fieldName]){continue;}
var isFieldInView=fieldName in r.fields;if(isFieldInView){var field=r.fields[fieldName];var fieldType=field.type;var rec;if(fieldType==='many2one'){rec=self._makeDataPoint({context:r.context,modelName:field.relation,data:{id:r._changes[fieldName]},parentID:r.id,});r._changes[fieldName]=rec.id;many2ones[fieldName]=true;}else if(fieldType==='reference'){var reference=r._changes[fieldName].split(',');rec=self._makeDataPoint({context:r.context,modelName:reference[0],data:{id:parseInt(reference[1])},parentID:r.id,});r._changes[fieldName]=rec.id;many2ones[fieldName]=true;}else if(_.contains(['one2many','many2many'],fieldType)){var x2mCommands=value[2][fieldName];defs.push(self._processX2ManyCommands(r,fieldName,x2mCommands));}else{r._changes[fieldName]=self._parseServerValue(field,r._changes[fieldName]);}}}}
if(value[0]===6){_.each(value[2],function(res_id){x2manyList._changes.push({operation:'ADD',resID:res_id});});var def=self._readUngroupedList(x2manyList).then(function(){return Promise.all([self._fetchX2ManysBatched(x2manyList),self._fetchReferencesBatched(x2manyList)]);});defs.push(def);}});_.each(_.keys(many2ones),function(name){defs.push(self._fetchNameGets(x2manyList,name));});return Promise.all(defs);},_readMissingFields:function(list,resIDs,fieldNames){var self=this;var missingIDs=[];for(var i=0,len=resIDs.length;i<len;i++){var resId=resIDs[i];var dataPointID=list._cache[resId];if(!dataPointID){missingIDs.push(resId);continue;}
var record=self.localData[dataPointID];var data=_.extend({},record.data,record._changes);if(_.difference(fieldNames,_.keys(data)).length){missingIDs.push(resId);}}
var def;if(missingIDs.length&&fieldNames.length){def=self._performRPC({context:list.getContext(),fieldNames:fieldNames,ids:missingIDs,method:'read',model:list.model,});}else{def=Promise.resolve(_.map(missingIDs,function(id){return{id:id};}));}
return def.then(function(records){_.each(resIDs,function(id){var dataPoint;var data=_.findWhere(records,{id:id});if(id in list._cache){dataPoint=self.localData[list._cache[id]];if(data){self._parseServerData(fieldNames,dataPoint,data);_.extend(dataPoint.data,data);}}else{dataPoint=self._makeDataPoint({context:list.getContext(),data:data,fieldsInfo:list.fieldsInfo,fields:list.fields,modelName:list.model,parentID:list.id,viewType:list.viewType,});self._parseServerData(fieldNames,dataPoint,dataPoint.data);list._cache[id]=dataPoint.id;}
_.each(list._changes,function(change){if(change.operation==='ADD'&&!change.id&&change.resID===id){change.id=dataPoint.id;}});});return list;});},_readGroup:function(list,options){var self=this;options=options||{};var groupByField=list.groupedBy[0];var rawGroupBy=groupByField.split(':')[0];var fields=_.uniq(list.getFieldNames().concat(rawGroupBy));var orderedBy=_.filter(list.orderedBy,function(order){return order.name===rawGroupBy||list.fields[order.name].group_operator!==undefined;});var openGroupsLimit=list.groupsLimit||self.OPEN_GROUP_LIMIT;var expand=list.openGroupByDefault&&options.fetchRecordsWithGroups;return this._rpc({model:list.model,method:'web_read_group',fields:fields,domain:list.domain,context:list.context,groupBy:list.groupedBy,limit:list.groupsLimit,offset:list.groupsOffset,orderBy:orderedBy,lazy:true,expand:expand,expand_limit:expand?list.limit:null,expand_orderby:expand?list.orderedBy:null,}).then(function(result){var groups=result.groups;list.groupsCount=result.length;var previousGroups=_.map(list.data,function(groupID){return self.localData[groupID];});list.data=[];list.count=0;var defs=[];var openGroupCount=0;_.each(groups,function(group){var aggregateValues={};_.each(group,function(value,key){if(_.contains(fields,key)&&key!==groupByField&&AGGREGATABLE_TYPES.includes(list.fields[key].type)){aggregateValues[key]=value;}});var value=group[groupByField];if(list.fields[rawGroupBy].type==="selection"){var choice=_.find(list.fields[rawGroupBy].selection,function(c){return c[0]===value;});value=choice?choice[1]:false;}
var newGroup=self._makeDataPoint({modelName:list.model,count:group[rawGroupBy+'_count'],domain:group.__domain,context:list.context,fields:list.fields,fieldsInfo:list.fieldsInfo,value:value,range:group.__range,aggregateValues:aggregateValues,groupedBy:list.groupedBy.slice(1),orderedBy:list.orderedBy,orderedResIDs:list.orderedResIDs,limit:list.limit,openGroupByDefault:list.openGroupByDefault,parentID:list.id,type:'list',viewType:list.viewType,});var oldGroup=_.find(previousGroups,function(g){return g.res_id===newGroup.res_id&&g.value===newGroup.value;});if(oldGroup){delete self.localData[newGroup.id];const oldPropsToKeep=self._getGroupedListPropsToKeep(oldGroup,{onlyGroup:options.onlyGroups,hasSubgroups:newGroup.groupedBy.length});Object.assign(newGroup,oldPropsToKeep);newGroup.limit=oldGroup.limit+oldGroup.loadMoreOffset;self.localData[newGroup.id]=newGroup;}else if(!newGroup.openGroupByDefault||openGroupCount>=openGroupsLimit){newGroup.isOpen=false;}else if('__fold'in group){newGroup.isOpen=!group.__fold;}else{newGroup.isOpen=!self.localData[newGroup.parentID].parentID;}
list.data.push(newGroup.id);list.count+=newGroup.count;if(newGroup.isOpen&&newGroup.count>0){openGroupCount++;if(group.__data){newGroup.__data=group.__data;}
options=_.defaults({enableRelationalFetch:false},options);defs.push(self._load(newGroup,options));}});if(options.keepEmptyGroups){var emptyGroupsIDs=_.difference(_.pluck(previousGroups,'id'),list.data);_.each(emptyGroupsIDs,function(groupID){list.data.push(groupID);var emptyGroup=self.localData[groupID];emptyGroup.aggregateValues={};});}
return Promise.all(defs).then(function(groups){if(!options.onlyGroups){list.res_ids=_.flatten(_.map(groups,function(group){return group?group.res_ids:[];}));}
return list;}).then(function(){return Promise.all([self._fetchX2ManysSingleBatch(list),self._fetchReferencesSingleBatch(list)]).then(function(){return list;});});});},_readUngroupedList:function(list){var self=this;var def=Promise.resolve();list=this._applyX2ManyOperations(list);if(list.res_ids.length>list.limit&&list.orderedBy.length){if(!list.orderedResIDs){var fieldNames=_.pluck(list.orderedBy,'name');def=this._readMissingFields(list,_.filter(list.res_ids,_.isNumber),fieldNames);}
def.then(function(){self._sortList(list);});}
return def.then(function(){var resIDs=[];var currentResIDs=list.res_ids;if(list.orderedResIDs){currentResIDs=list.orderedResIDs.filter(function(resID){return list.res_ids.indexOf(resID)>=0;});}
var currentCount=currentResIDs.length;var upperBound=list.limit?Math.min(list.offset+list.limit,currentCount):currentCount;var fieldNames=list.getFieldNames();for(var i=list.offset;i<upperBound;i++){var resId=currentResIDs[i];if(_.isNumber(resId)){resIDs.push(resId);}}
return self._readMissingFields(list,resIDs,fieldNames).then(function(){if(list.res_ids.length<=list.limit){self._sortList(list);}else{self._setDataInRange(list);}
return list;});});},_reload:function(id,options){options=options||{};var element=this.localData[id];if(element.type==='record'){if(!options.currentId&&(('currentId'in options)||this.isNew(id))){var params={context:element.context,fieldsInfo:element.fieldsInfo,fields:element.fields,viewType:element.viewType,allowWarning:true,};return this._makeDefaultRecord(element.model,params);}
if(!options.keepChanges){this.discardChanges(id,{rollback:false});}}else if(element._changes){delete element.tempLimitIncrement;_.each(element._changes,function(change){delete change.isNew;});}
if(options.context!==undefined){element.context=options.context;}
if(options.orderedBy!==undefined){element.orderedBy=(options.orderedBy.length&&options.orderedBy)||element.orderedBy;}
if(options.domain!==undefined){element.domain=options.domain;}
if(options.groupBy!==undefined){element.groupedBy=options.groupBy;element.isM2MGrouped=element.groupedBy.some((group)=>{const[fieldName]=group.split(':');return element.fields[fieldName].type==="many2many";});}
if(options.limit!==undefined){element.limit=options.limit;}
if(options.offset!==undefined){this._setOffset(element.id,options.offset);}
if(options.groupsLimit!==undefined){element.groupsLimit=options.groupsLimit;}
if(options.groupsOffset!==undefined){element.groupsOffset=options.groupsOffset;}
if(options.loadMoreOffset!==undefined){element.loadMoreOffset=options.loadMoreOffset;}else{element.loadMoreOffset=0;}
if(options.currentId!==undefined){element.res_id=options.currentId;}
if(options.ids!==undefined){element.res_ids=options.ids;element.count=element.res_ids.length;}
if(element.type==='record'){element.offset=_.indexOf(element.res_ids,element.res_id);}
var loadOptions=_.pick(options,'fieldNames','viewType');return this._load(element,loadOptions).then(function(result){return result.id;});},async _rpc(params){const result=await this._super(...arguments);if(this.sampleModel&&params.method==='web_read_group'&&result.length){const sampleServer=this.sampleModel.sampleServer;sampleServer.setExistingGroups(result.groups);}
return result;},_saveSpecialDataCache:function(record,fieldName,value){if(_.isEqual(record._specialDataCache[fieldName],value)){return false;}
record._specialDataCache[fieldName]=value;return true;},_searchReadUngroupedList:function(list){var self=this;var fieldNames=list.getFieldNames();var prom;if(list.__data){prom=Promise.resolve(list.__data);}else{prom=this._rpc({route:'/web/dataset/search_read',model:list.model,fields:fieldNames,context:_.extend({},list.getContext(),{bin_size:true}),domain:this._getUngroupedListDomain(list),limit:list.limit,offset:list.loadMoreOffset+list.offset,orderBy:list.orderedBy,});}
return prom.then(function(result){delete list.__data;list.count=result.length;var ids=_.pluck(result.records,'id');var data=_.map(result.records,function(record){var dataPoint=self._makeDataPoint({context:list.context,data:record,fields:list.fields,fieldsInfo:list.fieldsInfo,modelName:list.model,parentID:list.id,viewType:list.viewType,});self._parseServerData(fieldNames,dataPoint,dataPoint.data);return dataPoint.id;});if(list.loadMoreOffset){list.data=list.data.concat(data);list.res_ids=list.res_ids.concat(ids);}else{list.data=data;list.res_ids=ids;}
self._updateParentResIDs(list);return list;});},_setDataInRange:function(list){var idsInRange;if(list.limit){idsInRange=list.res_ids.slice(list.offset,list.offset+list.limit);}else{idsInRange=list.res_ids;}
list.data=[];_.each(idsInRange,function(id){if(list._cache[id]){list.data.push(list._cache[id]);}});if(list.limit){for(var i=list.offset+list.limit;i<list.res_ids.length;i++){var id=list.res_ids[i];var dataPointID=list._cache[id];if(_.findWhere(list._changes,{isNew:true,id:dataPointID})){list.data.push(dataPointID);}else{break;}}}},_setOffset:function(elementId,offset){var element=this.localData[elementId];element.offset=offset;if(element.type==='record'&&element.res_ids.length){element.res_id=element.res_ids[offset];}},_sortList:function(list){if(!list.static){return;}
var self=this;if(list.orderedResIDs){var orderedResIDs={};for(var k=0;k<list.orderedResIDs.length;k++){orderedResIDs[list.orderedResIDs[k]]=k;}
utils.stableSort(list.res_ids,function compareResIdIndexes(resId1,resId2){if(!(resId1 in orderedResIDs)&&!(resId2 in orderedResIDs)){return 0;}
if(!(resId1 in orderedResIDs)){return Infinity;}
if(!(resId2 in orderedResIDs)){return-Infinity;}
return orderedResIDs[resId1]-orderedResIDs[resId2];});}else if(list.orderedBy.length){var compareRecords=function(resId1,resId2,level){if(!level){level=0;}
if(list.orderedBy.length<level+1){return 0;}
var order=list.orderedBy[level];var record1ID=list._cache[resId1];var record2ID=list._cache[resId2];if(!record1ID&&!record2ID){return 0;}
if(!record1ID){return Infinity;}
if(!record2ID){return-Infinity;}
var r1=self.localData[record1ID];var r2=self.localData[record2ID];var data1=_.extend({},r1.data,r1._changes);var data2=_.extend({},r2.data,r2._changes);var orderData1=data1[order.name];var orderData2=data2[order.name];if(list.fields[order.name].type==='many2one'){orderData1=orderData1?self.localData[orderData1].data.display_name:"";orderData2=orderData2?self.localData[orderData2].data.display_name:"";}
if(orderData1<orderData2){return order.asc?-1:1;}
if(orderData1>orderData2){return order.asc?1:-1;}
return compareRecords(resId1,resId2,level+1);};utils.stableSort(list.res_ids,compareRecords);}
this._setDataInRange(list);},_updateParentResIDs:function(element){var self=this;if(element.parentID){var parent=this.localData[element.parentID];parent.res_ids=_.flatten(_.map(parent.data,function(dataPointID){return self.localData[dataPointID].res_ids;}));this._updateParentResIDs(parent);}},_updateRecordsData:function(records,fieldName,values){if(!records.length||!values){return;}
var self=this;var field=records[0].fields[fieldName];var fieldInfo=records[0].fieldsInfo[records[0].viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:fieldInfo.fieldsInfo;var fields=view?view.fields:fieldInfo.relatedFields;var viewType=view?view.type:fieldInfo.viewType;_.each(records,function(record){var x2mList=self.localData[record.data[fieldName]];x2mList.data=[];_.each(x2mList.res_ids,function(res_id){var dataPoint=self._makeDataPoint({modelName:field.relation,data:_.findWhere(values,{id:res_id}),fields:fields,fieldsInfo:fieldsInfo,parentID:x2mList.id,viewType:viewType,});x2mList.data.push(dataPoint.id);x2mList._cache[res_id]=dataPoint.id;});});},_updateDuplicateRecords(recordID,updateFn){const{model,res_id}=this.localData[recordID];const getTopmostID=()=>{let element=this.localData[recordID];while(element.parentID&&this.localData[element.parentID].type==="list"){element=this.localData[element.parentID];}
return element.type==="list"&&element.isM2MGrouped?element.id:false;};const topmostID=getTopmostID();if(!topmostID){return;}
const topmostList=this.get(topmostID);utils.traverse_records(topmostList,(r)=>{if(r.res_id===res_id&&r.id!==recordID){updateFn(r.id);}});},_visitChildren:function(element,fn){var self=this;fn(element);if(element.type==='record'){for(var fieldName in element.data){var field=element.fields[fieldName];if(!field){continue;}
if(_.contains(['one2many','many2one','many2many'],field.type)){var hasChange=element._changes&&fieldName in element._changes;var value=hasChange?element._changes[fieldName]:element.data[fieldName];var relationalElement=this.localData[value];if(relationalElement){self._visitChildren(relationalElement,fn);}}}}
if(element.type==='list'){element=this._applyX2ManyOperations(element);_.each(element.data,function(elemId){var elem=self.localData[elemId];self._visitChildren(elem,fn);});}},});return BasicModel;});;

/* /web/static/src/legacy/js/views/basic/basic_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');const session=require('web.session');const utils=require('web.utils');const widgetRegistry=require('web.widget_registry');const widgetRegistryOwl=require("web.widgetRegistry");const{WidgetAdapterMixin}=require('web.OwlCompatibility');const FieldWrapper=require('web.FieldWrapper');const WidgetWrapper=require("web.WidgetWrapper");var qweb=core.qweb;const _t=core._t;var BasicRenderer=AbstractRenderer.extend(WidgetAdapterMixin,{custom_events:{navigation_move:'_onNavigationMove',},init:function(parent,state,params){this._super.apply(this,arguments);this.activeActions=params.activeActions;this.viewType=params.viewType;this.mode=params.mode||'readonly';this.widgets=[];this.handleField=null;},destroy:function(){this._super.apply(this,arguments);WidgetAdapterMixin.destroy.call(this);},on_attach_callback:function(){this._isInDom=true;for(const handle in this.allFieldWidgets){this.allFieldWidgets[handle].forEach(widget=>{if(!utils.isComponent(widget.constructor)&&widget.on_attach_callback){widget.on_attach_callback();}});}
this.widgets.forEach(widget=>{if(widget.on_attach_callback){widget.on_attach_callback();}});WidgetAdapterMixin.on_attach_callback.call(this);},on_detach_callback:function(){this._isInDom=false;for(const handle in this.allFieldWidgets){this.allFieldWidgets[handle].forEach(widget=>{if(!utils.isComponent(widget.constructor)&&widget.on_detach_callback){widget.on_detach_callback();}});}
this.widgets.forEach(widget=>{if(widget.on_detach_callback){widget.on_detach_callback();}});WidgetAdapterMixin.on_detach_callback.call(this);},canBeSaved:function(recordID){var self=this;var invalidFields=[];_.each(this.allFieldWidgets[recordID],function(widget){var canBeSaved=self._canWidgetBeSaved(widget);if(!canBeSaved){invalidFields.push(widget.name);}
if(widget.el){widget.$el.toggleClass('o_field_invalid',!canBeSaved);widget.$el.attr('aria-invalid',!canBeSaved);}});return invalidFields;},commitChanges:function(recordID){var defs=_.map(this.allFieldWidgets[recordID],function(widget){return widget.commitChanges();});return Promise.all(defs);},confirmChange:function(state,id,fields,ev){var self=this;this._setState(state);var record=this._getRecord(id);if(!record){return this._render().then(_.constant([]));}
_.invoke(this.widgets,'updateState',state);var defs=[];_.each(this.allFieldWidgets[id],function(widget){var fieldChanged=_.contains(fields,widget.name);if(fieldChanged||widget.resetOnAnyFieldChange){defs.push(widget.reset(record,ev,fieldChanged));}});defs.push(this._updateAllModifiers(record));return Promise.all(defs).then(function(){return _.filter(self.allFieldWidgets[id],function(widget){var fieldChanged=_.contains(fields,widget.name);return fieldChanged||widget.resetOnAnyFieldChange;});});},focusField:function(id,fieldName,offset){this.editRecord(id);if(typeof offset==="number"){var field=_.findWhere(this.allFieldWidgets[id],{name:fieldName});dom.setSelectionRange(field.getFocusableElement().get(0),{start:offset,end:offset});}},_activateFieldWidget:function(record,currentIndex,options){options=options||{};_.defaults(options,{inc:1,wrap:false});currentIndex=Math.max(0,currentIndex);var recordWidgets=this.allFieldWidgets[record.id]||[];for(var i=0;i<recordWidgets.length;i++){var activated=recordWidgets[currentIndex].activate({event:options.event,noAutomaticCreate:options.noAutomaticCreate||false});if(activated){return currentIndex;}
currentIndex+=options.inc;if(currentIndex>=recordWidgets.length){if(options.wrap){currentIndex-=recordWidgets.length;}else{return-1;}}else if(currentIndex<0){if(options.wrap){currentIndex+=recordWidgets.length;}else{return-1;}}}
return-1;},_activateNextFieldWidget:function(record,currentIndex,options){currentIndex=(currentIndex+1)%(this.allFieldWidgets[record.id]||[]).length;return this._activateFieldWidget(record,currentIndex,_.extend({inc:1},options));},_activatePreviousFieldWidget:function(record,currentIndex){currentIndex=currentIndex?(currentIndex-1):((this.allFieldWidgets[record.id]||[]).length-1);return this._activateFieldWidget(record,currentIndex,{inc:-1});},_addFieldTooltip:function(widget,$node){$node=$node.length?$node:widget.$el;$node.tooltip(this._getTooltipOptions(widget));},_applyModifiers:function(modifiersData,record,element){var self=this;var modifiers=modifiersData.evaluatedModifiers[record.id]||{};if(element){_apply(element);}else{_.each(_.clone(modifiersData.elementsByRecord[record.id]),_apply);}
function _apply(element){if('readonly'in modifiers&&element.widget){var mode=modifiers.readonly?'readonly':modifiersData.baseModeByRecord[record.id];if(mode!==element.widget.mode){self._rerenderFieldWidget(element.widget,record,{keepBaseMode:true,mode:mode,});return;}}
element.$el.toggleClass("o_invisible_modifier",!!modifiers.invisible);element.$el.toggleClass("o_readonly_modifier",!!modifiers.readonly);element.$el.toggleClass("o_required_modifier",!!modifiers.required);if(element.widget&&element.widget.updateModifiersValue){element.widget.updateModifiersValue(modifiers);}
if(element.callback){element.callback(element,modifiers,record);}}},_canWidgetBeSaved:function(widget){var modifiers=this._getEvaluatedModifiers(widget.__node,widget.record);return widget.isValid()&&(widget.isSet()||!modifiers.required);},_destroyFieldWidget:function(recordID,widget){var recordWidgets=this.allFieldWidgets[recordID];var index=recordWidgets.indexOf(widget);if(index>=0){recordWidgets.splice(index,1);}
this._unregisterModifiersElement(widget.__node,recordID,widget);widget.destroy();return index;},_getEvaluatedModifiers:function(node,record){var element=this._getModifiersData(node);if(!element){return{};}
return element.evaluatedModifiers[record.id]||{};},_getModifiersData:function(node){return _.findWhere(this.allModifiersData,{node:node});},_getRecord:function(recordId){return null;},_getTooltipOptions:function(widget){return{template:'<div class="tooltip tooltip-field-info" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',title:function(){let help=widget.attrs.help||widget.field.help||'';if(session.display_switch_company_menu&&widget.field.company_dependent){help+=(help?'\n\n':'')+_t('Values set here are company-specific.');}
const debug=config.isDebug();if(help||debug){return qweb.render('WidgetLabel.tooltip',{debug,help,widget});}}};},_handleAttributes:function($el,node){if($el.is('button')){return;}
if(node.attrs.class){$el.addClass(node.attrs.class);}
if(node.attrs.style){$el.attr('style',node.attrs.style);}
if(node.attrs.placeholder){$el.attr('placeholder',node.attrs.placeholder);}},_hasContent:function(){return this.state.count!==0&&(!('isSample'in this.state)||!this.state.isSample);},_moveRecord:function(recordId,toIndex){var self=this;var records=this.state.data;var record=_.findWhere(records,{id:recordId});var fromIndex=records.indexOf(record);var lowerIndex=Math.min(fromIndex,toIndex);var upperIndex=Math.max(fromIndex,toIndex)+1;var order=_.findWhere(this.state.orderedBy,{name:this.handleField});var asc=!order||order.asc;var reorderAll=false;var sequence=(asc?-1:1)*Infinity;_.each(records,function(record,index){if(((index<lowerIndex||index>=upperIndex)&&((asc&&sequence>=record.data[self.handleField])||(!asc&&sequence<=record.data[self.handleField])))||(index>=lowerIndex&&index<upperIndex&&sequence===record.data[self.handleField])){reorderAll=true;}
sequence=record.data[self.handleField];});if(reorderAll){records=_.without(records,record);records.splice(toIndex,0,record);}else{records=records.slice(lowerIndex,upperIndex);records=_.without(records,record);if(fromIndex>toIndex){records.unshift(record);}else{records.push(record);}}
var sequences=_.pluck(_.pluck(records,'data'),this.handleField);var recordIds=_.pluck(records,'id');if(!asc){recordIds.reverse();}
this.trigger_up('resequence_records',{handleField:this.handleField,offset:_.min(sequences),recordIds:recordIds,});},_postProcessField:function(widget,node){this._handleAttributes(widget.$el,node);},_registerModifiers:function(node,record,element,options){options=options||{};var modifiersData=this._getModifiersData(node);if(!modifiersData){var modifiers=node.attrs.modifiers||{};modifiersData={node:node,modifiers:modifiers,evaluatedModifiers:{},elementsByRecord:{},baseModeByRecord:{},};if(!_.isEmpty(modifiers)){this.allModifiersData.push(modifiersData);}}
if(!modifiersData.baseModeByRecord[record.id]||!options.keepBaseMode){modifiersData.baseModeByRecord[record.id]=options.mode||this.mode;}
if(!modifiersData.evaluatedModifiers[record.id]){try{modifiersData.evaluatedModifiers[record.id]=record.evalModifiers(modifiersData.modifiers);}catch(e){throw new Error(_.str.sprintf("While parsing modifiers for %s%s: %s",node.tag,node.tag==='field'?' '+node.attrs.name:'',e.message));}}
if(element){var newElement={};if(element instanceof jQuery){newElement.$el=element;}else{newElement.widget=element;newElement.$el=element.$el;}
if(options&&options.callback){newElement.callback=options.callback;}
if(!modifiersData.elementsByRecord[record.id]){modifiersData.elementsByRecord[record.id]=[];}
modifiersData.elementsByRecord[record.id].push(newElement);this._applyModifiers(modifiersData,record,newElement);}
return modifiersData.evaluatedModifiers[record.id];},async _render(){const oldAllFieldWidgets=this.allFieldWidgets;this.allFieldWidgets={};this.allModifiersData=[];const oldWidgets=this.widgets;this.widgets=[];await this._super(...arguments);for(const id in oldAllFieldWidgets){for(const widget of oldAllFieldWidgets[id]){widget.destroy();}}
for(const widget of oldWidgets){widget.destroy();}
if(this._isInDom){for(const handle in this.allFieldWidgets){this.allFieldWidgets[handle].forEach(widget=>{if(!utils.isComponent(widget.constructor)&&widget.on_attach_callback){widget.on_attach_callback();}});}
this.widgets.forEach(widget=>{if(widget.on_attach_callback){widget.on_attach_callback();}});WidgetAdapterMixin.on_attach_callback.call(this);}},_renderFieldWidget:function(node,record,options){options=options||{};var fieldName=node.attrs.name;var mode=options.mode||this.mode;var modifiers=this._registerModifiers(node,record,null,options);var Widget=record.fieldsInfo[this.viewType][fieldName].Widget;const legacy=!(Widget.prototype instanceof owl.Component);const widgetOptions={hasReadonlyModifier:modifiers.readonly,mode:modifiers.readonly?'readonly':mode,viewType:this.viewType,};let widget;if(legacy){widget=new Widget(this,fieldName,record,widgetOptions);}else{widget=new FieldWrapper(this,Widget,{fieldName,record,options:widgetOptions,});}
if(this.allFieldWidgets[record.id]===undefined){this.allFieldWidgets[record.id]=[];}
this.allFieldWidgets[record.id].push(widget);widget.__node=node;var $el=$('<div>');let def;if(legacy){def=widget._widgetRenderAndInsert(function(){});}else{def=widget.mount(document.createDocumentFragment());}
this.defs.push(def);var self=this;def.then(function(){widget.$el.addClass($el.attr('class'));$el.replaceWith(widget.$el);self._registerModifiers(node,record,widget,{callback:function(element,modifiers,record){element.$el.toggleClass('o_field_empty',!!(record.data.id&&(modifiers.readonly||mode==='readonly')&&element.widget.isEmpty()));},keepBaseMode:!!options.keepBaseMode,mode:mode,});self._postProcessField(widget,node);});return $el;},_renderWidget:function(record,node){const name=node.attrs.name;const Widget=widgetRegistryOwl.get(name)||widgetRegistry.get(name);const legacy=!(Widget.prototype instanceof owl.Component);let widget;if(legacy){widget=new Widget(this,record,node,{mode:this.mode});}else{widget=new WidgetWrapper(this,Widget,{record,node,options:{mode:this.mode},});}
this.widgets.push(widget);let def;if(legacy){def=widget._widgetRenderAndInsert(function(){});}else{def=widget.mount(document.createDocumentFragment());}
this.defs.push(def);var $el=$('<div>');var self=this;def.then(function(){self._handleAttributes(widget.$el,node);self._registerModifiers(node,record,widget);widget.$el.addClass('o_widget');$el.replaceWith(widget.$el);});return $el;},_rerenderFieldWidget:function(widget,record,options){var $el=this._renderFieldWidget(widget.__node,record,options);const recordWidgets=this.allFieldWidgets[record.id];const newWidget=recordWidgets[recordWidgets.length-1];const def=this.defs[this.defs.length-1];const $div=$('<div>');$div.append($el);def.then(()=>{widget.$el.replaceWith($div.children());recordWidgets.splice(recordWidgets.indexOf(newWidget),1);var oldIndex=this._destroyFieldWidget(record.id,widget);recordWidgets.splice(oldIndex,0,newWidget);if(this._isInDom&&newWidget.on_attach_callback){newWidget.on_attach_callback();}});},_unregisterModifiersElement:function(node,recordID,element){var modifiersData=this._getModifiersData(node);if(modifiersData){var elements=modifiersData.elementsByRecord[recordID];var index=_.findIndex(elements,function(oldElement){return oldElement.widget===element||oldElement.$el[0]===element[0];});if(index>=0){elements.splice(index,1);}}},_updateAllModifiers:function(record){var self=this;var defs=[];this.defs=defs;_.each(this.allModifiersData,function(modifiersData){if(record.id in modifiersData.evaluatedModifiers){modifiersData.evaluatedModifiers[record.id]=record.evalModifiers(modifiersData.modifiers);self._applyModifiers(modifiersData,record);}});delete this.defs;return Promise.all(defs);},_onNavigationMove:function(ev){},});return BasicRenderer;});;

/* /web/static/src/legacy/js/views/basic/basic_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicView',function(require){"use strict";var AbstractView=require('web.AbstractView');var BasicController=require('web.BasicController');var BasicModel=require('web.BasicModel');var config=require('web.config');var fieldRegistry=require('web.field_registry');var fieldRegistryOwl=require('web.field_registry_owl');var pyUtils=require('web.py_utils');var utils=require('web.utils');const widgetRegistry=require('web.widget_registry');const widgetRegistryOwl=require('web.widgetRegistry');var BasicView=AbstractView.extend({config:_.extend({},AbstractView.prototype.config,{Model:BasicModel,Controller:BasicController,}),viewType:undefined,init:function(viewInfo,params){this._super.apply(this,arguments);this.fieldsInfo={};this.fieldsInfo[this.viewType]=this.fieldsView.fieldsInfo[this.viewType];this.rendererParams.viewType=this.viewType;this.controllerParams.confirmOnDelete=true;this.controllerParams.archiveEnabled='active'in this.fields||'x_active'in this.fields;this.controllerParams.hasButtons='action_buttons'in params?params.action_buttons:true;this.controllerParams.viewId=viewInfo.view_id;this.loadParams.fieldsInfo=this.fieldsInfo;this.loadParams.fields=this.fields;this.loadParams.limit=parseInt(this.arch.attrs.limit,10)||params.limit;this.loadParams.parentID=params.parentID;this.loadParams.viewType=this.viewType;this.recordID=params.recordID;this.model=params.model;},_getFieldWidgetClass:function(viewType,field,attrs){var FieldWidget;if(attrs.widget){FieldWidget=fieldRegistryOwl.getAny([viewType+"."+attrs.widget,attrs.widget])||fieldRegistry.getAny([viewType+"."+attrs.widget,attrs.widget]);if(!FieldWidget){console.warn("Missing widget: ",attrs.widget," for field",attrs.name,"of type",field.type);}}else if(viewType==='kanban'&&field.type==='many2many'){FieldWidget=fieldRegistry.get('kanban.many2many_tags');}
return FieldWidget||fieldRegistryOwl.getAny([viewType+"."+field.type,field.type,"abstract"])||fieldRegistry.getAny([viewType+"."+field.type,field.type,"abstract"]);},_loadData:async function(model){if(this.recordID){await model.addFieldsInfo(this.recordID,{fields:this.fields,fieldInfo:this.fieldsInfo[this.viewType],viewType:this.viewType,});var record=model.get(this.recordID);var viewType=this.viewType;var viewFields=Object.keys(record.fieldsInfo[viewType]);var fieldNames=_.difference(viewFields,Object.keys(record.data));var fieldsInfo=record.fieldsInfo[viewType];_.each(viewFields,(name)=>{if(!_.contains(fieldNames,name)){var fieldType=record.fields[name].type;var fieldInfo=fieldsInfo[name];if(fieldInfo.Widget){var requiresSpecialData=fieldInfo.Widget.prototype.specialData;if(requiresSpecialData&&!(name in record.specialData)){fieldNames.push(name);return;}}
if((fieldType==='one2many'||fieldType==='many2many')){if(!('fieldsInfo'in record.data[name])){fieldNames.push(name);}else{var x2mFieldInfo=record.fieldsInfo[this.viewType][name];var viewType=x2mFieldInfo.viewType||x2mFieldInfo.mode;var knownFields=Object.keys(record.data[name].fieldsInfo[record.data[name].viewType]||{});var newFields=Object.keys(record.data[name].fieldsInfo[viewType]||{});if(_.difference(newFields,knownFields).length){fieldNames.push(name);}
if(record.data[name].viewType==='default'){var fieldViews=fieldInfo.views||fieldInfo.fieldsInfo||{};var defaultFieldInfo=record.data[name].fieldsInfo.default;_.each(fieldViews,function(fieldView){_.each(fieldView.fieldsInfo,function(x2mFieldInfo){_.defaults(x2mFieldInfo,defaultFieldInfo);});});}}}
if(fieldType==='many2one'){if(JSON.stringify(record.data[name].context)!==JSON.stringify(fieldInfo.context)){fieldNames.push(name);}}}});var def;if(fieldNames.length){if(model.isNew(record.id)){def=model.generateDefaultValues(record.id,{fieldNames:fieldNames,viewType:viewType,});}else{def=model.reload(record.id,{fieldNames:fieldNames,keepChanges:true,viewType:viewType,});}}
return Promise.resolve(def).then(function(){const handle=record.id;return{state:model.get(handle),handle};});}
return this._super.apply(this,arguments);},_processArch:function(arch,fv){var self=this;utils.traverse(arch,function(node){return self._processNode(node,fv);});},_processField:function(viewType,field,attrs){var self=this;attrs.Widget=this._getFieldWidgetClass(viewType,field,attrs);_.each(attrs,function(value,key){if(key.startsWith('decoration-')){attrs.decorations=attrs.decorations||[];attrs.decorations.push({name:key,expression:pyUtils._getPyJSAST(value),});}});if(!_.isObject(attrs.options)){attrs.options=attrs.options?pyUtils.py_eval(attrs.options):{};}
if(attrs.on_change&&attrs.on_change!=="0"&&!field.onChange){field.onChange="1";}
if(attrs.modifiers.invisible===true||attrs.modifiers.column_invisible===true){attrs.__no_fetch=true;}
if(!_.isEmpty(field.views)){attrs.views={};_.each(field.views,function(innerFieldsView,viewType){viewType=viewType==='tree'?'list':viewType;attrs.views[viewType]=self._processFieldsView(innerFieldsView,viewType);});}
attrs.views=attrs.views||{};attrs.mode=attrs.mode==='tree'?'list':attrs.mode;if(!attrs.views.list&&attrs.views.tree){attrs.views.list=attrs.views.tree;}
if(field.type==='one2many'||field.type==='many2many'){if(attrs.Widget.prototype.useSubview){var mode=attrs.mode;if(!mode){if(attrs.views.list&&!attrs.views.kanban){mode='list';}else if(!attrs.views.list&&attrs.views.kanban){mode='kanban';}else{mode='list,kanban';}}
if(mode.indexOf(',')!==-1){mode=config.device.isMobile?'kanban':'list';}
attrs.mode=mode;if(mode in attrs.views){var view=attrs.views[mode];this._processSubViewAttrs(view,attrs);}}
if(attrs.Widget.prototype.fieldsToFetch){attrs.viewType='default';attrs.relatedFields=_.extend({},attrs.Widget.prototype.fieldsToFetch);attrs.fieldsInfo={default:_.mapObject(attrs.Widget.prototype.fieldsToFetch,function(){return{};}),};if(attrs.options.color_field){attrs.relatedFields[attrs.options.color_field]={type:'integer'};attrs.fieldsInfo.default[attrs.options.color_field]={};}}}
if(attrs.Widget.prototype.fieldDependencies){attrs.fieldDependencies=attrs.Widget.prototype.fieldDependencies;}
return attrs;},_processFieldsView:function(fieldsView,viewType){var fv=this._super.apply(this,arguments);viewType=viewType||this.viewType;fv.type=viewType;fv.fieldsInfo=Object.create(null);fv.fieldsInfo[viewType]=Object.create(null);this._processArch(fv.arch,fv);return fv;},_processNode:function(node,fv){const viewType=fv.type;const fieldsInfo=fv.fieldsInfo[viewType];const fields=fv.viewFields;const _addFieldDependencies=(deps)=>{for(const dependencyName in deps){const dependencyDict={name:dependencyName,type:deps[dependencyName].type};if(!(dependencyName in fieldsInfo)){fieldsInfo[dependencyName]=_.extend({},dependencyDict,{options:deps[dependencyName].options||{},});}
if(!(dependencyName in fields)){fields[dependencyName]=dependencyDict;}
if(fv.fields&&!(dependencyName in fv.fields)){fv.fields[dependencyName]=dependencyDict;}}};if(typeof node==='string'){return false;}
if(!_.isObject(node.attrs.modifiers)){node.attrs.modifiers=node.attrs.modifiers?JSON.parse(node.attrs.modifiers):{};}
if(!_.isObject(node.attrs.options)&&node.tag==='button'){node.attrs.options=node.attrs.options?JSON.parse(node.attrs.options):{};}
if(node.tag==='field'){fieldsInfo[node.attrs.name]=this._processField(viewType,fields[node.attrs.name],node.attrs?_.clone(node.attrs):{});if(fieldsInfo[node.attrs.name].fieldDependencies){var deps=fieldsInfo[node.attrs.name].fieldDependencies;_addFieldDependencies(deps);}
return false;}
if(node.tag==='widget'){const Widget=widgetRegistryOwl.get(node.attrs.name)||widgetRegistry.get(node.attrs.name);const legacy=!(Widget.prototype instanceof owl.Component);let deps;if(legacy&&Widget.prototype.fieldDependencies){deps=Widget.prototype.fieldDependencies;}else if(Widget.fieldDependencies){deps=Widget.fieldDependencies;}
if(deps){_addFieldDependencies(deps);}
return false;}
return node.tag!=='arch';},_processSubViewAttrs:function(view,attrs){var defaultOrder=view.arch.attrs.default_order;if(defaultOrder){attrs.orderedBy=_.map(defaultOrder.split(','),function(order){order=order.trim().split(' ');return{name:order[0],asc:order[1]!=='desc'};});}else{var handleField=_.find(view.arch.children,function(child){return child.attrs&&child.attrs.widget==='handle';});if(handleField){attrs.orderedBy=[{name:handleField.attrs.name,asc:true}];}}
attrs.columnInvisibleFields={};_.each(view.arch.children,function(child){if(child.attrs&&child.attrs.modifiers){attrs.columnInvisibleFields[child.attrs.name]=child.attrs.modifiers.column_invisible||false;}});},});return BasicView;});;

/* /web/static/src/legacy/js/views/basic/widget_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.widget_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry(null,(value)=>!(value.prototype instanceof owl.Component));});;

/* /web/static/src/legacy/js/views/basic/widget_registry_owl.js defined in bundle 'web.assets_backend' */
odoo.define("web.widgetRegistry",function(require){"use strict";const Registry=require("web.Registry");return new Registry(null,(value)=>value.prototype instanceof owl.Component);});;

/* /web/static/src/legacy/js/views/basic/widget_wrapper.js defined in bundle 'web.assets_backend' */
odoo.define('web.WidgetWrapper',function(require){"use strict";const{ComponentWrapper}=require('web.OwlCompatibility');class WidgetWrapper extends ComponentWrapper{updateState(state){return this.update(Object.assign({},this.props,{record:state}));}}
return WidgetWrapper;});;

/* /web/static/src/legacy/js/views/calendar/calendar_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var Dialog=require('web.Dialog');var dialogs=require('web.view_dialogs');var QuickCreate=require('web.CalendarQuickCreate');var _t=core._t;var QWeb=core.qweb;function dateToServer(date,fieldType){date=date.clone().locale('en');if(fieldType==="date"){return date.local().format('YYYY-MM-DD');}
return date.utc().format('YYYY-MM-DD HH:mm:ss');}
var CalendarController=AbstractController.extend({custom_events:_.extend({},AbstractController.prototype.custom_events,{changeDate:'_onChangeDate',changeFilter:'_onChangeFilter',deleteRecord:'_onDeleteRecord',dropRecord:'_onDropRecord',next:'_onNext',openCreate:'_onOpenCreate',openEvent:'_onOpenEvent',prev:'_onPrev',quickCreate:'_onQuickCreate',updateRecord:'_onUpdateRecord',viewUpdated:'_onViewUpdated',AttendeeStatus:'_onAttendeeStatus',}),events:_.extend({},AbstractController.prototype.events,{'click button.o_calendar_button_new':'_onButtonNew','click button.o_calendar_button_prev':'_onButtonNavigation','click button.o_calendar_button_today':'_onButtonNavigation','click button.o_calendar_button_next':'_onButtonNavigation','click button.o_calendar_button_day':'_onButtonScale','click button.o_calendar_button_week':'_onButtonScale','click button.o_calendar_button_month':'_onButtonScale','click button.o_calendar_button_year':'_onButtonScale',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.current_start=null;this.displayName=params.displayName;this.quickAddPop=params.quickAddPop;this.disableQuickCreate=params.disableQuickCreate;this.eventOpenPopup=params.eventOpenPopup;this.showUnusualDays=params.showUnusualDays;this.formViewId=params.formViewId;this.readonlyFormViewId=params.readonlyFormViewId;this.mapping=params.mapping;this.context=params.context;this.previousOpen=null;this.quickCreating=false;this.scales=params.scales;},renderButtons:function($node){this.$buttons=$(QWeb.render('CalendarView.buttons',this._renderButtonsParameters()));this.$buttons.find('.o_calendar_button_'+this.mode).addClass('active');if($node){this.$buttons.appendTo($node);}else{this.$('.o_calendar_buttons').replaceWith(this.$buttons);}},_extractLastPartOfClassName(startClassName,classList){var result;classList.forEach(function(value){if(value&&value.indexOf(startClassName)===0){result=value.substring(startClassName.length);}});return result;},_move:function(to){this.model[to]();return this.reload();},_renderButtonsParameters(){return{scales:this.scales,};},_update:function(){var self=this;if(!this.showUnusualDays){return this._super.apply(this,arguments);}
return this._super.apply(this,arguments).then(function(){self._rpc({model:self.modelName,method:'get_unusual_days',args:[dateToServer(self.model.data.start_date,'date'),dateToServer(self.model.data.end_date,'date')],context:self.context,}).then(function(data){_.each(self.$el.find('td.fc-day'),function(td){var $td=$(td);if(data[$td.data('date')]){$td.addClass('o_calendar_disabled');}});});});},_updateRecord:function(record){var reload=this.reload.bind(this,{});return this.model.updateRecord(record).then(reload,reload);},_onButtonNew(){this.trigger_up('switch_view',{view_type:'form'});},_onButtonNavigation(jsEvent){const action=this._extractLastPartOfClassName('o_calendar_button_',jsEvent.currentTarget.classList);if(action){this._move(action);}},_onButtonScale(jsEvent){const scale=this._extractLastPartOfClassName('o_calendar_button_',jsEvent.currentTarget.classList);if(scale){this.model.setScale(scale);this.reload();}},_onChangeDate:function(event){var modelData=this.model.get();if(modelData.target_date.format('YYYY-MM-DD')===event.data.date.format('YYYY-MM-DD')){switch(modelData.scale){case'month':this.model.setScale('week');break;case'week':this.model.setScale('day');break;case'day':this.model.setScale('month');break;}}else if(modelData.target_date.week()===event.data.date.week()){this.model.setScale('day');}else{this.model.setScale('week');}
if(event.data.scale){this.model.setScale(event.data.scale);}
this.model.setDate(event.data.date);this.reload();},_onChangeFilter:async function(event){if(event.data.value!=='all'&&event.target.filter_field){const domain=[['user_id','=',this.getSession().uid]];if(event.data.value!=='check_all'){domain.push([event.target.write_field,'=',parseInt(event.data.value)]);}
const existingFilter=await this._rpc({model:event.target.write_model,method:'search',args:[domain],});let val={[event.target.filter_field]:event.data.active,};await this._rpc({model:event.target.write_model,method:'write',args:[existingFilter,val],});}
if(this.model.changeFilter(event.data)&&!event.data.no_reload){this.reload();}},_onDeleteRecord:async function(event){var self=this;if(event.data.event.record.recurrency){const recurrenceUpdate=await this._askRecurrenceUpdatePolicy();event.data=Object.assign({},event.data,{'recurrenceUpdate':recurrenceUpdate,});if(recurrenceUpdate==='self_only'){self.model.deleteRecords([event.data.id],self.modelName).then(function(){self.reload();});}else{return this._rpc({model:self.modelName,method:'action_mass_deletion',args:[[event.data.id],recurrenceUpdate],}).then(function(){self.reload();});}}else{Dialog.confirm(this,_t("Are you sure you want to delete this record ?"),{confirm_callback:function(){self.model.deleteRecords([event.data.id],self.modelName).then(function(){self.reload();});}});}},_onDropRecord:function(event){this._updateRecord(_.extend({},event.data,{'drop':true,}));},_onNext:function(event){event.stopPropagation();this._move('next');},_onOpenCreate:function(event){var self=this;if(["year","month"].includes(this.model.get().scale)){event.data.allDay=true;}
var data=this.model.calendarEventToRecord(event.data);var context=_.extend({},this.context,event.options&&event.options.context);if(data.name){context.default_name=data.name;}
context['default_'+this.mapping.date_start]=data[this.mapping.date_start]||null;if(this.mapping.date_stop){context['default_'+this.mapping.date_stop]=data[this.mapping.date_stop]||null;}
if(this.mapping.date_delay){context['default_'+this.mapping.date_delay]=data[this.mapping.date_delay]||null;}
if(this.mapping.all_day){context['default_'+this.mapping.all_day]=data[this.mapping.all_day]||null;}
for(var k in context){if(context[k]&&context[k]._isAMomentObject){context[k]=dateToServer(context[k]);}}
var options=_.extend({},this.options,event.options,{context:context,title:this._setEventTitle()});if(this.quick!=null){this.quick.destroy();this.quick=null;}
if(!options.disableQuickCreate&&!event.data.disableQuickCreate&&this.quickAddPop){this.quick=new QuickCreate(this,true,options,data,event.data);this.quick.open();this.quick.opened(function(){self.quick.focus();});return;}
if(this.eventOpenPopup){if(this.previousOpen){this.previousOpen.close();}
this.previousOpen=new dialogs.FormViewDialog(self,{res_model:this.modelName,context:context,title:options.title,view_id:this.formViewId||false,disable_multiple_selection:true,on_saved:function(){if(event.data.on_save){event.data.on_save();}
self.reload();},});this.previousOpen.on('closed',this,()=>{if(event.data.on_close){event.data.on_close();}})
this.previousOpen.open();}else{this.do_action({type:'ir.actions.act_window',res_model:this.modelName,views:[[this.formViewId||false,'form']],target:'current',context:context,});}},_onOpenEvent:function(event){var self=this;var id=event.data._id;id=id&&parseInt(id).toString()===id?parseInt(id):id;if(!this.eventOpenPopup){this._rpc({model:self.modelName,method:'get_formview_id',args:[[id]],context:event.context||self.context,}).then(function(viewId){self.do_action({type:'ir.actions.act_window',res_id:id,res_model:self.modelName,views:[[viewId||false,'form']],target:'current',context:event.context||self.context,});});return;}
var options={res_model:self.modelName,res_id:id||null,context:event.context||self.context,title:_.str.sprintf(_t("Open: %s"),event.data.title),on_saved:function(){if(event.data.on_save){event.data.on_save();}
self.reload();},};if(this.formViewId){options.view_id=parseInt(this.formViewId);}
new dialogs.FormViewDialog(this,options).open();},_onPrev:function(ev){ev.stopPropagation();this._move('prev');},_onQuickCreate:function(event){var self=this;if(this.quickCreating){return;}
this.quickCreating=true;this.model.createRecord(event).then(function(){self.quick.destroy();self.quick=null;self.reload();self.quickCreating=false;}).guardedCatch(function(result){var errorEvent=result.event;errorEvent.preventDefault();event.data.options.disableQuickCreate=true;event.data.data.on_save=self.quick.destroy.bind(self.quick);self._onOpenCreate(event.data);self.quickCreating=false;});},_onUpdateRecord:function(event){this._updateRecord(event.data);},_onViewUpdated:function(event){this.mode=event.data.mode;if(this.$buttons){this.$buttons.find('.active').removeClass('active');this.$buttons.find('.o_calendar_button_'+this.mode).addClass('active');}
const title=`${this.displayName} (${event.data.title})`;return this.updateControlPanel({title});},_onAttendeeStatus:async function(event){const self=this;let recurrenceUpdate=false;if(event.data.record.recurrency){recurrenceUpdate=await this._askRecurrenceUpdatePolicy();event.data=Object.assign({},event.data,{'recurrenceUpdate':recurrenceUpdate,});}
return this._rpc({model:self.modelName,method:'change_attendee_status',args:[[event.data.id],event.data.selectedStatus,recurrenceUpdate],}).then(function(){self.reload();});},_setEventTitle:function(){return _t('New Event');},});return CalendarController;});;

/* /web/static/src/legacy/js/views/calendar/calendar_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var Context=require('web.Context');var core=require('web.core');var fieldUtils=require('web.field_utils');var session=require('web.session');var _t=core._t;function dateToServer(date){return date.clone().utc().locale('en').format('YYYY-MM-DD HH:mm:ss');}
return AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.end_date=null;var week_start=_t.database.parameters.week_start;this.week_start=week_start!==undefined&&week_start!==false?week_start%7:moment().startOf('week').day();this.week_stop=this.week_start+6;this.filter_check_all={};},calendarEventToRecord:function(event){var data={};data[this.mapping.create_name_field||'name']=event.title;var start=event.start.clone();var end=event.end&&event.end.clone();if(!end||end.diff(start)<0){if(event.allDay){end=start.clone();}else{end=start.clone().add(2,'h');}}else if(event.allDay){end.add(-1,'days');}
var isDateEvent=this.fields[this.mapping.date_start].type==='date';if(event.allDay){if(!this.mapping.all_day&&!isDateEvent){if(event.r_start){start.hours(event.r_start.hours()).minutes(event.r_start.minutes()).seconds(event.r_start.seconds()).utc();end.hours(event.r_end.hours()).minutes(event.r_end.minutes()).seconds(event.r_end.seconds()).utc();}else{start.hours(7);end.hours(19);}
start.add(-this.getSession().getTZOffset(start),'minutes');end.add(-this.getSession().getTZOffset(end),'minutes');}}else{start.add(-this.getSession().getTZOffset(start),'minutes');end.add(-this.getSession().getTZOffset(end),'minutes');}
if(this.mapping.all_day){if(event.record){data[this.mapping.all_day]=(this.data.scale!=='month'&&event.allDay)||event.record[this.mapping.all_day]&&end.diff(start)<10||false;}else{data[this.mapping.all_day]=event.allDay;}}
data[this.mapping.date_start]=start;if(this.mapping.date_stop){data[this.mapping.date_stop]=end;}
if(this.mapping.date_delay){if(this.data.scale!=='month'||(this.data.scale==='month'&&!event.drop)){data[this.mapping.date_delay]=(end.diff(start)<=0?end.endOf('day').diff(start):end.diff(start))/1000/3600;}}
return data;},changeFilter:function(filter){var Filter=this.data.filters[filter.fieldName];if(filter.value==='all'){Filter.all=filter.active;}
else if(filter.value==='check_all'){this.filter_check_all[filter.fieldName]=filter.active;Filter.all=false;if(filter.active){Filter.filters.filter(el=>el.value!=='all').forEach(element=>element.active=true);return true;}else{Filter.filters.forEach(element=>element.active=false);return true;}}
var f=_.find(Filter.filters,function(f){return f.value===filter.value;});if(f){if(f.active!==filter.active){f.active=filter.active;}else if(filter.active){return false;}}else if(filter.active){Filter.filters.push({value:filter.value,active:true,});}
return true;},createRecord:function(event){var data=this.calendarEventToRecord(event.data.data);for(var k in data){if(data[k]&&data[k]._isAMomentObject){data[k]=dateToServer(data[k]);}}
return this._rpc({model:this.modelName,method:'create',args:[data],context:event.data.options.context,});},deleteRecords:function(ids,model){return this._rpc({model:model,method:'unlink',args:[ids],context:session.user_context,});},__get:function(){return _.extend({},this.data,{fields:this.fields});},__load:function(params){var self=this;this.modelName=params.modelName;this.fields=params.fields;this.fieldNames=params.fieldNames;this.fieldsInfo=params.fieldsInfo;this.mapping=params.mapping;this.mode=params.mode;this.scales=params.scales;this.scalesInfo=params.scalesInfo;this.editable=params.editable;this.creatable=params.creatable;this.eventLimit=params.eventLimit;this.fieldColor=params.fieldColor;if(!this.preloadPromise){this.preloadPromise=new Promise(function(resolve,reject){Promise.all([self._rpc({model:self.modelName,method:'check_access_rights',args:["write",false]}),self._rpc({model:self.modelName,method:'check_access_rights',args:["create",false]})]).then(function(result){var write=result[0];var create=result[1];self.write_right=write;self.create_right=create;resolve();}).guardedCatch(reject);});}
this.data={domain:params.domain,context:params.context,filters:params.filters,};this.setDate(params.initialDate);this.setScale(params.mode);_.each(this.data.filters,function(filter){if(filter.avatar_field&&!filter.avatar_model){filter.avatar_model=self.modelName;}});return this.preloadPromise.then(this._loadCalendar.bind(this));},next:function(){this.setDate(this.data.target_date.clone().add(1,this.data.scale));},prev:function(){this.setDate(this.data.target_date.clone().add(-1,this.data.scale));},__reload:function(handle,params){if(params.domain){this.data.domain=params.domain;}
if(params.context){this.data.context=params.context;}
return this._loadCalendar();},setDate:function(start){this.data.highlight_date=this.data.target_date=start.clone();this.data.start_date=this.data.end_date=start;switch(this.data.scale){case'year':{const yearStart=this.data.start_date.clone().startOf('year');let yearStartDay=this.week_start;if(yearStart.day()<yearStartDay){yearStartDay-=7;}
this.data.start_date=yearStart.day(yearStartDay).startOf('day');this.data.end_date=this.data.end_date.clone().endOf('year').day(this.week_stop).endOf('day');break;}
case'month':var monthStart=this.data.start_date.clone().startOf('month');var monthStartDay;if(monthStart.day()>=this.week_start){monthStartDay=this.week_start;}else{monthStartDay=this.week_start-7;}
this.data.start_date=monthStart.day(monthStartDay).startOf('day');this.data.end_date=this.data.start_date.clone().add(5,'week').day(this.week_stop).endOf('day');break;case'week':var weekStart=this.data.start_date.clone().startOf('week');var weekStartDay=this.week_start;if(this.data.start_date.day()<this.week_start){weekStartDay-=7;}
this.data.start_date=this.data.start_date.clone().day(weekStartDay).startOf('day');this.data.end_date=this.data.end_date.clone().day(weekStartDay+6).endOf('day');break;default:this.data.start_date=this.data.start_date.clone().startOf('day');this.data.end_date=this.data.end_date.clone().endOf('day');}
var manualUtcDateStart=this.data.start_date.clone().add(-this.getSession().getTZOffset(this.data.start_date),'minutes');var formattedUtcDateStart=manualUtcDateStart.format('YYYY-MM-DDTHH:mm:ss')+'Z';this.data.start_date=moment.utc(formattedUtcDateStart);var manualUtcDateEnd=this.data.end_date.clone().add(-this.getSession().getTZOffset(this.data.start_date),'minutes');var formattedUtcDateEnd=manualUtcDateEnd.format('YYYY-MM-DDTHH:mm:ss')+'Z';this.data.end_date=moment.utc(formattedUtcDateEnd);},setScale:function(scale){if(!_.contains(this.scales,scale)){scale="week";}
this.data.scale=scale;this.setDate(this.data.target_date);},today:function(){this.setDate(moment(new Date()));},updateRecord:function(record){var data=_.omit(this.calendarEventToRecord(record),'name');for(var k in data){if(data[k]&&data[k]._isAMomentObject){data[k]=dateToServer(data[k]);}}
var context=new Context(this.data.context,{from_ui:true});return this._rpc({model:this.modelName,method:'write',args:[[parseInt(record.id,10)],data],context:context});},_getFilterDomain:function(){var authorizedValues={};var avoidValues={};_.each(this.data.filters,function(filter){if(filter.all)return;if(filter.visible)return;_.each(filter.filters,function(f){if(filter.write_model){if(!authorizedValues[filter.fieldName])
authorizedValues[filter.fieldName]=[];if(f.active){authorizedValues[filter.fieldName].push(f.value);}}else{if(!f.active){if(!avoidValues[filter.fieldName])
avoidValues[filter.fieldName]=[];avoidValues[filter.fieldName].push(f.value);}}});});var domain=[];for(var field in authorizedValues){domain.push([field,'in',authorizedValues[field]]);}
for(var field in avoidValues){if(avoidValues[field].length>0){domain.push([field,'not in',avoidValues[field]]);}}
return domain;},_getFullCalendarOptions:function(){var format12Hour={hour:'numeric',minute:'2-digit',omitZeroMinute:true,meridiem:'short'};var format24Hour={hour:'numeric',minute:'2-digit',hour12:false,};return{defaultView:this.scalesInfo[this.mode||'week'],header:false,selectable:this.creatable&&this.create_right,selectMirror:true,editable:this.editable,droppable:true,navLinks:false,eventLimit:this.eventLimit,snapMinutes:15,longPressDelay:500,eventResizableFromStart:true,nowIndicator:true,weekNumbers:true,weekNumbersWithinDays:true,weekNumberCalculation:function(date){return moment(date).week();},weekLabel:_t("Week"),allDayText:_t("All day"),monthNames:moment.months(),monthNamesShort:moment.monthsShort(),dayNames:moment.weekdays(),dayNamesShort:moment.weekdaysShort(),dayNamesMin:moment.weekdaysMin(),firstDay:this.week_start,slotLabelFormat:_t.database.parameters.time_format.search("%H")!==-1?format24Hour:format12Hour,allDaySlot:this.mapping.all_day||this.fields[this.mapping.date_start].type==='date',};},_getRangeDomain:function(){var domain=[[this.mapping.date_start,'<=',dateToServer(this.data.end_date)]];if(this.mapping.date_stop){domain.push([this.mapping.date_stop,'>=',dateToServer(this.data.start_date)]);}else if(!this.mapping.date_delay){domain.push([this.mapping.date_start,'>=',dateToServer(this.data.start_date)]);}
return domain;},_loadCalendar:function(){var self=this;this.data.fc_options=this._getFullCalendarOptions();var defs=_.map(this.data.filters,this._loadFilter.bind(this));return Promise.all(defs).then(function(){return self._rpc({model:self.modelName,method:'search_read',context:self.data.context,fields:self.fieldNames,domain:self.data.domain.concat(self._getRangeDomain()).concat(self._getFilterDomain())}).then(async function(events){self._parseServerData(events);self.data.data=await self._getCalendarEventData(events);return Promise.all([self._loadColors(self.data,self.data.data),self._loadRecordsToFilters(self.data,self.data.data)]);});});},_loadColors:function(element,events){if(this.fieldColor){const fieldName=this.fieldColor;_.each(events,function(event){var value=event.record[fieldName];event.color_index=_.isArray(value)?value[0]:value;});this.model_color=this.fields[fieldName].relation||element.model;}
return Promise.resolve();},_getColorIndex:function(actual_color_list,color_index){var actual_color_list=actual_color_list||[0];var new_color_index=color_index%50;if(new_color_index!==color_index&&actual_color_list.includes(new_color_index)){new_color_index=this._getColorIndex(actual_color_list,new_color_index+3);}
return new_color_index;},_loadFilter:function(filter){if(!filter.write_model){return Promise.resolve();}
var field=this.fields[filter.fieldName];var fields=[filter.write_field];if(filter.filter_field){fields.push(filter.filter_field);}
return this._rpc({model:filter.write_model,method:'search_read',domain:[["user_id","=",session.uid]],fields:fields,}).then(function(res){var records=_.map(res,function(record){var _value=record[filter.write_field];var value=_.isArray(_value)?_value[0]:_value;var f=_.find(filter.filters,function(f){return f.value===value;});var formater=fieldUtils.format[_.contains(['many2many','one2many'],field.type)?'many2one':field.type];return{'id':record.id,'value':value,'label':formater(_value,field),'active':(f&&f.active)||(filter.filter_field&&record[filter.filter_field]),};});records.sort(function(f1,f2){return _.string.naturalCmp(f2.label,f1.label);});if(field.relation==='res.partner'||field.relation==='res.users'){var value=field.relation==='res.partner'?session.partner_id:session.uid;var me=_.find(records,function(record){return record.value===value;});if(me){records.splice(records.indexOf(me),1);}else{var f=_.find(filter.filters,function(f){return f.value===value;});me={'value':value,'label':session.name,'active':!f||f.active,};}
records.unshift(me);}
records.push({'value':'all','label':field.relation==='res.partner'||field.relation==='res.users'?_t("Everybody's calendars"):_t("Everything"),'active':filter.all,});filter.filters=records;});},_loadRecordsToFilters:function(element,events){var self=this;var new_filters={};var to_read={};var defs=[];var color_filter={};_.each(this.data.filters,function(filter,fieldName){var field=self.fields[fieldName];new_filters[fieldName]=filter;if(filter.write_model){if(field.relation===self.model_color){_.each(filter.filters,function(f){f.color_index=self._getColorIndex(_.map(filter.filters,f=>f.value),f.value);});}
return;}
_.each(filter.filters,function(filter){filter.display=!filter.active;});var fs=[];var undefined_fs=[];_.each(events,function(event){var data=event.record[fieldName];if(!_.contains(['many2many','one2many'],field.type)){data=[data];}else{to_read[field.relation]=(to_read[field.relation]||[]).concat(data);}
_.each(data,function(_value){var value=_.isArray(_value)?_value[0]:_value;var f={'color_index':self.model_color===(field.relation||element.model)?value:false,'value':value,'label':fieldUtils.format[field.type](_value,field)||_t("Undefined"),'avatar_model':field.relation||element.model,};value?fs.push(f):undefined_fs.push(f);});});_.each(_.union(fs,undefined_fs),function(f){var f1=_.findWhere(filter.filters,_.omit(f,'color_index'));if(f1){f1.display=true;}else{f.display=f.active=true;filter.filters.push(f);}});if(filter.color_model&&filter.field_color){var ids=filter.filters.reduce((acc,f)=>{if(!f.color_index&&f.value){acc.push(f.value);}
return acc;},[]);if(!color_filter[filter.color_model]){color_filter[filter.color_model]={};}
if(ids.length){defs.push(self._rpc({model:filter.color_model,method:'read',args:[_.uniq(ids),[filter.field_color]],}).then(function(res){_.each(res,function(c){color_filter[filter.color_model][c.id]=c[filter.field_color];});}));}}});_.each(to_read,function(ids,model){defs.push(self._rpc({model:model,method:'name_get',args:[_.uniq(ids)],}).then(function(res){to_read[model]=_.object(res);}));});return Promise.all(defs).then(function(){_.each(self.data.filters,function(filter){if(filter.write_model){return;}
if(filter.filters.length&&(filter.filters[0].avatar_model in to_read)){_.each(filter.filters,function(f){f.label=to_read[f.avatar_model][f.value];});}
if(filter.color_model&&filter.field_color){_.each(filter.filters,function(f){if(!f.color_index){f.color_index=color_filter[filter.color_model]&&color_filter[filter.color_model][f.value];}});}});});},_parseServerData:function(data){var self=this;_.each(data,function(event){_.each(self.fieldNames,function(fieldName){event[fieldName]=self._parseServerValue(self.fields[fieldName],event[fieldName]);});});},_recordToCalendarEvent:function(evt){var date_start;var date_stop;var date_delay=evt[this.mapping.date_delay]||1.0,all_day=this.fields[this.mapping.date_start].type==='date'||this.mapping.all_day&&evt[this.mapping.all_day]||false,the_title='',attendees=[];if(!all_day){date_start=evt[this.mapping.date_start].clone();date_stop=this.mapping.date_stop?evt[this.mapping.date_stop].clone():null;}else{date_start=evt[this.mapping.date_start].clone().startOf('day');date_stop=this.mapping.date_stop?evt[this.mapping.date_stop].clone().startOf('day'):null;}
if(!date_stop&&date_delay){date_stop=date_start.clone().add(date_delay,'hours');}
if(!all_day){date_start.add(this.getSession().getTZOffset(date_start),'minutes');date_stop.add(this.getSession().getTZOffset(date_stop),'minutes');}
if(this.mapping.all_day&&evt[this.mapping.all_day]){date_stop.add(1,'days');}
var r={'record':evt,'start':date_start.local(true).toDate(),'end':date_stop.local(true).toDate(),'r_start':date_start.clone().local(true).toDate(),'r_end':date_stop.clone().local(true).toDate(),'title':the_title,'allDay':all_day,'id':evt.id,'attendees':attendees,};if(!(this.mapping.all_day&&evt[this.mapping.all_day])&&this.data.scale==='month'&&this.fields[this.mapping.date_start].type!=='date'){r.showTime=true;}
return r;},_getCalendarEventData:function(events){return _.map(events,this._recordToCalendarEvent.bind(this));}});});;

/* /web/static/src/legacy/js/views/calendar/calendar_popover.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarPopover',function(require){"use strict";var fieldRegistry=require('web.field_registry');const fieldRegistryOwl=require('web.field_registry_owl');const FieldWrapper=require('web.FieldWrapper');var StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');var Widget=require('web.Widget');const{WidgetAdapterMixin}=require('web.OwlCompatibility');var CalendarPopover=Widget.extend(WidgetAdapterMixin,StandaloneFieldManagerMixin,{template:'CalendarView.event.popover',events:{'click .o_cw_popover_edit':'_onClickPopoverEdit','click .o_cw_popover_delete':'_onClickPopoverDelete',},init:function(parent,eventInfo){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.hideDate=eventInfo.hideDate;this.hideTime=eventInfo.hideTime;this.eventTime=eventInfo.eventTime;this.eventDate=eventInfo.eventDate;this.displayFields=eventInfo.displayFields;this.fields=eventInfo.fields;this.event=eventInfo.event;this.modelName=eventInfo.modelName;this._canDelete=eventInfo.canDelete;this.popoverFields=eventInfo.popoverFields;},willStart:function(){return Promise.all([this._super.apply(this,arguments),this._processFields()]);},start:function(){var self=this;_.each(this.$fieldsList,function($field){$field.appendTo(self.$('.o_cw_popover_fields_secondary'));});return this._super.apply(this,arguments);},destroy:function(){this._super.apply(this,arguments);WidgetAdapterMixin.destroy.call(this);},on_attach_callback:function(){WidgetAdapterMixin.on_attach_callback.call(this);},on_detach_callback:function(){WidgetAdapterMixin.on_detach_callback.call(this);},isEventDeletable(){return this._canDelete;;},isEventDetailsVisible(){return true;},isEventEditable(){return true;},_getFieldWidgetClass(field,attrs){let FieldWidget;if(attrs.widget){FieldWidget=fieldRegistry.getAny(['form'+"."+attrs.widget,attrs.widget]);if(!FieldWidget){console.warn("Missing widget: ",attrs.widget," for field",attrs.name,"of type",field.type);}}
return FieldWidget||fieldRegistry.getAny(['form'+"."+field.type,field.type,"abstract"]);},_processFields:function(){var self=this;var fieldsToGenerate=[];const fieldInformation={};var fields=_.keys(this.popoverFields);for(var i=0;i<fields.length;i++){var fieldName=fields[i];var displayFieldInfo=self.displayFields[fieldName]||{attrs:{invisible:1}};var fieldInfo=self.fields[fieldName];fieldInformation[fieldName]={Widget:self._getFieldWidgetClass(fieldInfo,displayFieldInfo.attrs),};var field={name:fieldName,string:displayFieldInfo.attrs.string||fieldInfo.string,value:self.event.extendedProps.record[fieldName],type:fieldInfo.type,invisible:displayFieldInfo.attrs.invisible,};if(field.type==='selection'){field.selection=fieldInfo.selection;}
if(field.type==='monetary'){var currencyField=field.currency_field||'currency_id';if(!fields.includes(currencyField)&&_.has(self.event.extendedProps.record,currencyField)){fields.push(currencyField);}}
if(fieldInfo.relation){field.relation=fieldInfo.relation;}
if(displayFieldInfo.attrs.widget){field.widget=displayFieldInfo.attrs.widget;}else if(_.contains(['many2many','one2many'],field.type)){field.widget='many2many_tags';}
if(_.contains(['many2many','one2many'],field.type)){field.fields=[{name:'id',type:'integer',},{name:'display_name',type:'char',}];}
fieldsToGenerate.push(field);};this.$fieldsList=[];return this.model.makeRecord(this.modelName,fieldsToGenerate,fieldInformation).then(async function(recordID){var defs=[];const recordDataPoint=self.model.localData[recordID];recordDataPoint.res_id=self.event.extendedProps.record.id;await self.model._fetchSpecialData(recordDataPoint);var record=self.model.get(recordID);_.each(fieldsToGenerate,function(field){if(field.invisible)return;let isLegacy=true;let fieldWidget;let FieldClass=fieldRegistryOwl.getAny([field.widget,field.type]);if(FieldClass){isLegacy=false;fieldWidget=new FieldWrapper(this,FieldClass,{fieldName:field.name,record,options:self.displayFields[field.name],});}else{FieldClass=fieldRegistry.getAny([field.widget,field.type]);fieldWidget=new FieldClass(self,field.name,record,self.displayFields[field.name]);}
if(fieldWidget.attrs&&!_.isObject(fieldWidget.attrs.modifiers)){fieldWidget.attrs.modifiers=fieldWidget.attrs.modifiers?JSON.parse(fieldWidget.attrs.modifiers):{};}
self._registerWidget(recordID,field.name,fieldWidget);let fieldClass="list-group-item flex-shrink-0 d-flex flex-wrap align-items-center";if(fieldWidget.attrs&&fieldWidget.attrs.modifiers){const fieldModifier=record.evalModifiers(_.pick(fieldWidget.attrs.modifiers,'invisible'));fieldClass+=fieldModifier.invisible?' o_invisible_modifier':'';}
if(fieldWidget.attrs){if(fieldWidget.attrs.options&&fieldWidget.attrs.options.icon){field.icon=fieldWidget.attrs.options.icon;}
if(fieldWidget.attrs.class){fieldClass+=' '+fieldWidget.attrs.class;}}
var $field=$('<li>',{class:fieldClass});let $fieldLabel;if(field.icon){$fieldLabel=$('<strong>',{class:'mr-2',html:_.str.sprintf("<b><i class='%s'/></b>",field.icon)});}else{$fieldLabel=$('<strong>',{class:'mr-2',text:_.str.sprintf('%s : ',field.string)});}
$fieldLabel.appendTo($field);var $fieldContainer=$('<div>',{class:'flex-grow-1'});$fieldContainer.appendTo($field);let def;if(isLegacy){def=fieldWidget.appendTo($fieldContainer);}else{def=fieldWidget.mount($fieldContainer[0]);}
self.$fieldsList.push($field);defs.push(def);});return Promise.all(defs);});},_onClickPopoverEdit:function(ev){ev.preventDefault();this.trigger_up('edit_event',{id:this.event.id,title:this.event.extendedProps.record.display_name,});},_onClickPopoverDelete:function(ev){ev.preventDefault();this.trigger_up('delete_event',{id:this.event.id});},});return CalendarPopover;});;

/* /web/static/src/legacy/js/views/calendar/calendar_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarQuickCreate',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var _t=core._t;var QWeb=core.qweb;var QuickCreate=Dialog.extend({events:_.extend({},Dialog.events,{'keyup input':'_onkeyup',}),init:function(parent,buttons,options,dataTemplate,dataCalendar){this._buttons=buttons||false;this.options=options;this.parentCalendar=parent;this.dataTemplate=dataTemplate||{};this.dataCalendar=dataCalendar;var self=this;this._super(parent,{title:options.title,backdrop:true,size:'small',buttons:this._buttons?[{text:_t("Create"),classes:'btn-primary',click:function(){if(!self._quickAdd(dataCalendar)){self.focus();}}},{text:_t("Edit"),click:function(){dataCalendar.disableQuickCreate=true;dataCalendar.title=self.$('input').val().trim();dataCalendar.on_save=self.destroy.bind(self);self.trigger_up('openCreate',dataCalendar);}},{text:_t("Cancel"),close:true},]:[],$content:QWeb.render('CalendarView.quick_create',{widget:this})});},focus:function(){this.$('input').focus();},destroy:function(){if(!this.isDestroyed()){if(this.parentCalendar.renderer.state.scale==='year'){this.parentCalendar.renderer.calendar.view.unselect();}else{this.parentCalendar.renderer.calendar.unselect();}}
this._super.apply(this,arguments);},_quickAdd:function(dataCalendar){dataCalendar=$.extend({},this.dataTemplate,dataCalendar);var val=this.$('input').val().trim();if(!val){this.$('label, input').addClass('o_field_invalid');this.displayNotification({title:_t("Invalid fields:"),message:_t("Meeting Subject"),type:'danger'});}
dataCalendar.title=val;return(val)?this.trigger_up('quickCreate',{data:dataCalendar,options:this.options}):false;},_onkeyup:function(event){if(this._flagEnter){return;}
if(event.keyCode===$.ui.keyCode.ENTER){this._flagEnter=true;if(!this._quickAdd(this.dataCalendar)){this._flagEnter=false;}}else if(event.keyCode===$.ui.keyCode.ESCAPE&&this._buttons){this.close();}},});return QuickCreate;});;

/* /web/static/src/legacy/js/views/calendar/calendar_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var CalendarPopover=require('web.CalendarPopover');var core=require('web.core');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');var FieldManagerMixin=require('web.FieldManagerMixin');var relational_fields=require('web.relational_fields');var session=require('web.session');var Widget=require('web.Widget');const{createYearCalendarView}=require('/web/static/src/js/libs/fullcalendar.js');var _t=core._t;var qweb=core.qweb;var SidebarFilterM2O=relational_fields.FieldMany2One.extend({_getSearchBlacklist:function(){return this._super.apply(this,arguments).concat(this.filter_ids||[]);},});var SidebarFilter=Widget.extend(FieldManagerMixin,{template:'CalendarView.sidebar.filter',custom_events:_.extend({},FieldManagerMixin.custom_events,{field_changed:'_onFieldChanged',}),init:function(parent,options){this._super.apply(this,arguments);FieldManagerMixin.init.call(this);this.title=options.title;this.fields=options.fields;this.fieldName=options.fieldName;this.write_model=options.write_model;this.write_field=options.write_field;this.filter_field=options.filter_field;this.avatar_field=options.avatar_field;this.avatar_model=options.avatar_model;this.filters=options.filters;this.label=options.label;this.getColor=options.getColor;this.filter_check_all=options.check_all;},willStart:function(){var self=this;var defs=[this._super.apply(this,arguments)];if(this.write_model||this.write_field){var def=this.model.makeRecord(this.write_model,[{name:this.write_field,relation:this.fields[this.fieldName].relation,type:'many2one',}]).then(function(recordID){self.many2one=new SidebarFilterM2O(self,self.write_field,self.model.get(recordID),{mode:'edit',attrs:{string:_t(self.fields[self.fieldName].string),placeholder:"+ "+_.str.sprintf(_t("Add %s"),self.title),can_create:false},});});defs.push(def);}
return Promise.all(defs);},start:function(){this._super();if(this.many2one){this.many2one.appendTo(this.$el);this.many2one.filter_ids=_.without(_.pluck(this.filters,'value'),'all');}
this.$el.on('click','.o_remove',this._onFilterRemove.bind(this));this.$el.on('click','.o_calendar_filter_items input',this._onFilterActive.bind(this));this.$el.on('click','.o_calendar_filter_items_checkall input',this._onFilterCheckAll.bind(this));},_onFieldChanged:function(event){var self=this;event.stopPropagation();var createValues={'user_id':session.uid};var value=event.data.changes[this.write_field].id;createValues[this.write_field]=value;this._rpc({model:this.write_model,method:'create',args:[createValues],}).then(function(){self.trigger_up('changeFilter',{'fieldName':self.fieldName,'value':value,'active':true,});});},_onFilterActive:function(e){var $input=$(e.currentTarget);this.filter_check_all[this.fieldName]=false;this.trigger_up('changeFilter',{'fieldName':this.fieldName,'value':$input.closest('.o_calendar_filter_item').data('value'),'active':$input.prop('checked'),});},_onFilterRemove:function(e){var self=this;var $filter=$(e.currentTarget).closest('.o_calendar_filter_item');this.filter_check_all[this.fieldName]=false;self._rpc({model:self.write_model,method:'unlink',args:[[$filter.data('id')]],}).then(function(){self.trigger_up('changeFilter',{'fieldName':self.fieldName,'id':$filter.data('id'),'active':false,'value':$filter.data('value'),});});},_onFilterCheckAll:function(e){let $input=$(e.currentTarget);let $filter=$(e.currentTarget).closest('.o_calendar_filter_item');this.filter_check_all[this.fieldName]=$input.prop('checked');this.trigger_up('changeFilter',{'fieldName':this.fieldName,'value':'check_all','active':$input.prop('checked'),});},});return AbstractRenderer.extend({template:"CalendarView",config:{CalendarPopover:CalendarPopover,eventTemplate:'calendar-box',},custom_events:_.extend({},AbstractRenderer.prototype.custom_events||{},{edit_event:'_onEditEvent',delete_event:'_onDeleteEvent',render_event:'_renderEvents',}),init:function(parent,state,params){this._super.apply(this,arguments);this.displayFields=params.displayFields;this.popoverFields=params.popoverFields;this.model=params.model;this.filters=[];this.color_map={};this.hideDate=params.hideDate;this.hideTime=params.hideTime;this.canDelete=params.canDelete;this.canCreate=params.canCreate;this.scalesInfo=params.scalesInfo;this._isInDOM=false;},start:function(){this._initSidebar();this._initCalendar();return this._super();},on_attach_callback:function(){this._super(...arguments);this._isInDOM=true;this.calendar.render();this._renderCalendar();window.addEventListener('click',this._onWindowClick.bind(this));},on_detach_callback:function(){this._super(...arguments);this._isInDOM=false;window.removeEventListener('click',this._onWindowClick);},destroy:function(){if(this.calendar){this.calendar.destroy();}
if(this.$small_calendar){this.$small_calendar.datepicker('destroy');$('#ui-datepicker-div:empty').remove();}
this._super.apply(this,arguments);},getAvatars:function(record,fieldName,imageField){var field=this.state.fields[fieldName];if(!record[fieldName]){return[];}
if(field.type==='one2many'||field.type==='many2many'){return _.map(record[fieldName],function(id){return'<img src="/web/image/'+field.relation+'/'+id+'/'+imageField+'" />';});}else if(field.type==='many2one'){return['<img src="/web/image/'+field.relation+'/'+record[fieldName][0]+'/'+imageField+'" />'];}else{var value=this._format(record,fieldName);var color=this.getColor(value);if(isNaN(color)){return['<span class="o_avatar_square" style="background-color:'+color+';"/>'];}
else{return['<span class="o_avatar_square o_calendar_color_'+color+'"/>'];}}},getColor:function(key){if(!key){return;}
if(this.color_map[key]){return this.color_map[key];}
if(typeof key==='string'&&key.match(/^((#[A-F0-9]{3})|(#[A-F0-9]{6})|((hsl|rgb)a?\(\s*(?:(\s*\d{1,3}%?\s*),?){3}(\s*,[0-9.]{1,4})?\))|)$/i)){return this.color_map[key]=key;}
if(typeof key==='number'&&!(key in this.color_map)){return this.color_map[key]=key;}
var index=(((_.keys(this.color_map).length+1)*5)%24)+1;this.color_map[key]=index;return index;},getLocalState:function(){var fcScroller=this.calendarElement.querySelector('.fc-scroller');return{scrollPosition:fcScroller.scrollTop,};},setLocalState:function(localState){if(localState.scrollPosition){var fcScroller=this.calendarElement.querySelector('.fc-scroller');fcScroller.scrollTop=localState.scrollPosition;}},_convertEventToFC3Event:function(fc4Event){var event=fc4Event;if(!moment.isMoment(fc4Event.start)){event={id:fc4Event.id,title:fc4Event.title,start:moment(fc4Event.start).utcOffset(0,true),end:fc4Event.end&&moment(fc4Event.end).utcOffset(0,true),allDay:fc4Event.allDay,color:fc4Event.color,};if(fc4Event.extendedProps){event=Object.assign({},event,{r_start:fc4Event.extendedProps.r_start&&moment(fc4Event.extendedProps.r_start).utcOffset(0,true),r_end:fc4Event.extendedProps.r_end&&moment(fc4Event.extendedProps.r_end).utcOffset(0,true),record:fc4Event.extendedProps.record,attendees:fc4Event.extendedProps.attendees,disableQuickCreate:fc4Event.extendedProps.disableQuickCreate,});}}
return event;},_eventRender:function(event){var qweb_context={event:event,record:event.extendedProps.record,color:this.getColor(event.extendedProps.color_index),showTime:!this.hideTime&&event.extendedProps.showTime,showLocation:this.state.scale!=='month'};this.qweb_context=qweb_context;if(_.isEmpty(qweb_context.record)){return'';}else{return qweb.render(this.config.eventTemplate,qweb_context);}},_format:function(record,fieldName){var field=this.state.fields[fieldName];if(field.type==="one2many"||field.type==="many2many"){return field_utils.format[field.type]({data:record[fieldName]},field);}else{return field_utils.format[field.type](record[fieldName],field,{forceString:true});}},_preOpenCreate:function(data){if(this.$('.o_cw_popover').length){this._unselectEvent();this.$('.fc-event').not(".o_event").remove();return;}
if(this.state.context.default_name){data.title=this.state.context.default_name;}
this.trigger_up('openCreate',{...this._convertEventToFC3Event(data),on_close:()=>{if(this.state.scale==='year'){this.calendar.view.unselect();}else{this.calendar.unselect();}}});},_getFullCalendarOptions:function(fcOptions){var self=this;const options=Object.assign({},this.state.fc_options,{plugins:['moment','interaction','dayGrid','timeGrid'],eventDrop:function(eventDropInfo){var event=self._convertEventToFC3Event(eventDropInfo.event);self.trigger_up('dropRecord',event);},eventResize:function(eventResizeInfo){self._unselectEvent();var event=self._convertEventToFC3Event(eventResizeInfo.event);self.trigger_up('updateRecord',event);},eventClick:function(eventClickInfo){eventClickInfo.jsEvent.preventDefault();eventClickInfo.jsEvent.stopPropagation();var eventData=eventClickInfo.event;self._unselectEvent();$(self.calendarElement).find(self._computeEventSelector(eventClickInfo)).addClass('o_cw_custom_highlight');self._renderEventPopover(eventData,$(eventClickInfo.el));},selectAllow:function(event){if(event.end.getDate()===event.start.getDate()||event.allDay){return true;}},yearDateClick:function(info){self._unselectEvent();info.view.unselect();if(!info.events.length){if(info.selectable){const data={start:info.date,allDay:true,};if(self.state.context.default_name){data.title=self.state.context.default_name;}
self.trigger_up('openCreate',self._convertEventToFC3Event(data));}}else{self._renderYearEventPopover(info.date,info.events,$(info.dayEl));}},select:function(selectionInfo){var data={start:selectionInfo.start,end:selectionInfo.end,allDay:selectionInfo.allDay};self._preOpenCreate(data);},eventRender:function(info){var event=info.event;var element=$(info.el);var view=info.view;self._addEventAttributes(element,event);if(view.type==='dayGridYear'){const color=this.getColor(event.extendedProps.color_index);if(typeof color==='string'){element.css({backgroundColor:color,});}else if(typeof color==='number'){element.addClass(`o_calendar_color_${color}`);}else{element.addClass('o_calendar_color_1');}}else{var $render=$(self._eventRender(event));element.find('.fc-content').html($render.html());element.addClass($render.attr('class'));if(!element.find('.fc-bg').length){element.find('.fc-content').after($('<div/>',{class:'fc-bg'}));}
if(view.type==='dayGridMonth'&&event.extendedProps.record){var start=event.extendedProps.r_start||event.start;var end=event.extendedProps.r_end||event.end;$(this.el).find(_.str.sprintf('.fc-day[data-date="%s"]',moment(start).format('YYYY-MM-DD'))).addClass('fc-has-event');var isSameDayEvent=moment(start).clone().add(1,'minute').isSame(moment(end).clone().subtract(1,'minute'),'day');if(!event.extendedProps.record.allday&&isSameDayEvent){element.addClass('o_cw_nobg');if(event.extendedProps.showTime&&!self.hideTime){const displayTime=moment(start).clone().format(self._getDbTimeFormat());element.find('.fc-content .fc-time').text(displayTime);}}}
element.on('dblclick',function(){self.trigger_up('edit_event',{id:event.id});});}},datesRender:function(info){const viewToMode=Object.fromEntries(Object.entries(self.scalesInfo).map(([k,v])=>[v,k]));self.trigger_up('viewUpdated',{mode:viewToMode[info.view.type],title:info.view.title,});},eventMouseEnter:function(mouseEnterInfo){$(self.calendarElement).find(self._computeEventSelector(mouseEnterInfo)).addClass('o_cw_custom_hover');},eventMouseLeave:function(mouseLeaveInfo){if(!mouseLeaveInfo.event.id){return;}
$(self.calendarElement).find(self._computeEventSelector(mouseLeaveInfo)).removeClass('o_cw_custom_hover');},eventDragStart:function(mouseDragInfo){mouseDragInfo.el.classList.add(mouseDragInfo.view.type);$(self.calendarElement).find(`[data-event-id=${mouseDragInfo.event.id}]`).addClass('o_cw_custom_hover');self._unselectEvent();},eventResizeStart:function(mouseResizeInfo){$(self.calendarElement).find(`[data-event-id=${mouseResizeInfo.event.id}]`).addClass('o_cw_custom_hover');self._unselectEvent();},eventLimitClick:function(){self._unselectEvent();return'popover';},windowResize:function(){self._onWindowResize();},views:{timeGridDay:{columnHeaderFormat:'LL'},timeGridWeek:{columnHeaderFormat:'ddd D'},dayGridMonth:{columnHeaderFormat:'dddd'},dayGridYear:{weekNumbers:false}},height:'parent',unselectAuto:false,timeGridEventMinHeight:15,dir:_t.database.parameters.direction,events:(info,successCB)=>{successCB(self.state.data);},},fcOptions);options.plugins.push(createYearCalendarView(FullCalendar,options));return options;},_computeEventSelector:function(info){return`[data-event-id=${info.event.id}]`;},_addEventAttributes:function(element,event){element.attr('data-event-id',event.id);},_initCalendar:function(){this.calendarElement=this.$(".o_calendar_widget")[0];var locale=moment.locale();var fcOptions=this._getFullCalendarOptions({locale:locale,});this.calendar=new FullCalendar.Calendar(this.calendarElement,fcOptions);},_initCalendarMini:function(){var self=this;this.$small_calendar=this.$(".o_calendar_mini");this.$small_calendar.datepicker({'onSelect':function(datum,obj){self.trigger_up('changeDate',{date:moment(new Date(+obj.currentYear,+obj.currentMonth,+obj.currentDay))});},'showOtherMonths':true,'dayNamesMin':this.state.fc_options.dayNamesMin.map(x=>x[0]),'monthNames':this.state.fc_options.monthNamesShort,'firstDay':this.state.fc_options.firstDay,});},_initSidebar:function(){this.$sidebar=this.$('.o_calendar_sidebar');this.$calendarSyncContainer=this.$('#calendar_sync');this.$sidebar_container=this.$(".o_calendar_sidebar_container");this._initCalendarMini();},_onPopoverShown:function($popoverElement,calendarPopover){var $popover=$($popoverElement.data('bs.popover').tip);$popover.find('.o_cw_popover_close').on('click',this._unselectEvent.bind(this));$popover.find('.o_cw_body').replaceWith(calendarPopover.$el);},async _renderView(){this.$('.o_calendar_view')[0].prepend(this.calendarElement);if(this._isInDOM){this._renderCalendar();}
this.$small_calendar.datepicker("setDate",this.state.highlight_date.toDate()).find('.o_selected_range').removeClass('o_color o_selected_range');var $a;switch(this.state.scale){case'year':$a=this.$small_calendar.find('td');break;case'month':$a=this.$small_calendar.find('td');break;case'week':$a=this.$small_calendar.find('tr:has(.ui-state-active)');break;case'day':$a=this.$small_calendar.find('a.ui-state-active');break;}
$a.addClass('o_selected_range');setTimeout(function(){$a.not('.ui-state-active').addClass('o_color');});await this._renderFilters();},_renderCalendar(){this.calendar.unselect();if(this.scalesInfo[this.state.scale]!==this.calendar.view.type){this.calendar.changeView(this.scalesInfo[this.state.scale]);}
if(this.target_date!==this.state.target_date.toString()){this.calendar.gotoDate(moment(this.state.target_date).toDate());this.target_date=this.state.target_date.toString();}else{this._renderEvents();}
this._unselectEvent();},_renderEvents:function(){this.calendar.refetchEvents();},_renderFilters:function(){this.$('.o_calendar_filter_item').popover('dispose');_.each(this.filters||(this.filters=[]),function(filter){filter.destroy();});if(this.state.fullWidth){return Promise.resolve();}
return this._renderFiltersOneByOne();},_renderFiltersOneByOne:function(filterIndex){filterIndex=filterIndex||0;var arrFilters=_.toArray(this.state.filters);var prom;if(filterIndex<arrFilters.length){var options=arrFilters[filterIndex];if(!_.find(options.filters,function(f){return f.display==null||f.display;})){return this._renderFiltersOneByOne(filterIndex+1);}
var self=this;options.getColor=this.getColor.bind(this);options.fields=this.state.fields;var sidebarFilter=new SidebarFilter(self,options);prom=sidebarFilter.appendTo(this.$sidebar).then(function(){if(options.avatar_field){_.each(options.filters,function(filter){if(!['all',false].includes(filter.value)){var selector=`.o_calendar_filter_item[data-value=${filter.value}]`;sidebarFilter.$el.find(selector).popover({animation:false,trigger:'hover',html:true,placement:'top',title:filter.label,delay:{show:300,hide:0},content:function(){return $('<img>',{src:`/web/image/${options.avatar_model}/${filter.value}/${options.avatar_field}`,class:'mx-auto',});},});}});}
return self._renderFiltersOneByOne(filterIndex+1);});this.filters.push(sidebarFilter);}
return Promise.resolve(prom);},_getDbTimeFormat:function(){return _t.database.parameters.time_format.search('%H')!==-1?'HH:mm':'hh:mm a';},_getFormattedDate:function(start,end,showDayName,allDay){const isSameDayEvent=start.clone().add(1,'minute').isSame(end.clone().subtract(1,'minute'),'day');if(allDay){end=end.clone().subtract(1,'day');}
if(!isSameDayEvent&&start.isSame(end,'month')){return start.clone().format('MMMM D')+'-'+end.clone().format('D, YYYY');}else{return isSameDayEvent?start.clone().format(showDayName?'dddd, LL':'LL'):start.clone().format('LL')+' - '+end.clone().format('LL');}},_getPopoverContext:function(eventData){var context={hideDate:this.hideDate,hideTime:this.hideTime,eventTime:{},eventDate:{},fields:this.state.fields,displayFields:this.displayFields,event:eventData,modelName:this.model,canDelete:this.canDelete,popoverFields:this.popoverFields,};var start=moment((eventData.extendedProps&&eventData.extendedProps.r_start)||eventData.start);var end=moment((eventData.extendedProps&&eventData.extendedProps.r_end)||eventData.end);var isSameDayEvent=start.clone().add(1,'minute').isSame(end.clone().subtract(1,'minute'),'day');if(!this.hideTime&&!eventData.extendedProps.record.allday&&isSameDayEvent){var dbTimeFormat=this._getDbTimeFormat();context.eventTime.time=start.clone().format(dbTimeFormat)+' - '+end.clone().format(dbTimeFormat);var durationHours=moment.duration(end.diff(start)).hours();var durationHoursKey=(durationHours===1)?'h':'hh';var durationMinutes=moment.duration(end.diff(start)).minutes();var durationMinutesKey=(durationMinutes===1)?'m':'mm';var localeData=moment.localeData();context.eventTime.duration=(durationHours>0?localeData.relativeTime(durationHours,true,durationHoursKey):'')
+(durationHours>0&&durationMinutes>0?', ':'')
+(durationMinutes>0?localeData.relativeTime(durationMinutes,true,durationMinutesKey):'');}
if(!this.hideDate){if(eventData.extendedProps.record.allday&&isSameDayEvent){context.eventDate.duration=_t("All day");}else if(eventData.extendedProps.record.allday&&!isSameDayEvent){var daysLocaleData=moment.localeData();var days=moment.duration(end.diff(start)).days();context.eventDate.duration=daysLocaleData.relativeTime(days,true,'dd');}
context.eventDate.date=this._getFormattedDate(start,end,true,eventData.extendedProps.record.allday);}
return context;},_getPopoverParams:function(eventData){const displayLock=eventData.extendedProps.record.privacy==='private'&&eventData.extendedProps.record.partner_ids.includes(session.partner_id);let title=eventData.extendedProps.record.display_name;if(title.length>30){title=title.substring(0,30)+"…";}
return{animation:false,delay:{show:50,hide:100},trigger:'manual',html:true,title:title,template:qweb.render('CalendarView.event.popover.placeholder',{color:this.getColor(eventData.extendedProps.color_index),displayLock:displayLock}),container:eventData.allDay?'.fc-view':'.fc-scroller',}},_renderEventPopover:function(eventData,$eventElement){var self=this;var calendarPopover=new self.config.CalendarPopover(self,self._getPopoverContext(eventData));calendarPopover.appendTo($('<div>')).then(()=>{$eventElement.popover(self._getPopoverParams(eventData)).on('shown.bs.popover',function(){self._onPopoverShown($(this),calendarPopover);}).popover('show');});},_renderYearEventPopover:function(date,events,$el){const groupKeys=[];const groupedEvents={};for(const event of events){const start=moment(event.extendedProps.r_start);const end=moment(event.extendedProps.r_end);const duration=moment.duration(end.diff(start)).asDays();event.extendedProps.record.start_hour=!event.extendedProps.record.allday&&duration<1?start.format("HH:mm"):"";const key=this._getFormattedDate(start,end,false,event.extendedProps.record.allday);if(!(key in groupedEvents)){groupedEvents[key]=[];groupKeys.push({key:key,start:event.start,end:event.end,isSameDayEvent:start.clone().add(1,'minute').isSame(end.clone().subtract(1,'minute'),'day'),});}
groupedEvents[key].push(event);}
const popoverContent=qweb.render('CalendarView.yearEvent.popover',{groupedEvents,groupKeys:groupKeys.sort((a,b)=>{if(a.isSameDayEvent){return Number.MIN_SAFE_INTEGER;}else if(b.isSameDayEvent){return Number.MAX_SAFE_INTEGER;}else if(a.start.getTime()-b.start.getTime()===0){return a.end.getTime()-b.end.getTime();}
return a.start.getTime()-b.start.getTime();}).map(x=>x.key),canCreate:this.canCreate,});$el.popover({animation:false,delay:{show:50,hide:100},trigger:'manual',html:true,content:popoverContent,template:qweb.render('CalendarView.yearEvent.popover.placeholder'),container:'.fc-dayGridYear-view',}).on('shown.bs.popover',()=>{$('.o_cw_popover .o_cw_popover_close').on('click',()=>this._unselectEvent());$('.o_cw_popover .o_cw_popover_create').on('click',(e)=>{e.preventDefault();e.stopPropagation();this._unselectEvent();const data={start:date,allDay:true,};if(this.state.context.default_name){data.title=this.state.context.default_name;}
this.trigger_up('openCreate',this._convertEventToFC3Event(data));});$('.o_cw_popover .o_cw_popover_link').on('click',(e)=>{e.preventDefault();e.stopPropagation();this._unselectEvent();this.trigger_up('openEvent',{_id:parseInt(e.target.dataset.id,10),title:e.target.dataset.title,});});}).popover('show');},_scrollToScrollTime:function(){var scrollTime=this.calendar.getOption('scrollTime');this.calendar.scrollToTime(scrollTime);},_unselectEvent:function(){this.$('.fc-event').removeClass('o_cw_custom_highlight');this.$('.o_cw_popover').popover('dispose');},_onWindowClick:function(e){const popover=this.el.querySelector('.o_cw_popover');if(popover&&!popover.contains(e.target)){this._unselectEvent();}},_onWindowResize:function(){this.$el.height($(window).height()-this.$el.offset().top);this.calendar.updateSize();},_onEditEvent:function(event){this._unselectEvent();this.trigger_up('openEvent',{_id:event.data.id,title:event.data.title,});},_onDeleteEvent:function(event){this._unselectEvent();this.trigger_up('deleteRecord',{id:parseInt(event.data.id,10),event:event.target.event.extendedProps});},});});;

/* /web/static/src/legacy/js/views/calendar/calendar_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarView',function(require){"use strict";var AbstractView=require('web.AbstractView');var CalendarModel=require('web.CalendarModel');var CalendarController=require('web.CalendarController');var CalendarRenderer=require('web.CalendarRenderer');var core=require('web.core');var pyUtils=require('web.py_utils');var utils=require('web.utils');var _lt=core._lt;var fieldsToGather=["date_start","date_delay","date_stop","all_day","recurrence_update","create_name_field",];const scalesInfo={day:'timeGridDay',week:'timeGridWeek',month:'dayGridMonth',year:'dayGridYear',};var CalendarView=AbstractView.extend({display_name:_lt('Calendar'),icon:'fa-calendar',jsLibs:['/web/static/lib/fullcalendar/core/main.js','/web/static/lib/fullcalendar/interaction/main.js','/web/static/lib/fullcalendar/moment/main.js','/web/static/lib/fullcalendar/daygrid/main.js','/web/static/lib/fullcalendar/timegrid/main.js','/web/static/lib/fullcalendar/list/main.js'],cssLibs:['/web/static/lib/fullcalendar/core/main.css','/web/static/lib/fullcalendar/daygrid/main.css','/web/static/lib/fullcalendar/timegrid/main.css','/web/static/lib/fullcalendar/list/main.css'],config:_.extend({},AbstractView.prototype.config,{Model:CalendarModel,Controller:CalendarController,Renderer:CalendarRenderer,}),viewType:'calendar',searchMenuTypes:['filter','favorite'],init:function(viewInfo,params){this._super.apply(this,arguments);var arch=this.arch;var fields=this.fields;var attrs=arch.attrs;if(!attrs.date_start){throw new Error(_lt("Calendar view has not defined 'date_start' attribute."));}
var mapping={};var fieldNames=fields.display_name?['display_name']:[];var displayFields={};let popoverFields={};_.each(fieldsToGather,function(field){if(arch.attrs[field]){var fieldName=attrs[field];mapping[field]=fieldName;fieldNames.push(fieldName);}});var filters={};var eventLimit=attrs.event_limit!==null&&(isNaN(+attrs.event_limit)?_.str.toBool(attrs.event_limit):+attrs.event_limit);var modelFilters=[];_.each(arch.children,function(child){if(child.tag!=='field')return;var fieldName=child.attrs.name;fieldNames.push(fieldName);popoverFields[fieldName]={attrs:child.attrs};if(!child.attrs.invisible||child.attrs.filters){child.attrs.options=child.attrs.options?pyUtils.py_eval(child.attrs.options):{};if(!child.attrs.invisible){displayFields[fieldName]={attrs:child.attrs};}
if(params.sidebar===false)return;if(child.attrs.avatar_field){filters[fieldName]=filters[fieldName]||{'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],'check_all':{},'filters':[],};filters[fieldName].avatar_field=child.attrs.avatar_field;filters[fieldName].avatar_model=fields[fieldName].relation;}
if(child.attrs.write_model){filters[fieldName]=filters[fieldName]||{'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],'check_all':{},};filters[fieldName].write_model=child.attrs.write_model;filters[fieldName].write_field=child.attrs.write_field;filters[fieldName].filter_field=child.attrs.filter_field;modelFilters.push(fields[fieldName].relation);}
if(child.attrs.filters){filters[fieldName]=filters[fieldName]||{'title':fields[fieldName].string,'fieldName':fieldName,'check_all':{},'filters':[],};if(child.attrs.color){filters[fieldName].field_color=child.attrs.color;filters[fieldName].color_model=fields[fieldName].relation;}
if(!child.attrs.avatar_field&&fields[fieldName].relation){if(fields[fieldName].relation.includes(['res.users','res.partner','hr.employee'])){filters[fieldName].avatar_field='avatar_128';}
filters[fieldName].avatar_model=fields[fieldName].relation;}}}});if(attrs.color){var fieldName=attrs.color;fieldNames.push(fieldName);}
this.controllerParams.quickAddPop=(!('quick_add'in attrs)||utils.toBoolElse(attrs.quick_add+'',true));this.controllerParams.disableQuickCreate=params.disable_quick_create||!this.controllerParams.quickAddPop;this.controllerParams.formViewId=attrs.form_view_id?parseInt(attrs.form_view_id,10):false;if(!this.controllerParams.formViewId&&params.action){var formViewDescr=_.find(params.action.views,function(v){return v.type==='form';});if(formViewDescr){this.controllerParams.formViewId=formViewDescr.viewID;}}
let scales;const allowedScales=Object.keys(scalesInfo);if(arch.attrs.scales){scales=arch.attrs.scales.split(',').filter(x=>allowedScales.includes(x));}else{scales=allowedScales;}
this.controllerParams.eventOpenPopup=utils.toBoolElse(attrs.event_open_popup||'',false);this.controllerParams.showUnusualDays=utils.toBoolElse(attrs.show_unusual_days||'',false);this.controllerParams.mapping=mapping;this.controllerParams.context=params.context||{};this.controllerParams.displayName=params.action&&params.action.name;this.controllerParams.scales=scales;this.rendererParams.displayFields=displayFields;this.rendererParams.popoverFields=popoverFields;this.rendererParams.model=viewInfo.model;this.rendererParams.hideDate=utils.toBoolElse(attrs.hide_date||'',false);this.rendererParams.hideTime=utils.toBoolElse(attrs.hide_time||'',false);this.rendererParams.canDelete=this.controllerParams.activeActions.delete;this.rendererParams.canCreate=this.controllerParams.activeActions.create;this.rendererParams.scalesInfo=scalesInfo;this.loadParams.fieldNames=_.uniq(fieldNames);this.loadParams.mapping=mapping;this.loadParams.fields=fields;this.loadParams.fieldsInfo=viewInfo.fieldsInfo;this.loadParams.editable=!fields[mapping.date_start].readonly;this.loadParams.creatable=this.controllerParams.activeActions.create;this.loadParams.eventLimit=eventLimit;this.loadParams.fieldColor=attrs.color;this.loadParams.filters=filters;this.loadParams.mode=(params.context&&params.context.default_mode)||attrs.mode;this.loadParams.scales=scales;this.loadParams.initialDate=moment((params.context&&params.context.initial_date)||params.initialDate||new Date());this.loadParams.scalesInfo=scalesInfo;},});return CalendarView;});;

/* /web/static/src/legacy/js/views/field_manager_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/field_manager_mixin',async function(require){'use strict';let __exports={};const BasicModel=require('web.BasicModel');const concurrency=require('web.concurrency');var FieldManagerMixin={custom_events:{field_changed:'_onFieldChanged',load:'_onLoad',mutexify:'_onMutexify',},init:function(model){this.model=model||new BasicModel(this);this.mutex=new concurrency.Mutex();},_applyChanges:function(dataPointID,changes,event){var self=this;var options=_.pick(event.data,'context','doNotSetDirty','notifyChange','viewType','allowWarning');return this.model.notifyChanges(dataPointID,changes,options).then(function(result){if(event.data.force_save){return self.model.save(dataPointID).then(function(){return self._confirmSave(dataPointID);}).guardedCatch(function(){return self._rejectSave(dataPointID);});}else if(options.notifyChange!==false){return self._confirmChange(dataPointID,result,event);}});},_confirmChange:function(id,fields,event){return Promise.resolve();},_confirmSave:function(id){return Promise.resolve();},_rejectSave:function(id){return Promise.resolve();},_onFieldChanged:function(event){event.stopPropagation();return this._applyChanges(event.data.dataPointID,event.data.changes,event).then(event.data.onSuccess||function(){}).guardedCatch(event.data.onFailure||function(){});},_onLoad:function(event){var self=this;event.stopPropagation();var data=event.data;if(!data.on_success){return;}
var params={};if('limit'in data){params.limit=data.limit;}
if('offset'in data){params.offset=data.offset;}
this.mutex.exec(function(){return self.model.reload(data.id,params).then(function(db_id){data.on_success(self.model.get(db_id));});});},_onMutexify:function(ev){ev.stopPropagation();this.mutex.exec(ev.data.action);},};__exports[Symbol.for("default")]=FieldManagerMixin;return __exports;});odoo.define(`web.FieldManagerMixin`,async function(require){return require('@web/legacy/js/views/field_manager_mixin')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/file_upload_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/file_upload_mixin',async function(require){'use strict';let __exports={};const{csrf_token,_t}=require('web.core');const ProgressBar=require('web.ProgressBar');const ProgressCard=require('web.ProgressCard');const ProgressBarMixin={custom_events:{progress_bar_abort:'_onProgressBarAbort',},init(){this._fileUploads={};},_createXhr(){return new window.XMLHttpRequest();},_getFileUploadRenderOptions(){return{predicate:()=>true,targetCallback:undefined,};},_getFileUploadRoute(){return'/web/binary/upload_attachment';},_makeFileUpload(params){const{files,xhr}=params;const fileUploadId=_.uniqueId('fileUploadId');const formData=new FormData();const formDataKeys=this._makeFileUploadFormDataKeys(Object.assign({fileUploadId},params));formData.append('csrf_token',csrf_token);for(const key in formDataKeys){if(formDataKeys[key]!==undefined){formData.append(key,formDataKeys[key]);}}
for(const file of files){formData.append('ufile',file);}
return{fileUploadId,xhr,title:files.length===1?files[0].name:_.str.sprintf(_t("%s Files"),files.length),type:files.length===1?files[0].type:undefined,formData,};},_makeFileUploadFormDataKeys({fileUploadId}){return{callback:fileUploadId,};},async _removeFileUpload(fileUploadId){const upload=this._fileUploads[fileUploadId];upload.progressCard&&upload.progressCard.destroy();upload.progressBar&&upload.progressBar.destroy();delete this._fileUploads[fileUploadId];await this.reload();},async _renderFileUploads(){const{predicate,targetCallback}=this._getFileUploadRenderOptions();for(const fileUploadId in this._fileUploads){const upload=this._fileUploads[fileUploadId];if(!predicate(upload)){continue;}
if(!upload.progressBar){if(!upload.recordId||this.viewType!=='kanban'){upload.progressCard=new ProgressCard(this,{title:upload.title,type:upload.type,viewType:this.viewType,});}
upload.progressBar=new ProgressBar(this,{xhr:upload.xhr,title:upload.title,fileUploadId,});}
let $targetCard;if(upload.progressCard){await upload.progressCard.prependTo(this.renderer.$el);$targetCard=upload.progressCard.$el;}else if(targetCallback){$targetCard=targetCallback(upload);}
await upload.progressBar.appendTo($targetCard);}},async _uploadFiles(files,params={}){if(!files||!files.length){return;}
await new Promise(resolve=>{const xhr=this._createXhr();xhr.open('POST',this._getFileUploadRoute());const fileUploadData=this._makeFileUpload(Object.assign({files,xhr},params));const{fileUploadId,formData}=fileUploadData;this._fileUploads[fileUploadId]=fileUploadData;xhr.upload.addEventListener("progress",ev=>{this._updateFileUploadProgress(fileUploadId,ev);});const progressPromise=this._onBeforeUpload();xhr.onload=async()=>{await progressPromise;resolve();this._onUploadLoad({fileUploadId,xhr});};xhr.onerror=async()=>{await progressPromise;resolve();this._onUploadError({fileUploadId,xhr});};xhr.send(formData);});},_updateFileUploadProgress(fileUploadId,ev){const{progressCard,progressBar}=this._fileUploads[fileUploadId];progressCard&&progressCard.update(ev.loaded,ev.total);progressBar&&progressBar.update(ev.loaded,ev.total);},async _onBeforeUpload(){await this._renderFileUploads();},_onProgressBarAbort(ev){this._removeFileUpload(ev.data.fileUploadId);},_onUploadLoad({fileUploadId}){this._removeFileUpload(fileUploadId);},_onUploadError({fileUploadId,xhr}){this.displayNotification({title:xhr.status,message:_.str.sprintf(_t('message: %s'),xhr.reponseText),sticky:true});this._removeFileUpload(fileUploadId);},};__exports[Symbol.for("default")]=ProgressBarMixin;return __exports;});odoo.define(`web.fileUploadMixin`,async function(require){return require('@web/legacy/js/views/file_upload_mixin')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/file_upload_progress_bar.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/file_upload_progress_bar',async function(require){'use strict';let __exports={};const{_t}=require('web.core');const Dialog=require('web.Dialog');const Widget=require('web.Widget');const ProgressBar=Widget.extend({template:'web.FileUploadProgressBar',events:{'click .o_upload_cross':'_onClickCross',},init(parent,{title,fileUploadId,xhr}){this._super(...arguments);this.title=title;this.fileUploadId=fileUploadId;this.xhr=xhr;},start(){this.xhr.onabort=()=>this.displayNotification({message:_t("Upload cancelled")});return this._super(...arguments);},update(loaded,total){if(!this.$el){return;}
const percent=Math.round((loaded/total)*100);this.$('.o_file_upload_progress_bar_value').css("width",percent+"%");},_onClickCross(ev){ev.stopPropagation();const promptText=_.str.sprintf(_t("Do you really want to cancel the upload of %s?"),_.escape(this.title));Dialog.confirm(this,promptText,{confirm_callback:()=>{this.xhr.abort();this.trigger_up('progress_bar_abort',{fileUploadId:this.fileUploadId});}});},});__exports[Symbol.for("default")]=ProgressBar;return __exports;});odoo.define(`web.ProgressBar`,async function(require){return require('@web/legacy/js/views/file_upload_progress_bar')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/file_upload_progress_card.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/file_upload_progress_card',async function(require){'use strict';let __exports={};const{_t}=require('web.core');const Widget=require('web.Widget');const ProgressCard=Widget.extend({template:'web.ProgressCard',init(parent,{title,type,viewType}){this._super(...arguments);this.title=title;this.type=type;this.viewType=viewType;},update(loaded,total){if(!this.$el){return;}
const percent=Math.round((loaded/total)*100);const $textDivLeft=this.$('.o_file_upload_progress_text_left');const $textDivRight=this.$('.o_file_upload_progress_text_right');if(percent===100){$textDivLeft.text(_t('Processing...'));}else{const mbLoaded=Math.round(loaded/1000000);const mbTotal=Math.round(total/1000000);$textDivLeft.text(_.str.sprintf(_t("Uploading... (%s%%)"),percent));$textDivRight.text(_.str.sprintf(_t("(%s/%sMb)"),mbLoaded,mbTotal));}},});__exports[Symbol.for("default")]=ProgressCard;return __exports;});odoo.define(`web.ProgressCard`,async function(require){return require('@web/legacy/js/views/file_upload_progress_card')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/form/form_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormController',function(require){"use strict";var BasicController=require('web.BasicController');var core=require('web.core');var Dialog=require('web.Dialog');var dialogs=require('web.view_dialogs');var _t=core._t;var qweb=core.qweb;var FormController=BasicController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{button_clicked:'_onButtonClicked',edited_list:'_onEditedList',open_one2many_record:'_onOpenOne2ManyRecord',open_record:'_onOpenRecord',toggle_column_order:'_onToggleColumnOrder',focus_control_button:'_onFocusControlButton',form_dialog_discarded:'_onFormDialogDiscarded',quick_edit:'_onQuickEdit',}),multiClickTime:350,init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.actionButtons=params.actionButtons;this.disableAutofocus=params.disableAutofocus;this.footerToButtons=params.footerToButtons;this.defaultButtons=params.defaultButtons;this.hasActionMenus=params.hasActionMenus;this.toolbarActions=params.toolbarActions||{};this.quickEditTimeout=undefined;},on_attach_callback:function(){this._super.apply(this,arguments);this.autofocus();},willRestore:function(shouldReload){this.mode=this.model.isNew(this.handle)?'edit':'readonly';if(shouldReload){return this._setMode(this.mode);}},autofocus:function(){if(!this.disableAutofocus){var isControlActivted=this.renderer.autofocus();if(!isControlActivted){if(this.$buttons&&this.mode==='readonly'){return this.$buttons.find('.o_form_button_edit').focus();}}}},canBeDiscarded:function(recordId){if(recordId!==this.handle&&this.isDirty(recordId)){return Promise.reject();}else{return Promise.resolve(true);}},createRecord:async function(parentID,additionalContext){const record=this.model.get(this.handle,{raw:true});const handle=await this.model.load({context:record.getContext({additionalContext:additionalContext}),fields:record.fields,fieldsInfo:record.fieldsInfo,modelName:this.modelName,parentID:parentID,res_ids:record.res_ids,type:'record',viewType:'form',});this.handle=handle;this._updateControlPanel();return this._setMode('edit');},getSelectedIds:function(){var env=this.model.get(this.handle,{env:true});return env.currentId?[env.currentId]:[];},getTitle:function(){return this.model.getName(this.handle);},getState:function(){const state=this._super.apply(this,arguments);const env=this.model.get(this.handle,{env:true});state.id=env.currentId;return state;},renderButtons:function($node){var $footer=this.footerToButtons?this.renderer.$el&&this.renderer.$('footer'):null;var mustRenderFooterButtons=$footer&&$footer.length;if((this.defaultButtons&&!this.$buttons)||mustRenderFooterButtons){this.$buttons=$('<div/>');if(mustRenderFooterButtons){this.$buttons.append($footer);}else{this.$buttons.append(qweb.render("FormView.buttons",{widget:this}));this.$buttons.on('click','.o_form_button_edit',this._onEdit.bind(this));this.$buttons.on('click','.o_form_button_create',this._onCreate.bind(this));this.$buttons.on('click','.o_form_button_save',this._onSave.bind(this));this.$buttons.on('click','.o_form_button_cancel',this._onDiscard.bind(this));this._assignSaveCancelKeyboardBehavior(this.$buttons.find('.o_form_buttons_edit'));this.$buttons.find('.o_form_buttons_edit').tooltip({delay:{show:200,hide:0},title:function(){return qweb.render('SaveCancelButton.tooltip');},trigger:'manual',});}}
if(this.$buttons&&$node){this.$buttons.appendTo($node);}},_getPagingInfo:function(){if(this.model.isNew(this.handle)){return null;}
return Object.assign(this._super(...arguments),{validate:this.saveChanges.bind(this),});},_getActionMenuItems:function(state){if(!this.hasActionMenus||this.mode==='edit'){return null;}
const props=this._super(...arguments);const activeField=this.model.getActiveField(state);const otherActionItems=[];if(this.archiveEnabled&&activeField in state.data){if(state.data[activeField]){otherActionItems.push({description:_t("Archive"),callback:()=>{Dialog.confirm(this,_t("Are you sure that you want to archive this record?"),{confirm_callback:()=>this._toggleArchiveState(true),});},});}else{otherActionItems.push({description:_t("Unarchive"),callback:()=>this._toggleArchiveState(false),});}}
if(this.activeActions.create&&this.activeActions.duplicate){otherActionItems.push({description:_t("Duplicate"),callback:()=>this._onDuplicateRecord(this),});}
if(this.activeActions.delete){otherActionItems.push({description:_t("Delete"),callback:()=>this._onDeleteRecord(this),});}
return Object.assign(props,{items:Object.assign(this.toolbarActions,{other:otherActionItems}),});},saveRecord:async function(){const changedFields=await this._super(...arguments);this._updateControlPanel();if(_t.database.multi_lang&&changedFields.length){var fields=this.renderer.state.fields;var data=this.renderer.state.data;var alertFields={};for(var k=0;k<changedFields.length;k++){var field=fields[changedFields[k]];var fieldData=data[changedFields[k]];if(field.translate&&fieldData&&fieldData!=='<p><br></p>'){alertFields[changedFields[k]]=field;}}
if(!_.isEmpty(alertFields)){this.renderer.updateAlertFields(alertFields);}}
return changedFields;},update:async function(params,options){if('currentId'in params&&!params.currentId){this.mode='edit';}
params=_.extend({viewType:'form',mode:this.mode},params);await this._super(params,options);this.autofocus();},updateButtons:function(){if(!this.$buttons){return;}
if(this.footerToButtons){var $footer=this.renderer.$el&&this.renderer.$('footer');if($footer&&$footer.length){this.$buttons.empty().append($footer);}}
var edit_mode=(this.mode==='edit');this.$buttons.find('.o_form_buttons_edit').toggleClass('o_hidden',!edit_mode);this.$buttons.find('.o_form_buttons_view').toggleClass('o_hidden',edit_mode);},_applyChanges:async function(){const result=await this._super.apply(this,arguments);core.bus.trigger('DOM_updated');return result;},_assignSaveCancelKeyboardBehavior:function($saveCancelButtonContainer){var self=this;$saveCancelButtonContainer.children().on('keydown',function(e){switch(e.which){case $.ui.keyCode.ENTER:e.preventDefault();self.saveRecord();break;case $.ui.keyCode.ESCAPE:e.preventDefault();self._discardChanges();break;case $.ui.keyCode.TAB:if(!e.shiftKey&&e.target.classList.contains('btn-primary')){$saveCancelButtonContainer.tooltip('show');e.preventDefault();}
break;}});},_confirmSave:function(id){if(id===this.handle){if(this.mode==='readonly'){return this.reload();}else{return this._setMode('readonly');}}else{var record=this.model.get(this.handle);var containsChangedRecord=function(value){return _.isObject(value)&&(value.id===id||_.find(value.data,containsChangedRecord));};var changedFields=_.findKey(record.data,containsChangedRecord);return this.renderer.confirmChange(record,record.id,[changedFields]);}},_disableButtons:function(){this._super.apply(this,arguments);this.renderer.disableButtons();},_enableButtons:function(){this._super.apply(this,arguments);this.renderer.enableButtons();},_onDeletedRecords:function(){var state=this.model.get(this.handle,{raw:true});if(!state.res_ids.length){this.trigger_up('history_back');}else{this._super.apply(this,arguments);}},_rejectSave:function(){if(this.mode==='readonly'){return this.reload();}
return this._super.apply(this,arguments);},_setEditMode:function(){this._disableButtons();return this.mutex.getUnlockedDef().then(this._setMode.bind(this,'edit')).then(this._enableButtons.bind(this)).guardedCatch(this._enableButtons.bind(this));},_setMode:function(mode,recordID){if((recordID||this.handle)===this.handle){this.model.unfreezeOrder(this.handle);}
if(this.mode!==mode){this.renderer.resetLastActivatedField();}
return this._super.apply(this,arguments);},_shouldBounceOnClick(element){return this.mode==='readonly'&&!!element.closest('.oe_title, .o_inner_group')&&this.quickEditTimeout===undefined;},_onBeforeUnload:function(){this._urgentSave(this.handle);},_onButtonClicked:function(ev){ev.stopPropagation();var self=this;var def;this._disableButtons();function saveAndExecuteAction(){return self.saveRecord(self.handle,{stayInEdit:true,}).then(function(){var record=self.model.get(ev.data.record.id);return self._callButtonAction(attrs,record);});}
var attrs=ev.data.attrs;if(attrs.confirm){def=new Promise(function(resolve,reject){Dialog.confirm(self,attrs.confirm,{confirm_callback:saveAndExecuteAction,}).on("closed",null,resolve);});}else if(attrs.special==='cancel'){def=this._callButtonAction(attrs,ev.data.record);}else if(!attrs.special||attrs.special==='save'){def=saveAndExecuteAction();}else{console.warn('Unhandled button event',ev);return;}
def.then(function(){self._enableButtons();if(attrs.close){self.trigger_up('close_dialog');}}).guardedCatch(this._enableButtons.bind(this));},_onCreate:function(){this.createRecord();},_onDeleteRecord:function(){this._deleteRecords([this.handle]);},_onDiscard:function(){this._disableButtons();this._discardChanges().then(this._enableButtons.bind(this)).guardedCatch(this._enableButtons.bind(this));},_onDuplicateRecord:async function(){const handle=await this.model.duplicateRecord(this.handle);this.handle=handle;this._updateControlPanel();this._setMode('edit');},_onEdit:function(){this._setEditMode();},_onEditedList:function(ev){ev.stopPropagation();if(ev.data.id){this.model.save(ev.data.id,{savePoint:true});}
this.model.freezeOrder(ev.data.id);},_onFocusControlButton:function(e){if(this.$buttons){e.stopPropagation();this.$buttons.find('.btn-primary:visible:first()').focus();}},_onFormDialogDiscarded:function(ev){ev.stopPropagation();var isFocused=this.renderer.focusLastActivatedWidget();if(ev.data.callback){ev.data.callback(_.str.toBool(isFocused));}},_onOpenOne2ManyRecord:async function(ev){ev.stopPropagation();var data=ev.data;var record;if(data.id){record=this.model.get(data.id,{raw:true});}
await this.model.mutex.getUnlockedDef();new dialogs.FormViewDialog(this,{context:data.context,domain:data.domain,fields_view:data.fields_view,model:this.model,on_saved:data.on_saved,on_remove:data.on_remove,parentID:data.parentID,readonly:data.readonly,editable:data.editable,deletable:record?data.deletable:false,disable_multiple_selection:data.disable_multiple_selection,recordID:record&&record.id,res_id:record&&record.res_id,res_model:data.field.relation,shouldSaveLocally:true,title:(record?_t("Open: "):_t("Create "))+(ev.target.string||data.field.string),}).open();},_onOpenRecord:function(ev){ev.stopPropagation();var self=this;var record=this.model.get(ev.data.id,{raw:true});new dialogs.FormViewDialog(self,{context:ev.data.context,fields_view:ev.data.fields_view,on_saved:ev.data.on_saved,on_remove:ev.data.on_remove,readonly:ev.data.readonly,deletable:ev.data.deletable,editable:ev.data.editable,res_id:record.res_id,res_model:record.model,title:_t("Open: ")+ev.data.string,}).open();},_onQuickEdit:function(ev){ev.stopPropagation();clearTimeout(this.quickEditTimeout);if(this.activeActions.edit&&!window.getSelection().toString()){const quickEdit=async()=>{if(!this.isDestroyed()){await this._setEditMode();this.renderer.quickEdit(ev.data);}
this.quickEditTimeout=undefined;};if(this.multiClickTime>0){this.quickEditTimeout=setTimeout(quickEdit,this.multiClickTime);}else{quickEdit();}}},_onSave:function(ev){ev.stopPropagation();this._disableButtons();this.saveRecord().then(this._enableButtons.bind(this)).guardedCatch(this._enableButtons.bind(this));},_onToggleColumnOrder:function(ev){ev.stopPropagation();var self=this;this.model.setSort(ev.data.id,ev.data.name).then(function(){var field=ev.data.field;var state=self.model.get(self.handle);self.renderer.confirmChange(state,state.id,[field]);});},_toggleArchiveState:function(archive){const resIds=this.model.localIdsToResIds([this.handle]);this._archive(resIds,archive);},});return FormController;});;

/* /web/static/src/legacy/js/views/form/form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var viewUtils=require('web.viewUtils');var _t=core._t;var qweb=core.qweb;const scrollUtils=require("@web/core/utils/scrolling");const symbol=Symbol('form');var FormRenderer=BasicRenderer.extend({className:"o_form_view",events:_.extend({},BasicRenderer.prototype.events,{'click .o_notification_box .oe_field_translate':'_onTranslate','click .o_notification_box .close':'_onTranslateNotificationClose','shown.bs.tab a[data-toggle="tab"]':'_onNotebookTabChanged','click .o_form_label':'_onFieldLabelClicked',}),custom_events:_.extend({},BasicRenderer.prototype.custom_events,{'navigation_move':'_onNavigationMove','activate_next_widget':'_onActivateNextWidget','quick_edit':'_onQuickEdit',}),INNER_GROUP_COL:2,OUTER_GROUP_COL:2,quickEditExclusion:['.o_list_view tbody','.oe_button_box','.oe_subtotal_footer',],init:function(parent,state,params){this._super.apply(this,arguments);this.fieldIdsToNames=params.fieldIdsToNames;this.idsForLabels={};this.lastActivatedFieldIndex=-1;this.alertFields={};this.labelsToPostProcess=[];this.renderInvisible=false;},start:function(){this._applyFormSizeClass();return this._super.apply(this,arguments);},on_attach_callback:function(){this._super.apply(this,arguments);core.bus.on("SCROLLER:ANCHOR_LINK_CLICKED",this,this._onAnchorLinkClicked);},on_detach_callback:function(){this._super.apply(this,arguments);core.bus.off("SCROLLER:ANCHOR_LINK_CLICKED",this,this._onAnchorLinkClicked);},autofocus:function(){if(this.mode==='readonly'){var firstPrimaryFormButton=this.$el.find('button.btn-primary:enabled:visible:first()');if(firstPrimaryFormButton.length>0){return firstPrimaryFormButton.focus();}else{return;}}
var focusWidget=this.defaultFocusField;if(!focusWidget||!focusWidget.isFocusable()){var widgets=this.allFieldWidgets[this.state.id];for(var i=0;i<(widgets?widgets.length:0);i++){var widget=widgets[i];if(widget.isFocusable()){focusWidget=widget;break;}}}
if(focusWidget){return focusWidget.activate({noselect:true,noAutomaticCreate:true});}},canBeSaved:function(){var fieldNames=this._super.apply(this,arguments);var $labels=this.$('label');$labels.removeClass('o_field_invalid');const allWidgets=this.allFieldWidgets[this.state.id]||[];const widgets=allWidgets.filter(w=>fieldNames.includes(w.name));for(const widget of widgets){const idForLabel=this.idsForLabels[widget[symbol]];if(idForLabel){$labels.filter('[for='+idForLabel+']').addClass('o_field_invalid');}}
return fieldNames;},updateAlertFields:function(alertFields){if(this.state.res_id){this.alertFields[this.state.res_id]=_.extend(this.alertFields[this.state.res_id]||{},alertFields);this.displayTranslationAlert();}},displayTranslationAlert:function(){this.$('.o_notification_box').remove();if(this.alertFields[this.state.res_id]){var $notification=$(qweb.render('notification-box',{type:'info'})).append(qweb.render('translation-alert',{fields:this.alertFields[this.state.res_id],lang:_t.database.parameters.name}));if(this.$('.o_form_statusbar').length){this.$('.o_form_statusbar').after($notification);}else if(this.$('.o_form_sheet_bg').length){this.$('.o_form_sheet_bg').prepend($notification);}else{this.$el.prepend($notification);}}},confirmChange:function(){var self=this;return this._super.apply(this,arguments).then(function(resetWidgets){_.each(resetWidgets,function(widget){self._setIDForLabel(widget,self.idsForLabels[widget[symbol]]);});if(self.$('.o_field_invalid').length){self.canBeSaved(self.state.id);}
self._postProcessLabels();return resetWidgets;});},disableButtons:function(){this.$('.o_statusbar_buttons button, .oe_button_box button').attr('disabled',true);},enableButtons:function(){this.$('.o_statusbar_buttons button, .oe_button_box button').removeAttr('disabled');},focusLastActivatedWidget:function(){if(this.lastActivatedFieldIndex!==-1){return this._activateNextFieldWidget(this.state,this.lastActivatedFieldIndex-1,{noAutomaticCreate:true});}
return false;},getLocalState:function(){const state={};const sheetBg=this.el.querySelector('.o_form_sheet_bg');if(sheetBg){state.scrollValue=sheetBg.scrollTop;}
for(const notebook of this.el.querySelectorAll(':scope div.o_notebook')){const name=notebook.dataset.name;const navs=notebook.querySelectorAll(':scope .o_notebook_headers .nav-item > .nav-link');state[name]=Math.max([...navs].findIndex(nav=>nav.classList.contains('active')),0);}
return state;},quickEdit:function(quickEditInfo){const{fieldName,extraInfo}=quickEditInfo;const fieldWidget=this.allFieldWidgets[this.state.id].find(field=>field.name===fieldName&&field.isFocusable());if(fieldWidget){fieldWidget.quickEdit(extraInfo);}},resetLastActivatedField:function(){this.lastActivatedFieldIndex=-1;},resetLocalState(){for(const notebook of this.el.querySelectorAll(':scope div.o_notebook')){[...notebook.querySelectorAll(':scope .o_notebook_headers .nav-item .nav-link')].map(nav=>nav.classList.remove('active'));[...notebook.querySelectorAll(':scope .tab-content > .tab-pane')].map(tab=>tab.classList.remove('active'));}},setLocalState:function(state){for(const notebook of this.el.querySelectorAll(':scope div.o_notebook')){if(notebook.closest(".o_field_widget")){continue;}
const name=notebook.dataset.name;if(name in state){const navs=notebook.querySelectorAll(':scope .o_notebook_headers .nav-item');const pages=notebook.querySelectorAll(':scope > .tab-content > .tab-pane');const validTabsAmount=pages.length;if(!validTabsAmount){continue;}
let activeIndex=state[name];if(navs[activeIndex].classList.contains('o_invisible_modifier')){activeIndex=[...navs].findIndex(nav=>!nav.classList.contains('o_invisible_modifier'));}
if(activeIndex<=0){continue;}
for(let i=0;i<validTabsAmount;i++){navs[i].querySelector('.nav-link').classList.toggle('active',activeIndex===i);pages[i].classList.toggle('active',activeIndex===i);}
core.bus.trigger('DOM_updated');}}
const sheetBg=this.el.querySelector('.o_form_sheet_bg');if(sheetBg){sheetBg.scrollTop=state.scrollValue;}},updateState:function(state,params){this._setState(state);this.mode=(params&&'mode'in params)?params.mode:this.mode;if(params.fieldNames){return this.confirmChange(this.state,this.state.id,params.fieldNames);}
return this._super.apply(this,arguments);},_activateFirstVisibleTab(tabs){const visibleTabs=tabs.filter((tab)=>!tab.$header.hasClass("o_invisible_modifier"));const autofocusTab=visibleTabs.findIndex((tab)=>tab.node.attrs.autofocus==="autofocus");const tabToFocus=visibleTabs[Math.max(0,autofocusTab)];if(tabToFocus){tabToFocus.$header.find('.nav-link').addClass('active');tabToFocus.$page.addClass('active');}},_activateNextFieldWidget:function(record,currentIndex){if((currentIndex+1)>=(this.allFieldWidgets[record.id]||[]).length){this.trigger_up('focus_control_button');this.lastActivatedFieldIndex=-1;}else{var activatedIndex=this._super.apply(this,arguments);if(activatedIndex===-1){this.trigger_up('focus_control_button');this.lastActivatedFieldIndex=-1;}
else{this.lastActivatedFieldIndex=activatedIndex;}}
return this.lastActivatedFieldIndex;},_addButtonTooltip:function(node,$button){var self=this;$button.tooltip({title:function(){return qweb.render('WidgetButton.tooltip',{debug:config.isDebug(),state:self.state,node:node,});},});},_addOnClickAction:function($el,node){if(node.attrs.special||node.attrs.confirm||node.attrs.type||$el.hasClass('oe_stat_button')){var self=this;$el.on("click",function(){self.trigger_up('button_clicked',{attrs:node.attrs,record:self.state,});});}},_applyFormSizeClass:function(){const formEl=this.$el[0];if(config.device.size_class<=config.device.SIZES.XS){formEl.classList.add('o_xxs_form_view');}else{formEl.classList.remove('o_xxs_form_view');}
if(config.device.size_class===config.device.SIZES.XXL){formEl.classList.add('o_xxl_form_view');}else{formEl.classList.remove('o_xxl_form_view');}},_getIDForLabel:function(uid){if(!this.idsForLabels[uid]){this.idsForLabels[uid]=_.uniqueId('o_field_input_');}
return this.idsForLabels[uid];},_getRecord:function(recordId){return this.state.id===recordId?this.state:null;},_postProcessField:function(widget,node){this._super.apply(this,arguments);widget[symbol]=node.attrs.id;this._setIDForLabel(widget,this._getIDForLabel(node.attrs.id));if(JSON.parse(node.attrs.default_focus||"0")){this.defaultFocusField=widget;}},_postProcessLabels(){this.labelsToPostProcess.forEach((label)=>{label.call();});this.labelsToPostProcess=[];},_renderButtonBox:function(node){var self=this;var $result=$('<'+node.tag+'>',{class:'o_not_full'});var nextDefIndex=this.defs.length;var buttons=_.map(node.children,function(child){if(child.tag==='button'){return self._renderStatButton(child);}else{return self._renderNode(child);}});var $tempWrapper=$('<div>');_.each(buttons,function($button){$button.appendTo($tempWrapper);});var defs=this.defs.slice(nextDefIndex);Promise.all(defs).then(function(){buttons=$tempWrapper.children();var buttons_partition=_.partition(buttons,function(button){return $(button).is('.o_invisible_modifier');});var invisible_buttons=buttons_partition[0];var visible_buttons=buttons_partition[1];var nb_buttons=self._renderButtonBoxNbButtons();var unfolded_buttons=visible_buttons.slice(0,nb_buttons).concat(invisible_buttons);var folded_buttons=visible_buttons.slice(nb_buttons);if(folded_buttons.length===1){unfolded_buttons=buttons;folded_buttons=[];}
var full=(visible_buttons.length>nb_buttons);$result.toggleClass('o_full',full).toggleClass('o_not_full',!full);_.each(unfolded_buttons,function(button){$(button).appendTo($result);});if(folded_buttons.length){$result.append(dom.renderButton({attrs:{'class':'oe_stat_button o_button_more dropdown-toggle','data-toggle':'dropdown',},text:_t("More"),}));var $dropdown=$("<div>",{class:"dropdown-menu o_dropdown_more",role:"menu"});_.each(folded_buttons,function(button){$(button).addClass('dropdown-item').appendTo($dropdown);});$dropdown.appendTo($result);}});this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);return $result;},_renderButtonBoxNbButtons:function(){return[2,2,2,4][config.device.size_class]||7;},_renderFieldWidget(node){if(!this.renderInvisible&&node.attrs.modifiers.invisible===true){return $();}
return this._super(...arguments);},_renderGenericTag:function(node){var $result=$('<'+node.tag+'>',_.omit(node.attrs,'modifiers'));this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);$result.append(_.map(node.children,this._renderNode.bind(this)));return $result;},_renderHeaderButton:function(node){var $button=viewUtils.renderButtonFromNode(node);if($button.not('.btn-primary, .btn-secondary, .btn-link, .btn-success, .btn-info, .btn-warning, .btn-danger').length){$button.addClass('btn-secondary');}
this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);if(config.isDebug()||node.attrs.help){this._addButtonTooltip(node,$button);}
return $button;},_renderHeaderButtons:function(node){var self=this;var buttons=[];_.each(node.children,function(child){if(child.tag==='button'){buttons.push(self._renderHeaderButton(child));}
if(child.tag==='widget'){buttons.push(self._renderTagWidget(child));}});return this._renderStatusbarButtons(buttons);},_renderInnerGroup:function(node){var self=this;var $result=$('<table/>',{class:'o_group o_inner_group'});var $tbody=$('<tbody />').appendTo($result);this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);var col=parseInt(node.attrs.col,10)||this.INNER_GROUP_COL;if(node.attrs.string){var $sep=$('<tr><td colspan="'+col+'" style="width: 100%;"><div class="o_horizontal_separator">'+node.attrs.string+'</div></td></tr>');$result.append($sep);}
var rows=[];var $currentRow=$('<tr/>');var currentColspan=0;node.children.forEach(function(child){if(child.tag==='newline'){rows.push($currentRow);$currentRow=$('<tr/>');currentColspan=0;return;}
var colspan=parseInt(child.attrs.colspan,10);var isLabeledField=(child.tag==='field'&&child.attrs.nolabel!=='1');if(!colspan){if(isLabeledField){colspan=2;}else{colspan=1;}}
var finalColspan=colspan-(isLabeledField?1:0);currentColspan+=colspan;if(currentColspan>col){rows.push($currentRow);$currentRow=$('<tr/>');currentColspan=colspan;}
var $tds;if(child.tag==='field'){$tds=self._renderInnerGroupField(child);}else if(child.tag==='label'){$tds=self._renderInnerGroupLabel(child);}else{var $td=$('<td/>');var $child=self._renderNode(child);if($child.hasClass('o_td_label')){$td.addClass('o_td_label');$child.removeClass('o_td_label');}
$tds=$td.append($child);}
if(finalColspan>1){$tds.last().attr('colspan',finalColspan);}
$currentRow.append($tds);});rows.push($currentRow);_.each(rows,function($tr){var nonLabelColSize=100/(col-$tr.children('.o_td_label').length);_.each($tr.children(':not(.o_td_label)'),function(el){var $el=$(el);$el.css('width',((parseInt($el.attr('colspan'),10)||1)*nonLabelColSize)+'%');});$tbody.append($tr);});return $result;},_renderInnerGroupField:function(node){var $el=this._renderFieldWidget(node,this.state);var $tds=$('<td/>').append($el);if(node.attrs.nolabel!=='1'){var $labelTd=this._renderInnerGroupLabel(node);$tds=$labelTd.add($tds);if(/\boe_edit_only\b/.test(node.attrs.class)){$tds.addClass('oe_edit_only');}
if(/\boe_read_only\b/.test(node.attrs.class)){$tds.addClass('oe_read_only');}}
return $tds;},_renderInnerGroupLabel:function(node){return $('<td/>',{class:'o_td_label'}).append(this._renderTagLabel(node));},_renderNode:function(node){var renderer=this['_renderTag'+_.str.capitalize(node.tag)];if(renderer){return renderer.call(this,node);}
if(node.tag==='div'&&node.attrs.name==='button_box'){return this._renderButtonBox(node);}
if(_.isString(node)){return node;}
return this._renderGenericTag(node);},_renderOuterGroup:function(node){var self=this;var $result=$('<div/>',{class:'o_group'});var nbCols=parseInt(node.attrs.col,10)||this.OUTER_GROUP_COL;var colSize=Math.max(1,Math.round(12/nbCols));if(node.attrs.string){var $sep=$('<div/>',{class:'o_horizontal_separator'}).text(node.attrs.string);$result.append($sep);}
$result.append(_.map(node.children,function(child){if(child.tag==='newline'){return $('<br/>');}
var $child=self._renderNode(child);$child.addClass('o_group_col_'+(colSize*(parseInt(child.attrs.colspan,10)||1)));return $child;}));this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);return $result;},_renderStatButton:function(node){var $button=viewUtils.renderButtonFromNode(node,{extraClass:'oe_stat_button',});$button.append(_.map(node.children,this._renderNode.bind(this)));if(node.attrs.help){this._addButtonTooltip(node,$button);}
this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);return $button;},_renderStatusbarButtons:function(buttons){var $statusbarButtons=$('<div>',{class:'o_statusbar_buttons'});buttons.forEach(button=>$statusbarButtons.append(button));return $statusbarButtons;},_renderTabHeader:function(page,page_id){var $a=$('<a>',{'data-toggle':'tab',disable_anchor:'true',href:'#'+page_id,class:'nav-link',role:'tab',text:page.attrs.string,});return $('<li>',{class:'nav-item'}).append($a);},_renderTabPage:function(page,page_id){var $result=$('<div class="tab-pane" id="'+page_id+'">');$result.append(_.map(page.children,this._renderNode.bind(this)));return $result;},_renderTagButton:function(node){var $button=viewUtils.renderButtonFromNode(node);$button.append(_.map(node.children,this._renderNode.bind(this)));this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);if(config.isDebug()||node.attrs.help){this._addButtonTooltip(node,$button);}
return $button;},_renderTagField:function(node){return this._renderFieldWidget(node,this.state);},_renderTagForm:function(node){var $result=$('<div/>');if(node.attrs.class){$result.addClass(node.attrs.class);}
var allNodes=node.children.map(this._renderNode.bind(this));$result.append(allNodes);return $result;},_renderTagGroup:function(node){var isOuterGroup=_.some(node.children,function(child){return child.tag==='group';});if(!isOuterGroup){return this._renderInnerGroup(node);}
return this._renderOuterGroup(node);},_renderTagHeader:function(node){var self=this;var $statusbar=$('<div>',{class:'o_form_statusbar'});$statusbar.append(this._renderHeaderButtons(node));_.each(node.children,function(child){if(child.tag==='field'){var $el=self._renderFieldWidget(child,self.state);$statusbar.append($el);}});this._handleAttributes($statusbar,node);this._registerModifiers(node,this.state,$statusbar);return $statusbar;},_renderTagLabel:function(node){if(!this.renderInvisible&&node.tag==='field'&&node.attrs.modifiers.invisible===true){return $();}
var self=this;var text;let fieldName;if(node.tag==='label'){fieldName=this.fieldIdsToNames[node.attrs.for];}else{fieldName=node.attrs.name;}
if('string'in node.attrs){text=node.attrs.string;}else if(fieldName){text=this.state.fields[fieldName].string;}else{return this._renderGenericTag(node);}
var $result=$('<label>',{class:'o_form_label',for:this._getIDForLabel(node.tag==='label'?node.attrs.for:node.attrs.id),text:text,});if(node.tag==='label'){this._handleAttributes($result,node);}
var modifiersOptions;if(fieldName){modifiersOptions={callback:function(element,modifiers,record){var widgets=self.allFieldWidgets[record.id];var widget=_.findWhere(widgets,{name:fieldName});const fieldsInfo=record.fieldsInfo[self.viewType];if(!widget){if(fieldsInfo[fieldName]){self.labelsToPostProcess.push(element.callback.bind(self,element,modifiers,record));}
return;}
element.$el.toggleClass('o_form_label_empty',!!(record.data.id&&(modifiers.readonly||self.mode==='readonly')&&!widget.isSet()));},};}
this._registerModifiers(node,this.state,$result,modifiersOptions);return $result;},_renderTagNotebook:function(node){var self=this;var $headers=$('<ul class="nav nav-tabs">');var $pages=$('<div class="tab-content">');var renderedTabs=_.map(node.children,function(child,index){var pageID=_.uniqueId('notebook_page_');var $header=self._renderTabHeader(child,pageID);var $page=self._renderTabPage(child,pageID);self._handleAttributes($header,child);$headers.append($header);$pages.append($page);return{$header:$header,$page:$page,node:child,};});_.each(renderedTabs,function(tab){self._registerModifiers(tab.node,self.state,tab.$header,{callback:function(element,modifiers){var $link=element.$el.find('.nav-link');if(modifiers.invisible&&$link.hasClass('active')){$link.removeClass('active');tab.$page.removeClass('active');self.inactiveNotebooks.push(renderedTabs);}
if(!modifiers.invisible){var $visibleTabs=$headers.find('li:not(.o_invisible_modifier)');if($visibleTabs.length===1){self.inactiveNotebooks.push(renderedTabs);}}
$headers.toggleClass('o_invisible_modifier',!$headers.find('li:not(.o_invisible_modifier)').length);},});});this._activateFirstVisibleTab(renderedTabs);var $notebookHeaders=$('<div class="o_notebook_headers">').append($headers);var $notebook=$('<div class="o_notebook">').append($notebookHeaders,$pages);$notebook[0].dataset.name=node.attrs.name||'_default_';this._registerModifiers(node,this.state,$notebook);this._handleAttributes($notebook,node);return $notebook;},_renderTagSeparator:function(node){var $separator=$('<div/>').addClass('o_horizontal_separator').text(node.attrs.string);this._handleAttributes($separator,node);this._registerModifiers(node,this.state,$separator);return $separator;},_renderTagSheet:function(node){this.has_sheet=true;var $sheet=$('<div>',{class:'clearfix position-relative o_form_sheet'});$sheet.append(node.children.map(this._renderNode.bind(this)));return $sheet;},_renderTagWidget:function(node){return this._renderWidget(this.state,node);},_renderView:function(){var self=this;var defs=[];this.defs=defs;this.inactiveNotebooks=[];var $form=this._renderNode(this.arch).addClass(this.className);delete this.defs;return Promise.all(defs).then(()=>this.__renderView()).then(function(){self._postProcessLabels();self._updateView($form.contents());if(self.state.res_id in self.alertFields){self.displayTranslationAlert();}}).then(function(){if(self.lastActivatedFieldIndex>=0){self._activateNextFieldWidget(self.state,self.lastActivatedFieldIndex);}}).guardedCatch(function(){$form.remove();});},async __renderView(){},async _updateAllModifiers(){await this._super(...arguments);for(const tabs of this.inactiveNotebooks){this._activateFirstVisibleTab(tabs);}
this.inactiveNotebooks=[];},_updateView:function($newContent){var self=this;this.$el.html($newContent);this.$el.toggleClass('o_form_nosheet',!this.has_sheet);if(this.has_sheet){this.$el.children().not('.o_FormRenderer_chatterContainer').wrapAll($('<div/>',{class:'o_form_sheet_bg','data-command-category':"app"}));}
this.$el.toggleClass('o_form_editable',this.mode==='edit');this.$el.toggleClass('o_form_readonly',this.mode==='readonly');_.each(this.allFieldWidgets[this.state.id],function(widget){const idForLabel=self.idsForLabels[widget[symbol]];var $label=idForLabel?self.$('.o_form_label[for='+idForLabel+']'):$();self._addFieldTooltip(widget,$label);if(widget.attrs.widget==='upgrade_boolean'){widget.renderWithLabel($label);}});},_setIDForLabel:function(widget,idForLabel){widget.setIDForLabel(idForLabel);},_onActivateNextWidget:function(ev){ev.stopPropagation();var index=this.allFieldWidgets[this.state.id].indexOf(ev.data.target);this._activateNextFieldWidget(this.state,index);},_onAnchorLinkClicked(ev){const anchor=ev.detail.element||null;if(!anchor){return;}
function _getNotebookParent(){const notebook=anchor.closest(".o_notebook");return notebook&&notebook.contains(anchor)?notebook:null;}
function _setNotebookPage(){const parentPane=anchor.closest(".tab-pane");if(notebook.contains(parentPane)&&!parentPane.classList.contains(".active")){const navLink=[...notebook.querySelectorAll(".nav-link")].filter((e)=>e.href.includes(parentPane.id));navLink[0].click();}}
const notebook=_getNotebookParent();if(notebook){_setNotebookPage();ev.preventDefault();ev.detail.originalEv.preventDefault();scrollUtils.scrollTo(ev.detail.element,{isAnchor:true});}},_onFieldLabelClicked:function(ev){const idForLabel=ev.currentTarget.getAttribute('for');const entry=Object.entries(this.idsForLabels).find(x=>x[1]===idForLabel);if(entry){this.trigger_up('quick_edit',{fieldName:this.fieldIdsToNames[entry[0]],target:ev.currentTarget,extraInfo:{},});}},_onNavigationMove:function(ev){ev.stopPropagation();if(ev.data.originalEvent&&['next','previous'].includes(ev.data.direction)){ev.data.originalEvent.preventDefault();ev.data.originalEvent.stopPropagation();}
var index;let target=ev.data.target||ev.target;if(target.__owl__){target=target.__owl__.parent;}
if(ev.data.direction==="next"){index=this.allFieldWidgets[this.state.id].indexOf(target);this._activateNextFieldWidget(this.state,index);}else if(ev.data.direction==="previous"){index=this.allFieldWidgets[this.state.id].indexOf(target);this._activatePreviousFieldWidget(this.state,index);}},_onNotebookTabChanged:function(){core.bus.trigger('DOM_updated');},_onQuickEdit:function(ev){if(this.mode!=='readonly'||this.quickEditExclusion.some(x=>ev.data.target.closest(x))){ev.stopPropagation();}},_onTranslate:function(ev){ev.preventDefault();this.trigger_up('translate',{fieldName:ev.target.name,id:this.state.id,isComingFromTranslationAlert:true,});},_onTranslateNotificationClose:function(ev){delete this.alertFields[this.state.res_id];},});return FormRenderer;});;

/* /web/static/src/legacy/js/views/form/form_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormView',function(require){"use strict";var BasicView=require('web.BasicView');var Context=require('web.Context');var core=require('web.core');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');const{generateID}=require('web.utils');var _lt=core._lt;var FormView=BasicView.extend({config:_.extend({},BasicView.prototype.config,{Renderer:FormRenderer,Controller:FormController,}),display_name:_lt('Form'),icon:'fa-edit',multi_record:false,withSearchBar:false,searchMenuTypes:[],viewType:'form',init:function(viewInfo,params){var hasActionMenus=params.hasActionMenus;this._super.apply(this,arguments);var mode=params.mode||(params.currentId?'readonly':'edit');this.loadParams.type='record';if(hasActionMenus===undefined){hasActionMenus=params.hasActionMenus;}
this.controllerParams.hasActionMenus=hasActionMenus;this.controllerParams.disableAutofocus=params.disable_autofocus||this.arch.attrs.disable_autofocus;this.controllerParams.toolbarActions=viewInfo.toolbar;this.controllerParams.footerToButtons=params.footerToButtons;var defaultButtons='default_buttons'in params?params.default_buttons:true;this.controllerParams.defaultButtons=defaultButtons;this.controllerParams.mode=mode;this.rendererParams.mode=mode;this.rendererParams.isFromFormViewDialog=params.isFromFormViewDialog;this.rendererParams.fieldIdsToNames=this.fieldsView.fieldIdsToNames;},getController:function(parent){return this._loadSubviews(parent).then(this._super.bind(this,parent));},_extractParamsFromAction:function(action){var params=this._super.apply(this,arguments);var inDialog=action.target==='new';var inline=action.target==='inline';var fullscreen=action.target==='fullscreen';params.withControlPanel=!(inDialog||inline);params.footerToButtons=inDialog;params.hasSearchView=inDialog?false:params.hasSearchView;params.hasActionMenus=!inDialog&&!inline;params.searchMenuTypes=inDialog?[]:params.searchMenuTypes;if(inDialog||inline||fullscreen){params.mode='edit';}else if(action.context&&action.context.form_view_initial_mode){params.mode=action.context.form_view_initial_mode;}
return params;},_loadSubviews:function(parent){var self=this;var defs=[];if(this.loadParams&&this.loadParams.fieldsInfo){var fields=this.loadParams.fields;_.each(this.loadParams.fieldsInfo.form,function(attrs,fieldName){var field=fields[fieldName];if(!field){return;}
if(field.type!=='one2many'&&field.type!=='many2many'){return;}
if(attrs.Widget.prototype.useSubview&&!attrs.__no_fetch&&!attrs.views[attrs.mode]){var context={};var regex=/'([a-z]*_view_ref)' *: *'(.*?)'/g;var matches;while(matches=regex.exec(attrs.context)){context[matches[1]]=matches[2];}
var refinedContext=_.pick(self.loadParams.context,function(value,key){return key.indexOf('_view_ref')===-1;});refinedContext.base_model_name=self.controllerParams.modelName;defs.push(parent.loadViews(field.relation,new Context(context,self.userContext,refinedContext).eval(),[[null,attrs.mode==='tree'?'list':attrs.mode]]).then(function(views){for(var viewName in views){attrs.views[viewName]=self._processFieldsView(views[viewName],viewName);attrs.views[viewName].fields=attrs.views[viewName].viewFields;self._processSubViewAttrs(attrs.views[viewName],attrs);}
self._setSubViewLimit(attrs);}));}else{self._setSubViewLimit(attrs);}});}
return Promise.all(defs);},_processArch(arch,fv){fv.fieldIdsToNames={};return this._super(...arguments);},_processNode(node,fv){if(node.tag==='field'){const name=node.attrs.name;let uid=node.attrs.id;if(!uid){uid=name in fv.fieldIdsToNames?`${name}__${generateID()}__`:name;node.attrs.id=uid;}
fv.fieldIdsToNames[uid]=name;}
return this._super(...arguments);},_setSubViewLimit:function(attrs){var view=attrs.views&&attrs.views[attrs.mode];var limit=view&&view.arch.attrs.limit&&parseInt(view.arch.attrs.limit,10);attrs.limit=limit||attrs.Widget.prototype.limit||40;},});return FormView;});;

/* /web/static/src/legacy/js/views/kanban/kanban_column.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanColumn',function(require){"use strict";var config=require('web.config');var core=require('web.core');var session=require('web.session');var Dialog=require('web.Dialog');var KanbanRecord=require('web.KanbanRecord');var RecordQuickCreate=require('web.kanban_record_quick_create');var view_dialogs=require('web.view_dialogs');var viewUtils=require('web.viewUtils');var Widget=require('web.Widget');var KanbanColumnProgressBar=require('web.KanbanColumnProgressBar');var _t=core._t;var QWeb=core.qweb;var KanbanColumn=Widget.extend({template:'KanbanView.Group',custom_events:{cancel_quick_create:'_onCancelQuickCreate',quick_create_add_record:'_onQuickCreateAddRecord',tweak_column:'_onTweakColumn',tweak_column_records:'_onTweakColumnRecords',},events:{'click .o_column_edit':'_onEditColumn','click .o_column_delete':'_onDeleteColumn','click .o_kanban_quick_add':'_onAddQuickCreate','click .o_kanban_load_more':'_onLoadMore','click .o_kanban_toggle_fold':'_onToggleFold','click .o_column_archive_records':'_onArchiveRecords','click .o_column_unarchive_records':'_onUnarchiveRecords','click .o_kanban_config .dropdown-menu':'_onConfigDropdownClicked',},init:function(parent,data,options,recordOptions){this._super(parent);this.db_id=data.id;this.data_records=data.data;this.data=data;var value=data.value;this.id=data.res_id;this.folded=!data.isOpen;this.has_active_field='active'in data.fields;this.fields=data.fields;this.records=[];this.modelName=data.model;this.quick_create=options.quick_create;this.quickCreateView=options.quickCreateView;this.groupedBy=options.groupedBy;this.grouped_by_m2o=options.grouped_by_m2o;this.grouped_by_m2m=options.grouped_by_m2m;this.editable=options.editable;this.deletable=options.deletable;this.archivable=options.archivable;this.draggable=options.draggable;this.KanbanRecord=options.KanbanRecord||KanbanRecord;this.records_editable=options.records_editable;this.records_deletable=options.records_deletable;this.recordsDraggable=options.recordsDraggable;this.relation=options.relation;this.offset=0;this.loadMoreCount=data.loadMoreCount;this.loadMoreOffset=data.loadMoreOffset;this.canBeFolded=this.folded;if(options.hasProgressBar){this.barOptions={columnID:this.db_id,progressBarStates:options.progressBarStates,};}
this.record_options=_.clone(recordOptions);if(options.grouped_by_m2o||options.grouped_by_date||options.grouped_by_m2m){this.title=value?value:_t('Undefined');}else{this.title=value===undefined?_t('Undefined'):value;}
if(options.group_by_tooltip){this.tooltipInfo=_.compact(_.map(options.group_by_tooltip,function(help,field){help=help?help+"</br>":'';return(data.tooltipData&&data.tooltipData[field]&&"<div>"+help+data.tooltipData[field]+"</div>")||'';}));this.tooltipInfo=this.tooltipInfo.join("<div class='dropdown-divider' role='separator' />");}},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];this.$header=this.$('.o_kanban_header');for(var i=0;i<this.data_records.length;i++){defs.push(this._addRecord(this.data_records[i]));}
if(this.recordsDraggable){this.$el.sortable({connectWith:'.o_kanban_group',containment:this.draggable?false:'parent',revert:0,delay:0,items:'> .o_kanban_record:not(.o_updating)',cursor:'move',over:function(){self.$el.addClass('o_kanban_hover');},out:function(){self.$el.removeClass('o_kanban_hover');},start:function(event,ui){ui.item.addClass('o_currently_dragged');},stop:function(event,ui){var item=ui.item;setTimeout(function(){item.removeClass('o_currently_dragged');});},update:function(event,ui){var record=ui.item.data('record');var index=self.records.indexOf(record);record.$el.removeAttr('style');if(index>=0){if($.contains(self.$el[0],record.$el[0])){self.trigger_up('kanban_column_resequence',{ids:self._getIDs()});}}else{ui.item.addClass('o_updating');self.trigger_up('kanban_column_add_record',{record:record,ids:self._getIDs()});}}});}
this.$el.click(function(event){if(self.folded){self._onToggleFold(event);}});if(this.barOptions){this.$el.addClass('o_kanban_has_progressbar');this.progressBar=new KanbanColumnProgressBar(this,this.barOptions,this.data);defs.push(this.progressBar.appendTo(this.$header));}
var title=this.folded?this.title+' ('+this.data.count+')':this.title;this.$header.find('.o_column_title').text(title);this.$el.toggleClass('o_column_folded',this.canBeFolded);if(this.tooltipInfo){this.$header.find('.o_kanban_header_title').tooltip({}).attr('data-original-title',this.tooltipInfo);}
if(!this.loadMoreCount){this.$('.o_kanban_load_more').remove();}else{this.$('.o_kanban_load_more').html(QWeb.render('KanbanView.LoadMore',{widget:this}));}
return Promise.all(defs);},on_attach_callback:function(){_.invoke(this.records,'on_attach_callback');if(this.quickCreateWidget){this.quickCreateWidget.on_attach_callback();}},addQuickCreate:async function(){if(this.folded){this.trigger_up('column_toggle_fold',{openQuickCreate:true,});return;}
if(this.quickCreateWidget){return Promise.reject();}
this.trigger_up('close_quick_create');var context=this.data.getContext();var groupByField=viewUtils.getGroupByField(this.groupedBy);context['default_'+groupByField]=viewUtils.getGroupValue(this.data,groupByField);this.quickCreateWidget=new RecordQuickCreate(this,{context:context,formViewRef:this.quickCreateView,model:this.modelName,});await this.quickCreateWidget.appendTo(document.createDocumentFragment());this.trigger_up('start_quick_create');this.quickCreateWidget.$el.insertAfter(this.$header);this.quickCreateWidget.on_attach_callback();},cancelQuickCreate:function(){if(this.quickCreateWidget){this.quickCreateWidget.cancel();}},isEmpty:function(){return!this.records.length;},_addRecord:function(recordState,options){if(this.grouped_by_m2m){this.record_options.deletable=false;}
var record=new this.KanbanRecord(this,recordState,this.record_options);this.records.push(record);if(options&&options.position==='before'){return record.insertAfter(this.quickCreateWidget?this.quickCreateWidget.$el:this.$header);}else{var $load_more=this.$('.o_kanban_load_more');if($load_more.length){return record.insertBefore($load_more);}else{return record.appendTo(this.$el);}}},_cancelQuickCreate:function(){this.quickCreateWidget.destroy();this.quickCreateWidget=undefined;},_getIDs:function(){var ids=[];this.$('.o_kanban_record').each(function(index,r){ids.push($(r).data('record').id);});return ids;},_onAddQuickCreate:function(){this.trigger_up('add_quick_create',{groupId:this.db_id});},_onCancelQuickCreate:function(){this._cancelQuickCreate();},_onConfigDropdownClicked(ev){ev.stopPropagation();},_onDeleteColumn:function(event){event.preventDefault();var buttons=[{text:_t("Ok"),classes:'btn-primary',close:true,click:this.trigger_up.bind(this,'kanban_column_delete'),},{text:_t("Cancel"),close:true}];new Dialog(this,{size:'medium',buttons:buttons,$content:$('<div>',{text:_t("Are you sure that you want to remove this column ?")}),}).open();},_onEditColumn:function(event){event.preventDefault();new view_dialogs.FormViewDialog(this,{res_model:this.relation,res_id:this.id,context:session.user_context,title:_t("Edit Column"),on_saved:this.trigger_up.bind(this,'reload'),}).open();},_onLoadMore:function(event){event.preventDefault();this.trigger_up('kanban_load_column_records',{loadMoreOffset:this.loadMoreOffset});},_onQuickCreateAddRecord:function(event){this.trigger_up('quick_create_record',event.data);},_onToggleFold:function(event){event.preventDefault();this.trigger_up('column_toggle_fold');},_onTweakColumn:function(ev){ev.data.callback(this.$el);},_onTweakColumnRecords:function(ev){_.each(this.records,function(record){ev.data.callback(record.$el,record.state.data);});},_onArchiveRecords:function(event){event.preventDefault();Dialog.confirm(this,_t("Are you sure that you want to archive all the records from this column?"),{confirm_callback:this.trigger_up.bind(this,'kanban_column_records_toggle_active',{archive:true,}),});},_onUnarchiveRecords:function(event){event.preventDefault();this.trigger_up('kanban_column_records_toggle_active',{archive:false,});}});return KanbanColumn;});;

/* /web/static/src/legacy/js/views/kanban/kanban_column_progressbar.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanColumnProgressBar',function(require){'use strict';const core=require('web.core');var session=require('web.session');var utils=require('web.utils');var Widget=require('web.Widget');const _t=core._t;var KanbanColumnProgressBar=Widget.extend({template:'KanbanView.ColumnProgressBar',events:{'click .progress-bar':'_onProgressBarClick',},ANIMATE:true,init:function(parent,options,columnState){this._super.apply(this,arguments);this.columnID=options.columnID;this.columnState=columnState;this.activeFilter={};this.fieldName=columnState.progressBarValues.field;this.colors=_.extend({},columnState.progressBarValues.colors,{__false:'muted',});this.sumField=columnState.progressBarValues.sum_field;this.sumFieldLabel=this.sumField?columnState.fields[this.sumField].string:false;var state=options.progressBarStates[this.columnID];if(state){this.groupCount=state.groupCount;this.subgroupCounts=state.subgroupCounts;this.totalCounterValue=state.totalCounterValue;this.activeFilter=columnState.activeFilter||state.activeFilter;}
var sumFieldInfo=this.sumField&&columnState.fieldsInfo.kanban[this.sumField];var currencyField=sumFieldInfo&&sumFieldInfo.options&&sumFieldInfo.options.currency_field;if(currencyField&&columnState.data.length){this.currency=session.currencies[columnState.data[0].data[currencyField].res_id];}},start:function(){var self=this;this.$bars={};_.each(this.colors,function(val,key){self.$bars[key]=self.$(`.progress-bar[data-filter=${key}]`);});this.$counter=this.$('.o_kanban_counter_side');this.$number=this.$counter.find('b');if(this.currency){var $currency=$('<span/>',{text:this.currency.symbol,});if(this.currency.position==='before'){$currency.prependTo(this.$counter);}else{$currency.appendTo(this.$counter);}}
return this._super.apply(this,arguments).then(function(){self.computeCounters();self._notifyState();self._render();});},computeCounters(){const subgroupCounts={};for(const key of Object.keys(this.colors)){const subgroupCount=this.columnState.progressBarValues.counts[key]||0;if(this.activeFilter.value===key&&subgroupCount===0){this.activeFilter={};}
subgroupCounts[key]=subgroupCount;}
this.groupCount=this.columnState.count;this.subgroupCounts=subgroupCounts;this.prevTotalCounterValue=this.totalCounterValue;this.totalCounterValue=this.sumField?(this.columnState.aggregateValues[this.sumField]||0):this.columnState.count;},_render:function(){var self=this;this.trigger_up('tweak_column',{callback:function($el){$el.removeClass('o_kanban_group_show');_.each(self.colors,function(val,key){$el.removeClass('o_kanban_group_show_'+val);});if(self.activeFilter.value){$el.addClass('o_kanban_group_show o_kanban_group_show_'+self.colors[self.activeFilter.value]);}},});this.trigger_up('tweak_column_records',{callback:function($el,recordData){var categoryValue=recordData[self.fieldName]?recordData[self.fieldName]:'__false';_.each(self.colors,function(val,key){$el.removeClass('oe_kanban_card_'+val);});if(self.colors[categoryValue]){$el.addClass('oe_kanban_card_'+self.colors[categoryValue]);}},});var barNumber=0;var barMinWidth=6;const selection=self.columnState.fields[self.fieldName].selection;_.each(self.colors,function(val,key){var $bar=self.$bars[key];var count=self.subgroupCounts&&self.subgroupCounts[key]||0;if(!$bar){return;}
let value;if(selection){const option=selection.find(option=>option[0]===key);value=option&&option[1]||_t('Other');}else{value=key;}
$bar.attr('data-original-title',count+' '+value);$bar.tooltip({delay:0,trigger:'hover',});$bar.toggleClass('progress-bar-animated progress-bar-striped',key===self.activeFilter.value);$bar.removeClass('o_bar_has_records transition-off');window.getComputedStyle($bar[0]).getPropertyValue('width');if(count>0){$bar.addClass('o_bar_has_records');var maxWidth=100-barMinWidth*barNumber;self.$('.progress-bar.o_bar_has_records').css('max-width',maxWidth+'%');$bar.css('width',(count*100/self.groupCount)+'%');barNumber++;$bar.attr('aria-valuemin',0);$bar.attr('aria-valuemax',self.groupCount);$bar.attr('aria-valuenow',count);}else{$bar.css('width','');}});this.$('.progress-bar').css('min-width','');this.$('.progress-bar.o_bar_has_records').css('min-width',barMinWidth+'%');var start=this.prevTotalCounterValue;var end=this.totalCounterValue;if(this.activeFilter.value){if(this.sumField){end=0;_.each(self.columnState.data,function(record){var recordData=record.data;if(self.activeFilter.value===recordData[self.fieldName]||(self.activeFilter.value==='__false'&&!recordData[self.fieldName])){end+=parseFloat(recordData[self.sumField]);}});}else{end=this.subgroupCounts[this.activeFilter.value];}}
this.prevTotalCounterValue=end;var animationClass=start>999?'o_kanban_grow':'o_kanban_grow_huge';if(start!==undefined&&(end>start||this.activeFilter.value)&&this.ANIMATE){$({currentValue:start}).animate({currentValue:end},{duration:1000,start:function(){self.$counter.addClass(animationClass);},step:function(){self.$number.html(_getCounterHTML(this.currentValue));},complete:function(){self.$number.html(_getCounterHTML(this.currentValue));self.$counter.removeClass(animationClass);},});}else{this.$number.html(_getCounterHTML(end));}
function _getCounterHTML(value){return utils.human_number(value,0,3);}},_notifyState:function(){this.trigger_up('set_progress_bar_state',{columnID:this.columnID,values:{groupCount:this.groupCount,subgroupCounts:this.subgroupCounts,totalCounterValue:this.totalCounterValue,activeFilter:this.activeFilter,},});},_toggleActiveFilter(value){const activeFilter=Object.assign({},this.activeFilter);if(activeFilter.value===value){activeFilter.domain=[];activeFilter.value=false;}else{const field=this.fieldName;if(value==='__false'){const values=Object.keys(this.colors).filter(el=>el!==value);activeFilter.domain=['!',[field,'in',values]];}else{activeFilter.domain=[[field,'=',value]];}
activeFilter.value=value;}
this.activeFilter=activeFilter;},_onProgressBarClick:function(ev){this.$clickedBar=$(ev.currentTarget);const filterValue=this.$clickedBar.data('filter');this._toggleActiveFilter(filterValue);this._notifyState();this.trigger_up('kanban_load_column_records',{activeFilter:this.activeFilter});},});return KanbanColumnProgressBar;});;

/* /web/static/src/legacy/js/views/kanban/kanban_column_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web.kanban_column_quick_create',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var ColumnQuickCreate=Widget.extend({template:'KanbanView.ColumnQuickCreate',events:{'click .o_quick_create_folded':'_onUnfold','click .o_kanban_add':'_onAddClicked','click .o_kanban_examples':'_onShowExamples','keydown':'_onKeydown','keypress input':'_onKeypress','blur input':'_onInputBlur','focus input':'_onInputFocus',},init:function(parent,options){this._super.apply(this,arguments);this.applyExamplesText=options.applyExamplesText||_t("Use This For My Kanban");this.examples=options.examples;this.folded=true;this.isMobile=false;this.isFirstColumn=options.isFirstColumn;},start:function(){this.$quickCreateFolded=this.$('.o_quick_create_folded');this.$quickCreateUnfolded=this.$('.o_quick_create_unfolded');this.$input=this.$('input');if(!this.isFirstColumn){core.bus.on('click',this,this._onWindowClicked);}
this._update();return this._super.apply(this,arguments);},on_attach_callback:function(){if(!this.folded){this.$input.focus();}},toggleFold:function(){this.folded=!this.folded;this._update();if(!this.folded){this.$input.focus();this.trigger_up('scrollTo',{selector:'.o_column_quick_create'});}},_add:function(){var value=this.$input.val().trim();if(!value.length){this._cancel();return;}
this.$input.val('');this.trigger_up('quick_create_add_column',{value:value});this.$input.focus();},_cancel:function(){if(!this.folded){this.$input.val('');this.folded=true;this._update();}},_update:function(){this.$quickCreateFolded.toggle(this.folded);this.$quickCreateUnfolded.toggle(!this.folded);this.trigger_up('quick_create_column_updated');},_onAddClicked:function(event){event.stopPropagation();this._add();},_onInputBlur:function(){this.$('.o_discard_msg').hide();},_onInputFocus:function(){this.$('.o_discard_msg').show();},_onKeydown:function(event){if(event.keyCode===$.ui.keyCode.ESCAPE){this._cancel();}},_onKeypress:function(event){if(event.keyCode===$.ui.keyCode.ENTER){this._add();}},_onShowExamples:function(){var self=this;var dialog=new Dialog(this,{$content:$(QWeb.render('KanbanView.ExamplesDialog',{examples:this.examples,})),buttons:[{classes:'btn-primary float-right',text:this.applyExamplesText,close:true,click:function(){const activeExample=self.examples[this.$('.nav-link.active').data("exampleIndex")];activeExample.columns.forEach(column=>{self.trigger_up('quick_create_add_column',{value:column.toString(),foldQuickCreate:true});});}},{classes:'btn-secondary float-right',close:true,text:_t('Close'),}],size:"large",title:_t("Kanban Examples"),}).open();dialog.on('closed',this,function(){self.$input.focus();});},_onUnfold:function(){if(this.folded){this.toggleFold();}},_onWindowClicked:function(event){if(!document.contains(this.el)){return;}
if($(event.target).closest('.modal').length){return;}
if(this.el.contains(event.target)){return;}
this._cancel();},});return ColumnQuickCreate;});;

/* /web/static/src/legacy/js/views/kanban/kanban_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanController',function(require){"use strict";var BasicController=require('web.BasicController');var Context=require('web.Context');var core=require('web.core');var Dialog=require('web.Dialog');var Domain=require('web.Domain');var view_dialogs=require('web.view_dialogs');var viewUtils=require('web.viewUtils');var _t=core._t;var qweb=core.qweb;var KanbanController=BasicController.extend({buttons_template:'KanbanView.buttons',custom_events:_.extend({},BasicController.prototype.custom_events,{add_quick_create:'_onAddQuickCreate',quick_create_add_column:'_onAddColumn',quick_create_record:'_onQuickCreateRecord',resequence_columns:'_onResequenceColumn',button_clicked:'_onButtonClicked',kanban_record_delete:'_onRecordDelete',kanban_record_update:'_onUpdateRecord',kanban_column_delete:'_onDeleteColumn',kanban_column_add_record:'_onAddRecordToColumn',kanban_column_resequence:'_onColumnResequence',kanban_load_column_records:'_onLoadColumnRecords',column_toggle_fold:'_onToggleColumn',kanban_column_records_toggle_active:'_onToggleActiveRecords',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.on_create=params.on_create;this.hasButtons=params.hasButtons;this.quickCreateEnabled=params.quickCreateEnabled;},renderButtons:function($node){if(!this.hasButtons||!this.is_action_enabled('create')){return;}
this.$buttons=$(qweb.render(this.buttons_template,{btnClass:'btn-primary',widget:this,}));this.$buttons.on('click','button.o-kanban-button-new',this._onButtonNew.bind(this));this.$buttons.on('keydown',this._onButtonsKeyDown.bind(this));if($node){this.$buttons.appendTo($node);}},updateButtons:function(){if(!this.$buttons){return;}
var state=this.model.get(this.handle,{raw:true});var createHidden=this.is_action_enabled('group_create')&&state.isGroupedByM2ONoColumn;this.$buttons.find('.o-kanban-button-new').toggleClass('o_hidden',createHidden);},_addQuickCreate(groupId){this._removeSampleData(async()=>{await this.update({shouldUpdateSearchComponents:false},{reload:false});return this.renderer.addQuickCreate(groupId);});},_confirmSave:function(id){var data=this.model.get(this.handle,{raw:true});var grouped=data.groupedBy.length;if(grouped){var columnState=this.model.getColumn(id);return this.renderer.updateColumn(columnState.id,columnState);}
return this.renderer.updateRecord(this.model.get(id));},_getPagingInfo:function(state){if(!(state.count&&!state.groupedBy.length)){return null;}
return this._super(...arguments);},_reloadAfterButtonClick:function(kanbanRecord,params){var self=this;var recordModel=this.model.localData[params.record.id];var group=this.model.localData[recordModel.parentID];var parent=this.model.localData[group.parentID];this.model.reload(params.record.id).then(function(db_id){var data=self.model.get(db_id);kanbanRecord.update(data);var domain=(parent?parent.domain:group.domain)||[];var domInData=_.every(domain,function(d){return d[0]in data.data;});var activeInDomain=_.pluck(domain,0).indexOf('active')!==-1;var activeInData='active'in data.data;if(domInData&&!activeInDomain&&activeInData){domain=domain.concat([['active','=',true]]);}else if(!domInData&&!activeInDomain&&activeInData){domain=[['active','=',true]];}
try{var visible=new Domain(domain).compute(data.evalContext);}catch(e){return;}
if(!visible){kanbanRecord.destroy();}});},_resequenceColumns:function(ids){var state=this.model.get(this.handle,{raw:true});var model=state.fields[state.groupedBy[0]].relation;return this.model.resequence(model,ids,this.handle);},_resequenceRecords:function(column_id,ids){var self=this;return this.model.resequence(this.modelName,ids,column_id);},_shouldBounceOnClick(element){const state=this.model.get(this.handle,{raw:true});if(!state.count||state.isSample){const classesList=['o_kanban_view','o_kanban_group','o_kanban_header','o_column_quick_create','o_view_nocontent_smiling_face',];return classesList.some(c=>element.classList.contains(c));}
return false;},_onAddColumn:function(ev){var self=this;this.mutex.exec(function(){return self.model.createGroup(ev.data.value,self.handle).then(function(){var state=self.model.get(self.handle,{raw:true});var ids=_.pluck(state.data,'res_id').filter(_.isNumber);return self._resequenceColumns(ids);}).then(function(){return self.update({},{reload:false});}).then(function(){let quickCreateFolded=self.renderer.quickCreate.folded;if(ev.data.foldQuickCreate?!quickCreateFolded:quickCreateFolded){self.renderer.quickCreateToggleFold();}
self.renderer.trigger_up("quick_create_column_created");});});},_onAddRecordToColumn:function(ev){var self=this;var record=ev.data.record;var column=ev.target;this.alive(this.model.moveRecord(record.db_id,column.db_id,this.handle)).then(function(column_db_ids){return self._resequenceRecords(column.db_id,ev.data.ids).then(function(){_.each(column_db_ids,function(db_id){var data=self.model.get(db_id);self.renderer.updateColumn(db_id,data);});});}).guardedCatch(this.reload.bind(this));},_onAddQuickCreate(ev){ev.stopPropagation();this._addQuickCreate(ev.data.groupId);},_onButtonClicked:function(ev){var self=this;ev.stopPropagation();var attrs=ev.data.attrs;var record=ev.data.record;var def=Promise.resolve();if(attrs.context){attrs.context=new Context(attrs.context).set_eval_context({active_id:record.res_id,active_ids:[record.res_id],active_model:record.model,});}
if(attrs.confirm){def=new Promise(function(resolve,reject){Dialog.confirm(this,attrs.confirm,{confirm_callback:resolve,cancel_callback:reject,}).on("closed",null,reject);});}
def.then(function(){self.trigger_up('execute_action',{action_data:attrs,env:{context:record.getContext(),currentID:record.res_id,model:record.model,resIDs:record.res_ids,},on_closed:self._reloadAfterButtonClick.bind(self,ev.target,ev.data),});});},_onButtonNew:function(){var state=this.model.get(this.handle,{raw:true});var quickCreateEnabled=this.quickCreateEnabled&&viewUtils.isQuickCreateEnabled(state);if(this.on_create==='quick_create'&&quickCreateEnabled&&state.data.length){this.mutex.getUnlockedDef().then(this._addQuickCreate.bind(this,null));}else if(this.on_create&&this.on_create!=='quick_create'){this.do_action(this.on_create,{on_close:this.reload.bind(this,{}),additional_context:state.context,});}else{this.trigger_up('switch_view',{view_type:'form',res_id:undefined});}},_onButtonsKeyDown:function(ev){switch(ev.keyCode){case $.ui.keyCode.DOWN:this._giveFocus();}},_onColumnResequence:function(ev){this._resequenceRecords(ev.target.db_id,ev.data.ids);},_onDeleteColumn:function(ev){var column=ev.target;var state=this.model.get(this.handle,{raw:true});var relatedModelName=state.fields[state.groupedBy[0]].relation;this.model.deleteRecords([column.db_id],relatedModelName).then(this.update.bind(this,{},{}));},async _onLoadColumnRecords(ev){const column=ev.target;const id=column.columnID||column.db_id;const options=ev.data;const dbID=await this.model.reload(id,options);const data=this.model.get(dbID);return this.renderer.updateColumn(dbID,data);},_onQuickCreateRecord:function(ev){var self=this;var values=ev.data.values;var column=ev.target;var onFailure=ev.data.onFailure||function(){};var update=function(db_id){var columnState=self.model.getColumn(db_id);var state=self.model.get(self.handle);return self.renderer.updateColumn(columnState.id,columnState,{openQuickCreate:true,state:state}).then(function(){if(ev.data.openRecord){self.trigger_up('open_record',{id:db_id,mode:'edit'});}});};this.model.createRecordInGroup(column.db_id,values).then(update).guardedCatch(function(reason){reason.event.preventDefault();var columnState=self.model.get(column.db_id,{raw:true});var context=columnState.getContext();var state=self.model.get(self.handle,{raw:true});var groupByField=viewUtils.getGroupByField(state.groupedBy[0]);context['default_'+groupByField]=viewUtils.getGroupValue(columnState,groupByField);new view_dialogs.FormViewDialog(self,{res_model:state.model,context:_.extend({default_name:values.name||values.display_name},context),title:_t("Create"),disable_multiple_selection:true,on_saved:function(record){self.model.addRecordToGroup(column.db_id,record.res_id).then(update);},}).open().opened(onFailure);});},_onRecordDelete:function(ev){this._deleteRecords([ev.data.id]);},_onResequenceColumn:function(ev){var self=this;this._resequenceColumns(ev.data.ids);},_onToggleColumn:function(ev){var self=this;const columnID=ev.target.db_id||ev.data.db_id;this.model.toggleGroup(columnID).then(function(db_id){var data=self.model.get(db_id);var options={openQuickCreate:!!ev.data.openQuickCreate,};return self.renderer.updateColumn(db_id,data,options);}).then(function(){if(ev.data.onSuccess){ev.data.onSuccess();}});},_onUpdateRecord:function(ev){var onSuccess=ev.data.onSuccess;delete ev.data.onSuccess;var changes=_.clone(ev.data);ev.data.force_save=true;this._applyChanges(ev.target.db_id,changes,ev).then(onSuccess);},_onToggleActiveRecords:function(ev){var self=this;var archive=ev.data.archive;var column=ev.target;var recordIds=_.pluck(column.records,'id');if(recordIds.length){var prom=archive?this.model.actionArchive(recordIds,column.db_id):this.model.actionUnarchive(recordIds,column.db_id);prom.then(function(dbID){let data=self.model.get(dbID);if(data){self.model.reload(self.handle).then(function(){data=self.model.get(dbID);const state=self.model.get(self.handle);self.renderer.updateColumn(dbID,data,{state});});}});}},});return KanbanController;});;

/* /web/static/src/legacy/js/views/kanban/kanban_examples_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.kanban_examples_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});;

/* /web/static/src/legacy/js/views/kanban/kanban_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var viewUtils=require('web.viewUtils');var KanbanModel=BasicModel.extend({addRecordToGroup:function(groupID,resId){var self=this;var group=this.localData[groupID];var new_record=this._makeDataPoint({res_id:resId,modelName:group.model,fields:group.fields,fieldsInfo:group.fieldsInfo,viewType:group.viewType,parentID:groupID,});var def=this._fetchRecord(new_record).then(function(result){group.data.unshift(new_record.id);group.res_ids.unshift(resId);group.count++;self.localData[group.parentID].count++;self._updateParentResIDs(group);return result.id;});return this._reloadProgressBarGroupFromRecord(new_record.id,def);},createGroup:function(name,parentID){var self=this;var parent=this.localData[parentID];var groupBy=parent.groupedBy[0];var groupByField=parent.fields[groupBy];if(!groupByField||groupByField.type!=='many2one'){return Promise.reject();}
return this._rpc({model:groupByField.relation,method:'name_create',args:[name],context:parent.context,}).then(function(result){const createGroupDataPoint=(model,parent)=>{const newGroup=model._makeDataPoint({modelName:parent.model,context:parent.context,domain:parent.domain.concat([[groupBy,"=",result[0]]]),fields:parent.fields,fieldsInfo:parent.fieldsInfo,isOpen:true,limit:parent.limit,parentID:parent.id,openGroupByDefault:true,orderedBy:parent.orderedBy,value:result,viewType:parent.viewType,});if(parent.progressBar){newGroup.progressBarValues=_.extend({counts:{},},parent.progressBar);}
return newGroup;};const newGroup=createGroupDataPoint(self,parent);parent.data.push(newGroup.id);if(self.isInSampleMode()){const sampleParent=self.sampleModel.localData[parentID];const newSampleGroup=createGroupDataPoint(self.sampleModel,sampleParent);sampleParent.data.push(newSampleGroup.id);}
return newGroup.id;});},createRecordInGroup:function(groupID,values){var self=this;var group=this.localData[groupID];var context=this._getContext(group);var parent=this.localData[group.parentID];var groupByField=viewUtils.getGroupByField(parent.groupedBy[0]);context['default_'+groupByField]=viewUtils.getGroupValue(group,groupByField);var def;if(Object.keys(values).length===1&&'display_name'in values){def=this._rpc({model:parent.model,method:'name_create',args:[values.display_name],context:context,}).then(function(records){return records[0];});}else{def=this._rpc({model:parent.model,method:'create',args:[values],context:context,});}
return def.then(function(resID){return self.addRecordToGroup(group.id,resID);});},__get:function(){var result=this._super.apply(this,arguments);var dp=result&&this.localData[result.id];if(dp){if(dp.tooltipData){result.tooltipData=$.extend(true,{},dp.tooltipData);}
if(dp.fields[dp.groupedBy[0]]){var groupedByM2O=dp.fields[dp.groupedBy[0]].type==='many2one';result.isGroupedByM2ONoColumn=!dp.data.length&&groupedByM2O;}else{result.isGroupedByM2ONoColumn=false;}
result.activeFilter=dp.activeFilter;let loadMoreCount=result.count-result.data.length;let loadMoreOffset=result.data.length;if(dp.progressBarValues){result.progressBarValues=$.extend(true,{},dp.progressBarValues);if(dp.activeFilter&&dp.activeFilter.value){const barValues=dp.progressBarValues;const barField=barValues.field;const definedBarFieldValues=Object.keys(barValues.colors);const filterValue=dp.activeFilter.value;const filteredRecordsTotal=barValues.counts[filterValue];const filteredRecords=result.data.filter(element=>{const elementBarFieldValue=element.data[barField];return(filterValue===elementBarFieldValue)||(filterValue==='__false'&&!definedBarFieldValues.includes(elementBarFieldValue));});loadMoreCount=filteredRecordsTotal-filteredRecords.length;loadMoreOffset=filteredRecords.length;}}
result.loadMoreCount=loadMoreCount;result.loadMoreOffset=loadMoreOffset;}
return result;},getColumn:function(id){var element=this.localData[id];if(element){return this.get(element.parentID);}
return null;},__load:function(params){this.defaultGroupedBy=params.groupBy||[];params.groupedBy=(params.groupedBy&&params.groupedBy.length)?params.groupedBy:this.defaultGroupedBy;return this._super(params);},moveRecord:function(recordID,groupID,parentID){var self=this;var parent=this.localData[parentID];var new_group=this.localData[groupID];var changes={};var groupedFieldName=viewUtils.getGroupByField(parent.groupedBy[0]);var groupedField=parent.fields[groupedFieldName];if(['date','datetime'].includes(groupedField.type)){changes[groupedFieldName]=viewUtils.getGroupValue(new_group,groupedFieldName);}else if(groupedField.type==='many2one'){changes[groupedFieldName]={id:new_group.res_id,display_name:new_group.value,};}else if(groupedField.type==='selection'){var value=_.findWhere(groupedField.selection,{1:new_group.value});changes[groupedFieldName]=value&&value[0]||false;}else{changes[groupedFieldName]=new_group.value;}
var record=self.localData[recordID];var resID=record.res_id;var old_group;for(var i=0;i<parent.data.length;i++){old_group=self.localData[parent.data[i]];var index=_.indexOf(old_group.data,recordID);if(index>=0){old_group.data.splice(index,1);old_group.count--;if(!old_group.activeFilter||old_group.activeFilter.value===record.data[parent.progressBar.field]){old_group.domainCount--;}
old_group.res_ids=_.without(old_group.res_ids,resID);self._updateParentResIDs(old_group);break;}}
new_group.data.push(recordID);new_group.res_ids.push(resID);new_group.count++;return this.notifyChanges(recordID,changes).then(function(){return self.save(recordID);}).then(function(){record.parentID=new_group.id;return[old_group.id,new_group.id];});},reload:function(id,options){const element=this.localData[id];if(element.parentID){element.limit=this.loadParams.limit;}
if(options&&options.activeFilter){element.activeFilter=options.activeFilter||element.activeFilter;delete options.activeFilter;}
if(options&&options.groupBy&&!options.groupBy.length){options.groupBy=this.defaultGroupedBy;}
return this._super(id,options);},__reload:function(id,options){var def=this._super(id,options);if(options&&options.loadMoreOffset){return def;}
return this._reloadProgressBarGroupFromRecord(id,def);},save:function(recordID){var def=this._super.apply(this,arguments);return this._reloadProgressBarGroupFromRecord(recordID,def);},_getGroupedListPropsToKeep(list,options){const propsToKeep=this._super(...arguments);if(list.activeFilter){propsToKeep.activeFilter=list.activeFilter;}
return propsToKeep;},_getUngroupedListDomain(list){const domainExtension=(list.activeFilter&&list.activeFilter.domain)||[];return[...this._super(...arguments),...domainExtension];},_makeDataPoint:function(params){var dataPoint=this._super.apply(this,arguments);if(params.progressBar){dataPoint.progressBar=params.progressBar;}
dataPoint.domainCount=dataPoint.count;return dataPoint;},_load:function(dataPoint,options){if(dataPoint.groupedBy.length&&dataPoint.progressBar){return this._readProgressBarGroup(dataPoint,options);}
return this._super.apply(this,arguments);},_readGroup:function(list){var self=this;if(list.groupedBy.length>1){list.groupedBy=[list.groupedBy[0]];}
return this._super.apply(this,arguments).then(function(result){return self._readTooltipFields(list).then(_.constant(result));});},async _readProgressBarGroup(list,options){const groupsDef=this._readGroup(list,options);const progressBarDef=this._readProgressBar(list);const[groups,progressBar]=await Promise.all([groupsDef,progressBarDef]);const groupProms=[];for(const groupId of list.data){const group=this.localData[groupId];if(group.activeFilter&&group.activeFilter.value&&!group.data.length){group.activeFilter={};groupProms.push(this._fetchUngroupedList(group));}}
await Promise.all(groupProms);for(const groupId of list.data){const group=this.localData[groupId];const valuesCount=progressBar[group.value]||{};const valuesCountTotal=Object.keys(valuesCount).reduce((sum,key)=>{return sum+valuesCount[key];},0);const counts=Object.assign({__false:group.domainCount-valuesCountTotal},valuesCount);group.progressBarValues=Object.assign({counts,},list.progressBar);}
return list;},_readProgressBar:function(list){return this._rpc({model:list.model,method:'read_progress_bar',kwargs:{domain:list.domain,group_by:list.groupedBy[0],progress_bar:list.progressBar,context:list.context,},});},_readTooltipFields:function(list){var self=this;var groupedByField=list.fields[list.groupedBy[0].split(':')[0]];if(groupedByField.type!=='many2one'){return Promise.resolve();}
var groupIds=_.reduce(list.data,function(groupIds,id){var res_id=self.get(id,{raw:true}).res_id;if(res_id){groupIds.push(res_id);}
return groupIds;},[]);var tooltipFields=[];var groupedByFieldInfo=list.fieldsInfo.kanban[list.groupedBy[0]];if(groupedByFieldInfo&&groupedByFieldInfo.options){tooltipFields=Object.keys(groupedByFieldInfo.options.group_by_tooltip||{});}
if(groupIds.length&&tooltipFields.length){var fieldNames=_.union(['display_name'],tooltipFields);return this._rpc({model:groupedByField.relation,method:'read',args:[groupIds,fieldNames],context:list.context,}).then(function(result){_.each(list.data,function(id){var dp=self.localData[id];dp.tooltipData=_.findWhere(result,{id:dp.res_id});});});}
return Promise.resolve();},async _reloadProgressBarGroupFromRecord(recordID,def){let element=this.localData[recordID];if(element.type==='list'){if(!element.parentID){return def;}
if(element.activeFilter){return def;}}
while(element){if(element.progressBar){const data=await def;await this._load(element,{keepEmptyGroups:true,onlyGroups:true,});return data;}
element=this.localData[element.parentID];}
return def;},});return KanbanModel;});;

/* /web/static/src/legacy/js/views/kanban/kanban_record.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanRecord',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Domain=require('web.Domain');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');const FieldWrapper=require('web.FieldWrapper');var utils=require('web.utils');var Widget=require('web.Widget');const{WidgetAdapterMixin}=require('web.OwlCompatibility');var widgetRegistry=require('web.widget_registry');const widgetRegistryOwl=require('web.widgetRegistry');const WidgetWrapper=require("web.WidgetWrapper");var _t=core._t;var QWeb=core.qweb;var KANBAN_RECORD_COLORS=require('web.basic_fields').FieldColorPicker.prototype.RECORD_COLORS;var NB_KANBAN_RECORD_COLORS=KANBAN_RECORD_COLORS.length;var KanbanRecord=Widget.extend(WidgetAdapterMixin,{events:{'click .oe_kanban_action':'_onKanbanActionClicked','click .o_kanban_manage_toggle_button':'_onManageTogglerClicked',},init:function(parent,state,options){this._super(parent);this.fields=state.fields;this.fieldsInfo=state.fieldsInfo.kanban;this.modelName=state.model;this.options=options;this.editable=options.editable;this.deletable=options.deletable;this.read_only_mode=options.read_only_mode;this.selectionMode=options.selectionMode;this.qweb=options.qweb;this.subWidgets={};this._setState(state);this._onKanbanActionClicked=_.debounce(this._onKanbanActionClicked,300,true);},start:function(){return Promise.all([this._super.apply(this,arguments),this._render()]);},destroy:function(){this._super(...arguments);WidgetAdapterMixin.destroy.call(this);},on_attach_callback:function(){this.isInDOM=true;_.invoke(this.subWidgets,'on_attach_callback');WidgetAdapterMixin.on_attach_callback.call(this);},on_detach_callback:function(){this.isInDOM=false;_.invoke(this.subWidgets,'on_detach_callback');WidgetAdapterMixin.on_detach_callback.call(this);},isHtmlEmpty:function(htmlContent){let div=document.createElement('div');div.innerHTML=htmlContent||"";return div.innerText.trim()==="";},update:function(state){_.invoke(_.pluck(this.subWidgets,'$el'),'detach');this._setState(state);return this._render();},_attachTooltip:function(){var self=this;this.$('[tooltip]').each(function(){var $el=$(this);var tooltip=$el.attr('tooltip');if(tooltip){$el.tooltip({title:self.qweb.render(tooltip,self.qweb_context)});}});},_computeDomain:function(d){return new Domain(d).compute(this.state.evalContext);},_getColorClassname:function(variable){var color=this._getColorID(variable);return'oe_kanban_color_'+color;},_getColorID:function(variable){if(typeof variable==='number'){return Math.round(variable)%NB_KANBAN_RECORD_COLORS;}
if(typeof variable==='string'){var index=0;for(var i=0;i<variable.length;i++){index+=variable.charCodeAt(i);}
return index%NB_KANBAN_RECORD_COLORS;}
return 0;},_getColorname:function(variable){var colorID=this._getColorID(variable);return KANBAN_RECORD_COLORS[colorID];},file_type_magic_word:{'/':'jpg','R':'gif','i':'png','P':'svg+xml',},_getImageURL:function(model,field,id,placeholder){id=(_.isArray(id)?id[0]:id)||null;var isCurrentRecord=this.modelName===model&&(this.recordData.id===id||(!this.recordData.id&&!id));var url;if(isCurrentRecord&&this.record[field]&&this.record[field].raw_value&&!utils.is_bin_size(this.record[field].raw_value)){url='data:image/'+this.file_type_magic_word[this.record[field].raw_value[0]]+';base64,'+this.record[field].raw_value;}else if(placeholder&&(!model||!field||!id||(isCurrentRecord&&this.record[field]&&!this.record[field].raw_value))){url=placeholder;}else{var session=this.getSession();var params={model:model,field:field,id:id};if(isCurrentRecord){params.unique=this.record.__last_update&&this.record.__last_update.value.replace(/[^0-9]/g,'');}
url=session.url('/web/image',params);}
return url;},_openRecord:function(){if(this.$el.hasClass('o_currently_dragged')){return;}
var editMode=this.$el.hasClass('oe_kanban_global_click_edit');this.trigger_up('open_record',{id:this.db_id,mode:editMode?'edit':'readonly',});},_processFields:function(){var self=this;this.$("field").each(function(){var $field=$(this);var field_name=$field.attr("name");var field_widget=$field.attr("widget");if(field_widget||self.fields[field_name].type==='many2many'){var widget=self.subWidgets[field_name];if(!widget){var Widget=self.fieldsInfo[field_name].Widget;if(Widget){widget=self._processWidget($field,field_name,Widget);self.subWidgets[field_name]=widget;}else if(config.isDebug()){$field.replaceWith($('<span>',{text:_.str.sprintf(_t('[No widget %s]'),field_widget),}));}}else{widget.reset(self.state);$field.replaceWith(widget.$el);if(self.isInDOM&&widget.on_attach_callback){widget.on_attach_callback();}}}else{self._processField($field,field_name);}});},_processField:function($field,field_name){var field=this.fields[field_name];var value=this.recordData[field_name];var options={data:this.recordData,forceString:true};var formatted_value=field_utils.format[field.type](value,field,options);var $result=$('<span>',{text:formatted_value,});$field.replaceWith($result);this._setFieldDisplay($result,field_name);return $result;},_processWidget:function($field,field_name,Widget){var self=this;var attrs=Object.create(null);_.each(this.fieldsInfo[field_name],function(value,key){if(_.str.startsWith(key,'t-att-')){key=key.slice(6);value=$field.attr(key);}
attrs[key]=value;});var options=_.extend({},this.options,{attrs:attrs});let widget;let def;if(utils.isComponent(Widget)){widget=new FieldWrapper(this,Widget,{fieldName:field_name,record:this.state,options:options,});def=widget.mount(document.createDocumentFragment()).then(()=>{$field.replaceWith(widget.$el);});}else{widget=new Widget(this,field_name,this.state,options);def=widget.replace($field);}
this.defs.push(def);def.then(function(){self._setFieldDisplay(widget.$el,field_name);});return widget;},_processWidgets:function(){var self=this;this.$("widget").each(function(){var $field=$(this);const attrs={};for(const attr of $field[0].attributes){attrs[attr.name]=attr.value;}
const options=Object.assign({},self.options,{attrs});const name=$field.attr('name');const Widget=widgetRegistryOwl.get(name)||widgetRegistry.get(name);const legacy=!(Widget.prototype instanceof owl.Component);let widget;if(legacy){widget=new Widget(self,self.state,options);}else{widget=new WidgetWrapper(this,Widget,{record:self.state,options});}
let def;if(legacy){def=widget._widgetRenderAndInsert(function(){});}else{def=widget.mount(document.createDocumentFragment());}
self.defs.push(def);def.then(function(){$field.replaceWith(widget.$el);widget.$el.addClass('o_widget');});});},_render:function(){this.defs=[];_.invoke(this.subWidgets,'on_detach_callback');this._replaceElement(this.qweb.render('kanban-box',this.qweb_context));this.$el.addClass('o_kanban_record').attr("tabindex",0);this.$el.attr('role','article');this.$el.data('record',this);if(this.selectionMode){this.$el.addClass('oe_kanban_global_click');}
if(this.$el.hasClass('oe_kanban_global_click')||this.$el.hasClass('oe_kanban_global_click_edit')){this.$el.on('click',this._onGlobalClick.bind(this));this.$el.on('keydown',this._onKeyDownCard.bind(this));}else{this.$el.on('keydown',this._onKeyDownOpenFirstLink.bind(this));}
this._processFields();this._processWidgets();this._setupColor();this._setupColorPicker();this._attachTooltip();this.$('span.o_tag').tooltip({delay:{'show':50}});return Promise.all(this.defs);},_setCoverImage:function(fieldName,autoOpen){var self=this;this._rpc({model:'ir.attachment',method:'search_read',domain:[['res_model','=',this.modelName],['res_id','=',this.id],['mimetype','ilike','image']],fields:['id','name'],}).then(function(attachmentIds){self.imageUploadID=_.uniqueId('o_cover_image_upload');self.accepted_file_extensions='image/*';self.attachment_count=attachmentIds.length;var coverId=self.record[fieldName]&&self.record[fieldName].raw_value;var $content=$(QWeb.render('KanbanView.SetCoverModal',{coverId:coverId,attachmentIds:attachmentIds,widget:self,}));var $imgs=$content.find('.o_kanban_cover_image');var dialog=new Dialog(self,{title:_t("Set a Cover Image"),$content:$content,buttons:[{text:_t("Select"),classes:attachmentIds.length?'btn-primary':'d-none',close:true,disabled:!coverId,click:function(){var $img=$imgs.filter('.o_selected').find('img');var data={};data[fieldName]={id:$img.data('id'),display_name:$img.data('name')};self.trigger_up('kanban_record_update',data);},},{text:_t('Upload and Set'),classes:attachmentIds.length?'':'btn-primary',close:false,click:function(){$content.find('input.o_input_file').click();},},{text:_t("Remove Cover Image"),classes:coverId?'':'d-none',close:true,click:function(){var data={};data[fieldName]=false;self.trigger_up('kanban_record_update',data);},},{text:_t("Discard"),close:true,}],});dialog.opened().then(function(){var $selectBtn=dialog.$footer.find('.btn-primary');if(autoOpen&&!self.attachment_count){$selectBtn.click();}
$content.on('click','.o_kanban_cover_image',function(ev){$imgs.not(ev.currentTarget).removeClass('o_selected');$selectBtn.prop('disabled',!$(ev.currentTarget).toggleClass('o_selected').hasClass('o_selected'));});$content.on('dblclick','.o_kanban_cover_image',function(ev){var $img=$(ev.currentTarget).find('img');var data={};data[fieldName]={id:$img.data('id'),display_name:$img.data('name')};self.trigger_up('kanban_record_update',data);dialog.close();});$content.on('change','input.o_input_file',function(){$content.find('form.o_form_binary_form').submit();});$(window).on(self.imageUploadID,function(){var images=Array.prototype.slice.call(arguments,1);var data={};data[fieldName]={id:images[0].id,display_name:images[0].filename};self.trigger_up('kanban_record_update',data);dialog.close();});});dialog.open();});},_setFieldDisplay:function($el,fieldName){if(this.fieldsInfo[fieldName].display==='right'){$el.addClass('float-right');}else if(this.fieldsInfo[fieldName].display==='full'){$el.addClass('o_text_block');}
if(this.fieldsInfo[fieldName].bold){$el.addClass('o_text_bold');}},_setState:function(recordState){this.state=recordState;this.id=recordState.res_id;this.db_id=recordState.id;this.recordData=recordState.data;this.record=this._transformRecord(recordState.data);this.qweb_context={context:this.state.getContext(),kanban_image:this._getImageURL.bind(this),kanban_color:this._getColorClassname.bind(this),kanban_getcolor:this._getColorID.bind(this),kanban_getcolorname:this._getColorname.bind(this),kanban_compute_domain:this._computeDomain.bind(this),selection_mode:this.selectionMode,read_only_mode:this.read_only_mode,record:this.record,user_context:this.getSession().user_context,widget:this,};},_setupColor:function(){var color_field=this.$el.attr('color');if(color_field&&color_field in this.fields){var colorHelp=_.str.sprintf(_t("Card color: %s"),this._getColorname(this.recordData[color_field]));var colorClass=this._getColorClassname(this.recordData[color_field]);this.$el.addClass(colorClass);this.$el.prepend('<span title="'+colorHelp+'" aria-label="'+colorHelp+'" role="img" class="oe_kanban_color_help"/>');}},_setupColorPicker:function(){var $colorpicker=this.$('ul.oe_kanban_colorpicker');if(!$colorpicker.length){return;}
$colorpicker.html(QWeb.render('KanbanColorPicker',{colors:KANBAN_RECORD_COLORS}));$colorpicker.on('click','a',this._onColorChanged.bind(this));},_transformRecord:function(recordData){const new_record=Object.create(null);for(const name of this.state.getFieldNames()){const value=recordData[name];const r=new_record[name]=_.clone(this.fields[name]||{});const formatter=r.type?field_utils.format[r.type]:_.identity;r.raw_value=value;r.value=formatter(value,this.fields[name],recordData,this.state);switch(r.type){case'date':case'datetime':r.raw_value=value&&value.toDate();break;case'one2many':case'many2many':r.raw_value=value.count?value.res_ids:[];break;case'many2one':r.raw_value=value&&value.res_id||false;break;case'html':r.value=utils.Markup(value);break;}}
return new_record;},_updateRecord:function(data){this.trigger_up('kanban_record_update',data);},_onColorChanged:function(event){event.preventDefault();var data={};var color_field=$(event.delegateTarget).data('field')||'color';data[color_field]=$(event.currentTarget).data('color');this.trigger_up('kanban_record_update',data);},_onGlobalClick:function(event){if($(event.target).parents('.o_dropdown_kanban').length){return;}
var trigger=true;var elem=event.target;var ischild=true;var children=[];while(elem){var events=$._data(elem,'events');if(elem===event.currentTarget){ischild=false;}
var test_event=events&&events.click&&(events.click.length>1||events.click[0].namespace!=='bs.tooltip');var testLinkWithHref=elem.nodeName.toLowerCase()==='a'&&elem.href;if(ischild){children.push(elem);if(test_event||testLinkWithHref){trigger=false;}}
if(trigger&&test_event){_.each(events.click,function(click_event){if(click_event.selector){_.each(children,function(child){if($(child).is(click_event.selector)){trigger=false;}});}});}
elem=elem.parentElement;}
if(trigger){this._openRecord();}},_onKanbanActionClicked:function(event){event.preventDefault();var $action=$(event.currentTarget);var type=$action.data('type')||'button';switch(type){case'edit':this.trigger_up('open_record',{id:this.db_id,mode:'edit'});break;case'open':this.trigger_up('open_record',{id:this.db_id});break;case'delete':this.trigger_up('kanban_record_delete',{id:this.db_id,record:this});break;case'action':case'object':var attrs=$action.data();attrs.confirm=$action.attr('confirm');this.trigger_up('button_clicked',{attrs:attrs,record:this.state,});break;case'set_cover':var fieldName=$action.data('field');var autoOpen=$action.data('auto-open');if(this.fields[fieldName].type==='many2one'&&this.fields[fieldName].relation==='ir.attachment'&&this.fieldsInfo[fieldName].widget==='attachment_image'){this._setCoverImage(fieldName,autoOpen);}else{var warning=_.str.sprintf(_t('Could not set the cover image: incorrect field ("%s") is provided in the view.'),fieldName);this.displayNotification({title:warning,type:'danger'});}
break;default:this.displayNotification({message:_t("Kanban: no action for type: ")+type,type:'danger'});}},_onKeyDownCard:function(event){switch(event.keyCode){case $.ui.keyCode.ENTER:if($(event.target).hasClass('oe_kanban_global_click')){event.preventDefault();this._onGlobalClick(event);break;}}},_onKeyDownOpenFirstLink:function(event){switch(event.keyCode){case $.ui.keyCode.ENTER:event.preventDefault();$(event.target).find('a, button').first().click();break;}},_onManageTogglerClicked:function(event){event.preventDefault();this.$el.parent().find('.o_kanban_record').not(this.$el).removeClass('o_dropdown_open');this.$el.toggleClass('o_dropdown_open');var colorClass=this._getColorClassname(this.recordData.color||0);this.$('.o_kanban_manage_button_section').toggleClass(colorClass);},});return KanbanRecord;});;

/* /web/static/src/legacy/js/views/kanban/kanban_record_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web.kanban_record_quick_create',function(require){"use strict";var core=require('web.core');var QuickCreateFormView=require('web.QuickCreateFormView');const session=require('web.session');var Widget=require('web.Widget');var RecordQuickCreate=Widget.extend({className:'o_kanban_quick_create',custom_events:{add:'_onAdd',cancel:'_onCancel',},events:{'click .o_kanban_add':'_onAddClicked','click .o_kanban_edit':'_onEditClicked','click .o_kanban_cancel':'_onCancelClicked','mousedown':'_onMouseDown',},mouseDownInside:false,init:function(parent,options){this._super.apply(this,arguments);this.context=options.context;this.formViewRef=options.formViewRef;this.model=options.model;this._disabled=false;},willStart:function(){var self=this;var superWillStart=this._super.apply(this,arguments);var viewsLoaded;if(this.formViewRef){var views=[[false,'form']];var context=_.extend({},this.context,{form_view_ref:this.formViewRef,});viewsLoaded=this.loadViews(this.model,context,views);}else{var fieldsView={};fieldsView.arch='<form>'+'<field name="display_name" placeholder="Title" modifiers=\'{"required": true}\'/>'+'</form>';var fields={display_name:{string:'Display name',type:'char'},};fieldsView.fields=fields;fieldsView.viewFields=fields;viewsLoaded=Promise.resolve({form:fieldsView});}
viewsLoaded=viewsLoaded.then(function(fieldsViews){var formView=new QuickCreateFormView(fieldsViews.form,{context:self.context,modelName:self.model,userContext:session.user_context,});return formView.getController(self).then(function(controller){self.controller=controller;return self.controller.appendTo(document.createDocumentFragment());});});return Promise.all([superWillStart,viewsLoaded]);},start:function(){this.$el.append(this.controller.$el);this.controller.renderButtons(this.$el);this.controller.autofocus();core.bus.on('click',this,this._onWindowClicked);return this._super.apply(this,arguments);},on_attach_callback:function(){if(this.controller){this.controller.autofocus();}},cancel:function(){var self=this;return this.controller.commitChanges().then(function(){if(!self.controller.isDirty()){self._cancel();}});},_add:function(options){var self=this;if(this._disabled){return;}
this._disableQuickCreate();this.controller.commitChanges().then(function(){var canBeSaved=self.controller.canBeSaved();if(canBeSaved){self.trigger_up('quick_create_add_record',{openRecord:options&&options.openRecord||false,values:self.controller.getChanges(),onFailure:self._enableQuickCreate.bind(self),});}else{self._enableQuickCreate();}}).guardedCatch(this._enableQuickCreate.bind(this));},_cancel:function(){this.trigger_up('cancel_quick_create');},_disableQuickCreate:function(){this._disabled=true;this.$el.addClass('o_disabled');this.$('input:not(:disabled)').addClass('o_temporarily_disabled').attr('disabled','disabled');},_enableQuickCreate:function(){this._disabled=false;this.$el.removeClass('o_disabled');this.$('input.o_temporarily_disabled').removeClass('o_temporarily_disabled').attr('disabled',false);},_onAdd:function(ev){ev.stopPropagation();this._add();},_onAddClicked:function(ev){ev.stopPropagation();this._add();},_onCancel:function(ev){ev.stopPropagation();this._cancel();},_onCancelClicked:function(ev){ev.stopPropagation();this._cancel();},_onEditClicked:function(ev){ev.stopPropagation();this._add({openRecord:true});},_onWindowClicked:function(ev){var mouseDownInside=this.mouseDownInside;this.mouseDownInside=false;if(!document.contains(this.el)){return;}
if($(ev.target).closest('.o-kanban-button-new, .o_kanban_quick_add').length){return;}
if($(ev.target).parents('.ui-autocomplete').length){return;}
if($(ev.target).closest('.modal').length){return;}
if($(document.body).hasClass('modal-open')){return;}
if(!document.contains(ev.target)){return;}
if(this.el.contains(ev.target)||this.el===ev.target||mouseDownInside){return;}
this.cancel();},_onMouseDown:function(ev){this.mouseDownInside=true;}});return RecordQuickCreate;});;

/* /web/static/src/legacy/js/views/kanban/kanban_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');var ColumnQuickCreate=require('web.kanban_column_quick_create');var config=require('web.config');var core=require('web.core');var KanbanColumn=require('web.KanbanColumn');var KanbanRecord=require('web.KanbanRecord');var QWeb=require('web.QWeb');var session=require('web.session');var utils=require('web.utils');var viewUtils=require('web.viewUtils');var qweb=core.qweb;var _t=core._t;function findInNode(node,predicate){if(predicate(node)){return node;}
if(!node.children){return undefined;}
for(var i=0;i<node.children.length;i++){if(findInNode(node.children[i],predicate)){return node.children[i];}}}
function qwebAddIf(node,condition){if(node.attrs[qweb.prefix+'-if']){condition=_.str.sprintf("(%s) and (%s)",node.attrs[qweb.prefix+'-if'],condition);}
node.attrs[qweb.prefix+'-if']=condition;}
function transformQwebTemplate(node,fields){if(node.tag&&node.attrs.modifiers){var modifiers=node.attrs.modifiers||{};if(modifiers.invisible){qwebAddIf(node,_.str.sprintf("!kanban_compute_domain(%s)",JSON.stringify(modifiers.invisible)));}}
switch(node.tag){case'button':case'a':var type=node.attrs.type||'';if(_.indexOf('action,object,edit,open,delete,url,set_cover'.split(','),type)!==-1){_.each(node.attrs,function(v,k){if(_.indexOf('icon,type,name,args,string,context,states,kanban_states'.split(','),k)!==-1){node.attrs['data-'+k]=v;delete(node.attrs[k]);}});if(node.attrs['data-string']){node.attrs.title=node.attrs['data-string'];}
if(node.tag==='a'&&node.attrs['data-type']!=="url"){node.attrs.href='#';}else{node.attrs.type='button';}
var action_classes=" oe_kanban_action oe_kanban_action_"+node.tag;if(node.attrs['t-attf-class']){node.attrs['t-attf-class']+=action_classes;}else if(node.attrs['t-att-class']){node.attrs['t-att-class']+=" + '"+action_classes+"'";}else{node.attrs['class']=(node.attrs['class']||'')+action_classes;}}
break;}
if(node.children){for(var i=0,ii=node.children.length;i<ii;i++){transformQwebTemplate(node.children[i],fields);}}}
var KanbanRenderer=BasicRenderer.extend({className:'o_kanban_view',config:{KanbanColumn:KanbanColumn,KanbanRecord:KanbanRecord,},custom_events:_.extend({},BasicRenderer.prototype.custom_events||{},{close_quick_create:'_onCloseQuickCreate',cancel_quick_create:'_onCancelQuickCreate',set_progress_bar_state:'_onSetProgressBarState',start_quick_create:'_onStartQuickCreate',quick_create_column_updated:'_onQuickCreateColumnUpdated',}),events:_.extend({},BasicRenderer.prototype.events||{},{'keydown .o_kanban_record':'_onRecordKeyDown'}),sampleDataTargets:['.o_kanban_counter','.o_kanban_record','.o_kanban_toggle_fold','.o_column_folded','.o_column_archive_records','.o_column_unarchive_records',],init:function(parent,state,params){this._super.apply(this,arguments);this.widgets=[];this.qweb=new QWeb(config.isDebug(),{_s:session.origin},false);var templates=findInNode(this.arch,function(n){return n.tag==='templates';});transformQwebTemplate(templates,state.fields);this.qweb.add_template(utils.json_node_to_xml(templates));this.examples=params.examples;this.recordOptions=_.extend({},params.record_options,{qweb:this.qweb,viewType:'kanban',});this.columnOptions=_.extend({KanbanRecord:this.config.KanbanRecord},params.column_options);if(this.columnOptions.hasProgressBar){this.columnOptions.progressBarStates={};}
this.quickCreateEnabled=params.quickCreateEnabled;if(!params.readOnlyMode){var handleField=_.findWhere(this.state.fieldsInfo.kanban,{widget:'handle'});this.handleField=handleField&&handleField.name;}
this._setState(state);},on_attach_callback:function(){this._super(...arguments);if(this.quickCreate){this.quickCreate.on_attach_callback();}},addQuickCreate:function(groupId){let kanbanColumn;if(groupId){kanbanColumn=this.widgets.find(column=>column.db_id===groupId);}
kanbanColumn=kanbanColumn||this.widgets[0];return kanbanColumn.addQuickCreate();},giveFocus:function(){this.$('.o_kanban_record:first').focus();},quickCreateToggleFold:function(){this.quickCreate.toggleFold();this._toggleNoContentHelper();},updateColumn:function(localID,columnState,options){var self=this;var KanbanColumn=this.config.KanbanColumn;var newColumn=new KanbanColumn(this,columnState,this.columnOptions,this.recordOptions);var index=_.findIndex(this.widgets,{db_id:localID});var column=this.widgets[index];this.widgets[index]=newColumn;if(options&&options.state){this._setState(options.state);}
return newColumn.appendTo(document.createDocumentFragment()).then(function(){var def;if(options&&options.openQuickCreate){def=newColumn.addQuickCreate();}
return Promise.resolve(def).then(function(){newColumn.$el.insertAfter(column.$el);self._toggleNoContentHelper();newColumn.on_attach_callback();column.destroy();});});},updateRecord:function(recordState){var isGrouped=!!this.state.groupedBy.length;var record;if(isGrouped){_.each(this.widgets,function(widget){record=record||_.findWhere(widget.records,{db_id:recordState.id,});});}else{record=_.findWhere(this.widgets,{db_id:recordState.id});}
if(record){return record.update(recordState);}
return Promise.resolve();},_focusOnNextCard:function(currentCardElement){var nextCard=currentCardElement.nextElementSibling;if(nextCard){nextCard.focus();}},_focusOnPreviousCard:function(currentCardElement){var previousCard=currentCardElement.previousElementSibling;if(previousCard&&previousCard.classList.contains("o_kanban_record")){previousCard.focus();return true;}},_getGhostColumns:function(){if(this.examples&&this.examples.ghostColumns){return this.examples.ghostColumns;}
return _.map(_.range(1,5),function(num){return _.str.sprintf(_t("Column %s"),num);});},_renderExampleBackground:function(fragment){var $background=$(qweb.render('KanbanView.ExamplesBackground',{ghostColumns:this._getGhostColumns()}));$background.appendTo(fragment);},_renderGhostDivs:function(fragment,nbDivs,options){var ghostDefs=[];for(var $ghost,i=0;i<nbDivs;i++){$ghost=$('<div>').addClass('o_kanban_record o_kanban_ghost');if(options&&options.inlineStyle){$ghost.attr('style',options.inlineStyle);}
var def=$ghost.appendTo(fragment);ghostDefs.push(def);}
return Promise.all(ghostDefs);},_renderGrouped:function(fragment){var self=this;var KanbanColumn=this.config.KanbanColumn;_.each(this.state.data,function(group){var column=new KanbanColumn(self,group,self.columnOptions,self.recordOptions);var def;if(!group.value){def=column.prependTo(fragment);self.widgets.unshift(column);}else{def=column.appendTo(fragment);self.widgets.push(column);}
self.defs.push(def);});if(this.$el.sortable('instance')!==undefined){this.$el.sortable('destroy');}
if(this.groupedByM2O){this.$el.sortable({axis:'x',items:'> .o_kanban_group',handle:'.o_column_title',cursor:'move',revert:150,delay:100,tolerance:'pointer',forcePlaceholderSize:true,stop:function(){var ids=[];self.$('.o_kanban_group').each(function(index,u){if(_.isNumber($(u).data('id'))){ids.push($(u).data('id'));}});self.trigger_up('resequence_columns',{ids:ids});},});if(this.createColumnEnabled){this.quickCreate=new ColumnQuickCreate(this,{applyExamplesText:this.examples&&this.examples.applyExamplesText,examples:this.examples&&this.examples.examples,isFirstColumn:!self.state.data.length,});this.defs.push(this.quickCreate.appendTo(fragment).then(function(){if(!self.state.data.length){self.quickCreate.toggleFold();self._renderExampleBackground(fragment);}}));}}},_renderUngrouped:function(fragment){var self=this;var KanbanRecord=this.config.KanbanRecord;var kanbanRecord;_.each(this.state.data,function(record){kanbanRecord=new KanbanRecord(self,record,self.recordOptions);self.widgets.push(kanbanRecord);var def=kanbanRecord.appendTo(fragment);self.defs.push(def);});var orderedBy=this.state.orderedBy;var hasHandle=this.handleField&&(orderedBy.length===0||orderedBy[0].name===this.handleField);if(hasHandle){this.$el.sortable({items:'.o_kanban_record:not(.o_kanban_ghost)',cursor:'move',revert:0,delay:0,tolerance:'pointer',forcePlaceholderSize:true,stop:function(event,ui){self._moveRecord(ui.item.data('record').db_id,ui.item.index());},});}
var prom=Promise.all(self.defs).then(function(){var options={};if(kanbanRecord){options.inlineStyle=kanbanRecord.$el.attr('style');}
return self._renderGhostDivs(fragment,6,options);});this.defs.push(prom);},_renderView:function(){var self=this;var isGrouped=!!this.state.groupedBy.length;var fragment=document.createDocumentFragment();var defs=[];this.defs=defs;if(isGrouped){this._renderGrouped(fragment);}else{this._renderUngrouped(fragment);}
delete this.defs;return this._super.apply(this,arguments).then(function(){return Promise.all(defs).then(function(){self.$el.empty();self.$el.toggleClass('o_kanban_grouped',isGrouped);self.$el.toggleClass('o_kanban_ungrouped',!isGrouped);self.$el.append(fragment);self._toggleNoContentHelper();});});},_toggleNoContentHelper:function(remove){var displayNoContentHelper=!remove&&!this._hasContent()&&!!this.noContentHelp&&!(this.quickCreate&&!this.quickCreate.folded)&&!this.state.isGroupedByM2ONoColumn;var $noContentHelper=this.$('.o_view_nocontent');if(displayNoContentHelper&&!$noContentHelper.length){this._renderNoContentHelper();}
if(!displayNoContentHelper&&$noContentHelper.length){$noContentHelper.remove();}},_setState(){this._super(...arguments);const groupedBy=this.state.groupedBy[0];const groupByFieldName=viewUtils.getGroupByField(groupedBy);const field=this.state.fields[groupByFieldName]||{};const fieldInfo=this.state.fieldsInfo.kanban[groupByFieldName]||{};const group_by_tooltip=fieldInfo.options&&fieldInfo.options.group_by_tooltip;const grouped_by_date=["date","datetime"].includes(field.type);const grouped_by_m2m=field.type==="many2many";const grouped_by_m2o=field.type==="many2one";const readonly=!!field.readonly||!!fieldInfo.readonly;const relation=(grouped_by_m2o||grouped_by_m2m)&&field.relation;const quick_create=this.quickCreateEnabled&&viewUtils.isQuickCreateEnabled(this.state);const draggable=!readonly&&!grouped_by_m2m&&(!grouped_by_date||fieldInfo.allowGroupRangeValue);Object.assign(this.columnOptions,{draggable,groupedBy,grouped_by_date,grouped_by_m2o,grouped_by_m2m,group_by_tooltip,quick_create,relation,});this.createColumnEnabled=grouped_by_m2o&&this.columnOptions.group_creatable;this.groupedByM2O=grouped_by_m2o;},_focusOnCardInColumn:function(eventTarget,direction){var currentColumn=eventTarget.parentElement;var hasSelectedACard=false;var cannotSelectAColumn=false;while(!hasSelectedACard&&!cannotSelectAColumn){var candidateColumn=direction==='LEFT'?currentColumn.previousElementSibling:currentColumn.nextElementSibling;currentColumn=candidateColumn;if(candidateColumn){var allCardsOfCandidateColumn=candidateColumn.getElementsByClassName('o_kanban_record');if(allCardsOfCandidateColumn.length){allCardsOfCandidateColumn[0].focus();hasSelectedACard=true;}}
else{direction==='LEFT'?this._focusOnPreviousCard(eventTarget):this._focusOnNextCard(eventTarget);cannotSelectAColumn=true;}}},_onCancelQuickCreate:function(){this._toggleNoContentHelper();},_onCloseQuickCreate:function(){if(this.state.groupedBy.length){_.invoke(this.widgets,'cancelQuickCreate');}
this._toggleNoContentHelper();},_onQuickCreateColumnUpdated:function(ev){ev.stopPropagation();this._toggleNoContentHelper();this._updateExampleBackground();},_onRecordKeyDown:function(e){switch(e.which){case $.ui.keyCode.DOWN:this._focusOnNextCard(e.currentTarget);e.stopPropagation();e.preventDefault();break;case $.ui.keyCode.UP:const previousFocused=this._focusOnPreviousCard(e.currentTarget);if(!previousFocused){this.trigger_up('navigation_move',{direction:'up'});}
e.stopPropagation();e.preventDefault();break;case $.ui.keyCode.RIGHT:this._focusOnCardInColumn(e.currentTarget,'RIGHT');e.stopPropagation();e.preventDefault();break;case $.ui.keyCode.LEFT:this._focusOnCardInColumn(e.currentTarget,'LEFT');e.stopPropagation();e.preventDefault();break;}},_onSetProgressBarState:function(ev){if(!this.columnOptions.progressBarStates[ev.data.columnID]){this.columnOptions.progressBarStates[ev.data.columnID]={};}
_.extend(this.columnOptions.progressBarStates[ev.data.columnID],ev.data.values);},_onStartQuickCreate:function(){this._toggleNoContentHelper(true);},_updateExampleBackground:function(){var $elem=this.$('.o_kanban_example_background_container');if(!this.state.data.length&&!$elem.length){this._renderExampleBackground(this.$el);}else{$elem.remove();}},});return KanbanRenderer;});;

/* /web/static/src/legacy/js/views/kanban/kanban_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanView',function(require){"use strict";var BasicView=require('web.BasicView');var core=require('web.core');var KanbanController=require('web.KanbanController');var kanbanExamplesRegistry=require('web.kanban_examples_registry');var KanbanModel=require('web.KanbanModel');var KanbanRenderer=require('web.KanbanRenderer');var utils=require('web.utils');var _lt=core._lt;var KanbanView=BasicView.extend({accesskey:"k",display_name:_lt("Kanban"),icon:'fa-th-large',mobile_friendly:true,config:_.extend({},BasicView.prototype.config,{Model:KanbanModel,Controller:KanbanController,Renderer:KanbanRenderer,}),jsLibs:[],viewType:'kanban',init:function(viewInfo,params){this._super.apply(this,arguments);this.loadParams.limit=this.loadParams.limit||40;this.loadParams.openGroupByDefault=true;this.loadParams.type='list';this.noDefaultGroupby=params.noDefaultGroupby;var progressBar;utils.traverse(this.arch,function(n){var isProgressBar=(n.tag==='progressbar');if(isProgressBar){progressBar=_.clone(n.attrs);progressBar.colors=JSON.parse(progressBar.colors);progressBar.sum_field=progressBar.sum_field||false;}
return!isProgressBar;});if(progressBar){this.loadParams.progressBar=progressBar;}
var activeActions=this.controllerParams.activeActions;var archAttrs=this.arch.attrs;activeActions=_.extend(activeActions,{group_create:this.arch.attrs.group_create?!!JSON.parse(archAttrs.group_create):true,group_edit:archAttrs.group_edit?!!JSON.parse(archAttrs.group_edit):true,group_delete:archAttrs.group_delete?!!JSON.parse(archAttrs.group_delete):true,});this.rendererParams.column_options={editable:activeActions.group_edit,deletable:activeActions.group_delete,archivable:archAttrs.archivable?!!JSON.parse(archAttrs.archivable):true,group_creatable:activeActions.group_create,quickCreateView:archAttrs.quick_create_view||null,recordsDraggable:archAttrs.records_draggable?!!JSON.parse(archAttrs.records_draggable):true,hasProgressBar:!!progressBar,};this.rendererParams.record_options={editable:activeActions.edit,deletable:activeActions.delete,read_only_mode:params.readOnlyMode,selectionMode:params.selectionMode,};this.rendererParams.quickCreateEnabled=this._isQuickCreateEnabled();this.rendererParams.readOnlyMode=params.readOnlyMode;var examples=archAttrs.examples;if(examples){this.rendererParams.examples=kanbanExamplesRegistry.get(examples);}
this.controllerParams.on_create=archAttrs.on_create;this.controllerParams.hasButtons=!params.selectionMode?true:false;this.controllerParams.quickCreateEnabled=this.rendererParams.quickCreateEnabled;},_isQuickCreateEnabled:function(){if(!this.controllerParams.activeActions.create){return false;}
if(this.arch.attrs.quick_create!==undefined){return!!JSON.parse(this.arch.attrs.quick_create);}
return true;},_processField(viewType,field,attrs){if(['date','datetime'].includes(field.type)&&'allow_group_range_value'in attrs){attrs.allowGroupRangeValue=!!JSON.parse(attrs.allow_group_range_value);delete attrs.allow_group_range_value;}
return this._super(...arguments);},_processNode(node,fv){const isKanbanImage=node.tag==='img'&&node.attrs['t-att-src']&&node.attrs['t-att-src'].includes('kanban_image');if(isKanbanImage&&!fv.fieldsInfo.kanban.__last_update){fv.fieldsInfo.kanban.__last_update={type:'datetime'};}
return this._super(...arguments);},_updateMVCParams:function(){this._super.apply(this,arguments);if(this.searchMenuTypes.includes('groupBy')&&!this.noDefaultGroupby&&this.arch.attrs.default_group_by){this.loadParams.groupBy=[this.arch.attrs.default_group_by];}},});return KanbanView;});;

/* /web/static/src/legacy/js/views/kanban/quick_create_form_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.QuickCreateFormView',function(require){"use strict";var BasicModel=require('web.BasicModel');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var FormView=require('web.FormView');const{qweb}=require("web.core");var QuickCreateFormRenderer=FormRenderer.extend({start:async function(){await this._super.apply(this,arguments);this.$el.addClass('o_xxs_form_view');this.$el.removeClass('o_xxl_form_view');},_applyFormSizeClass(){},_onNavigationMove:function(ev){var direction=ev.data.direction;if(direction==='cancel'||direction==='next_line'){ev.stopPropagation();this.trigger_up(direction==='cancel'?'cancel':'add');}else{this._super.apply(this,arguments);}},});var QuickCreateFormModel=BasicModel.extend({getChanges:function(localID){var record=this.localData[localID];return this._generateChanges(record,{changesOnly:false});},});var QuickCreateFormController=FormController.extend({commitChanges:function(){var mutexDef=this.mutex.getUnlockedDef();return Promise.all([mutexDef,this.renderer.commitChanges(this.handle)]);},getChanges:function(){return this.model.getChanges(this.handle);},renderButtons($node){this.$buttons=$(qweb.render('KanbanView.RecordQuickCreate.buttons'));if($node){this.$buttons.appendTo($node);}},updateButtons(){},});var QuickCreateFormView=FormView.extend({withControlPanel:false,config:_.extend({},FormView.prototype.config,{Model:QuickCreateFormModel,Renderer:QuickCreateFormRenderer,Controller:QuickCreateFormController,}),});return QuickCreateFormView;});;

/* /web/static/src/legacy/js/views/list/list_confirm_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/list/list_confirm_dialog',async function(require){'use strict';let __exports={};const core=require('web.core');const Dialog=require('web.Dialog');const FieldWrapper=require('web.FieldWrapper');const{WidgetAdapterMixin}=require('web.OwlCompatibility');const utils=require('web.utils');const _t=core._t;const qweb=core.qweb;const ListConfirmDialog=Dialog.extend(WidgetAdapterMixin,{init:function(parent,record,params,options){options=Object.assign({},options,{$content:$(qweb.render('ListView.confirmModal',params)),buttons:options.buttons||[{text:_t("Ok"),classes:'btn-primary',close:true,click:options.confirm_callback,},{text:_t("Cancel"),close:true,click:options.cancel_callback,}],onForceClose:options.cancel_callback,size:options.size||'medium',title:options.title||_t("Confirmation"),});this._super(parent,options);this.fieldWidgets=params.fields.map(({name})=>{const Widget=record.fieldsInfo.list[name].Widget;const widgetOptions={mode:'readonly',viewType:'list',noOpen:true,};if(!utils.isComponent(Widget)){return{isLegacyWidget:true,fieldWidget:new Widget(this,name,record,widgetOptions),};}else{return{isLegacyWidget:false,fieldWidget:new FieldWrapper(this,Widget,{fieldName:name,record,options:widgetOptions,}),};}});},willStart:function(){const proms=this.fieldWidgets.map(({isLegacyWidget,fieldWidget})=>{if(isLegacyWidget){return fieldWidget._widgetRenderAndInsert(function(){});}else{return fieldWidget.mount(document.createDocumentFragment());}});proms.push(this._super.apply(this,arguments));return Promise.all(proms);},start:function(){this.fieldWidgets.forEach(({fieldWidget})=>{this.$content.find(`.o_changes_widget[data-name=${fieldWidget.name}]`).replaceWith(fieldWidget.$el);fieldWidget.el.style.pointerEvents='none';});return this._super.apply(this,arguments);},destroy:function(){WidgetAdapterMixin.destroy.call(this);this._super();},});__exports[Symbol.for("default")]=ListConfirmDialog;return __exports;});odoo.define(`web.ListConfirmDialog`,async function(require){return require('@web/legacy/js/views/list/list_confirm_dialog')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/list/list_controller.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/list/list_controller',async function(require){'use strict';let __exports={};const config=require('web.config');const core=require('web.core');const BasicController=require('web.BasicController');const DataExport=require('web.DataExport');const Dialog=require('web.Dialog');const ListConfirmDialog=require('web.ListConfirmDialog');const session=require('web.session');const viewUtils=require('web.viewUtils');var _t=core._t;var qweb=core.qweb;var ListController=BasicController.extend({buttons_template:'ListView.buttons',events:_.extend({},BasicController.prototype.events,{'click .o_list_export_xlsx':'_onDirectExportData','click .o_list_select_domain':'_onSelectDomain',}),custom_events:_.extend({},BasicController.prototype.custom_events,{activate_next_widget:'_onActivateNextWidget',add_record:'_onAddRecord',button_clicked:'_onButtonClicked',group_edit_button_clicked:'_onEditGroupClicked',edit_line:'_onEditLine',save_line:'_onSaveLine',selection_changed:'_onSelectionChanged',toggle_column_order:'_onToggleColumnOrder',toggle_group:'_onToggleGroup',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.hasActionMenus=params.hasActionMenus;this.headerButtons=params.headerButtons||[];this.toolbarActions=params.toolbarActions||{};this.editable=params.editable;this.noLeaf=params.noLeaf;this.selectedRecords=params.selectedRecords||[];this.multipleRecordsSavingPromise=null;this.fieldChangedPrevented=false;this.isPageSelected=false;this.isDomainSelected=false;this.isExportEnable=false;},willStart(){const sup=this._super(...arguments);const acl=session.user_has_group('base.group_allow_export').then(hasGroup=>{this.isExportEnable=hasGroup;});return Promise.all([sup,acl]);},canBeRemoved:async function(){const _super=this._super.bind(this);await this.renderer.unselectRow({canDiscard:true});return _super(...arguments);},getOwnedQueryParams:function(){var state=this._super.apply(this,arguments);var orderedBy=this.model.get(this.handle,{raw:true}).orderedBy||[];return _.extend({},state,{orderedBy:orderedBy});},getSelectedIds:function(){return _.map(this.getSelectedRecords(),function(record){return record.res_id;});},getSelectedIdsWithDomain:async function(){if(this.isDomainSelected){const state=this.model.get(this.handle,{raw:true});return await this._domainToResIds(state.getDomain(),session.active_ids_limit);}else{return Promise.resolve(this.model.localIdsToResIds(this.selectedRecords));}},getSelectedRecords:function(){var self=this;return _.map(this.selectedRecords,function(db_id){return self.model.get(db_id,{raw:true});});},renderButtons:function($node){if(this.noLeaf||!this.hasButtons){this.hasButtons=false;this.$buttons=$('<div>');}else{this.$buttons=$(qweb.render(this.buttons_template,{widget:this}));this.$buttons.on('click','.o_list_button_add',this._onCreateRecord.bind(this));this._assignCreateKeyboardBehavior(this.$buttons.find('.o_list_button_add'));this.$buttons.find('.o_list_button_add').tooltip({delay:{show:200,hide:0},title:function(){return qweb.render('CreateButton.tooltip');},trigger:'manual',});this.$buttons.on('mousedown','.o_list_button_discard',this._onDiscardMousedown.bind(this));this.$buttons.on('click','.o_list_button_discard',this._onDiscard.bind(this));}
if($node){this.$buttons.appendTo($node);}},_renderHeaderButtons(){if(this.$headerButtons){this.$headerButtons.remove();this.$headerButtons=null;}
if(!this.headerButtons.length||!this.selectedRecords.length){return;}
const btnClasses='btn-primary btn-secondary btn-link btn-success btn-info btn-warning btn-danger'.split(' ');let $elms=$();this.headerButtons.forEach(node=>{const $btn=viewUtils.renderButtonFromNode(node);$btn.addClass('btn');if(!btnClasses.some(cls=>$btn.hasClass(cls))){$btn.addClass('btn-secondary');}
$btn.on("click",this._onHeaderButtonClicked.bind(this,node));$elms=$elms.add($btn);});this.$headerButtons=$elms;this.$headerButtons.appendTo(this.$buttons);},update:function(params,options){var self=this;let res_ids;if(options&&options.keepSelection){res_ids=this.model.get(this.handle).res_ids;this.selectedRecords=_.filter(this.selectedRecords,function(id){return _.contains(res_ids,self.model.get(id).res_id);});}else{this.selectedRecords=[];}
if(this.selectedRecords.length===0||this.selectedRecords.length<res_ids.length){this.isDomainSelected=false;this.isPageSelected=false;}
params.selectedRecords=this.selectedRecords;return this._super.apply(this,arguments);},updateButtons:function(mode){if(this.hasButtons){this.$buttons.toggleClass('o-editing',mode==='edit');const state=this.model.get(this.handle,{raw:true});if(state.count){this.$buttons.find('.o_list_export_xlsx').show();}else{this.$buttons.find('.o_list_export_xlsx').hide();}}
this._updateSelectionBox();},_abandonRecord:function(recordID){this._super.apply(this,arguments);if((recordID||this.handle)!==this.handle){var state=this.model.get(this.handle);this.renderer.removeLine(state,recordID);this._updatePaging(state);}},_addRecord:function(dataPointId){var self=this;this._disableButtons();return this._removeSampleData(()=>{return this.renderer.unselectRow().then(function(){return self.model.addDefaultRecord(dataPointId,{position:self.editable,});}).then(function(recordID){var state=self.model.get(self.handle);self._updateRendererState(state,{keepWidths:true}).then(function(){self.renderer.editRecord(recordID);}).then(()=>{self._updatePaging(state);});}).then(this._enableButtons.bind(this)).guardedCatch(this._enableButtons.bind(this));});},_assignCreateKeyboardBehavior:function($createButton){var self=this;$createButton.on('keydown',function(e){$createButton.tooltip('hide');switch(e.which){case $.ui.keyCode.ENTER:e.preventDefault();self._onCreateRecord.apply(self);break;case $.ui.keyCode.DOWN:e.preventDefault();self._giveFocus();break;case $.ui.keyCode.TAB:if(!e.shiftKey&&e.target.classList.contains("btn-primary")&&!self.model.isInSampleMode()){e.preventDefault();$createButton.tooltip('show');}
break;}});},_confirmSave(id,options={}){const state=this.model.get(this.handle);return this._updateRendererState(state,{noRender:!state.isM2MGrouped,...options}).then(this._setMode.bind(this,"readonly",id));},_deleteRecordsInCurrentDomain:function(){const doIt=async()=>{const state=this.model.get(this.handle,{raw:true});const resIds=await this._domainToResIds(state.getDomain(),session.active_ids_limit);await this._rpc({model:this.modelName,method:'unlink',args:[resIds],context:state.getContext(),});if(resIds.length===session.active_ids_limit){const msg=_.str.sprintf(_t("Only the first %d records have been deleted (out of %d selected)"),resIds.length,state.count);this.displayNotification({message:msg});}
this.reload();};if(this.confirmOnDelete){Dialog.confirm(this,_t("Are you sure you want to delete these records ?"),{confirm_callback:doIt,});}else{doIt();}},_discardChanges:function(recordID){if((recordID||this.handle)===this.handle){recordID=this.renderer.getEditableRecordID();if(recordID===null){return Promise.resolve();}}
var self=this;return this._super(recordID).then(function(){self.updateButtons('readonly');});},_domainToResIds:function(domain,limit){return this._rpc({model:this.modelName,method:'search',args:[domain],kwargs:{limit:limit,},});},_getExportDialogWidget(){let state=this.model.get(this.handle);let defaultExportFields=this.renderer.columns.filter(field=>field.tag==='field'&&state.fields[field.attrs.name].exportable!==false).map(field=>field.attrs.name);let groupedBy=this.renderer.state.groupedBy;const domain=this.isDomainSelected&&state.getDomain();return new DataExport(this,state,defaultExportFields,groupedBy,domain,this.getSelectedIds());},_getPagingInfo:function(state){if(!state.count){return null;}
return Object.assign(this._super(...arguments),{validate:()=>this.renderer.unselectRow({canDiscard:true}),});},_getActionMenuItems:function(state){const{isM2MGrouped}=state;if(!this.hasActionMenus||!this.selectedRecords.length){return null;}
const props=this._super(...arguments);const otherActionItems=[];if(this.isExportEnable){otherActionItems.push({description:_t("Export"),callback:()=>this._onExportData()});}
if(this.archiveEnabled&&!isM2MGrouped){otherActionItems.push({description:_t("Archive"),callback:()=>{const dialog=Dialog.confirm(this,_t("Are you sure that you want to archive all the selected records?"),{confirm_callback:()=>{this._toggleArchiveState(true);dialog.close();},});}},{description:_t("Unarchive"),callback:()=>this._toggleArchiveState(false)});}
if(this.activeActions.delete&&!isM2MGrouped){otherActionItems.push({description:_t("Delete"),callback:()=>this._onDeleteSelectedRecords()});}
return Object.assign(props,{items:Object.assign({},this.toolbarActions,{other:otherActionItems}),context:state.getContext(),domain:state.getDomain(),isDomainSelected:this.isDomainSelected,});},_saveMultipleRecords:function(recordId,node,changes){var recordIds=_.union([recordId],this.selectedRecords);var fieldName=node.attrs.name;var value=changes[fieldName];var validRecordIds=recordIds.reduce((result,nextRecordId)=>{var record=this.model.get(nextRecordId);var modifiers=this.renderer._registerModifiers(node,record);if(!modifiers.readonly&&(!modifiers.required||value)){result.push(nextRecordId);}
return result;},[]);return new Promise((resolve,reject)=>{const saveRecords=()=>{this.model.saveRecords(this.handle,recordId,validRecordIds,Object.keys(changes)).then(async()=>{this.updateButtons('readonly');this.selectedRecords=[];await this._confirmSave(this.handle,{keepWidths:true,selectedRecords:[],});this._updateSelectionBox();this.renderer.focusCell(recordId,node);resolve(!Object.keys(changes).length);}).guardedCatch(discardAndReject);};const discardAndReject=()=>{this.model.discardChanges(recordId);this._confirmSave(recordId).then(()=>{this.renderer.focusCell(recordId,node);reject();});};if(validRecordIds.length>0){if(recordIds.length===1){return saveRecords();}
const dialogOptions={confirm_callback:saveRecords,cancel_callback:discardAndReject,};const record=this.model.get(recordId);const params={isDomainSelected:this.isDomainSelected,fields:Object.keys(changes).map((fieldName)=>{let fieldLabel=record.fields[fieldName].string;if(node.attrs.name===fieldName&&node.attrs.string){fieldLabel=node.attrs.string;}
return{name:fieldName,label:fieldLabel};}),nbRecords:recordIds.length,nbValidRecords:validRecordIds.length,};new ListConfirmDialog(this,record,params,dialogOptions).open({shouldFocusButtons:true});}else{Dialog.alert(this,_t("No valid record to save"),{confirm_callback:discardAndReject,});}});},_saveRecord:function(recordId){var record=this.model.get(recordId,{raw:true});if(record.isDirty()&&this.renderer.isInMultipleRecordEdition(recordId)){const prom=this.multipleRecordsSavingPromise||Promise.reject();this.multipleRecordsSavingPromise=null;return prom;}
return this._super.apply(this,arguments);},_setMode:function(mode,recordID){if((recordID||this.handle)!==this.handle){this.mode=mode;this.updateButtons(mode);return this.renderer.setRowMode(recordID,mode);}else{return this._super.apply(this,arguments);}},_shouldBounceOnClick(){const state=this.model.get(this.handle,{raw:true});return!state.count||state.isSample;},_toggleArchiveState:async function(archive){const resIds=await this.getSelectedIdsWithDomain()
const notif=this.isDomainSelected;await this._archive(resIds,archive);const total=this.model.get(this.handle,{raw:true}).count;if(notif&&resIds.length===session.active_ids_limit&&resIds.length<total){const msg=_.str.sprintf(_t("Of the %d records selected, only the first %d have been archived/unarchived."),total,resIds.length);this.displayNotification({title:_t('Warning'),message:msg});}},_toggleCreateButton:function(){if(this.hasButtons){var state=this.model.get(this.handle);var createHidden=this.editable&&state.groupedBy.length&&state.data.length;this.$buttons.find('.o_list_button_add').toggleClass('o_hidden',!!createHidden);}},_update:async function(){await this._super(...arguments);this._toggleCreateButton();this.updateButtons('readonly');},_updateSelectionBox(){this._renderHeaderButtons();if(this.$selectionBox){this.$selectionBox.remove();this.$selectionBox=null;}
if(this.selectedRecords.length){const state=this.model.get(this.handle,{raw:true});this.$selectionBox=$(qweb.render('ListView.selection',{isDomainSelected:this.isDomainSelected,isMobile:config.device.isMobile,isPageSelected:this.isPageSelected,nbSelected:this.selectedRecords.length,nbTotal:state.count,}));this.$selectionBox.appendTo(this.$buttons);}},_onActivateNextWidget:function(ev){ev.stopPropagation();this.renderer.editFirstRecord(ev);},_onAddRecord:function(ev){ev.stopPropagation();var dataPointId=ev.data.groupId||this.handle;if(this.activeActions.create){this._addRecord(dataPointId);}else if(ev.data.onFail){ev.data.onFail();}},_onBeforeUnload:function(){const recordId=this.renderer.getEditableRecordID();if(recordId){this._urgentSave(recordId);}},_onButtonClicked:function(ev){ev.stopPropagation();this._callButtonAction(ev.data.attrs,ev.data.record);},_onCreateRecord:function(ev){if(ev){ev.stopPropagation();}
var state=this.model.get(this.handle,{raw:true});if(this.editable&&!state.groupedBy.length){this._addRecord(this.handle);}else{this.trigger_up('switch_view',{view_type:'form',res_id:undefined});}},_onDeleteSelectedRecords:async function(){if(this.isDomainSelected){this._deleteRecordsInCurrentDomain();}else{this._deleteRecords(this.selectedRecords);}},_onDiscard:function(ev){ev.stopPropagation();this._discardChanges();},_onDiscardMousedown:function(ev){var self=this;this.fieldChangedPrevented=true;window.addEventListener('mouseup',function(mouseupEvent){var preventedEvent=self.fieldChangedPrevented;self.fieldChangedPrevented=false;if(ev.target!==mouseupEvent.target&&preventedEvent.constructor.name==='OdooEvent'){self._onFieldChanged(preventedEvent);}},{capture:true,once:true});},_onEditLine:function(ev){var self=this;ev.stopPropagation();this.trigger_up('mutexify',{action:function(){self._setMode('edit',ev.data.recordId).then(ev.data.onSuccess);},});},_onExportData:function(){this._getExportDialogWidget().open();},_onDirectExportData(){return this._rpc({model:'ir.exports',method:'search_read',args:[[],['id']],limit:1,}).then(()=>this._getExportDialogWidget().export())},_onEditGroupClicked:function(ev){ev.stopPropagation();this.do_action({context:{create:false},type:'ir.actions.act_window',views:[[false,'form']],res_model:ev.data.record.model,res_id:ev.data.record.res_id,flags:{mode:'edit'},});},_onFieldChanged:function(ev){ev.stopPropagation();const recordId=ev.data.dataPointID;if(this.fieldChangedPrevented){this.fieldChangedPrevented=ev;}else if(this.renderer.isInMultipleRecordEdition(recordId)){const saveMulti=()=>{const target=ev.data.__originalComponent||ev.target;this.multipleRecordsSavingPromise=this._saveMultipleRecords(ev.data.dataPointID,target.__node,ev.data.changes);};ev.data.onSuccess=saveMulti;ev.data.onFailure=saveMulti;ev.data.notifyChange=false;ev.data.force_save=false;}
this._super.apply(this,arguments);},async _onHeaderButtonClicked(node){this._disableButtons();const state=this.model.get(this.handle);try{const resIds=await this.getSelectedIdsWithDomain();const actionData=Object.assign({},node.attrs,{context:state.getContext({additionalContext:node.attrs.context}),});Object.assign(actionData.context,{active_domain:state.getDomain(),active_id:resIds[0],active_ids:resIds,active_model:state.model,});const recordData={context:state.getContext(),model:state.model,resIDs:resIds,};await this._executeButtonAction(actionData,recordData);}finally{this._enableButtons();}},_onReload(ev){const{isM2MGrouped}=this.model.get(this.handle);if(isM2MGrouped){ev.data.db_id=this.handle;}
this._super(...arguments);},_onSaveLine:function(ev){this.saveRecord(ev.data.recordID).then(ev.data.onSuccess).guardedCatch(ev.data.onFailure);},_onSelectDomain:function(ev){ev.preventDefault();this.isDomainSelected=true;this._updateSelectionBox();this._updateControlPanel();},_onSelectionChanged:function(ev){this.selectedRecords=ev.data.selection;this.isPageSelected=ev.data.allChecked;this.isDomainSelected=false;this.$('.o_list_export_xlsx').toggle(!this.selectedRecords.length);this._updateSelectionBox();this._updateControlPanel();},_onSetDirty:function(ev){var recordId=ev.data.dataPointID;if(this.renderer.isInMultipleRecordEdition(recordId)){ev.stopPropagation();Dialog.alert(this,_t("No valid record to save"),{confirm_callback:async()=>{this.model.discardChanges(recordId);await this._confirmSave(recordId);this.renderer.focusCell(recordId,ev.target.__node);},});}else{this._super.apply(this,arguments);}},_onToggleColumnOrder:function(ev){ev.stopPropagation();var state=this.model.get(this.handle);if(!state.groupedBy){this._updatePaging(state,{currentMinimum:1});}
var self=this;this.model.setSort(state.id,ev.data.name).then(function(){self.update({});});},_onToggleGroup:function(ev){ev.stopPropagation();var self=this;this.model.toggleGroup(ev.data.group.id).then(function(){self.update({},{keepSelection:true,reload:false}).then(function(){if(ev.data.onSuccess){ev.data.onSuccess();}});});},});__exports[Symbol.for("default")]=ListController;return __exports;});odoo.define(`web.ListController`,async function(require){return require('@web/legacy/js/views/list/list_controller')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/list/list_editable_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/list/list_editable_renderer',async function(require){'use strict';let __exports={};const core=require('web.core');const dom=require('web.dom');const ListRenderer=require('web.ListRenderer');const utils=require('web.utils');const{WidgetAdapterMixin}=require('web.OwlCompatibility');var _t=core._t;ListRenderer.include({RESIZE_DELAY:200,custom_events:_.extend({},ListRenderer.prototype.custom_events,{navigation_move:'_onNavigationMove',}),events:_.extend({},ListRenderer.prototype.events,{'click .o_field_x2many_list_row_add a':'_onAddRecord','click .o_group_field_row_add a':'_onAddRecordToGroup','keydown .o_field_x2many_list_row_add a':'_onKeyDownAddRecord','click tbody td.o_data_cell':'_onCellClick','click tbody tr:not(.o_data_row)':'_onEmptyRowClick','click tfoot':'_onFooterClick','click tr .o_list_record_remove':'_onRemoveIconClick',}),init:function(parent,state,params){this._super.apply(this,arguments);this.editable=params.editable;this.isMultiEditable=params.isMultiEditable;this.columnWidths=false;this.addCreateLine=params.addCreateLine;this.addCreateLineInGroups=params.addCreateLineInGroups;this.creates=[];this.arch.children.forEach(child=>{if(child.tag!=='control'){return;}
child.children.forEach(child=>{if(child.tag!=='create'||child.attrs.invisible){return;}
this.creates.push({context:child.attrs.context,string:child.attrs.string,});});});if(this.creates.length===0){this.creates.push({string:_t("Add a line"),});}
this.addTrashIcon=params.addTrashIcon;this.isMany2Many=params.isMany2Many;this.currentRow=null;this.currentFieldIndex=null;this.isResizing=false;this.eventListeners=[];},start:function(){core.bus.on('click',this,this._onWindowClicked.bind(this));core.bus.on('resize',this,_.debounce(this._onResize.bind(this),this.RESIZE_DELAY));core.bus.on('DOM_updated',this,()=>this._freezeColumnWidths());return this._super();},destroy:function(){this.eventListeners.forEach(listener=>{const{type,el,callback,options}=listener;el.removeEventListener(type,callback,options);});return this._super.apply(this,arguments);},on_attach_callback:function(){this._super();this._freezeColumnWidths();},canBeSaved:function(recordID){if((recordID||this.state.id)===this.state.id){recordID=this.getEditableRecordID();if(recordID===null){return[];}}
var fieldNames=this._super(recordID);this.$('.o_selected_row .o_data_cell').removeClass('o_invalid_cell');this.$('.o_selected_row .o_data_cell:has(> .o_field_invalid)').addClass('o_invalid_cell');return fieldNames;},confirmChange:function(state,recordID){var self=this;return this._super.apply(this,arguments).then(function(widgets){if(widgets.length){var $row=self._getRow(recordID);var record=self._getRecord(recordID);self._setDecorationClasses($row,self.rowDecorations,record);self._updateFooter();}
return widgets;});},confirmUpdate:function(state,id,fields,ev){var self=this;var oldData=this.state.data;this._setState(state);return this.confirmChange(state,id,fields,ev).then(function(){var record=self._getRecord(id);if(!record){return;}
_.each(oldData,function(rec){if(rec.id!==id){self._updateAllModifiers(rec);self._destroyFieldWidgets(rec.id);}});const currentRowFieldWidgets=self.allFieldWidgets[id];delete self.allFieldWidgets[id];self.defs=[];var $newBody=self._renderBody();var defs=self.defs;delete self.defs;return Promise.all(defs).then(function(){self._destroyFieldWidgets(id);self.allFieldWidgets[id]=currentRowFieldWidgets;_.each(self.columns,function(node){self._registerModifiers(node,record,null,{mode:'edit'});});var currentRowID;var currentWidget;var focusedElement;var selectionRange;if(self.currentRow!==null){currentRowID=self._getRecordID(self.currentRow);currentWidget=self.allFieldWidgets[currentRowID][self.currentFieldIndex];if(currentWidget){focusedElement=currentWidget.getFocusableElement().get(0);if(currentWidget.formatType!=='boolean'&&focusedElement){selectionRange=dom.getSelectionRange(focusedElement);}}}
var $editedRow=self._getRow(id);$editedRow.nextAll('.o_data_row').remove();$editedRow.prevAll('.o_data_row').remove();var $newRow=$newBody.find('.o_data_row[data-id="'+id+'"]');$newRow.prevAll('.o_data_row').get().reverse().forEach(function(row){$(row).insertBefore($editedRow);});$newRow.nextAll('.o_data_row').get().reverse().forEach(function(row){$(row).insertAfter($editedRow);});if(self._isInDom){for(const handle in self.allFieldWidgets){if(handle!==id){self.allFieldWidgets[handle].forEach(widget=>{if(widget.on_attach_callback){widget.on_attach_callback();}});}}}
if(self.currentRow!==null){var newRowIndex=$editedRow.prop('rowIndex')-1;self.currentRow=newRowIndex;return self._selectCell(newRowIndex,self.currentFieldIndex,{force:true}).then(function(){currentWidget=self.allFieldWidgets[currentRowID][self.currentFieldIndex];if(currentWidget){focusedElement=currentWidget.getFocusableElement().get(0);if(selectionRange){dom.setSelectionRange(focusedElement,selectionRange);}}});}});});},editFirstRecord:function(ev){const $borderRow=this._getBorderRow(ev.data.side||'first');this._selectCell($borderRow.prop('rowIndex')-1,ev.data.cellIndex||0);},editRecord:function(recordID){var $row=this._getRow(recordID);var rowIndex=$row.prop('rowIndex')-1;return this._selectCell(rowIndex,0);},focusCell:function(recordId,column){var $row=this._getRow(recordId);var cellIndex=this.columns.indexOf(column);$row.find('.o_data_cell')[cellIndex].focus();},getEditableRecordID:function(){if(this.currentRow!==null){return this._getRecordID(this.currentRow);}
return null;},isInMultipleRecordEdition:function(recordId){return this.isEditable()&&this.isMultiEditable&&this.selection.includes(recordId);},isEditable:function(){return this.editable||(this.isMultiEditable&&this.selection.length);},removeLine:function(state,recordID){this._setState(state);var $row=this._getRow(recordID);if($row.length===0){return;}
if($row.prop('rowIndex')-1===this.currentRow){this.currentRow=null;this._enableRecordSelectors();}
this._destroyFieldWidgets(recordID);if(this.state.count>=4){$row.remove();}else{var $emptyRow=this._renderEmptyRow();$row.replaceWith($emptyRow);const $lastDataRow=this.$('.o_data_row:last');if($lastDataRow.length){$emptyRow.insertAfter($lastDataRow);}}},setRowMode:function(recordID,mode){var self=this;var record=self._getRecord(recordID);if(!record){return Promise.resolve();}
var editMode=(mode==='edit');var $row=this._getRow(recordID);this.currentRow=editMode?$row.prop('rowIndex')-1:null;var $tds=$row.children('.o_data_cell');var oldWidgets=_.clone(this.allFieldWidgets[record.id]);var options={renderInvisible:editMode,renderWidgets:editMode,};options.mode=editMode?'edit':'readonly';var defs=[];this.defs=defs;_.each(this.columns,function(node,colIndex){var $td=$tds.eq(colIndex);var $newTd=self._renderBodyCell(record,node,colIndex,options);if($td.hasClass('o_list_button')){self._unregisterModifiersElement(node,recordID,$td.children());}
if(editMode){$td.empty().append($newTd.contents());}else{self._unregisterModifiersElement(node,recordID,$td);$td.replaceWith($newTd);}});delete this.defs;_.each(oldWidgets,this._destroyFieldWidget.bind(this,recordID));$row.toggleClass('o_selected_row',editMode);if(editMode){this._disableRecordSelectors();}else{this._enableRecordSelectors();}
return Promise.all(defs).then(function(){WidgetAdapterMixin.on_attach_callback.call(self);core.bus.trigger('DOM_updated');});},unselectRow:function(options={}){if(this.currentRow===null){return Promise.resolve();}
var recordID=this._getRecordID(this.currentRow);var recordWidgets=this.allFieldWidgets[recordID];function toggleWidgets(disabled){_.each(recordWidgets,function(widget){var $el=widget.getFocusableElement();$el.prop('disabled',disabled);});}
toggleWidgets(true);return new Promise(async(resolve,reject)=>{const record=this._getRecord(recordID);if(options.canDiscard&&record.isNew()){await this.commitChanges(recordID);if(!record.isDirty()){this.trigger_up('mutexify',{action:()=>{return this.trigger_up('discard_changes',{recordID:recordID,onSuccess:resolve,onFailure:reject,});},});return;}}
this.trigger_up('save_line',{recordID:recordID,onSuccess:resolve,onFailure:reject,});}).then(selectNextRow=>{this._enableRecordSelectors();return selectNextRow;}).guardedCatch(()=>{toggleWidgets(false);});},updateState:function(state,params){if(params.keepWidths&&this.$el.is(':visible')){this._storeColumnWidths();}
if(params.noRender){this.allModifiersData=[];}
if('addTrashIcon'in params){if(this.addTrashIcon!==params.addTrashIcon){this.columnWidths=false;}
this.addTrashIcon=params.addTrashIcon;}
if('addCreateLine'in params){this.addCreateLine=params.addCreateLine;}
return this._super.apply(this,arguments);},_addEventListener:function(type,el,callback,options){el.addEventListener(type,callback,options);this.eventListeners.push({type,el,callback,options});},_computeDefaultWidths:function(){const isListEmpty=!this._hasVisibleRecords(this.state);const relativeWidths=[];this.columns.forEach(column=>{const th=this._getColumnHeader(column);if(th.offsetParent===null){relativeWidths.push(false);}else{const width=this._getColumnWidth(column);if(width.match(/[a-zA-Z]/)){if(isListEmpty){th.style.width=width;}else{th.style.minWidth=width;}
relativeWidths.push(false);}else{relativeWidths.push(parseFloat(width,10));}}});if(isListEmpty){const totalWidth=this._getColumnsTotalWidth(relativeWidths);for(let i in this.columns){if(relativeWidths[i]){const th=this._getColumnHeader(this.columns[i]);th.style.width=(relativeWidths[i]/totalWidth*100)+'%';}}
const trashHeader=this.el.getElementsByClassName('o_list_record_remove_header')[0];if(trashHeader){trashHeader.style.width='32px';}}},_destroyFieldWidgets:function(recordID){if(recordID in this.allFieldWidgets){var widgetsToDestroy=this.allFieldWidgets[recordID].slice();_.each(widgetsToDestroy,this._destroyFieldWidget.bind(this,recordID));delete this.allFieldWidgets[recordID];}},_disableRecordSelectors:function(){this.$('.o_list_record_selector input').attr('disabled','disabled');},_enableRecordSelectors:function(){this.$('.o_list_record_selector input').attr('disabled',false);},_freezeColumnWidths:function(){if(!this.columnWidths&&this.el.offsetParent===null){return;}
const thElements=[...this.el.querySelectorAll('table thead th')];if(!thElements.length){return;}
const table=this.el.getElementsByClassName('o_list_table')[0];let columnWidths=this.columnWidths;if(!columnWidths||!columnWidths.length){table.style.tableLayout='auto';thElements.forEach(th=>{th.style.width=null;th.style.maxWidth=null;});this._computeDefaultWidths();columnWidths=this._squeezeTable();}
thElements.forEach((th,index)=>{if(!th.style.width){th.style.width=`${columnWidths[index]}px`;}});table.style.tableLayout='fixed';},_getBorderRow:function(side){let $borderDataRow=this.$(`.o_data_row:${side}`);if(!this._isRecordEditable($borderDataRow.data('id'))){$borderDataRow=this._getNearestEditableRow($borderDataRow,side==='first');}
return $borderDataRow;},_getColumnsTotalWidth(relativeWidths){return relativeWidths.reduce((acc,width)=>acc+width,0);},_getColumnWidth:function(column){if(column.attrs.width){return column.attrs.width;}
const fieldsInfo=this.state.fieldsInfo.list;const name=column.attrs.name;if(!fieldsInfo[name]){return'1';}
const widget=fieldsInfo[name].Widget.prototype;if('widthInList'in widget){return widget.widthInList;}
const field=this.state.fields[name];if(!field){return'1';}
const fixedWidths={boolean:'70px',date:'92px',datetime:'146px',float:'92px',integer:'74px',monetary:'104px',};let type=field.type;if(fieldsInfo[name].widget in fixedWidths){type=fieldsInfo[name].widget;}
return fixedWidths[type]||'1';},_getColumnHeader:function(column){const{icon,name,string}=column.attrs;if(name){return this.el.querySelector(`thead th[data-name="${name}"]`);}else if(string){return this.el.querySelector(`thead th[data-string="${string}"]`);}else if(icon){return this.el.querySelector(`thead th[data-icon="${icon}"]`);}},_getNearestEditableRow:function($row,next){const direction=next?'next':'prev';let $nearestRow;if(this.editable){$nearestRow=$row[direction]();if(!$nearestRow.hasClass('o_data_row')){var $nextBody=$row.closest('tbody')[direction]();while($nextBody.length&&!$nextBody.find('.o_data_row').length){$nextBody=$nextBody[direction]();}
$nearestRow=$nextBody.find(`.o_data_row:${next ? 'first' : 'last'}`);}}else{const recordId=$row.data('id');const rowSelectionIndex=this.selection.indexOf(recordId);let nextRowIndex;if(rowSelectionIndex<0){nextRowIndex=next?0:this.selection.length-1;}else{nextRowIndex=rowSelectionIndex+(next?1:-1);}
$nearestRow=this._getRow(this.selection[nextRowIndex]);}
return $nearestRow;},_getNumberOfCols:function(){var n=this._super();if(this.addTrashIcon){n++;}
return n;},_getRecord:function(recordId){var record;utils.traverse_records(this.state,function(r){if(r.id===recordId){record=r;}});return record;},_getRecordID:function(rowIndex){var $tr=this.$('table.o_list_table > tbody > tr').eq(rowIndex);return $tr.data('id');},_getRow:function(recordId){return this.$('.o_data_row[data-id="'+recordId+'"]');},_hasVisibleRecords:function(list){if(!list.groupedBy.length){return!!list.data.length;}else{var hasVisibleRecords=false;for(var i=0;i<list.data.length;i++){hasVisibleRecords=hasVisibleRecords||this._hasVisibleRecords(list.data[i]);}
return hasVisibleRecords;}},_isRecordEditable:function(recordID){return this.editable||(this.isMultiEditable&&this.selection.includes(recordID));},_moveToNextLine:function(options){this._moveToSideLine(true,options);},_moveToPreviousLine:function(options){this._moveToSideLine(false,options);},_moveToSideLine:function(next,options){options=options||{};const recordID=this._getRecordID(this.currentRow);this.commitChanges(recordID).then(()=>{const record=this._getRecord(recordID);const multiEdit=this.isInMultipleRecordEdition(recordID);if(!multiEdit){const fieldNames=this.canBeSaved(recordID);if(fieldNames.length&&(record.isDirty()||options.forceCreate)){return;}}
const side=next?'first':'last';const borderRowIndex=this._getBorderRow(side).prop('rowIndex')-1;const cellIndex=next?0:this.allFieldWidgets[recordID].length-1;const cellOptions={inc:next?1:-1,force:true};const $currentRow=this._getRow(recordID);const $nextRow=this._getNearestEditableRow($currentRow,next);let nextRowIndex=null;let groupId;if(!this.isGrouped){if($nextRow.length){nextRowIndex=$nextRow.prop('rowIndex')-1;}else if(!this.editable){nextRowIndex=borderRowIndex;}else if(!options.forceCreate&&!record.isDirty()){this.trigger_up('discard_changes',{recordID:recordID,onSuccess:this.trigger_up.bind(this,'activate_next_widget',{side:side}),});return;}}else{var $directNextRow=$currentRow.next();if(next&&this.editable==="bottom"&&$directNextRow.hasClass('o_add_record_row')){if(options.forceCreate||record.isDirty()){groupId=$directNextRow.data('group-id');}else{nextRowIndex=($nextRow.prop('rowIndex')-1)||null;this.trigger_up('discard_changes',{recordID:recordID,onSuccess:()=>{if(nextRowIndex!==null){if(!record.res_id){nextRowIndex--;}
this._selectCell(nextRowIndex,cellIndex,cellOptions);}else{this._selectCell(borderRowIndex,cellIndex,cellOptions);}},});return;}}else{nextRowIndex=$nextRow.length?($nextRow.prop('rowIndex')-1):borderRowIndex;}}
if(nextRowIndex!==null){this._selectCell(nextRowIndex,cellIndex,cellOptions);}else if(this.editable){this.unselectRow().then(this.trigger_up.bind(this,'add_record',{groupId:groupId,onFail:this._selectCell.bind(this,borderRowIndex,cellIndex,cellOptions),}));}});},_processColumns:function(){const oldColumns=this.columns;this._super.apply(this,arguments);if(this.columnWidths&&oldColumns&&oldColumns.length===this.columns.length){for(let i=0;i<oldColumns.length;i++){if(oldColumns[i]!==this.columns[i]){this.columnWidths=false;break;}}}else{this.columnWidths=false;}},_render:function(){this.currentRow=null;this.currentFieldIndex=null;return this._super.apply(this,arguments);},_renderGroup:function(group){var result=this._super.apply(this,arguments);if(!group.groupedBy.length&&this.addCreateLineInGroups){var $groupBody=result[0];var $a=$('<a href="#" role="button">').text(_t("Add a line")).attr('data-group-id',group.id);var $td=$('<td>').attr('colspan',this._getNumberOfCols()).addClass('o_group_field_row_add').attr('tabindex',-1).append($a);var $tr=$('<tr>',{class:'o_add_record_row'}).attr('data-group-id',group.id).append($td);$groupBody.append($tr.prepend($('<td>').html('&nbsp;')));}
return result;},_renderBody:function(){var self=this;var $body=this._super.apply(this,arguments);if(this.hasHandle){$body.sortable({axis:'y',items:'> tr.o_data_row',helper:'clone',handle:'.o_row_handle',cursor:"grabbing",stop:function(event,ui){if(self.currentRow!==null){var currentID=self.state.data[self.currentRow].id;self.currentRow=self._getRow(currentID).index();}
self.unselectRow().then(function(){self._moveRecord(ui.item.data('id'),ui.item.index());});},});}
return $body;},_renderFooter:function(){const $footer=this._super.apply(this,arguments);if(this.addTrashIcon){$footer.find('tr').append($('<td>'));}
return $footer;},_renderHeader:function(){var $thead=this._super.apply(this,arguments);if(this.addTrashIcon){$thead.find('tr').append($('<th>',{class:'o_list_record_remove_header'}));}
return $thead;},_renderHeaderCell:function(){const $th=this._super.apply(this,arguments);if($th[0].innerHTML.length&&this._hasVisibleRecords(this.state)){const resizeHandle=document.createElement('span');resizeHandle.classList='o_resize';resizeHandle.onclick=this._onClickResize.bind(this);resizeHandle.onmousedown=this._onStartResize.bind(this);$th.append(resizeHandle);}
return $th;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(this.addTrashIcon){var $icon=this.isMany2Many?$('<button>',{'class':'fa fa-times','name':'unlink','aria-label':_t('Unlink row ')+(index+1)}):$('<button>',{'class':'fa fa-trash-o','name':'delete','aria-label':_t('Delete row ')+(index+1)});var $td=$('<td>',{class:'o_list_record_remove'}).append($icon);$row.append($td);}
return $row;},_renderRows:function(){var $rows=this._super();if(this.addCreateLine){var $tr=$('<tr>');var colspan=this._getNumberOfCols();if(this.handleField){colspan=colspan-1;$tr.append('<td>');}
var $td=$('<td>').attr('colspan',colspan).addClass('o_field_x2many_list_row_add');$tr.append($td);$rows.push($tr);if(this.addCreateLine){_.each(this.creates,function(create,index){var $a=$('<a href="#" role="button">').attr('data-context',create.context).text(create.string);if(index>0){$a.addClass('ml16');}
$td.append($a);});}}
return $rows;},_renderView:function(){this.currentRow=null;return this._super.apply(this,arguments).then(()=>{const table=this.el.getElementsByClassName('o_list_table')[0];if(table){table.classList.toggle('o_empty_list',!this._hasVisibleRecords(this.state));this._freezeColumnWidths();}});},_selectCell:function(rowIndex,fieldIndex,options){options=options||{};if(!options.force&&rowIndex===this.currentRow&&fieldIndex===this.currentFieldIndex){return Promise.resolve();}
var wrap=options.wrap===undefined?true:options.wrap;var recordID=this._getRecordID(rowIndex);var self=this;return this._selectRow(rowIndex).then(function(){var record=self._getRecord(recordID);if(fieldIndex>=(self.allFieldWidgets[record.id]||[]).length){return Promise.reject();}
var oldFieldIndex=self.currentFieldIndex;self.currentFieldIndex=fieldIndex;fieldIndex=self._activateFieldWidget(record,fieldIndex,{inc:options.inc||1,wrap:wrap,event:options&&options.event,});if(fieldIndex<0){self.currentFieldIndex=oldFieldIndex;return Promise.reject();}
self.currentFieldIndex=fieldIndex;});},_selectRow:function(rowIndex){if(rowIndex===this.currentRow){return Promise.resolve();}
if(!this.columnWidths){this._storeColumnWidths();}
var recordId=this._getRecordID(rowIndex);var self=this;return this.unselectRow({canDiscard:true}).then((selectNextRow=true)=>{if(!selectNextRow){return Promise.resolve();}
if(!recordId){return Promise.reject();}
return new Promise(function(resolve){self.trigger_up('edit_line',{recordId:recordId,onSuccess:function(){self._disableRecordSelectors();resolve();},});});});},_squeezeTable:function(){const table=this.el.getElementsByClassName('o_list_table')[0];table.classList.add('o_list_computing_widths');const thead=table.getElementsByTagName('thead')[0];const thElements=[...thead.getElementsByTagName('th')];const columnWidths=thElements.map(th=>th.offsetWidth);const getWidth=th=>columnWidths[thElements.indexOf(th)]||0;const getTotalWidth=()=>thElements.reduce((tot,th,i)=>tot+columnWidths[i],0);const shrinkColumns=(columns,width)=>{let thresholdReached=false;columns.forEach(th=>{const index=thElements.indexOf(th);let maxWidth=columnWidths[index]-Math.ceil(width/columns.length);if(maxWidth<92){maxWidth=92;thresholdReached=true;}
th.style.maxWidth=`${maxWidth}px`;columnWidths[index]=maxWidth;});return thresholdReached;};const sortedThs=[...thead.querySelectorAll('th:not(.o_list_button)')].sort((a,b)=>getWidth(b)-getWidth(a));const allowedWidth=table.parentNode.offsetWidth;let totalWidth=getTotalWidth();let stop=false;let index=0;while(totalWidth>allowedWidth&&!stop){index++;const largests=sortedThs.slice(0,index);while(getWidth(largests[0])===getWidth(sortedThs[index])){largests.push(sortedThs[index]);index++;}
const nextLargest=sortedThs[index];const totalToRemove=totalWidth-allowedWidth;const canRemove=(getWidth(largests[0])-getWidth(nextLargest))*largests.length;stop=shrinkColumns(largests,Math.min(totalToRemove,canRemove));totalWidth=getTotalWidth();}
table.classList.remove('o_list_computing_widths');return columnWidths;},_storeColumnWidths:function(){this.columnWidths=this.$('thead th').toArray().map(function(th){return $(th).outerWidth();});},_onAddRecordToGroup:function(ev){ev.preventDefault();ev.stopPropagation();var self=this;const target=ev.target.tagName!=='A'?ev.target.getElementsByTagName('A')[0]:ev.target;const groupId=target.dataset.groupId;this.currentGroupId=groupId;this.unselectRow().then(function(){self.trigger_up('add_record',{groupId:groupId,});});},_onAddRecord:function(ev){ev.preventDefault();ev.stopPropagation();var self=this;this.unselectRow().then(function(){self.trigger_up('add_record',{context:ev.currentTarget.dataset.context&&[ev.currentTarget.dataset.context]});});},_onCellClick:function(event){var $td=$(event.currentTarget);var $tr=$td.parent();var rowIndex=$tr.prop('rowIndex')-1;if(!this._isRecordEditable($tr.data('id'))||$(event.target).prop('special_click')){return;}
var fieldIndex=Math.max($tr.find('.o_field_cell').index($td),0);this._selectCell(rowIndex,fieldIndex,{event:event});},_onClickResize:function(ev){ev.stopPropagation();ev.preventDefault();},_onEmptyRowClick:function(){this.unselectRow();},_onFooterClick:function(){this.unselectRow();},_onKeyDown:function(ev){const $target=$(ev.currentTarget);const $tr=$target.closest('tr');const recordEditable=this._isRecordEditable($tr.data('id'));if(recordEditable&&ev.keyCode===$.ui.keyCode.ENTER&&$tr.hasClass('o_selected_row')){return;}
if(recordEditable&&ev.keyCode===$.ui.keyCode.ENTER&&!$tr.hasClass('o_selected_row')&&!$tr.hasClass('o_group_header')){ev.stopPropagation();ev.preventDefault();if($target.closest('td').hasClass('o_group_field_row_add')){this._onAddRecordToGroup(ev);}else{this._onCellClick(ev);}}else{this._super.apply(this,arguments);}},_onKeyDownAddRecord:function(e){switch(e.keyCode){case $.ui.keyCode.ENTER:e.stopPropagation();e.preventDefault();this._onAddRecord(e);break;}},_onNavigationMove:function(ev){var self=this;if(this.currentRow===null&&ev.data.direction==='up'){return;}
ev.stopPropagation();if(ev.data.originalEvent&&['next','previous'].includes(ev.data.direction)){ev.data.originalEvent.preventDefault();ev.data.originalEvent.stopPropagation();}
switch(ev.data.direction){case'previous':if(this.currentFieldIndex>0){this._selectCell(this.currentRow,this.currentFieldIndex-1,{inc:-1,wrap:false}).guardedCatch(this._moveToPreviousLine.bind(this));}else{this._moveToPreviousLine();}
break;case'next':if(this.currentFieldIndex+1<this.columns.length){this._selectCell(this.currentRow,this.currentFieldIndex+1,{wrap:false}).guardedCatch(this._moveToNextLine.bind(this));}else{this._moveToNextLine();}
break;case'next_line':if(!this.editable&&this.selection.length===1&&this._getRecordID(this.currentRow)===ev.target.dataPointID){this.unselectRow();}else{this._moveToNextLine({forceCreate:true});}
break;case'cancel':ev.data.originalEvent.stopPropagation();var rowIndex=this.currentRow;var cellIndex=this.currentFieldIndex+1;this.trigger_up('discard_changes',{recordID:ev.target.dataPointID,onSuccess:function(){self._enableRecordSelectors();var recordId=self._getRecordID(rowIndex);if(recordId){var correspondingRow=self._getRow(recordId);correspondingRow.children().eq(cellIndex).focus();}else if(self.currentGroupId){self.$('a[data-group-id="'+self.currentGroupId+'"]').focus();}else{self.$('.o_field_x2many_list_row_add a:first').focus();}}});break;}},_onRemoveIconClick:function(event){event.stopPropagation();var $row=$(event.target).closest('tr');var id=$row.data('id');if($row.hasClass('o_selected_row')){this.trigger_up('list_record_remove',{id:id});}else{var self=this;this.unselectRow().then(function(){self.trigger_up('list_record_remove',{id:id});});}},_onResize:function(){this.columnWidths=false;this._freezeColumnWidths();},_onRowClicked:function(ev){if(!this._isRecordEditable(ev.currentTarget.dataset.id)){if(this.getEditableRecordID()){this.unselectRow();}else{this._super.apply(this,arguments);}}},_onSortColumn:function(){if(this.currentRow===null&&!this.isResizing){this._super.apply(this,arguments);}},_onStartResize:function(ev){if(ev.which!==1){return;}
ev.preventDefault();ev.stopPropagation();this.isResizing=true;const table=this.el.getElementsByClassName('o_list_table')[0];const th=ev.target.closest('th');table.style.width=`${table.offsetWidth}px`;const thPosition=[...th.parentNode.children].indexOf(th);const resizingColumnElements=[...table.getElementsByTagName('tr')].filter(tr=>tr.children.length===th.parentNode.children.length).map(tr=>tr.children[thPosition]);const optionalDropdown=this.el.getElementsByClassName('o_optional_columns')[0];const initialX=ev.pageX;const initialWidth=th.offsetWidth;const initialTableWidth=table.offsetWidth;const initialDropdownX=optionalDropdown?optionalDropdown.offsetLeft:null;const resizeStoppingEvents=['keydown','mousedown','mouseup',];if(!this.el.style.width){this.el.style.width=`${this.el.offsetWidth}px`;}
table.classList.add('o_resizing');resizingColumnElements.forEach(el=>el.classList.add('o_column_resizing'));const resizeHeader=ev=>{ev.preventDefault();ev.stopPropagation();const delta=ev.pageX-initialX;const newWidth=Math.max(10,initialWidth+delta);const tableDelta=newWidth-initialWidth;th.style.width=`${newWidth}px`;th.style.maxWidth=`${newWidth}px`;table.style.width=`${initialTableWidth + tableDelta}px`;if(optionalDropdown){optionalDropdown.style.left=`${initialDropdownX + tableDelta}px`;}};this._addEventListener('mousemove',window,resizeHeader);const stopResize=ev=>{if(ev.type==='mousedown'&&ev.which===1){return;}
ev.preventDefault();ev.stopPropagation();clearTimeout(this.resizeTimeout);this.resizeTimeout=setTimeout(()=>{this.isResizing=false;},100);window.removeEventListener('mousemove',resizeHeader);table.classList.remove('o_resizing');resizingColumnElements.forEach(el=>el.classList.remove('o_column_resizing'));resizeStoppingEvents.forEach(stoppingEvent=>{window.removeEventListener(stoppingEvent,stopResize);});document.activeElement.blur();};resizeStoppingEvents.forEach(stoppingEvent=>{this._addEventListener(stoppingEvent,window,stopResize);});},_onToggleOptionalColumnDropdown:function(ev){this.unselectRow().then(this._super.bind(this,ev));},_onWindowClicked:function(event){if(!this.isEditable()){return;}
if(!document.contains(this.el)){return;}
if(this.currentRow===null){return;}
if($(event.target).closest('.ui-autocomplete').length){return;}
const $modal=$('.modal[role="dialog"]:last');if($modal.length){var $listModal=this.$el.closest('.modal');if($modal.prop('id')!==$listModal.prop('id')){return;}}
if(!document.contains(event.target)){return;}
if(this.el.contains(event.target)&&this.el!==event.target){return;}
if($(event.target).hasClass('o_facet_remove')){return;}
this.unselectRow({canDiscard:![...event.target.classList].includes('o_list_button_save')});},});return __exports;});odoo.define(`web.EditableListRenderer`,async function(require){return require('@web/legacy/js/views/list/list_editable_renderer')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/list/list_model.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/list/list_model',async function(require){'use strict';let __exports={};const BasicModel=require('web.BasicModel');var ListModel=BasicModel.extend({init:function(parent,params){this._super.apply(this,arguments);this.groupbys=params.groupbys;},__get:function(){var result=this._super.apply(this,arguments);var dp=result&&this.localData[result.id];if(dp&&dp.groupData){result.groupData=this.get(dp.groupData);}
return result;},saveRecords:function(listDatapointId,referenceRecordId,recordIds,fieldName){var self=this;var referenceRecord=this.localData[referenceRecordId];var list=this.localData[listDatapointId];var allChanges=this._generateChanges(referenceRecord,{changesOnly:false});var changes=_.pick(allChanges,fieldName);var records=recordIds.map(function(recordId){return self.localData[recordId];});var model=records[0].model;var recordResIds=_.pluck(records,'res_id');var fieldNames=records[0].getFieldNames();var context=records[0].getContext();return this._rpc({model:model,method:'write',args:[recordResIds,changes],context:context,}).then(function(){return self._rpc({model:model,method:'read',args:[recordResIds,fieldNames],context:context,});}).then(function(results){const updateLocalRecord=(id,data)=>{const record=self.localData[id];record.data=_.extend({},record.data,data);record._changes={};record._isDirty=false;self._parseServerData(fieldNames,record,record.data);};results.forEach(function(data){const record=_.findWhere(records,{res_id:data.id});updateLocalRecord(record.id,data);self._updateDuplicateRecords(record.id,(id)=>updateLocalRecord(id,data));});}).then(function(){if(!list.groupedBy.length){return Promise.all([self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list)]);}else{return Promise.all([self._fetchX2ManysSingleBatch(list),self._fetchReferencesSingleBatch(list)]);}});},_readGroup:function(list,options){var self=this;options=options||{};options.fetchRecordsWithGroups=true;return this._super(list,options).then(function(result){return self._readGroupExtraFields(list).then(_.constant(result));});},_readGroupExtraFields:function(list){var self=this;var groupByFieldName=list.groupedBy[0].split(':')[0];var groupedByField=list.fields[groupByFieldName];if(groupedByField.type!=='many2one'||!this.groupbys[groupByFieldName]){return Promise.resolve();}
var groupIds=_.reduce(list.data,function(groupIds,id){var resId=self.get(id,{raw:true}).res_id;if(resId){groupIds.push(resId);}
return groupIds;},[]);var groupFields=Object.keys(this.groupbys[groupByFieldName].viewFields);var prom;if(groupIds.length&&groupFields.length){prom=this._rpc({model:groupedByField.relation,method:'read',args:[groupIds,groupFields],context:list.context,});}
return Promise.resolve(prom).then(function(result){var fvg=self.groupbys[groupByFieldName];_.each(list.data,function(id){var dp=self.localData[id];var groupData=result&&_.findWhere(result,{id:dp.res_id,});var groupDp=self._makeDataPoint({context:dp.context,data:groupData,fields:fvg.fields,fieldsInfo:fvg.fieldsInfo,modelName:groupedByField.relation,parentID:dp.id,res_id:dp.res_id,viewType:'groupby',});dp.groupData=groupDp.id;self._parseServerData(groupFields,groupDp,groupDp.data);});});},});__exports[Symbol.for("default")]=ListModel;return __exports;});odoo.define(`web.ListModel`,async function(require){return require('@web/legacy/js/views/list/list_model')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/list/list_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/list/list_renderer',async function(require){'use strict';let __exports={};const BasicRenderer=require('web.BasicRenderer');const{ComponentWrapper}=require('web.OwlCompatibility');const config=require('web.config');const core=require('web.core');const dom=require('web.dom');const field_utils=require('web.field_utils');const Pager=require('web.Pager');const utils=require('web.utils');const viewUtils=require('web.viewUtils');var _t=core._t;var DECORATIONS=['decoration-bf','decoration-it','decoration-danger','decoration-info','decoration-muted','decoration-primary','decoration-success','decoration-warning'];var FIELD_CLASSES={char:'o_list_char',float:'o_list_number',integer:'o_list_number',monetary:'o_list_number',text:'o_list_text',many2one:'o_list_many2one',};var ListRenderer=BasicRenderer.extend({className:'o_list_view',events:{"mousedown":"_onMouseDown","click .o_optional_columns_dropdown .dropdown-item":"_onToggleOptionalColumn","click .o_optional_columns_dropdown_toggle":"_onToggleOptionalColumnDropdown",'click tbody tr':'_onRowClicked','change tbody .o_list_record_selector':'_onSelectRecord','click thead th.o_column_sortable':'_onSortColumn','click .o_list_record_selector':'_onToggleCheckbox','click .o_group_header':'_onToggleGroup','change thead .o_list_record_selector input':'_onToggleSelection','keypress thead tr td':'_onKeyPress','keydown td':'_onKeyDown','keydown th':'_onKeyDown',},sampleDataTargets:['.o_data_row','.o_group_header','.o_list_table > tfoot','.o_list_table > thead .o_list_record_selector',],init:function(parent,state,params){this._super.apply(this,arguments);this._preprocessColumns();this.columnInvisibleFields=params.columnInvisibleFields||{};this.rowDecorations=this._extractDecorationAttrs(this.arch);this.fieldDecorations={};for(const field of this.arch.children.filter(c=>c.tag==='field')){const decorations=this._extractDecorationAttrs(field);this.fieldDecorations[field.attrs.name]=decorations;}
this.hasSelectors=params.hasSelectors;this.selection=params.selectedRecords||[];this.pagers=[];this.isGrouped=this.state.groupedBy.length>0;this.groupbys=params.groupbys;this.no_open=params.no_open;},willStart:function(){this._processColumns(this.columnInvisibleFields);return this._super.apply(this,arguments);},giveFocus:function(){this.$('th:eq(0) input, th:eq(1)').first().focus();},updateState:function(state,params){this._setState(state);this.isGrouped=this.state.groupedBy.length>0;this.columnInvisibleFields=params.columnInvisibleFields||{};this._processColumns(this.columnInvisibleFields);if(params.selectedRecords){this.selection=params.selectedRecords;}
return this._super.apply(this,arguments);},_computeAggregates:function(){var self=this;var data=[];if(this.selection.length){utils.traverse_records(this.state,function(record){if(_.contains(self.selection,record.id)){data.push(record);}});}else{data=this.state.data;}
_.each(this.columns,this._computeColumnAggregates.bind(this,data));},_computeColumnAggregates:function(data,column){var attrs=column.attrs;var field=this.state.fields[attrs.name];if(!field){return;}
var type=field.type;if(type!=='integer'&&type!=='float'&&type!=='monetary'){return;}
var func=(attrs.sum&&'sum')||(attrs.avg&&'avg')||(attrs.max&&'max')||(attrs.min&&'min');if(func){var count=0;var aggregateValue=0;if(func==='max'){aggregateValue=-Infinity;}else if(func==='min'){aggregateValue=Infinity;}
_.each(data,function(d){var value=(d.type==='record')?d.data[attrs.name]:d.aggregateValues[attrs.name];if(Number(value)!==value){return;}
count+=1;if(func==='avg'){aggregateValue+=value;}else if(func==='sum'){aggregateValue+=value;}else if(func==='max'){aggregateValue=Math.max(aggregateValue,value);}else if(func==='min'){aggregateValue=Math.min(aggregateValue,value);}});if(func==='avg'){aggregateValue=count?aggregateValue/count:aggregateValue;}
if(count){column.aggregate={help:attrs[func],value:aggregateValue,};}else{delete column.aggregate;}}},_extractDecorationAttrs:function(node){const decorations={};for(const[key,expr]of Object.entries(node.attrs)){if(DECORATIONS.includes(key)){let cssClass;if(key==='decoration-bf'){cssClass='font-weight-bold';}else if(key==='decoration-it'){cssClass='font-italic';}else{cssClass=key.replace('decoration','text');}
decorations[cssClass]=py.parse(py.tokenize(expr));}}
return decorations;},_findConnectedCell:function($cell,direction,colIndex){var $connectedRow=$cell.closest('tr')[direction]('tr');if(!$connectedRow.length){var tbody=$cell.closest('tbody, thead');var $connectedGroup=tbody[direction]('tbody, thead');if($connectedGroup.length){var $connectedRows=$connectedGroup.find('tr');var rowIndex;if(direction==='prev'){rowIndex=$connectedRows.length-1;}else{rowIndex=0;}
$connectedRow=$connectedRows.eq(rowIndex);}else{return;}}
var $connectedCell;if($connectedRow.hasClass('o_group_header')){$connectedCell=$connectedRow.children();this.currentColIndex=colIndex;}else if($connectedRow.has('td.o_group_field_row_add').length){$connectedCell=$connectedRow.find('.o_group_field_row_add');this.currentColIndex=colIndex;}else{var connectedRowChildren=$connectedRow.children();if(colIndex===-1){colIndex=connectedRowChildren.length-1;}
$connectedCell=connectedRowChildren.eq(colIndex);}
return $connectedCell;},_getNumberOfCols:function(){var n=this.columns.length;return this.hasSelectors?n+1:n;},_getOptionalColumnsStorageKeyParts:function(){var self=this;return{fields:_.map(this.state.fieldsInfo[this.viewType],function(_,fieldName){return{name:fieldName,type:self.state.fields[fieldName].type};}),};},_getSelectableRecordCheckboxes:function(){return this.$('tbody .o_list_record_selector input:visible:not(:disabled)');},_groupAdjacentButtons:function(){const children=[];let groupId=0;let buttonGroupNode=null;for(const c of this.arch.children){if(c.tag==='button'){if(!buttonGroupNode){buttonGroupNode={tag:'button_group',children:[c],attrs:{name:`button_group_${groupId++}`,modifiers:{},},};children.push(buttonGroupNode);}else{buttonGroupNode.children.push(c);}}else{buttonGroupNode=null;children.push(c);}}
this.arch.children=children;},_preprocessColumns:function(){this._processModeClassNames();this._groupAdjacentButtons();this.arch.children.filter(c=>c.tag==='button_group').forEach(c=>{c.attrs.editOnly=c.children.every(n=>n.attrs.editOnly);c.attrs.readOnly=c.children.every(n=>n.attrs.readOnly);});},_processColumns:function(columnInvisibleFields){var self=this;this.handleField=null;this.columns=[];this.optionalColumns=[];this.optionalColumnsEnabled=[];var storedOptionalColumns;this.trigger_up('load_optional_fields',{keyParts:this._getOptionalColumnsStorageKeyParts(),callback:function(res){storedOptionalColumns=res;},});_.each(this.arch.children,function(c){if(c.tag!=='control'&&c.tag!=='groupby'&&c.tag!=='header'){var reject=c.attrs.modifiers.column_invisible;if(c.tag==="button_group"){reject=c.children.every(child=>columnInvisibleFields[child.attrs.name]);}else if(c.attrs.name in columnInvisibleFields){reject=columnInvisibleFields[c.attrs.name];}
if(!reject&&c.attrs.widget==='handle'){self.handleField=c.attrs.name;if(self.isGrouped){reject=true;}}
if(!reject&&c.attrs.optional){self.optionalColumns.push(c);var enabled;if(storedOptionalColumns===undefined){enabled=c.attrs.optional==='show';}else{enabled=_.contains(storedOptionalColumns,c.attrs.name);}
if(enabled){self.optionalColumnsEnabled.push(c.attrs.name);}
reject=!enabled;}
if(!reject){self.columns.push(c);}}});},_processModeClassNames:function(){this.arch.children.forEach(c=>{if(c.attrs.class){c.attrs.editOnly=/\boe_edit_only\b/.test(c.attrs.class);c.attrs.readOnly=/\boe_read_only\b/.test(c.attrs.class);}});},_renderAggregateCells:function(aggregateValues){var self=this;return _.map(this.columns,function(column){var $cell=$('<td>');if(config.isDebug()){$cell.addClass(column.attrs.name);}
if(column.attrs.editOnly){$cell.addClass('oe_edit_only');}
if(column.attrs.readOnly){$cell.addClass('oe_read_only');}
if(column.attrs.name in aggregateValues){var field=self.state.fields[column.attrs.name];var value=aggregateValues[column.attrs.name].value;var help=aggregateValues[column.attrs.name].help;var formatFunc=field_utils.format[column.attrs.widget];if(!formatFunc){formatFunc=field_utils.format[field.type];}
var formattedValue=formatFunc(value,field,{escape:true,digits:column.attrs.digits?JSON.parse(column.attrs.digits):undefined,});$cell.addClass('o_list_number').attr('title',help).html(formattedValue);}
return $cell;});},_renderBody:function(){var self=this;var $rows=this._renderRows();while($rows.length<4){$rows.push(self._renderEmptyRow());}
return $('<tbody>').append($rows);},_renderBodyCell:function(record,node,colIndex,options){var tdClassName='o_data_cell';if(node.tag==='button_group'){tdClassName+=' o_list_button';}else if(node.tag==='field'){tdClassName+=' o_field_cell';var typeClass=FIELD_CLASSES[this.state.fields[node.attrs.name].type];if(typeClass){tdClassName+=(' '+typeClass);}
if(node.attrs.widget){tdClassName+=(' o_'+node.attrs.widget+'_cell');}}
if(node.attrs.editOnly){tdClassName+=' oe_edit_only';}
if(node.attrs.readOnly){tdClassName+=' oe_read_only';}
var $td=$('<td>',{class:tdClassName,tabindex:-1});var modifiers=this._registerModifiers(node,record,$td,_.pick(options,'mode'));if(modifiers.invisible&&!(options&&options.renderInvisible)){return $td;}
if(node.tag==='button_group'){for(const buttonNode of node.children){if(!this.columnInvisibleFields[buttonNode.attrs.name]){$td.append(this._renderButton(record,buttonNode));}}
return $td;}else if(node.tag==='widget'){return $td.append(this._renderWidget(record,node));}
if(node.attrs.widget||(options&&options.renderWidgets)){var $el=this._renderFieldWidget(node,record,_.pick(options,'mode'));return $td.append($el);}
this._handleAttributes($td,node);this._setDecorationClasses($td,this.fieldDecorations[node.attrs.name],record);var name=node.attrs.name;var field=this.state.fields[name];var value=record.data[name];var formatter=field_utils.format[field.type];var formatOptions={escape:true,data:record.data,isPassword:'password'in node.attrs,digits:node.attrs.digits&&JSON.parse(node.attrs.digits),};var formattedValue=formatter(value,field,formatOptions);var title='';if(field.type!=='boolean'){title=formatter(value,field,_.extend(formatOptions,{escape:false}));}
return $td.html(formattedValue).attr('title',title).attr('name',name);},_renderButton:function(record,node){var self=this;var nodeWithoutWidth=Object.assign({},node);delete nodeWithoutWidth.attrs.width;let extraClass='';if(node.attrs.icon){const btnStyleRegex=/\bbtn-[a-z]+\b/;if(!btnStyleRegex.test(nodeWithoutWidth.attrs.class)){extraClass='btn-link o_icon_button';}}
var $button=viewUtils.renderButtonFromNode(nodeWithoutWidth,{extraClass:extraClass,});this._handleAttributes($button,node);this._registerModifiers(node,record,$button);if(record.res_id){const debouncedClick=_.debounce(()=>{self.trigger_up('button_clicked',{attrs:node.attrs,record:record,});},500,true);$button.on("click",(e)=>{e.stopPropagation();debouncedClick();});}else{if(node.attrs.options.warn){$button.on("click",function(e){e.stopPropagation();self.displayNotification({message:_t('Please click on the "save" button first'),type:'danger'});});}else{$button.prop('disabled',true);}}
return $button;},_renderEmptyRow:function(){var $td=$('<td>&nbsp;</td>').attr('colspan',this._getNumberOfCols());return $('<tr>').append($td);},_renderFooter:function(){var aggregates={};_.each(this.columns,function(column){if('aggregate'in column){aggregates[column.attrs.name]=column.aggregate;}});var $cells=this._renderAggregateCells(aggregates);if(this.hasSelectors){$cells.unshift($('<td>'));}
return $('<tfoot>').append($('<tr>').append($cells));},_renderGroupButton:function(list,node){var $button=viewUtils.renderButtonFromNode(node,{extraClass:node.attrs.icon?'o_icon_button':undefined,textAsTitle:!!node.attrs.icon,});this._handleAttributes($button,node);this._registerModifiers(node,list.groupData,$button);$button.on("click",this._onGroupButtonClicked.bind(this,list.groupData,node));$button.on("keydown",this._onGroupButtonKeydown.bind(this));return $button;},_renderGroupButtons:function(list,group){var self=this;var $buttons=$();if(list.value){group.arch.children.forEach(function(child){if(child.tag==='button'){$buttons=$buttons.add(self._renderGroupButton(list,child));}});}
return $buttons;},_renderGroupRow:function(group,groupLevel){var cells=[];const groupBy=this.state.groupedBy[groupLevel];const groupByFieldName=groupBy.split(':')[0];const groupByField=group.fields[groupByFieldName];const name=groupByField.type==="boolean"?(group.value===undefined?_t('Undefined'):group.value):(group.value===undefined||group.value===false?_t('Undefined'):group.value);var $th=$('<th>').addClass('o_group_name').attr('tabindex',-1).text(name+' ('+group.count+')');var $arrow=$('<span>').css('padding-left',2+(groupLevel*20)+'px').css('padding-right','5px').addClass('fa');if(group.count>0){$arrow.toggleClass('fa-caret-right',!group.isOpen).toggleClass('fa-caret-down',group.isOpen);}
$th.prepend($arrow);cells.push($th);var aggregateKeys=Object.keys(group.aggregateValues);var aggregateValues=_.mapObject(group.aggregateValues,function(value){return{value:value};});var aggregateCells=this._renderAggregateCells(aggregateValues);var firstAggregateIndex=_.findIndex(this.columns,function(column){return column.tag==='field'&&_.contains(aggregateKeys,column.attrs.name);});var colspanBeforeAggregate;if(firstAggregateIndex!==-1){colspanBeforeAggregate=firstAggregateIndex;var lastAggregateIndex=_.findLastIndex(this.columns,function(column){return column.tag==='field'&&_.contains(aggregateKeys,column.attrs.name);});cells=cells.concat(aggregateCells.slice(firstAggregateIndex,lastAggregateIndex+1));var colSpan=this.columns.length-1-lastAggregateIndex;if(colSpan>0){cells.push($('<th>').attr('colspan',colSpan));}}else{var colN=this.columns.length;colspanBeforeAggregate=colN>1?colN-1:1;if(colN>1){cells.push($('<th>'));}}
if(this.hasSelectors){colspanBeforeAggregate+=1;}
$th.attr('colspan',colspanBeforeAggregate);if(group.isOpen&&!group.groupedBy.length&&(group.count>group.data.length)){const lastCell=cells[cells.length-1][0];this._renderGroupPager(group,lastCell);}
if(group.isOpen&&this.groupbys[groupBy]){var $buttons=this._renderGroupButtons(group,this.groupbys[groupBy]);if($buttons.length){var $buttonSection=$('<div>',{class:'o_group_buttons',}).append($buttons);$th.append($buttonSection);}}
return $('<tr>').addClass('o_group_header').toggleClass('o_group_open',group.isOpen).toggleClass('o_group_has_content',group.count>0).data('group',group).append(cells);},_renderGroup:function(group,groupLevel){var self=this;if(group.groupedBy.length){return this._renderGroups(group.data,groupLevel+1);}else{var $records=_.map(group.data,function(record){return self._renderRow(record);});return[$('<tbody>').append($records)];}},_renderGroupPager:function(group,target){const currentMinimum=group.offset+1;const limit=group.limit;const size=group.count;if(!this._shouldRenderPager(currentMinimum,limit,size)){return;}
const pager=new ComponentWrapper(this,Pager,{currentMinimum,limit,size});const pagerMounting=pager.mount(target).then(()=>{pager.el.addEventListener('pager-changed',ev=>this._onPagerChanged(ev,group));pager.el.addEventListener('click',ev=>ev.stopPropagation());});this.defs.push(pagerMounting);this.pagers.push(pager);},_renderGroups:function(data,groupLevel){var self=this;groupLevel=groupLevel||0;var result=[];var $tbody=$('<tbody>');_.each(data,function(group){if(!$tbody){$tbody=$('<tbody>');}
$tbody.append(self._renderGroupRow(group,groupLevel));if(group.data.length){result.push($tbody);result=result.concat(self._renderGroup(group,groupLevel));$tbody=null;}});if($tbody){result.push($tbody);}
return result;},_renderHeader:function(){var $tr=$('<tr>').append(_.map(this.columns,this._renderHeaderCell.bind(this)));if(this.hasSelectors){$tr.prepend(this._renderSelector('th'));}
return $('<thead>').append($tr);},_renderHeaderCell:function(node){const{icon,name,string}=node.attrs;var order=this.state.orderedBy;var isNodeSorted=order[0]&&order[0].name===name;var field=this.state.fields[name];var $th=$('<th>');if(name){$th.attr('data-name',name);}else if(string){$th.attr('data-string',string);}else if(icon){$th.attr('data-icon',icon);}
if(node.attrs.editOnly){$th.addClass('oe_edit_only');}
if(node.attrs.readOnly){$th.addClass('oe_read_only');}
if(node.tag==='button_group'){$th.addClass('o_list_button');}
if(!field||node.attrs.nolabel==='1'){return $th;}
var description=string||field.string;if(node.attrs.widget){$th.addClass(' o_'+node.attrs.widget+'_cell');const FieldWidget=this.state.fieldsInfo.list[name].Widget;if(FieldWidget.prototype.noLabel){description='';}else if(FieldWidget.prototype.label){description=FieldWidget.prototype.label;}}
$th.text(description).attr('tabindex',-1).toggleClass('o-sort-down',isNodeSorted?!order[0].asc:false).toggleClass('o-sort-up',isNodeSorted?order[0].asc:false).addClass((field.sortable||this.state.fieldsInfo.list[name].options.allow_order||false)&&'o_column_sortable');if(isNodeSorted){$th.attr('aria-sort',order[0].asc?'ascending':'descending');}
if(field.type==='float'||field.type==='integer'||field.type==='monetary'){$th.addClass('o_list_number_th');}
if(config.isDebug()){var fieldDescr={field:field,name:name,string:description||name,record:this.state,attrs:_.extend({},node.attrs,this.state.fieldsInfo.list[name]),};this._addFieldTooltip(fieldDescr,$th);}else{$th.attr('title',description);}
return $th;},_renderRow:function(record){var self=this;var $cells=this.columns.map(function(node,index){return self._renderBodyCell(record,node,index,{mode:'readonly'});});var $tr=$('<tr/>',{class:'o_data_row'}).attr('data-id',record.id).append($cells);if(this.hasSelectors){$tr.prepend(this._renderSelector('td',!record.res_id));}
if(this.no_open&&this.mode==="readonly"){$tr.addClass('o_list_no_open');}
this._setDecorationClasses($tr,this.rowDecorations,record);return $tr;},_renderRows:function(){return this.state.data.map(this._renderRow.bind(this));},_renderOptionalColumnsDropdown:function(){var self=this;var $optionalColumnsDropdown=$('<div>',{class:'o_optional_columns text-center dropdown',});var $a=$("<a>",{'class':"dropdown-toggle text-dark o-no-caret",'href':"#",'role':"button",'data-toggle':"dropdown",'data-display':"static",'aria-expanded':false,'aria-label':_t('Optional columns'),});$a.appendTo($optionalColumnsDropdown);var direction=_t.database.parameters.direction;var dropdownMenuClass=direction==='rtl'?'dropdown-menu-left':'dropdown-menu-right';var $dropdown=$("<div>",{class:'dropdown-menu o_optional_columns_dropdown '+dropdownMenuClass,role:'menu',});this.optionalColumns.forEach(function(col){var txt=(col.attrs.string||self.state.fields[col.attrs.name].string)+
(config.isDebug()?(' ('+col.attrs.name+')'):'');var $checkbox=dom.renderCheckbox({text:txt,role:"menuitemcheckbox",prop:{name:col.attrs.name,checked:_.contains(self.optionalColumnsEnabled,col.attrs.name),}});$dropdown.append($("<div>",{class:"dropdown-item",}).append($checkbox));});$dropdown.appendTo($optionalColumnsDropdown);return $optionalColumnsDropdown;},_renderSelector:function(tag,disableInput){var $content=dom.renderCheckbox();if(disableInput){$content.find("input[type='checkbox']").prop('disabled',disableInput);}
return $('<'+tag+'>').addClass('o_list_record_selector').append($content);},async _renderView(){const oldPagers=this.pagers;let prom;let tableWrapper;if(this.state.count>0||!this.noContentHelp){this.pagers=[];const orderedBy=this.state.orderedBy;this.hasHandle=orderedBy.length===0||orderedBy[0].name===this.handleField;this._computeAggregates();const $table=$('<table class="o_list_table table table-sm table-hover table-striped"/>');$table.toggleClass('o_list_table_grouped',this.isGrouped);$table.toggleClass('o_list_table_ungrouped',!this.isGrouped);const defs=[];this.defs=defs;if(this.isGrouped){$table.append(this._renderHeader());$table.append(this._renderGroups(this.state.data));$table.append(this._renderFooter());}else{$table.append(this._renderHeader());$table.append(this._renderBody());$table.append(this._renderFooter());}
tableWrapper=Object.assign(document.createElement('div'),{className:'table-responsive',});tableWrapper.appendChild($table[0]);delete this.defs;prom=Promise.all(defs);}
await Promise.all([this._super.apply(this,arguments),prom]);this.el.innerHTML="";this.el.classList.remove('o_list_optional_columns');oldPagers.forEach(pager=>pager.destroy());if(tableWrapper){this.el.appendChild(tableWrapper);if(document.body.contains(this.el)){this.pagers.forEach(pager=>pager.on_attach_callback());}
if(this._shouldRenderOptionalColumnsDropdown()){this.el.classList.add('o_list_optional_columns');this.$('table').append($('<i class="o_optional_columns_dropdown_toggle fa fa-ellipsis-v"/>'));this.$el.append(this._renderOptionalColumnsDropdown());}
if(this.selection.length){const $checked_rows=this.$('tr').filter((i,el)=>this.selection.includes(el.dataset.id));$checked_rows.find('.o_list_record_selector input').prop('checked',true);if($checked_rows.length===this.$('.o_data_row').length){this.$('thead .o_list_record_selector input').prop('checked',true);}}}
if(!this._hasContent()&&!!this.noContentHelp){this._renderNoContentHelper();}},_setDecorationClasses:function($el,decorations,record){for(const[cssClass,expr]of Object.entries(decorations)){$el.toggleClass(cssClass,py.PY_isTrue(py.evaluate(expr,record.evalContext)));}},_shouldRenderPager:function(currentMinimum,limit,size){if(!limit||!size){return false;}
const maximum=Math.min(currentMinimum+limit-1,size);const singlePage=(1===currentMinimum)&&(maximum===size);return!singlePage;},_shouldRenderOptionalColumnsDropdown:function(){return this.optionalColumns.length;},_updateFooter:function(){this._computeAggregates();this.$('tfoot').replaceWith(this._renderFooter());},_updateSelection:function(){const previousSelection=JSON.stringify(this.selection);this.selection=[];var self=this;var $inputs=this._getSelectableRecordCheckboxes();var allChecked=$inputs.length>0;$inputs.each(function(index,input){if(input.checked){self.selection.push($(input).closest('tr').data('id'));}else{allChecked=false;}});this.$('thead .o_list_record_selector input').prop('checked',allChecked);if(JSON.stringify(this.selection)!==previousSelection){this.trigger_up('selection_changed',{allChecked,selection:this.selection});}
this._updateFooter();},_onGroupButtonClicked:function(record,node,ev){ev.stopPropagation();if(node.attrs.type==='edit'){this.trigger_up('group_edit_button_clicked',{record:record,});}else{this.trigger_up('button_clicked',{attrs:node.attrs,record:record,});}},_onGroupButtonKeydown:function(ev){if(ev.keyCode===$.ui.keyCode.ENTER){ev.stopPropagation();}},_onToggleOptionalColumn:function(ev){var self=this;ev.stopPropagation();ev.preventDefault();var input=ev.currentTarget.querySelector('input');var fieldIndex=this.optionalColumnsEnabled.indexOf(input.name);if(fieldIndex>=0){this.optionalColumnsEnabled.splice(fieldIndex,1);}else{this.optionalColumnsEnabled.push(input.name);}
this.trigger_up('save_optional_fields',{keyParts:this._getOptionalColumnsStorageKeyParts(),optionalColumnsEnabled:this.optionalColumnsEnabled,});this._processColumns(this.columnInvisibleFields);this._render().then(function(){self._onToggleOptionalColumnDropdown(ev);});},_onToggleOptionalColumnDropdown:function(ev){ev.stopPropagation();this.$('.o_optional_columns .dropdown-toggle').dropdown('toggle');var position=(this.$(".table-responsive").css('overflow')==="auto"?this.$el.width():this.$('table').width());var direction="left";if(_t.database.parameters.direction==='rtl'){position=position-this.$('.o_optional_columns .o_optional_columns_dropdown').width();direction="right";}
this.$('.o_optional_columns').css(direction,position);},_onKeyDown:function(ev){var $cell=$(ev.currentTarget);var $tr;var $futureCell;var colIndex;if(this.state.isSample){return;}
switch(ev.keyCode){case $.ui.keyCode.LEFT:ev.preventDefault();$tr=$cell.closest('tr');$tr.closest('tbody').addClass('o_keyboard_navigation');if($tr.hasClass('o_group_header')&&$tr.hasClass('o_group_open')){this._onToggleGroup(ev);}else{$futureCell=$cell.prev();}
break;case $.ui.keyCode.RIGHT:ev.preventDefault();$tr=$cell.closest('tr');$tr.closest('tbody').addClass('o_keyboard_navigation');if($tr.hasClass('o_group_header')&&!$tr.hasClass('o_group_open')){this._onToggleGroup(ev);}else{$futureCell=$cell.next();}
break;case $.ui.keyCode.UP:ev.preventDefault();$cell.closest('tbody').addClass('o_keyboard_navigation');colIndex=this.currentColIndex||$cell.index();$futureCell=this._findConnectedCell($cell,'prev',colIndex);if(!$futureCell){this.trigger_up('navigation_move',{direction:'up'});}
break;case $.ui.keyCode.DOWN:ev.preventDefault();$cell.closest('tbody').addClass('o_keyboard_navigation');colIndex=this.currentColIndex||$cell.index();$futureCell=this._findConnectedCell($cell,'next',colIndex);break;case $.ui.keyCode.ENTER:ev.preventDefault();$tr=$cell.closest('tr');if($tr.hasClass('o_group_header')){this._onToggleGroup(ev);}else{var id=$tr.data('id');if(id){this.trigger_up('open_record',{id:id,target:ev.target});}}
break;}
if($futureCell){var isInGroupHeader=$futureCell.closest('tr').hasClass('o_group_header');var $activables=!isInGroupHeader&&$futureCell.find(':focusable');if($activables.length){$activables[0].focus();}else{$futureCell.focus();}}},_onMouseDown:function(){$('.o_keyboard_navigation').removeClass('o_keyboard_navigation');},_onPagerChanged:async function(ev,group){ev.stopPropagation();const{currentMinimum,limit}=ev.detail;this.trigger_up('load',{id:group.id,limit:limit,offset:currentMinimum-1,on_success:reloadedGroup=>{Object.assign(group,reloadedGroup);this._render();},});},_onRowClicked:function(ev){if(!ev.target.closest('.o_list_record_selector')&&!$(ev.target).prop('special_click')&&!this.no_open){var id=$(ev.currentTarget).data('id');if(id){this.trigger_up('open_record',{id:id,target:ev.target});}}},_onSelectRecord:function(ev){ev.stopPropagation();this._updateSelection();},_onSortColumn:function(ev){var name=$(ev.currentTarget).data('name');this.trigger_up('toggle_column_order',{id:this.state.id,name:name});},_onToggleCheckbox:function(ev){const $recordSelector=$(ev.target).find('input[type=checkbox]:not(":disabled")');$recordSelector.prop('checked',!$recordSelector.prop("checked"));$recordSelector.change();},_onToggleGroup:function(ev){ev.preventDefault();var group=$(ev.currentTarget).closest('tr').data('group');if(group.count){this.trigger_up('toggle_group',{group:group,onSuccess:()=>{this._updateSelection();if(document.activeElement.tagName==='BODY'){var groupHeaders=$('tr.o_group_header:data("group")');var header=groupHeaders.filter(function(){return $(this).data('group').id===group.id;});header.find('.o_group_name').focus();}},});}},_onToggleSelection:function(ev){var checked=$(ev.currentTarget).prop('checked')||false;this.$('tbody .o_list_record_selector input:not(":disabled")').prop('checked',checked);this._updateSelection();},});__exports[Symbol.for("default")]=ListRenderer;return __exports;});odoo.define(`web.ListRenderer`,async function(require){return require('@web/legacy/js/views/list/list_renderer')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/list/list_view.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/list/list_view',async function(require){'use strict';let __exports={};const BasicView=require('web.BasicView');const core=require('web.core');const ListModel=require('web.ListModel');const ListRenderer=require('web.ListRenderer');const ListController=require('web.ListController');const pyUtils=require('web.py_utils');var _lt=core._lt;var ListView=BasicView.extend({accesskey:"l",display_name:_lt('List'),icon:'fa-list-ul',config:_.extend({},BasicView.prototype.config,{Model:ListModel,Renderer:ListRenderer,Controller:ListController,}),viewType:'list',init:function(viewInfo,params){var self=this;this._super.apply(this,arguments);var selectedRecords=[];var pyevalContext=py.dict.fromJSON(_.pick(params.context,function(value,key,object){return!_.isUndefined(value)})||{});var expandGroups=!!JSON.parse(pyUtils.py_eval(this.arch.attrs.expand||"0",{'context':pyevalContext}));this.groupbys={};this.headerButtons=[];this.arch.children.forEach(function(child){if(child.tag==='groupby'){self._extractGroup(child);}
if(child.tag==='header'){self._extractHeaderButtons(child);}});let editable=false;if((!this.arch.attrs.edit||!!JSON.parse(this.arch.attrs.edit))&&!params.readonly){editable=this.arch.attrs.editable;}
this.controllerParams.activeActions.export_xlsx=this.arch.attrs.export_xlsx?!!JSON.parse(this.arch.attrs.export_xlsx):true;this.controllerParams.editable=editable;this.controllerParams.hasActionMenus=params.hasActionMenus;this.controllerParams.headerButtons=this.headerButtons;this.controllerParams.toolbarActions=viewInfo.toolbar;this.controllerParams.mode='readonly';this.controllerParams.selectedRecords=selectedRecords;this.rendererParams.arch=this.arch;this.rendererParams.groupbys=this.groupbys;this.rendererParams.hasSelectors='hasSelectors'in params?params.hasSelectors:true;this.rendererParams.editable=editable;this.rendererParams.selectedRecords=selectedRecords;this.rendererParams.addCreateLine=false;this.rendererParams.addCreateLineInGroups=editable&&this.controllerParams.activeActions.create;this.rendererParams.isMultiEditable=this.arch.attrs.multi_edit&&!!JSON.parse(this.arch.attrs.multi_edit);this.modelParams.groupbys=this.groupbys;this.loadParams.limit=this.loadParams.limit||80;this.loadParams.openGroupByDefault=expandGroups;this.loadParams.type='list';var groupsLimit=parseInt(this.arch.attrs.groups_limit,10);this.loadParams.groupsLimit=groupsLimit||(expandGroups?10:80);},_extractGroup:function(node){var innerView=this.fields[node.attrs.name].views.groupby;this.groupbys[node.attrs.name]=this._processFieldsView(innerView,'groupby');},_extractHeaderButtons(node){node.children.forEach(child=>{if(child.tag==='button'&&!child.attrs.modifiers.invisible){this.headerButtons.push(child);}});},_extractParamsFromAction:function(action){var params=this._super.apply(this,arguments);var inDialog=action.target==='new';var inline=action.target==='inline';params.hasActionMenus=!inDialog&&!inline;return params;},_updateMVCParams:function(){this._super.apply(this,arguments);this.controllerParams.noLeaf=!!this.loadParams.context.group_by_no_leaf;},});__exports[Symbol.for("default")]=ListView;return __exports;});odoo.define(`web.ListView`,async function(require){return require('@web/legacy/js/views/list/list_view')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/qweb/qweb_view.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/qweb/qweb_view',async function(require){'use strict';let __exports={};const core=require('web.core');const AbstractView=require("@web/legacy/js/views/abstract_view")[Symbol.for("default")];const AbstractModel=require("@web/legacy/js/views/abstract_model")[Symbol.for("default")];const AbstractRenderer=require("@web/legacy/js/views/abstract_renderer")[Symbol.for("default")];const AbstractController=require("@web/legacy/js/views/abstract_controller")[Symbol.for("default")];const registry=require('web.view_registry');var _lt=core._lt;var Model=AbstractModel.extend({init:function(){this._super.apply(this,arguments);this._state={viewId:false,modelName:false,body:'',context:{},domain:[],};},_fetch:function(){var state=this._state;return this._rpc({model:state.modelName,method:'qweb_render_view',kwargs:{view_id:state.viewId,domain:state.domain,context:state.context}}).then(function(r){state.body=r;return state.viewId;});},__get:function(){return this._state;},__load:function(params){_.extend(this._state,_.pick(params,['viewId','modelName','domain','context']));return this._fetch();},__reload:function(_id,params){_.extend(this._state,_.pick(params,['domain','context']));return this._fetch();}});var Renderer=AbstractRenderer.extend({_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.html(self.state.body);});}});var Controller=AbstractController.extend({events:_.extend({},AbstractController.prototype.events,{'click [type="toggle"]':'_onLazyToggle','click [type="action"]':'_onActionClicked',}),init:function(){this._super.apply(this,arguments);},renderButtons:function($node){this.$buttons=$('<nav/>');if($node){$node.append(this.$buttons);}},_update:function(){var self=this;return this._super.apply(this,arguments).then(function(){var $cp_buttons=self.renderer.$('nav.o_qweb_cp_buttons');$cp_buttons.children().appendTo(self.$buttons.empty());$cp_buttons.remove();});},_onLazyToggle:function(e){var $target=$(e.target);var $t=$target.closest('[data-model]');if(!($target.hasClass('fa-caret-down')||$target.hasClass('fa-caret-right'))){$target=$t.find('.fa-caret-down, .fa-caret-right');}
var data=$t.data();if(this._fold($t)){$target.removeClass('fa-caret-down').addClass('fa-caret-right');return;}
var args=data.args||_.omit(data,'model','method','id');return this._rpc({model:data.model,method:data.method,args:data.id?[data.id]:undefined,kwargs:args}).then(function(s){return $(s);}).then(function($newcontent){$t.data('children',$newcontent).after($newcontent);$target.removeClass('fa-caret-right').addClass('fa-caret-down');});},_fold:function($el){var $children=$el.data('children');if(!$children){return false;}
var self=this;$children.each(function(_i,e){self._fold($(e));}).remove();$el.removeData('children');return true;}});var QWebView=AbstractView.extend({display_name:_lt('Freedom View'),icon:'fa-file-picture-o',viewType:'qweb',enableTimeRangeMenu:true,config:_.extend({},AbstractView.prototype.config,{Model:Model,Renderer:Renderer,Controller:Controller,}),init:function(viewInfo,params){this._super.apply(this,arguments);this.loadParams.viewId=viewInfo.view_id;}});registry.add('qweb',QWebView);__exports[Symbol.for("default")]={View:QWebView,Controller:Controller,Renderer:Renderer,Model:Model};return __exports;});odoo.define(`web.qweb`,async function(require){return require('@web/legacy/js/views/qweb/qweb_view')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/renderer_wrapper.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/renderer_wrapper',async function(require){'use strict';let __exports={};const{ComponentWrapper}=require('web.OwlCompatibility');class RendererWrapper extends ComponentWrapper{getLocalState(){}
setLocalState(){}
giveFocus(){}
resetLocalState(){}}
__exports[Symbol.for("default")]=RendererWrapper;return __exports;});odoo.define(`web.RendererWrapper`,async function(require){return require('@web/legacy/js/views/renderer_wrapper')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/sample_server.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/sample_server',async function(require){'use strict';let __exports={};const session=require('web.session');const utils=require('web.utils');const Registry=require('web.Registry');const viewUtils=require('web.viewUtils');class UnimplementedRouteError extends Error{}
function getSampleFromId(id,sampleTexts){return sampleTexts[(id-1)%sampleTexts.length];}
function fieldNameRegex(...terms){return new RegExp(`\\b((\\w+)?_)?(${terms.join('|')})(_(\\w+)?)?\\b`);}
const DESCRIPTION_REGEX=fieldNameRegex('description','label','title','subject','message');const EMAIL_REGEX=fieldNameRegex('email');const PHONE_REGEX=fieldNameRegex('phone');const URL_REGEX=fieldNameRegex('url');class SampleServer{constructor(modelName,fields){this.mainModel=modelName;this.data={};this.data[modelName]={fields,records:[],};for(const fieldName in fields){const field=fields[fieldName];if(['many2one','one2many','many2many'].includes(field.type)){this.data[field.relation]=this.data[field.relation]||{fields:{display_name:{type:'char'},id:{type:'integer'},color:{type:'integer'},},records:[],};}}
this.existingGroups=null;this.populated=false;this.existingGroupsPopulated=false;}
mockRpc(params){if(!(params.model in this.data)){throw new Error(`SampleServer: unknown model ${params.model}`);}
this._populateModels();switch(params.method||params.route){case'/web/dataset/search_read':return this._mockSearchReadController(params);case'web_read_group':return this._mockWebReadGroup(params);case'read_group':return this._mockReadGroup(params);case'read_progress_bar':return this._mockReadProgressBar(params);case'read':return this._mockRead(params);}
const method=params.method||params.route;const mockFunction=SampleServer.mockRegistry.get(`${params.model}/${method}`)||SampleServer.mockRegistry.get(method);if(mockFunction){return mockFunction.call(this,params);}
console.log(`SampleServer: unimplemented route "${params.method || params.route}"`);throw new SampleServer.UnimplementedRouteError();}
setExistingGroups(groups){this.existingGroups=groups;}
_aggregateFields(measures,records){const values={};for(const{fieldName,type}of measures){if(['float','integer','monetary'].includes(type)){if(records.length){let value=0;for(const record of records){value+=record[fieldName];}
values[fieldName]=this._sanitizeNumber(value);}else{values[fieldName]=null;}}
if(type==='many2one'){const ids=new Set(records.map(r=>r[fieldName]));values.fieldName=ids.size||null;}}
return values;}
_formatValue(value,options){if(!value){return false;}
const{type,interval,relation}=options;if(['date','datetime'].includes(type)){const fmt=SampleServer.FORMATS[interval];return moment(value).format(fmt);}else if(type==='many2one'){const rec=this.data[relation].records.find(({id})=>id===value);return[value,rec.display_name];}else{return value;}}
_generateFieldValue(modelName,fieldName,id){const field=this.data[modelName].fields[fieldName];switch(field.type){case"boolean":return fieldName==='active'?true:this._getRandomBool();case"char":case"text":if(["display_name","name"].includes(fieldName)){if(SampleServer.PEOPLE_MODELS.includes(modelName)){return getSampleFromId(id,SampleServer.SAMPLE_PEOPLE);}else if(modelName==='res.country'){return getSampleFromId(id,SampleServer.SAMPLE_COUNTRIES);}}
if(fieldName==='display_name'){return getSampleFromId(id,SampleServer.SAMPLE_TEXTS);}else if(["name","reference"].includes(fieldName)){return`REF${String(id).padStart(4, '0')}`;}else if(DESCRIPTION_REGEX.test(fieldName)){return getSampleFromId(id,SampleServer.SAMPLE_TEXTS);}else if(EMAIL_REGEX.test(fieldName)){const emailName=getSampleFromId(id,SampleServer.SAMPLE_PEOPLE).replace(/ /,".").toLowerCase();return`${emailName}@sample.demo`;}else if(PHONE_REGEX.test(fieldName)){return`+1 555 754 ${String(id).padStart(4, '0')}`;}else if(URL_REGEX.test(fieldName)){return`http://sample${id}.com`;}
return false;case"date":case"datetime":{const format=field.type==="date"?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss";return this._getRandomDate(format);}
case"float":return this._getRandomFloat(SampleServer.MAX_FLOAT);case"integer":{let max=SampleServer.MAX_INTEGER;if(fieldName.includes('color')){max=this._getRandomBool()?SampleServer.MAX_COLOR_INT:0;}
return this._getRandomInt(max);}
case"monetary":return this._getRandomInt(SampleServer.MAX_MONETARY);case"many2one":if(field.relation==='res.currency'){return session.company_currency_id;}
if(field.relation==='ir.attachment'){return false;}
return this._getRandomSubRecordId();case"one2many":case"many2many":{const ids=[this._getRandomSubRecordId(),this._getRandomSubRecordId()];return[...new Set(ids)];}
case"selection":{if(fieldName==='activity_exception_decoration'){return false;}
if(field.selection.length>0){return this._getRandomArrayEl(field.selection)[0];}
return false;}
default:return false;}}
_getRandomArrayEl(array){return array[Math.floor(Math.random()*array.length)];}
_getRandomBool(){return Math.random()<0.5;}
_getRandomDate(format){const delta=Math.floor((Math.random()-Math.random())*SampleServer.DATE_DELTA);return new moment().add(delta,"hour").format(format);}
_getRandomFloat(max){return this._sanitizeNumber(Math.random()*max);}
_getRandomInt(max){return Math.floor(Math.random()*max);}
_getRandomSubRecordId(){return Math.floor(Math.random()*SampleServer.SUB_RECORDSET_SIZE)+1;}
_mockRead(params){const model=this.data[params.model];const ids=params.args[0];const fieldNames=params.args[1];const records=[];for(const r of model.records){if(!ids.includes(r.id)){continue;}
const record={id:r.id};for(const fieldName of fieldNames){const field=model.fields[fieldName];if(!field){record[fieldName]=false;}else if(field.type==='many2one'){const relModel=this.data[field.relation];const relRecord=relModel.records.find(relR=>r[fieldName]===relR.id);record[fieldName]=relRecord?[relRecord.id,relRecord.display_name]:false;}else{record[fieldName]=r[fieldName];}}
records.push(record);}
return records;}
_mockReadGroup(params){const lazy='lazy'in params?params.lazy:true;const model=params.model;const fields=this.data[model].fields;const records=this.data[model].records;const normalizedGroupBys=[];let groupBy=[];if(params.groupBy.length){groupBy=lazy?[params.groupBy[0]]:params.groupBy;}
for(const groupBySpec of groupBy){let[fieldName,interval]=groupBySpec.split(':');interval=interval||'month';const{type,relation}=fields[fieldName];if(type){const gb={fieldName,type,interval,relation,alias:groupBySpec};normalizedGroupBys.push(gb);}}
const groups=utils.groupBy(records,(record)=>{const vals={};for(const gb of normalizedGroupBys){const{fieldName,type}=gb;let value;if(['date','datetime'].includes(type)){value=this._formatValue(record[fieldName],gb);}else{value=record[fieldName];}
vals[fieldName]=value;}
return JSON.stringify(vals);});const measures=[];for(const measureSpec of(params.fields||Object.keys(fields))){const[fieldName,aggregateFunction]=measureSpec.split(':');const{type}=fields[fieldName];if(!params.groupBy.includes(fieldName)&&type&&(type!=='many2one'||aggregateFunction!=='count_distinct')){measures.push({fieldName,type});}}
let result=[];for(const id in groups){const records=groups[id];const group={__domain:[]};let countKey=`__count`;if(normalizedGroupBys.length&&lazy){countKey=`${normalizedGroupBys[0].fieldName}_count`;}
group[countKey]=records.length;const firstElem=records[0];for(const gb of normalizedGroupBys){const{alias,fieldName}=gb;group[alias]=this._formatValue(firstElem[fieldName],gb);}
Object.assign(group,this._aggregateFields(measures,records));result.push(group);}
if(normalizedGroupBys.length>0){const{alias,interval,type}=normalizedGroupBys[0];result=utils.sortBy(result,(group)=>{const val=group[alias];if(['date','datetime'].includes(type)){return moment(val,SampleServer.FORMATS[interval]);}
return val;});}
return result;}
_mockReadProgressBar(params){const groupByFieldName=viewUtils.getGroupByField(params.kwargs.group_by);const progress_bar=params.kwargs.progress_bar;const groupByField=this.data[params.model].fields[groupByFieldName];const data={};for(const record of this.data[params.model].records){let groupByValue=record[groupByFieldName];if(groupByField.type==="many2one"){const relatedRecords=this.data[groupByField.relation].records;const relatedRecord=relatedRecords.find(r=>r.id===groupByValue);groupByValue=relatedRecord.display_name;}
if(!(groupByValue in data)){data[groupByValue]={};for(const key in progress_bar.colors){data[groupByValue][key]=0;}}
const fieldValue=record[progress_bar.field];if(fieldValue in data[groupByValue]){data[groupByValue][fieldValue]++;}}
return data;}
_mockSearchReadController(params){const model=this.data[params.model];const rawRecords=model.records.slice(0,SampleServer.SEARCH_READ_LIMIT);const records=this._mockRead({model:params.model,args:[rawRecords.map(r=>r.id),params.fields],});return{records,length:records.length};}
_mockWebReadGroup(params){let groups;if(this.existingGroups){this._tweakExistingGroups(params);groups=this.existingGroups;}else{groups=this._mockReadGroup(params);}
return{groups,length:groups.length,};}
_populateExistingGroups(params){if(!this.existingGroupsPopulated){const groups=this.existingGroups;this.groupsInfo=groups;const groupBy=params.groupBy[0];const groupByFieldName=viewUtils.getGroupByField(groupBy);const groupByField=this.data[params.model].fields[groupByFieldName];const values=groups.map(g=>{if(['date','datetime'].includes(groupByField.type)){return g.__range[groupByFieldName]?g.__range[groupByFieldName].from:false;}else{return g[groupBy];}});const groupedByM2O=groupByField.type==='many2one';if(groupedByM2O){this.data[groupByField.relation].records=values.map(v=>{return{id:v[0],display_name:v[1]};});}
for(const r of this.data[params.model].records){const value=getSampleFromId(r.id,values);r[groupByFieldName]=groupedByM2O?value[0]:value;}
this.existingGroupsPopulated=true;}}
_populateModels(){if(!this.populated){for(const modelName in this.data){const model=this.data[modelName];const fieldNames=Object.keys(model.fields).filter(f=>f!=='id');const size=modelName===this.mainModel?SampleServer.MAIN_RECORDSET_SIZE:SampleServer.SUB_RECORDSET_SIZE;for(let id=1;id<=size;id++){const record={id};for(const fieldName of fieldNames){record[fieldName]=this._generateFieldValue(modelName,fieldName,id);}
model.records.push(record);}}
this.populated=true;}}
_sanitizeNumber(value){return parseFloat(value.toFixed(SampleServer.FLOAT_PRECISION));}
_tweakExistingGroups(params){const groups=this.existingGroups;this._populateExistingGroups(params);const groupBy=params.groupBy[0];const groupByFieldName=viewUtils.getGroupByField(groupBy);const groupByField=this.data[params.model].fields[groupByFieldName];const records=this.data[params.model].records;for(const g of groups){let groupValue=g[groupBy];if(groupByField.type==='many2one'){groupValue=g[groupBy][0];}else if(['date','datetime'].includes(groupByField.type)){groupValue=g.__range[groupByFieldName]?g.__range[groupByFieldName].from:false;}
const recordsInGroup=records.filter(r=>r[groupByFieldName]===groupValue);g[`${groupByFieldName}_count`]=recordsInGroup.length;for(const field of params.fields){const fieldType=this.data[params.model].fields[field].type;if(['integer, float','monetary'].includes(fieldType)){g[field]=recordsInGroup.reduce((acc,r)=>acc+r[field],0);}}
g.__data={records:this._mockRead({model:params.model,args:[recordsInGroup.map(r=>r.id),params.fields],}),length:recordsInGroup.length,};}}}
SampleServer.FORMATS={hour:'HH[:00] DD MMM',day:'YYYY-MM-DD',week:'[W]ww YYYY',month:'MMMM YYYY',quarter:'[Q]Q YYYY',year:'Y',};SampleServer.DISPLAY_FORMATS=Object.assign({},SampleServer.FORMATS,{day:'DD MMM YYYY'});SampleServer.MAIN_RECORDSET_SIZE=16;SampleServer.SUB_RECORDSET_SIZE=5;SampleServer.SEARCH_READ_LIMIT=10;SampleServer.MAX_FLOAT=100;SampleServer.MAX_INTEGER=50;SampleServer.MAX_COLOR_INT=7;SampleServer.MAX_MONETARY=100000;SampleServer.DATE_DELTA=24*60;SampleServer.FLOAT_PRECISION=2;SampleServer.SAMPLE_COUNTRIES=["Belgium","France","Portugal","Singapore","Australia"];SampleServer.SAMPLE_PEOPLE=["John Miller","Henry Campbell","Carrie Helle","Wendi Baltz","Thomas Passot",];SampleServer.SAMPLE_TEXTS=["Laoreet id","Volutpat blandit","Integer vitae","Viverra nam","In massa",];SampleServer.PEOPLE_MODELS=['res.users','res.partner','hr.employee','mail.followers','mailing.contact'];SampleServer.UnimplementedRouteError=UnimplementedRouteError;SampleServer.mockRegistry=new Registry();__exports[Symbol.for("default")]=SampleServer;return __exports;});odoo.define(`web.SampleServer`,async function(require){return require('@web/legacy/js/views/sample_server')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/search_panel.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/search_panel',async function(require){'use strict';let __exports={};const{Model,useModel}=require("web.Model");const{Component,hooks}=owl;const{useState,useSubEnv}=hooks;class SearchPanel extends Component{setup(){useSubEnv({searchModel:this.props.searchModel});this.state=useState({active:{},expanded:{},});this.model=useModel("searchModel");this.scrollTop=0;this.hasImportedState=false;this.importState(this.props.importedState);}
async willStart(){this._expandDefaultValue();this._updateActiveValues();}
mounted(){this._updateGroupHeadersChecked();if(this.hasImportedState){this.el.scroll({top:this.scrollTop});}}
async willUpdateProps(){this._updateActiveValues();}
get sections(){return this.model.get("sections",s=>!s.empty);}
exportState(){const exported={expanded:this.state.expanded,scrollTop:this.el.scrollTop,};return JSON.stringify(exported);}
importState(stringifiedState){this.hasImportedState=Boolean(stringifiedState);if(this.hasImportedState){const state=JSON.parse(stringifiedState);this.state.expanded=state.expanded;this.scrollTop=state.scrollTop;}}
_expandDefaultValue(){if(this.hasImportedState){return;}
const categories=this.model.get("sections",s=>s.type==="category");for(const category of categories){this.state.expanded[category.id]={};if(category.activeValueId){const ancestorIds=this._getAncestorValueIds(category,category.activeValueId);for(const ancestorId of ancestorIds){this.state.expanded[category.id][ancestorId]=true;}}}}
_getAncestorValueIds(category,categoryValueId){const{parentId}=category.values.get(categoryValueId);return parentId?[...this._getAncestorValueIds(category,parentId),parentId]:[];}
async _toggleCategory(category,value){if(value.childrenIds.length){const categoryState=this.state.expanded[category.id];if(categoryState[value.id]&&category.activeValueId===value.id){delete categoryState[value.id];}else{categoryState[value.id]=true;}}
if(category.activeValueId!==value.id){this.state.active[category.id]=value.id;this.model.dispatch("toggleCategoryValue",category.id,value.id);}}
_toggleFilterGroup(filterId,{values}){const valueIds=[];const checked=[...values.values()].every((value)=>this.state.active[filterId][value.id]);values.forEach(({id})=>{valueIds.push(id);this.state.active[filterId][id]=!checked;});this.model.dispatch("toggleFilterValues",filterId,valueIds,!checked);}
_toggleFilterValue(filterId,valueId,{currentTarget}){this.state.active[filterId][valueId]=currentTarget.checked;this._updateGroupHeadersChecked();this.model.dispatch("toggleFilterValues",filterId,[valueId]);}
_updateActiveValues(){for(const section of this.model.get("sections")){if(section.type==="category"){this.state.active[section.id]=section.activeValueId;}else{this.state.active[section.id]={};if(section.groups){for(const group of section.groups.values()){for(const value of group.values.values()){this.state.active[section.id][value.id]=value.checked;}}}
if(section&&section.values){for(const value of section.values.values()){this.state.active[section.id][value.id]=value.checked;}}}}}
_updateGroupHeadersChecked(){const groups=this.el.querySelectorAll(":scope .o_search_panel_filter_group");for(const group of groups){const header=group.querySelector(":scope .o_search_panel_group_header input");const vals=[...group.querySelectorAll(":scope .o_search_panel_filter_value input")];header.checked=false;header.indeterminate=false;if(vals.every((v)=>v.checked)){header.checked=true;}else if(vals.some((v)=>v.checked)){header.indeterminate=true;}}}}
SearchPanel.modelExtension="SearchPanel";SearchPanel.props={className:{type:String,optional:1},importedState:{type:String,optional:1},searchModel:Model,};SearchPanel.template="web.Legacy.SearchPanel";__exports[Symbol.for("default")]=SearchPanel;return __exports;});odoo.define(`web.searchPanel`,async function(require){return require('@web/legacy/js/views/search_panel')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/search_panel_model_extension.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/search_panel_model_extension',async function(require){'use strict';let __exports={};const ActionModel=require("web.ActionModel");const{sortBy}=require("web.utils");const Domain=require("web.Domain");const pyUtils=require("web.py_utils");const DEFAULT_VIEW_TYPES=["kanban","tree"];const DEFAULT_LIMIT=200;let nextSectionId=1;function hasDomain(filter){return filter.domain!=="[]";}
function hasValues({errorMsg,groups,type,values}){if(errorMsg){return true;}else if(groups){return[...groups.values()].some((g)=>g.values.size);}else if(type==="category"){return values&&values.size>1;}else{return values&&values.size>0;}}
function serialiseMap(map){return[...map].map(([key,val])=>[key,Object.assign({},val)]);}
class SearchPanelModelExtension extends ActionModel.Extension{constructor(){super(...arguments);this.categoriesToLoad=[];this.defaultValues={};this.filtersToLoad=[];this.initialStateImport=false;this.searchDomain=[];for(const key in this.config.context){const match=/^searchpanel_default_(.*)$/.exec(key);if(match){this.defaultValues[match[1]]=this.config.context[key];}}}
async callLoad(params){const searchDomain=this._getExternalDomain();params.searchDomainChanged=(JSON.stringify(this.searchDomain)!==JSON.stringify(searchDomain));if(!this.shouldLoad&&!this.initialStateImport){const isFetchable=(section)=>section.enableCounters||(params.searchDomainChanged&&!section.expand);this.categoriesToLoad=this.categories.filter(isFetchable);this.filtersToLoad=this.filters.filter(isFetchable);this.shouldLoad=params.searchDomainChanged||Boolean(this.categoriesToLoad.length+this.filtersToLoad.length);}
this.searchDomain=searchDomain;this.initialStateImport=false;await super.callLoad(params);}
exportState(){const state=Object.assign({},super.exportState());state.sections=serialiseMap(state.sections);for(const[id,section]of state.sections){section.values=serialiseMap(section.values);if(section.groups){section.groups=serialiseMap(section.groups);for(const[id,group]of section.groups){group.values=serialiseMap(group.values);}}}
return state;}
get(property,...args){switch(property){case"domain":return this.getDomain();case"sections":return this.getSections(...args);}}
importState(importedState){this.initialStateImport=Boolean(importedState&&!this.state.sections);super.importState(...arguments);if(importedState){this.state.sections=new Map(this.state.sections);for(const section of this.state.sections.values()){section.values=new Map(section.values);if(section.groups){section.groups=new Map(section.groups);for(const group of section.groups.values()){group.values=new Map(group.values);}}}}}
async isReady(){await this.sectionsPromise;}
async load(params){this.sectionsPromise=this._fetchSections(params.isInitialLoad);if(this._shouldWaitForData(params)){await this.sectionsPromise;}}
prepareState(){Object.assign(this.state,{sections:new Map()});this._createSectionsFromArch();}
getDomain(){return Domain.prototype.normalizeArray([...this._getCategoryDomain(),...this._getFilterDomain(),]);}
getSections(predicate){let sections=[...this.state.sections.values()].map((section)=>Object.assign({},section,{empty:!hasValues(section)}));if(predicate){sections=sections.filter(predicate);}
return sections.sort((s1,s2)=>s1.index-s2.index);}
toggleCategoryValue(sectionId,valueId){const category=this.state.sections.get(sectionId);category.activeValueId=valueId;}
toggleFilterValues(sectionId,valueIds,forceTo=null){const section=this.state.sections.get(sectionId);for(const valueId of valueIds){const value=section.values.get(valueId);value.checked=forceTo===null?!value.checked:forceTo;}}
get categories(){return[...this.state.sections.values()].filter(s=>s.type==="category");}
get filters(){return[...this.state.sections.values()].filter(s=>s.type==="filter");}
_applyDefaultFilterValues(){for(const{fieldName,values}of this.filters){const defaultValues=this.defaultValues[fieldName]||[];for(const valueId of defaultValues){const value=values.get(valueId);if(value){value.checked=true;}}}}
_createCategoryTree(sectionId,result){const category=this.state.sections.get(sectionId);let{error_msg,parent_field:parentField,values,}=result;if(error_msg){category.errorMsg=error_msg;values=[];}
if(category.hierarchize){category.parentField=parentField;}
for(const value of values){category.values.set(value.id,Object.assign({},value,{childrenIds:[],parentId:value[parentField]||false,}));}
for(const value of values){const{parentId}=category.values.get(value.id);if(parentId&&category.values.has(parentId)){category.values.get(parentId).childrenIds.push(value.id);}}
category.rootIds=[false];for(const value of values){const{parentId}=category.values.get(value.id);if(!parentId){category.rootIds.push(value.id);}}
const valueIds=[false,...values.map((val)=>val.id)];this._ensureCategoryValue(category,valueIds);}
_createFilterTree(sectionId,result){const filter=this.state.sections.get(sectionId);let{error_msg,values,}=result;if(error_msg){filter.errorMsg=error_msg;values=[];}
values.forEach((value)=>{const oldValue=filter.values.get(value.id);value.checked=oldValue?oldValue.checked:false;});filter.values=new Map();const groupIds=[];if(filter.groupBy){const groups=new Map();for(const value of values){const groupId=value.group_id;if(!groups.has(groupId)){if(groupId){groupIds.push(groupId);}
groups.set(groupId,{id:groupId,name:value.group_name,values:new Map(),tooltip:value.group_tooltip,sequence:value.group_sequence,hex_color:value.group_hex_color,});const oldGroup=filter.groups&&filter.groups.get(groupId);groups.get(groupId).state=(oldGroup&&oldGroup.state)||false;}
groups.get(groupId).values.set(value.id,value);}
filter.groups=groups;filter.sortedGroupIds=sortBy(groupIds,(id)=>groups.get(id).sequence||groups.get(id).name);for(const group of filter.groups.values()){for(const[valueId,value]of group.values){filter.values.set(valueId,value);}}}else{for(const value of values){filter.values.set(value.id,value);}}}
_createSectionsFromArch(){let hasCategoryWithCounters=false;let hasFilterWithDomain=false;this.config.archNodes.forEach(({attrs,tag},index)=>{if(tag!=="field"||attrs.invisible==="1"){return;}
const type=attrs.select==="multi"?"filter":"category";const section={color:attrs.color,description:attrs.string||this.config.fields[attrs.name].string,enableCounters:!!pyUtils.py_eval(attrs.enable_counters||"0"),expand:!!pyUtils.py_eval(attrs.expand||"0"),fieldName:attrs.name,icon:attrs.icon,id:nextSectionId++,index,limit:pyUtils.py_eval(attrs.limit||String(DEFAULT_LIMIT)),type,values:new Map(),};if(type==="category"){section.activeValueId=this.defaultValues[attrs.name];section.icon=section.icon||"fa-folder";section.hierarchize=!!pyUtils.py_eval(attrs.hierarchize||"1");section.values.set(false,{childrenIds:[],display_name:this.env._t("All"),id:false,bold:true,parentId:false,});hasCategoryWithCounters=hasCategoryWithCounters||section.enableCounters;}else{section.domain=attrs.domain||"[]";section.groupBy=attrs.groupby;section.icon=section.icon||"fa-filter";hasFilterWithDomain=hasFilterWithDomain||section.domain!=="[]";}
this.state.sections.set(section.id,section);});if(hasCategoryWithCounters&&hasFilterWithDomain){for(const category of this.categories){category.enableCounters=false;}
console.warn("Warning: categories with counters are incompatible with filters having a domain attribute.","All category counters have been disabled to avoid inconsistencies.",);}}
_ensureCategoryValue(category,valueIds){if(!valueIds.includes(category.activeValueId)){category.activeValueId=valueIds[0];}}
async _fetchCategories(categories){const filterDomain=this._getFilterDomain();await Promise.all(categories.map(async(category)=>{const result=await this.env.services.rpc({method:"search_panel_select_range",model:this.config.modelName,args:[category.fieldName],kwargs:{category_domain:this._getCategoryDomain(category.id),enable_counters:category.enableCounters,expand:category.expand,filter_domain:filterDomain,hierarchize:category.hierarchize,limit:category.limit,search_domain:this.searchDomain,},params:{context:this.config.context,},});this._createCategoryTree(category.id,result);}));}
async _fetchFilters(filters){const evalContext={};for(const category of this.categories){evalContext[category.fieldName]=category.activeValueId;}
const categoryDomain=this._getCategoryDomain();await Promise.all(filters.map(async(filter)=>{const result=await this.env.services.rpc({method:"search_panel_select_multi_range",model:this.config.modelName,args:[filter.fieldName],kwargs:{category_domain:categoryDomain,comodel_domain:Domain.prototype.stringToArray(filter.domain,evalContext),enable_counters:filter.enableCounters,filter_domain:this._getFilterDomain(filter.id),expand:filter.expand,group_by:filter.groupBy||false,group_domain:this._getGroupDomain(filter),limit:filter.limit,search_domain:this.searchDomain,},params:{context:this.config.context,},});this._createFilterTree(filter.id,result);}));}
async _fetchSections(isInitialLoad){await this._fetchCategories(isInitialLoad?this.categories:this.categoriesToLoad);await this._fetchFilters(isInitialLoad?this.filters:this.filtersToLoad);if(isInitialLoad){this._applyDefaultFilterValues();}}
_getCategoryDomain(excludedCategoryId){const domain=[];for(const category of this.categories){if(category.id===excludedCategoryId||!category.activeValueId){continue;}
const field=this.config.fields[category.fieldName];const operator=field.type==="many2one"&&category.parentField?"child_of":"=";domain.push([category.fieldName,operator,category.activeValueId,]);}
return domain;}
_getExternalDomain(){const domains=this.config.get("domain");const domain=domains.reduce((acc,dom)=>[...acc,...dom],[]);return Domain.prototype.normalizeArray(domain);}
_getFilterDomain(excludedFilterId){const domain=[];function addCondition(fieldName,valueMap){const ids=[];for(const[valueId,value]of valueMap){if(value.checked){ids.push(valueId);}}
if(ids.length){domain.push([fieldName,"in",ids]);}}
for(const filter of this.filters){if(filter.id===excludedFilterId){continue;}
const{fieldName,groups,values}=filter;if(groups){for(const group of groups.values()){addCondition(fieldName,group.values);}}else{addCondition(fieldName,values);}}
return domain;}
_getGroupDomain(filter){const{fieldName,groups,enableCounters}=filter;const{type:fieldType}=this.config.fields[fieldName];if(!enableCounters||!groups){return{many2one:[],many2many:{},}[fieldType];}
let groupDomain=null;if(fieldType==="many2one"){for(const group of groups.values()){const valueIds=[];let active=false;for(const[valueId,value]of group.values){const{checked}=value;valueIds.push(valueId);if(checked){active=true;}}
if(active){if(groupDomain){groupDomain=[[0,"=",1]];break;}else{groupDomain=[[fieldName,"in",valueIds]];}}}}else if(fieldType==="many2many"){const checkedValueIds=new Map();groups.forEach(({values},groupId)=>{values.forEach(({checked},valueId)=>{if(checked){if(!checkedValueIds.has(groupId)){checkedValueIds.set(groupId,[]);}
checkedValueIds.get(groupId).push(valueId);}});});groupDomain={};for(const[gId,ids]of checkedValueIds.entries()){for(const groupId of groups.keys()){if(gId!==groupId){const key=JSON.stringify(groupId);if(!groupDomain[key]){groupDomain[key]=[];}
groupDomain[key].push([fieldName,"in",ids]);}}}}
return groupDomain;}
_shouldWaitForData({isInitialLoad,searchDomainChanged}){if(isInitialLoad&&Object.keys(this.defaultValues).length){return true;}
if(this.categories.length&&this.filters.some(hasDomain)){return true;}
if(!this.searchDomain.length){return false;}
return[...this.state.sections.values()].some((section)=>!section.expand&&searchDomainChanged);}
static extractArchInfo(archs,viewType){const{children}=archs.search;const spNode=children.find(c=>c.tag==="searchpanel");const isObject=(obj)=>typeof obj==="object"&&obj!==null;if(spNode){const actualType=viewType==="list"?"tree":viewType;const{view_types}=spNode.attrs;const viewTypes=view_types?view_types.split(","):DEFAULT_VIEW_TYPES;if(viewTypes.includes(actualType)){return{attrs:spNode.attrs,children:spNode.children.filter(isObject),};}}
return null;}}
SearchPanelModelExtension.layer=1;ActionModel.registry.add("SearchPanel",SearchPanelModelExtension,30);__exports[Symbol.for("default")]=SearchPanelModelExtension;return __exports;});odoo.define(`web.searchPanelModelExtension`,async function(require){return require('@web/legacy/js/views/search_panel_model_extension')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/select_create_controllers_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.select_create_controllers_registry',function(require){"use strict";return{};});odoo.define('web._select_create_controllers_registry',function(require){"use strict";var KanbanController=require('web.KanbanController');var ListController=require('web.ListController');var select_create_controllers_registry=require('web.select_create_controllers_registry');var SelectCreateKanbanController=KanbanController.extend({_onOpenRecord:function(ev){var selectedRecord=this.model.get(ev.data.id);this.trigger_up('select_record',{id:selectedRecord.res_id,display_name:selectedRecord.data.display_name,});},});var SelectCreateListController=ListController.extend({_onOpenRecord:function(ev){var selectedRecord=this.model.get(ev.data.id);this.trigger_up('select_record',{id:selectedRecord.res_id,display_name:selectedRecord.data.display_name,});},});_.extend(select_create_controllers_registry,{SelectCreateListController:SelectCreateListController,SelectCreateKanbanController:SelectCreateKanbanController,});});;

/* /web/static/src/legacy/js/views/signature_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/signature_dialog',async function(require){'use strict';let __exports={};const core=require('web.core');const Dialog=require('web.Dialog');const{NameAndSignature}=require('web.name_and_signature');var _t=core._t;var SignatureDialog=Dialog.extend({template:'web.signature_dialog',xmlDependencies:Dialog.prototype.xmlDependencies.concat(['/web/static/src/legacy/xml/name_and_signature.xml']),custom_events:{'signature_changed':'_onChangeSignature',},init:function(parent,options){var self=this;options=options||{};options.title=options.title||_t("Adopt Your Signature");options.size=options.size||'medium';options.technical=false;if(!options.buttons){options.buttons=[];options.buttons.push({text:_t("Adopt and Sign"),classes:"btn-primary",disabled:true,click:function(e){self._onConfirm();}});options.buttons.push({text:_t("Cancel"),close:true});}
this._super(parent,options);this.nameAndSignature=new NameAndSignature(this,options.nameAndSignatureOptions);},willStart:function(){return Promise.all([this.nameAndSignature.appendTo($('<div>')),this._super.apply(this,arguments)]);},start:function(){var self=this;this.$primaryButton=this.$footer.find('.btn-primary');this.opened().then(function(){self.$('.o_web_sign_name_and_signature').replaceWith(self.nameAndSignature.$el);self.nameAndSignature.resetSignature();});return this._super.apply(this,arguments);},isSignatureEmpty:function(){return this.nameAndSignature.isSignatureEmpty();},_onChangeSignature:function(){var isEmpty=this.nameAndSignature.isSignatureEmpty();this.$primaryButton.prop('disabled',isEmpty);},_onConfirm:function(fct){this.trigger_up('upload_signature',{name:this.nameAndSignature.getName(),signatureImage:this.nameAndSignature.getSignatureImage(),});},});__exports[Symbol.for("default")]=SignatureDialog;return __exports;});odoo.define(`web.signature_dialog`,async function(require){return require('@web/legacy/js/views/signature_dialog')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/standalone_field_manager_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/standalone_field_manager_mixin',async function(require){'use strict';let __exports={};const FieldManagerMixin=require('web.FieldManagerMixin');var StandaloneFieldManagerMixin=_.extend({},FieldManagerMixin,{init:function(){FieldManagerMixin.init.apply(this,arguments);this.registeredWidgets={};},_confirmChange:function(id,fields,event){var result=FieldManagerMixin._confirmChange.apply(this,arguments);var record=this.model.get(id);_.each(this.registeredWidgets[id],function(widget,fieldName){if(_.contains(fields,fieldName)){widget.reset(record,event);}});return result;},_registerWidget:function(datapointID,fieldName,widget){if(!this.registeredWidgets[datapointID]){this.registeredWidgets[datapointID]={};}
this.registeredWidgets[datapointID][fieldName]=widget;},});__exports[Symbol.for("default")]=StandaloneFieldManagerMixin;return __exports;});odoo.define(`web.StandaloneFieldManagerMixin`,async function(require){return require('@web/legacy/js/views/standalone_field_manager_mixin')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/view_dialogs.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/view_dialogs',async function(require){'use strict';let __exports={};const config=require('web.config');const core=require('web.core');const Dialog=require('web.Dialog');const dom=require('web.dom');const view_registry=require('web.view_registry');const select_create_controllers_registry=require('web.select_create_controllers_registry');var _t=core._t;var ViewDialog=Dialog.extend({custom_events:_.extend({},Dialog.prototype.custom_events,{push_state:'_onPushState',}),init:function(parent,options){options=options||{};options.fullscreen=config.device.isMobile;options.dialogClass=options.dialogClass||''+' o_act_window';this._super(parent,$.extend(true,{},options));this.res_model=options.res_model||null;this.domain=options.domain||[];this.context=options.context||{};this.options=_.extend(this.options||{},options||{});},_onPushState:function(event){event.stopPropagation();},});var FormViewDialog=ViewDialog.extend({init:function(parent,options){var self=this;options=options||{};this.res_id=options.res_id||null;this.on_saved=options.on_saved||(function(){});this.on_remove=options.on_remove||(function(){});this.context=options.context;this._createContext=options._createContext;this.model=options.model;this.parentID=options.parentID;this.recordID=options.recordID;this.shouldSaveLocally=options.shouldSaveLocally;this.readonly=options.readonly;this.deletable=options.deletable;this.editable=options.editable;this.disable_multiple_selection=options.disable_multiple_selection;var oBtnRemove='o_btn_remove';var multi_select=!_.isNumber(options.res_id)&&!options.disable_multiple_selection;var readonly=_.isNumber(options.res_id)&&options.readonly;if(!options.buttons){options.buttons=[{text:options.close_text||(readonly?_t("Close"):_t("Discard")),classes:"btn-secondary o_form_button_cancel",close:true,click:function(){if(!readonly){self.form_view.model.discardChanges(self.form_view.handle,{rollback:self.shouldSaveLocally,});}},}];if(!readonly){options.buttons.unshift({text:options.save_text||(multi_select?_t("Save & Close"):_t("Save")),classes:"btn-primary",click:function(){self._save().then(self.close.bind(self));}});if(multi_select){options.buttons.splice(1,0,{text:_t("Save & New"),classes:"btn-primary",click:function(){self._save().then(function(){const additionalContext=self._createContext&&self._createContext(false);self.form_view.createRecord(self.parentID,additionalContext);}).then(function(){if(!self.deletable){return;}
self.deletable=false;self.buttons=self.buttons.filter(function(button){return button.classes.split(' ').indexOf(oBtnRemove)<0;});self.set_buttons(self.buttons);self.set_title(_t("Create ")+_.str.strRight(self.title,_t("Open: ")));});},});}
var multi=options.disable_multiple_selection;if(!multi&&this.deletable){this._setRemoveButtonOption(options,oBtnRemove);}}}
this._super(parent,options);},open:function(){var self=this;var _super=this._super.bind(this);var FormView=view_registry.get('form');var fields_view_def;if(this.options.fields_view){fields_view_def=Promise.resolve(this.options.fields_view);}else{fields_view_def=this.loadFieldView(this.res_model,this.context,this.options.view_id,'form');}
fields_view_def.then(function(viewInfo){var refinedContext=_.pick(self.context,function(value,key){return key.indexOf('_view_ref')===-1;});var formview=new FormView(viewInfo,{modelName:self.res_model,context:refinedContext,ids:self.res_id?[self.res_id]:[],currentId:self.res_id||undefined,index:0,mode:self.res_id&&self.options.readonly?'readonly':'edit',footerToButtons:true,default_buttons:false,withControlPanel:false,model:self.model,parentID:self.parentID,recordID:self.recordID,isFromFormViewDialog:true,editable:self.editable});return formview.getController(self);}).then(function(formView){self.form_view=formView;var fragment=document.createDocumentFragment();if(self.recordID&&self.shouldSaveLocally){self.model.save(self.recordID,{savePoint:true});}
return self.form_view.appendTo(fragment).then(function(){self.opened().then(function(){var $buttons=$('<div>');self.form_view.renderButtons($buttons);if($buttons.children().length){self.$footer.empty().append($buttons.contents());}
dom.append(self.$el,fragment,{callbacks:[{widget:self.form_view}],in_DOM:true,});self.form_view.updateButtons();self.trigger_up('dialog_form_loaded');});return _super();});});return this;},_focusOnClose:function(){var isFocusSet=false;this.trigger_up('form_dialog_discarded',{callback:function(isFocused){isFocusSet=isFocused;},});return isFocusSet;},_remove:function(){return Promise.resolve(this.on_remove());},_save:function(){var self=this;return this.form_view.saveRecord(this.form_view.handle,{stayInEdit:true,reload:false,savePoint:this.shouldSaveLocally,viewType:'form',}).then(function(changedFields){var record=self.form_view.model.get(self.form_view.handle);return self.on_saved(record,!!changedFields.length);});},_setRemoveButtonOption(options,btnClasses){const self=this;options.buttons.push({text:_t("Remove"),classes:'btn-secondary '+btnClasses,click:function(){self._remove().then(self.close.bind(self));}});},});var SelectCreateDialog=ViewDialog.extend({custom_events:_.extend({},ViewDialog.prototype.custom_events,{select_record:function(event){if(!this.options.readonly){this.on_selected([event.data]);this.close();}},selection_changed:function(event){event.stopPropagation();this.$footer.find(".o_select_button").prop('disabled',!event.data.selection.length);},}),init:function(){this._super.apply(this,arguments);_.defaults(this.options,{initial_view:'search'});this.on_selected=this.options.on_selected||(function(){});this.on_closed=this.options.on_closed||(function(){});this.initialIDs=this.options.initial_ids;this.viewType='list';},open:function(){if(this.options.initial_view!=="search"){return this.create_edit_record();}
var self=this;var _super=this._super.bind(this);var viewRefID=this.viewType==='kanban'?(this.options.kanban_view_ref&&JSON.parse(this.options.kanban_view_ref)||false):false;const searchviewId=this.options.searchViewId||false;return this.loadViews(this.res_model,this.context,[[viewRefID,this.viewType],[searchviewId,'search']],{load_filters:true}).then(this.setup.bind(this)).then(function(fragment){self.opened().then(function(){dom.append(self.$el,fragment,{callbacks:[{widget:self.viewController}],in_DOM:true,});self.set_buttons(self.__buttons);});return _super();});},setup:function(fieldsViews){var self=this;var fragment=document.createDocumentFragment();var domain=this.domain;if(this.initialIDs){domain=domain.concat([['id','in',this.initialIDs]]);}
var ViewClass=view_registry.get(this.viewType);var viewOptions={};var selectCreateController;if(this.viewType==='list'){_.extend(viewOptions,{hasSelectors:!this.options.disable_multiple_selection,readonly:true,},this.options.list_view_options);selectCreateController=select_create_controllers_registry.SelectCreateListController;}
if(this.viewType==='kanban'){_.extend(viewOptions,{noDefaultGroupby:true,selectionMode:this.options.selectionMode||false,});selectCreateController=select_create_controllers_registry.SelectCreateKanbanController;}
var view=new ViewClass(fieldsViews[this.viewType],_.extend(viewOptions,{action:{controlPanelFieldsView:fieldsViews.search,help:_.str.sprintf("<p>%s</p>",_t("No records found!")),},action_buttons:false,dynamicFilters:this.options.dynamicFilters,context:this.context,domain:domain,modelName:this.res_model,withBreadcrumbs:false,withSearchPanel:false,}));view.setController(selectCreateController);return view.getController(this).then(function(controller){self.viewController=controller;self._prepareButtons();return self.viewController.appendTo(fragment);}).then(function(){return fragment;});},close:function(){this._super.apply(this,arguments);this.on_closed();},create_edit_record:function(){var self=this;var dialog=new FormViewDialog(this,_.extend({},this.options,{on_saved:function(record){var values=[{id:record.res_id,display_name:record.data.display_name||record.data.name,}];self.on_selected(values);},})).open();dialog.on('closed',this,this.close);return dialog;},_focusOnClose:function(){var isFocusSet=false;this.trigger_up('form_dialog_discarded',{callback:function(isFocused){isFocusSet=isFocused;},});return isFocusSet;},_prepareButtons:function(){this.__buttons=[{text:_t("Cancel"),classes:'btn-secondary o_form_button_cancel',close:true,}];if(!this.options.no_create){this.__buttons.unshift({text:_t("Create"),classes:'btn-primary',click:this.create_edit_record.bind(this)});}
if(!this.options.disable_multiple_selection){this.__buttons.unshift({text:_t("Select"),classes:'btn-primary o_select_button',disabled:true,close:true,click:async()=>{const resIds=await this.viewController.getSelectedIdsWithDomain();const values=resIds.map(e=>({id:e}));this.on_selected(values);},});}},});__exports[Symbol.for("default")]={FormViewDialog:FormViewDialog,SelectCreateDialog:SelectCreateDialog,};return __exports;});odoo.define(`web.view_dialogs`,async function(require){return require('@web/legacy/js/views/view_dialogs')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/views/view_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.view_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});odoo.define('web._view_registry',function(require){"use strict";var FormView=require('web.FormView');var KanbanView=require('web.KanbanView');var ListView=require('web.ListView');var CalendarView=require('web.CalendarView');var view_registry=require('web.view_registry');view_registry.add('form',FormView).add('list',ListView).add('kanban',KanbanView).add('calendar',CalendarView);});;

/* /web/static/src/legacy/js/views/view_utils.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/views/view_utils',async function(require){'use strict';let __exports={};const dom=require('web.dom');const utils=require('web.utils');var viewUtils={getGroupByField:function(groupedBy){return groupedBy&&groupedBy.split(':')[0];},getGroupValue:function(group,groupByField){var groupedByField=group.fields[groupByField];switch(groupedByField.type){case'many2one':return group.res_id||false;case'selection':var descriptor=_.find(groupedByField.selection,function(option){return option[1]===group.value;});return descriptor&&descriptor[0];case'char':case'boolean':return group.value;case'date':case'datetime':const[format,granularity]=groupedByField.type==='date'?["YYYY-MM-DD",'day']:["YYYY-MM-DD HH:mm:ss",'second'];return group.range[groupByField]?moment.utc(group.range[groupByField].to).subtract(1,granularity).format(format):false;default:return false;}},isQuickCreateEnabled:function(list){var groupByField=list.groupedBy[0]&&viewUtils.getGroupByField(list.groupedBy[0]);if(!groupByField){return false;}
var dateTypes=['date','datetime'];if(!list.fields[groupByField].readonly&&_.contains(dateTypes,list.fields[groupByField].type)){return list.fieldsInfo&&list.fieldsInfo[list.viewType][groupByField]&&list.fieldsInfo[list.viewType][groupByField].allowGroupRangeValue;}
var availableTypes=['char','boolean','many2one','selection'];return _.contains(availableTypes,list.fields[groupByField].type);},parseArch:function(arch){var doc=$.parseXML(arch).documentElement;var stripWhitespaces=doc.nodeName.toLowerCase()!=='kanban';return utils.xml_to_json(doc,stripWhitespaces);},renderButtonFromNode:function(node,options){var btnOptions={attrs:_.omit(node.attrs,'icon','string','type','attrs','modifiers','options','effect'),icon:node.attrs.icon,};if(options&&options.extraClass){var classes=btnOptions.attrs.class?btnOptions.attrs.class.split(' '):[];btnOptions.attrs.class=_.uniq(classes.concat(options.extraClass.split(' '))).join(' ');}
var str=(node.attrs.string||'').replace(/_/g,'');if(str){if(options&&options.textAsTitle){btnOptions.attrs.title=str;}else{btnOptions.text=str;}}
return dom.renderButton(btnOptions);},};__exports[Symbol.for("default")]=viewUtils;return __exports;});odoo.define(`web.viewUtils`,async function(require){return require('@web/legacy/js/views/view_utils')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/widgets/change_password.js defined in bundle 'web.assets_backend' */
odoo.define('web.ChangePassword',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var Dialog=require('web.Dialog');var web_client=require('web.web_client');var _t=core._t;var ChangePassword=AbstractAction.extend({template:"ChangePassword",start:function(){var self=this;web_client.set_title(_t("Change Password"));var $button=self.$('.oe_form_button');$button.appendTo(this.getParent().$footer);$button.eq(1).click(function(){self.$el.parents('.modal').modal('hide');});$button.eq(0).click(function(){self._rpc({route:'/web/session/change_password',params:{fields:$('form[name=change_password_form]').serializeArray()}}).then(function(result){if(result.error){self.displayNotification({message:result.error,type:'danger'});}else{self.do_action('logout');}});});},});core.action_registry.add("change_password",ChangePassword);return ChangePassword;});;

/* /web/static/src/legacy/js/widgets/data_export.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataExport',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var data=require('web.data');var framework=require('web.framework');var pyUtils=require('web.py_utils');var QWeb=core.qweb;var _t=core._t;var DataExport=Dialog.extend({template:'ExportDialog',events:{'change .o_exported_lists_select':'_onChangeExportList','change .o_import_compat input':'_onChangeCompatibleInput','click .o_add_field':'_onClickAddField','click .o_delete_exported_list':'_onClickDeleteExportListBtn','click .o_expand':'_onClickExpand','click .o_remove_field':'_onClickRemoveField','click .o_save_list .o_save_list_btn':'_onClickSaveListBtn','click .o_save_list .o_cancel_list_btn':'_resetTemplateField','click .o_export_tree_item':'_onClickTreeItem','dblclick .o_export_tree_item:not(.haschild)':'_onDblclickTreeItem','keydown .o_export_tree_item':'_onKeydownTreeItem','keydown .o_save_list_name':'_onKeydownSaveList','input .o_export_search_input':'_onSearchInput',},init:function(parent,record,defaultExportFields,groupedBy,activeDomain,idsToExport){var options={title:_t("Export Data"),buttons:[{text:_t("Export"),click:this._onExportData,classes:'btn-primary'},{text:_t("Close"),close:true},],fullscreen:config.device.isMobile,};this._super(parent,options);this.records={};this.record=record;this.defaultExportFields=defaultExportFields;this.groupby=groupedBy;this.exports=new data.DataSetSearch(this,'ir.exports',this.record.getContext());this.rowIndex=0;this.rowIndexLevel=0;this.isCompatibleMode=false;this.domain=activeDomain||this.record.domain;this.idsToExport=activeDomain?false:idsToExport;},start:function(){var self=this;var proms=[this._super.apply(this,arguments)];this.$modal.find('.modal-content').css('height','100%');this.$fieldsList=this.$('.o_fields_list');proms.push(this._rpc({route:'/web/export/formats'}).then(doSetupExportFormats));proms.push(this._onChangeCompatibleInput().then(function(){_.each(self.defaultExportFields,function(field){var record=self.records[field];self._addField(record.id,record.string);});}));proms.push(this._showExportsList());this.opened().then(function(){self.$('.o_fields_list').sortable({axis:'y',cursor:'grabbing',handle:'.o_short_field',forcePlaceholderSize:true,placeholder:'o-field-placeholder',update:self.proxy('_resetTemplateField'),});});return Promise.all(proms);function doSetupExportFormats(formats){var $fmts=self.$('.o_export_format');_.each(formats,function(format){var $radio=$('<input/>',{type:'radio',value:format.tag,name:'o_export_format_name',class:'form-check-input',id:'o_radio'+format.label});var $label=$('<label/>',{html:format.label,class:'form-check-label',for:'o_radio'+format.label});if(format.error){$radio.prop('disabled',true);$label.html(_.str.sprintf("%s — %s",format.label,format.error));}
$fmts.append($("<div class='radio form-check form-check-inline pl-4'></div>").append($radio,$label));});self.$exportFormatInputs=$fmts.find('input');self.$exportFormatInputs.filter(':enabled').first().prop('checked',true);}},export(){let exportedFields=this.defaultExportFields.map(field=>({name:field,label:this.record.fields[field].string,store:this.record.fields[field].store,type:this.record.fields[field].type,}));this._exportData(exportedFields,'xlsx',false);},_addField:function(fieldID,label){var $fieldList=this.$('.o_fields_list');if(!$fieldList.find(".o_export_field[data-field_id='"+fieldID+"']").length){$fieldList.append($('<li>',{'class':'o_export_field','data-field_id':fieldID}).append($('<span>',{'class':"fa fa-sort o_short_field mx-1"}),label.trim(),$('<span>',{'class':'fa fa-trash m-1 pull-right o_remove_field','title':_t("Remove field")})));}},_exportData(exportedFields,exportFormat,idsToExport){if(_.isEmpty(exportedFields)){Dialog.alert(this,_t("Please select fields to export..."));return;}
if(this.isCompatibleMode){exportedFields.unshift({name:'id',label:_t('External ID')});}
framework.blockUI();this.getSession().get_file({url:'/web/export/'+exportFormat,data:{data:JSON.stringify({model:this.record.model,fields:exportedFields,ids:idsToExport,domain:this.domain,groupby:this.groupby,context:pyUtils.eval('contexts',[this.record.getContext()]),import_compat:this.isCompatibleMode,})},complete:framework.unblockUI,error:(error)=>this.call('crash_manager','rpc_error',error),});},_getFields:function(){var exportFields=this.$('.o_export_field').map(function(){return $(this).data('field_id');}).get();if(exportFields.length===0){Dialog.alert(this,_t("Please select fields to save export list..."));}
return exportFields;},_onExpandAction:function(record){var self=this;if(!record.children){return;}
var model=record.params.model;var prefix=record.params.prefix;var name=record.params.name;var excludeFields=[];if(record.relation_field){excludeFields.push(record.relation_field);}
if(!record.loaded){this._rpc({route:'/web/export/get_fields',params:{model:model,prefix:prefix,parent_name:name,import_compat:this.isCompatibleMode,parent_field_type:record.field_type,parent_field:record.params.parent_field,exclude:excludeFields,},}).then(function(results){record.loaded=true;self._onShowData(results,record.id);});}else{this._showContent(record.id);}},_onShowData:function(records,expansion){var self=this;if(expansion){this.$('.o_export_tree_item[data-id="'+expansion+'"]').addClass('show').find('.o_expand_parent').toggleClass('fa-chevron-right fa-chevron-down').next().after(QWeb.render('Export.TreeItems',{fields:records,debug:config.isDebug()}));}else{this.$('.o_left_field_panel').empty().append($('<div/>').addClass('o_field_tree_structure').append(QWeb.render('Export.TreeItems',{fields:records,debug:config.isDebug()})));}
_.extend(this.records,_.object(_.pluck(records,'id'),records));this.$records=this.$('.o_export_tree_item');this.$records.each(function(i,el){var $el=$(el);$el.find('.o_tree_column').first().toggleClass('o_required',!!self.records[$el.data('id')].required);});},_addNewTemplate:function(){this.$('.o_exported_lists').addClass('d-none');this.$(".o_save_list").show().find(".o_save_list_name").val("").focus();},_resetTemplateField:function(){this.$('.o_exported_lists_select').val("");this.$('.o_delete_exported_list').addClass('d-none');this.$('.o_exported_lists').removeClass('d-none');this.$(".o_save_list").hide().find(".o_save_list_name").val("");},_showContent:function(fieldID){var $item=this.$('.o_export_tree_item[data-id="'+fieldID+'"]');$item.toggleClass('show');var isOpen=$item.hasClass('show');$item.children('.o_expand_parent').toggleClass('fa-chevron-down',!!isOpen).toggleClass('fa-chevron-right',!isOpen);var $childField=$item.find('.o_export_tree_item');var childLength=(fieldID.split('/')).length+1;for(var i=0;i<$childField.length;i++){var $child=$childField.eq(i);if(!isOpen){$child.hide();}else if(childLength===$childField.eq(i).data('id').split('/').length){if($child.hasClass('show')){$child.removeClass('show');$child.children('.o_expand_parent').removeClass('fa-chevron-down').addClass('fa-chevron-right');}
$child.show();}}},_showExportsList:function(){var self=this;if(this.$('.o_exported_lists_select').is(':hidden')){this.$('.o_exported_lists').show();return Promise.resolve();}
return this._rpc({model:'ir.exports',method:'search_read',fields:['name'],domain:[['resource','=',this.record.model]]}).then(function(exportList){self.$('.o_exported_lists').append(QWeb.render('Export.SavedList',{existing_exports:exportList,}));});},_onChangeExportList:function(){var self=this;var exportID=this.$('.o_exported_lists_select option:selected').val();this.$('.o_delete_exported_list').toggleClass('d-none',!exportID);if(exportID&&exportID!=='new_template'){this.$('.o_fields_list').empty();this._rpc({route:'/web/export/namelist',params:{model:this.record.model,export_id:parseInt(exportID,10),},}).then(function(fieldList){_.each(fieldList,function(field){self._addField(field.name,field.label);});});}else if(exportID==='new_template'){self._addNewTemplate();}},_onChangeCompatibleInput:function(){var self=this;this.isCompatibleMode=this.$('.o_import_compat input').is(':checked');this.$('.o_field_tree_structure').remove();this._resetTemplateField();return this._rpc({route:'/web/export/get_fields',params:{model:this.record.model,import_compat:this.isCompatibleMode,},}).then(function(records){var compatibleFields=_.map(records,function(record){return record.id;});self._onShowData(records);self.$('.o_fields_list').empty();_.chain(self.$fieldsList.find('.o_export_field')).map(function(field){return $(field).data('field_id');}).union(self.defaultExportFields).intersection(compatibleFields).each(function(field){var record=_.find(records,function(rec){return rec.id===field;});self._addField(record.id,record.string);});self.$('#o-export-search-filter').val('');});},_onClickAddField:function(ev){ev.stopPropagation();var $field=$(ev.currentTarget);this._resetTemplateField();this._addField($field.closest('.o_export_tree_item').data('id'),$field.closest('.o_tree_column').text());},_onClickDeleteExportListBtn:function(){var self=this;var selectExp=this.$('.o_exported_lists_select option:selected');var options={confirm_callback:function(){if(selectExp.val()){self.exports.unlink([parseInt(selectExp.val(),10)]);selectExp.remove();if(self.$('.o_exported_lists_select option').length<=1){self.$('.o_exported_lists').hide();}}}};Dialog.confirm(this,_t("Do you really want to delete this export template?"),options);},_onClickExpand:function(ev){this._onExpandAction(this.records[$(ev.target).closest('.o_export_tree_item').data('id')]);},_onClickRemoveField:function(ev){$(ev.currentTarget).closest('.o_export_field').remove();this._resetTemplateField();},_onClickSaveListBtn:function(){var self=this;var $saveList=this.$('.o_save_list');var value=$saveList.find('input').val();if(!value){Dialog.alert(this,_t("Please enter save field list name"));return;}
var fields=this._getFields();if(fields.length===0){return;}
$saveList.hide();this.exports.create({name:value,resource:this.record.model,export_fields:_.map(fields,function(field){return[0,0,{name:field}];}),}).then(function(exportListID){if(!exportListID){return;}
var $select=self.$('.o_exported_lists_select');if($select.length===0||$select.is(':hidden')){self._showExportsList();}
$select.append(new Option(value,exportListID));self.$('.o_exported_lists').removeClass('d-none');$select.val(exportListID);});},_onClickTreeItem:function(ev){ev.stopPropagation();var $elem=$(ev.currentTarget);var rowIndex=$elem.prevAll('.o_export_tree_item').length;var rowIndexLevel=$elem.parents('.o_export_tree_item').length;if(ev.shiftKey&&rowIndexLevel===this.rowIndexLevel){var minIndex=Math.min(rowIndex,this.rowIndex);var maxIndex=Math.max(rowIndex,this.rowIndex);this.$records.filter(function(){return($elem.parent()[0]===$(this).parent()[0]);}).slice(minIndex,maxIndex+1).addClass('o_selected').filter(':not(:last)').each(processChildren);}
this.rowIndex=rowIndex;this.rowIndexLevel=rowIndexLevel;if(ev.ctrlKey){$elem.toggleClass('o_selected').focus();}else if(ev.shiftKey){$elem.addClass('o_selected').focus();}else{this.$('.o_selected').removeClass('o_selected');$elem.addClass('o_selected').focus();}
function processChildren(){var $child=$(this);if($child.hasClass('show')){$child.children('.o_export_tree_item').addClass('o_selected').each(processChildren);}}},_onExportData(){let exportedFields=this.$('.o_export_field').map((i,field)=>({name:$(field).data('field_id'),label:field.textContent,})).get();let exportFormat=this.$exportFormatInputs.filter(':checked').val();this._exportData(exportedFields,exportFormat,this.idsToExport);},_onDblclickTreeItem:function(ev){var self=this;this._resetTemplateField();function addElement(el){self._addField(el.getAttribute('data-id'),el.querySelector('.o_tree_column').textContent);}
var target=ev.currentTarget;target.classList.remove('o_selected');[].reverse.call($(target).parents('.o_export_tree_item')).each(function(){addElement(this);});addElement(target);},_onKeydownSaveList:function(ev){if(ev.keyCode===$.ui.keyCode.ENTER){this._onClickSaveListBtn();}},_onKeydownTreeItem:function(ev){ev.stopPropagation();var $el=$(ev.currentTarget);var record=this.records[$el.data('id')];switch(ev.keyCode||ev.which){case $.ui.keyCode.LEFT:if($el.hasClass('show')){this._onExpandAction(record);}
break;case $.ui.keyCode.RIGHT:if(!$el.hasClass('show')){this._onExpandAction(record);}
break;case $.ui.keyCode.UP:var $prev=$el.prev('.o_export_tree_item');if($prev.length===1){while($prev.hasClass('show')){$prev=$prev.children('.o_export_tree_item').last();}}else{$prev=$el.parent('.o_export_tree_item');if($prev.length===0){break;}}
$el.removeClass('o_selected').blur();$prev.addClass("o_selected").focus();break;case $.ui.keyCode.DOWN:var $next;if($el.hasClass('show')){$next=$el.children('.o_export_tree_item').first();}else{$next=$el.next('.o_export_tree_item');if($next.length===0){$next=$el.parent('.o_export_tree_item').next('.o_export_tree_item');if($next.length===0){break;}}}
$el.removeClass('o_selected').blur();$next.addClass('o_selected').focus();break;}},_onSearchInput:function(ev){var searchText=$(ev.currentTarget).val().trim().toUpperCase();if(!searchText){this.$('.o_no_match').remove();this.$(".o_export_tree_item").show();this.$(".o_export_tree_item.haschild:not(.show) .o_export_tree_item").hide();return;}
var matchItems=this.$(".o_tree_column").filter(function(){var title=this.getAttribute('title');return this.innerText.toUpperCase().indexOf(searchText)>=0||title&&title.toUpperCase().indexOf(searchText)>=0;}).parent();this.$(".o_export_tree_item").hide();if(matchItems.length){this.$('.o_no_match').remove();_.each(matchItems,function(col){var $col=$(col);$col.show();$col.parents('.haschild.show').show();if(!$col.parent().hasClass('show')&&!$col.parent().hasClass('o_field_tree_structure')){$col.hide();}});}else if(!this.$('.o_no_match').length){this.$(".o_field_tree_structure").append($("<h3/>",{class:'text-center text-muted mt-5 o_no_match',text:_t("No match found.")}));}},});return DataExport;});;

/* /web/static/src/legacy/js/widgets/date_picker.js defined in bundle 'web.assets_backend' */
odoo.define('web.datepicker',function(require){"use strict";var core=require('web.core');var field_utils=require('web.field_utils');var time=require('web.time');var Widget=require('web.Widget');var _t=core._t;var DateWidget=Widget.extend({template:"web.datepicker",type_of_date:"date",events:{'error.datetimepicker':'errorDatetime','change .o_datepicker_input':'changeDatetime','click input':'_onInputClicked','input input':'_onInput','keydown':'_onKeydown','show.datetimepicker':'_onDateTimePickerShow','hide.datetimepicker':'_onDateTimePickerHide',},init:function(parent,options){this._super.apply(this,arguments);this.name=parent.name;this.options=_.extend({locale:moment.locale(),format:this.type_of_date==='datetime'?time.getLangDatetimeFormat():time.getLangDateFormat(),minDate:moment({y:1000}),maxDate:moment({y:9999,M:11,d:31}),useCurrent:false,icons:{time:'fa fa-clock-o',date:'fa fa-calendar',up:'fa fa-chevron-up',down:'fa fa-chevron-down',previous:'fa fa-chevron-left',next:'fa fa-chevron-right',today:'fa fa-calendar-check-o',clear:'fa fa-trash',close:'fa fa-check primary',},calendarWeeks:true,buttons:{showToday:false,showClear:false,showClose:false,},widgetParent:'body',keyBinds:null,},options||{});this.__libInput=0;this.__isOpen=false;},start:function(){this.$input=this.$('input.o_datepicker_input');this.__libInput++;this.$el.datetimepicker(this.options);this.__libInput--;this._setReadonly(false);},destroy:function(){if(this._onScroll){window.removeEventListener('wheel',this._onScroll,true);}
this.__libInput++;this.$el.datetimepicker('destroy');this.__libInput--;this._super.apply(this,arguments);},changeDatetime:function(){if(this.__libInput>0){if(this.options.warn_future){this._warnFuture(this.getValue());}
this.trigger("datetime_changed");return;}
var oldValue=this.getValue();if(this.isValid()){this._setValueFromUi();var newValue=this.getValue();var hasChanged=!oldValue!==!newValue;if(oldValue&&newValue){var formattedOldValue=oldValue.format(time.getLangDatetimeFormat());var formattedNewValue=newValue.format(time.getLangDatetimeFormat());if(formattedNewValue!==formattedOldValue){hasChanged=true;}}
if(hasChanged){if(this.options.warn_future){this._warnFuture(newValue);}
this.trigger("datetime_changed");}}else{var formattedValue=oldValue?this._formatClient(oldValue):null;this.$input.val(formattedValue);}},errorDatetime:function(e){return false;},focus:function(){this.__libInput++;this.$input.focus();this.__libInput--;},getValue:function(){var value=this.get('value');return value&&value.clone();},isValid:function(){var value=this.$input.val();if(value===""){return true;}else{try{this._parseClient(value);return true;}catch(e){return false;}}},maxDate:function(date){this.__libInput++;this.$el.datetimepicker('maxDate',date||null);this.__libInput--;},minDate:function(date){this.__libInput++;this.$el.datetimepicker('minDate',date||null);this.__libInput--;},setValue:function(value){this.set({'value':value});var formatted_value=value?this._formatClient(value):null;this.$input.val(formatted_value);this._setLibInputValue(value);},_warnFuture:function(currentDate){if(!this.$warning){this.$warning=$('<span>',{class:'fa fa-exclamation-triangle o_tz_warning o_datepicker_warning',});var title=_t("This date is in the future. Make sure this is what you expect.");this.$warning.attr('title',title);this.$input.after(this.$warning);}
if(currentDate&&currentDate.format('YYYY-MM-DD')>moment().format('YYYY-MM-DD')){this.$warning.show();}else{this.$warning.hide();}},_formatClient:function(v){return field_utils.format[this.type_of_date](v,null,{timezone:false});},_parseClient:function(v){return field_utils.parse[this.type_of_date](v,null,{timezone:false});},_setLibInputValue:function(value){this.__libInput++;this.$el.datetimepicker('date',value||null);this.__libInput--;},_setReadonly:function(readonly){this.readonly=readonly;this.$input.prop('readonly',this.readonly);},_setValueFromUi:function(){var value=this.$input.val()||false;this.setValue(this._parseClient(value));},_onDateTimePickerHide:function(){this.__isOpen=false;this.changeDatetime();if(this._onScroll){window.removeEventListener('wheel',this._onScroll,true);}
this.changeDatetime();},_onDateTimePickerShow:function(){this.__isOpen=true;if(this.$input.val().length!==0&&this.isValid()){this.$input.select();}
var self=this;this._onScroll=function(ev){if(ev.target!==self.$input.get(0)){self.__libInput++;self.$el.datetimepicker('hide');self.__libInput--;}};window.addEventListener('wheel',this._onScroll,true);},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ESCAPE){if(this.__isOpen){ev.stopImmediatePropagation();this.__libInput++;this.$el.datetimepicker('hide');this.__libInput--;this.focus();}}},_onInput:function(ev){if(this.__libInput>0){ev.stopImmediatePropagation();}},_onInputClicked:function(){this.__libInput++;this.$el.datetimepicker('toggle');this.__libInput--;this.focus();},});var DateTimeWidget=DateWidget.extend({type_of_date:"datetime",init:function(parent,options){this._super(parent,_.extend({buttons:{showToday:false,showClear:false,showClose:true,},},options||{}));},});return{DateWidget:DateWidget,DateTimeWidget:DateTimeWidget,};});;

/* /web/static/src/legacy/js/widgets/domain_selector_dialog.js defined in bundle 'web.assets_backend' */
odoo.define("web.DomainSelectorDialog",function(require){"use strict";var core=require("web.core");var Dialog=require("web.Dialog");var DomainSelector=require("web.DomainSelector");var _t=core._t;return Dialog.extend({custom_events:_.extend({},Dialog.prototype.custom_events,{domain_changed:"_onDomainChange",}),init:function(parent,model,domain,options){this.model=model;this.newDomain=null;this.options=_.extend({readonly:true,debugMode:false,},options||{});var buttons;if(this.options.readonly){buttons=[{text:_t("Close"),close:true},];}else{buttons=[{text:_t("Save"),classes:"btn-primary",close:true,click:function(){this.trigger_up("domain_selected",{domain:this.newDomain!==null?this.newDomain:this.domainSelector.getDomain(),});}},{text:_t("Discard"),close:true},];}
this._super(parent,_.extend({},{title:_t("Domain"),buttons:buttons,},options||{}));this.domainSelector=new DomainSelector(this,model,domain,options);},start:function(){var self=this;this.opened().then(function(){self.$el.css('overflow','visible').closest('.modal-dialog').css('height','auto');});return Promise.all([this._super.apply(this,arguments),this.domainSelector.appendTo(this.$el)]);},_onDomainChange:function(ev){ev.stopPropagation();this.newDomain=ev.data.domain;},});});;

/* /web/static/src/legacy/js/widgets/domain_selector.js defined in bundle 'web.assets_backend' */
odoo.define("web.DomainSelector",function(require){"use strict";var core=require("web.core");var datepicker=require("web.datepicker");var dom=require('web.dom');var Domain=require("web.Domain");var field_utils=require("web.field_utils");var ModelFieldSelector=require("web.ModelFieldSelector");var Widget=require("web.Widget");var _t=core._t;var _lt=core._lt;var operator_mapping={"=":"=","!=":_lt("is not ="),">":">","<":"<",">=":">=","<=":"<=","ilike":_lt("contains"),"not ilike":_lt("does not contain"),"in":_lt("in"),"not in":_lt("not in"),"child_of":_lt("child of"),"parent_of":_lt("parent of"),"like":"like","not like":"not like","=like":"=like","=ilike":"=ilike","set":_lt("is set"),"not set":_lt("is not set"),};var DomainNode=Widget.extend({events:{"click .o_domain_add_node_button":"_onAddButtonClick","click .o_domain_delete_node_button":"_onDeleteButtonClick","mouseenter button":"_onButtonEntered","mouseleave button":"_onButtonLeft",},init:function(parent,model,domain,options){this._super.apply(this,arguments);this.model=model;this.options=_.extend({readonly:true,operators:null,debugMode:false,},options||{});this.readonly=this.options.readonly;this.debug=this.options.debugMode;},isValid:function(){},getDomain:function(){},_onAddButtonClick:function(e){e.preventDefault();e.stopPropagation();this.trigger_up("add_node_clicked",{newBranch:!!$(e.currentTarget).data("branch"),child:this});},_onDeleteButtonClick:function(e){e.preventDefault();e.stopPropagation();this.trigger_up("delete_node_clicked",{child:this});},_onButtonEntered:function(e){e.preventDefault();e.stopPropagation();var $target=$(e.currentTarget);this.$el.toggleClass("o_hover_btns",$target.hasClass("o_domain_delete_node_button"));this.$el.toggleClass("o_hover_add_node",$target.hasClass("o_domain_add_node_button"));this.$el.toggleClass("o_hover_add_inset_node",!!$target.data("branch"));},_onButtonLeft:function(e){e.preventDefault();e.stopPropagation();this.$el.removeClass("o_hover_btns o_hover_add_node o_hover_add_inset_node");},});var DomainTree=DomainNode.extend({template:"DomainTree",events:_.extend({},DomainNode.prototype.events,{"click .o_domain_tree_operator_selector .dropdown-item":"_onOperatorChange",}),custom_events:{"add_node_clicked":"_onNodeAdditionAsk","delete_node_clicked":"_onNodeDeletionAsk",},init:function(parent,model,domain){this._super.apply(this,arguments);var parsedDomain=this._parseDomain(domain);if(parsedDomain){this._initialize(parsedDomain);}},start:function(){this._postRender();return Promise.all([this._super.apply(this,arguments),this._renderChildrenTo(this.$childrenContainer)]);},isValid:function(){for(var i=0;i<this.children.length;i++){var cValid=this.children[i].isValid();if(!cValid){return cValid;}}
return this._isValid;},getDomain:function(){var childDomains=[];var nbChildren=0;_.each(this.children,function(child){var childDomain=child.getDomain();if(childDomain.length){nbChildren++;childDomains=childDomains.concat(child.getDomain());}});var nbChildRequired=this.operator==="!"?1:2;var operators=_.times(nbChildren-nbChildRequired+1,_.constant(this.operator));return operators.concat(childDomains);},_addChild:function(domain,afterNode){var i=afterNode?_.indexOf(this.children,afterNode):this.children.length;if(i<0)return false;this.children.splice(i+1,0,instantiateNode(this,this.model,domain,this.options));this.trigger_up("domain_changed",{child:this});return true;},_addFlattenedChildren:function(domain){var node=instantiateNode(this,this.model,domain,this.options);if(node===null){return;}
if(!node.children||node.operator!==this.operator){this.children.push(node);return;}
_.each(node.children,(function(child){child.setParent(this);this.children.push(child);}).bind(this));node.destroy();},_changeOperator:function(operator,silent){this.operator=operator;if(!silent)this.trigger_up("domain_changed",{child:this});},_initialize:function(domain){this._isValid=true;this.operator=domain[0];this.children=[];if(domain.length<=1){return;}
var nbLeafsToFind=1;for(var i=1;i<domain.length;i++){if(domain[i]==="&"||domain[i]==="|"){nbLeafsToFind++;}else if(domain[i]!=="!"){nbLeafsToFind--;}
if(!nbLeafsToFind){var partLeft=domain.slice(1,i+1);var partRight=domain.slice(i+1);if(partLeft.length){this._addFlattenedChildren(partLeft);}
if(partRight.length){this._addFlattenedChildren(partRight);}
break;}}
this._isValid=(nbLeafsToFind===0);if(this.operator==="!"){this.children[0].noControlPanel=true;}},_postRender:function(){this.$childrenContainer=this.$("> .o_domain_node_children_container");},_removeChild:function(oldChild){var i=_.indexOf(this.children,oldChild);if(i<0)return false;this.children[i].destroy();this.children.splice(i,1);this.trigger_up("domain_changed",{child:this});return true;},_renderChildrenTo:function($to){var $div=$("<div/>");const children=this.children;return Promise.all(_.map(children,(function(child){return child.appendTo($div);}).bind(this))).then((function(){_.each(children,function(child){child.$el.appendTo($to);});}).bind(this));},_parseDomain:function(domain){var parsedDomain=false;try{parsedDomain=Domain.prototype.stringToArray(domain);this.invalidDomain=false;}catch(err){this.invalidDomain=true;this.children=[];}
return parsedDomain;},_onOperatorChange:function(e){e.preventDefault();e.stopPropagation();this._changeOperator($(e.target).data("operator"));},_onNodeAdditionAsk:function(e){var domain=this.options.default||[["id","=",1]];if(e.data.newBranch){domain=[this.operator==="&"?"|":"&"].concat(domain).concat(domain);}
if(this._addChild(domain,e.data.child)){e.stopPropagation();}},_onNodeDeletionAsk:function(e){if(this._removeChild(e.data.child)){e.stopPropagation();}},});var DomainSelector=DomainTree.extend({template:"DomainSelector",events:_.extend({},DomainTree.prototype.events,{"click .o_domain_add_first_node_button":"_onAddFirstButtonClick","change .o_domain_debug_input":"_onDebugInputChange",}),custom_events:_.extend({},DomainTree.prototype.custom_events,{domain_changed:"_onDomainChange",}),init(parent,model,domain){this._super(...arguments);this.rawDomain=domain;this._redrawId=0;},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.invalidDomain){var msg=_t("This domain is not supported.");self.$el.html(msg);}});},on_attach_callback(){let $modalBodyEl=this.$el.closest('.modal-body');if($modalBodyEl.length!==0){$modalBodyEl.css('overflow','visible');}},setDomain:function(domain){if(domain===Domain.prototype.arrayToString(this.getDomain())){return Promise.resolve();}
var parsedDomain=this._parseDomain(domain);if(parsedDomain){return this._redraw(parsedDomain);}},_initialize:function(domain){if(domain.length>1){Domain.prototype.normalizeArray(domain);}else{domain=["&"].concat(domain);}
return this._super(domain);},_postRender:function(){this._super.apply(this,arguments);this.$debugInput=this.$(".o_domain_debug_input");if(this.$debugInput.length){this.$debugInput.val(this.rawDomain);dom.autoresize(this.$debugInput);}
if(!this._isValid){this.displayNotification({message:_t("Domain not supported"),type:'danger'});}},_redraw:function(domain){const _redrawId=++this._redrawId;var oldChildren=this.children.slice();this._initialize(domain||this.getDomain());return this._renderChildrenTo($("<div/>")).then((function(){if(_redrawId!==this._redrawId){return;}
_.each(oldChildren,function(child){child.destroy();});this.renderElement();this._postRender();_.each(this.children,(function(child){child.$el.appendTo(this.$childrenContainer);}).bind(this));}).bind(this));},_onAddFirstButtonClick:function(){this._addChild(this.options.default||[["id","=",1]]);},_onDebugInputChange:function(e){const rawDomain=e.currentTarget.value;try{Domain.prototype.stringToArray(rawDomain);}catch(err){this.displayNotification({title:_t("Syntax error"),message:_t("Domain not properly formed"),type:'danger'});return;}
this.trigger_up("domain_changed",{child:this,noRedraw:true,domain:rawDomain,debug:true,});},_onDomainChange:function(e){e.data.domain=e.data.domain||this.getDomain();this.rawDomain=Domain.prototype.arrayToString(e.data.domain);if(!e.data.noRedraw){this._redraw();}},});var DomainLeaf=DomainNode.extend({template:"DomainLeaf",events:_.extend({},DomainNode.prototype.events,{"change .o_domain_leaf_operator_select":"_onOperatorSelectChange","change .o_domain_leaf_value_input":"_onValueInputChange","click .o_domain_leaf_value_add_tag_button":"on_add_tag","keyup .o_domain_leaf_value_tags input":"on_add_tag","click .o_domain_leaf_value_remove_tag_button":"on_remove_tag",}),custom_events:{"field_chain_changed":"_onFieldChainChange",},init:function(parent,model,domain,options){this._super.apply(this,arguments);var currentDomain=Domain.prototype.stringToArray(domain);this.chain=currentDomain[0][0];this.operator=currentDomain[0][1];this.value=currentDomain[0][2];this.operator_mapping=operator_mapping;},willStart:function(){var defs=[this._super.apply(this,arguments)];this.fieldSelector=new ModelFieldSelector(this,this.model,this.chain!==undefined?this.chain.toString().split("."):[],this.options);defs.push(this.fieldSelector.appendTo($("<div/>")).then((function(){var wDefs=[];if(!this.readonly){var selectedField=this.fieldSelector.getSelectedField()||{};this.operators=this._getOperatorsFromType(selectedField.type);if(_.contains(["child_of","parent_of","like","not like","=like","=ilike"],this.operator)){this.operators[this.operator]=operator_mapping[this.operator];}else if(!this.operators[this.operator]){this.operators[this.operator]="?";}
this.selectionChoices=null;if(selectedField.type==="boolean"){this.selectionChoices=[["1",_t("set (true)")],["0",_t("not set (false)")]];}else if(selectedField.type==="selection"){this.selectionChoices=selectedField.selection;}
this.displayValue=this.value;try{if(selectedField&&!selectedField.relation&&!_.isArray(this.value)){this.displayValue=field_utils.format[selectedField.type](this.value,selectedField);}}catch(err){}
this.displayOperator=this.operator;if(selectedField.type==="boolean"){this.displayValue=this.value?"1":"0";}else if((this.operator==="!="||this.operator==="=")&&this.value===false){this.displayOperator=this.operator==="!="?"set":"not set";}
if(_.contains(["date","datetime"],selectedField.type)){this.valueWidget=new(selectedField.type==="datetime"?datepicker.DateTimeWidget:datepicker.DateWidget)(this);wDefs.push(this.valueWidget.appendTo("<div/>").then((function(){this.valueWidget.$el.addClass("o_domain_leaf_value_input");this.valueWidget.setValue(moment(this.value));this.valueWidget.on("datetime_changed",this,function(){this._changeValue(this.valueWidget.getValue());});}).bind(this)));}
return Promise.all(wDefs);}}).bind(this)));return Promise.all(defs);},start:function(){this.fieldSelector.$el.prependTo(this.$("> .o_domain_leaf_info, > .o_domain_leaf_edition"));if(!this.readonly&&this.valueWidget){this.$(".o_domain_leaf_value_input").replaceWith(this.valueWidget.$el);}
return this._super.apply(this,arguments);},isValid:function(){return this.fieldSelector&&this.fieldSelector.isValid();},getDomain:function(){return[[this.chain,this.operator,this.value]];},_changeFieldChain:function(chain,silent){this.chain=chain.join(".");this.fieldSelector.setChain(chain).then((function(){if(!this.fieldSelector.isValid())return;var selectedField=this.fieldSelector.getSelectedField()||{};var operators=this._getOperatorsFromType(selectedField.type);if(operators[this.operator]===undefined){this._changeOperator("=",true);}
this._changeValue(this.value,true);if(!silent)this.trigger_up("domain_changed",{child:this});}).bind(this));},_changeOperator:function(operator,silent){this.operator=operator;if(_.contains(["set","not set"],this.operator)){this.operator=this.operator==="not set"?"=":"!=";this.value=false;}else if(_.contains(["in","not in"],this.operator)){this.value=_.isArray(this.value)?this.value:this.value?(""+this.value).split(","):[];}else{if(_.isArray(this.value)){this.value=this.value.join(",");}
this._changeValue(this.value,true);}
if(!silent)this.trigger_up("domain_changed",{child:this});},_changeValue:function(value,silent){var couldNotParse=false;var selectedField=this.fieldSelector.getSelectedField()||{};try{this.value=field_utils.parse[selectedField.type](value,selectedField);}catch(err){this.value=value;couldNotParse=true;}
if(selectedField.type==="boolean"){if(!_.isBoolean(this.value)){this.value=!!parseFloat(this.value);}}else if(selectedField.type==="selection"){if(!_.some(selectedField.selection,(function(option){return option[0]===this.value;}).bind(this))){this.value=selectedField.selection[0][0];}}else if(_.contains(["date","datetime"],selectedField.type)){if(couldNotParse||_.isBoolean(this.value)){this.value=field_utils.parse[selectedField.type](field_utils.format[selectedField.type](moment())).toJSON();}else{this.value=this.value.toJSON();}}else{if(_.isBoolean(this.value)){this.value="";}else if(_.isObject(this.value)&&!_.isArray(this.value)){this.value=this.value.id||value||"";}}
if(!silent)this.trigger_up("domain_changed",{child:this});},_getOperatorsFromType:function(type){var operators={};switch(type){case"boolean":operators={"=":_t("is"),"!=":_t("is not"),};break;case"char":case"text":case"html":operators=_.pick(operator_mapping,"=","!=","ilike","not ilike","set","not set","in","not in");break;case"many2many":case"one2many":case"many2one":operators=_.pick(operator_mapping,"=","!=","ilike","not ilike","set","not set");break;case"integer":case"float":case"monetary":operators=_.pick(operator_mapping,"=","!=",">","<",">=","<=","ilike","not ilike","set","not set");break;case"selection":operators=_.pick(operator_mapping,"=","!=","set","not set");break;case"date":case"datetime":operators=_.pick(operator_mapping,"=","!=",">","<",">=","<=","set","not set");break;default:operators=_.extend({},operator_mapping);break;}
if(this.options.operators){operators=_.pick.apply(_,[operators].concat(this.options.operators));}
return operators;},_onOperatorSelectChange:function(e){this._changeOperator($(e.currentTarget).val());},_onValueInputChange:function(e){if(e.currentTarget!==e.target)return;this._changeValue($(e.currentTarget).val());},_onFieldChainChange:function(e){this._changeFieldChain(e.data.chain);},on_add_tag:function(e){if(e.type==="keyup"&&e.which!==$.ui.keyCode.ENTER)return;if(!_.contains(["not in","in"],this.operator))return;var values=_.isArray(this.value)?this.value.slice():[];var $input=this.$(".o_domain_leaf_value_tags input");var val=$input.val().trim();if(val&&values.indexOf(val)<0){values.push(val);_.defer(this._changeValue.bind(this,values));$input.focus();}},on_remove_tag:function(e){var values=_.isArray(this.value)?this.value.slice():[];var val=this.$(e.currentTarget).data("value");var index=values.indexOf(val);if(index>=0){values.splice(index,1);_.defer(this._changeValue.bind(this,values));}},});function instantiateNode(parent,model,domain,options){if(domain.length>1){return new DomainTree(parent,model,domain,options);}else if(domain.length===1){return new DomainLeaf(parent,model,domain,options);}
return null;}
return DomainSelector;});;

/* /web/static/src/legacy/js/widgets/iframe_widget.js defined in bundle 'web.assets_backend' */
odoo.define('web.IFrameWidget',function(require){"use strict";var Widget=require('web.Widget');var IFrameWidget=Widget.extend({tagName:'iframe',init:function(parent,url){this._super(parent);this.url=url;},start:function(){this.$el.css({height:'100%',width:'100%',border:0});this.$el.attr({src:this.url});this.$el.on("load",this._bindEvents.bind(this));return this._super();},_bindEvents:function(){this.$el.contents().click(this._onIFrameClicked.bind(this));},_onIFrameClicked:function(event){}});return IFrameWidget;});;

/* /web/static/src/legacy/js/widgets/model_field_selector.js defined in bundle 'web.assets_backend' */
odoo.define("web.ModelFieldSelector",function(require){"use strict";var core=require("web.core");var Widget=require("web.Widget");const{fuzzyLookup}=require('@web/core/utils/search');var _t=core._t;var modelFieldsCache={cache:{},cacheDefs:{},};core.bus.on('clear_cache',null,function(){modelFieldsCache.cache={};modelFieldsCache.cacheDefs={};});var ModelFieldSelector=Widget.extend({template:"ModelFieldSelector",events:{},editionEvents:{"focusin":"_onFocusIn","focusout":"_onFocusOut","click .o_field_selector_close":"_onCloseClick","click .o_field_selector_prev_page":"_onPrevPageClick","click .o_field_selector_next_page":"_onNextPageClick","click li.o_field_selector_select_button":"_onLastFieldClick","change input.o_field_selector_debug":"_onDebugInputChange","keyup .o_field_selector_search > input":"_onSearchInputChange","mouseover li.o_field_selector_item":"_onItemHover","keydown":"_onKeydown",},init:function(parent,model,chain,options){this._super.apply(this,arguments);this.model=model;this.chain=chain;this.options=_.extend({order:'string',readonly:true,filters:{},fields:null,filter:function(){return true;},followRelations:true,debugMode:false,showSearchInput:true,},options||{});this.options.filters=_.extend({searchable:true,},this.options.filters);if(typeof this.options.followRelations!=='function'){this.options.followRelations=this.options.followRelations?function(){return true;}:function(){return false;};}
this.pages=[];this.dirty=false;if(!this.options.readonly){_.extend(this.events,this.editionEvents);}
this.searchValue='';},willStart:function(){return Promise.all([this._super.apply(this,arguments),this._prefill()]);},start:function(){this.$value=this.$(".o_field_selector_value");this.$popover=this.$(".o_field_selector_popover");this.$input=this.$popover.find(".o_field_selector_popover_footer > input");this.$searchInput=this.$popover.find(".o_field_selector_search > input");this.$valid=this.$(".o_field_selector_warning");this._render();return this._super.apply(this,arguments);},getSelectedField:function(){return _.findWhere(this.pages[this.chain.length-1],{name:_.last(this.chain)});},isValid:function(){return this.valid;},setChain:function(chain){if(_.isEqual(chain,this.chain)){return Promise.resolve();}
this.chain=chain;return this._prefill().then(this._render.bind(this));},_addChainNode:function(fieldName){this.dirty=true;this.chain=this.chain.slice(0,this.pages.length-1);this.chain.push(fieldName);this.searchValue='';this.$searchInput.val('');},_getLastPageField:function(name){return _.findWhere(_.last(this.pages),{name:name,});},_getModelFieldsFromCache:function(model,filters){var self=this;var def=modelFieldsCache.cacheDefs[model];if(!def){def=modelFieldsCache.cacheDefs[model]=this._rpc({model:model,method:'fields_get',args:[false,["store","searchable","type","string","relation","selection","related"]],context:this.getSession().user_context,}).then((function(fields){modelFieldsCache.cache[model]=sortFields(fields,model,self.options.order);}).bind(this));}
return def.then((function(){return _.filter(modelFieldsCache.cache[model],function(f){return(!filters.searchable||f.searchable)&&self.options.filter(f);});}).bind(this));},_goToNextPage:function(field){if(!_.isEqual(this._getLastPageField(field.name),field))return;this._validate(true);this._addChainNode(field.name);this._pushPageData(field.relation).then(this._render.bind(this));},_goToPrevPage:function(){if(this.pages.length<=0)return;this._validate(true);this._removeChainNode();if(this.pages.length>1){this.pages.pop();}
this._render();},_hidePopover:function(){if(!this._isOpen)return;this._isOpen=false;this.$popover.addClass('d-none');if(this.dirty){this.dirty=false;this.trigger_up("field_chain_changed",{chain:this.chain});}},_prefill:function(){this.pages=[];return this._pushPageData(this.model).then((function(){this._validate(true);return(this.chain.length?processChain.call(this,this.chain.slice().reverse()):Promise.resolve());}).bind(this));function processChain(chain){var fieldName=chain.pop();var field=this._getLastPageField(fieldName);if(field&&field.relation){if(chain.length){return this._pushPageData(field.relation).then(processChain.bind(this,chain));}else{return this._pushPageData(field.relation);}}else if(field&&chain.length===0){return Promise.resolve();}else if(!field&&fieldName==="1"){this._validate(true);}else if(!field&&fieldName==="0"){this._validate(true);}else{this._validate(false);}
return Promise.resolve();}},_pushPageData:function(model){var def;if(this.model===model&&this.options.fields){def=Promise.resolve(sortFields(this.options.fields,model,this.options.order));}else{def=this._getModelFieldsFromCache(model,this.options.filters);}
return def.then((function(fields){this.pages.push(fields);}).bind(this));},_removeChainNode:function(){this.dirty=true;this.chain=this.chain.slice(0,this.pages.length-1);this.chain.pop();},_render:function(){this.$value.html(core.qweb.render(this.template+".value",{chain:this.chain,pages:this.pages,}));this.$valid.toggleClass('d-none',!!this.isValid());var page=_.last(this.pages);var title="";if(this.pages.length>1){var prevField=_.findWhere(this.pages[this.pages.length-2],{name:(this.chain.length===this.pages.length)?this.chain[this.chain.length-2]:_.last(this.chain),});if(prevField)title=prevField.string;}
this.$(".o_field_selector_popover_header .o_field_selector_title").text(title);var lines=_.filter(page,this.options.filter);if(this.searchValue){lines=fuzzyLookup(this.searchValue,lines,(l)=>l.string);}
this.$(".o_field_selector_page").replaceWith(core.qweb.render(this.template+".page",{lines:lines,followRelations:this.options.followRelations,debug:this.options.debugMode,}));this.$input.val(this.chain.join("."));},_selectField:function(field){if(!_.isEqual(this._getLastPageField(field.name),field))return;this._validate(true);this._addChainNode(field.name);this._render();this._hidePopover();},_showPopover:function(){if(this._isOpen)return;this._isOpen=true;this.$popover.removeClass('d-none');},_validate:function(valid){this.valid=!!valid;if(!this.valid){this.displayNotification({message:_t("Invalid field chain. You may have used a non-existing field name or followed a non-relational field."),type:'danger',});}},_onFocusIn:function(){clearTimeout(this._hidePopoverTimeout);this._showPopover();},_onFocusOut:function(){this._hidePopoverTimeout=_.defer(this._hidePopover.bind(this));},_onCloseClick:function(){this._hidePopover();},_onPrevPageClick:function(){this._goToPrevPage();},_onNextPageClick:function(e){e.stopPropagation();this._goToNextPage(this._getLastPageField($(e.currentTarget).data("name")));},_onLastFieldClick:function(e){this._selectField(this._getLastPageField($(e.currentTarget).data("name")));},_onDebugInputChange:function(){var userChainStr=this.$input.val();var userChain=userChainStr.split(".");if(!this.options.followRelations&&userChain.length>1){this.displayNotification({title:_t("Relation not allowed"),message:_t("You cannot follow relations for this field chain construction"),type:'danger',});userChain=[userChain[0]];}
this.setChain(userChain).then((function(){this.trigger_up("field_chain_changed",{chain:this.chain});}).bind(this));},_onSearchInputChange:function(){this.searchValue=this.$searchInput.val();this._render();},_onItemHover:function(e){this.$("li.o_field_selector_item").removeClass("active");$(e.currentTarget).addClass("active");},_onKeydown:function(e){if(!this.$popover.is(":visible"))return;var inputHasFocus=this.$input.is(":focus");var searchInputHasFocus=this.$searchInput.is(":focus");switch(e.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:e.preventDefault();var $active=this.$("li.o_field_selector_item.active");var $to=$active[e.which===$.ui.keyCode.DOWN?"next":"prev"](".o_field_selector_item");if($to.length){$active.removeClass("active");$to.addClass("active");this.$popover.focus();var $page=$to.closest(".o_field_selector_page");var full_height=$page.height();var el_position=$to.position().top;var el_height=$to.outerHeight();var current_scroll=$page.scrollTop();if(el_position<0){$page.scrollTop(current_scroll-el_height);}else if(full_height<el_position+el_height){$page.scrollTop(current_scroll+el_height);}}
break;case $.ui.keyCode.RIGHT:if(inputHasFocus)break;e.preventDefault();var name=this.$("li.o_field_selector_item.active").data("name");if(name){var field=this._getLastPageField(name);if(field.relation){this._goToNextPage(field);}}
break;case $.ui.keyCode.LEFT:if(inputHasFocus)break;e.preventDefault();this._goToPrevPage();break;case $.ui.keyCode.ESCAPE:e.stopPropagation();this._hidePopover();break;case $.ui.keyCode.ENTER:if(inputHasFocus||searchInputHasFocus)break;e.preventDefault();this._selectField(this._getLastPageField(this.$("li.o_field_selector_item.active").data("name")));break;}}});return ModelFieldSelector;function sortFields(fields,model,order){var array=_.chain(fields).pairs().sortBy(function(p){return p[1].string;});if(order!=='string'){array=array.sortBy(function(p){return p[1][order];});}
return array.map(function(p){return _.extend({name:p[0],model:model,},p[1]);}).value();}});;

/* /web/static/src/legacy/js/widgets/pie_chart.js defined in bundle 'web.assets_backend' */
odoo.define('web.PieChart',function(require){"use strict";var core=require('web.core');var Domain=require('web.Domain');var viewRegistry=require('web.view_registry');var Widget=require('web.Widget');var widgetRegistry=require('web.widget_registry');const{loadLegacyViews}=require("@web/legacy/legacy_views");var qweb=core.qweb;var PieChart=Widget.extend({className:'o_pie_chart',xmlDependencies:['/web/static/src/legacy/xml/chart.xml'],init:function(parent,record,node){this._super.apply(this,arguments);var modifiers=node.attrs.modifiers;var domain=record.domain.concat(Domain.prototype.stringToArray(modifiers.domain||'[]'));var arch=qweb.render('web.PieChart',{modifiers:modifiers,title:node.attrs.title||modifiers.title||modifiers.measure,});var pieChartContext=JSON.parse(JSON.stringify(record.context));delete pieChartContext.graph_mode;delete pieChartContext.graph_measure;delete pieChartContext.graph_groupbys;this.subViewParams={modelName:record.model,withButtons:false,withControlPanel:false,withSearchPanel:false,isEmbedded:true,useSampleModel:record.isSample,mode:'pie',};this.subViewParams.searchQuery={context:pieChartContext,domain:domain,groupBy:[],timeRanges:record.timeRanges||{},};this.viewInfo={arch:arch,fields:record.fields,viewFields:record.fieldsInfo.dashboard,};},willStart:async function(){var self=this;const _super=this._super.bind(this,...arguments);await loadLegacyViews({rpc:this._rpc.bind(this)});var def1=_super();var SubView=viewRegistry.get('graph');var subView=new SubView(this.viewInfo,this.subViewParams);var def2=subView.getController(this).then(function(controller){self.controller=controller;return self.controller.appendTo(document.createDocumentFragment());});return Promise.all([def1,def2]);},start:function(){this.$el.append(this.controller.$el);return this._super.apply(this,arguments);},on_attach_callback:function(){this.controller.on_attach_callback();},});widgetRegistry.add('pie_chart',PieChart);return PieChart;});;

/* /web/static/src/legacy/js/widgets/ribbon.js defined in bundle 'web.assets_backend' */
odoo.define('web.ribbon',function(require){'use strict';var widgetRegistry=require('web.widget_registry');var Widget=require('web.Widget');var RibbonWidget=Widget.extend({template:'web.ribbon',xmlDependencies:['/web/static/src/legacy/xml/ribbon.xml'],init:function(parent,data,options){this._super.apply(this,arguments);this.text=options.attrs.title||options.attrs.text;this.tooltip=options.attrs.tooltip;this.className=options.attrs.bg_color?options.attrs.bg_color:'bg-success';if(this.text.length>15){this.className+=' o_small';}else if(this.text.length>10){this.className+=' o_medium';}},});widgetRegistry.add('web_ribbon',RibbonWidget);return RibbonWidget;});;

/* /web/static/src/legacy/js/widgets/week_days.js defined in bundle 'web.assets_backend' */
odoo.define('web.WeekDays',function(require){'use strict';const CustomCheckbox=require('web.CustomCheckbox');const Registry=require('web.widgetRegistry');const utils=require('web.utils');const{useState}=owl.hooks;class WeekDays extends owl.Component{constructor(parent){super(...arguments);this.parent=parent;this.weekdaysShort=[];this._sortWeekdays();this.state=useState({days:this._prepareData(this.props.record.data)});this.mode=this.props.options.mode;}
async willUpdateProps(nextProps){this.state.days=this._prepareData(nextProps.record.data);this.mode=nextProps.options.mode;}
_prepareData(data){const weekdays={};this.weekdaysShort.forEach((day)=>{weekdays[day]={id:`${day}-${utils.generateID()}`,value:data[day],};});return weekdays;}
_sortWeekdays(){const weekStart=this.env._t.database.parameters.week_start;const weekdaysShort=['mon','tue','wed','thu','fri','sat','sun'];const slicedArray1=weekdaysShort.slice(weekStart-1,weekdaysShort.length);const slicedArray2=weekdaysShort.slice(0,weekStart-1);this.weekdaysShort=slicedArray1.concat(slicedArray2);}
_onChange(ev){const field=ev.target.id.split("-")[0];this.trigger('field-changed',{dataPointID:this.props.record.id,changes:{[field]:ev.target.checked},});}}
WeekDays.components={CustomCheckbox};WeekDays.template="web.RecurrentTask";WeekDays.fieldDependencies={sun:{type:'boolean'},mon:{type:'boolean'},tue:{type:'boolean'},wed:{type:'boolean'},thu:{type:'boolean'},fri:{type:'boolean'},sat:{type:'boolean'},};Registry.add('week_days',WeekDays);return WeekDays;});;

/* /web/static/src/legacy/js/widgets/signature.js defined in bundle 'web.assets_backend' */
odoo.define('web.signature_widget',function(require){"use strict";const framework=require('web.framework');const SignatureDialog=require('web.signature_dialog');const widgetRegistry=require('web.widget_registry');const Widget=require('web.Widget');const WidgetSignature=Widget.extend({custom_events:Object.assign({},Widget.prototype.custom_events,{upload_signature:'_onUploadSignature',}),events:Object.assign({},Widget.prototype.events,{'click .o_sign_label':'_onClickSignature',}),template:'SignButton',init:function(parent,record,nodeInfo){this._super.apply(this,arguments);this.res_id=record.res_id;this.res_model=record.model;this.state=record;this.node=nodeInfo;this.signature_field=this.node.attrs.signature_field||'signature';},_onClickSignature:function(){const nameAndSignatureOptions={displaySignatureRatio:3,mode:'draw',noInputName:true,signatureType:'signature',};if(this.node.attrs.full_name){let signName;const fieldFullName=this.state.data[this.node.attrs.full_name];if(fieldFullName&&fieldFullName.type==='record'){signName=fieldFullName.data.display_name;}else{signName=fieldFullName;}
nameAndSignatureOptions.defaultName=signName||undefined;}
nameAndSignatureOptions.defaultFont=this.node.attrs.default_font||'';this.signDialog=new SignatureDialog(this,{nameAndSignatureOptions:nameAndSignatureOptions,});this.signDialog.open();},_onUploadSignature:function(ev){const file=ev.data.signatureImage[1];const always=()=>{this.trigger_up('reload');framework.unblockUI();};framework.blockUI();const rpcProm=this._rpc({model:this.res_model,method:'write',args:[[this.res_id],{[this.signature_field]:file,}],});rpcProm.then(always).guardedCatch(always);return rpcProm;},});widgetRegistry.add('signature',WidgetSignature);});;

/* /web/static/src/legacy/js/widgets/attach_document.js defined in bundle 'web.assets_backend' */
odoo.define('web.AttachDocument',function(require){"use static";var core=require('web.core');var framework=require('web.framework');var{Markup}=require('web.utils');var widgetRegistry=require('web.widget_registry');var Widget=require('web.Widget');var _t=core._t;var AttachDocument=Widget.extend({template:'AttachDocument',events:{'click':'_onClickAttachDocument','change input.o_input_file':'_onFileChanged',},init:function(parent,record,nodeInfo){this._super.apply(this,arguments);this.res_id=record.res_id;this.res_model=record.model;this.state=record;this.node=nodeInfo;this.fileuploadID=_.uniqueId('o_fileupload');},start:function(){$(window).on(this.fileuploadID,this._onFileLoaded.bind(this));return this._super.apply(this,arguments);},destroy:function(){$(window).off(this.fileuploadID);this._super.apply(this,arguments);},_notifyInvalidFields:function(invalidFields){var fields=this.state.fields;var warnings=invalidFields.map(function(fieldName){var fieldStr=fields[fieldName].string;return _.str.sprintf('<li>%s</li>',_.escape(fieldStr));});warnings.unshift('<ul>');warnings.push('</ul>');this.displayNotification({title:_t("Invalid fields:"),message:Markup(warnings.join('')),type:'danger',});},_onClickAttachDocument:function(ev){if($(ev.target).is('input.o_input_file')){return;}
var fieldNames=this.getParent().canBeSaved(this.state.id);if(fieldNames.length){return this._notifyInvalidFields(fieldNames);}
if(!this.res_id){return this.displayNotification({message:_t('Please save before attaching a file'),type:'danger'});}
this.$('input.o_input_file').trigger('click');},_onFileChanged:function(ev){ev.stopPropagation();this.$('form.o_form_binary_form').trigger('submit');framework.blockUI();},_onFileLoaded:function(){var self=this;var files=Array.prototype.slice.call(arguments,1);return new Promise(function(resolve){if(self.node.attrs.action){self._rpc({model:self.res_model,method:self.node.attrs.action,args:[self.res_id],kwargs:{attachment_ids:_.map(files,function(file){return file.id;}),}}).then(function(){resolve();});}else{resolve();}}).then(function(){self.trigger_up('reload');framework.unblockUI();});},});widgetRegistry.add('attach_document',AttachDocument);});;

/* /web/static/src/legacy/js/apps.js defined in bundle 'web.assets_backend' */
odoo.define('web.Apps',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var config=require('web.config');var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var _t=core._t;var apps_client=null;var Apps=AbstractAction.extend({contentTemplate:'EmptyComponent',remote_action_tag:'loempia.embed',failback_action_id:'base.open_module_tree',init:function(parent,action){this._super(parent,action);var options=action.params||{};this.params=options;},get_client:function(){var check_client_available=function(client){var i=new Image();var def=new Promise(function(resolve,reject){i.onerror=function(){reject(client);};i.onload=function(){resolve(client);};});var ts=new Date().getTime();i.src=_.str.sprintf('%s/web/static/img/sep-a.gif?%s',client.origin,ts);return def;};if(apps_client){return check_client_available(apps_client);}else{return this._rpc({model:'ir.module.module',method:'get_apps_server'}).then(function(u){var link=$(_.str.sprintf('<a href="%s"></a>',u))[0];var host=_.str.sprintf('%s//%s',link.protocol,link.host);var dbname=link.pathname;if(dbname[0]==='/'){dbname=dbname.substr(1);}
var client={origin:host,dbname:dbname};apps_client=client;return check_client_available(client);});}},destroy:function(){$(window).off("message."+this.uniq);if(this.$ifr){this.$ifr.remove();this.$ifr=null;}
return this._super();},_on_message:function($e){var self=this,client=this.client,e=$e.originalEvent;if(e.origin!==client.origin){return;}
var dispatcher={'event':function(m){self.trigger('message:'+m.event,m);},'action':function(m){self.do_action(m.action).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'rpc':function(m){return self._rpc({route:m.args[0],params:m.args[1]}).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'Model':function(m){return self._rpc({model:m.model,method:m.args[0],args:m.args[1]}).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},};if(!_.isObject(e.data)){return;}
if(dispatcher[e.data.type]){dispatcher[e.data.type](e.data);}},start:function(){var self=this;return new Promise(function(resolve,reject){self.get_client().then(function(client){self.client=client;var qs={db:client.dbname};if(config.isDebug()){qs.debug=odoo.debug;}
var u=$.param.querystring(client.origin+"/apps/embed/client",qs);var css={width:'100%',height:'750px'};self.$ifr=$('<iframe>').attr('src',u);self.uniq=_.uniqueId('apps');$(window).on("message."+self.uniq,self.proxy('_on_message'));self.on('message:ready',self,function(m){var w=this.$ifr[0].contentWindow;var act={type:'ir.actions.client',tag:this.remote_action_tag,params:_.extend({},this.params,{db:session.db,origin:session.origin,})};w.postMessage({type:'action',action:act},client.origin);});self.on('message:set_height',self,function(m){this.$ifr.height(m.height);});self.on('message:blockUI',self,function(){framework.blockUI();});self.on('message:unblockUI',self,function(){framework.unblockUI();});self.on('message:warn',self,function(m){self.displayNotification({title:m.title,message:m.message,sticky:m.sticky,type:'danger'});});self.$ifr.appendTo(self.$('.o_content')).css(css).addClass('apps-client');resolve();},function(){self.displayNotification({title:_t('Odoo Apps will be available soon'),message:_t('Showing locally available modules'),sticky:true,type:'danger'});return self._rpc({route:'/web/action/load',params:{action_id:self.failback_action_id},}).then(function(action){return self.do_action(action);}).then(reject,reject);});});}});var AppsUpdates=Apps.extend({remote_action_tag:'loempia.embed.updates',});core.action_registry.add("apps",Apps);core.action_registry.add("apps.updates",AppsUpdates);return Apps;});;

/* /web/static/src/legacy/js/env.js defined in bundle 'web.assets_backend' */
odoo.define('@web/legacy/js/env',async function(require){'use strict';let __exports={};const commonEnv=require('web.commonEnv');const dataManager=require('web.data_manager');const{blockUI,unblockUI}=require("web.framework");const env=Object.assign(commonEnv,{dataManager});env.services=Object.assign(env.services,{blockUI,unblockUI});__exports[Symbol.for("default")]=env;return __exports;});odoo.define(`web.env`,async function(require){return require('@web/legacy/js/env')[Symbol.for("default")];});;

/* /web/static/src/legacy/js/model.js defined in bundle 'web.assets_backend' */
odoo.define("web.Model",function(require){"use strict";const{groupBy,partitionBy}=require("web.utils");const Registry=require("web.Registry");const{Component,core}=owl;const{EventBus,Observer}=core;const isNotNull=(val)=>val!==null&&val!==undefined;class ModelExtension{constructor(config){this.config=config;this.env=this.config.env;this.shouldLoad=true;this.state={};}
async callLoad(params){if(this.shouldLoad){this.shouldLoad=false;await this.load(params);}}
dispatch(method,...args){if(method in this){this[method](...args);}}
exportState(){return this.state;}
get(){return null;}
importState(state){this.shouldLoad=!state;if(this.shouldLoad){this.prepareState();}else{Object.assign(this.state,state);}}
async load(){}
prepareState(){}}
ModelExtension.layer=0;class Model extends EventBus{constructor(extensions={},globalConfig={}){super();this.config=globalConfig;this.env=this.config.env;this.dispatching=false;this.extensions=[];this.externalState={};this.mapping={};this.rev=1;const{name,registry}=this.constructor;if(!registry||!(registry instanceof Registry)){throw new Error(`Unimplemented registry on model "${name}".`);}
const registryExtensions=Object.entries(registry.entries());const extensionNameLayers=registryExtensions.map(([name,{layer}])=>({name,layer}));const groupedNameLayers=groupBy(extensionNameLayers,"layer");for(const groupNameLayers of Object.values(groupedNameLayers)){for(const{name}of groupNameLayers){if(name in extensions){this.addExtension(name,extensions[name]);}}}
this.importState(this.config.importedState);}
addExtension(extensionName,extensionConfig){const{name,registry}=this.constructor;const Extension=registry.get(extensionName);if(!Extension){throw new Error(`Unknown model extension "${extensionName}" in model "${name}"`);}
const get=this.__get.bind(this,Extension.name);const trigger=this.trigger.bind(this);const config=Object.assign({get,trigger},this.config,extensionConfig);const extension=new Extension(config);if(!(Extension.layer in this.extensions)){this.extensions[Extension.layer]=[];}
this.extensions[Extension.layer].push(extension);}
dispatch(method,...args){const isInitialDispatch=!this.dispatching;this.dispatching=true;for(const extension of this.extensions.flat()){extension.dispatch(method,...args);}
if(!isInitialDispatch){return;}
this.dispatching=false;let rev=this.rev;this._loadExtensions({isInitialLoad:false}).then(()=>{if(rev===this.rev){this._notifyComponents();}});}
exportState(){const exported={};for(const extension of this.extensions.flat()){exported[extension.constructor.name]=extension.exportState();}
const fullState=Object.assign({},this.externalState,exported);return JSON.stringify(fullState);}
get(property,...args){for(const extension of this.extensions.flat()){const result=extension.get(property,...args);if(isNotNull(result)){return result;}}
return null;}
importState(stringifiedState="null"){const state=JSON.parse(stringifiedState)||{};Object.assign(this.externalState,state);for(const extension of this.extensions.flat()){extension.importState(state[extension.constructor.name]);}}
async load(){await this._loadExtensions({isInitialLoad:true});}
__get(excluded,property,...args){const results=[];for(const extension of this.extensions.flat()){if(extension.constructor.name!==excluded){const result=extension.get(property,...args);if(isNotNull(result)){results.push(result);}}}
return results;}
async _loadExtensions(params){for(let layer=0;layer<this.extensions.length;layer++){await Promise.all(this.extensions[layer].map((extension)=>extension.callLoad(params)));}}
async _notifyComponents(){const rev=++this.rev;const subscriptions=this.subscriptions.update||[];const groups=partitionBy(subscriptions,(s)=>s.owner?s.owner.__owl__.depth:-1);for(let group of groups){const proms=group.map((sub)=>sub.callback.call(sub.owner,rev));Component.scheduler.flush();await Promise.all(proms);}}}
Model.Extension=ModelExtension;function useModel(modelName){const component=Component.current;const model=component.env[modelName];if(!(model instanceof Model)){throw new Error(`No Model found when connecting '${
                component.name
                }'`);}
const mapping=model.mapping;const __owl__=component.__owl__;const componentId=__owl__.id;if(!__owl__.observer){__owl__.observer=new Observer();__owl__.observer.notifyCB=component.render.bind(component);}
const currentCB=__owl__.observer.notifyCB;__owl__.observer.notifyCB=function(){if(model.rev>mapping[componentId]){return;}
currentCB();};mapping[componentId]=0;const renderFn=__owl__.renderFn;__owl__.renderFn=function(comp,params){mapping[componentId]=model.rev;return renderFn(comp,params);};model.on("update",component,async(modelRev)=>{if(mapping[componentId]<modelRev){mapping[componentId]=modelRev;await component.render();}});const __destroy=component.__destroy;component.__destroy=(parent)=>{model.off("update",component);__destroy.call(component,parent);};return model;}
return{Model,useModel,};});;

/* /web/static/src/legacy/js/owl_compatibility.js defined in bundle 'web.assets_backend' */
odoo.define('web.OwlCompatibility',function(){"use strict";const{Component,hooks,tags}=owl;const{useRef,useSubEnv}=hooks;const{xml}=tags;const widgetSymbol=odoo.widgetSymbol;const children=new WeakMap();const templateForLegacy=tags.xml`<div/>`;const templateForOwl=tags.xml`<t t-component="props.Component" t-props="childProps" />`;class ComponentAdapter extends Component{constructor(parent,props){if(!props.Component){throw Error(`ComponentAdapter: 'Component' prop is missing.`);}
let template;if(!(props.Component.prototype instanceof Component)){template=templateForLegacy;}else{template=templateForOwl;}
ComponentAdapter.template=template;super(...arguments);this.template=template;ComponentAdapter.template=null;this.widget=null;}
get childProps(){if(!this._childProps){this._childProps=Object.assign({},this.props);delete this._childProps.Component;}
return this._childProps;}
willStart(){if(!(this.props.Component.prototype instanceof Component)){this.widget=new this.props.Component(this,...this.widgetArgs);return this.widget._widgetRenderAndInsert(()=>{});}}
willUpdateProps(nextProps){if(this.widget){return this.updateWidget(nextProps);}}
__patch(target,vnode){if(this.widget){if(this.__owl__.vnode){this.renderWidget();}
vnode.elm=this.widget.el;}
const result=super.__patch(...arguments);if(this.widget&&this.el!==this.widget.el){this.__owl__.vnode.elm=this.widget.el;}
return result;}
mounted(){if(this.widget&&this.widget.on_attach_callback){this.widget.on_attach_callback();}}
willUnmount(){if(this.widget&&this.widget.on_detach_callback){this.widget.on_detach_callback();}}
__destroy(){super.__destroy(...arguments);if(this.widget){this.widget.destroy();}}
get widgetArgs(){if(this.props.widgetArgs){return this.props.widgetArgs;}
const args=Object.keys(this.props);args.splice(args.indexOf('Component'),1);if(args.length>1){throw new Error(`ComponentAdapter has more than 1 argument, 'widgetArgs' must be overriden.`);}
return args.map(a=>this.props[a]);}
updateWidget(){if(this.env.isDebug('assets')){console.warn(`ComponentAdapter: Widget could not be updated, maybe override 'updateWidget' function?`);}}
renderWidget(){if(this.env.isDebug('assets')){console.warn(`ComponentAdapter: Widget could not be re-rendered, maybe override 'renderWidget' function?`);}}
_trigger_up(ev){const evType=ev.name;const payload=ev.data;if(evType==='call_service'){let args=payload.args||[];if(payload.service==='ajax'&&payload.method==='rpc'){args=args.concat(ev.target);}
const service=this.env.services[payload.service];if(service){const result=service[payload.method].apply(service,args);payload.callback(result);}else{throw new Error(`The service "${payload.service}" is not present in the legacy owl environment.
                         You should probably create a mapper in @web/legacy/utils`);}}else if(evType==='get_session'){if(payload.callback){payload.callback(this.env.session);}}else if(evType==='load_views'){const params={model:payload.modelName,context:payload.context,views_descr:payload.views,};this.env.dataManager.load_views(params,payload.options||{}).then(payload.on_success);}else if(evType==='load_filters'){return this.env.dataManager.load_filters(payload).then(payload.on_success);}else{payload.__targetWidget=ev.target;this.trigger(evType.replace(/_/g,'-'),payload);}}}
const WidgetAdapterMixin={on_attach_callback(){for(const component of children.get(this)||[]){component.on_attach_callback();}},on_detach_callback(){for(const component of children.get(this)||[]){component.on_detach_callback();}},destroy(){for(const component of children.get(this)||[]){component.env.qweb.off("update",component);component.__destroy();}
children.delete(this);},};class ComponentWrapper extends Component{constructor(parent,Component,props){if(parent instanceof Component){throw new Error('ComponentWrapper must be used with a legacy Widget as parent');}
super(null,props);if(parent){this._register(parent);}
useSubEnv({[widgetSymbol]:this._addListener.bind(this)});this.parentWidget=parent;this.Component=Component;this.props=props||{};this._handledEvents=new Set();this.componentRef=useRef("component");}
on_attach_callback(){function recursiveCallMounted(component){const{status,currentFiber}=component.__owl__;if(status===2&&currentFiber&&!currentFiber.isCompleted){return;}
if(status!==2&&status!==3&&status!==4){return;}
for(const key in component.__owl__.children){recursiveCallMounted(component.__owl__.children[key]);}
component.__callMounted();}
recursiveCallMounted(this);}
on_detach_callback(){this.__callWillUnmount();}
destroy(){if(this.parentWidget){const parentChildren=children.get(this.parentWidget);if(parentChildren){const index=parentChildren.indexOf(this);children.get(this.parentWidget).splice(index,1);}}
super.destroy();}
setParent(parent){if(parent instanceof Component){throw new Error('ComponentWrapper must be used with a legacy Widget as parent');}
this._register(parent);if(this.parentWidget){const parentChildren=children.get(this.parentWidget);parentChildren.splice(parentChildren.indexOf(this),1);}
this.parentWidget=parent;}
async update(props={}){if(this.__owl__.status===5){return new Promise(()=>{});}
Object.assign(this.props,props);let prom;if(this.__owl__.status===3){prom=this.render();}else{prom=this.mount(...this._mountArgs);}
return prom;}
_addListener(evType){if(this.parentWidget&&!this._handledEvents.has(evType)){this._handledEvents.add(evType);this.el.addEventListener(evType,ev=>{if(!ev.cancelBubble){ev.stopPropagation();const detail=Object.assign({},ev.detail,{__originalComponent:ev.originalComponent,});this.parentWidget.trigger_up(ev.type.replace(/-/g,'_'),detail);}});}}
_register(parent){let parentChildren=children.get(parent);if(!parentChildren){parentChildren=[];children.set(parent,parentChildren);}
parentChildren.push(this);}
async mount(target,options){if(options&&options.position==='self'){throw new Error('Unsupported position: "self" is not allowed for wrapper components. '+'Contact the JS Framework team or open an issue if your use case is relevant.');}
this._mountArgs=arguments;return super.mount(...arguments);}
get $el(){return $(this.el);}}
ComponentWrapper.template=xml`<t t-component="Component" t-props="props" t-ref="component"/>`;return{ComponentAdapter,ComponentWrapper,WidgetAdapterMixin,};});;

/* /base_setup/static/src/js/res_config_dev_tool.js defined in bundle 'web.assets_backend' */
odoo.define('base_setup.ResConfigDevTool',function(require){"use strict";var config=require('web.config');var Widget=require('web.Widget');var widget_registry=require('web.widget_registry');var ResConfigDevTool=Widget.extend({template:'res_config_dev_tool',events:{'click .o_web_settings_force_demo':'_onClickForceDemo',},init:function(){this._super.apply(this,arguments);this.isDebug=config.isDebug();this.isAssets=config.isDebug("assets");this.isTests=config.isDebug("tests");},willStart:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self._rpc({route:'/base_setup/demo_active',}).then(function(demo_active){self.demo_active=demo_active;});});},_onClickForceDemo:function(ev){ev.preventDefault();this.do_action('base.demo_force_install_action');},});widget_registry.add('res_config_dev_tool',ResConfigDevTool);});;

/* /base_setup/static/src/js/res_config_edition.js defined in bundle 'web.assets_backend' */
odoo.define('base_setup.ResConfigEdition',function(require){"use strict";var Widget=require('web.Widget');var widget_registry=require('web.widget_registry');var session=require('web.session');var ResConfigEdition=Widget.extend({template:'res_config_edition',init:function(){this._super.apply(this,arguments);this.server_version=session.server_version;this.expiration_date=session.expiration_date?moment(session.expiration_date):moment().add(30,'d');},});widget_registry.add('res_config_edition',ResConfigEdition);return ResConfigEdition;});;

/* /base_setup/static/src/js/res_config_invite_users.js defined in bundle 'web.assets_backend' */
odoo.define('base_setup.ResConfigInviteUsers',function(require){"use strict";var Widget=require('web.Widget');var widget_registry=require('web.widget_registry');var core=require('web.core');var _t=core._t;var ResConfigInviteUsers=Widget.extend({template:'res_config_invite_users',events:{'click .o_web_settings_invite':'_onClickInvite','click .o_web_settings_user':'_onClickUser','click .o_web_settings_more':'_onClickMore','keydown .o_user_emails':'_onKeydownUserEmails',},init:function(){this._super.apply(this,arguments);this.emails=[];},willStart:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self.load();});},load:function(){var self=this;return this._rpc({route:'/base_setup/data',}).then(function(data){self.active_users=data.active_users;self.pending_users=data.pending_users;self.action_pending_users=data.action_pending_users;self.pending_count=data.pending_count;self.resend_invitation=data.resend_invitation||false;});},_validateEmail:function(email){var re=/^([a-z0-9][-a-z0-9_\+\.]*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,63}(?:\.[a-z]{2})?)$/i;return re.test(email);},_invite:function(){var self=this;var $userEmails=this.$('.o_user_emails');$userEmails.prop('disabled',true);this.$('.o_web_settings_invite').prop('disabled',true);var value=$userEmails.val().trim();if(value){var emails=_.uniq(value.split(/[ ,;\n]+/));var invalidEmails=_.reject(emails,this._validateEmail);if(invalidEmails.length){this.displayNotification({message:_.str.sprintf(_t('Invalid email addresses: %s.'),invalidEmails.join(', ')),type:'danger'});}
emails=_.difference(emails,invalidEmails);if(!this.resend_invitation){var pendingEmails=_.map(this.pending_users,function(info){return info[1];});var existingEmails=_.intersection(emails,this.emails.concat(pendingEmails));if(existingEmails.length){this.displayNotification({message:_.str.sprintf(_t('Email addresses already existing: %s.'),existingEmails.join(', ')),type:'danger'});}
emails=_.difference(emails,existingEmails);}
if(emails.length){$userEmails.val('');this._rpc({model:'res.users',method:'web_create_users',args:[emails],}).then(function(){return self.load().then(function(){self.renderElement();self.$('.o_user_emails').focus();});});}else{$userEmails.prop('disabled',false);this.$('.o_web_settings_invite').prop('disabled',false);self.$('.o_user_emails').focus();}}},_onClickInvite:function(ev){if(this.$('.o_user_emails').val().length){var $button=$(ev.target);$button.button('loading');return this._invite();}},_onClickMore:function(ev){ev.preventDefault();this.do_action(this.action_pending_users);},_onClickUser:function(ev){ev.preventDefault();var user_id=$(ev.currentTarget).data('user-id');var action=Object.assign({},this.action_pending_users,{res_id:user_id});this.do_action(action);},_onKeydownUserEmails:function(ev){var keyCodes=[$.ui.keyCode.TAB,$.ui.keyCode.COMMA,$.ui.keyCode.ENTER];if(_.contains(keyCodes,ev.which)){ev.preventDefault();this._invite();}},});widget_registry.add('res_config_invite_users',ResConfigInviteUsers);});;

/* /bus/static/src/js/crosstab_bus.js defined in bundle 'web.assets_backend' */
odoo.define('bus.CrossTab',function(require){"use strict";var Longpolling=require('bus.Longpolling');var session=require('web.session');var CrossTabBus=Longpolling.extend({TAB_HEARTBEAT_PERIOD:10000,MASTER_TAB_HEARTBEAT_PERIOD:1500,HEARTBEAT_OUT_OF_DATE_PERIOD:5000,HEARTBEAT_KILL_OLD_PERIOD:15000,LOCAL_STORAGE_PREFIX:'bus',_isMasterTab:false,_isRegistered:false,init:function(){this._super.apply(this,arguments);var now=new Date().getTime();this._sanitizedOrigin=session.origin.replace(/:\/{0,2}/g,'_');this._currentTabChannels=new Set();this._id=_.uniqueId(this.LOCAL_STORAGE_PREFIX)+':'+now;if(this._callLocalStorage('getItem','last_ts',0)+50000<now){this._callLocalStorage('removeItem','last');}
this._lastNotificationID=this._callLocalStorage('getItem','last',0);this.call('local_storage','onStorage',this,this._onStorage);},destroy:function(){this._super();clearTimeout(this._heartbeatTimeout);},addChannel:function(channel){this._currentTabChannels.add(channel);this._super.apply(this,arguments);this._updateChannels();},deleteChannel:function(channel){this._currentTabChannels.delete(channel);this._super.apply(this,arguments);this._updateChannels();},getTabId:function(){return this._id;},isMasterTab:function(){return this._isMasterTab;},startPolling:function(){if(this._isActive===null){this._heartbeat=this._heartbeat.bind(this);}
if(!this._isRegistered){this._isRegistered=true;var peers=this._callLocalStorage('getItem','peers',{});peers[this._id]=new Date().getTime();this._callLocalStorage('setItem','peers',peers);this._registerWindowUnload();if(!this._callLocalStorage('getItem','master')){this._startElection();}
this._heartbeat();if(this._isMasterTab){this._callLocalStorage('setItem','options',this._options);}else{this._options=this._callLocalStorage('getItem','options',this._options);}
this._updateChannels();return;}
if(this._isMasterTab){this._super.apply(this,arguments);}},updateOption:function(){this._super.apply(this,arguments);this._callLocalStorage('setItem','options',this._options);},_callLocalStorage:function(method,key,param){return this.call('local_storage',method,this._generateKey(key),param);},_generateKey:function(key){return this.LOCAL_STORAGE_PREFIX+'.'+this._sanitizedOrigin+'.'+key;},_getLastPresence:function(){return this._callLocalStorage('getItem','lastPresence')||this._super();},_heartbeat:function(){var now=new Date().getTime();var heartbeatValue=parseInt(this._callLocalStorage('getItem','heartbeat',0));var peers=this._callLocalStorage('getItem','peers',{});if((heartbeatValue+this.HEARTBEAT_OUT_OF_DATE_PERIOD)<now){this._startElection();heartbeatValue=parseInt(this._callLocalStorage('getItem','heartbeat',0));}
if(this._isMasterTab){var cleanedPeers={};for(var peerName in peers){if(peers[peerName]+this.HEARTBEAT_KILL_OLD_PERIOD>now){cleanedPeers[peerName]=peers[peerName];}}
if(heartbeatValue!==this.lastHeartbeat){this._isMasterTab=false;this.lastHeartbeat=0;peers[this._id]=now;this._callLocalStorage('setItem','peers',peers);this.stopPolling();this.trigger('no_longer_master');}else{this.lastHeartbeat=now;this._callLocalStorage('setItem','heartbeat',now);this._callLocalStorage('setItem','peers',cleanedPeers);}}else{peers[this._id]=now;this._callLocalStorage('setItem','peers',peers);}
var hbPeriod=this._isMasterTab?this.MASTER_TAB_HEARTBEAT_PERIOD:this.TAB_HEARTBEAT_PERIOD;if(this._lastPresenceTime+hbPeriod>now){this._callLocalStorage('setItem','lastPresence',this._lastPresenceTime);}
this._heartbeatTimeout=setTimeout(this._heartbeat.bind(this),hbPeriod);},_registerWindowUnload:function(){$(window).on('unload.'+this._id,this._onUnload.bind(this));},_startElection:function(){if(this._isMasterTab){return;}
var now=new Date().getTime();var peers=this._callLocalStorage('getItem','peers',{});var heartbeatKillOld=now-this.HEARTBEAT_KILL_OLD_PERIOD;var newMaster;for(var peerName in peers){if(peers[peerName]<heartbeatKillOld){continue;}
newMaster=peerName;break;}
if(newMaster===this._id){this.lastHeartbeat=now;this._callLocalStorage('setItem','heartbeat',this.lastHeartbeat);this._callLocalStorage('setItem','master',true);this._isMasterTab=true;this.startPolling();this.trigger('become_master');delete peers[newMaster];this._callLocalStorage('setItem','peers',peers);}},_updateChannels:function(){const currentPeerIds=new Set(Object.keys(this._callLocalStorage('getItem','peers')||{}));const peerChannels=this._callLocalStorage('getItem','channels')||{};const peerChannelsBefore=JSON.stringify(peerChannels);peerChannels[this._id]=Array.from(this._currentTabChannels);for(const channelPeerId of Object.keys(peerChannels)){if(!currentPeerIds.has(channelPeerId)){delete peerChannels[channelPeerId];}}
const peerChannelsAfter=JSON.stringify(peerChannels);if(peerChannelsBefore===peerChannelsAfter){return false;}
this._callLocalStorage('setItem','channels',peerChannels);const allChannels=new Set();for(const channels of Object.values(peerChannels)){for(const channel of channels){allChannels.add(channel);}}
for(const channel of this._currentTabChannels){allChannels.add(channel);}
this._channels=Array.from(allChannels);return true;},_onFocusChange:function(params){this._super.apply(this,arguments);this._callLocalStorage('setItem','focus',params.focus);},_onPoll:function(notifications){var notifs=this._super(notifications);if(this._isMasterTab&&notifs.length){this._callLocalStorage('setItem','last',this._lastNotificationID);this._callLocalStorage('setItem','last_ts',new Date().getTime());this._callLocalStorage('setItem','notification',notifs);}},_onStorage:function(e){var value=JSON.parse(e.newValue);var key=e.key;if(this._isRegistered&&key===this._generateKey('master')&&!value){this._startElection();}
if(key===this._generateKey('last')){this._lastNotificationID=value||0;}
else if(key===this._generateKey('notification')){if(!this._isMasterTab){this.trigger("notification",value);}}
else if(key===this._generateKey('channels')){if(this._updateChannels()){this._restartPolling();};}
else if(key===this._generateKey('options')){this._options=value;}
else if(key===this._generateKey('focus')){this._isOdooFocused=value;this.trigger('window_focus',this._isOdooFocused);}},_onUnload:function(){var peers=this._callLocalStorage('getItem','peers')||{};delete peers[this._id];this._callLocalStorage('setItem','peers',peers);this._currentTabChannels.clear();this._updateChannels();if(this._isMasterTab){this._callLocalStorage('removeItem','master');}},});return CrossTabBus;});;

/* /bus/static/src/js/longpolling_bus.js defined in bundle 'web.assets_backend' */
odoo.define('bus.Longpolling',function(require){"use strict";var Bus=require('web.Bus');var ServicesMixin=require('web.ServicesMixin');var LongpollingBus=Bus.extend(ServicesMixin,{PARTNERS_PRESENCE_CHECK_PERIOD:30000,ERROR_RETRY_DELAY:10000,POLL_ROUTE:'/longpolling/poll',_isActive:null,_lastNotificationID:0,_isOdooFocused:true,_pollRetryTimeout:null,init:function(parent,params){this._super.apply(this,arguments);this._id=_.uniqueId('bus');this._longPollingBusId=this._id;this._options={};this._channels=[];this._lastPresenceTime=new Date().getTime();$(window).on("focus."+this._longPollingBusId,this._onFocusChange.bind(this,{focus:true}));$(window).on("blur."+this._longPollingBusId,this._onFocusChange.bind(this,{focus:false}));$(window).on("unload."+this._longPollingBusId,this._onFocusChange.bind(this,{focus:false}));$(window).on("click."+this._longPollingBusId,this._onPresence.bind(this));$(window).on("keydown."+this._longPollingBusId,this._onPresence.bind(this));$(window).on("keyup."+this._longPollingBusId,this._onPresence.bind(this));},destroy:function(){this.stopPolling();$(window).off("focus."+this._longPollingBusId);$(window).off("blur."+this._longPollingBusId);$(window).off("unload."+this._longPollingBusId);$(window).off("click."+this._longPollingBusId);$(window).off("keydown."+this._longPollingBusId);$(window).off("keyup."+this._longPollingBusId);this._super();},addChannel:function(channel){if(this._channels.indexOf(channel)===-1){this._channels.push(channel);this._restartPolling();}},deleteChannel:function(channel){var index=this._channels.indexOf(channel);if(index!==-1){this._channels.splice(index,1);if(this._pollRpc){this._pollRpc.abort();}}},isOdooFocused:function(){return this._isOdooFocused;},startPolling:function(){if(this._isActive===null){this._poll=this._poll.bind(this);}
if(!this._isActive){this._isActive=true;this._poll();}},stopPolling:function(){this._isActive=false;this._channels=[];clearTimeout(this._pollRetryTimeout);if(this._pollRpc){this._pollRpc.abort();}},updateOption:function(key,value){this._options[key]=value;},_getLastPresence:function(){return this._lastPresenceTime;},_poll:function(){var self=this;if(!this._isActive){return;}
var now=new Date().getTime();var options=_.extend({},this._options,{bus_inactivity:now-this._getLastPresence(),});var data={channels:this._channels,last:this._lastNotificationID,options:options};this._pollRpc=this._makePoll(data);this._pollRpc.then(function(result){self._pollRpc=false;self._onPoll(result);self._poll();}).guardedCatch(function(result){self._pollRpc=false;result.event.preventDefault();if(result.message==="XmlHttpRequestError abort"){self._poll();}else{self._pollRetryTimeout=setTimeout(self._poll,self.ERROR_RETRY_DELAY+(Math.floor((Math.random()*20)+1)*1000));}});},_makePoll:function(data){return this._rpc({route:this.POLL_ROUTE,params:data},{shadow:true,timeout:60000});},_onFocusChange:function(params){this._isOdooFocused=params.focus;if(params.focus){this._lastPresenceTime=new Date().getTime();this.trigger('window_focus',this._isOdooFocused);}},_onPoll:function(notifications){var self=this;var notifs=_.map(notifications,function(notif){if(notif.id>self._lastNotificationID){self._lastNotificationID=notif.id;}
return notif.message;});this.trigger("notification",notifs);return notifs;},_onPresence:function(){this._lastPresenceTime=new Date().getTime();},_restartPolling(){if(this._pollRpc){this._pollRpc.abort();}else{this.startPolling();}},});return LongpollingBus;});;

/* /bus/static/src/js/services/assets_watchdog_service.js defined in bundle 'web.assets_backend' */
odoo.define('@bus/js/services/assets_watchdog_service',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{session}=require("@web/session");const assetsWatchdogService=__exports.assetsWatchdogService={dependencies:["notification"],start(env,{notification}){let isNotificationDisplayed=false;let bundleNotifTimerID=null;env.bus.on("WEB_CLIENT_READY",null,async()=>{const legacyEnv=owl.Component.env;legacyEnv.services.bus_service.onNotification(this,onNotification);legacyEnv.services.bus_service.startPolling();});function displayBundleChangedNotification(){if(!isNotificationDisplayed){browser.clearTimeout(bundleNotifTimerID);bundleNotifTimerID=browser.setTimeout(()=>{notification.add(env._t("The page appears to be out of date."),{title:env._t("Refresh"),type:"warning",sticky:true,buttons:[{name:env._t("Refresh"),primary:true,onClick:()=>{browser.location.reload();},},],onClose:()=>{isNotificationDisplayed=false;},});isNotificationDisplayed=true;},getBundleNotificationDelay());}}
function getBundleNotificationDelay(){return 10000+Math.floor(Math.random()*50)*1000;}
function onNotification(notifications){for(const{payload,type}of notifications){if(type==='bundle_changed'){if(payload.server_version!==session.server_version){displayBundleChangedNotification();break;}}}}},};registry.category("services").add("assetsWatchdog",assetsWatchdogService);return __exports;});;

/* /bus/static/src/js/services/bus_service.js defined in bundle 'web.assets_backend' */
odoo.define('bus.BusService',function(require){"use strict";var CrossTab=require('bus.CrossTab');var core=require('web.core');var ServicesMixin=require('web.ServicesMixin');const session=require('web.session');var BusService=CrossTab.extend(ServicesMixin,{dependencies:['local_storage'],_audio:null,init:function(env){this.env=env;this._super();},_trigger_up:function(ev){if(ev.name==='call_service'){const payload=ev.data;let args=payload.args||[];if(payload.service==='ajax'&&payload.method==='rpc'){args=args.concat(ev.target);}
const service=this.env.services[payload.service];const result=service[payload.method].apply(service,args);payload.callback(result);}},start:function(){},sendNotification(options,callback){if(window.Notification&&Notification.permission==="granted"){if(this.isMasterTab()){try{this._sendNativeNotification(options.title,options.message,callback);}catch(error){if(error.message.indexOf('ServiceWorkerRegistration')>-1){this.displayNotification(options);this._beep();}else{throw error;}}}}else{this.displayNotification(options);if(this.isMasterTab()){this._beep();}}},onNotification:function(){this.on.apply(this,["notification"].concat(Array.prototype.slice.call(arguments)));},_beep:function(){if(typeof(Audio)!=="undefined"){if(!this._audio){this._audio=new Audio();var ext=this._audio.canPlayType("audio/ogg; codecs=vorbis")?".ogg":".mp3";this._audio.src=session.url("/mail/static/src/audio/ting"+ext);}
Promise.resolve(this._audio.play()).catch(_.noop);}},_sendNativeNotification:function(title,content,callback){var notification=new Notification(_.unescape(title),{body:_.unescape(content),icon:"/mail/static/src/img/odoobot_transparent.png"});notification.onclick=function(){window.focus();if(this.cancel){this.cancel();}else if(this.close){this.close();}
if(callback){callback();}};},});core.serviceRegistry.add('bus_service',BusService);return BusService;});;

/* /web_tour/static/src/debug/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('@web_tour/debug/debug_manager',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const ToursDialog=require("@web_tour/debug/tour_dialog_component")[Symbol.for("default")];const utils=require("web_tour.utils");__exports.disableTours=disableTours;function disableTours({env}){if(!env.services.user.isSystem){return null;}
const activeTours=env.services.tour.getActiveTours();if(activeTours.length===0){return null;}
return{type:"item",description:env._t("Disable Tours"),callback:async()=>{const tourNames=activeTours.map(tour=>tour.name);await env.services.orm.call("web_tour.tour","consume",[tourNames]);for(const tourName of tourNames){browser.localStorage.removeItem(utils.get_debugging_key(tourName));}
browser.location.reload();},sequence:50,};}
__exports.startTour=startTour;function startTour({env}){if(!env.services.user.isSystem){return null;}
return{type:"item",description:env._t("Start Tour"),callback:async()=>{env.services.dialog.add(ToursDialog);},sequence:60,};}
registry.category("debug").category("default").add("web_tour.startTour",startTour).add("web_tour.disableTours",disableTours);return __exports;});;

/* /web_tour/static/src/debug/tour_dialog_component.js defined in bundle 'web.assets_backend' */
odoo.define('@web_tour/debug/tour_dialog_component',async function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{Dialog}=require("@web/core/dialog/dialog");const{_lt}=require("@web/core/l10n/translation");const ToursDialog=__exports[Symbol.for("default")]=class ToursDialog extends Dialog{setup(){super.setup();this.tourService=useService("tour");this.onboardingTours=this.tourService.getOnboardingTours();this.testingTours=this.tourService.getTestingTours();}
_onStartTour(ev){this.tourService.reset(ev.target.dataset.name);this.close();}
_onTestTour(ev){this.tourService.run(ev.target.dataset.name);this.close();}}
ToursDialog.bodyTemplate="web_tour.ToursDialog";ToursDialog.title=_lt("Tours");return __exports;});;

/* /web_tour/static/src/services/tour_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web_tour/services/tour_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const tourManager=require("web_tour.tour");const tourService=__exports.tourService={start(){function _getAllTourMap(){return tourManager.tours;}
function _getActiveTourMap(){return Object.fromEntries(Object.entries(_getAllTourMap()).filter(([key,value])=>!tourManager.consumed_tours.includes(key)));}
function _fromTourMapToArray(tourMap){return Object.values(tourMap).sort((t1,t2)=>{return t1.sequence-t2.sequence||(t1.name<t2.name?-1:1);});}
function getAllTours(){return _fromTourMapToArray(_getAllTourMap());}
function getActiveTours(){return _fromTourMapToArray(_getActiveTourMap());}
function getOnboardingTours(){return getAllTours().filter((t)=>!t.test);}
function getTestingTours(){return getAllTours().filter((t)=>t.test);}
function run(tourName){return tourManager.run(tourName);}
function reset(tourName){return tourManager.reset(tourName);}
return{getAllTours,getActiveTours,getOnboardingTours,getTestingTours,run,reset,};},};registry.category("services").add("tour",tourService);return __exports;});;

/* /mail/static/src/js/activity.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/activity',async function(require){'use strict';let __exports={};const mailUtils=require('@mail/js/utils');const AbstractField=require('web.AbstractField');const BasicModel=require('web.BasicModel');const config=require('web.config');const core=require('web.core');const field_registry=require('web.field_registry');const session=require('web.session');const framework=require('web.framework');const time=require('web.time');var QWeb=core.qweb;var _t=core._t;const _lt=core._lt;function _readActivities(self,ids){if(!ids.length){return Promise.resolve([]);}
var context=self.getSession().user_context;if(self.record&&!_.isEmpty(self.record.getContext())){context=self.record.getContext();}
return self._rpc({model:'mail.activity',method:'activity_format',args:[ids],context:context,}).then(function(activities){_.each(activities,function(activity){activity.create_date=moment(time.auto_str_to_date(activity.create_date));activity.date_deadline=moment(time.auto_str_to_date(activity.date_deadline));});activities=_.sortBy(activities,'date_deadline');return activities;});}
BasicModel.include({_fetchSpecialActivity:function(record,fieldName){var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];return _readActivities(this,this.localData[localID].res_ids);},});var setDelayLabel=function(activities){var today=moment().startOf('day');_.each(activities,function(activity){var toDisplay='';var diff=activity.date_deadline.diff(today,'days',true);if(diff===0){toDisplay=_t("Today");}else{if(diff<0){if(diff===-1){toDisplay=_t("Yesterday");}else{toDisplay=_.str.sprintf(_t("%d days overdue"),Math.abs(diff));}}else{if(diff===1){toDisplay=_t("Tomorrow");}else{toDisplay=_.str.sprintf(_t("Due in %d days"),Math.abs(diff));}}}
activity.label_delay=toDisplay;});return activities;};var setFileUploadID=function(activities){_.each(activities,function(activity){if(activity.activity_category==='upload_file'){activity.fileuploadID=_.uniqueId('o_fileupload');}});return activities;};var BasicActivity=AbstractField.extend({events:{'click .o_edit_activity':'_onEditActivity','change input.o_input_file':'_onFileChanged','click .o_mark_as_done':'_onMarkActivityDone','click .o_mark_as_done_upload_file':'_onMarkActivityDoneUploadFile','click .o_activity_template_preview':'_onPreviewMailTemplate','click .o_schedule_activity':'_onScheduleActivity','click .o_activity_template_send':'_onSendMailTemplate','click .o_unlink_activity':'_onUnlinkActivity',},init:function(){this._super.apply(this,arguments);this._draftFeedback={};},scheduleActivity:function(){var callback=this._reload.bind(this,{activity:true,thread:true});return this._openActivityForm(false,callback);},_getActivityFormAction(id){return{type:'ir.actions.act_window',name:_t("Schedule Activity"),res_model:'mail.activity',view_mode:'form',views:[[false,'form']],target:'new',context:{default_res_id:this.res_id,default_res_model:this.model,},res_id:id||false,};},_markActivityDone:function(params){var activityID=params.activityID;var feedback=params.feedback||false;var attachmentIds=params.attachmentIds||[];return this._sendActivityFeedback(activityID,feedback,attachmentIds).then(this._reload.bind(this,{activity:true,thread:true}));},_markActivityDoneAndScheduleNext:function(params){var activityID=params.activityID;var feedback=params.feedback;var self=this;this._rpc({model:'mail.activity',method:'action_feedback_schedule_next',args:[[activityID]],kwargs:{feedback:feedback},context:this.record.getContext(),}).then(function(rslt_action){if(rslt_action){self.do_action(rslt_action,{on_close:function(){self.trigger_up('reload',{keepChanges:true});},});}else{self.trigger_up('reload',{keepChanges:true});}});},_openActivityForm:function(id,callback){var action=this._getActivityFormAction(id);return this.do_action(action,{on_close:callback});},_sendActivityFeedback:function(activityID,feedback,attachmentIds){return this._rpc({model:'mail.activity',method:'action_feedback',args:[[activityID]],kwargs:{feedback:feedback,attachment_ids:attachmentIds||[],},context:this.record.getContext(),});},_bindOnUploadAction:function(activities){var self=this;_.each(activities,function(activity){if(activity.fileuploadID){$(window).on(activity.fileuploadID,function(){framework.unblockUI();var files=Array.prototype.slice.call(arguments,1);self._markActivityDone({activityID:activity.id,attachmentIds:_.pluck(files,'id')}).then(function(){self.trigger_up('reload',{keepChanges:true});});});}});},_bindPopoverFocusout:function($popover_el){var self=this;var $popover=$($popover_el.data("bs.popover").tip);var activityID=$popover_el.data('activity-id');$popover.off('focusout');$popover.focusout(function(e){if(!$popover.is(e.relatedTarget)&&!$popover.find(e.relatedTarget).length){self._draftFeedback[activityID]=$popover.find('#activity_feedback').val();$popover.popover('hide');}});},_onEditActivity:function(ev){ev.preventDefault();var activityID=$(ev.currentTarget).data('activity-id');return this._openActivityForm(activityID,this._reload.bind(this,{activity:true,thread:true}));},_onFileChanged:function(ev){ev.stopPropagation();ev.preventDefault();var $form=$(ev.currentTarget).closest('form');$form.submit();framework.blockUI();},_onMarkActivityDone:function(ev){ev.stopPropagation();ev.preventDefault();var self=this;var $markDoneBtn=$(ev.currentTarget);var activityID=$markDoneBtn.data('activity-id');var previousActivityTypeID=$markDoneBtn.data('previous-activity-type-id')||false;var chainingTypeActivity=$markDoneBtn.data('chaining-type-activity');if($markDoneBtn.data('toggle')==='collapse'){var $actLi=$markDoneBtn.parents('.o_log_activity');var $panel=self.$('#o_activity_form_'+activityID);if(!$panel.data('bs.collapse')){var $form=$(QWeb.render('mail.activity_feedback_form',{previous_activity_type_id:previousActivityTypeID,chaining_type:chainingTypeActivity}));$panel.append($form);self._onMarkActivityDoneActions($markDoneBtn,$form,activityID);_.each($panel.siblings('.o_activity_form'),function(el){if($(el).data('bs.collapse')){$(el).empty().collapse('dispose').removeClass('show');}});$markDoneBtn.parents('.o_activity_log_container').scrollTo($actLi.position().top,100);}
$panel.on('hidden.bs.collapse',function(){if($panel.data('bs.collapse')){$actLi.removeClass('o_activity_selected');$panel.collapse('dispose');$panel.empty();}});this.$('.o_activity_selected').removeClass('o_activity_selected');$actLi.toggleClass('o_activity_selected');$panel.collapse('toggle');}else if(!$markDoneBtn.data('bs.popover')){$markDoneBtn.popover({template:$(Popover.Default.template).addClass('o_mail_activity_feedback')[0].outerHTML,container:$markDoneBtn,title:_t("Feedback"),html:true,trigger:'manual',placement:'right',content:function(){var $popover=$(QWeb.render('mail.activity_feedback_form',{previous_activity_type_id:previousActivityTypeID,chaining_type:chainingTypeActivity}));self._onMarkActivityDoneActions($markDoneBtn,$popover,activityID);return $popover;},}).on('shown.bs.popover',function(){var $popover=$($(this).data("bs.popover").tip);$(".o_mail_activity_feedback.popover").not($popover).popover("hide");$popover.addClass('o_mail_activity_feedback').attr('tabindex',0);$popover.find('#activity_feedback').focus();self._bindPopoverFocusout($(this));}).popover('show');}else{var popover=$markDoneBtn.data('bs.popover');if($('#'+popover.tip.id).length===0){popover.show();}}},_onMarkActivityDoneActions:function($btn,$form,activityID){var self=this;$form.find('#activity_feedback').val(self._draftFeedback[activityID]);$form.on('click','.o_activity_popover_done',function(ev){ev.stopPropagation();self._markActivityDone({activityID:activityID,feedback:$form.find('#activity_feedback').val(),});});$form.on('click','.o_activity_popover_done_next',function(ev){ev.stopPropagation();self._markActivityDoneAndScheduleNext({activityID:activityID,feedback:$form.find('#activity_feedback').val(),});});$form.on('click','.o_activity_popover_discard',function(ev){ev.stopPropagation();if($btn.data('bs.popover')){$btn.popover('hide');}else if($btn.data('toggle')==='collapse'){self.$('#o_activity_form_'+activityID).collapse('hide');}});},_onMarkActivityDoneUploadFile:function(ev){ev.preventDefault();ev.stopPropagation();var fileuploadID=$(ev.currentTarget).data('fileupload-id');var $input=this.$("[target='"+fileuploadID+"'] > input.o_input_file");$input.click();},_onPreviewMailTemplate:function(ev){ev.stopPropagation();ev.preventDefault();var self=this;var templateID=$(ev.currentTarget).data('template-id');var action={name:_t('Compose Email'),type:'ir.actions.act_window',res_model:'mail.compose.message',views:[[false,'form']],target:'new',context:{default_res_id:this.res_id,default_model:this.model,default_use_template:true,default_template_id:templateID,force_email:true,},};return this.do_action(action,{on_close:function(){self.trigger_up('reload',{keepChanges:true});}});},_onSendMailTemplate:function(ev){ev.stopPropagation();ev.preventDefault();var templateID=$(ev.currentTarget).data('template-id');return this._rpc({model:this.model,method:'activity_send_mail',args:[[this.res_id],templateID],}).then(this._reload.bind(this,{activity:true,thread:true,followers:true}));},_onScheduleActivity:function(ev){ev.preventDefault();return this._openActivityForm(false,this._reload.bind(this));},_onUnlinkActivity:function(ev,options){ev.preventDefault();var activityID=$(ev.currentTarget).data('activity-id');options=_.defaults(options||{},{model:'mail.activity',args:[[activityID]],});return this._rpc({model:options.model,method:'unlink',args:options.args,}).then(this._reload.bind(this,{activity:true}));},_unbindOnUploadAction:function(activities){_.each(activities,function(activity){if(activity.fileuploadID){$(window).off(activity.fileuploadID);}});},});var KanbanActivity=BasicActivity.extend({template:'mail.KanbanActivity',events:_.extend({},BasicActivity.prototype.events,{'show.bs.dropdown':'_onDropdownShow',}),fieldDependencies:_.extend({},BasicActivity.prototype.fieldDependencies,{activity_exception_decoration:{type:'selection'},activity_exception_icon:{type:'char'},activity_state:{type:'selection'},}),init:function(parent,name,record){this._super.apply(this,arguments);var selection={};_.each(record.fields.activity_state.selection,function(value){selection[value[0]]=value[1];});this.selection=selection;this._setState(record);},destroy:function(){this._unbindOnUploadAction();return this._super.apply(this,arguments);},_reload:function(){this.trigger_up('reload',{db_id:this.record_id,keepChanges:true});},_render:function(){const spanClasses=['fa','fa-lg','fa-fw'];spanClasses.push('o_activity_color_'+(this.activityState||'default'));if(this.recordData.activity_exception_decoration){spanClasses.push('text-'+this.recordData.activity_exception_decoration);spanClasses.push(this.recordData.activity_exception_icon);}else{spanClasses.push('fa-clock-o');}
this.$('.o_activity_btn > span').removeClass().addClass(spanClasses.join(' '));if(this.$el.hasClass('show')){this._renderDropdown();}},_renderDropdown:function(){var self=this;this.$('.o_activity').toggleClass('dropdown-menu-right',config.device.isMobile).html(QWeb.render('mail.KanbanActivityLoading'));return _readActivities(this,this.value.res_ids).then(function(activities){activities=setFileUploadID(activities);self.$('.o_activity').html(QWeb.render('mail.KanbanActivityDropdown',{selection:self.selection,records:_.groupBy(setDelayLabel(activities),'state'),session:session,widget:self,}));self._bindOnUploadAction(activities);});},_reset:function(record){this._super.apply(this,arguments);this._setState(record);},_setState:function(record){this.record_id=record.id;this.activityState=this.recordData.activity_state;},_onDropdownShow:function(){this._renderDropdown();},});const ListActivity=KanbanActivity.extend({template:'mail.ListActivity',events:Object.assign({},KanbanActivity.prototype.events,{'click .dropdown-menu.o_activity':'_onDropdownClicked',}),fieldDependencies:_.extend({},KanbanActivity.prototype.fieldDependencies,{activity_summary:{type:'char'},activity_type_id:{type:'many2one',relation:'mail.activity.type'},activity_type_icon:{type:'char'},}),label:_lt('Next Activity'),_render:async function(){await this._super(...arguments);this.$('.o_activity_btn > span').prop('special_click',true);if(this.value.count){let text;if(this.recordData.activity_exception_decoration){text=_t('Warning');}else{text=this.recordData.activity_summary||this.recordData.activity_type_id.data.display_name;}
this.$('.o_activity_summary').text(text);}
if(this.recordData.activity_type_icon){this.el.querySelector('.o_activity_btn > span').classList.replace('fa-clock-o',this.recordData.activity_type_icon);}},_onDropdownClicked:function(ev){ev.stopPropagation();},});var ActivityException=AbstractField.extend({noLabel:true,fieldDependencies:_.extend({},AbstractField.prototype.fieldDependencies,{activity_exception_icon:{type:'char'}}),_renderEdit:function(){return this._renderReadonly();},_renderReadonly:function(){this.$el.empty();if(this.value){this.$el.attr({title:_t('This record has an exception activity.'),class:"pull-right mt-1 text-"+this.value+" fa "+this.recordData.activity_exception_icon});}}});field_registry.add('kanban_activity',KanbanActivity).add('list_activity',ListActivity).add('activity_exception',ActivityException);return __exports;});;

/* /mail/static/src/js/basic_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/basic_view',async function(require){'use strict';let __exports={};const BasicView=require('web.BasicView');const mailWidgets=['kanban_activity'];BasicView.include({init:function(){this._super.apply(this,arguments);const post_refresh=this._getFieldOption('message_ids','post_refresh',false);const followers_post_refresh=this._getFieldOption('message_follower_ids','post_refresh',false);this.chatterFields={hasActivityIds:this._hasField('activity_ids'),hasMessageFollowerIds:this._hasField('message_follower_ids'),hasMessageIds:this._hasField('message_ids'),hasRecordReloadOnAttachmentsChanged:post_refresh==='always',hasRecordReloadOnMessagePosted:!!post_refresh,hasRecordReloadOnFollowersUpdate:!!followers_post_refresh,isAttachmentBoxVisibleInitially:(this._getFieldOption('message_ids','open_attachments',false)||this._getFieldOption('message_follower_ids','open_attachments',false)),};const fieldsInfo=this.fieldsInfo[this.viewType];this.rendererParams.chatterFields=this.chatterFields;this.mailFields={};for(const fieldName in fieldsInfo){const fieldInfo=fieldsInfo[fieldName];if(_.contains(mailWidgets,fieldInfo.widget)){this.mailFields[fieldInfo.widget]=fieldName;fieldInfo.__no_fetch=true;}}
this.rendererParams.activeActions=this.controllerParams.activeActions;this.rendererParams.mailFields=this.mailFields;},_getFieldOption(fieldName,optionName,defaultValue){const field=this.fieldsInfo[this.viewType][fieldName];if(field&&field.options&&field.options[optionName]!==undefined){return field.options[optionName];}
return defaultValue;},_hasField(fieldName){return!!this.fieldsInfo[this.viewType][fieldName];},});return __exports;});;

/* /mail/static/src/js/core/translation.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/core/translation',async function(require){'use strict';let __exports={};const{TranslationDataBase}=require('web.translation');TranslationDataBase.include({set_bundle(){const res=this._super(...arguments);if(owl.Component.env.services&&owl.Component.env.services.messaging){owl.Component.env.services.messaging.get().then(messaging=>{messaging.locale.update({language:this.parameters.code,textDirection:this.parameters.direction,});});}
return res;},});return __exports;});;

/* /mail/static/src/js/custom_filter_item.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/custom_filter_item',async function(require){'use strict';let __exports={};const CustomFilterItem=require('web.CustomFilterItem');const{patch}=require('web.utils');patch(CustomFilterItem.prototype,'mail.CustomFilterItem',{_validateField(field){return this._super(...arguments)&&field.relation!=='mail.message'&&field.name!=='message_ids';},});__exports[Symbol.for("default")]=CustomFilterItem;return __exports;});;

/* /mail/static/src/js/document_viewer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/document_viewer',async function(require){'use strict';let __exports={};const core=require('web.core');const Widget=require('web.Widget');const{hidePDFJSButtons}=require('@web/legacy/js/libs/pdfjs');var QWeb=core.qweb;var SCROLL_ZOOM_STEP=0.1;var ZOOM_STEP=0.5;var DocumentViewer=Widget.extend({template:"DocumentViewer",events:{'click .o_download_btn':'_onDownload','click .o_viewer_img':'_onImageClicked','click .o_viewer_video':'_onVideoClicked','click .move_next':'_onNext','click .move_previous':'_onPrevious','click .o_rotate':'_onRotate','click .o_zoom_in':'_onZoomIn','click .o_zoom_out':'_onZoomOut','click .o_zoom_reset':'_onZoomReset','click .o_close_btn, .o_viewer_img_wrapper':'_onClose','click .o_print_btn':'_onPrint','DOMMouseScroll .o_viewer_content':'_onScroll','mousewheel .o_viewer_content':'_onScroll','keydown':'_onKeydown','keyup':'_onKeyUp','mousedown .o_viewer_img':'_onStartDrag','mousemove .o_viewer_content':'_onDrag','mouseup .o_viewer_content':'_onEndDrag'},init:function(parent,attachments,activeAttachmentID){this._super.apply(this,arguments);this.attachment=_.filter(attachments,function(attachment){var match=attachment.type==='url'?attachment.url.match("(youtu|.png|.jpg|.gif)"):attachment.mimetype.match("(image|video|application/pdf|text)");if(match){attachment.fileType=match[1];if(match[1].match("(.png|.jpg|.gif)")){attachment.fileType='image';}
if(match[1]==='youtu'){var youtube_array=attachment.url.split('/');var youtube_token=youtube_array[youtube_array.length-1];if(youtube_token.indexOf('watch')!==-1){youtube_token=youtube_token.split('v=')[1];var amp=youtube_token.indexOf('&')
if(amp!==-1){youtube_token=youtube_token.substring(0,amp);}}
attachment.youtube=youtube_token;}
return true;}});this.activeAttachment=_.findWhere(attachments,{id:activeAttachmentID});this.modelName='ir.attachment';this._reset();},setElement:function(){const result=this._super(...arguments);this._hidePdfButtonsIfPresent();return result;},start:function(){this.$el.modal('show');this.$el.on('hidden.bs.modal',_.bind(this._onDestroy,this));this.$('.o_viewer_img').on("load",_.bind(this._onImageLoaded,this));this.$('[data-toggle="tooltip"]').tooltip({delay:0});return this._super.apply(this,arguments);},destroy:function(){if(this.isDestroyed()){return;}
this.$el.modal('hide');this.$el.remove();this._super.apply(this,arguments);},_hidePdfButtonsIfPresent:function(){if(this.activeAttachment.mimetype==='application/pdf'){hidePDFJSButtons(this.el);}},_next:function(){var index=_.findIndex(this.attachment,this.activeAttachment);index=(index+1)%this.attachment.length;this.activeAttachment=this.attachment[index];this._updateContent();},_previous:function(){var index=_.findIndex(this.attachment,this.activeAttachment);index=index===0?this.attachment.length-1:index-1;this.activeAttachment=this.attachment[index];this._updateContent();},_reset:function(){this.scale=1;this.dragStartX=this.dragstopX=0;this.dragStartY=this.dragstopY=0;},_updateContent:function(){this.$('.o_viewer_content').html(QWeb.render('DocumentViewer.Content',{widget:this}));this.$('.o_viewer_img').on("load",_.bind(this._onImageLoaded,this));this._hidePdfButtonsIfPresent();this.$('[data-toggle="tooltip"]').tooltip({delay:0});this._reset();},_getTransform:function(scale,angle){return'scale3d('+scale+', '+scale+', 1) rotate('+angle+'deg)';},_rotate:function(angle){this._reset();var new_angle=(this.angle||0)+angle;this.$('.o_viewer_img').css('transform',this._getTransform(this.scale,new_angle));this.$('.o_viewer_img').css('max-width',new_angle%180!==0?$(document).height():'100%');this.$('.o_viewer_img').css('max-height',new_angle%180!==0?$(document).width():'100%');this.angle=new_angle;},_zoom:function(scale){if(scale>0.5){this.$('.o_viewer_img').css('transform',this._getTransform(scale,this.angle||0));this.scale=scale;}
this.$('.o_zoom_reset').add('.o_zoom_out').toggleClass('disabled',scale===1);},_onClose:function(e){e.preventDefault();this.destroy();},_onDestroy:function(){this.destroy();},_onDownload:function(e){e.preventDefault();window.location='/web/content/'+this.modelName+'/'+this.activeAttachment.id+'/'+'datas'+'?download=true';},_onDrag:function(e){e.preventDefault();if(this.enableDrag){var $image=this.$('.o_viewer_img');var $zoomer=this.$('.o_viewer_zoomer');var top=$image.prop('offsetHeight')*this.scale>$zoomer.height()?e.clientY-this.dragStartY:0;var left=$image.prop('offsetWidth')*this.scale>$zoomer.width()?e.clientX-this.dragStartX:0;$zoomer.css("transform","translate3d("+left+"px, "+top+"px, 0)");$image.css('cursor','move');}},_onEndDrag:function(e){e.preventDefault();if(this.enableDrag){this.enableDrag=false;this.dragstopX=e.clientX-this.dragStartX;this.dragstopY=e.clientY-this.dragStartY;this.$('.o_viewer_img').css('cursor','');}},_onImageClicked:function(e){e.stopPropagation();},_onImageLoaded:function(){this.$('.o_loading_img').hide();},_onKeydown:function(e){switch(e.which){case $.ui.keyCode.RIGHT:e.preventDefault();this._next();break;case $.ui.keyCode.LEFT:e.preventDefault();this._previous();break;}},_onKeyUp:function(e){switch(e.which){case $.ui.keyCode.ESCAPE:e.preventDefault();this._onClose(e);break;}},_onNext:function(e){e.preventDefault();this._next();},_onPrevious:function(e){e.preventDefault();this._previous();},_onPrint:function(e){e.preventDefault();var src=this.$('.o_viewer_img').prop('src');var script=QWeb.render('PrintImage',{src:src});var printWindow=window.open('about:blank',"_new");printWindow.document.open();printWindow.document.write(script);printWindow.document.close();},_onScroll:function(e){var scale;if(e.originalEvent.wheelDelta>0||e.originalEvent.detail<0){scale=this.scale+SCROLL_ZOOM_STEP;this._zoom(scale);}else{scale=this.scale-SCROLL_ZOOM_STEP;this._zoom(scale);}},_onStartDrag:function(e){e.preventDefault();this.enableDrag=true;this.dragStartX=e.clientX-(this.dragstopX||0);this.dragStartY=e.clientY-(this.dragstopY||0);},_onVideoClicked:function(e){e.stopPropagation();var videoElement=e.target;if(videoElement.paused){videoElement.play();}else{videoElement.pause();}},_onRotate:function(e){e.preventDefault();this._rotate(90);},_onZoomIn:function(e){e.preventDefault();var scale=this.scale+ZOOM_STEP;this._zoom(scale);},_onZoomOut:function(e){e.preventDefault();var scale=this.scale-ZOOM_STEP;this._zoom(scale);},_onZoomReset:function(e){e.preventDefault();this.$('.o_viewer_zoomer').css("transform","");this._zoom(1);},});__exports[Symbol.for("default")]=DocumentViewer;return __exports;});;

/* /mail/static/src/js/emojis.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/emojis',async function(require){'use strict';let __exports={};const data={":)":"😊",":-)":"😊","=)":"😊",":]":"😊",":D":"😃",":-D":"😃","=D":"😃","xD":"😆","XD":"😆","x'D":"😂",";)":"😉",";-)":"😉","B)":"😎","8)":"😎","B-)":"😎","8-)":"😎",";p":"😜",";P":"😜",":p":"😋",":P":"😋",":-p":"😋",":-P":"😋","=P":"😋","xp":"😝","xP":"😝","o_o":"😳",":|":"😐",":-|":"😐",":/":"😕",":-/":"😕",":(":"😞",":@":"😱",":O":"😲",":-O":"😲",":o":"😲",":-o":"😲",":'o":"😨","3:(":"😠",">:(":"😠","3:)":"😈",">:)":"😈",":*":"😘",":-*":"😘","o:)":"😇",":'(":"😢",":'-(":"😭",":\"(":"😭","<3":"❤️","&lt;3":"❤️",":heart":"❤️","</3":"💔","&lt;/3":"💔",":heart_eyes":"😍",":turban":"👳",":+1":"👍",":-1":"👎",":ok":"👌",":poop":"💩",":no_see":"🙈",":no_hear":"🙉",":no_speak":"🙊",":bug":"🐞",":kitten":"😺",":bear":"🐻",":snail":"🐌",":boar":"🐗",":clover":"🍀",":sunflower":"🌹",":fire":"🔥",":sun":"☀️",":partly_sunny:":"⛅️",":rainbow":"🌈",":cloud":"☁️",":zap":"⚡️",":star":"⭐️",":cookie":"🍪",":pizza":"🍕",":hamburger":"🍔",":fries":"🍟",":cake":"🎂",":cake_part":"🍰",":coffee":"☕️",":banana":"🍌",":sushi":"🍣",":rice_ball":"🍙",":beer":"🍺",":wine":"🍷",":cocktail":"🍸",":tropical":"🍹",":beers":"🍻",":ghost":"👻",":skull":"💀",":et":"👽",":alien":"👽",":party":"🎉",":trophy":"🏆",":key":"🔑",":pin":"📌",":postal_horn":"📯",":music":"🎵",":trumpet":"🎺",":guitar":"🎸",":run":"🏃",":bike":"🚲",":soccer":"⚽️",":football":"🏈",":8ball":"🎱",":clapper":"🎬",":microphone":"🎤",":cheese":"🧀",};var emojiDict={};_.each(data,function(unicode,source){if(!emojiDict[unicode]){emojiDict[unicode]={sources:[source],unicode:unicode,description:source,};}else{emojiDict[unicode].sources.push(source);}});const emojis=__exports.emojis=_.values(emojiDict);__exports[Symbol.for("default")]=emojis;return __exports;});;

/* /mail/static/src/js/emojis_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/emojis_mixin',async function(require){'use strict';let __exports={};const emojis=require('@mail/js/emojis')[Symbol.for("default")];__exports[Symbol.for("default")]={_onEmojiClick:function(ev){var unicode=ev.currentTarget.textContent.trim();var textInput=this._getTargetTextElement($(ev.currentTarget))[0];var selectionStart=textInput.selectionStart;textInput.value=textInput.value.slice(0,selectionStart)+unicode+textInput.value.slice(selectionStart);textInput.focus();textInput.setSelectionRange(selectionStart+unicode.length,selectionStart+unicode.length);},_formatText:function(message){message=this._htmlEscape(message);message=this._wrapEmojis(message);message=message.replace(/(?:\r\n|\r|\n)/g,'<br>');return message;},_htmlEscape:function(s){if(s==null){return'';}
return String(s).replace(/</g,'&lt;').replace(/>/g,'&gt;');},_wrapEmojis:function(message){emojis.forEach(function(emoji){message=message.replace(new RegExp(emoji.unicode.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'g'),'<span class="o_mail_emoji">'+emoji.unicode+'</span>');});return message;}};return __exports;});;

/* /mail/static/src/js/field_char.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/field_char',async function(require){'use strict';let __exports={};const{FieldChar}=require('web.basic_fields');FieldChar.include({init:function(){this._super.apply(this,arguments);this._triggerOnchange=_.debounce(this._triggerOnchange,2000);},_onKeydown:function(){this._super.apply(this,arguments);if(this.nodeOptions.onchange_on_keydown){this._triggerOnchange();}},_triggerOnchange:function(){this.$input.trigger('change');},});return __exports;});;

/* /mail/static/src/js/field_char_emojis.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/field_char_emojis',async function(require){'use strict';let __exports={};const MailEmojisMixin=require('@mail/js/emojis_mixin')[Symbol.for("default")];const FieldEmojiCommon=require('@mail/js/field_emojis_common')[Symbol.for("default")];const basicFields=require('web.basic_fields');const registry=require('web.field_registry');var FieldCharEmojis=basicFields.FieldChar.extend(MailEmojisMixin,FieldEmojiCommon);registry.add('char_emojis',FieldCharEmojis);__exports[Symbol.for("default")]=FieldCharEmojis;return __exports;});;

/* /mail/static/src/js/field_emojis_common.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/field_emojis_common',async function(require){'use strict';let __exports={};const emojis=require('@mail/js/emojis')[Symbol.for("default")];const MailEmojisMixin=require('@mail/js/emojis_mixin')[Symbol.for("default")];const basicFields=require('web.basic_fields');const core=require('web.core');var _onEmojiClickMixin=MailEmojisMixin._onEmojiClick;var QWeb=core.qweb;var FieldEmojiCommon={init:function(){this._super.apply(this,arguments);this._triggerOnchange=_.debounce(this._triggerOnchange,2000);this.emojis=emojis;},on_attach_callback:function(){this._attachEmojisDropdown();},_render:function(){this._super.apply(this,arguments);if(this.mode!=='edit'){this.$el.html(this._formatText(this.$el.text()));}},_onEmojiClick:function(){_onEmojiClickMixin.apply(this,arguments);this._isDirty=true;this.$input.trigger('change');},_onKeydown:function(){this._super.apply(this,arguments);if(this.nodeOptions.onchange_on_keydown){this._triggerOnchange();}},_getTargetTextElement(){return this.$el;},_triggerOnchange:function(){this.$input.trigger('change');},_attachEmojisDropdown:function(){if(!this.$emojisIcon){this.$emojisIcon=$(QWeb.render('mail.EmojisDropdown',{widget:this}));this.$emojisIcon.find('.o_mail_emoji').on('click',this._onEmojiClick.bind(this));if(this.$el.filter('span.o_field_translate').length){this.$emojisIcon.addClass('o_mail_emojis_dropdown_translation');}
if(this.$el.filter('textarea').length){this.$emojisIcon.addClass('o_mail_emojis_dropdown_textarea');}
this.$el.last().after(this.$emojisIcon);}
if(this.mode==='edit'){this.$emojisIcon.show();}else{this.$emojisIcon.hide();}}};__exports[Symbol.for("default")]=FieldEmojiCommon;return __exports;});;

/* /mail/static/src/js/field_text_emojis.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/field_text_emojis',async function(require){'use strict';let __exports={};const MailEmojisMixin=require('@mail/js/emojis_mixin')[Symbol.for("default")];const FieldEmojiCommon=require('@mail/js/field_emojis_common')[Symbol.for("default")];const basicFields=require('web.basic_fields');const registry=require('web.field_registry');var FieldTextEmojis=basicFields.FieldText.extend(MailEmojisMixin,FieldEmojiCommon);registry.add('text_emojis',FieldTextEmojis);__exports[Symbol.for("default")]=FieldTextEmojis;return __exports;});;

/* /mail/static/src/js/m2x_avatar_user.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/m2x_avatar_user',async function(require){'use strict';let __exports={};const core=require('web.core');const fieldRegistry=require('web.field_registry');const{FieldMany2ManyTagsAvatar,KanbanMany2ManyTagsAvatar,ListMany2ManyTagsAvatar,Many2OneAvatar}=require('web.relational_fields');const session=require('web.session');const{Component}=owl;const M2XAvatarMixin={supportedModels:['res.users'],init(){this._super(...arguments);if(!this.supportedModels.includes(this.field.relation)){throw new Error(`This widget is only supported on many2one and many2many fields pointing to ${JSON.stringify(this.supportedModels)}`);}
this.className=`${this.className || ''} o_clickable_m2x_avatar`.trim();this.noOpenChat=this.nodeOptions.no_open_chat||false;},async _openChat(params){if(!this.noOpenChat){const messaging=await Component.env.services.messaging.get();return messaging.openChat(params);}
return Promise.resolve();},};const Many2OneAvatarUser=__exports.Many2OneAvatarUser=Many2OneAvatar.extend(M2XAvatarMixin,{events:Object.assign({},Many2OneAvatar.prototype.events,{'click .o_m2o_avatar > img':'_onAvatarClicked',}),on_attach_callback(){this._registerCommandAssignTo()},on_detach_callback(){this._unregisterCommandAssignTo()},_registerCommandAssignTo(){const self=this;if(self.viewType==="form"){let provide=async(env,options)=>{if(self.isDestroyed()){return}
const records=await self._searchAssignTo(options.searchValue,10)
return records.map((record)=>({name:record[1],action:()=>{if(self.isDestroyed()){return}
self.reinitialize({id:record[0],display_name:record[1]});}}))}
let getCommandDefinition=(env)=>({name:env._t("Assign to ..."),options:{activeElement:env.services.ui.getActiveElementOf(self.el),category:"smart_action",hotkey:"alt+i",},async action(){return env.services.command.openPalette({emptyMessageByNamespace:{"default":env._t("No users found")},placeholder:env._t("Select a user..."),providers:[{provide}],})},});core.bus.trigger("set_legacy_command","web.Many2OneAvatar.assignTo",getCommandDefinition,self.el);getCommandDefinition=(env)=>({name:env._t("Assign/unassign to me"),options:{activeElement:env.services.ui.getActiveElementOf(self.el),category:"smart_action",hotkey:"alt+shift+i",},action(){if(self.isDestroyed()){return}
if(self.value.res_id===session.user_id[0]){self._setValue({operation:'DELETE',ids:[session.user_id[0]],});}else{self.reinitialize({id:session.user_id[0],display_name:session.name});}},});core.bus.trigger("set_legacy_command","web.Many2OneAvatar.assignToMe",getCommandDefinition);}},_unregisterCommandAssignTo(){core.bus.trigger("remove_legacy_command","web.Many2OneAvatar.assignTo");core.bus.trigger("remove_legacy_command","web.Many2OneAvatar.assignToMe");},_searchAssignTo(searchValue,limit){const value=searchValue.trim();const domain=this.record.getDomain(this.recordParams);const context=Object.assign(this.record.getContext(this.recordParams),this.additionalContext,);const blackListedIds=this._getSearchBlacklist();if(blackListedIds.length){domain.push(['id','not in',blackListedIds]);}
const nameSearch=this._rpc({model:this.field.relation,method:"name_search",kwargs:{name:value,args:domain,operator:"ilike",limit:limit+1,context,}});return this.orderer.add(nameSearch);},_onAvatarClicked(ev){ev.stopPropagation();this._openChat({userId:this.value.res_id});},});const KanbanMany2OneAvatarUser=__exports.KanbanMany2OneAvatarUser=Many2OneAvatarUser.extend({_template:'mail.KanbanMany2OneAvatarUser',});const M2MAvatarMixin=Object.assign(M2XAvatarMixin,{events:Object.assign({},FieldMany2ManyTagsAvatar.prototype.events,{'click .o_m2m_avatar':'_onAvatarClicked',}),_onAvatarClicked(ev){ev.stopPropagation();const userId=parseInt(ev.target.getAttribute('data-id'),10);this._openChat({userId:userId});},});const Many2ManyAvatarUser=__exports.Many2ManyAvatarUser=FieldMany2ManyTagsAvatar.extend(M2MAvatarMixin,{on_attach_callback(){this._registerCommandAssignTo()},on_detach_callback(){this._unregisterCommandAssignTo()},_registerCommandAssignTo(){const self=this;if(self.viewType==="form"){const provide=async(env,options)=>{if(self.isDestroyed()){return}
const many2one=new Many2OneAvatarUser(self,self.name,self.record,{mode:'edit',noOpen:true,noCreate:!self.canCreate,viewType:self.viewType,attrs:self.attrs,});many2one._getSearchBlacklist=function(){return self.value.res_ids;};const records=await many2one._searchAssignTo(options.searchValue,10)
return records.map((record)=>({name:record[1],action:()=>{if(self.isDestroyed()){return}
self._setValue({operation:'ADD_M2M',ids:{id:record[0],display_name:record[1]}});},}))};let getCommandDefinition=(env)=>({name:env._t("Assign to ..."),options:{activeElement:env.services.ui.getActiveElementOf(self.el),category:"smart_action",hotkey:"alt+i",},action(){return env.services.command.openPalette({emptyMessageByNamespace:{"default":env._t("No users found")},placeholder:env._t("Select a user..."),providers:[{provide}],})},})
core.bus.trigger("set_legacy_command","web.FieldMany2ManyTagsAvatar.assignTo",getCommandDefinition)
getCommandDefinition=(env)=>({name:env._t("Assign/unassign to me"),options:{activeElement:env.services.ui.getActiveElementOf(self.el),category:"smart_action",hotkey:"alt+shift+i",},action(){if(self.isDestroyed()){return}
if(self.value.res_ids.includes(session.user_id[0])){self._setValue({operation:'DELETE',ids:[session.user_id[0]],});}else{self._setValue({operation:'ADD_M2M',ids:{id:session.user_id[0],display_name:session.name}});}},});core.bus.trigger("set_legacy_command","web.Many2OneAvatar.assignToMe",getCommandDefinition);}},_unregisterCommandAssignTo(){core.bus.trigger("remove_legacy_command","web.FieldMany2ManyTagsAvatar.assignTo");core.bus.trigger("remove_legacy_command","web.Many2OneAvatar.assignToMe");}});const KanbanMany2ManyAvatarUser=__exports.KanbanMany2ManyAvatarUser=KanbanMany2ManyTagsAvatar.extend(M2MAvatarMixin,{});const ListMany2ManyAvatarUser=__exports.ListMany2ManyAvatarUser=ListMany2ManyTagsAvatar.extend(M2MAvatarMixin,{});fieldRegistry.add('many2one_avatar_user',Many2OneAvatarUser);fieldRegistry.add('kanban.many2one_avatar_user',KanbanMany2OneAvatarUser);fieldRegistry.add('activity.many2one_avatar_user',KanbanMany2OneAvatarUser);fieldRegistry.add('many2many_avatar_user',Many2ManyAvatarUser);fieldRegistry.add('kanban.many2many_avatar_user',KanbanMany2ManyAvatarUser);fieldRegistry.add('list.many2many_avatar_user',ListMany2ManyAvatarUser);return __exports;});;

/* /mail/static/src/js/many2many_tags_email.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/many2many_tags_email',async function(require){'use strict';let __exports={};const BasicModel=require('web.BasicModel');const core=require('web.core');const form_common=require('web.view_dialogs');const field_registry=require('web.field_registry');const relational_fields=require('web.relational_fields');var M2MTags=relational_fields.FieldMany2ManyTags;var _t=core._t;BasicModel.include({_setInvalidMany2ManyTagsEmail:function(record,fieldName){var self=this;var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];var list=this._applyX2ManyOperations(this.localData[localID]);var invalidPartnerIds=[];_.each(list.data,function(id){var record=self.localData[id];if(!record.data.email){invalidPartnerIds.push(record);}});var def;if(invalidPartnerIds.length){var changes={operation:'DELETE',ids:_.pluck(invalidPartnerIds,'id')};def=this._applyX2ManyChange(record,fieldName,changes);}
return Promise.resolve(def).then(function(){return{invalidPartnerIds:_.pluck(invalidPartnerIds,'res_id'),};});},});var FieldMany2ManyTagsEmail=M2MTags.extend({tag_template:"FieldMany2ManyTagsEmail",fieldsToFetch:_.extend({},M2MTags.prototype.fieldsToFetch,{email:{type:'char'},}),specialData:"_setInvalidMany2ManyTagsEmail",_checkEmailPopup:function(){var self=this;var popupDefs=[];var validPartners=[];_.each(this.record.specialData[this.name].invalidPartnerIds,function(resID){var def=new Promise(function(resolve,reject){var pop=new form_common.FormViewDialog(self,{res_model:self.field.relation,res_id:resID,context:self.record.context,title:"",on_saved:function(record){if(record.data.email){validPartners.push(record.res_id);}},}).open();pop.on('closed',self,function(){resolve();});});popupDefs.push(def);});return Promise.all(popupDefs).then(function(){validPartners=_.uniq(validPartners);if(validPartners.length){var values=_.map(validPartners,function(id){return{id:id};});self._setValue({operation:'ADD_M2M',ids:values,});}});},_render:function(){var self=this;var _super=this._super.bind(this);return new Promise(function(resolve,reject){if(self.record.specialData[self.name].invalidPartnerIds.length){resolve(self._checkEmailPopup());}else{resolve();}}).then(function(){return _super.apply(self,arguments);});},});field_registry.add('many2many_tags_email',FieldMany2ManyTagsEmail);return __exports;});;

/* /mail/static/src/js/systray/systray_activity_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/systray/systray_activity_menu',async function(require){'use strict';let __exports={};const{qweb:QWeb}=require('web.core');const session=require('web.session');const SystrayMenu=require('web.SystrayMenu');const Widget=require('web.Widget');const Time=require('web.time');const{Component}=owl;var ActivityMenu=Widget.extend({name:'activity_menu',template:'mail.systray.ActivityMenu',events:{'click .o_mail_activity_action':'_onActivityActionClick','click .o_mail_preview':'_onActivityFilterClick','show.bs.dropdown':'_onActivityMenuShow','hide.bs.dropdown':'_onActivityMenuHide',},start:function(){this._$activitiesPreview=this.$('.o_mail_systray_dropdown_items');Component.env.bus.on('activity_updated',this,this._updateCounter);this._updateCounter();this._updateActivityPreview();return this._super();},_getActivityData:function(){var self=this;return self._rpc({model:'res.users',method:'systray_get_activities',args:[],kwargs:{context:session.user_context},}).then(function(data){self._activities=data;self.activityCounter=_.reduce(data,function(total_count,p_data){return total_count+p_data.total_count||0;},0);self.$('.o_notification_counter').text(self.activityCounter);self.$el.toggleClass('o_no_notification',!self.activityCounter);});},_getActivityModelViewID:function(model){return this._rpc({model:model,method:'get_activity_view_id'});},_getViewsList(model){return[[false,'kanban'],[false,'list'],[false,'form']];},_updateActivityPreview:function(){var self=this;self._getActivityData().then(function(){self._$activitiesPreview.html(QWeb.render('mail.systray.ActivityMenu.Previews',{widget:self,Time:Time}));});},_updateCounter:function(data){if(data){if(data.activity_created){this.activityCounter++;}
if(data.activity_deleted&&this.activityCounter>0){this.activityCounter--;}
this.$('.o_notification_counter').text(this.activityCounter);this.$el.toggleClass('o_no_notification',!this.activityCounter);}},_onActivityActionClick:function(ev){ev.stopPropagation();this.$('.dropdown-toggle').dropdown('toggle');var targetAction=$(ev.currentTarget);var actionXmlid=targetAction.data('action_xmlid');if(actionXmlid){this.do_action(actionXmlid);}else{var domain=[['activity_ids.user_id','=',session.uid]]
if(targetAction.data('domain')){domain=domain.concat(targetAction.data('domain'))}
this.do_action({type:'ir.actions.act_window',name:targetAction.data('model_name'),views:[[false,'activity'],[false,'kanban'],[false,'list'],[false,'form']],view_mode:'activity',res_model:targetAction.data('res_model'),domain:domain,},{clear_breadcrumbs:true,});}},_onActivityFilterClick:function(event){var data=_.extend({},$(event.currentTarget).data(),$(event.target).data());var context={};if(data.filter==='my'){context['search_default_activities_overdue']=1;context['search_default_activities_today']=1;}else{context['search_default_activities_'+data.filter]=1;}
context['force_search_count']=1;var domain=[['activity_ids.user_id','=',session.uid]]
if(data.domain){domain=domain.concat(data.domain)}
this.do_action({type:'ir.actions.act_window',name:data.model_name,res_model:data.res_model,views:this._getViewsList(data.res_model),search_view_id:[false],domain:domain,context:context,},{clear_breadcrumbs:true,});},_onActivityMenuShow:function(){document.body.classList.add('modal-open');this._updateActivityPreview();},_onActivityMenuHide:function(){document.body.classList.remove('modal-open');},});SystrayMenu.Items.push(ActivityMenu);__exports[Symbol.for("default")]=ActivityMenu;return __exports;});;

/* /mail/static/src/js/tools/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/tools/debug_manager',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");__exports.manageMessages=manageMessages;function manageMessages({action,component,env}){const selectedIds=component.widget.getSelectedIds();if(!selectedIds.length){return null;}
const description=env._t("Manage Messages");return{type:"item",description,callback:()=>{env.services.action.doAction({res_model:"mail.message",name:description,views:[[false,"list"],[false,"form"],],type:"ir.actions.act_window",domain:[["res_id","=",selectedIds[0]],["model","=",action.res_model],],context:{default_res_model:action.res_model,default_res_id:selectedIds[0],},});},sequence:325,};}
registry.category("debug").category("form").add("mail.manageMessages",manageMessages);return __exports;});;

/* /mail/static/src/js/tours/mail.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/tours/mail',async function(require){'use strict';let __exports={};const{_t}=require('web.core');const{Markup}=require('web.utils');const tour=require('web_tour.tour');tour.register('mail_tour',{url:"/web#action=mail.widgets.discuss",sequence:80,},[{trigger:'.o_DiscussSidebar_categoryChannel .o_DiscussSidebarCategory_commandAdd',content:Markup(_t("<p>Channels make it easy to organize information across different topics and groups.</p> <p>Try to <b>create your first channel</b> (e.g. sales, marketing, product XYZ, after work party, etc).</p>")),position:'bottom',},{trigger:'.o_DiscussSidebarCategory_itemNewInput',content:Markup(_t("<p>Create a channel here.</p>")),position:'bottom',auto:true,run:function(actions){var t=new Date().getTime();actions.text("SomeChannel_"+t,this.$anchor);},},{trigger:".o_DiscussSidebarCategory_newChannelAutocompleteSuggestions",content:Markup(_t("<p>Create a public or private channel.</p>")),position:'right',run(){this.$consumeEventAnchors.find('li:first').click();},},{trigger:'.o_Discuss_thread .o_ComposerTextInput_textarea',content:Markup(_t("<p><b>Write a message</b> to the members of the channel here.</p> <p>You can notify someone with <i>'@'</i> or link another channel with <i>'#'</i>. Start your message with <i>'/'</i> to get the list of possible commands.</p>")),position:"top",width:350,run:function(actions){var t=new Date().getTime();actions.text("SomeText_"+t,this.$anchor);},},{trigger:'.o_Discuss_thread .o_Composer_buttonSend',content:_t("Post your message on the thread"),position:"top",},{trigger:'.o_Discuss_thread .o_Message',content:_t("Click on your message"),position:"top",},{trigger:'.o_Discuss_thread .o_MessageActionList_actionStar',content:Markup(_t("Messages can be <b>starred</b> to remind you to check back later.")),position:"bottom",},{trigger:'.o_DiscussSidebarMailbox.o-starred-box',content:_t("Once a message has been starred, you can come back and review it at any time here."),position:"bottom",},{trigger:'.o_DiscussSidebar_categoryChat .o_DiscussSidebarCategory_commandAdd',content:Markup(_t("<p><b>Chat with coworkers</b> in real-time using direct messages.</p><p><i>You might need to invite users from the Settings app first.</i></p>")),position:'bottom',}]);return __exports;});;

/* /mail/static/src/js/utils.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/utils',async function(require){'use strict';let __exports={};const core=require('web.core');var _t=core._t;function parseAndTransform(htmlString,transformFunction){var openToken="OPEN"+Date.now();var string=htmlString.replace(/&lt;/g,openToken);var children;try{children=$('<div>').html(string).contents();}catch(e){children=$('<div>').html('<pre>'+string+'</pre>').contents();}
return _parseAndTransform(children,transformFunction).replace(new RegExp(openToken,"g"),"&lt;");}
function _parseAndTransform(nodes,transformFunction){return _.map(nodes,function(node){return transformFunction(node,function(){return _parseAndTransform(node.childNodes,transformFunction);});}).join("");}
var urlRegexp=/\b(?:https?:\/\/\d{1,3}(?:\.\d{1,3}){3}|(?:https?:\/\/|(?:www\.))[-a-z0-9@:%._+~#=\u00C0-\u024F\u1E00-\u1EFF]{2,256}\.[a-z]{2,13})\b(?:[-a-z0-9@:%_+.~#?&'$//=;\u00C0-\u024F\u1E00-\u1EFF]*)/gi;function linkify(text,attrs){attrs=attrs||{};if(attrs.target===undefined){attrs.target='_blank';}
if(attrs.target==='_blank'){attrs.rel='noreferrer noopener';}
attrs=_.map(attrs,function(value,key){return key+'="'+_.escape(value)+'"';}).join(' ');return text.replace(urlRegexp,function(url){var href=(!/^https?:\/\//i.test(url))?"http://"+url:url;return'<a '+attrs+' href="'+href+'">'+url+'</a>';});}
function addLink(node,transformChildren){if(node.nodeType===3){const linkified=linkify(node.data);if(linkified!==node.data){const div=document.createElement('div');div.innerHTML=linkified;for(const childNode of[...div.childNodes]){node.parentNode.insertBefore(childNode,node);}
node.parentNode.removeChild(node);return linkified;}
return node.textContent;}
if(node.tagName==="A")return node.outerHTML;transformChildren();return node.outerHTML;}
function htmlToTextContentInline(htmlString){const fragment=document.createDocumentFragment();const div=document.createElement('div');fragment.appendChild(div);htmlString=htmlString.replace(/<br\s*\/?>/gi,' ');try{div.innerHTML=htmlString;}catch(e){div.innerHTML=`<pre>${htmlString}</pre>`;}
return div.textContent.trim().replace(/[\n\r]/g,'').replace(/\s\s+/g,' ');}
function stripHTML(node,transformChildren){if(node.nodeType===3)return node.data;if(node.tagName==="BR")return"\n";return transformChildren();}
function inline(node,transform_children){if(node.nodeType===3)return node.data;if(node.nodeType===8)return"";if(node.tagName==="BR")return" ";if(node.tagName.match(/^(A|P|DIV|PRE|BLOCKQUOTE)$/))return transform_children();node.innerHTML=transform_children();return node.outerHTML;}
function parseEmail(text){if(text){var result=text.match(/(.*)<(.*@.*)>/);if(result){return[_.str.trim(result[1]),_.str.trim(result[2])];}
result=text.match(/(.*@.*)/);if(result){return[_.str.trim(result[1]),_.str.trim(result[1])];}
return[text,false];}}
function escapeAndCompactTextContent(content){let value=owl.utils.escape(content).trim();value=value.replace(/(\r|\n){2,}/g,'<br/><br/>');value=value.replace(/(\r|\n)/g,'<br/>');value=value.replace(/ /g,'&nbsp;').replace(/([^>])&nbsp;([^<])/g,'$1 $2');return value;}
function getTextToHTML(text){return text.replace(/((?:https?|ftp):\/\/[\S]+)/g,'<a href="$1">$1</a> ').replace(/[\n\r]/g,'<br/>');}
function timeFromNow(date){if(moment().diff(date,'seconds')<45){return _t("now");}
return date.fromNow();}
Object.assign(__exports,{addLink,escapeAndCompactTextContent,getTextToHTML,htmlToTextContentInline,inline,linkify,parseAndTransform,parseEmail,stripHTML,timeFromNow,});return __exports;});;

/* /mail/static/src/js/views/activity/activity_cell.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/views/activity/activity_cell',async function(require){'use strict';let __exports={};require('@mail/js/activity');const field_registry=require('web.field_registry');const KanbanActivity=field_registry.get('kanban_activity');const ActivityCell=KanbanActivity.extend({init(parent,name,record,options){this._super.apply(this,arguments);this.activityType=options&&options.activityType;},_getActivityFormAction(id){const action=this._super.apply(this,arguments);action.context['default_activity_type_id']=this.activityType;return action;},_render(){const $date=$('<div class="o_closest_deadline">');const date=moment(this.record.data.closest_deadline).toDate();if(moment().year()===moment(date).year()){$date.text(date.toLocaleDateString(moment().locale(),{day:'numeric',month:'short'}));}else{$date.text(moment(date).format('ll'));}
this.$('a').html($date);if(this.record.data.activity_ids.res_ids.length>1){this.$('a').append($('<span>',{class:'badge badge-light badge-pill border-0 '+this.record.data.activity_state,text:this.record.data.activity_ids.res_ids.length,}));}
if(this.$el.hasClass('show')){this._renderDropdown();}}});__exports[Symbol.for("default")]=ActivityCell;return __exports;});;

/* /mail/static/src/js/views/activity/activity_controller.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/views/activity/activity_controller',async function(require){'use strict';let __exports={};require('@mail/js/activity');const BasicController=require('web.BasicController');const core=require('web.core');const field_registry=require('web.field_registry');const ViewDialogs=require('web.view_dialogs');var KanbanActivity=field_registry.get('kanban_activity');var _t=core._t;var ActivityController=BasicController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{empty_cell_clicked:'_onEmptyCell',send_mail_template:'_onSendMailTemplate',schedule_activity:'_onScheduleActivity',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.title=params.title;this.searchViewId=params.searchViewId;},_getPagingInfo:function(){return null;},_onScheduleActivity:function(){var self=this;var state=this.model.get(this.handle);new ViewDialogs.SelectCreateDialog(this,{res_model:state.model,searchViewId:this.searchViewId,domain:this.model.originalDomain,title:_.str.sprintf(_t("Search: %s"),this.title),no_create:!this.activeActions.create,disable_multiple_selection:true,context:state.context,on_selected:function(record){var fakeRecord=state.getKanbanActivityData({},record[0]);var widget=new KanbanActivity(self,'activity_ids',fakeRecord,{});widget.scheduleActivity();},}).open();},_onEmptyCell:function(ev){var state=this.model.get(this.handle);this.do_action({type:'ir.actions.act_window',res_model:'mail.activity',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:{default_res_id:ev.data.resId,default_res_model:state.model,default_activity_type_id:ev.data.activityTypeId,},res_id:false,},{on_close:this.reload.bind(this),});},_onSendMailTemplate:function(ev){var templateID=ev.data.templateID;var activityTypeID=ev.data.activityTypeID;var state=this.model.get(this.handle);var groupedActivities=state.grouped_activities;var resIDS=[];Object.keys(groupedActivities).forEach(function(resID){var activityByType=groupedActivities[resID];var activity=activityByType[activityTypeID];if(activity){resIDS.push(parseInt(resID));}});this._rpc({model:this.model.modelName,method:'activity_send_mail',args:[resIDS,templateID],});},});__exports[Symbol.for("default")]=ActivityController;return __exports;});;

/* /mail/static/src/js/views/activity/activity_model.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/views/activity/activity_model',async function(require){'use strict';let __exports={};const BasicModel=require('web.BasicModel');const session=require('web.session');const ActivityModel=BasicModel.extend({__get:function(){var result=this._super.apply(this,arguments);if(result&&result.model===this.modelName&&result.type==='list'){_.extend(result,this.additionalData,{getKanbanActivityData:this.getKanbanActivityData});}
return result;},getKanbanActivityData(activityGroup,resId){return{data:{activity_ids:{model:'mail.activity',res_ids:activityGroup.ids,},activity_state:activityGroup.state,closest_deadline:activityGroup.o_closest_deadline,},fields:{activity_ids:{},activity_state:{selection:[['overdue',"Overdue"],['today',"Today"],['planned',"Planned"],],},},fieldsInfo:{},model:this.model,type:'record',res_id:resId,getContext:function(){return{};},};},__load:function(params){this.originalDomain=_.extend([],params.domain);params.domain.push(['activity_ids','!=',false]);this.domain=params.domain;this.modelName=params.modelName;params.groupedBy=[];var def=this._super.apply(this,arguments);return Promise.all([def,this._fetchData()]).then(function(result){return result[0];});},__reload:function(handle,params){if(params&&'domain'in params){this.originalDomain=_.extend([],params.domain);params.domain.push(['activity_ids','!=',false]);this.domain=params.domain;}
if(params&&'groupBy'in params){params.groupBy=[];}
var def=this._super.apply(this,arguments);return Promise.all([def,this._fetchData()]).then(function(result){return result[0];});},_fetchData:function(){var self=this;return this._rpc({model:"mail.activity",method:'get_activity_data',kwargs:{res_model:this.modelName,domain:this.domain,context:session.user_context,}}).then(function(result){self.additionalData=result;});},});__exports[Symbol.for("default")]=ActivityModel;return __exports;});;

/* /mail/static/src/js/views/activity/activity_record.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/views/activity/activity_record',async function(require){'use strict';let __exports={};const KanbanRecord=require('web.KanbanRecord');var ActivityRecord=KanbanRecord.extend({init:function(parent,state){this._super.apply(this,arguments);this.fieldsInfo=state.fieldsInfo.activity;},_render:function(){this.defs=[];this._replaceElement(this.qweb.render('activity-box',this.qweb_context));this.$el.on('click',this._onGlobalClick.bind(this));this.$el.addClass('o_activity_record');this._processFields();this._setupColor();return Promise.all(this.defs);},_setFieldDisplay:function($el,fieldName){this._super.apply(this,arguments);if(this.fieldsInfo[fieldName].muted){$el.addClass('text-muted');}},_setState:function(){this._super.apply(this,arguments);this.qweb_context={activity_image:this._getImageURL.bind(this),record:this.record,user_context:this.getSession().user_context,widget:this,};},});__exports[Symbol.for("default")]=ActivityRecord;return __exports;});;

/* /mail/static/src/js/views/activity/activity_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/views/activity/activity_renderer',async function(require){'use strict';let __exports={};const ActivityCell=require('@mail/js/views/activity/activity_cell')[Symbol.for("default")];const ActivityRecord=require('@mail/js/views/activity/activity_record')[Symbol.for("default")];const AbstractRendererOwl=require('web.AbstractRendererOwl');const core=require('web.core');const KanbanColumnProgressBar=require('web.KanbanColumnProgressBar');const{ComponentAdapter}=require('web.OwlCompatibility');const QWeb=require('web.QWeb');const session=require('web.session');const utils=require('web.utils');const _t=core._t;const{useState}=owl.hooks;class ActivityRecordAdapter extends ComponentAdapter{renderWidget(){_.invoke(_.pluck(this.widget.subWidgets,'$el'),'detach');this.widget._render();}
updateWidget(nextProps){const state=nextProps.widgetArgs[0];this.widget._setState(state);}}
class ActivityCellAdapter extends ComponentAdapter{renderWidget(){this.widget._render();}
updateWidget(nextProps){const record=nextProps.widgetArgs[1];this.widget._reset(record);}}
class KanbanColumnProgressBarAdapter extends ComponentAdapter{renderWidget(){this.widget._render();}
updateWidget(nextProps){const options=nextProps.widgetArgs[0];const columnState=nextProps.widgetArgs[1];const columnId=options.columnID;const nextActiveFilter=options.progressBarStates[columnId].activeFilter;this.widget.activeFilter=nextActiveFilter?this.widget.activeFilter:false;this.widget.columnState=columnState;this.widget.computeCounters();}
_trigger_up(ev){if(this.el){super._trigger_up(ev);}}}
class ActivityRenderer extends AbstractRendererOwl{constructor(parent,props){super(...arguments);this.qweb=new QWeb(this.env.isDebug(),{_s:session.origin});this.qweb.add_template(utils.json_node_to_xml(props.templates));this.activeFilter=useState({state:null,activityTypeId:null,resIds:[]});this.widgetComponents={ActivityRecord,ActivityCell,KanbanColumnProgressBar,};}
get activityResIds(){const copiedActivityResIds=Array.from(this.props.activity_res_ids)
return copiedActivityResIds.sort((a,b)=>this.activeFilter.resIds.includes(a)?-1:0);}
get activityTypeIds(){const activities=Object.values(this.props.grouped_activities);const activityIds=activities.flatMap(Object.keys);const uniqueIds=Array.from(new Set(activityIds));return uniqueIds.map(Number);}
getProgressBarOptions(typeId){return{columnID:typeId,progressBarStates:{[typeId]:{activeFilter:this.activeFilter.activityTypeId===typeId,},},};}
getProgressBarColumnState(typeId){const counts={planned:0,today:0,overdue:0};for(let activities of Object.values(this.props.grouped_activities)){if(typeId in activities){counts[activities[typeId].state]+=1;}}
return{count:Object.values(counts).reduce((x,y)=>x+y),fields:{activity_state:{type:'selection',selection:[['planned',_t('Planned')],['today',_t('Today')],['overdue',_t('Overdue')],],},},progressBarValues:{field:'activity_state',colors:{planned:'success',today:'warning',overdue:'danger'},counts:counts,},};}
_onEmptyCellClicked(ev){this.trigger('empty_cell_clicked',{resId:parseInt(ev.currentTarget.dataset.resId,10),activityTypeId:parseInt(ev.currentTarget.dataset.activityTypeId,10),});}
_onSendMailTemplateClicked(ev){this.trigger('send_mail_template',{activityTypeID:parseInt(ev.currentTarget.dataset.activityTypeId,10),templateID:parseInt(ev.currentTarget.dataset.templateId,10),});}
_onSetProgressBarState(ev){if(ev.detail.values.activeFilter){this.activeFilter.state=ev.detail.values.activeFilter;this.activeFilter.activityTypeId=ev.detail.columnID;this.activeFilter.resIds=Object.entries(this.props.grouped_activities).filter(([,resIds])=>ev.detail.columnID in resIds&&resIds[ev.detail.columnID].state===ev.detail.values.activeFilter.value).map(([key])=>parseInt(key));}else{this.activeFilter.state=null;this.activeFilter.activityTypeId=null;this.activeFilter.resIds=[];}}}
ActivityRenderer.components={ActivityRecordAdapter,ActivityCellAdapter,KanbanColumnProgressBarAdapter,};ActivityRenderer.template='mail.ActivityRenderer';__exports[Symbol.for("default")]=ActivityRenderer;return __exports;});;

/* /mail/static/src/js/views/activity/activity_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/js/views/activity/activity_view',async function(require){'use strict';let __exports={};;const ActivityController=require('@mail/js/views/activity/activity_controller')[Symbol.for("default")];const ActivityModel=require('@mail/js/views/activity/activity_model')[Symbol.for("default")];const ActivityRenderer=require('@mail/js/views/activity/activity_renderer')[Symbol.for("default")];const BasicView=require('web.BasicView');const core=require('web.core');const RendererWrapper=require('web.RendererWrapper');const view_registry=require('web.view_registry');const _lt=core._lt;const ActivityView=BasicView.extend({accesskey:"a",display_name:_lt('Activity'),icon:'fa-clock-o',config:_.extend({},BasicView.prototype.config,{Controller:ActivityController,Model:ActivityModel,Renderer:ActivityRenderer,}),viewType:'activity',searchMenuTypes:['filter','favorite'],init:function(viewInfo,params){this._super.apply(this,arguments);const{search_view_id}=params.action||{};this.controllerParams.searchViewId=search_view_id?search_view_id[0]:false;this.loadParams.type='list';this.loadParams.limit=false;this.rendererParams.templates=_.findWhere(this.arch.children,{'tag':'templates'});this.controllerParams.title=this.arch.attrs.string;},getRenderer(parent,state){state=Object.assign({},state,this.rendererParams);return new RendererWrapper(null,this.config.Renderer,state);},});view_registry.add('activity',ActivityView);__exports[Symbol.for("default")]=ActivityView;return __exports;});;

/* /mail/static/src/utils/deferred/deferred.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/utils/deferred/deferred',async function(require){'use strict';let __exports={};__exports.makeDeferred=makeDeferred;function makeDeferred(){let resolve;let reject;const prom=new Promise(function(res,rej){resolve=res.bind(this);reject=rej.bind(this);});prom.resolve=(...args)=>resolve(...args);prom.reject=(...args)=>reject(...args);return prom;}
return __exports;});;

/* /mail/static/src/utils/media_monitoring/media_monitoring.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/utils/media_monitoring/media_monitoring',async function(require){'use strict';let __exports={};const HUMAN_VOICE_FREQUENCY_RANGE=[80,1000];__exports.monitorAudio=monitorAudio;async function monitorAudio(track,processorOptions){const monitoredTrack=track.clone();monitoredTrack.enabled=true;const stream=new window.MediaStream([monitoredTrack]);const AudioContext=window.AudioContext||window.webkitAudioContext;if(!AudioContext){throw'missing audio context';}
const audioContext=new AudioContext();const source=audioContext.createMediaStreamSource(stream);let processor;try{processor=await _loadAudioWorkletProcessor(source,audioContext,processorOptions);}catch(e){processor=_loadScriptProcessor(source,audioContext,processorOptions);}
return()=>{processor.disconnect();source.disconnect();monitoredTrack.stop();}}
function _loadScriptProcessor(source,audioContext,{frequencyRange=HUMAN_VOICE_FREQUENCY_RANGE,minimumActiveCycles=10,onThreshold,onTic,volumeThreshold=0.3}={}){const bitSize=1024;const analyser=audioContext.createAnalyser();source.connect(analyser);const scriptProcessorNode=audioContext.createScriptProcessor(bitSize,1,1);analyser.connect(scriptProcessorNode);analyser.fftsize=bitSize;scriptProcessorNode.connect(audioContext.destination);const processInterval=50;const intervalInFrames=processInterval/1000*analyser.context.sampleRate;let nextUpdateFrame=processInterval;let activityBuffer=0;let wasAboveThreshold=undefined;let isAboveThreshold=false;scriptProcessorNode.onaudioprocess=()=>{nextUpdateFrame-=bitSize;if(nextUpdateFrame>=0){return;}
nextUpdateFrame+=intervalInFrames;const normalizedVolume=getFrequencyAverage(analyser,frequencyRange[0],frequencyRange[1]);if(normalizedVolume>=volumeThreshold){activityBuffer=minimumActiveCycles;}else if(normalizedVolume<volumeThreshold&&activityBuffer>0){activityBuffer--;}
isAboveThreshold=activityBuffer>0;onTic&&onTic(normalizedVolume);if(wasAboveThreshold!==isAboveThreshold){wasAboveThreshold=isAboveThreshold;onThreshold&&onThreshold(isAboveThreshold);}};return{disconnect:()=>{analyser.disconnect();scriptProcessorNode.disconnect();scriptProcessorNode.onaudioprocess=null;},};}
async function _loadAudioWorkletProcessor(source,audioContext,{frequencyRange=HUMAN_VOICE_FREQUENCY_RANGE,minimumActiveCycles=10,onThreshold,onTic,volumeThreshold=0.3}={}){await audioContext.resume();await audioContext.audioWorklet.addModule('/mail/rtc/audio_worklet_processor');const thresholdProcessor=new window.AudioWorkletNode(audioContext,'audio-processor',{processorOptions:{minimumActiveCycles,volumeThreshold,frequencyRange,postAllTics:!!onTic,}});source.connect(thresholdProcessor).connect(audioContext.destination);thresholdProcessor.port.onmessage=(event)=>{const{isAboveThreshold,volume}=event.data;onThreshold&&isAboveThreshold!==undefined&&onThreshold(isAboveThreshold);onTic&&volume!==undefined&&onTic(volume);};return{disconnect:()=>{thresholdProcessor.disconnect();},};}
function getFrequencyAverage(analyser,lowerFrequency,higherFrequency){const frequencies=new window.Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(frequencies);const sampleRate=analyser.context.sampleRate;const startIndex=_getFrequencyIndex(lowerFrequency,sampleRate,analyser.frequencyBinCount);const endIndex=_getFrequencyIndex(higherFrequency,sampleRate,analyser.frequencyBinCount);const count=endIndex-startIndex;let sum=0;for(let index=startIndex;index<endIndex;index++){sum+=frequencies[index]/255;}
if(!count){return 0;}
return sum/count;}
function _getFrequencyIndex(targetFrequency,sampleRate,binCount){const index=Math.round(targetFrequency/(sampleRate/2)*binCount);return Math.min(Math.max(0,index),binCount);}
return __exports;});;

/* /mail/static/src/utils/throttle/throttle.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/utils/throttle/throttle',async function(require){'use strict';let __exports={};const{makeDeferred}=require('@mail/utils/deferred/deferred');class ThrottleCanceledError extends Error{constructor(throttleId,...args){super(...args);this.name='ThrottleCanceledError';this.throttleId=throttleId;}}
class ThrottleReinvokedError extends Error{constructor(throttleId,...args){super(...args);this.name='ThrottleReinvokedError';this.throttleId=throttleId;}}
class _ThrottleFlushedError extends Error{constructor(throttleId,...args){super(...args);this.name='_ThrottleFlushedError';this.throttleId=throttleId;}}
class Throttle{constructor(env,func,duration){this.env=env;this.id=_.uniqueId('throttle_');this._coolingDownDeferred=undefined;this._duration=duration;this._function=func;this._isCoolingDown=false;this._pendingInvokeDeferred=undefined;}
cancel(){if(!this._isCoolingDown){return;}
if(!this._pendingInvokeDeferred){return;}
this._pendingInvokeDeferred.reject(new ThrottleCanceledError(this.id));}
clear(){this.cancel();this.flush();}
async do(...args){if(!this._isCoolingDown){return this._invokeFunction(...args);}
if(this._pendingInvokeDeferred){this._pendingInvokeDeferred.reject(new ThrottleReinvokedError(this.id));}
try{this._pendingInvokeDeferred=makeDeferred();await Promise.race([this._coolingDownDeferred,this._pendingInvokeDeferred]);}catch(error){if(!(error instanceof _ThrottleFlushedError)||error.throttleId!==this.id){throw error;}}finally{this._pendingInvokeDeferred=undefined;}
return this._invokeFunction(...args);}
flush(){if(!this._isCoolingDown){return;}
const coolingDownDeferred=this._coolingDownDeferred;this._coolingDownDeferred=undefined;this._isCoolingDown=false;coolingDownDeferred.reject(new _ThrottleFlushedError(this.id));}
_invokeFunction(...args){const res=this._function(...args);this._startCoolingDown();return res;}
async _startCoolingDown(){if(this._coolingDownDeferred){throw new Error("Cannot start cooling down if there's already a cooling down in progress.");}
const coolingDownDeferred=makeDeferred();this._coolingDownDeferred=coolingDownDeferred;this._isCoolingDown=true;const cooldownTimeoutId=this.env.browser.setTimeout(()=>coolingDownDeferred.resolve(),this._duration);let unexpectedError;try{await coolingDownDeferred;}catch(error){if(!(error instanceof _ThrottleFlushedError)||error.throttleId!==this.id){unexpectedError=error;}}finally{this.env.browser.clearTimeout(cooldownTimeoutId);this._coolingDownDeferred=undefined;this._isCoolingDown=false;}
if(unexpectedError){throw unexpectedError;}}}
function throttle(env,func,duration,{silentCancelationErrors=true}={}){const throttleObj=new Throttle(env,func,duration);const callable=async(...args)=>{try{return await throttleObj.do(...args);}catch(error){const isSelfReinvokedError=(error instanceof ThrottleReinvokedError&&error.throttleId===throttleObj.id);const isSelfCanceledError=(error instanceof ThrottleCanceledError&&error.throttleId===throttleObj.id);if(silentCancelationErrors&&(isSelfReinvokedError||isSelfCanceledError)){return new Promise(()=>{});}else{throw error;}}};Object.assign(callable,{cancel:()=>throttleObj.cancel(),clear:()=>throttleObj.clear(),flush:()=>throttleObj.flush(),});return callable;}
Object.assign(throttle,{ThrottleReinvokedError,ThrottleCanceledError,});__exports[Symbol.for("default")]=throttle;return __exports;});;

/* /mail/static/src/utils/timer/timer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/utils/timer/timer',async function(require){'use strict';let __exports={};const{makeDeferred}=require('@mail/utils/deferred/deferred');class TimerClearedError extends Error{constructor(timerId,...args){super(...args);this.name='TimerClearedError';this.timerId=timerId;}}
class Timer{constructor(env,onTimeout,duration,{silentCancelationErrors=true}={}){this.env=env;this.isRunning=false;this._duration=duration;this._hasSilentCancelationErrors=silentCancelationErrors;this._onTimeout=onTimeout;this._timeoutDeferred=undefined;this._timeoutId=undefined;}
clear(){this.env.browser.clearTimeout(this._timeoutId);this.isRunning=false;if(!this._timeoutDeferred){return;}
this._timeoutDeferred.reject(new TimerClearedError(this.id));}
async reset(){this.clear();await this.start();}
async start(){if(this.isRunning){throw new Error("Cannot start a timer that is currently running.");}
this.isRunning=true;const timeoutDeferred=makeDeferred();this._timeoutDeferred=timeoutDeferred;const timeoutId=this.env.browser.setTimeout(()=>{this.isRunning=false;timeoutDeferred.resolve(this._onTimeout());},this._duration);this._timeoutId=timeoutId;let result;try{result=await timeoutDeferred;}catch(error){if(!this._hasSilentCancelationErrors||!(error instanceof TimerClearedError)||error.timerId!==this.id){throw error;}}finally{this.env.browser.clearTimeout(timeoutId);this._timeoutDeferred=undefined;this.isRunning=false;}
return result;}}
Object.assign(Timer,{TimerClearedError,});__exports[Symbol.for("default")]=Timer;return __exports;});;

/* /mail/static/src/utils/messaging_component.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/utils/messaging_component',async function(require){'use strict';let __exports={};const{useModels}=require("@mail/component_hooks/use_models/use_models");const{useShouldUpdateBasedOnProps}=require("@mail/component_hooks/use_should_update_based_on_props/use_should_update_based_on_props");const componentRegistry={};__exports.registerMessagingComponent=registerMessagingComponent;function registerMessagingComponent(ComponentClass,{propsCompareDepth={}}={}){const{name,components}=ComponentClass;if(componentRegistry[name]){throw new Error(`There already is a registered component with the name "${name}"`);}
const decoratedName=`@messaging ${name}`;const MessagingClass={[decoratedName]:class extends ComponentClass{setup(...args){super.setup(...args);useModels();useShouldUpdateBasedOnProps({propsCompareDepth});}
get messaging(){return this.env.services.messaging.modelManager.messaging;}
toString(){return`component(${decoratedName}, props: ${Object.entries(this.props || {})})`;}}}[decoratedName];MessagingClass.components=Object.assign(Object.create(componentRegistry),components);componentRegistry[name]=MessagingClass;}
__exports.unregisterMessagingComponent=unregisterMessagingComponent;function unregisterMessagingComponent(ComponentClass){delete componentRegistry[ComponentClass.name];}
__exports.getMessagingComponent=getMessagingComponent;function getMessagingComponent(name){return componentRegistry[name];}
return __exports;});;

/* /mail/static/src/utils/utils.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/utils/utils',async function(require){'use strict';let __exports={};const{delay}=require('web.concurrency');const{patch:webUtilsPatch,unaccent,unpatch:webUtilsUnpatch,}=require('web.utils');const classPatchMap=new WeakMap();const eventHandledWeakMap=new WeakMap();function cleanSearchTerm(searchTerm){return unaccent(searchTerm.toLowerCase());}
async function executeGracefully(functions,maxTimeFrame=100){let startDate=new Date();for(const func of functions){if(new Date()-startDate>maxTimeFrame){await new Promise(resolve=>setTimeout(resolve));startDate=new Date();}
await func();}}
function isEventHandled(ev,markName){if(!eventHandledWeakMap.get(ev)){return false;}
return eventHandledWeakMap.get(ev).includes(markName);}
function markEventHandled(ev,markName){if(!eventHandledWeakMap.get(ev)){eventHandledWeakMap.set(ev,[]);}
eventHandledWeakMap.get(ev).push(markName);}
async function nextTick(){await delay(0);}
function patchClassMethods(Class,patchName,patch){let metadata=classPatchMap.get(Class);if(!metadata){metadata={origMethods:{},patches:{},current:[]};classPatchMap.set(Class,metadata);}
if(metadata.patches[patchName]){throw new Error(`Patch [${patchName}] already exists`);}
metadata.patches[patchName]=patch;applyPatch(Class,patch);metadata.current.push(patchName);function applyPatch(Class,patch){Object.keys(patch).forEach(function(methodName){const method=patch[methodName];if(typeof method==="function"){const original=Class[methodName];if(!(methodName in metadata.origMethods)){metadata.origMethods[methodName]=original;}
Class[methodName]=function(...args){const previousSuper=this._super;this._super=original;const res=method.call(this,...args);this._super=previousSuper;return res;};}});}
return()=>unpatchClassMethods.bind(Class,patchName);}
function patchInstanceMethods(Class,patchName,patch){return webUtilsPatch(Class.prototype,patchName,patch);}
function unpatchClassMethods(Class,patchName){let metadata=classPatchMap.get(Class);if(!metadata){return;}
classPatchMap.delete(Class);for(let k in metadata.origMethods){Class[k]=metadata.origMethods[k];}
for(let name of metadata.current){if(name!==patchName){patchClassMethods(Class,name,metadata.patches[name]);}}}
function unpatchInstanceMethods(Class,patchName){return webUtilsUnpatch(Class.prototype,patchName);}
Object.assign(__exports,{cleanSearchTerm,executeGracefully,isEventHandled,markEventHandled,nextTick,patchClassMethods,patchInstanceMethods,unpatchClassMethods,unpatchInstanceMethods,});return __exports;});;

/* /mail/static/src/component_hooks/use_component_to_model/use_component_to_model.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/component_hooks/use_component_to_model/use_component_to_model',async function(require){'use strict';let __exports={};const{clear}=require('@mail/model/model_field_command');const{onWillUpdateProps,useComponent}=owl.hooks;__exports.useComponentToModel=useComponentToModel;function useComponentToModel({fieldName,modelName,propNameAsRecordLocalId}){const component=useComponent();const{modelManager}=component.env.services.messaging;const record=modelManager.models[modelName].get(component.props[propNameAsRecordLocalId]);if(record){record.update({[fieldName]:component});}
onWillUpdateProps(nextProps=>{const currentRecord=modelManager.models[modelName].get(component.props[propNameAsRecordLocalId]);const nextRecord=modelManager.models[modelName].get(nextProps[propNameAsRecordLocalId]);if(currentRecord&&currentRecord!==nextRecord){currentRecord.update({[fieldName]:clear()});}
if(nextRecord){nextRecord.update({[fieldName]:component});}});const __destroy=component.__destroy;component.__destroy=parent=>{const record=modelManager.models[modelName].get(component.props[propNameAsRecordLocalId]);if(record){record.update({[fieldName]:clear()});}
__destroy.call(component,parent);};}
return __exports;});;

/* /mail/static/src/component_hooks/use_drag_visible_dropzone/use_drag_visible_dropzone.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/component_hooks/use_drag_visible_dropzone/use_drag_visible_dropzone',async function(require){'use strict';let __exports={};const{useState,onMounted,onWillUnmount}=owl.hooks;__exports.useDragVisibleDropZone=useDragVisibleDropZone;function useDragVisibleDropZone(){const isVisible=useState({value:false});let dragCount=0;onMounted(()=>{document.addEventListener('dragenter',_onDragenterListener,true);document.addEventListener('dragleave',_onDragleaveListener,true);document.addEventListener('drop',_onDropListener,true);window.addEventListener('dragover',preventDefault);window.addEventListener('drop',preventDefault);});onWillUnmount(()=>{document.removeEventListener('dragenter',_onDragenterListener,true);document.removeEventListener('dragleave',_onDragleaveListener,true);document.removeEventListener('drop',_onDropListener,true);window.removeEventListener('dragover',preventDefault);window.removeEventListener('drop',preventDefault);});function preventDefault(ev){ev.preventDefault();}
function _onDragenterListener(ev){if(dragCount===0&&ev.dataTransfer&&ev.dataTransfer.types.includes('Files')){isVisible.value=true;}
dragCount++;}
function _onDragleaveListener(ev){dragCount--;if(dragCount===0){isVisible.value=false;}}
function _onDropListener(ev){dragCount=0;isVisible.value=false;}
return isVisible;}
return __exports;});;

/* /mail/static/src/component_hooks/use_models/use_models.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/component_hooks/use_models/use_models',async function(require){'use strict';let __exports={};const{Listener}=require('@mail/model/model_listener');const{useComponent}=owl.hooks;__exports.useModels=useModels;function useModels(){const component=useComponent();const{modelManager}=component.env.services.messaging;const listener=new Listener({isLocking:false,name:`useModels() of ${component}`,onChange:()=>component.render(),});const __render=component.__render;component.__render=fiber=>{if(modelManager){modelManager.startListening(listener);}
__render.call(component,fiber);if(modelManager){modelManager.stopListening(listener);}};const __destroy=component.__destroy;component.__destroy=parent=>{if(modelManager){modelManager.removeListener(listener);}
__destroy.call(component,parent);};modelManager.messagingCreatedPromise.then(()=>{component.render();});}
return __exports;});;

/* /mail/static/src/component_hooks/use_ref_to_model/use_ref_to_model.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/component_hooks/use_ref_to_model/use_ref_to_model',async function(require){'use strict';let __exports={};const{clear}=require('@mail/model/model_field_command');const{onWillUpdateProps,useComponent,useRef}=owl.hooks;__exports.useRefToModel=useRefToModel;function useRefToModel({fieldName,modelName,propNameAsRecordLocalId,refName}){const component=useComponent();const{modelManager}=component.env.services.messaging;const record=modelManager.models[modelName].get(component.props[propNameAsRecordLocalId]);const ref=useRef(refName);if(record){record.update({[fieldName]:ref});}
onWillUpdateProps(nextProps=>{const currentRecord=modelManager.models[modelName].get(component.props[propNameAsRecordLocalId]);const nextRecord=modelManager.models[modelName].get(nextProps[propNameAsRecordLocalId]);if(currentRecord&&currentRecord!==nextRecord){currentRecord.update({[fieldName]:clear()});}
if(nextRecord){nextRecord.update({[fieldName]:ref});}});const __destroy=component.__destroy;component.__destroy=parent=>{const record=modelManager.models[modelName].get(component.props[propNameAsRecordLocalId]);if(record){record.update({[fieldName]:clear()});}
__destroy.call(component,parent);};}
return __exports;});;

/* /mail/static/src/component_hooks/use_refs/use_refs.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/component_hooks/use_refs/use_refs',async function(require){'use strict';let __exports={};const{Component}=owl;__exports.useRefs=useRefs;function useRefs(){const component=Component.current;return function(){return component.__owl__.refs||{};};}
return __exports;});;

/* /mail/static/src/component_hooks/use_rendered_values/use_rendered_values.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/component_hooks/use_rendered_values/use_rendered_values',async function(require){'use strict';let __exports={};const{Component}=owl;const{onMounted,onPatched}=owl.hooks;__exports.useRenderedValues=useRenderedValues;function useRenderedValues(selector){const component=Component.current;let renderedValues;let patchedValues;const __render=component.__render.bind(component);component.__render=function(){renderedValues=selector();return __render(...arguments);};onMounted(onUpdate);onPatched(onUpdate);function onUpdate(){patchedValues=renderedValues;}
return()=>patchedValues;}
return __exports;});;

/* /mail/static/src/component_hooks/use_should_update_based_on_props/use_should_update_based_on_props.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/component_hooks/use_should_update_based_on_props/use_should_update_based_on_props',async function(require){'use strict';let __exports={};'use strict';const{Component}=owl;const{onPatched}=owl.hooks;function isEqual(a,b,propsCompareDepth){const keys=Object.keys(a);if(Object.keys(b).length!==keys.length){return false;}
for(const key of keys){let depth;if(typeof propsCompareDepth==='number'){depth=propsCompareDepth;}else{depth=propsCompareDepth[key]||0;}
if(depth===0&&a[key]!==b[key]){return false;}
if(depth!==0){let nextDepth;if(typeof depth==='number'){nextDepth=depth-1;}else{nextDepth=depth;}
if(!isEqual(a[key],b[key],nextDepth)){return false;}}}
return true;}
__exports.useShouldUpdateBasedOnProps=useShouldUpdateBasedOnProps;function useShouldUpdateBasedOnProps({propsCompareDepth={}}={}){const component=Component.current;let forceRender=false;component.shouldUpdate=nextProps=>{if(forceRender){return true;}
const allNewProps=Object.assign({},nextProps);const defaultProps=component.constructor.defaultProps;for(const key in defaultProps){if(allNewProps[key]===undefined){allNewProps[key]=defaultProps[key];}}
forceRender=!isEqual(component.props,allNewProps,propsCompareDepth);return forceRender;};onPatched(()=>forceRender=false);}
return __exports;});;

/* /mail/static/src/component_hooks/use_update/use_update.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/component_hooks/use_update/use_update',async function(require){'use strict';let __exports={};const{Listener}=require('@mail/model/model_listener');const{onMounted,onPatched,useComponent}=owl.hooks;__exports.useUpdate=useUpdate;function useUpdate({func}){const component=useComponent();const{modelManager}=component.env.services.messaging;const listener=new Listener({isLocking:false,name:`useUpdate() of ${component}`,onChange:()=>component.render(),});function onUpdate(){if(modelManager){modelManager.startListening(listener);}
func();if(modelManager){modelManager.stopListening(listener);}}
onMounted(onUpdate);onPatched(onUpdate);const __destroy=component.__destroy;component.__destroy=parent=>{if(modelManager){modelManager.removeListener(listener);}
__destroy.call(component,parent);};}
return __exports;});;

/* /mail/static/src/component_hooks/use_update_to_model/use_update_to_model.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/component_hooks/use_update_to_model/use_update_to_model',async function(require){'use strict';let __exports={};const{useUpdate}=require('@mail/component_hooks/use_update/use_update');const{useComponent}=owl.hooks;__exports.useUpdateToModel=useUpdateToModel;function useUpdateToModel({methodName,modelName,propNameAsRecordLocalId}){const component=useComponent();useUpdate({func:()=>{const record=component.env.services.messaging.modelManager.models[modelName].get(component.props[propNameAsRecordLocalId]);if(record){record[methodName]();}}});}
return __exports;});;

/* /mail/static/src/components/activity/activity.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/activity/activity',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{auto_str_to_date,getLangDateFormat,getLangDatetimeFormat,}=require('web.time');const{Component,useState}=owl;const{useRef}=owl.hooks;const Activity=__exports.Activity=class Activity extends Component{constructor(...args){super(...args);this.state=useState({areDetailsVisible:false,});this._fileUploaderRef=useRef('fileUploader');}
get activity(){return this.messaging&&this.messaging.models['mail.activity'].get(this.props.activityLocalId);}
get assignedUserText(){return _.str.sprintf(this.env._t("for %s"),this.activity.assignee.nameOrDisplayName);}
get delayLabel(){const today=moment().startOf('day');const momentDeadlineDate=moment(auto_str_to_date(this.activity.dateDeadline));const diff=momentDeadlineDate.diff(today,'days',true);if(diff===0){return this.env._t("Today:");}else if(diff===-1){return this.env._t("Yesterday:");}else if(diff<0){return _.str.sprintf(this.env._t("%d days overdue:"),Math.abs(diff));}else if(diff===1){return this.env._t("Tomorrow:");}else{return _.str.sprintf(this.env._t("Due in %d days:"),Math.abs(diff));}}
get formattedCreateDatetime(){const momentCreateDate=moment(auto_str_to_date(this.activity.dateCreate));const datetimeFormat=getLangDatetimeFormat();return momentCreateDate.format(datetimeFormat);}
get formattedDeadlineDate(){const momentDeadlineDate=moment(auto_str_to_date(this.activity.dateDeadline));const datetimeFormat=getLangDateFormat();return momentDeadlineDate.format(datetimeFormat);}
get MARK_DONE(){return this.env._t("Mark Done");}
get summary(){return _.str.sprintf(this.env._t("“%s”"),this.activity.summary);}
_onAttachmentCreated(ev){this.activity.markAsDone({attachments:[ev.detail.attachment]});}
_onClick(ev){if(ev.target.tagName==='A'&&ev.target.dataset.oeId&&ev.target.dataset.oeModel){this.messaging.openProfile({id:Number(ev.target.dataset.oeId),model:ev.target.dataset.oeModel,});ev.preventDefault();}}
async _onClickCancel(ev){ev.preventDefault();await this.activity.deleteServerRecord();this.trigger('reload',{keepChanges:true});}
_onClickDetailsButton(){this.state.areDetailsVisible=!this.state.areDetailsVisible;}
_onClickEdit(ev){this.activity.edit();}
_onClickUploadDocument(ev){this._fileUploaderRef.comp.openBrowserFileUploader();}}
Object.assign(Activity,{props:{activityLocalId:String,},template:'mail.Activity',});registerMessagingComponent(Activity);return __exports;});;

/* /mail/static/src/components/activity_box/activity_box.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/activity_box/activity_box',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const ActivityBox=__exports.ActivityBox=class ActivityBox extends Component{get chatter(){return this.messaging.models['mail.chatter'].get(this.props.chatterLocalId);}}
Object.assign(ActivityBox,{props:{chatterLocalId:String,},template:'mail.ActivityBox',});registerMessagingComponent(ActivityBox);return __exports;});;

/* /mail/static/src/components/activity_mark_done_popover/activity_mark_done_popover.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/activity_mark_done_popover/activity_mark_done_popover',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const{useRef}=owl.hooks;const ActivityMarkDonePopover=__exports.ActivityMarkDonePopover=class ActivityMarkDonePopover extends Component{constructor(...args){super(...args);this._feedbackTextareaRef=useRef('feedbackTextarea');}
mounted(){this._feedbackTextareaRef.el.focus();if(this.activity.feedbackBackup){this._feedbackTextareaRef.el.value=this.activity.feedbackBackup;}}
get activity(){return this.messaging&&this.messaging.models['mail.activity'].get(this.props.activityLocalId);}
get DONE_AND_SCHEDULE_NEXT(){return this.env._t("Done & Schedule Next");}
_close(){this.trigger('o-popover-close');}
_onBlur(){this.activity.update({feedbackBackup:this._feedbackTextareaRef.el.value,});}
_onClickDiscard(){this._close();}
async _onClickDone(){await this.activity.markAsDone({feedback:this._feedbackTextareaRef.el.value,});this.trigger('reload',{keepChanges:true});}
async _onClickDoneAndScheduleNext(){await this.activity.markAsDoneAndScheduleNext({feedback:this._feedbackTextareaRef.el.value,});this.trigger('reload',{keepChanges:true});}
_onKeydown(ev){if(ev.key==='Escape'){this._close();}}}
Object.assign(ActivityMarkDonePopover,{props:{activityLocalId:String,},template:'mail.ActivityMarkDonePopover',});registerMessagingComponent(ActivityMarkDonePopover);return __exports;});;

/* /mail/static/src/components/attachment_box/attachment_box.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/attachment_box/attachment_box',async function(require){'use strict';let __exports={};const{useDragVisibleDropZone}=require('@mail/component_hooks/use_drag_visible_dropzone/use_drag_visible_dropzone');const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const{useRef}=owl.hooks;const AttachmentBox=__exports.AttachmentBox=class AttachmentBox extends Component{constructor(...args){super(...args);this.isDropZoneVisible=useDragVisibleDropZone();this._fileUploaderRef=useRef('fileUploader');}
get chatter(){return this.messaging&&this.messaging.models['mail.chatter'].get(this.props.chatterLocalId);}
_onAttachmentCreated(ev){this.trigger('o-attachments-changed');}
_onAttachmentRemoved(ev){this.trigger('o-attachments-changed');}
_onClickAdd(ev){ev.preventDefault();ev.stopPropagation();this._fileUploaderRef.comp.openBrowserFileUploader();}
async _onDropZoneFilesDropped(ev){ev.stopPropagation();await this._fileUploaderRef.comp.uploadFiles(ev.detail.files);this.isDropZoneVisible.value=false;}}
Object.assign(AttachmentBox,{props:{chatterLocalId:String,},template:'mail.AttachmentBox',});registerMessagingComponent(AttachmentBox);return __exports;});;

/* /mail/static/src/components/attachment_card/attachment_card.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/attachment_card/attachment_card',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useComponentToModel}=require('@mail/component_hooks/use_component_to_model/use_component_to_model');const{Component}=owl;const AttachmentCard=__exports.AttachmentCard=class AttachmentCard extends Component{setup(){super.setup();useComponentToModel({fieldName:'component',modelName:'mail.attachment_card',propNameAsRecordLocalId:'attachmentCardLocalId'});}
get attachmentCard(){return this.messaging&&this.messaging.models['mail.attachment_card'].get(this.props.attachmentCardLocalId);}}
Object.assign(AttachmentCard,{props:{attachmentCardLocalId:String,},template:'mail.AttachmentCard',});registerMessagingComponent(AttachmentCard);return __exports;});;

/* /mail/static/src/components/attachment_delete_confirm_dialog/attachment_delete_confirm_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/attachment_delete_confirm_dialog/attachment_delete_confirm_dialog',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const Dialog=require('web.OwlDialog');const{Component}=owl;const{useRef}=owl.hooks;const AttachmentDeleteConfirmDialog=__exports.AttachmentDeleteConfirmDialog=class AttachmentDeleteConfirmDialog extends Component{constructor(...args){super(...args);this._dialogRef=useRef('dialog');}
get attachment(){return this.messaging&&this.messaging.models['mail.attachment'].get(this.props.attachmentLocalId);}
getBody(){return _.str.sprintf(this.env._t(`Do you really want to delete "%s"?`),owl.utils.escape(this.attachment.displayName));}
getTitle(){return this.env._t("Confirmation");}
_onClickCancel(){this._dialogRef.comp._close();}
async _onClickOk(){await this.attachment.remove();this._dialogRef.comp._close();this.trigger('o-attachment-removed',{attachmentLocalId:this.props.attachmentLocalId});}}
Object.assign(AttachmentDeleteConfirmDialog,{components:{Dialog},props:{attachmentLocalId:String,},template:'mail.AttachmentDeleteConfirmDialog',});registerMessagingComponent(AttachmentDeleteConfirmDialog);return __exports;});;

/* /mail/static/src/components/attachment_image/attachment_image.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/attachment_image/attachment_image',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useComponentToModel}=require('@mail/component_hooks/use_component_to_model/use_component_to_model');const{Component}=owl;const AttachmentImage=__exports.AttachmentImage=class AttachmentImage extends Component{setup(){super.setup();useComponentToModel({fieldName:'component',modelName:'mail.attachment_image',propNameAsRecordLocalId:'attachmentImageLocalId'});}
get attachmentImage(){return this.messaging&&this.messaging.models['mail.attachment_image'].get(this.props.attachmentImageLocalId);}}
Object.assign(AttachmentImage,{props:{attachmentImageLocalId:String,},template:'mail.AttachmentImage',});registerMessagingComponent(AttachmentImage);return __exports;});;

/* /mail/static/src/components/attachment_list/attachment_list.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/attachment_list/attachment_list',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const AttachmentList=__exports.AttachmentList=class AttachmentList extends Component{get attachmentList(){return this.messaging&&this.messaging.models['mail.attachment_list'].get(this.props.attachmentListLocalId);}}
Object.assign(AttachmentList,{props:{attachmentListLocalId:String,},template:'mail.AttachmentList',});registerMessagingComponent(AttachmentList);return __exports;});;

/* /mail/static/src/components/attachment_viewer/attachment_viewer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/attachment_viewer/attachment_viewer',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useRefs}=require('@mail/component_hooks/use_refs/use_refs');const{link}=require('@mail/model/model_field_command');const{hidePDFJSButtons}=require('@web/legacy/js/libs/pdfjs');const{Component}=owl;const{useRef}=owl.hooks;const MIN_SCALE=0.5;const SCROLL_ZOOM_STEP=0.1;const ZOOM_STEP=0.5;const AttachmentViewer=__exports.AttachmentViewer=class AttachmentViewer extends Component{constructor(...args){super(...args);this.MIN_SCALE=MIN_SCALE;this._getRefs=useRefs();this._isDragging=false;this._zoomerRef=useRef('zoomer');this._iframeViewerPdfRef=useRef('iframeViewerPdf');this._translate={x:0,y:0,dx:0,dy:0};this._onClickGlobal=this._onClickGlobal.bind(this);}
mounted(){this.el.focus();this._handleImageLoad();this._hideUnwantedPdfJsButtons();document.addEventListener('click',this._onClickGlobal);}
patched(){this._handleImageLoad();this._hideUnwantedPdfJsButtons();}
willUnmount(){document.removeEventListener('click',this._onClickGlobal);}
get attachmentViewer(){return this.messaging&&this.messaging.models['mail.attachment_viewer'].get(this.props.localId);}
get imageStyle(){const attachmentViewer=this.attachmentViewer;let style=`transform: `+`scale3d(${attachmentViewer.scale}, ${attachmentViewer.scale}, 1) `+`rotate(${attachmentViewer.angle}deg);`;if(attachmentViewer.angle%180!==0){style+=``+`max-height: ${window.innerWidth}px; `+`max-width: ${window.innerHeight}px;`;}else{style+=``+`max-height: 100%; `+`max-width: 100%;`;}
return style;}
isCloseable(){return!this._isDragging;}
_close(){this.attachmentViewer.close();}
_download(){this.attachmentViewer.attachment.download();}
_handleImageLoad(){if(!this.attachmentViewer||!this.attachmentViewer.attachment){return;}
const refs=this._getRefs();const image=refs[`image_${this.attachmentViewer.attachment.id}`];if(this.attachmentViewer.attachment.isImage&&(!image||!image.complete)){this.attachmentViewer.update({isImageLoading:true});}}
_hideUnwantedPdfJsButtons(){if(this._iframeViewerPdfRef.el){hidePDFJSButtons(this._iframeViewerPdfRef.el);}}
_next(){const attachmentViewer=this.attachmentViewer;const index=attachmentViewer.attachments.findIndex(attachment=>attachment===attachmentViewer.attachment);const nextIndex=(index+1)%attachmentViewer.attachments.length;attachmentViewer.update({attachment:link(attachmentViewer.attachments[nextIndex]),});}
_previous(){const attachmentViewer=this.attachmentViewer;const index=attachmentViewer.attachments.findIndex(attachment=>attachment===attachmentViewer.attachment);const nextIndex=index===0?attachmentViewer.attachments.length-1:index-1;attachmentViewer.update({attachment:link(attachmentViewer.attachments[nextIndex]),});}
_print(){const printWindow=window.open('about:blank','_new');printWindow.document.open();printWindow.document.write(`
            <html>
                <head>
                    <script>
                        function onloadImage() {
                            setTimeout('printImage()', 10);
                        }
                        function printImage() {
                            window.print();
                            window.close();
                        }
                    </script>
                </head>
                <body onload='onloadImage()'>
                    <img src="${this.attachmentViewer.attachment.defaultSource}" alt=""/>
                </body>
            </html>`);printWindow.document.close();}
_rotate(){this.attachmentViewer.update({angle:this.attachmentViewer.angle+90});}
_stopDragging(){this._isDragging=false;this._translate.x+=this._translate.dx;this._translate.y+=this._translate.dy;this._translate.dx=0;this._translate.dy=0;this._updateZoomerStyle();}
_updateZoomerStyle(){const attachmentViewer=this.attachmentViewer;const refs=this._getRefs();const image=refs[`image_${this.attachmentViewer.attachment.id}`];const tx=image.offsetWidth*attachmentViewer.scale>this._zoomerRef.el.offsetWidth?this._translate.x+this._translate.dx:0;const ty=image.offsetHeight*attachmentViewer.scale>this._zoomerRef.el.offsetHeight?this._translate.y+this._translate.dy:0;if(tx===0){this._translate.x=0;}
if(ty===0){this._translate.y=0;}
this._zoomerRef.el.style=`transform: `+`translate(${tx}px, ${ty}px)`;}
_zoomIn({scroll=false}={}){this.attachmentViewer.update({scale:this.attachmentViewer.scale+(scroll?SCROLL_ZOOM_STEP:ZOOM_STEP),});this._updateZoomerStyle();}
_zoomOut({scroll=false}={}){if(this.attachmentViewer.scale===MIN_SCALE){return;}
const unflooredAdaptedScale=(this.attachmentViewer.scale-
(scroll?SCROLL_ZOOM_STEP:ZOOM_STEP));this.attachmentViewer.update({scale:Math.max(MIN_SCALE,unflooredAdaptedScale),});this._updateZoomerStyle();}
_zoomReset(){this.attachmentViewer.update({scale:1});this._updateZoomerStyle();}
_onClick(ev){if(this._isDragging){return;}
this._close();}
_onClickClose(ev){this._close();}
_onClickDownload(ev){ev.stopPropagation();this._download();}
_onClickGlobal(ev){if(!this._isDragging){return;}
ev.stopPropagation();this._stopDragging();}
_onClickHeader(ev){ev.stopPropagation();}
_onClickImage(ev){if(this._isDragging){return;}
ev.stopPropagation();}
_onClickNext(ev){ev.stopPropagation();this._next();}
_onClickPrevious(ev){ev.stopPropagation();this._previous();}
_onClickPrint(ev){ev.stopPropagation();this._print();}
_onClickRotate(ev){ev.stopPropagation();this._rotate();}
_onClickVideo(ev){ev.stopPropagation();}
_onClickZoomIn(ev){ev.stopPropagation();this._zoomIn();}
_onClickZoomOut(ev){ev.stopPropagation();this._zoomOut();}
_onClickZoomReset(ev){ev.stopPropagation();this._zoomReset();}
_onKeydown(ev){switch(ev.key){case'ArrowRight':this._next();break;case'ArrowLeft':this._previous();break;case'Escape':this._close();break;case'q':this._close();break;case'r':this._rotate();break;case'+':this._zoomIn();break;case'-':this._zoomOut();break;case'0':this._zoomReset();break;default:return;}
ev.stopPropagation();}
_onLoadImage(ev){ev.stopPropagation();this.attachmentViewer.update({isImageLoading:false});}
_onMousedownImage(ev){if(this._isDragging){return;}
if(ev.button!==0){return;}
ev.stopPropagation();this._isDragging=true;this._dragstartX=ev.clientX;this._dragstartY=ev.clientY;}
_onMousemoveView(ev){if(!this._isDragging){return;}
this._translate.dx=ev.clientX-this._dragstartX;this._translate.dy=ev.clientY-this._dragstartY;this._updateZoomerStyle();}
_onWheelImage(ev){ev.stopPropagation();if(!this.el){return;}
if(ev.deltaY>0){this._zoomOut({scroll:true});}else{this._zoomIn({scroll:true});}}}
Object.assign(AttachmentViewer,{props:{localId:String,},template:'mail.AttachmentViewer',});registerMessagingComponent(AttachmentViewer);return __exports;});;

/* /mail/static/src/components/autocomplete_input/autocomplete_input.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/autocomplete_input/autocomplete_input',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const AutocompleteInput=__exports.AutocompleteInput=class AutocompleteInput extends Component{mounted(){if(this.props.isFocusOnMount){this.el.focus();}
let args={autoFocus:true,select:(ev,ui)=>this._onAutocompleteSelect(ev,ui),source:(req,res)=>this._onAutocompleteSource(req,res),focus:ev=>this._onAutocompleteFocus(ev),html:this.props.isHtml||false,};if(this.props.customClass){args.classes={'ui-autocomplete':this.props.customClass};}
const autoCompleteElem=$(this.el).autocomplete(args);autoCompleteElem.data("ui-autocomplete")._resizeMenu=function(){const ul=this.menu.element;ul.outerWidth(this.element.outerWidth());};}
willUnmount(){$(this.el).autocomplete('destroy');}
contains(node){if(!this.el){return false;}
if(this.el.contains(node)){return true;}
if(!this.props.customClass){return false;}
const element=document.querySelector(`.${this.props.customClass}`);if(!element){return false;}
return element.contains(node);}
focus(){if(!this.el){return;}
this.el.focus();}
_onAutocompleteFocus(ev){if(this.props.focus){this.props.focus(ev);}else{ev.preventDefault();}}
_onAutocompleteSelect(ev,ui){if(this.props.select){this.props.select(ev,ui);}}
_onAutocompleteSource(req,res){if(this.props.source){this.props.source(req,res);}}
_onBlur(ev){this.trigger('o-hide');}
_onKeydown(ev){if(ev.key==='Escape'){this.trigger('o-hide');}}}
Object.assign(AutocompleteInput,{defaultProps:{isFocusOnMount:false,isHtml:false,placeholder:'',},props:{customClass:{type:String,optional:true,},focus:{type:Function,optional:true,},isFocusOnMount:Boolean,isHtml:Boolean,placeholder:String,select:{type:Function,optional:true,},source:{type:Function,optional:true,},},template:'mail.AutocompleteInput',});registerMessagingComponent(AutocompleteInput);return __exports;});;

/* /mail/static/src/components/channel_invitation_form/channel_invitation_form.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/channel_invitation_form/channel_invitation_form',async function(require){'use strict';let __exports={};const{useComponentToModel}=require('@mail/component_hooks/use_component_to_model/use_component_to_model');const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useRefToModel}=require('@mail/component_hooks/use_ref_to_model/use_ref_to_model');const{useUpdateToModel}=require('@mail/component_hooks/use_update_to_model/use_update_to_model');const{Component}=owl;const ChannelInvitationForm=__exports.ChannelInvitationForm=class ChannelInvitationForm extends Component{setup(){super.setup();useComponentToModel({fieldName:'component',modelName:'mail.channel_invitation_form',propNameAsRecordLocalId:'localId'});useRefToModel({fieldName:'searchInputRef',modelName:'mail.channel_invitation_form',propNameAsRecordLocalId:'localId',refName:'searchInput'});useUpdateToModel({methodName:'onComponentUpdate',modelName:'mail.channel_invitation_form',propNameAsRecordLocalId:'localId'});}
get channelInvitationForm(){return this.messaging&&this.messaging.models['mail.channel_invitation_form'].get(this.props.localId);}}
Object.assign(ChannelInvitationForm,{props:{localId:{type:String,},},template:'mail.ChannelInvitationForm',});registerMessagingComponent(ChannelInvitationForm);return __exports;});;

/* /mail/static/src/components/channel_member_list/channel_member_list.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/channel_member_list/channel_member_list',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const ChannelMemberList=__exports.ChannelMemberList=class ChannelMemberList extends Component{get channel(){return this.messaging.models['mail.thread'].get(this.props.channelLocalId);}}
Object.assign(ChannelMemberList,{props:{channelLocalId:String,},template:'mail.ChannelMemberList',});registerMessagingComponent(ChannelMemberList);return __exports;});;

/* /mail/static/src/components/chat_window/chat_window.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/chat_window/chat_window',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useUpdate}=require('@mail/component_hooks/use_update/use_update');const{isEventHandled}=require('@mail/utils/utils');const{Component}=owl;const{useRef}=owl.hooks;const ChatWindow=__exports.ChatWindow=class ChatWindow extends Component{constructor(...args){super(...args);useUpdate({func:()=>this._update()});this._chatWindowHeaderRef=useRef('header');this._inputRef=useRef('input');this._threadRef=useRef('thread');this._onAutocompleteSelect=this._onAutocompleteSelect.bind(this);this._onAutocompleteSource=this._onAutocompleteSource.bind(this);this._constructor(...args);}
_constructor(){}
get chatWindow(){return this.messaging&&this.messaging.models['mail.chat_window'].get(this.props.chatWindowLocalId);}
get newMessageFormInputPlaceholder(){return this.env._t("Search user...");}
_applyVisibleOffset(){const textDirection=this.messaging.locale.textDirection;const offsetFrom=textDirection==='rtl'?'left':'right';const oppositeFrom=offsetFrom==='right'?'left':'right';this.el.style[offsetFrom]=this.chatWindow.visibleOffset+'px';this.el.style[oppositeFrom]='auto';}
_saveThreadScrollTop(){if(!this._threadRef.comp||!this.chatWindow||!this.chatWindow.threadViewer){return;}
if(this.chatWindow.threadViewer.threadView&&this.chatWindow.threadViewer.threadView.componentHintList.length>0){return;}
this.chatWindow.threadViewer.saveThreadCacheScrollHeightAsInitial(this._threadRef.comp.getScrollHeight());this.chatWindow.threadViewer.saveThreadCacheScrollPositionsAsInitial(this._threadRef.comp.getScrollTop());}
_update(){if(!this.chatWindow){return;}
if(this.chatWindow.isDoFocus){this.chatWindow.update({isDoFocus:false});if(this._inputRef.comp){this._inputRef.comp.focus();}}
this._applyVisibleOffset();}
async _onAutocompleteSelect(ev,ui){const chat=await this.messaging.getChat({partnerId:ui.item.id});if(!chat){return;}
this.messaging.chatWindowManager.openThread(chat,{makeActive:true,replaceNewMessage:true,});}
_onAutocompleteSource(req,res){this.messaging.models['mail.partner'].imSearch({callback:(partners)=>{const suggestions=partners.map(partner=>{return{id:partner.id,value:partner.nameOrDisplayName,label:partner.nameOrDisplayName,};});res(_.sortBy(suggestions,'label'));},keyword:_.escape(req.term),limit:10,});}
_onClickedHeader(ev){ev.stopPropagation();if(this.messaging.device.isMobile){return;}
if(this.chatWindow.isFolded){this.chatWindow.unfold();this.chatWindow.focus();}else{this._saveThreadScrollTop();this.chatWindow.fold();}}
_onFocusinThread(ev){ev.stopPropagation();if(!this.chatWindow){return;}
this.chatWindow.update({isFocused:true});}
_onFocusout(){if(!this.chatWindow){return;}
this.chatWindow.update({isFocused:false});}
_onKeydown(ev){if(!this.chatWindow){return;}
switch(ev.key){case'Tab':ev.preventDefault();if(ev.shiftKey){this.chatWindow.focusPreviousVisibleUnfoldedChatWindow();}else{this.chatWindow.focusNextVisibleUnfoldedChatWindow();}
break;case'Escape':if(isEventHandled(ev,'ComposerTextInput.closeSuggestions')){break;}
if(isEventHandled(ev,'Composer.closeEmojisPopover')){break;}
ev.preventDefault();this.chatWindow.focusNextVisibleUnfoldedChatWindow();this.chatWindow.close();break;}}}
Object.assign(ChatWindow,{defaultProps:{hasCloseAsBackButton:false,isExpandable:false,isFullscreen:false,},props:{chatWindowLocalId:String,hasCloseAsBackButton:Boolean,isExpandable:Boolean,isFullscreen:Boolean,},template:'mail.ChatWindow',});registerMessagingComponent(ChatWindow);return __exports;});;

/* /mail/static/src/components/chat_window_header/chat_window_header.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/chat_window_header/chat_window_header',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{isEventHandled,markEventHandled,}=require('@mail/utils/utils');const{Component}=owl;const ChatWindowHeader=__exports.ChatWindowHeader=class ChatWindowHeader extends Component{get chatWindow(){return this.messaging&&this.messaging.models['mail.chat_window'].get(this.props.chatWindowLocalId);}
get shiftNextText(){if(this.messaging.locale.textDirection==='rtl'){return this.env._t("Shift left");}
return this.env._t("Shift right");}
get shiftPrevText(){if(this.messaging.locale.textDirection==='rtl'){return this.env._t("Shift right");}
return this.env._t("Shift left");}
_onClick(ev){if(isEventHandled(ev,'ChatWindow.onClickCommand')||isEventHandled(ev,'ChatWindowHeader.ClickShiftNext')||isEventHandled(ev,'ChatWindowHeader.ClickShiftPrev')||isEventHandled(ev,'ChatWindow.onClickHideMemberList')||isEventHandled(ev,'ChatWindow.onClickShowMemberList')){return;}
const chatWindow=this.chatWindow;this.trigger('o-clicked',{chatWindow});}
_onClickClose(ev){ev.stopPropagation();if(!this.chatWindow){return;}
this.chatWindow.close();}
async _onClickCamera(ev){ev.stopPropagation();if(this.chatWindow.thread.hasPendingRtcRequest){return;}
await this.chatWindow.thread.toggleCall({startWithVideo:true});}
async _onClickPhone(ev){ev.stopPropagation();if(this.chatWindow.thread.hasPendingRtcRequest){return;}
await this.chatWindow.thread.toggleCall();}
_onClickExpand(ev){ev.stopPropagation();this.chatWindow.expand();}
_onClickShiftPrev(ev){markEventHandled(ev,'ChatWindowHeader.ClickShiftPrev');this.chatWindow.shiftPrev();}
_onClickShiftNext(ev){markEventHandled(ev,'ChatWindowHeader.ClickShiftNext');this.chatWindow.shiftNext();}}
Object.assign(ChatWindowHeader,{defaultProps:{hasCloseAsBackButton:false,isExpandable:false,},props:{chatWindowLocalId:String,hasCloseAsBackButton:Boolean,isExpandable:Boolean,},template:'mail.ChatWindowHeader',});registerMessagingComponent(ChatWindowHeader);return __exports;});;

/* /mail/static/src/components/chat_window_hidden_menu/chat_window_hidden_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/chat_window_hidden_menu/chat_window_hidden_menu',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const{useRef}=owl.hooks;const ChatWindowHiddenMenu=__exports.ChatWindowHiddenMenu=class ChatWindowHiddenMenu extends Component{constructor(...args){super(...args);this._onClickCaptureGlobal=this._onClickCaptureGlobal.bind(this);this._listRef=useRef('list');this._wasMenuOpen;}
mounted(){this._apply();document.addEventListener('click',this._onClickCaptureGlobal,true);}
patched(){this._apply();}
willUnmount(){document.removeEventListener('click',this._onClickCaptureGlobal,true);}
_apply(){if(!this.messaging){return;}
this._applyListHeight();this._applyOffset();this._wasMenuOpen=this.messaging.chatWindowManager.isHiddenMenuOpen;}
_applyListHeight(){const device=this.messaging.device;const height=device.globalWindowInnerHeight/2;this._listRef.el.style['max-height']=`${height}px`;}
_applyOffset(){const textDirection=this.messaging.locale.textDirection;const offsetFrom=textDirection==='rtl'?'left':'right';const oppositeFrom=offsetFrom==='right'?'left':'right';const offset=this.messaging.chatWindowManager.visual.hidden.offset;this.el.style[offsetFrom]=`${offset}px`;this.el.style[oppositeFrom]='auto';}
_onClickCaptureGlobal(ev){if(!this.el||this.el.contains(ev.target)){return;}
this.messaging.chatWindowManager.closeHiddenMenu();}
_onClickToggle(ev){if(this._wasMenuOpen){this.messaging.chatWindowManager.closeHiddenMenu();}else{this.messaging.chatWindowManager.openHiddenMenu();}}
_onClickedChatWindow(ev){const chatWindow=ev.detail.chatWindow;chatWindow.makeActive();this.messaging.chatWindowManager.closeHiddenMenu();}}
Object.assign(ChatWindowHiddenMenu,{props:{},template:'mail.ChatWindowHiddenMenu',});registerMessagingComponent(ChatWindowHiddenMenu);return __exports;});;

/* /mail/static/src/components/chat_window_manager/chat_window_manager.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/chat_window_manager/chat_window_manager',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const ChatWindowManager=__exports.ChatWindowManager=class ChatWindowManager extends Component{}
Object.assign(ChatWindowManager,{props:{},template:'mail.ChatWindowManager',});registerMessagingComponent(ChatWindowManager);return __exports;});;

/* /mail/static/src/components/chatter/chatter.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/chatter/chatter',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useUpdate}=require('@mail/component_hooks/use_update/use_update');const{useRefToModel}=require('@mail/component_hooks/use_ref_to_model/use_ref_to_model');const{Component}=owl;const{useRef}=owl.hooks;const Chatter=__exports.Chatter=class Chatter extends Component{constructor(...args){super(...args);useUpdate({func:()=>this._update()});useRefToModel({fieldName:'threadRef',modelName:'mail.chatter',propNameAsRecordLocalId:'chatterLocalId',refName:'thread'});this._scrollPanelRef=useRef('scrollPanel');this.getScrollableElement=this.getScrollableElement.bind(this);}
get chatter(){return this.messaging&&this.messaging.models['mail.chatter'].get(this.props.chatterLocalId);}
getScrollableElement(){if(!this._scrollPanelRef.el){return;}
return this._scrollPanelRef.el;}
_notifyRendered(){this.trigger('o-chatter-rendered',{attachments:this.chatter.thread.allAttachments,thread:this.chatter.thread.localId,});}
_update(){if(!this.chatter){return;}
if(this.chatter.thread){this._notifyRendered();}}}
Object.assign(Chatter,{props:{chatterLocalId:String,},template:'mail.Chatter',});registerMessagingComponent(Chatter);return __exports;});;

/* /mail/static/src/components/chatter_container/chatter_container.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/chatter_container/chatter_container',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{clear}=require('@mail/model/model_field_command');const{Component}=owl;const getChatterNextTemporaryId=(function(){let tmpId=0;return()=>{tmpId+=1;return tmpId;};})();const ChatterContainer=__exports.ChatterContainer=class ChatterContainer extends Component{constructor(...args){super(...args);this.chatter=undefined;this.chatterId=getChatterNextTemporaryId();this._insertFromProps(this.props);}
willUpdateProps(nextProps){this._insertFromProps(nextProps);return super.willUpdateProps(...arguments);}
destroy(){super.destroy();if(this.chatter){this.chatter.delete();}}
async _insertFromProps(props){const messaging=await this.env.services.messaging.get();if(this.__owl__.status===5){return;}
const values={id:this.chatterId,...props};if(values.threadId===undefined){values.threadId=clear();}
this.chatter=messaging.models['mail.chatter'].insert(values);this.chatter.refresh();this.render();}}
Object.assign(ChatterContainer,{props:{hasActivities:{type:Boolean,optional:true,},hasExternalBorder:{type:Boolean,optional:true,},hasFollowers:{type:Boolean,optional:true,},hasMessageList:{type:Boolean,optional:true,},hasMessageListScrollAdjust:{type:Boolean,optional:true,},hasTopbarCloseButton:{type:Boolean,optional:true,},isAttachmentBoxVisibleInitially:{type:Boolean,optional:true,},threadId:{type:Number,optional:true,},threadModel:String,},template:'mail.ChatterContainer',});registerMessagingComponent(ChatterContainer);return __exports;});;

/* /mail/static/src/components/chatter_topbar/chatter_topbar.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/chatter_topbar/chatter_topbar',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useComponentToModel}=require('@mail/component_hooks/use_component_to_model/use_component_to_model');const{Component}=owl;const ChatterTopbar=__exports.ChatterTopbar=class ChatterTopbar extends Component{setup(){super.setup();useComponentToModel({fieldName:'componentChatterTopbar',modelName:'mail.chatter',propNameAsRecordLocalId:'chatterLocalId'});}
get chatter(){return this.messaging&&this.messaging.models['mail.chatter'].get(this.props.chatterLocalId);}}
Object.assign(ChatterTopbar,{props:{chatterLocalId:String,},template:'mail.ChatterTopbar',});registerMessagingComponent(ChatterTopbar);return __exports;});;

/* /mail/static/src/components/composer/composer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/composer/composer',async function(require){'use strict';let __exports={};const{useDragVisibleDropZone}=require('@mail/component_hooks/use_drag_visible_dropzone/use_drag_visible_dropzone');const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{isEventHandled,markEventHandled,}=require('@mail/utils/utils');const{Component}=owl;const{useRef}=owl.hooks;const Composer=__exports.Composer=class Composer extends Component{constructor(...args){super(...args);this.isDropZoneVisible=useDragVisibleDropZone();this._emojisPopoverRef=useRef('emojisPopover');this._fileUploaderRef=useRef('fileUploader');this._textInputRef=useRef('textInput');this._onClickCaptureGlobal=this._onClickCaptureGlobal.bind(this);}
mounted(){document.addEventListener('click',this._onClickCaptureGlobal,true);}
willUnmount(){document.removeEventListener('click',this._onClickCaptureGlobal,true);}
get composerView(){return this.messaging&&this.messaging.models['mail.composer_view'].get(this.props.composerViewLocalId);}
contains(node){const emojisPopover=this._emojisPopoverRef.comp;if(emojisPopover&&emojisPopover.contains(node)){return true;}
return Boolean(this.el&&this.el.contains(node));}
get currentPartnerAvatar(){const avatar=this.messaging.currentUser?this.env.session.url('/web/image',{field:'avatar_128',id:this.messaging.currentUser.id,model:'res.users',}):'/web/static/img/user_menu_avatar.png';return avatar;}
get hasFooter(){if(!this.composerView){return false;}
return(this.props.hasThreadTyping||this.composerView.composer.attachments.length>0||this.composerView.messageViewInEditing||!this.props.isCompact);}
get hasHeader(){if(!this.composerView){return false;}
return((this.props.hasThreadName&&this.composerView.composer.thread)||(this.props.hasFollowers&&!this.composerView.composer.isLog)||this.composerView.threadView&&this.composerView.threadView.replyingToMessageView);}
_postMessage(){if(!this.composerView.composer.canPostMessage){if(this.composerView.composer.hasUploadingAttachment){this.env.services['notification'].notify({message:this.env._t("Please wait while the file is uploading."),type:'warning',});}
return;}
if(this.composerView.messageViewInEditing){this.composerView.updateMessage();return;}
this.composerView.postMessage();}
_onClickAddAttachment(){this._fileUploaderRef.comp.openBrowserFileUploader();if(!this.messaging.device.isMobileDevice){this.composerView.update({doFocus:true});}}
async _onClickCaptureGlobal(ev){if(this.contains(ev.target)){return;}
await new Promise(this.env.browser.setTimeout);if(isEventHandled(ev,'MessageActionList.replyTo')){return;}
if(!this.composerView){return;}
this.composerView.discard();}
_onClickFullComposer(){this.composerView.openFullComposer();}
_onClickDiscard(ev){this.composerView.discard();}
_onClickSend(){this._postMessage();this.composerView.update({doFocus:true});}
_onComposerTextInputSendShortcut(){this._postMessage();}
async _onDropZoneFilesDropped(ev){ev.stopPropagation();await this._fileUploaderRef.comp.uploadFiles(ev.detail.files);this.isDropZoneVisible.value=false;}
_onEmojiSelection(ev){ev.stopPropagation();this._textInputRef.comp.saveStateInStore();this.composerView.insertIntoTextInput(ev.detail.unicode);if(!this.messaging.device.isMobileDevice){this.composerView.update({doFocus:true});}}
_onKeydown(ev){if(ev.key==='Escape'){if(isEventHandled(ev,'ComposerTextInput.closeSuggestions')){return;}
if(isEventHandled(ev,'Composer.closeEmojisPopover')){return;}
ev.preventDefault();this.composerView.discard();}}
_onKeydownEmojiButton(ev){if(ev.key==='Escape'){if(this._emojisPopoverRef.comp){this._emojisPopoverRef.comp.close();this.composerView.update({doFocus:true});markEventHandled(ev,'Composer.closeEmojisPopover');}}}
async _onPasteTextInput(ev){if(!ev.clipboardData||!ev.clipboardData.files){return;}
await this._fileUploaderRef.comp.uploadFiles(ev.clipboardData.files);}}
Object.assign(Composer,{defaultProps:{hasCurrentPartnerAvatar:true,hasDiscardButton:false,hasFollowers:false,hasSendButton:true,hasThreadName:false,hasThreadTyping:false,isCompact:true,isExpandable:false,},props:{composerViewLocalId:String,hasCurrentPartnerAvatar:Boolean,hasDiscardButton:Boolean,hasFollowers:Boolean,hasMentionSuggestionsBelowPosition:{type:Boolean,optional:true,},hasSendButton:Boolean,hasThreadName:Boolean,hasThreadTyping:Boolean,showAttachmentsExtensions:{type:Boolean,optional:true,},showAttachmentsFilenames:{type:Boolean,optional:true,},isCompact:Boolean,isExpandable:Boolean,textInputSendShortcuts:{type:Array,element:String,optional:true,},},template:'mail.Composer',});registerMessagingComponent(Composer,{propsCompareDepth:{textInputSendShortcuts:1}});return __exports;});;

/* /mail/static/src/components/composer_suggested_recipient/composer_suggested_recipient.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/composer_suggested_recipient/composer_suggested_recipient',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useUpdate}=require('@mail/component_hooks/use_update/use_update');const{FormViewDialog}=require('web.view_dialogs');const{ComponentAdapter}=require('web.OwlCompatibility');const{Component}=owl;const{useRef}=owl.hooks;class FormViewDialogComponentAdapter extends ComponentAdapter{renderWidget(){return this.willStart();}}
const ComposerSuggestedRecipient=__exports.ComposerSuggestedRecipient=class ComposerSuggestedRecipient extends Component{constructor(...args){super(...args);this.id=_.uniqueId('o_ComposerSuggestedRecipient_');useUpdate({func:()=>this._update()});this.FormViewDialog=FormViewDialog;this._checkboxRef=useRef('checkbox');this._dialogRef=useRef('dialog');this._isDialogOpen=false;this._onDialogSaved=this._onDialogSaved.bind(this);}
get ADD_AS_RECIPIENT_AND_FOLLOWER_REASON(){if(!this.suggestedRecipientInfo){return undefined;}
return this.env._t(_.str.sprintf("Add as recipient and follower (reason: %s)",this.suggestedRecipientInfo.reason));}
get PLEASE_COMPLETE_CUSTOMER_S_INFORMATION(){return this.env._t("Please complete customer's information");}
get suggestedRecipientInfo(){return this.messaging&&this.messaging.models['mail.suggested_recipient_info'].get(this.props.suggestedRecipientInfoLocalId);}
_update(){if(this._checkboxRef.el&&this.suggestedRecipientInfo){this._checkboxRef.el.checked=this.suggestedRecipientInfo.isSelected;}}
_onChangeCheckbox(){const isChecked=this._checkboxRef.el.checked;this.suggestedRecipientInfo.update({isSelected:isChecked});if(!this.suggestedRecipientInfo.partner){if(isChecked&&this._dialogRef&&!this._isDialogOpen){this._isDialogOpen=true;this._dialogRef.comp.widget.on('closed',this,()=>{this._isDialogOpen=false;});this._dialogRef.comp.widget.open();}}}
_onDialogSaved(){const thread=this.suggestedRecipientInfo&&this.suggestedRecipientInfo.thread;if(!thread){return;}
thread.fetchAndUpdateSuggestedRecipients();}}
Object.assign(ComposerSuggestedRecipient,{components:{FormViewDialogComponentAdapter},props:{suggestedRecipientInfoLocalId:String,},template:'mail.ComposerSuggestedRecipient',});registerMessagingComponent(ComposerSuggestedRecipient);return __exports;});;

/* /mail/static/src/components/composer_suggested_recipient_list/composer_suggested_recipient_list.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/composer_suggested_recipient_list/composer_suggested_recipient_list',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const{useState}=owl.hooks;const ComposerSuggestedRecipientList=__exports.ComposerSuggestedRecipientList=class ComposerSuggestedRecipientList extends Component{constructor(...args){super(...args);this.state=useState({hasShowMoreButton:false,});}
get thread(){return this.messaging&&this.messaging.models['mail.thread'].get(this.props.threadLocalId);}
_onClickShowLess(ev){this.state.hasShowMoreButton=false;}
_onClickShowMore(ev){this.state.hasShowMoreButton=true;}}
Object.assign(ComposerSuggestedRecipientList,{props:{threadLocalId:String,},template:'mail.ComposerSuggestedRecipientList',});registerMessagingComponent(ComposerSuggestedRecipientList);return __exports;});;

/* /mail/static/src/components/composer_suggestion/composer_suggestion.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/composer_suggestion/composer_suggestion',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useUpdate}=require('@mail/component_hooks/use_update/use_update');const{link}=require('@mail/model/model_field_command');const{Component}=owl;const ComposerSuggestion=__exports.ComposerSuggestion=class ComposerSuggestion extends Component{constructor(...args){super(...args);useUpdate({func:()=>this._update()});}
get composerView(){return this.messaging&&this.messaging.models['mail.composer_view'].get(this.props.composerViewLocalId);}
get isCannedResponse(){return this.props.modelName==="mail.canned_response";}
get isChannel(){return this.props.modelName==="mail.thread";}
get isCommand(){return this.props.modelName==="mail.channel_command";}
get isPartner(){return this.props.modelName==="mail.partner";}
get record(){return this.messaging&&this.messaging.models[this.props.modelName].get(this.props.recordLocalId);}
title(){if(this.isCannedResponse){return _.str.sprintf("%s: %s",this.record.source,this.record.substitution);}
if(this.isChannel){return this.record.name;}
if(this.isCommand){return _.str.sprintf("%s: %s",this.record.name,this.record.help);}
if(this.isPartner){if(this.record.email){return _.str.sprintf("%s (%s)",this.record.nameOrDisplayName,this.record.email);}
return this.record.nameOrDisplayName;}
return"";}
_update(){if(this.composerView&&this.composerView.hasToScrollToActiveSuggestion&&this.props.isActive){this.el.scrollIntoView({block:'center',});this.composerView.update({hasToScrollToActiveSuggestion:false});}}
_onClick(ev){ev.preventDefault();this.composerView.update({activeSuggestedRecord:link(this.record)});this.composerView.insertSuggestion();this.composerView.closeSuggestions();this.composerView.update({doFocus:true});}}
Object.assign(ComposerSuggestion,{defaultProps:{isActive:false,},props:{composerViewLocalId:String,isActive:Boolean,modelName:String,recordLocalId:String,},template:'mail.ComposerSuggestion',});registerMessagingComponent(ComposerSuggestion);return __exports;});;

/* /mail/static/src/components/composer_suggestion_list/composer_suggestion_list.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/composer_suggestion_list/composer_suggestion_list',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const ComposerSuggestionList=__exports.ComposerSuggestionList=class ComposerSuggestionList extends Component{get composerView(){return this.messaging&&this.messaging.models['mail.composer_view'].get(this.props.composerViewLocalId);}}
Object.assign(ComposerSuggestionList,{defaultProps:{isBelow:false,},props:{composerViewLocalId:String,isBelow:Boolean,},template:'mail.ComposerSuggestionList',});registerMessagingComponent(ComposerSuggestionList);return __exports;});;

/* /mail/static/src/components/composer_text_input/composer_text_input.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/composer_text_input/composer_text_input',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useUpdate}=require('@mail/component_hooks/use_update/use_update');const{markEventHandled}=require('@mail/utils/utils');const{Component}=owl;const{useRef}=owl.hooks;const ComposerTextInput=__exports.ComposerTextInput=class ComposerTextInput extends Component{constructor(...args){super(...args);useUpdate({func:()=>this._update()});this._textareaLastInputValue="";this._textareaRef=useRef('textarea');this._mirroredTextareaRef=useRef('mirroredTextarea');}
get composerView(){return this.messaging&&this.messaging.models['mail.composer_view'].get(this.props.composerViewLocalId);}
get textareaPlaceholder(){if(!this.composerView){return"";}
if(!this.composerView.composer.thread){return"";}
if(this.composerView.composer.thread.model==='mail.channel'){if(this.composerView.composer.thread.correspondent){return _.str.sprintf(this.env._t("Message %s..."),this.composerView.composer.thread.correspondent.nameOrDisplayName);}
return _.str.sprintf(this.env._t("Message #%s..."),this.composerView.composer.thread.displayName);}
if(this.composerView.composer.isLog){return this.env._t("Log an internal note...");}
return this.env._t("Send a message to followers...");}
saveStateInStore(){this.composerView.composer.update({textInputContent:this._getContent(),textInputCursorEnd:this._getSelectionEnd(),textInputCursorStart:this._getSelectionStart(),textInputSelectionDirection:this._textareaRef.el.selectionDirection,});}
_getContent(){return this._textareaRef.el.value;}
_getSelectionEnd(){return this._textareaRef.el.selectionEnd;}
_getSelectionStart(){return this._textareaRef.el.selectionStart;}
_isEmpty(){return this._getContent()==="";}
_update(){if(!this.composerView){return;}
if(this.composerView.doFocus){this.composerView.update({doFocus:false});if(this.messaging.device.isMobile){this.el.scrollIntoView();}
this._textareaRef.el.focus();}
if(this.composerView.composer.isLastStateChangeProgrammatic){this._textareaRef.el.value=this.composerView.composer.textInputContent;if(this.composerView.hasFocus){this._textareaRef.el.setSelectionRange(this.composerView.composer.textInputCursorStart,this.composerView.composer.textInputCursorEnd,this.composerView.composer.textInputSelectionDirection,);}
this.composerView.composer.update({isLastStateChangeProgrammatic:false});}
this._updateHeight();}
_updateHeight(){this._mirroredTextareaRef.el.value=this.composerView.composer.textInputContent;this._textareaRef.el.style.height=(this._mirroredTextareaRef.el.scrollHeight)+"px";}
_onClickTextarea(){if(!this.composerView){return;}
this.saveStateInStore();}
_onFocusinTextarea(){if(!this.composerView){return;}
this.composerView.update({hasFocus:true});}
_onFocusoutTextarea(){if(!this.composerView){return;}
this.saveStateInStore();this.composerView.update({hasFocus:false});}
_onInputTextarea(){if(!this.composerView){return;}
this.saveStateInStore();if(this._textareaLastInputValue!==this._textareaRef.el.value){this.composerView.handleCurrentPartnerIsTyping();}
this._textareaLastInputValue=this._textareaRef.el.value;this._updateHeight();}
_onKeydownTextarea(ev){if(!this.composerView){return;}
switch(ev.key){case'Escape':if(this.composerView.hasSuggestions){ev.preventDefault();this.composerView.closeSuggestions();markEventHandled(ev,'ComposerTextInput.closeSuggestions');}
break;case'ArrowUp':case'PageUp':case'ArrowDown':case'PageDown':case'Home':case'End':case'Tab':if(this.composerView.hasSuggestions){ev.preventDefault();}
break;case'Enter':this._onKeydownTextareaEnter(ev);break;}}
_onKeydownTextareaEnter(ev){if(!this.composerView){return;}
if(this.composerView.hasSuggestions){ev.preventDefault();return;}
if(this.props.sendShortcuts.includes('ctrl-enter')&&!ev.altKey&&ev.ctrlKey&&!ev.metaKey&&!ev.shiftKey){this.trigger('o-composer-text-input-send-shortcut');ev.preventDefault();return;}
if(this.props.sendShortcuts.includes('enter')&&!ev.altKey&&!ev.ctrlKey&&!ev.metaKey&&!ev.shiftKey){this.trigger('o-composer-text-input-send-shortcut');ev.preventDefault();return;}
if(this.props.sendShortcuts.includes('meta-enter')&&!ev.altKey&&!ev.ctrlKey&&ev.metaKey&&!ev.shiftKey){this.trigger('o-composer-text-input-send-shortcut');ev.preventDefault();return;}}
_onKeyupTextarea(ev){if(!this.composerView){return;}
switch(ev.key){case'Escape':break;case'Enter':if(this.composerView.hasSuggestions){this.composerView.insertSuggestion();this.composerView.closeSuggestions();this.composerView.update({doFocus:true});}
break;case'ArrowUp':case'PageUp':if(ev.key==='ArrowUp'&&!this.composerView.hasSuggestions&&!this.composerView.composer.textInputContent&&this.composerView.threadView){this.composerView.threadView.startEditingLastMessageFromCurrentUser();break;}
if(this.composerView.hasSuggestions){this.composerView.setPreviousSuggestionActive();this.composerView.update({hasToScrollToActiveSuggestion:true});}
break;case'ArrowDown':case'PageDown':if(ev.key==='ArrowDown'&&!this.composerView.hasSuggestions&&!this.composerView.composer.textInputContent&&this.composerView.threadView){this.composerView.threadView.startEditingLastMessageFromCurrentUser();break;}
if(this.composerView.hasSuggestions){this.composerView.setNextSuggestionActive();this.composerView.update({hasToScrollToActiveSuggestion:true});}
break;case'Home':if(this.composerView.hasSuggestions){this.composerView.setFirstSuggestionActive();this.composerView.update({hasToScrollToActiveSuggestion:true});}
break;case'End':if(this.composerView.hasSuggestions){this.composerView.setLastSuggestionActive();this.composerView.update({hasToScrollToActiveSuggestion:true});}
break;case'Tab':if(this.composerView.hasSuggestions){if(ev.shiftKey){this.composerView.setPreviousSuggestionActive();this.composerView.update({hasToScrollToActiveSuggestion:true});}else{this.composerView.setNextSuggestionActive();this.composerView.update({hasToScrollToActiveSuggestion:true});}}
break;case'Alt':case'AltGraph':case'CapsLock':case'Control':case'Fn':case'FnLock':case'Hyper':case'Meta':case'NumLock':case'ScrollLock':case'Shift':case'ShiftSuper':case'Symbol':case'SymbolLock':break;default:this.saveStateInStore();}}}
Object.assign(ComposerTextInput,{defaultProps:{hasMentionSuggestionsBelowPosition:false,sendShortcuts:[],},props:{composerViewLocalId:String,hasMentionSuggestionsBelowPosition:Boolean,isCompact:Boolean,sendShortcuts:{type:Array,element:String,validate:prop=>{for(const shortcut of prop){if(!['ctrl-enter','enter','meta-enter'].includes(shortcut)){return false;}}
return true;},},},template:'mail.ComposerTextInput',});registerMessagingComponent(ComposerTextInput,{propsCompareDepth:{sendShortcuts:1}});return __exports;});;

/* /mail/static/src/components/delete_message_confirm_dialog/delete_message_confirm_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/delete_message_confirm_dialog/delete_message_confirm_dialog',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const Dialog=require('web.OwlDialog');const{Component}=owl;const{useRef}=owl.hooks;const DeleteMessageConfirmDialog=__exports.DeleteMessageConfirmDialog=class DeleteMessageConfirmDialog extends Component{setup(){super.setup();this.title=this.env._t("Confirmation");this.dialogRef=useRef('dialog');}
get messageActionList(){return this.messaging&&this.messaging.models['mail.message_action_list'].get(this.props.messageActionListLocalId);}}
Object.assign(DeleteMessageConfirmDialog,{components:{Dialog,},props:{messageActionListLocalId:String,},template:'mail.DeleteMessageConfirmDialog',});registerMessagingComponent(DeleteMessageConfirmDialog);return __exports;});;

/* /mail/static/src/components/dialog/dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/dialog/dialog',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const{useRef}=owl.hooks;const Dialog=__exports.Dialog=class Dialog extends Component{constructor(...args){super(...args);this._componentRef=useRef('component');this._onClickGlobal=this._onClickGlobal.bind(this);this._onKeydownDocument=this._onKeydownDocument.bind(this);this._constructor();}
_constructor(){}
mounted(){document.addEventListener('click',this._onClickGlobal,true);document.addEventListener('keydown',this._onKeydownDocument);}
willUnmount(){document.removeEventListener('click',this._onClickGlobal,true);document.removeEventListener('keydown',this._onKeydownDocument);}
get dialog(){return this.messaging&&this.messaging.models['mail.dialog'].get(this.props.dialogLocalId);}
_onClick(ev){ev.stopPropagation();}
_onClickGlobal(ev){if(this._componentRef.el&&this._componentRef.el.contains(ev.target)){return;}
if(this._componentRef.comp&&this._componentRef.comp.isCloseable&&!this._componentRef.comp.isCloseable()){return;}
this.dialog.delete();}
_onKeydownDocument(ev){if(ev.key==='Escape'){this.dialog.delete();}}}
Object.assign(Dialog,{props:{dialogLocalId:String,},template:'mail.Dialog',});registerMessagingComponent(Dialog);return __exports;});;

/* /mail/static/src/components/dialog_manager/dialog_manager.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/dialog_manager/dialog_manager',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const DialogManager=__exports.DialogManager=class DialogManager extends Component{mounted(){this._checkDialogOpen();}
patched(){this._checkDialogOpen();}
_checkDialogOpen(){if(!this.messaging||!this.messaging.dialogManager){return;}
if(this.messaging.dialogManager.dialogs.length>0){document.body.classList.add('modal-open');}else{document.body.classList.remove('modal-open');}}}
Object.assign(DialogManager,{props:{},template:'mail.DialogManager',});registerMessagingComponent(DialogManager);return __exports;});;

/* /mail/static/src/components/discuss/discuss.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/discuss/discuss',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{link,unlink}=require('@mail/model/model_field_command');const{useUpdate}=require('@mail/component_hooks/use_update/use_update');const{Component}=owl;const Discuss=__exports.Discuss=class Discuss extends Component{constructor(...args){super(...args);this._updateLocalStoreProps();this._onMobileAddItemHeaderInputSelect=this._onMobileAddItemHeaderInputSelect.bind(this);this._onMobileAddItemHeaderInputSource=this._onMobileAddItemHeaderInputSource.bind(this);useUpdate({func:()=>this._update()});}
_update(){if(!this.discuss){return;}
this.discuss.update({isOpen:true});if(this.discuss.thread){this.trigger('o-push-state-action-manager');}
if(this.discuss.thread&&this.discuss.thread===this.messaging.inbox&&this.discuss.threadView&&this._lastThreadCache===this.discuss.threadView.threadCache.localId&&this._lastThreadCounter>0&&this.discuss.thread.counter===0){this.trigger('o-show-rainbow-man');}
this._updateLocalStoreProps();}
willUnmount(){if(this.discuss){this.discuss.close();}}
get addChannelInputPlaceholder(){return this.env._t("Create or search channel...");}
get addChatInputPlaceholder(){return this.env._t("Search user...");}
get discuss(){return this.messaging&&this.messaging.discuss;}
mobileNavbarTabs(){return[{icon:'fa fa-inbox',id:'mailbox',label:this.env._t("Mailboxes"),},{icon:'fa fa-user',id:'chat',label:this.env._t("Chat"),},{icon:'fa fa-users',id:'channel',label:this.env._t("Channel"),}];}
_updateLocalStoreProps(){if(!this.discuss){return;}
this._lastThreadCache=(this.discuss.threadView&&this.discuss.threadView.threadCache&&this.discuss.threadView.threadCache.localId);this._lastThreadCounter=(this.discuss.thread&&this.discuss.thread.counter);}
_onHideMobileAddItemHeader(ev){ev.stopPropagation();this.discuss.clearIsAddingItem();}
_onMobileAddItemHeaderInputSelect(ev,ui){const discuss=this.discuss;if(discuss.isAddingChannel){discuss.handleAddChannelAutocompleteSelect(ev,ui);}else{discuss.handleAddChatAutocompleteSelect(ev,ui);}}
_onMobileAddItemHeaderInputSource(req,res){if(this.discuss.isAddingChannel){this.discuss.handleAddChannelAutocompleteSource(req,res);}else{this.discuss.handleAddChatAutocompleteSource(req,res);}}
_onSelectMobileNavbarTab(ev){ev.stopPropagation();if(this.discuss.activeMobileNavbarTabId===ev.detail.tabId){return;}
this.discuss.update({activeMobileNavbarTabId:ev.detail.tabId});if(this.discuss.activeMobileNavbarTabId==='mailbox'&&(!this.discuss.thread||this.discuss.thread.model!=='mailbox')){this.discuss.update({thread:link(this.messaging.inbox)});}
if(this.discuss.activeMobileNavbarTabId!=='mailbox'){this.discuss.update({thread:unlink()});}
if(this.discuss.activeMobileNavbarTabId!=='chat'){this.discuss.update({isAddingChat:false});}
if(this.discuss.activeMobileNavbarTabId!=='channel'){this.discuss.update({isAddingChannel:false});}}}
Object.assign(Discuss,{props:{},template:'mail.Discuss',});registerMessagingComponent(Discuss);return __exports;});;

/* /mail/static/src/components/discuss_mobile_mailbox_selection/discuss_mobile_mailbox_selection.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/discuss_mobile_mailbox_selection/discuss_mobile_mailbox_selection',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const DiscussMobileMailboxSelection=__exports.DiscussMobileMailboxSelection=class DiscussMobileMailboxSelection extends Component{get orderedMailboxes(){if(!this.messaging){return[];}
return this.messaging.models['mail.thread'].all(thread=>thread.isPinned&&thread.model==='mail.box').sort((mailbox1,mailbox2)=>{if(mailbox1===this.messaging.inbox){return-1;}
if(mailbox2===this.messaging.inbox){return 1;}
if(mailbox1===this.messaging.starred){return-1;}
if(mailbox2===this.messaging.starred){return 1;}
const mailbox1Name=mailbox1.displayName;const mailbox2Name=mailbox2.displayName;mailbox1Name<mailbox2Name?-1:1;});}
get discuss(){return this.messaging&&this.messaging.discuss;}
_onClick(ev){const{mailboxLocalId}=ev.currentTarget.dataset;const mailbox=this.messaging.models['mail.thread'].get(mailboxLocalId);if(!mailbox){return;}
mailbox.open();}}
Object.assign(DiscussMobileMailboxSelection,{props:{},template:'mail.DiscussMobileMailboxSelection',});registerMessagingComponent(DiscussMobileMailboxSelection);return __exports;});;

/* /mail/static/src/components/discuss_public_view/discuss_public_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/discuss_public_view/discuss_public_view',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;class DiscussPublicView extends Component{get discussPublicView(){return this.messaging&&this.messaging.models['mail.discuss_public_view'].get(this.props.localId);}}
Object.assign(DiscussPublicView,{props:{localId:String},template:'mail.DiscussPublicView',});registerMessagingComponent(DiscussPublicView);return __exports;});;

/* /mail/static/src/components/discuss_sidebar/discuss_sidebar.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/discuss_sidebar/discuss_sidebar',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useRefToModel}=require('@mail/component_hooks/use_ref_to_model/use_ref_to_model');const{useUpdate}=require('@mail/component_hooks/use_update/use_update');const{Component}=owl;const{useRef}=owl.hooks;const DiscussSidebar=__exports.DiscussSidebar=class DiscussSidebar extends Component{constructor(...args){super(...args);useUpdate({func:()=>this._update()});useRefToModel({fieldName:'startAMeetingButtonRef',modelName:'mail.discuss',propNameAsRecordLocalId:'localId',refName:'startAMeetingButton'});this._quickSearchInputRef=useRef('quickSearchInput');}
get discuss(){return this.messaging&&this.messaging.models['mail.discuss'].get(this.props.localId);}
_update(){if(!this.discuss){return;}
if(this._quickSearchInputRef.el){this._quickSearchInputRef.el.value=this.discuss.sidebarQuickSearchValue;}}
_onInputQuickSearch(ev){ev.stopPropagation();this.discuss.onInputQuickSearch(this._quickSearchInputRef.el.value);}}
Object.assign(DiscussSidebar,{props:{localId:String},template:'mail.DiscussSidebar',});registerMessagingComponent(DiscussSidebar);return __exports;});;

/* /mail/static/src/components/discuss_sidebar_category/discuss_sidebar_category.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/discuss_sidebar_category/discuss_sidebar_category',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const DiscussSidebarCategory=__exports.DiscussSidebarCategory=class DiscussSidebarCategory extends Component{get category(){return this.messaging.models['mail.discuss_sidebar_category'].get(this.props.categoryLocalId);}}
Object.assign(DiscussSidebarCategory,{props:{categoryLocalId:String,},template:'mail.DiscussSidebarCategory',});registerMessagingComponent(DiscussSidebarCategory);return __exports;});;

/* /mail/static/src/components/discuss_sidebar_category_item/discuss_sidebar_category_item.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/discuss_sidebar_category_item/discuss_sidebar_category_item',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const DiscussSidebarCategoryItem=__exports.DiscussSidebarCategoryItem=class DiscussSidebarCategoryItem extends Component{get categoryItem(){return this.messaging.models['mail.discuss_sidebar_category_item'].get(this.props.categoryItemLocalId);}}
Object.assign(DiscussSidebarCategoryItem,{props:{categoryItemLocalId:String,},template:'mail.DiscussSidebarCategoryItem',});registerMessagingComponent(DiscussSidebarCategoryItem);return __exports;});;

/* /mail/static/src/components/discuss_sidebar_mailbox/discuss_sidebar_mailbox.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/discuss_sidebar_mailbox/discuss_sidebar_mailbox',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const DiscussSidebarMailbox=__exports.DiscussSidebarMailbox=class DiscussSidebarMailbox extends Component{get mailbox(){return this.messaging.models['mail.thread'].get(this.props.threadLocalId);}}
Object.assign(DiscussSidebarMailbox,{props:{threadLocalId:String,},template:'mail.DiscussSidebarMailbox',});registerMessagingComponent(DiscussSidebarMailbox);return __exports;});;

/* /mail/static/src/components/drop_zone/drop_zone.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/drop_zone/drop_zone',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component,useState}=owl;const DropZone=__exports.DropZone=class DropZone extends Component{constructor(...args){super(...args);this.state=useState({isDraggingInside:false,});this._dragCount=0;}
contains(node){return Boolean(this.el&&this.el.contains(node));}
_isDragSourceExternalFile(dataTransfer){const dragDataType=dataTransfer.types;if(dragDataType.constructor===window.DOMStringList){return dragDataType.contains('Files');}
if(dragDataType.constructor===Array){return dragDataType.includes('Files');}
return false;}
_onDragenter(ev){ev.preventDefault();if(this._dragCount===0){this.state.isDraggingInside=true;}
this._dragCount++;}
_onDragleave(ev){this._dragCount--;if(this._dragCount===0){this.state.isDraggingInside=false;}}
_onDragover(ev){ev.preventDefault();ev.dataTransfer.dropEffect='copy';}
_onDrop(ev){ev.preventDefault();if(this._isDragSourceExternalFile(ev.dataTransfer)){this.trigger('o-dropzone-files-dropped',{files:ev.dataTransfer.files,});}
this.state.isDraggingInside=false;}}
Object.assign(DropZone,{props:{},template:'mail.DropZone',});registerMessagingComponent(DropZone);return __exports;});;

/* /mail/static/src/components/editable_text/editable_text.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/editable_text/editable_text',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{markEventHandled}=require('@mail/utils/utils');const{Component}=owl;const EditableText=__exports.EditableText=class EditableText extends Component{mounted(){this.el.focus();this.el.setSelectionRange(0,(this.el.value&&this.el.value.length)||0);}
willUnmount(){this.trigger('o-cancel');}
_onBlur(ev){this.trigger('o-cancel');}
_onClick(ev){markEventHandled(ev,'EditableText.click');this.trigger('o-clicked');}
_onKeydown(ev){switch(ev.key){case'Enter':this._onKeydownEnter(ev);break;case'Escape':this.trigger('o-cancel');break;}}
_onKeydownEnter(ev){if(!this.el){return;}
const value=this.el.value;const newName=value||this.props.placeholder;if(this.props.value!==newName){this.trigger('o-validate',{newName});}else{this.trigger('o-cancel');}}}
Object.assign(EditableText,{defaultProps:{placeholder:"",value:"",},props:{placeholder:String,value:String,},template:'mail.EditableText',});registerMessagingComponent(EditableText);return __exports;});;

/* /mail/static/src/components/emojis_popover/emojis_popover.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/emojis_popover/emojis_popover',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useUpdate}=require('@mail/component_hooks/use_update/use_update');const emojis=require('@mail/js/emojis')[Symbol.for("default")];const{Component}=owl;const EmojisPopover=__exports.EmojisPopover=class EmojisPopover extends Component{constructor(...args){super(...args);this.emojis=emojis;useUpdate({func:()=>this._update()});}
_update(){this.trigger('o-popover-compute');}
close(){this.trigger('o-popover-close');}
contains(node){return Boolean(this.el&&this.el.contains(node));}
_onClickEmoji(ev){this.close();this.trigger('o-emoji-selection',{unicode:ev.currentTarget.dataset.unicode,});}}
Object.assign(EmojisPopover,{props:{},template:'mail.EmojisPopover',});registerMessagingComponent(EmojisPopover);return __exports;});;

/* /mail/static/src/components/file_uploader/file_uploader.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/file_uploader/file_uploader',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{replace}=require('@mail/model/model_field_command');const core=require('web.core');const{Component}=owl;const{useRef}=owl.hooks;const geAttachmentNextTemporaryId=(function(){let tmpId=0;return()=>{tmpId-=1;return tmpId;};})();const FileUploader=__exports.FileUploader=class FileUploader extends Component{constructor(...args){super(...args);this._fileInputRef=useRef('fileInput');this._fileUploadId=_.uniqueId('o_FileUploader_fileupload');}
get composerView(){return this.messaging.models['mail.composer_view'].get(this.props.composerViewLocalId);}
async uploadFiles(files){await this._performUpload({composer:this.composerView&&this.composerView.composer,files,thread:this.thread,});this._fileInputRef.el.value='';}
openBrowserFileUploader(){this._fileInputRef.el.click();}
get thread(){return this.messaging.models['mail.thread'].get(this.props.threadLocalId);}
_createFormData({composer,file,thread}){const formData=new window.FormData();formData.append('csrf_token',core.csrf_token);formData.append('is_pending',Boolean(composer));formData.append('thread_id',thread&&thread.id);formData.append('thread_model',thread&&thread.model);formData.append('ufile',file,file.name);return formData;}
async _performUpload({composer,files,thread}){const uploadingAttachments=new Map();for(const file of files){uploadingAttachments.set(file,this.messaging.models['mail.attachment'].insert({composer:composer&&replace(composer),filename:file.name,id:geAttachmentNextTemporaryId(),isUploading:true,mimetype:file.type,name:file.name,originThread:(!composer&&thread)?replace(thread):undefined,}));}
for(const file of files){const uploadingAttachment=uploadingAttachments.get(file);if(!uploadingAttachment.exists()){continue;}
if((composer&&!composer.exists())||(thread&&!thread.exists())){return;}
try{const response=await this.env.browser.fetch('/mail/attachment/upload',{method:'POST',body:this._createFormData({composer,file,thread}),signal:uploadingAttachment.uploadingAbortController.signal,});const attachmentData=await response.json();if(uploadingAttachment.exists()){uploadingAttachment.delete();}
if((composer&&!composer.exists())||(thread&&!thread.exists())){return;}
this._onAttachmentUploaded({attachmentData,composer,thread});}catch(e){if(e.name!=='AbortError'){throw e;}}}}
_onAttachmentUploaded({attachmentData,composer,thread}){if(attachmentData.error||!attachmentData.id){this.env.services['notification'].notify({type:'danger',message:attachmentData.error,});return;}
const attachment=this.messaging.models['mail.attachment'].insert({composer:composer&&replace(composer),originThread:(!composer&&thread)?replace(thread):undefined,...attachmentData,});this.trigger('o-attachment-created',{attachment});}
async _onChangeAttachment(ev){await this.uploadFiles(ev.target.files);}}
Object.assign(FileUploader,{props:{composerViewLocalId:{type:String,optional:true,},threadLocalId:{type:String,optional:true,},},template:'mail.FileUploader',});registerMessagingComponent(FileUploader);return __exports;});;

/* /mail/static/src/components/follow_button/follow_button.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/follow_button/follow_button',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const{useState}=owl.hooks;const FollowButton=__exports.FollowButton=class FollowButton extends Component{constructor(...args){super(...args);this.state=useState({isUnfollowButtonHighlighted:false,});}
get thread(){return this.messaging&&this.messaging.models['mail.thread'].get(this.props.threadLocalId);}
_onClickFollow(ev){this.thread.follow();}
_onClickUnfollow(ev){this.thread.unfollow();}
_onMouseLeaveUnfollow(ev){this.state.isUnfollowButtonHighlighted=false;}
_onMouseEnterUnfollow(ev){this.state.isUnfollowButtonHighlighted=true;}}
Object.assign(FollowButton,{defaultProps:{isDisabled:false,},props:{isDisabled:Boolean,threadLocalId:String,},template:'mail.FollowButton',});registerMessagingComponent(FollowButton);return __exports;});;

/* /mail/static/src/components/follower/follower.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/follower/follower',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const Follower=__exports.Follower=class Follower extends Component{get follower(){return this.messaging&&this.messaging.models['mail.follower'].get(this.props.followerLocalId);}
_onClickDetails(ev){ev.preventDefault();ev.stopPropagation();this.follower.openProfile();}
_onClickEdit(ev){ev.preventDefault();this.follower.showSubtypes();}
_onClickRemove(ev){this.follower.remove();}}
Object.assign(Follower,{props:{followerLocalId:String,},template:'mail.Follower',});registerMessagingComponent(Follower);return __exports;});;

/* /mail/static/src/components/follower_list_menu/follower_list_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/follower_list_menu/follower_list_menu',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const{useRef,useState}=owl.hooks;const FollowerListMenu=__exports.FollowerListMenu=class FollowerListMenu extends Component{constructor(...args){super(...args);this.state=useState({isDropdownOpen:false,});this._dropdownRef=useRef('dropdown');this._onClickCaptureGlobal=this._onClickCaptureGlobal.bind(this);}
mounted(){document.addEventListener('click',this._onClickCaptureGlobal,true);}
willUnmount(){document.removeEventListener('click',this._onClickCaptureGlobal,true);}
get thread(){return this.messaging&&this.messaging.models['mail.thread'].get(this.props.threadLocalId);}
_hide(){this.state.isDropdownOpen=false;}
_onKeydown(ev){ev.stopPropagation();switch(ev.key){case'Escape':ev.preventDefault();this._hide();break;}}
_onClickAddFollowers(ev){ev.preventDefault();this._hide();this.thread.promptAddPartnerFollower();}
_onClickCaptureGlobal(ev){if(this._dropdownRef.el&&!this._dropdownRef.el.contains(ev.target)){this._hide();}}
_onClickFollowersButton(ev){this.state.isDropdownOpen=!this.state.isDropdownOpen;}
_onClickFollower(ev){this._hide();}}
Object.assign(FollowerListMenu,{defaultProps:{isDisabled:false,},props:{isDisabled:Boolean,threadLocalId:String,},template:'mail.FollowerListMenu',});registerMessagingComponent(FollowerListMenu);return __exports;});;

/* /mail/static/src/components/follower_subtype/follower_subtype.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/follower_subtype/follower_subtype',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const FollowerSubtype=__exports.FollowerSubtype=class FollowerSubtype extends Component{get follower(){return this.messaging&&this.messaging.models['mail.follower'].get(this.props.followerLocalId);}
get followerSubtype(){return this.messaging&&this.messaging.models['mail.follower_subtype'].get(this.props.followerSubtypeLocalId);}
_onChangeCheckbox(ev){if(ev.target.checked){this.follower.selectSubtype(this.followerSubtype);}else{this.follower.unselectSubtype(this.followerSubtype);}}}
Object.assign(FollowerSubtype,{props:{followerLocalId:String,followerSubtypeLocalId:String,},template:'mail.FollowerSubtype',});registerMessagingComponent(FollowerSubtype);return __exports;});;

/* /mail/static/src/components/follower_subtype_list/follower_subtype_list.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/follower_subtype_list/follower_subtype_list',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const FollowerSubtypeList=__exports.FollowerSubtypeList=class FollowerSubtypeList extends Component{get followerSubtypeList(){return this.messaging&&this.messaging.models['mail.follower_subtype_list'].get(this.props.localId);}
_onClickCancel(ev){this.followerSubtypeList.follower.closeSubtypes();}
_onClickApply(ev){this.followerSubtypeList.follower.updateSubtypes();}}
Object.assign(FollowerSubtypeList,{props:{localId:String,},template:'mail.FollowerSubtypeList',});registerMessagingComponent(FollowerSubtypeList);return __exports;});;

/* /mail/static/src/components/mail_template/mail_template.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/mail_template/mail_template',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const MailTemplate=__exports.MailTemplate=class MailTemplate extends Component{get activity(){return this.messaging&&this.messaging.models['mail.activity'].get(this.props.activityLocalId);}
get mailTemplate(){return this.messaging&&this.messaging.models['mail.mail_template'].get(this.props.mailTemplateLocalId);}
_onClickPreview(ev){ev.stopPropagation();ev.preventDefault();this.mailTemplate.preview(this.activity);}
_onClickSend(ev){ev.stopPropagation();ev.preventDefault();this.mailTemplate.send(this.activity);}}
Object.assign(MailTemplate,{props:{activityLocalId:String,mailTemplateLocalId:String,},template:'mail.MailTemplate',});registerMessagingComponent(MailTemplate);return __exports;});;

/* /mail/static/src/components/media_preview/media_preview.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/media_preview/media_preview',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useRefToModel}=require('@mail/component_hooks/use_ref_to_model/use_ref_to_model');const MediaPreview=__exports.MediaPreview=class MediaPreview extends owl.Component{setup(){super.setup();useRefToModel({fieldName:'audioRef',modelName:'mail.media_preview',propNameAsRecordLocalId:'localId',refName:'audio'});useRefToModel({fieldName:'videoRef',modelName:'mail.media_preview',propNameAsRecordLocalId:'localId',refName:'video'});}
get mediaPreview(){return this.messaging&&this.messaging.models['mail.media_preview'].get(this.props.localId);}}
Object.assign(MediaPreview,{props:{localId:String},template:'mail.MediaPreview',});registerMessagingComponent(MediaPreview);return __exports;});;

/* /mail/static/src/components/message/message.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/message/message',async function(require){'use strict';let __exports={};const{useComponentToModel}=require('@mail/component_hooks/use_component_to_model/use_component_to_model');const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useUpdate}=require('@mail/component_hooks/use_update/use_update');const{isEventHandled,markEventHandled}=require('@mail/utils/utils');const{_lt}=require('web.core');const{format}=require('web.field_utils');const{getLangDatetimeFormat}=require('web.time');const{Component,useState}=owl;const{useRef}=owl.hooks;const READ_MORE=_lt("read more");const READ_LESS=_lt("read less");const Message=__exports.Message=class Message extends Component{constructor(...args){super(...args);this.state=useState({isHovered:false,isClicked:false,});useUpdate({func:()=>this._update()});this._lastPrettyBody;this._prettyBodyRef=useRef('prettyBody');this._contentRef=useRef('content');this._checkboxRef=useRef('checkbox');this._intervalId=undefined;this._lastReadMoreIndex=0;this._isReadMoreByIndex=new Map();this._constructor();}
_constructor(){}
setup(){super.setup();useComponentToModel({fieldName:'component',modelName:'mail.message_view',propNameAsRecordLocalId:'messageViewLocalId'});}
willUnmount(){clearInterval(this._intervalId);}
get avatar(){if(this.messageView.message.author&&(!this.messageView.message.originThread||this.messageView.message.originThread.model!=='mail.channel')){return this.messageView.message.author.avatarUrl;}else if(this.messageView.message.author&&this.messageView.message.originThread&&this.messageView.message.originThread.model==='mail.channel'){return`/mail/channel/${this.messageView.message.originThread.id}/partner/${this.messageView.message.author.id}/avatar_128`;}else if(this.messageView.message.guestAuthor&&(!this.messageView.message.originThread||this.messageView.message.originThread.model!=='mail.channel')){return this.messageView.message.guestAuthor.avatarUrl;}else if(this.messageView.message.guestAuthor&&this.messageView.message.originThread&&this.messageView.message.originThread.model==='mail.channel'){return`/mail/channel/${this.messageView.message.originThread.id}/guest/${this.messageView.message.guestAuthor.id}/avatar_128?unique=${this.messageView.message.guestAuthor.name}`;}else if(this.messageView.message.message_type==='email'){return'/mail/static/src/img/email_icon.png';}
return'/mail/static/src/img/smiley/avatar.jpg';}
get datetime(){return this.messageView.message.date.format(getLangDatetimeFormat());}
get hasAuthorOpenChat(){if(this.messaging.currentGuest){return false;}
if(!this.messageView.message.author){return false;}
if(this.threadView&&this.threadView.thread&&this.threadView.thread.correspondent===this.messageView.message.author){return false;}
return true;}
get isActive(){return Boolean(this.state.isHovered||this.state.isClicked||(this.messageView&&this.messageView.messageActionList&&(this.messageView.messageActionList.isReactionPopoverOpened||this.messageView.messageActionList.showDeleteConfirm)));}
isBottomVisible({offset=0}={}){if(!this.el){return false;}
const elRect=this.el.getBoundingClientRect();if(!this.el.parentNode){return false;}
const parentRect=this.el.parentNode.getBoundingClientRect();return(elRect.bottom<parentRect.bottom+offset&&parentRect.top<elRect.bottom+offset);}
isPartiallyVisible(){if(!this.el){return false;}
const elRect=this.el.getBoundingClientRect();if(!this.el.parentNode){return false;}
const parentRect=this.el.parentNode.getBoundingClientRect();return(elRect.top<parentRect.bottom+5&&parentRect.top<elRect.bottom+5);}
get isSelected(){return Boolean(this.threadView&&this.messageView&&this.threadView.replyingToMessageView===this.messageView);}
get messageView(){return this.messaging&&this.messaging.models['mail.message_view'].get(this.props.messageViewLocalId);}
get OPEN_CHAT(){return this.env._t("Open chat");}
async scrollIntoView({behavior='auto',block='end'}={}){this.el.scrollIntoView({behavior,block,inline:'nearest',});if(behavior==='smooth'){return new Promise(resolve=>setTimeout(resolve,500));}else{return Promise.resolve();}}
get shortTime(){return this.messageView.message.date.format('hh:mm');}
get threadView(){return this.messageView&&this.messageView.threadView;}
get trackingValues(){return this.messageView.message.tracking_value_ids.map(trackingValue=>{const value=Object.assign({},trackingValue);value.changed_field=_.str.sprintf(this.env._t("%s:"),value.changed_field);switch(value.field_type){case'boolean':value.old_value=format.boolean(value.old_value,undefined,{forceString:true});value.new_value=format.boolean(value.new_value,undefined,{forceString:true});break;case'char':case'many2one':case'selection':value.old_value=format.char(value.old_value);value.new_value=format.char(value.new_value);break;case'date':if(value.old_value){value.old_value=moment.utc(value.old_value);}
if(value.new_value){value.new_value=moment.utc(value.new_value);}
value.old_value=format.date(value.old_value);value.new_value=format.date(value.new_value);break;case'datetime':if(value.old_value){value.old_value=moment.utc(value.old_value);}
if(value.new_value){value.new_value=moment.utc(value.new_value);}
value.old_value=format.datetime(value.old_value);value.new_value=format.datetime(value.new_value);break;case'float':value.old_value=format.float(value.old_value);value.new_value=format.float(value.new_value);break;case'integer':value.old_value=format.integer(value.old_value);value.new_value=format.integer(value.new_value);break;case'monetary':value.old_value=format.monetary(value.old_value,undefined,{currency:value.currency_id?this.env.session.currencies[value.currency_id]:undefined,forceString:true,});value.new_value=format.monetary(value.new_value,undefined,{currency:value.currency_id?this.env.session.currencies[value.currency_id]:undefined,forceString:true,});break;case'text':value.old_value=format.text(value.old_value);value.new_value=format.text(value.new_value);break;}
return value;});}
_insertReadMoreLess($element){const groups=[];let readMoreNodes;const $children=$element.contents().filter((index,content)=>content.nodeType===1||(content.nodeType===3&&content.nodeValue.trim()));for(const child of $children){let $child=$(child);if(child.nodeType===3&&$child.prevAll('[id*="stopSpelling"]').length>0){$child=$('<span>',{text:child.textContent,'data-o-mail-quote':'1',});child.parentNode.replaceChild($child[0],child);}
if($child.attr('data-o-mail-quote')||($child.get(0).nodeName==='BR'&&$child.prev('[data-o-mail-quote="1"]').length>0)){if(!readMoreNodes){readMoreNodes=[];groups.push(readMoreNodes);}
$child.hide();readMoreNodes.push($child);}else{readMoreNodes=undefined;this._insertReadMoreLess($child);}}
for(const group of groups){const index=this._lastReadMoreIndex++;const $readMoreLess=$('<a>',{class:'o_Message_readMoreLess',href:'#',text:READ_MORE,}).insertBefore(group[0]);if(!this._isReadMoreByIndex.has(index)){this._isReadMoreByIndex.set(index,true);}
const updateFromState=()=>{const isReadMore=this._isReadMoreByIndex.get(index);for(const $child of group){$child.hide();$child.toggle(!isReadMore);}
$readMoreLess.text(isReadMore?READ_MORE:READ_LESS);};$readMoreLess.click(e=>{e.preventDefault();this._isReadMoreByIndex.set(index,!this._isReadMoreByIndex.get(index));updateFromState();});updateFromState();}}
_update(){if(!this.messageView){return;}
if(this._prettyBodyRef.el&&this.messageView.message.prettyBody!==this._lastPrettyBody){this._prettyBodyRef.el.innerHTML=this.messageView.message.prettyBody;this._lastPrettyBody=this.messageView.message.prettyBody;}
if(!this._prettyBodyRef.el){this._lastPrettyBody=undefined;}
if(this._contentRef.el){for(const el of[...this._contentRef.el.querySelectorAll(':scope .o_Message_readMoreLess')]){el.remove();}
this._lastReadMoreIndex=0;this._insertReadMoreLess($(this._contentRef.el));this.messaging.messagingBus.trigger('o-component-message-read-more-less-inserted',{message:this.messageView.message,});}
this.messageView.message.refreshDateFromNow();clearInterval(this._intervalId);this._intervalId=setInterval(()=>{if(this.messageView){this.messageView.message.refreshDateFromNow();}},60*1000);}
_onClick(ev){if(ev.target.closest('.o_channel_redirect')){this.messaging.openProfile({id:Number(ev.target.dataset.oeId),model:'mail.channel',});ev.preventDefault();return;}
if(ev.target.tagName==='A'){if(ev.target.dataset.oeId&&ev.target.dataset.oeModel){this.messaging.openProfile({id:Number(ev.target.dataset.oeId),model:ev.target.dataset.oeModel,});ev.preventDefault();}
return;}
if(!isEventHandled(ev,'Message.ClickAuthorAvatar')&&!isEventHandled(ev,'Message.ClickAuthorName')&&!isEventHandled(ev,'Message.ClickFailure')&&!isEventHandled(ev,'MessageActionList.Click')&&!isEventHandled(ev,'MessageReactionGroup.Click')&&!isEventHandled(ev,'MessageInReplyToView.ClickMessageInReplyTo')){this.state.isClicked=!this.state.isClicked;}}
_onClickAuthorAvatar(ev){markEventHandled(ev,'Message.ClickAuthorAvatar');if(!this.hasAuthorOpenChat){return;}
this.messageView.message.author.openChat();}
_onClickAuthorName(ev){markEventHandled(ev,'Message.ClickAuthorName');if(!this.messageView.message.author){return;}
this.messageView.message.author.openProfile();}
_onClickFailure(ev){markEventHandled(ev,'Message.ClickFailure');this.messageView.message.openResendAction();}
_onClickOriginThread(ev){ev.preventDefault();this.messageView.message.originThread.open();}}
Object.assign(Message,{props:{messageViewLocalId:String,},template:'mail.Message',});registerMessagingComponent(Message);return __exports;});;

/* /mail/static/src/components/message_action_list/message_action_list.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/message_action_list/message_action_list',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useRefToModel}=require('@mail/component_hooks/use_ref_to_model/use_ref_to_model');const{Component}=owl;const MessageActionList=__exports.MessageActionList=class MessageActionList extends Component{setup(){super.setup();useRefToModel({fieldName:'reactionPopoverRef',modelName:'mail.message_action_list',propNameAsRecordLocalId:'messageActionListLocalId',refName:'reactionPopover'});this.ADD_A_REACTION=this.env._t("Add a Reaction");}
get messageActionList(){return this.messaging&&this.messaging.models['mail.message_action_list'].get(this.props.messageActionListLocalId);}}
Object.assign(MessageActionList,{props:{messageActionListLocalId:String,},template:"mail.MessageActionList",});registerMessagingComponent(MessageActionList);return __exports;});;

/* /mail/static/src/components/message_author_prefix/message_author_prefix.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/message_author_prefix/message_author_prefix',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const MessageAuthorPrefix=__exports.MessageAuthorPrefix=class MessageAuthorPrefix extends Component{get message(){return this.messaging&&this.messaging.models['mail.message'].get(this.props.messageLocalId);}
get thread(){return this.messaging&&this.messaging.models['mail.thread'].get(this.props.threadLocalId);}}
Object.assign(MessageAuthorPrefix,{props:{messageLocalId:String,threadLocalId:{type:String,optional:true,},},template:'mail.MessageAuthorPrefix',});registerMessagingComponent(MessageAuthorPrefix);return __exports;});;

/* /mail/static/src/components/message_in_reply_to_view/message_in_reply_to_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/message_in_reply_to_view/message_in_reply_to_view',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const MessageInReplyToView=__exports.MessageInReplyToView=class MessageInReplyToView extends Component{get messageInReplyToView(){return this.messaging&&this.messaging.models['mail.message_in_reply_to_view'].get(this.props.messageInReplyToViewLocalId);}}
Object.assign(MessageInReplyToView,{props:{messageInReplyToViewLocalId:String},template:"mail.MessageInReplyToView",});registerMessagingComponent(MessageInReplyToView);return __exports;});;

/* /mail/static/src/components/message_list/message_list.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/message_list/message_list',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useRenderedValues}=require('@mail/component_hooks/use_rendered_values/use_rendered_values');const{useUpdate}=require('@mail/component_hooks/use_update/use_update');const{Component}=owl;const{useRef}=owl.hooks;const MessageList=__exports.MessageList=class MessageList extends Component{setup(){super.setup();this._isLastScrollProgrammatic=false;this._loadMoreRef=useRef('loadMore');this._willPatchSnapshot=undefined;this._onScrollThrottled=_.throttle(this._onScrollThrottled.bind(this),100);this._lastRenderedValues=useRenderedValues(()=>{const threadView=this.threadView;const thread=threadView&&threadView.thread;const threadCache=threadView&&threadView.threadCache;return{componentHintList:threadView?[...threadView.componentHintList]:[],hasAutoScrollOnMessageReceived:threadView&&threadView.hasAutoScrollOnMessageReceived,hasScrollAdjust:this.props.hasScrollAdjust,order:threadView&&threadView.order,orderedMessages:threadCache?[...threadCache.orderedMessages]:[],thread,threadCache,threadCacheInitialScrollHeight:threadView&&threadView.threadCacheInitialScrollHeight,threadCacheInitialScrollPosition:threadView&&threadView.threadCacheInitialScrollPosition,threadView,threadViewer:threadView&&threadView.threadViewer,};});useUpdate({func:()=>this._update()});}
willPatch(){this._willPatchSnapshot={scrollHeight:this._getScrollableElement().scrollHeight,scrollTop:this._getScrollableElement().scrollTop,};}
adjustFromComponentHints(){const{componentHintList,threadView}=this._lastRenderedValues();for(const hint of componentHintList){switch(hint.type){case'change-of-thread-cache':case'member-list-hidden':this._adjustScrollFromModel();break;case'message-received':case'messages-loaded':case'new-messages-loaded':this._adjustScrollForExtraMessagesAtTheEnd();break;case'more-messages-loaded':this._adjustScrollForExtraMessagesAtTheStart();break;case'highlight-reply':this._highlightMessageView(hint.data);break;}
if(threadView&&threadView.exists()){threadView.markComponentHintProcessed(hint);}}
this._willPatchSnapshot=undefined;}
getScrollHeight(){return this._getScrollableElement().scrollHeight;}
getScrollTop(){return this._getScrollableElement().scrollTop;}
setScrollTop(value){if(this._getScrollableElement().scrollTop===value){return;}
this._isLastScrollProgrammatic=true;this._getScrollableElement().scrollTop=value;}
get threadView(){return this.messaging&&this.messaging.models['mail.thread_view'].get(this.props.threadViewLocalId);}
_adjustScrollForExtraMessagesAtTheEnd(){const{hasAutoScrollOnMessageReceived,hasScrollAdjust,order,}=this._lastRenderedValues();if(!this._getScrollableElement()||!hasScrollAdjust){return;}
if(!hasAutoScrollOnMessageReceived){if(order==='desc'&&this._willPatchSnapshot){const{scrollHeight,scrollTop}=this._willPatchSnapshot;this.setScrollTop(this._getScrollableElement().scrollHeight-scrollHeight+scrollTop);}
return;}
this._scrollToEnd();}
_adjustScrollForExtraMessagesAtTheStart(){const{hasScrollAdjust,order,}=this._lastRenderedValues();if(!this._getScrollableElement()||!hasScrollAdjust||!this._willPatchSnapshot||order==='desc'){return;}
const{scrollHeight,scrollTop}=this._willPatchSnapshot;this.setScrollTop(this._getScrollableElement().scrollHeight-scrollHeight+scrollTop);}
_adjustScrollFromModel(){const{hasScrollAdjust,threadCacheInitialScrollHeight,threadCacheInitialScrollPosition,}=this._lastRenderedValues();if(!this._getScrollableElement()||!hasScrollAdjust){return;}
if(threadCacheInitialScrollPosition!==undefined&&this._getScrollableElement().scrollHeight===threadCacheInitialScrollHeight){this.setScrollTop(threadCacheInitialScrollPosition);return;}
this._scrollToEnd();return;}
_checkMostRecentMessageIsVisible(){const{threadView}=this._lastRenderedValues();if(!threadView||!threadView.exists()){return;}
const{length,[length-1]:lastMessageView}=this.threadView.messageViews;if(lastMessageView&&lastMessageView.component&&lastMessageView.component.isPartiallyVisible()){threadView.handleVisibleMessage(lastMessageView.message);}}
_getScrollableElement(){if(this.props.getScrollableElement){return this.props.getScrollableElement();}else{return this.el;}}
_highlightMessageView(messageView){if(messageView.exists()&&messageView.component&&messageView.component.el){messageView.component.el.scrollIntoView({behavior:'smooth',block:'center'});messageView.highlight();}}
_isLoadMoreVisible(){const loadMore=this._loadMoreRef.el;if(!loadMore){return false;}
const loadMoreRect=loadMore.getBoundingClientRect();const elRect=this._getScrollableElement().getBoundingClientRect();const isInvisible=loadMoreRect.top>elRect.bottom||loadMoreRect.bottom<elRect.top;return!isInvisible;}
_loadMore(){const{threadCache}=this._lastRenderedValues();if(!threadCache||!threadCache.exists()){return;}
threadCache.loadMoreMessages();}
_scrollToEnd(){const{order}=this._lastRenderedValues();this.setScrollTop(order==='asc'?this._getScrollableElement().scrollHeight-this._getScrollableElement().clientHeight:0);}
_update(){this._checkMostRecentMessageIsVisible();this.adjustFromComponentHints();}
_onClickLoadMore(ev){ev.preventDefault();this._loadMore();}
_onClickRetryLoadMoreMessages(){if(!this.threadView){return;}
if(!this.threadView.threadCache){return;}
this.threadView.threadCache.update({hasLoadingFailed:false});this._loadMore();}
onScroll(ev){this._onScrollThrottled(ev);}
_onScrollThrottled(ev){const{order,orderedMessages,thread,threadCache,threadView,threadViewer,}=this._lastRenderedValues();if(!this._getScrollableElement()){return;}
const scrollTop=this._getScrollableElement().scrollTop;this.messaging.messagingBus.trigger('o-component-message-list-scrolled',{orderedMessages,scrollTop,thread,threadViewer,});if(!this._isLastScrollProgrammatic&&threadView&&threadView.exists()){const margin=30;const hasAutoScrollOnMessageReceived=(order==='asc')?scrollTop>=this._getScrollableElement().scrollHeight-this._getScrollableElement().clientHeight-margin:scrollTop<=margin;threadView.update({hasAutoScrollOnMessageReceived});}
if(threadViewer&&threadViewer.exists()){threadViewer.saveThreadCacheScrollHeightAsInitial(this._getScrollableElement().scrollHeight,threadCache);threadViewer.saveThreadCacheScrollPositionsAsInitial(scrollTop,threadCache);}
if(!this._isLastScrollProgrammatic&&this._isLoadMoreVisible()){this._loadMore();}
this._checkMostRecentMessageIsVisible();this._isLastScrollProgrammatic=false;}}
Object.assign(MessageList,{defaultProps:{hasScrollAdjust:true,},props:{getScrollableElement:{type:Function,optional:true,},hasScrollAdjust:Boolean,threadViewLocalId:String,},template:'mail.MessageList',});registerMessagingComponent(MessageList);return __exports;});;

/* /mail/static/src/components/message_reaction_group/message_reaction_group.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/message_reaction_group/message_reaction_group',async function(require){'use strict';let __exports={};const{Component}=owl;const{registerMessagingComponent}=require('@mail/utils/messaging_component');const MessageReactionGroup=__exports.MessageReactionGroup=class MessageReactionGroup extends Component{get messageReactionGroup(){return this.messaging.models['mail.message_reaction_group'].get(this.props.messageReactionGroupLocalId);}}
Object.assign(MessageReactionGroup,{props:{messageReactionGroupLocalId:String,},template:'mail.MessageReactionGroup',});registerMessagingComponent(MessageReactionGroup);return __exports;});;

/* /mail/static/src/components/message_seen_indicator/message_seen_indicator.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/message_seen_indicator/message_seen_indicator',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const MessageSeenIndicator=__exports.MessageSeenIndicator=class MessageSeenIndicator extends Component{get indicatorTitle(){if(!this.messageSeenIndicator){return'';}
if(this.messageSeenIndicator.hasEveryoneSeen){return this.env._t("Seen by Everyone");}
if(this.messageSeenIndicator.hasSomeoneSeen){const partnersThatHaveSeen=this.messageSeenIndicator.partnersThatHaveSeen.map(partner=>{if(this.message.originThread){return this.message.originThread.getMemberName(partner);}
return partner.nameOrDisplayName;});if(partnersThatHaveSeen.length===1){return _.str.sprintf(this.env._t("Seen by %s"),partnersThatHaveSeen[0]);}
if(partnersThatHaveSeen.length===2){return _.str.sprintf(this.env._t("Seen by %s and %s"),partnersThatHaveSeen[0],partnersThatHaveSeen[1]);}
return _.str.sprintf(this.env._t("Seen by %s, %s and more"),partnersThatHaveSeen[0],partnersThatHaveSeen[1]);}
if(this.messageSeenIndicator.hasEveryoneFetched){return this.env._t("Received by Everyone");}
if(this.messageSeenIndicator.hasSomeoneFetched){const partnersThatHaveFetched=this.messageSeenIndicator.partnersThatHaveFetched.map(partner=>{if(this.message.originThread){return this.message.originThread.getMemberName(partner);}
return partner.nameOrDisplayName;});if(partnersThatHaveFetched.length===1){return _.str.sprintf(this.env._t("Received by %s"),partnersThatHaveFetched[0]);}
if(partnersThatHaveFetched.length===2){return _.str.sprintf(this.env._t("Received by %s and %s"),partnersThatHaveFetched[0],partnersThatHaveFetched[1]);}
return _.str.sprintf(this.env._t("Received by %s, %s and more"),partnersThatHaveFetched[0],partnersThatHaveFetched[1]);}
return'';}
get message(){return this.messaging&&this.messaging.models['mail.message'].get(this.props.messageLocalId);}
get messageSeenIndicator(){if(!this.thread||this.thread.model!=='mail.channel'){return undefined;}
return this.messaging.models['mail.message_seen_indicator'].findFromIdentifyingData({message:this.message,thread:this.thread,});}
get thread(){return this.messaging&&this.messaging.models['mail.thread'].get(this.props.threadLocalId);}}
Object.assign(MessageSeenIndicator,{props:{messageLocalId:String,threadLocalId:String,},template:'mail.MessageSeenIndicator',});registerMessagingComponent(MessageSeenIndicator);return __exports;});;

/* /mail/static/src/components/messaging_menu/messaging_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/messaging_menu/messaging_menu',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const MessagingMenu=__exports.MessagingMenu=class MessagingMenu extends Component{constructor(...args){super(...args);this.id=_.uniqueId('o_messagingMenu_');this._onMobileNewMessageInputSelect=this._onMobileNewMessageInputSelect.bind(this);this._onMobileNewMessageInputSource=this._onMobileNewMessageInputSource.bind(this);this._onClickCaptureGlobal=this._onClickCaptureGlobal.bind(this);this._constructor(...args);}
_constructor(){}
setup(){this.env=owl.Component.env;super.setup();}
mounted(){document.addEventListener('click',this._onClickCaptureGlobal,true);}
willUnmount(){document.removeEventListener('click',this._onClickCaptureGlobal,true);}
get messagingMenu(){return this.messaging&&this.messaging.messagingMenu;}
get mobileNewMessageInputPlaceholder(){return this.env._t("Search user...");}
get tabs(){return[{icon:'fa fa-envelope',id:'all',label:this.env._t("All"),},{icon:'fa fa-user',id:'chat',label:this.env._t("Chat"),},{icon:'fa fa-users',id:'channel',label:this.env._t("Channel"),}];}
_onClickCaptureGlobal(ev){if(!this.messagingMenu){return;}
if(!this.el||this.el.contains(ev.target)){return;}
this.messagingMenu.close();}
_onClickDesktopTabButton(ev){this.messagingMenu.update({activeTabId:ev.currentTarget.dataset.tabId});}
_onClickNewMessage(ev){if(!this.messaging.device.isMobile){this.messaging.chatWindowManager.openNewMessage();this.messagingMenu.close();}else{this.messagingMenu.toggleMobileNewMessage();}}
_onClickToggler(ev){ev.preventDefault();if(!this.messagingMenu){return;}
this.messagingMenu.toggleOpen();}
_onHideMobileNewMessage(ev){ev.stopPropagation();this.messagingMenu.toggleMobileNewMessage();}
_onMobileNewMessageInputSelect(ev,ui){this.messaging.openChat({partnerId:ui.item.id});}
_onMobileNewMessageInputSource(req,res){const value=_.escape(req.term);this.messaging.models['mail.partner'].imSearch({callback:partners=>{const suggestions=partners.map(partner=>{return{id:partner.id,value:partner.nameOrDisplayName,label:partner.nameOrDisplayName,};});res(_.sortBy(suggestions,'label'));},keyword:value,limit:10,});}
_onSelectMobileNavbarTab(ev){ev.stopPropagation();this.messagingMenu.update({activeTabId:ev.detail.tabId});}}
Object.assign(MessagingMenu,{props:{},template:'mail.MessagingMenu',});registerMessagingComponent(MessagingMenu);return __exports;});;

/* /mail/static/src/components/mobile_messaging_navbar/mobile_messaging_navbar.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/mobile_messaging_navbar/mobile_messaging_navbar',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const MobileMessagingNavbar=__exports.MobileMessagingNavbar=class MobileMessagingNavbar extends Component{_onClick(ev){this.trigger('o-select-mobile-messaging-navbar-tab',{tabId:ev.currentTarget.dataset.tabId,});}}
Object.assign(MobileMessagingNavbar,{defaultProps:{tabs:[],},props:{activeTabId:String,tabs:{type:Array,element:{type:Object,shape:{icon:{type:String,optional:true,},id:String,label:String,},},},},template:'mail.MobileMessagingNavbar',});registerMessagingComponent(MobileMessagingNavbar,{propsCompareDepth:{tabs:2}});return __exports;});;

/* /mail/static/src/components/notification_alert/notification_alert.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/notification_alert/notification_alert',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const NotificationAlert=__exports.NotificationAlert=class NotificationAlert extends Component{get isNotificationBlocked(){if(!this.messaging){return false;}
const windowNotification=this.env.browser.Notification;return(windowNotification&&windowNotification.permission!=="granted"&&!this.messaging.isNotificationPermissionDefault);}}
Object.assign(NotificationAlert,{props:{},template:'mail.NotificationAlert',});registerMessagingComponent(NotificationAlert);return __exports;});;

/* /mail/static/src/components/notification_group/notification_group.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/notification_group/notification_group',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const{useRef}=owl.hooks;const NotificationGroup=__exports.NotificationGroup=class NotificationGroup extends Component{constructor(...args){super(...args);this._markAsReadRef=useRef('markAsRead');}
get group(){return this.messaging&&this.messaging.models['mail.notification_group'].get(this.props.notificationGroupLocalId);}
image(){if(this.group.notification_type==='email'){return'/mail/static/src/img/smiley/mailfailure.jpg';}}
_onClick(ev){const markAsRead=this._markAsReadRef.el;if(markAsRead&&markAsRead.contains(ev.target)){return;}
this.group.openDocuments();if(!this.messaging.device.isMobile){this.messaging.messagingMenu.close();}}
_onClickMarkAsRead(ev){this.group.openCancelAction();if(!this.messaging.device.isMobile){this.messaging.messagingMenu.close();}}}
Object.assign(NotificationGroup,{props:{notificationGroupLocalId:String,},template:'mail.NotificationGroup',});registerMessagingComponent(NotificationGroup);return __exports;});;

/* /mail/static/src/components/notification_list/notification_list.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/notification_list/notification_list',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const NotificationList=__exports.NotificationList=class NotificationList extends Component{mounted(){this._loadPreviews();}
get notifications(){if(!this.messaging){return[];}
const threads=this._getThreads(this.props);let threadNeedactionNotifications=[];if(this.props.filter==='all'){threadNeedactionNotifications=this.messaging.models['mail.thread'].all(t=>t.model!=='mail.box'&&t.needactionMessagesAsOriginThread.length>0).sort((t1,t2)=>{if(t1.needactionMessagesAsOriginThread.length>0&&t2.needactionMessagesAsOriginThread.length===0){return-1;}
if(t1.needactionMessagesAsOriginThread.length===0&&t2.needactionMessagesAsOriginThread.length>0){return 1;}
if(t1.lastNeedactionMessageAsOriginThread&&t2.lastNeedactionMessageAsOriginThread){return t1.lastNeedactionMessageAsOriginThread.id<t2.lastNeedactionMessageAsOriginThread.id?1:-1;}
if(t1.lastNeedactionMessageAsOriginThread){return-1;}
if(t2.lastNeedactionMessageAsOriginThread){return 1;}
return t1.id<t2.id?-1:1;}).map(thread=>{return{thread,type:'thread_needaction',uniqueId:thread.localId+'_needaction',};});}
const threadNotifications=threads.sort((t1,t2)=>{if(t1.localMessageUnreadCounter>0&&t2.localMessageUnreadCounter===0){return-1;}
if(t1.localMessageUnreadCounter===0&&t2.localMessageUnreadCounter>0){return 1;}
if(t1.lastMessage&&t2.lastMessage){return t1.lastMessage.id<t2.lastMessage.id?1:-1;}
if(t1.lastMessage){return-1;}
if(t2.lastMessage){return 1;}
return t1.id<t2.id?-1:1;}).map(thread=>{return{thread,type:'thread',uniqueId:thread.localId,};});let notifications=threadNeedactionNotifications.concat(threadNotifications);if(this.props.filter==='all'){const notificationGroups=this.messaging.notificationGroupManager.groups;notifications=Object.values(notificationGroups).sort((group1,group2)=>group1.sequence-group2.sequence).map(notificationGroup=>{return{notificationGroup,uniqueId:notificationGroup.localId,};}).concat(notifications);}
if(this.props.filter==='all'&&this.messaging.isNotificationPermissionDefault){notifications.unshift({type:'odoobotRequest',uniqueId:'odoobotRequest',});}
return notifications;}
async _loadPreviews(){const threads=this.notifications.filter(notification=>notification.thread&&notification.thread.exists()).map(notification=>notification.thread);this.messaging.models['mail.thread'].loadPreviews(threads);}
_getThreads(props){if(props.filter==='mailbox'){return this.messaging.models['mail.thread'].all(thread=>thread.isPinned&&thread.model==='mail.box').sort((mailbox1,mailbox2)=>{if(mailbox1===this.messaging.inbox){return-1;}
if(mailbox2===this.messaging.inbox){return 1;}
if(mailbox1===this.messaging.starred){return-1;}
if(mailbox2===this.messaging.starred){return 1;}
const mailbox1Name=mailbox1.displayName;const mailbox2Name=mailbox2.displayName;mailbox1Name<mailbox2Name?-1:1;});}else if(props.filter==='channel'){return this.messaging.models['mail.thread'].all(thread=>thread.channel_type==='channel'&&thread.isPinned&&thread.model==='mail.channel').sort((c1,c2)=>c1.displayName<c2.displayName?-1:1);}else if(props.filter==='chat'){return this.messaging.models['mail.thread'].all(thread=>thread.isChatChannel&&thread.isPinned&&thread.model==='mail.channel').sort((c1,c2)=>c1.displayName<c2.displayName?-1:1);}else if(props.filter==='all'){return this.messaging.models['mail.thread'].all(thread=>thread.isPinned&&thread.model==='mail.channel').sort((c1,c2)=>c1.displayName<c2.displayName?-1:1);}else{throw new Error(`Unsupported filter ${props.filter}`);}}}
Object.assign(NotificationList,{_allowedFilters:['all','mailbox','channel','chat'],defaultProps:{filter:'all',},props:{filter:{type:String,validate:prop=>NotificationList._allowedFilters.includes(prop),},},template:'mail.NotificationList',});registerMessagingComponent(NotificationList);return __exports;});;

/* /mail/static/src/components/notification_popover/notification_popover.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/notification_popover/notification_popover',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const NotificationPopover=__exports.NotificationPopover=class NotificationPopover extends Component{get iconClass(){switch(this.notification.notification_status){case'sent':return'fa fa-check';case'bounce':return'fa fa-exclamation';case'exception':return'fa fa-exclamation';case'ready':return'fa fa-send-o';case'canceled':return'fa fa-trash-o';}
return'';}
get iconTitle(){switch(this.notification.notification_status){case'sent':return this.env._t("Sent");case'bounce':return this.env._t("Bounced");case'exception':return this.env._t("Error");case'ready':return this.env._t("Ready");case'canceled':return this.env._t("Canceled");}
return'';}
get notifications(){if(!this.messaging){return[];}
return this.props.notificationLocalIds.map(notificationLocalId=>this.messaging.models['mail.notification'].get(notificationLocalId));}}
Object.assign(NotificationPopover,{props:{notificationLocalIds:{type:Array,element:String,},},template:'mail.NotificationPopover',});registerMessagingComponent(NotificationPopover,{propsCompareDepth:{notificationLocalIds:1}});return __exports;});;

/* /mail/static/src/components/notification_request/notification_request.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/notification_request/notification_request',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const NotificationRequest=__exports.NotificationRequest=class NotificationRequest extends Component{getHeaderText(){return _.str.sprintf(this.env._t("%s has a request"),this.messaging.partnerRoot.nameOrDisplayName);}
_handleResponseNotificationPermission(value){this.messaging.refreshIsNotificationPermissionDefault();if(value!=='granted'){this.env.services['bus_service'].sendNotification({message:this.env._t("Odoo will not have the permission to send native notifications on this device."),title:this.env._t("Permission denied"),});}}
_onClick(){const windowNotification=this.env.browser.Notification;const def=windowNotification&&windowNotification.requestPermission();if(def){def.then(this._handleResponseNotificationPermission.bind(this));}
if(!this.messaging.device.isMobile){this.messaging.messagingMenu.close();}}}
Object.assign(NotificationRequest,{props:{},template:'mail.NotificationRequest',});registerMessagingComponent(NotificationRequest);return __exports;});;

/* /mail/static/src/components/partner_im_status_icon/partner_im_status_icon.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/partner_im_status_icon/partner_im_status_icon',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const PartnerImStatusIcon=__exports.PartnerImStatusIcon=class PartnerImStatusIcon extends Component{get partner(){return this.messaging&&this.messaging.models['mail.partner'].get(this.props.partnerLocalId);}
_onClick(ev){if(!this.props.hasOpenChat){return;}
this.partner.openChat();}}
Object.assign(PartnerImStatusIcon,{defaultProps:{hasBackground:true,hasOpenChat:false,},props:{partnerLocalId:String,hasBackground:Boolean,hasOpenChat:Boolean,},template:'mail.PartnerImStatusIcon',});registerMessagingComponent(PartnerImStatusIcon);return __exports;});;

/* /mail/static/src/components/popover_view/popover_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/popover_view/popover_view',async function(require){'use strict';let __exports={};const{useComponentToModel}=require('@mail/component_hooks/use_component_to_model/use_component_to_model');const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{usePosition}=require('@web/core/position/position_hook');const{Component}=owl;const PopoverView=__exports.PopoverView=class PopoverView extends Component{setup(){super.setup();useComponentToModel({fieldName:'component',modelName:'mail.popover_view',propNameAsRecordLocalId:'popoverViewLocalId'});usePosition(()=>this.popoverView&&this.popoverView.anchorRef&&this.popoverView.anchorRef.el,{margin:16,position:this.popoverView.position,});}
get popoverView(){return this.messaging&&this.messaging.models['mail.popover_view'].get(this.props.popoverViewLocalId);}}
Object.assign(PopoverView,{props:{popoverViewLocalId:String,},template:'mail.PopoverView',});registerMessagingComponent(PopoverView);return __exports;});;

/* /mail/static/src/components/rtc_activity_notice/rtc_activity_notice.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/rtc_activity_notice/rtc_activity_notice',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const RtcActivityNotice=__exports.RtcActivityNotice=class RtcActivityNotice extends Component{setup(){this.env=owl.Component.env;super.setup();}
_onClick(ev){this.messaging.rtc.channel.open();}}
Object.assign(RtcActivityNotice,{props:{},template:'mail.RtcActivityNotice',});registerMessagingComponent(RtcActivityNotice);return __exports;});;

/* /mail/static/src/components/rtc_call_participant_card/rtc_call_participant_card.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/rtc_call_participant_card/rtc_call_participant_card',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const{useRef}=owl.hooks;const RtcCallParticipantCard=__exports.RtcCallParticipantCard=class RtcCallParticipantCard extends Component{setup(){super.setup();this._volumeMenuAnchorRef=useRef('volumeMenuAnchor');}
get callParticipantCard(){return this.messaging.models['mail.rtc_call_participant_card'].get(this.props.callParticipantCardLocalId);}
async _onContextMenu(ev){if(!this._volumeMenuAnchorRef||!this._volumeMenuAnchorRef.el){return;}
ev.preventDefault();this._volumeMenuAnchorRef.el.click();}}
Object.assign(RtcCallParticipantCard,{props:{callParticipantCardLocalId:{type:String,},},template:'mail.RtcCallParticipantCard',});registerMessagingComponent(RtcCallParticipantCard);return __exports;});;

/* /mail/static/src/components/rtc_call_viewer/rtc_call_viewer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/rtc_call_viewer/rtc_call_viewer',async function(require){'use strict';let __exports={};const{useUpdate}=require('@mail/component_hooks/use_update/use_update');const{registerMessagingComponent}=require('@mail/utils/messaging_component');const Dialog=require('web.OwlDialog');const{Component,useState}=owl;const{useRef}=owl.hooks;const components={Dialog,};const RtcCallViewer=__exports.RtcCallViewer=class RtcCallViewer extends Component{setup(){super.setup();this.state=useState({tileWidth:0,tileHeight:0,columnCount:0,});this.tileContainerRef=useRef('tileContainer');useUpdate({func:()=>this._update()});}
get rtcCallViewer(){return this.messaging.models['mail.rtc_call_viewer'].get(this.props.localId);}
_computeTessellation({aspectRatio=1,containerHeight,containerWidth,tileCount}){let optimalLayout={area:0,cols:0,tileHeight:0,tileWidth:0,};for(let columnCount=1;columnCount<=tileCount;columnCount++){const rowCount=Math.ceil(tileCount/columnCount);const potentialHeight=containerWidth/(columnCount*aspectRatio);const potentialWidth=containerHeight/rowCount;let tileHeight;let tileWidth;if(potentialHeight>potentialWidth){tileHeight=Math.floor(potentialWidth);tileWidth=Math.floor(tileHeight*aspectRatio);}else{tileWidth=Math.floor(containerWidth/columnCount);tileHeight=Math.floor(tileWidth/aspectRatio);}
const area=tileHeight*tileWidth;if(area<=optimalLayout.area){continue;}
optimalLayout={area,columnCount,tileHeight,tileWidth,};}
return optimalLayout;}
_setTileLayout(){if(!this.rtcCallViewer){return;}
if(!this.el){return;}
if(!this.tileContainerRef.el){return;}
const{width,height}=this.tileContainerRef.el.getBoundingClientRect();const{tileWidth,tileHeight,columnCount}=this._computeTessellation({aspectRatio:this.rtcCallViewer.aspectRatio,containerHeight:height,containerWidth:width,tileCount:this.tileContainerRef.el.children.length,});this.state.tileWidth=tileWidth;this.state.tileHeight=tileHeight;this.state.columnCount=columnCount;}
_update(){this._setTileLayout();}}
Object.assign(RtcCallViewer,{components,props:{localId:String,},template:'mail.RtcCallViewer',});registerMessagingComponent(RtcCallViewer);return __exports;});;

/* /mail/static/src/components/rtc_configuration_menu/rtc_configuration_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/rtc_configuration_menu/rtc_configuration_menu',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{browser}=require("@web/core/browser/browser");const{Component}=owl;const{useState}=owl.hooks;const RtcConfigurationMenu=__exports.RtcConfigurationMenu=class RtcConfigurationMenu extends Component{setup(){super.setup();this.state=useState({userDevices:undefined,});}
async willStart(){this.state.userDevices=await browser.navigator.mediaDevices.enumerateDevices();}
_onChangeDelay(ev){this.messaging.userSetting.rtcConfigurationMenu.onChangeDelay(ev.target.value);}
_onChangePushToTalk(ev){this.messaging.userSetting.rtcConfigurationMenu.onChangePushToTalk();}
_onChangeSelectAudioInput(ev){this.messaging.userSetting.rtcConfigurationMenu.onChangeSelectAudioInput(ev.target.value);}
_onChangeThreshold(ev){this.messaging.userSetting.rtcConfigurationMenu.onChangeThreshold(ev.target.value);}
_onClickRegisterKeyButton(){this.messaging.userSetting.rtcConfigurationMenu.onClickRegisterKeyButton();}}
Object.assign(RtcConfigurationMenu,{template:'mail.RtcConfigurationMenu',});registerMessagingComponent(RtcConfigurationMenu);return __exports;});;

/* /mail/static/src/components/rtc_controller/rtc_controller.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/rtc_controller/rtc_controller',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const RtcController=__exports.RtcController=class RtcController extends Component{get rtcController(){return this.messaging&&this.messaging.models['mail.rtc_controller'].get(this.props.localId);}}
Object.assign(RtcController,{props:{localId:{type:String,},},template:'mail.RtcController',});registerMessagingComponent(RtcController);return __exports;});;

/* /mail/static/src/components/rtc_invitation_card/rtc_invitation_card.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/rtc_invitation_card/rtc_invitation_card',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const RtcInvitationCard=__exports.RtcInvitationCard=class RtcInvitationCard extends Component{get thread(){return this.messaging.models['mail.thread'].get(this.props.threadLocalId);}
async _onClickAccept(ev){this.thread.open();if(this.thread.hasPendingRtcRequest){return;}
await this.thread.toggleCall();}
_onClickAvatar(ev){this.thread.open();}
_onClickRefuse(ev){if(this.thread.hasPendingRtcRequest){return;}
this.thread.leaveCall();}}
Object.assign(RtcInvitationCard,{props:{threadLocalId:String,},template:'mail.RtcInvitationCard',});registerMessagingComponent(RtcInvitationCard);return __exports;});;

/* /mail/static/src/components/rtc_invitations/rtc_invitations.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/rtc_invitations/rtc_invitations',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const RtcInvitations=__exports.RtcInvitations=class RtcInvitations extends Component{}
Object.assign(RtcInvitations,{props:{},template:'mail.RtcInvitations',});registerMessagingComponent(RtcInvitations);return __exports;});;

/* /mail/static/src/components/rtc_layout_menu/rtc_layout_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/rtc_layout_menu/rtc_layout_menu',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useComponentToModel}=require('@mail/component_hooks/use_component_to_model/use_component_to_model');const{Component}=owl;const RtcLayoutMenu=__exports.RtcLayoutMenu=class RtcLayoutMenu extends Component{setup(){super.setup();useComponentToModel({fieldName:'component',modelName:'mail.rtc_layout_menu',propNameAsRecordLocalId:'localId'});}
get layoutMenu(){return this.messaging&&this.messaging.models['mail.rtc_layout_menu'].get(this.props.localId);}}
Object.assign(RtcLayoutMenu,{props:{localId:String,},template:'mail.RtcLayoutMenu',});registerMessagingComponent(RtcLayoutMenu);return __exports;});;

/* /mail/static/src/components/rtc_option_list/rtc_option_list.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/rtc_option_list/rtc_option_list',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useComponentToModel}=require('@mail/component_hooks/use_component_to_model/use_component_to_model');const{Component}=owl;const RtcOptionList=__exports.RtcOptionList=class RtcOptionList extends Component{setup(){super.setup();useComponentToModel({fieldName:'component',modelName:'mail.rtc_option_list',propNameAsRecordLocalId:'localId'});}
get rtcOptionList(){return this.messaging&&this.messaging.models['mail.rtc_option_list'].get(this.props.localId);}}
Object.assign(RtcOptionList,{props:{localId:String,},template:'mail.RtcOptionList',});registerMessagingComponent(RtcOptionList);return __exports;});;

/* /mail/static/src/components/rtc_video/rtc_video.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/rtc_video/rtc_video',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useUpdate}=require('@mail/component_hooks/use_update/use_update');const{Component}=owl;const{useRef}=owl.hooks;const RtcVideo=__exports.RtcVideo=class RtcVideo extends Component{setup(){super.setup();useUpdate({func:()=>this._update()});this._videoRef=useRef("video");}
get rtcSession(){return this.messaging.models["mail.rtc_session"].get(this.props.rtcSessionLocalId);}
_update(){this._loadVideo();}
_loadVideo(){if(!this._videoRef){return;}
if(!this.rtcSession||!this.rtcSession.videoStream){this._videoRef.el.srcObject=undefined;}else{this._videoRef.el.srcObject=this.rtcSession.videoStream;}
this._videoRef.el.load();}
async _onVideoLoadedMetaData(ev){try{await ev.target.play();}catch(error){if(typeof error==='object'&&error.name==='NotAllowedError'){return;}
throw error;}}}
Object.assign(RtcVideo,{props:{rtcSessionLocalId:{type:String,},},template:'mail.RtcVideo',});registerMessagingComponent(RtcVideo);return __exports;});;

/* /mail/static/src/components/thread_icon/thread_icon.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/thread_icon/thread_icon',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const ThreadIcon=__exports.ThreadIcon=class ThreadIcon extends Component{get thread(){return this.messaging&&this.messaging.models['mail.thread'].get(this.props.threadLocalId);}}
Object.assign(ThreadIcon,{props:{threadLocalId:String,},template:'mail.ThreadIcon',});registerMessagingComponent(ThreadIcon);return __exports;});;

/* /mail/static/src/components/thread_needaction_preview/thread_needaction_preview.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/thread_needaction_preview/thread_needaction_preview',async function(require){'use strict';let __exports={};const mailUtils=require('@mail/js/utils');const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const{useRef}=owl.hooks;const ThreadNeedactionPreview=__exports.ThreadNeedactionPreview=class ThreadNeedactionPreview extends Component{constructor(...args){super(...args);this._markAsReadRef=useRef('markAsRead');}
image(){if(this.thread.moduleIcon){return this.thread.moduleIcon;}
if(this.thread.correspondent){return this.thread.correspondent.avatarUrl;}
if(this.thread.model==='mail.channel'){return`/web/image/mail.channel/${this.thread.id}/avatar_128?unique=${this.thread.avatarCacheKey}`;}
return'/mail/static/src/img/smiley/avatar.jpg';}
get inlineLastNeedactionMessageAsOriginThreadBody(){if(!this.thread.lastNeedactionMessageAsOriginThread){return'';}
return mailUtils.htmlToTextContentInline(this.thread.lastNeedactionMessageAsOriginThread.prettyBody);}
get thread(){return this.messaging&&this.messaging.models['mail.thread'].get(this.props.threadLocalId);}
_onClick(ev){const markAsRead=this._markAsReadRef.el;if(markAsRead&&markAsRead.contains(ev.target)){return;}
this.thread.open();if(!this.messaging.device.isMobile){this.messaging.messagingMenu.close();}}
_onClickMarkAsRead(ev){this.messaging.models['mail.message'].markAllAsRead([['model','=',this.thread.model],['res_id','=',this.thread.id],]);}}
Object.assign(ThreadNeedactionPreview,{props:{threadLocalId:String,},template:'mail.ThreadNeedactionPreview',});registerMessagingComponent(ThreadNeedactionPreview);return __exports;});;

/* /mail/static/src/components/thread_preview/thread_preview.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/thread_preview/thread_preview',async function(require){'use strict';let __exports={};const mailUtils=require('@mail/js/utils');const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const{useRef}=owl.hooks;const ThreadPreview=__exports.ThreadPreview=class ThreadPreview extends Component{constructor(...args){super(...args);this._markAsReadRef=useRef('markAsRead');}
image(){if(this.thread.correspondent){return this.thread.correspondent.avatarUrl;}
return`/web/image/mail.channel/${this.thread.id}/avatar_128?unique=${this.thread.avatarCacheKey}`;}
get inlineLastMessageBody(){if(!this.thread.lastMessage){return'';}
return mailUtils.htmlToTextContentInline(this.thread.lastMessage.prettyBody);}
get thread(){return this.messaging&&this.messaging.models['mail.thread'].get(this.props.threadLocalId);}
_onClick(ev){const markAsRead=this._markAsReadRef.el;if(markAsRead&&markAsRead.contains(ev.target)){return;}
this.thread.open();if(!this.messaging.device.isMobile){this.messaging.messagingMenu.close();}}
_onClickMarkAsRead(ev){if(this.thread.lastNonTransientMessage){this.thread.markAsSeen(this.thread.lastNonTransientMessage);}}}
Object.assign(ThreadPreview,{props:{threadLocalId:String,},template:'mail.ThreadPreview',});registerMessagingComponent(ThreadPreview);return __exports;});;

/* /mail/static/src/components/thread_textual_typing_status/thread_textual_typing_status.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/thread_textual_typing_status/thread_textual_typing_status',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const ThreadTextualTypingStatus=__exports.ThreadTextualTypingStatus=class ThreadTextualTypingStatus extends Component{get thread(){return this.messaging&&this.messaging.models['mail.thread'].get(this.props.threadLocalId);}}
Object.assign(ThreadTextualTypingStatus,{props:{threadLocalId:String,},template:'mail.ThreadTextualTypingStatus',});registerMessagingComponent(ThreadTextualTypingStatus);return __exports;});;

/* /mail/static/src/components/thread_typing_icon/thread_typing_icon.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/thread_typing_icon/thread_typing_icon',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const ThreadTypingIcon=__exports.ThreadTypingIcon=class ThreadTypingIcon extends Component{}
Object.assign(ThreadTypingIcon,{defaultProps:{animation:'none',size:'small',},props:{animation:{type:String,validate:prop=>['bounce','none','pulse'].includes(prop),},size:{type:String,validate:prop=>['small','medium'].includes(prop),},title:{type:String,optional:true,}},template:'mail.ThreadTypingIcon',});registerMessagingComponent(ThreadTypingIcon);return __exports;});;

/* /mail/static/src/components/thread_view/thread_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/thread_view/thread_view',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;const{useRef}=owl.hooks;const ThreadView=__exports.ThreadView=class ThreadView extends Component{setup(){super.setup();this._messageListRef=useRef('messageList');}
getScrollHeight(){if(!this._messageListRef.comp){return undefined;}
return this._messageListRef.comp.getScrollHeight();}
getScrollTop(){if(!this._messageListRef.comp){return undefined;}
return this._messageListRef.comp.getScrollTop();}
onScroll(ev){if(!this._messageListRef.comp){return;}
this._messageListRef.comp.onScroll(ev);}
get threadView(){return this.messaging&&this.messaging.models['mail.thread_view'].get(this.props.threadViewLocalId);}
_onClickRetryLoadMessages(){if(!this.threadView){return;}
if(!this.threadView.threadCache){return;}
this.threadView.threadCache.update({hasLoadingFailed:false});}}
Object.assign(ThreadView,{defaultProps:{hasComposerDiscardButton:false,hasComposerThreadName:false,showComposerAttachmentsExtensions:true,showComposerAttachmentsFilenames:true,},props:{getScrollableElement:{type:Function,optional:true,},hasComposerCurrentPartnerAvatar:{type:Boolean,optional:true,},hasComposerDiscardButton:{type:Boolean,optional:true,},hasComposerSendButton:{type:Boolean,optional:true,},hasComposerThreadName:{type:Boolean,optional:true,},hasComposerThreadTyping:{type:Boolean,optional:true,},hasScrollAdjust:{type:Boolean,optional:true,},showComposerAttachmentsExtensions:Boolean,showComposerAttachmentsFilenames:Boolean,threadViewLocalId:String,},template:'mail.ThreadView',});registerMessagingComponent(ThreadView);return __exports;});;

/* /mail/static/src/components/thread_view_topbar/thread_view_topbar.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/thread_view_topbar/thread_view_topbar',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useRefToModel}=require('@mail/component_hooks/use_ref_to_model/use_ref_to_model');const{useUpdateToModel}=require('@mail/component_hooks/use_update_to_model/use_update_to_model');const{Component}=owl;const ThreadViewTopbar=__exports.ThreadViewTopbar=class ThreadViewTopbar extends Component{setup(){super.setup();useRefToModel({fieldName:'guestNameInputRef',modelName:'mail.thread_view_topbar',propNameAsRecordLocalId:'localId',refName:'guestNameInput'});useRefToModel({fieldName:'inviteButtonRef',modelName:'mail.thread_view_topbar',propNameAsRecordLocalId:'localId',refName:'inviteButton'});useRefToModel({fieldName:'threadNameInputRef',modelName:'mail.thread_view_topbar',propNameAsRecordLocalId:'localId',refName:'threadNameInput'});useRefToModel({fieldName:'threadDescriptionInputRef',modelName:'mail.thread_view_topbar',propNameAsRecordLocalId:'localId',refName:'threadDescriptionInput'});useUpdateToModel({methodName:'onComponentUpdate',modelName:'mail.thread_view_topbar',propNameAsRecordLocalId:'localId'});}
get threadViewTopbar(){return this.messaging&&this.messaging.models['mail.thread_view_topbar'].get(this.props.localId);}
async _onClickPhone(ev){if(this.threadViewTopbar.thread.hasPendingRtcRequest){return;}
await this.threadViewTopbar.thread.toggleCall();}
async _onClickCamera(ev){if(this.threadViewTopbar.thread.hasPendingRtcRequest){return;}
await this.threadViewTopbar.thread.toggleCall({startWithVideo:true,});}}
Object.assign(ThreadViewTopbar,{props:{localId:String,},template:'mail.ThreadViewTopbar',});registerMessagingComponent(ThreadViewTopbar);return __exports;});;

/* /mail/static/src/components/welcome_view/welcome_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/components/welcome_view/welcome_view',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{useRefToModel}=require('@mail/component_hooks/use_ref_to_model/use_ref_to_model');const{useUpdateToModel}=require('@mail/component_hooks/use_update_to_model/use_update_to_model');const WelcomeView=__exports.WelcomeView=class WelcomeView extends owl.Component{setup(){super.setup();useRefToModel({fieldName:'guestNameInputRef',modelName:'mail.welcome_view',propNameAsRecordLocalId:'localId',refName:'guestNameInput'});useUpdateToModel({methodName:'onComponentUpdate',modelName:'mail.welcome_view',propNameAsRecordLocalId:'localId'});}
get welcomeView(){return this.messaging&&this.messaging.models['mail.welcome_view'].get(this.props.localId);}}
Object.assign(WelcomeView,{props:{localId:String},template:'mail.WelcomeView',});registerMessagingComponent(WelcomeView);return __exports;});;

/* /mail/static/src/model/model_core.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/model/model_core',async function(require){'use strict';let __exports={};const registry={};function _getEntryFromModelName(modelName){if(!registry[modelName]){registry[modelName]={dependencies:[],factory:undefined,name:modelName,patches:[],};}
return registry[modelName];}
function _registerPatchModel(modelName,patchName,patch,{type='instance'}={}){const entry=_getEntryFromModelName(modelName);Object.assign(entry,{patches:(entry.patches||[]).concat([{name:patchName,patch,type,}]),});}
function registerClassPatchModel(modelName,patchName,patch){_registerPatchModel(modelName,patchName,patch,{type:'class'});}
function registerFieldPatchModel(modelName,patchName,patch){_registerPatchModel(modelName,patchName,patch,{type:'field'});}
function registerIdentifyingFieldsPatch(modelName,patchName,patch){_registerPatchModel(modelName,patchName,patch,{type:'identifyingFields'});}
function registerInstancePatchModel(modelName,patchName,patch){_registerPatchModel(modelName,patchName,patch,{type:'instance'});}
function registerNewModel(name,factory,dependencies=[]){const entry=_getEntryFromModelName(name);let entryDependencies=[...dependencies];if(name!=='mail.model'){entryDependencies=[...new Set(entryDependencies.concat(['mail.model']))];}
if(entry.factory){throw new Error(`Model "${name}" has already been registered!`);}
Object.assign(entry,{dependencies:entryDependencies,factory,name,});}
Object.assign(__exports,{registerClassPatchModel,registerFieldPatchModel,registerInstancePatchModel,registerIdentifyingFieldsPatch,registerNewModel,registry,});return __exports;});;

/* /mail/static/src/model/model_errors.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/model/model_errors',async function(require){'use strict';let __exports={};const RecordDeletedError=__exports.RecordDeletedError=class RecordDeletedError extends Error{constructor(recordLocalId,...args){super(...args);this.recordLocalId=recordLocalId;this.name='RecordDeletedError';}}
return __exports;});;

/* /mail/static/src/model/model_field.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/model/model_field',async function(require){'use strict';let __exports={};const{clear,FieldCommand,link,replace,unlink,unlinkAll}=require('@mail/model/model_field_command');const ModelField=__exports.ModelField=class ModelField{constructor({compute,default:def,fieldName,fieldType,inverse,isCausal=false,readonly=false,related,relationType,required=false,sort,to,}={}){this.compute=compute;this.default=def;this.fieldName=fieldName;this.fieldType=fieldType;this.inverse=inverse;this.isCausal=isCausal;this.readonly=readonly;this.related=related;this.relationType=relationType;this.required=required;this.sort=sort;this.sumContributions=[];this.to=to;}
static attr(options){return Object.assign({fieldType:'attribute'},options);}
static many2many(modelName,options){return ModelField._relation(modelName,Object.assign({},options,{relationType:'many2many'}));}
static many2one(modelName,options){return ModelField._relation(modelName,Object.assign({},options,{relationType:'many2one'}));}
static one2many(modelName,options){return ModelField._relation(modelName,Object.assign({},options,{relationType:'one2many'}));}
static one2one(modelName,options){return ModelField._relation(modelName,Object.assign({},options,{relationType:'one2one'}));}
clear(record,options){let hasChanged=false;if(this.fieldType==='relation'){if(this.parseAndExecuteCommands(record,unlinkAll(),options)){hasChanged=true;}
if(!this.default){return hasChanged;}}
if(this.parseAndExecuteCommands(record,this.default,options)){hasChanged=true;}
return hasChanged;}
computeRelated(record){const[relationName,relatedFieldName]=this.related.split('.');const Model=record.constructor;const relationField=Model.__fieldMap[relationName];if(['one2many','many2many'].includes(relationField.relationType)){const newVal=[];for(const otherRecord of record[relationName]){const otherValue=otherRecord[relatedFieldName];if(otherValue){if(otherValue instanceof Array){for(const v of otherValue){newVal.push(v);}}else{newVal.push(otherValue);}}}
if(this.fieldType==='relation'){return replace(newVal);}
return newVal;}
const otherRecord=record[relationName];if(otherRecord){const newVal=otherRecord[relatedFieldName];if(newVal===undefined){return clear();}
if(this.fieldType==='relation'){return replace(newVal);}
return newVal;}
return clear();}
convertToFieldCommandList(newVal){if(newVal instanceof FieldCommand){return[newVal];}else if(newVal instanceof Array&&newVal[0]instanceof FieldCommand){return newVal;}else if(this.fieldType==='relation'){return newVal.map(([name,value])=>new FieldCommand(name,value));}else{return[new FieldCommand('set',newVal)];}}
decrement(record,amount){const currentValue=this.read(record);return this._setAttribute(record,currentValue-amount);}
get(record){if(this.fieldType==='attribute'){return this.read(record);}
if(this.fieldType==='relation'){if(['one2one','many2one'].includes(this.relationType)){return this.read(record);}
return[...this.read(record)];}
throw new Error(`cannot get field with unsupported type ${this.fieldType}.`);}
increment(record,amount){const currentValue=this.read(record);return this._setAttribute(record,currentValue+amount);}
parseAndExecuteCommands(record,newVal,options){const commandList=this.convertToFieldCommandList(newVal);let hasChanged=false;for(const command of commandList){const commandName=command.name;const newVal=command.value;if(this.fieldType==='attribute'){switch(commandName){case'clear':if(this.clear(record,options)){hasChanged=true;}
break;case'decrement':if(this.decrement(record,newVal)){hasChanged=true;}
break;case'increment':if(this.increment(record,newVal)){hasChanged=true;}
break;case'set':if(this._setAttribute(record,newVal)){hasChanged=true;}
break;default:throw new Error(`Field "${record.constructor.modelName}/${this.fieldName}"(${this.fieldType} type) does not support command "${commandName}"`);}}else if(this.fieldType==='relation'){switch(commandName){case'clear':if(this.clear(record,options)){hasChanged=true;}
break;case'insert':if(this._setRelationInsert(record,newVal,options)){hasChanged=true;}
break;case'insert-and-replace':if(this._setRelationInsertAndReplace(record,newVal,options)){hasChanged=true;}
break;case'insert-and-unlink':if(this._setRelationInsertAndUnlink(record,newVal,options)){hasChanged=true;}
break;case'link':if(this._setRelationLink(record,newVal,options)){hasChanged=true;}
break;case'replace':if(this._setRelationReplace(record,newVal,options)){hasChanged=true;}
break;case'unlink':if(this._setRelationUnlink(record,newVal,options)){hasChanged=true;}
break;case'unlink-all':if(this._setRelationUnlink(record,this.get(record),options)){hasChanged=true;}
break;default:throw new Error(`Field "${record.constructor.modelName}/${this.fieldName}"(${this.fieldType} type) does not support command "${commandName}"`);}}}
return hasChanged;}
read(record){return record.__values[this.fieldName];}
toString(){return`field(${this.fieldName})`;}
static _relation(modelName,options){return Object.assign({fieldType:'relation',to:modelName,},options);}
_convertX2ManyValue(newValue,{hasToVerify=true}={}){if(typeof newValue[Symbol.iterator]==='function'){if(hasToVerify){for(const value of newValue){this._verifyRelationalValue(value);}}
return newValue;}
if(hasToVerify){this._verifyRelationalValue(newValue);}
return[newValue];}
_insertOtherRecord(record,data){const OtherModel=record.models[this.to];const isMulti=typeof data[Symbol.iterator]==='function';const dataList=[];for(const recordData of(isMulti?data:[data])){const recordData2={...recordData};if(['one2one','one2many'].includes(this.relationType)){recordData2[this.inverse]=replace(record);}else{recordData2[this.inverse]=link(record);}
dataList.push(recordData2);}
const records=record.modelManager._insert(OtherModel,dataList);return isMulti?records:records[0];}
_setAttribute(record,newVal){const currentValue=this.read(record);if(currentValue===newVal){return false;}
record.__values[this.fieldName]=newVal;return true;}
_setRelationInsert(record,data,options){const newValue=this._insertOtherRecord(record,data);return this._setRelationLink(record,newValue,options);}
_setRelationInsertAndReplace(record,data,options){const newValue=this._insertOtherRecord(record,data);return this._setRelationReplace(record,newValue,options);}
_setRelationInsertAndUnlink(record,data,options){const newValue=this._insertOtherRecord(record,data);return this._setRelationUnlink(record,newValue,options);}
_setRelationLink(record,newValue,options){switch(this.relationType){case'many2many':case'one2many':return this._setRelationLinkX2Many(record,newValue,options);case'many2one':case'one2one':return this._setRelationLinkX2One(record,newValue,options);}}
_setRelationLinkX2Many(record,newValue,{hasToUpdateInverse=true}={}){const hasToVerify=record.modelManager.isDebug;const recordsToLink=this._convertX2ManyValue(newValue,{hasToVerify});const otherRecords=this.read(record);let hasChanged=false;for(const recordToLink of recordsToLink){if(otherRecords.has(recordToLink)){continue;}
hasChanged=true;otherRecords.add(recordToLink);if(hasToUpdateInverse){record.modelManager._update(recordToLink,{[this.inverse]:link(record)},{allowWriteReadonly:true,hasToUpdateInverse:false});}}
return hasChanged;}
_setRelationLinkX2One(record,recordToLink,{hasToUpdateInverse=true}={}){if(record.modelManager.isDebug){this._verifyRelationalValue(recordToLink);}
const prevOtherRecord=this.read(record);if(prevOtherRecord===recordToLink){return false;}
this._setRelationUnlinkX2One(record,{hasToUpdateInverse:true});record.__values[this.fieldName]=recordToLink;if(hasToUpdateInverse){record.modelManager._update(recordToLink,{[this.inverse]:link(record)},{allowWriteReadonly:true,hasToUpdateInverse:false});}
return true;}
_setRelationReplace(record,newValue,options){if(['one2one','many2one'].includes(this.relationType)){return this._setRelationLinkX2One(record,newValue,options);}
let hasChanged=false;let hasToReorder=false;const otherRecordsSet=this.read(record);const otherRecordsList=[...otherRecordsSet];const hasToVerify=record.modelManager.isDebug;const recordsToReplaceList=[...this._convertX2ManyValue(newValue,{hasToVerify})];const recordsToReplaceSet=new Set(recordsToReplaceList);const recordsToLink=[];for(let i=0;i<recordsToReplaceList.length;i++){const recordToReplace=recordsToReplaceList[i];if(!otherRecordsSet.has(recordToReplace)){recordsToLink.push(recordToReplace);}
if(otherRecordsList[i]!==recordToReplace){hasToReorder=true;}}
if(this._setRelationLinkX2Many(record,recordsToLink,options)){hasChanged=true;}
const recordsToUnlink=[];for(let i=0;i<otherRecordsList.length;i++){const otherRecord=otherRecordsList[i];if(!recordsToReplaceSet.has(otherRecord)){recordsToUnlink.push(otherRecord);}
if(recordsToReplaceList[i]!==otherRecord){hasToReorder=true;}}
if(this._setRelationUnlinkX2Many(record,recordsToUnlink,options)){hasChanged=true;}
if(hasToReorder){otherRecordsSet.clear();for(const record of recordsToReplaceList){otherRecordsSet.add(record);}
hasChanged=true;}
return hasChanged;}
_setRelationUnlink(record,newValue,options){switch(this.relationType){case'many2many':case'one2many':return this._setRelationUnlinkX2Many(record,newValue,options);case'many2one':case'one2one':return this._setRelationUnlinkX2One(record,options);}}
_setRelationUnlinkX2Many(record,newValue,{hasToUpdateInverse=true}={}){const recordsToUnlink=this._convertX2ManyValue(newValue,{hasToVerify:false});const otherRecords=this.read(record);let hasChanged=false;for(const recordToUnlink of recordsToUnlink){const wasLinked=otherRecords.delete(recordToUnlink);if(!wasLinked){continue;}
hasChanged=true;if(hasToUpdateInverse){if(!recordToUnlink.exists()){continue;}
if(this.isCausal){record.modelManager._delete(recordToUnlink);}else{record.modelManager._update(recordToUnlink,{[this.inverse]:unlink(record)},{allowWriteReadonly:true,hasToUpdateInverse:false});}}}
return hasChanged;}
_setRelationUnlinkX2One(record,{hasToUpdateInverse=true}={}){const otherRecord=this.read(record);if(!otherRecord){return false;}
record.__values[this.fieldName]=undefined;if(hasToUpdateInverse){if(!otherRecord.exists()){return;}
if(this.isCausal){record.modelManager._delete(otherRecord);}else{record.modelManager._update(otherRecord,{[this.inverse]:unlink(record)},{allowWriteReadonly:true,hasToUpdateInverse:false});}}
return true;}
_verifyRelationalValue(record){if(!record){throw Error(`record is undefined. Did you try to link() or insert() empty value? Considering clear() instead.`);}
if(!record.modelManager){throw Error(`${record} is not a record. Did you try to use link() instead of insert() with data?`);}
const OtherModel=record.modelManager.models[this.to];if(!OtherModel.get(record.localId,{isCheckingInheritance:true})){throw Error(`Record ${record.localId} is not valid for relational field ${this.fieldName}.`);}}}
const attr=__exports.attr=ModelField.attr;const many2many=__exports.many2many=ModelField.many2many;const many2one=__exports.many2one=ModelField.many2one;const one2many=__exports.one2many=ModelField.one2many;const one2one=__exports.one2one=ModelField.one2one;return __exports;});;

/* /mail/static/src/model/model_field_command.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/model/model_field_command',async function(require){'use strict';let __exports={};class FieldCommand{constructor(name,value){this._name=name;this._value=value;}
get name(){return this._name;}
get value(){return this._value;}}
function clear(){return new FieldCommand('clear');}
function create(data){return new FieldCommand('create',data);}
function decrement(amount=1){return new FieldCommand('decrement',amount);}
function increment(amount=1){return new FieldCommand('increment',amount);}
function insert(data){return new FieldCommand('insert',data);}
function insertAndReplace(data={}){return new FieldCommand('insert-and-replace',data);}
function link(newValue){return new FieldCommand('link',newValue);}
function replace(newValue){return new FieldCommand('replace',newValue);}
function set(newValue){return new FieldCommand('set',newValue);}
function unlink(data){return new FieldCommand('unlink',data);}
function unlinkAll(){return new FieldCommand('unlink-all');}
Object.assign(__exports,{FieldCommand,clear,create,decrement,increment,insert,insertAndReplace,link,replace,set,unlink,unlinkAll,});return __exports;});;

/* /mail/static/src/model/model_field_relation_set.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/model/model_field_relation_set',async function(require){'use strict';let __exports={};const{decrement,increment}=require('@mail/model/model_field_command');const{Listener}=require('@mail/model/model_listener');const{followRelations}=require('@mail/model/model_utils');const RelationSet=__exports.RelationSet=class RelationSet{constructor(record,field){this.record=record;this.field=field;this.set=new Set();if(this.field.sort){this.sortArray=new Array();this.sortListenerByValue=new Map();}
if(this.field.sumContributions.length>0){this.sumByValueByField=new Map();this.sumListenerByValueByField=new Map();for(const{to:sumFieldName}of this.field.sumContributions){this.sumByValueByField.set(sumFieldName,new Map());this.sumListenerByValueByField.set(sumFieldName,new Map());}}}
get size(){return this.set.size;}
add(value){if(this.set.has(value)){return;}
this.set.add(value);if(this.field.sort){this.sortArray.push(value);const listener=new Listener({isPartOfUpdateCycle:true,name:`sort of ${value} in ${this.field} of ${this.record}`,onChange:info=>{this.record.modelManager.startListening(listener);const compareDefinition=this.record[this.field.sort]();const relatedPathSet=new Set(compareDefinition.map(operation=>operation[1]));for(const relatedPath of relatedPathSet){followRelations(value,relatedPath);}
this.record.modelManager.stopListening(listener);const compareFunction=(a,b)=>{for(const[compareMethod,relatedPath]of compareDefinition){const valA=followRelations(a,relatedPath);const valB=followRelations(b,relatedPath);switch(compareMethod){case'defined-first':{if(!valA&&!valB){return 0;}
if(!valA){return 1;}
if(!valB){return-1;}
break;}
case'case-insensitive-asc':if(valA.toLowerCase()===valB.toLowerCase()){break;}
return valA.toLowerCase()<valB.toLowerCase()?-1:1;case'smaller-first':if(valA===valB){break;}
return valA-valB;case'greater-first':if(valA===valB){break;}
return valB-valA;default:throw Error(`sort compare method "${compareMethod}" is not supported.`);}}
return 0;};this.sortArray.sort(compareFunction);this.record.modelManager._markRecordFieldAsChanged(this.record,this.field);},});this.sortListenerByValue.set(value,listener);listener.onChange({reason:'initial call'});}
for(const{from:contributionFieldName,to:sumFieldName}of this.field.sumContributions){this.sumByValueByField.get(sumFieldName).set(value,0);const listener=new Listener({isPartOfUpdateCycle:true,name:`sum of field(${sumFieldName}) of ${this.record} from field(${contributionFieldName}) of ${value} through relation ${this.field}`,onChange:info=>{this.record.modelManager.startListening(listener);const contribution=value[contributionFieldName];this.record.modelManager.stopListening(listener);const previousContribution=this.sumByValueByField.get(sumFieldName).get(value);this.sumByValueByField.get(sumFieldName).set(value,contribution);this.record.modelManager._update(this.record,{[sumFieldName]:[decrement(previousContribution),increment(contribution),],},{allowWriteReadonly:true},);},});this.sumListenerByValueByField.get(sumFieldName).set(value,listener);listener.onChange({reason:'initial call'});}}
clear(){for(const record of this.set){this.delete(record);}}
delete(value){const wasPresent=this.set.delete(value);if(!wasPresent){return false;}
if(this.field.sort){const index=this.sortArray.indexOf(value);this.sortArray.splice(index,1);const listener=this.sortListenerByValue.get(value);this.sortListenerByValue.delete(listener);this.record.modelManager.removeListener(listener);}
for(const{to:sumFieldName}of this.field.sumContributions){const contribution=this.sumByValueByField.get(sumFieldName).get(value);this.sumByValueByField.get(sumFieldName).delete(value);this.record.modelManager._update(this.record,{[sumFieldName]:decrement(contribution)},{allowWriteReadonly:true});const listener=this.sumListenerByValueByField.get(sumFieldName).get(value);this.sumListenerByValueByField.get(sumFieldName).delete(value);this.record.modelManager.removeListener(listener);}
return true;}
has(value){return this.set.has(value);}
[Symbol.iterator](){if(this.field.sort){return this.sortArray[Symbol.iterator]();}
return this.set[Symbol.iterator]();}}
return __exports;});;

/* /mail/static/src/model/model_listener.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/model/model_listener',async function(require){'use strict';let __exports={};const Listener=__exports.Listener=class Listener{constructor({name,onChange,isLocking=true,isPartOfUpdateCycle=false}){this.isLocking=isLocking;this.isPartOfUpdateCycle=isPartOfUpdateCycle;this.name=name;this.onChange=onChange;this.lastObservedLocalIds=new Set();this.lastObservedFieldsByLocalId=new Map();this.lastObservedAllByModel=new Set();}
toString(){return`listener(${this.name})`;}}
return __exports;});;

/* /mail/static/src/model/model_manager.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/model/model_manager',async function(require){'use strict';let __exports={};const{registry}=require('@mail/model/model_core');const{ModelField}=require('@mail/model/model_field');const{FieldCommand,unlinkAll}=require('@mail/model/model_field_command');const{RelationSet}=require('@mail/model/model_field_relation_set');const{Listener}=require('@mail/model/model_listener');const{followRelations}=require('@mail/model/model_utils');const{patchClassMethods,patchInstanceMethods}=require('@mail/utils/utils');const{makeDeferred}=require('@mail/utils/deferred/deferred');const ModelManager=__exports.ModelManager=class ModelManager{constructor(env){this.env=env;this.messagingCreatedPromise=makeDeferred();this.messagingInitializedPromise=makeDeferred();this._createdRecordsComputes=new Set();this._createdRecordsCreated=new Set();this._createdRecordsOnChange=new Set();this._listeners=new Set();this._listenersObservingAllByModel=new Map();this._listenersObservingLocalId=new Map();this._listenersObservingFieldOfLocalId=new Map();this._listenersToNotifyAfterUpdateCycle=new Map();this._listenersToNotifyInUpdateCycle=new Map();this.models={};this._updatedRecordsCheckRequired=new Set();this.isDebug=false;}
async start(values){if(document.readyState==='loading'){await new Promise(resolve=>{window.addEventListener('load',resolve);});}
await new Promise(resolve=>setTimeout(resolve));await this.env.session.is_bound;this.models=this._generateModels();const messaging=this.models['mail.messaging'].insert(values);Object.assign(odoo.__DEBUG__,{messaging});this.messagingCreatedPromise.resolve();await this.messaging.start();this.messagingInitializedPromise.resolve();}
all(Model,filterFunc){for(const listener of this._listeners){listener.lastObservedAllByModel.add(Model);const entry=this._listenersObservingAllByModel.get(Model);const info={listener,reason:`all() - ${Model}`,};if(entry.has(listener)){entry.get(listener).push(info);}else{entry.set(listener,[info]);}}
const allRecords=Object.values(Model.__records);if(filterFunc){return allRecords.filter(filterFunc);}
return allRecords;}
create(Model,data={}){return this.insert(Model,data);}
delete(record){this._delete(record);this._flushUpdateCycle();}
exists(Model,record){const existingRecord=Model.__records[record.localId];return Boolean(existingRecord&&existingRecord===record);}
find(Model,findFunc){return this.all(Model).find(findFunc);}
findFromIdentifyingData(Model,data){return this.get(Model,this._getRecordIndex(Model,data));}
get(Model,localId,{isCheckingInheritance=false}={}){if(!localId){return;}
if(!isCheckingInheritance&&this.isDebug){const modelName=localId.split('(')[0];if(modelName!==Model.modelName){throw Error(`wrong format of localId ${localId} for ${Model}.`);}}
for(const listener of this._listeners){listener.lastObservedLocalIds.add(localId);if(!this._listenersObservingLocalId.has(localId)){this._listenersObservingLocalId.set(localId,new Map());}
const entry=this._listenersObservingLocalId.get(localId);const info={listener,reason:`get record - ${localId}`,};if(entry.has(listener)){entry.get(listener).push(info);}else{entry.set(listener,[info]);}}
const record=Model.__records[localId];if(record){return record;}
if(!isCheckingInheritance){return;}
for(const SubModel of Object.values(this.models)){if(!(SubModel.prototype instanceof Model)){continue;}
const record=SubModel.__records[localId];if(record){return record;}}
return;}
async getMessaging(){await this.messagingCreatedPromise;await this.messagingInitializedPromise;return this.messaging;}
insert(Model,data){const res=this._insert(Model,data);this._flushUpdateCycle();return res;}
get messaging(){if(!this.models['mail.messaging']){return undefined;}
return this.models['mail.messaging'].findFromIdentifyingData({});}
removeListener(listener){this._listeners.delete(listener);this._listenersToNotifyInUpdateCycle.delete(listener);this._listenersToNotifyAfterUpdateCycle.delete(listener);for(const localId of listener.lastObservedLocalIds){this._listenersObservingLocalId.get(localId).delete(listener);const listenersObservingFieldOfLocalId=this._listenersObservingFieldOfLocalId.get(localId);for(const field of listener.lastObservedFieldsByLocalId.get(localId)||[]){listenersObservingFieldOfLocalId.get(field).delete(listener);}}
for(const Model of listener.lastObservedAllByModel){this._listenersObservingAllByModel.get(Model).delete(listener);}
listener.lastObservedLocalIds.clear();listener.lastObservedFieldsByLocalId.clear();listener.lastObservedAllByModel.clear();}
startListening(listener){this.removeListener(listener);this._listeners.add(listener);}
stopListening(listener){this._listeners.delete(listener);}
update(record,data){const res=this._update(record,data);this._flushUpdateCycle();return res;}
_addDefaultData(Model,data={}){const data2={};for(const field of Model.__fieldList){if(data[field.fieldName]!==undefined){data2[field.fieldName]=data[field.fieldName];}else if(field.default!==undefined){data2[field.fieldName]=field.default;}}
return data2;}
_applyModelPatchFields(Model,patch){for(const[fieldName,field]of Object.entries(patch)){Model.fields[fieldName]=field;}}
_checkDeclaredFieldsOnModels(Models){for(const Model of Object.values(Models)){for(const fieldName in Model.fields){const field=Model.fields[fieldName];if(fieldName in Model.prototype){throw new Error(`Field "${Model}/${fieldName}" has a forbidden name.`);}
if(!(['attribute','relation'].includes(field.fieldType))){throw new Error(`Field "${Model}/${fieldName}" has unsupported type ${field.fieldType}.`);}
if(field.fieldType==='attribute'){const invalidKeys=Object.keys(field).filter(key=>!['compute','default','dependencies','fieldType','readonly','related','required','sum',].includes(key));if(invalidKeys.length>0){throw new Error(`Field "${Model}/${fieldName}" contains some invalid keys: "${invalidKeys.join(", ")}".`);}}
if(field.fieldType==='relation'){const invalidKeys=Object.keys(field).filter(key=>!['compute','default','dependencies','fieldType','inverse','isCausal','readonly','related','relationType','required','sort','to',].includes(key));if(invalidKeys.length>0){throw new Error(`Field "${Model}/${fieldName}" contains some invalid keys: "${invalidKeys.join(", ")}".`);}
if(!Models[field.to]){throw new Error(`Relational field "${Model}/${fieldName}" targets to unknown model name "${field.to}".`);}
if(field.isCausal&&!(['one2many','one2one'].includes(field.relationType))){throw new Error(`Relational field "${Model}/${fieldName}" has "isCausal" true with a relation of type "${field.relationType}" but "isCausal" is only supported for "one2many" and "one2one".`);}
if(field.required&&!(['one2one','many2one'].includes(field.relationType))){throw new Error(`Relational field "${Model}/${fieldName}" has "required" true with a relation of type "${field.relationType}" but "required" is only supported for "one2one" and "many2one".`);}
if(field.sort&&!(['one2many','many2many'].includes(field.relationType))){throw new Error(`Relational field "${Model}/${fieldName}" has "sort" with a relation of type "${field.relationType}" but "sort" is only supported for "one2many" and "many2many".`);}}
if(field.compute&&!(typeof field.compute==='string')){throw new Error(`Field "${Model}/${fieldName}" property "compute" must be a string (instance method name).`);}
if(field.compute&&!(Model.prototype[field.compute])){throw new Error(`Field "${Model}/${fieldName}" property "compute" does not refer to an instance method of this Model.`);}
if(field.compute&&field.related){throw new Error(`Field "${Model}/${fieldName}" cannot be a related and compute field at the same time.`);}
if(field.related){if(!(typeof field.related==='string')){throw new Error(`Field "${Model}/${fieldName}" property "related" has invalid format.`);}
const[relationName,relatedFieldName,other]=field.related.split('.');if(!relationName||!relatedFieldName||other){throw new Error(`Field "${Model}/${fieldName}" property "related" has invalid format.`);}
let relatedRelation;let TargetModel=Model;while(Models[TargetModel.modelName]&&!relatedRelation){if(TargetModel.fields){relatedRelation=TargetModel.fields[relationName];}
TargetModel=TargetModel.__proto__;}
if(!relatedRelation){throw new Error(`Related field "${Model}/${fieldName}" relates to unknown relation name "${relationName}".`);}
if(relatedRelation.fieldType!=='relation'){throw new Error(`Related field "${Model}/${fieldName}" relates to non-relational field "${relationName}".`);}
const RelatedModel=Models[relatedRelation.to];let relatedField;TargetModel=RelatedModel;while(Models[TargetModel.modelName]&&!relatedField){if(TargetModel.fields){relatedField=TargetModel.fields[relatedFieldName];}
TargetModel=TargetModel.__proto__;}
if(!relatedField){throw new Error(`Related field "${Model}/${fieldName}" relates to unknown related model field "${relatedFieldName}".`);}
if(relatedField.fieldType!==field.fieldType){throw new Error(`Related field "${Model}/${fieldName}" has mismatch type with its related model field.`);}
if(relatedField.fieldType==='relation'&&relatedField.to!==field.to){throw new Error(`Related field "${Model}/${fieldName}" has mismatch target model name with its related model field.`);}}}}}
_checkProcessedFieldsOnModels(Models){for(const Model of Object.values(Models)){for(const field of Model.__fieldList){const fieldName=field.fieldName;if(!(['attribute','relation'].includes(field.fieldType))){throw new Error(`Field "${Model}/${fieldName}" has unsupported type ${field.fieldType}.`);}
if(field.compute&&field.related){throw new Error(`Field "${Model}/${fieldName}" cannot be a related and compute field at the same time.`);}
if(field.fieldType==='attribute'){continue;}
if(!field.relationType){throw new Error(`Field "${Model}/${fieldName}" must define a relation type in "relationType".`);}
if(!(['one2one','one2many','many2one','many2many'].includes(field.relationType))){throw new Error(`Field "${Model}/${fieldName}" has invalid relation type "${field.relationType}".`);}
if(!field.inverse){throw new Error(`Field "${
                            Model.modelName
                        }/${
                            fieldName
                        }" must define an inverse relation name in "inverse".`);}
if(!field.to){throw new Error(`Relation "${
                            Model.modelNames
                        }/${
                            fieldName
                        }" must define a model name in "to" (1st positional parameter of relation field helpers).`);}
const RelatedModel=Models[field.to];if(!RelatedModel){throw new Error(`Model name of relation "${Model}/${fieldName}" does not exist.`);}
const inverseField=RelatedModel.__fieldMap[field.inverse];if(!inverseField){throw new Error(`Relation "${
                            Model.modelName
                        }/${
                            fieldName
                        }" has no inverse field "${RelatedModel}/${field.inverse}".`);}
if(inverseField.inverse!==fieldName){throw new Error(`Inverse field name of relation "${
                            Model.modelName
                        }/${
                            fieldName
                        }" does not match with field name of relation "${
                            RelatedModel.modelName
                        }/${
                            inverseField.inverse
                        }".`);}
const allSelfAndParentNames=[];let TargetModel=Model;while(TargetModel){allSelfAndParentNames.push(TargetModel.modelName);TargetModel=TargetModel.__proto__;}
if(!allSelfAndParentNames.includes(inverseField.to)){throw new Error(`Relation "${
                            Model.modelName
                        }/${
                            fieldName
                        }" has inverse relation "${
                            RelatedModel.modelName
                        }/${
                            field.inverse
                        }" misconfigured (currently "${
                            inverseField.to
                        }", should instead refer to this model or parented models: ${
                            allSelfAndParentNames.map(name => `"${name}"`).join(', ')
                        }?)`);}
if((field.relationType==='many2many'&&inverseField.relationType!=='many2many')||(field.relationType==='one2one'&&inverseField.relationType!=='one2one')||(field.relationType==='one2many'&&inverseField.relationType!=='many2one')||(field.relationType==='many2one'&&inverseField.relationType!=='one2many')){throw new Error(`Mismatch relations types "${
                            Model.modelName
                        }/${
                            fieldName
                        }" (${
                            field.relationType
                        }) and "${
                            RelatedModel.modelName
                        }/${
                            field.inverse
                        }" (${
                            inverseField.relationType
                        }).`);}}
for(const identifyingField of Model.__identifyingFieldsFlattened){const field=Model.__fieldMap[identifyingField];if(!field){throw new Error(`Identifying field "${identifyingField}" is not a field on model "${Model}".`);}
if(!field.readonly){throw new Error(`Identifying field "${identifyingField}" on model "${Model}" is lacking readonly.`);}
if(field.to){if(!(['one2one','many2one'].includes(field.relationType))){throw new Error(`Identifying field "${identifyingField}" on model "${Model}" has a relation of type "${field.relationType}" but identifying field is only supported for "one2one" and "many2one".`);}
const RelatedModel=Models[field.to];const inverseField=RelatedModel.__fieldMap[field.inverse];if(!inverseField.isCausal){throw new Error(`Identifying field "${identifyingField}" on model "${Model}" has an inverse "${field.inverse}" not declared as "isCausal" on "${RelatedModel}".`);}}}}}
_create(Model,localId){const nonProxyRecord=new Model({localId,valid:true});const record=!this.isDebug?nonProxyRecord:new Proxy(nonProxyRecord,{get:function getFromProxy(record,prop){if(!Model.__fieldMap[prop]&&!['_super','then'].includes(prop)&&typeof prop!=='symbol'&&!(prop in record)){console.warn(`non-field read "${prop}" on ${record}`);}
return record[prop];},});for(const field of Model.__fieldList){record.__values[field.fieldName]=undefined;if(field.fieldType==='relation'){if(['one2many','many2many'].includes(field.relationType)){record.__values[field.fieldName]=new RelationSet(record,field);}}}
if(!this._listenersObservingLocalId.has(localId)){this._listenersObservingLocalId.set(localId,new Map());}
this._listenersObservingFieldOfLocalId.set(localId,new Map());for(const field of Model.__fieldList){this._listenersObservingFieldOfLocalId.get(localId).set(field,new Map());}
Model.__records[record.localId]=record;record._willCreate();this._createdRecordsComputes.add(record);this._createdRecordsCreated.add(record);this._createdRecordsOnChange.add(record);for(const[listener,infoList]of this._listenersObservingAllByModel.get(Model).entries()){this._markListenerToNotify(listener,{listener,reason:`_create: allByModel - ${record}`,infoList,});}
for(const[listener,infoList]of this._listenersObservingLocalId.get(localId).entries()){this._markListenerToNotify(listener,{listener,reason:`_create: localId - ${record}`,infoList,});}
return record;}
_delete(record){this._ensureNoLockingListener();const Model=record.constructor;if(!record.exists()){throw Error(`Cannot delete already deleted record ${record.localId}.`);}
record._willDelete();for(const listener of record.__listeners){this.removeListener(listener);}
for(const field of Model.__fieldList){if(field.fieldType==='relation'){field.parseAndExecuteCommands(record,unlinkAll(),{allowWriteReadonly:true});}}
this._createdRecordsComputes.delete(record);this._createdRecordsCreated.delete(record);this._createdRecordsOnChange.delete(record);this._updatedRecordsCheckRequired.delete(record);for(const[listener,infoList]of this._listenersObservingLocalId.get(record.localId).entries()){this._markListenerToNotify(listener,{listener,reason:`_delete: localId - ${record}`,infoList,});}
for(const[listener,infoList]of this._listenersObservingAllByModel.get(Model).entries()){this._markListenerToNotify(listener,{listener,reason:`_delete: allByModel - ${record}`,infoList,});}
delete Model.__records[record.localId];}
_ensureNoLockingListener(){for(const listener of this._listeners){if(listener.isLocking){throw Error(`Model manager locked by ${listener}. It is not allowed to insert/update/delete from inside a lock.`);}}}
_executeCreatedRecordsComputes(){const hasChanged=this._createdRecordsComputes.size>0;for(const record of this._createdRecordsComputes){this._createdRecordsComputes.delete(record);if(!record.exists()){throw Error(`Cannot start compute/related for already deleted ${record}.`);}
const listeners=[];for(const field of record.constructor.__fieldList){if(field.compute){const listener=new Listener({isPartOfUpdateCycle:true,name:`compute ${field} of ${record}`,onChange:(info)=>{this.startListening(listener);const res=record[field.compute]();this.stopListening(listener);this._update(record,{[field.fieldName]:res},{allowWriteReadonly:true});},});listeners.push(listener);}
if(field.related){const listener=new Listener({isPartOfUpdateCycle:true,name:`related ${field} of ${record}`,onChange:(info)=>{this.startListening(listener);const res=field.computeRelated(record);this.stopListening(listener);this._update(record,{[field.fieldName]:res},{allowWriteReadonly:true});},});listeners.push(listener);}}
record.__listeners.push(...listeners);for(const listener of listeners){listener.onChange({listener,reason:`first call on ${record}`,});}}
if(hasChanged){this._flushUpdateCycle();}}
_executeCreatedRecordsCreated(){for(const record of this._createdRecordsCreated){this._createdRecordsCreated.delete(record);if(!record.exists()){throw Error(`Cannot call _created for already deleted ${record}.`);}
record._created();}}
_executeCreatedRecordsOnChange(){for(const record of this._createdRecordsOnChange){this._createdRecordsOnChange.delete(record);if(!record.exists()){throw Error(`Cannot call onChange for already deleted ${record}.`);}
for(const onChange of record.constructor.onChanges||[]){const listener=new Listener({name:`${onChange} of ${record}`,onChange:(info)=>{this.startListening(listener);for(const dependency of onChange.dependencies){followRelations(record,dependency);}
this.stopListening(listener);record[onChange.methodName]();},});record.__listeners.push(listener);listener.onChange({listener,reason:`first call on ${record}`,});}}}
_executeUpdatedRecordsCheckRequired(){for(const record of this._updatedRecordsCheckRequired){for(const required of record.constructor.__requiredFieldsList){if(record[required.fieldName]===undefined){throw Error(`required ${required} of ${record} is missing`);}}}
this._updatedRecordsCheckRequired.clear();}
_flushUpdateCycle(func){this._executeCreatedRecordsComputes();this._notifyListenersInUpdateCycle();this._executeUpdatedRecordsCheckRequired();this._executeCreatedRecordsCreated();this._executeCreatedRecordsOnChange();this._notifyListenersAfterUpdateCycle();}
_generateModels(){const allNames=Object.keys(registry);const Models={};const generatedNames=[];let toGenerateNames=[...allNames];while(toGenerateNames.length>0){const generatable=toGenerateNames.map(name=>registry[name]).find(entry=>{let isGenerateable=true;for(const dependencyName of entry.dependencies){if(!generatedNames.includes(dependencyName)){isGenerateable=false;}}
return isGenerateable;});if(!generatable){throw new Error(`Cannot generate following Model: ${toGenerateNames.join(', ')}`);}
if(!generatable.factory){throw new Error(`Missing factory for the following Model: ${generatable.name} (maybe check for typo in name?)`);}
const Model=generatable.factory(Models);Model.modelManager=this;Model.__records={};if(!Model.hasOwnProperty('identifyingFields')){throw new Error(`${Model} is lacking identifying fields.`);}
Model.__identifyingFields=Model.identifyingFields;const identifyingFieldsFlattened=new Set();for(const identifyingElement of Model.identifyingFields){const identifyingFields=typeof identifyingElement==='string'?[identifyingElement]:identifyingElement;for(const identifyingField of identifyingFields){identifyingFieldsFlattened.add(identifyingField);}}
Model.__identifyingFieldsFlattened=identifyingFieldsFlattened;for(const patch of generatable.patches){switch(patch.type){case'class':patchClassMethods(Model,patch.name,patch.patch);break;case'instance':patchInstanceMethods(Model,patch.name,patch.patch);break;case'field':this._applyModelPatchFields(Model,patch.patch);break;case'identifyingFields':patch.patch(Model.__identifyingFields);break;}}
if(!Object.prototype.hasOwnProperty.call(Model,'modelName')){throw new Error(`Missing static property "modelName" on Model class "${Model.name}".`);}
if(generatedNames.includes(Model.modelName)){throw new Error(`Duplicate model name "${Model}" shared on 2 distinct Model classes.`);}
Models[Model.modelName]=Model;generatedNames.push(Model.modelName);toGenerateNames=toGenerateNames.filter(name=>name!==Model.modelName);this._listenersObservingAllByModel.set(Model,new Map());}
this._checkDeclaredFieldsOnModels(Models);this._processDeclaredFieldsOnModels(Models);this._checkProcessedFieldsOnModels(Models);return Models;}
_getRecordIndex(Model,data){return`${Model.modelName}(${Model.__identifyingFields.map(identifyingElement => {
            const fieldName = typeof identifyingElement === 'string'
                ? identifyingElement
                : identifyingElement.reduce((fieldName, currentFieldName) => {
                    const fieldValue = data[currentFieldName] !== undefined
                        ? data[currentFieldName]
                        : Model.__fieldMap[currentFieldName].default;
                    if (fieldValue === undefined) {
                        return fieldName;
                    }
                    if (fieldName) {
                        throw new Error(`Identifying element on ${Model}with"or"value should have only one of the conditional values given in data.Currently have both ${fieldName}and ${currentFieldName}.`);
                    }
                    return currentFieldName;
                }, undefined);
            if (!fieldName) {
                throw new Error(`Identifying element"${identifyingElement}"on ${Model}is lacking a value.`);
            }
            const fieldValue = data[fieldName] !== undefined
                ? data[fieldName]
                : Model.__fieldMap[fieldName].default;
            if (fieldValue === undefined) {
                throw new Error(`Identifying field"${fieldName}"on ${Model}is lacking a value.`);
            }
            const relationTo = Model.__fieldMap[fieldName].to;
            if (!relationTo) {
                return `${fieldName}:${fieldValue}`;
            }
            const OtherModel = this.models[relationTo];
            if (fieldValue instanceof OtherModel) {
                return `${fieldName}:${this._getRecordIndex(OtherModel,fieldValue)}`;
            }
            if (!(fieldValue instanceof FieldCommand)) {
                throw new Error(`Identifying element"${Model}/${fieldName}"is expecting a command for relational field.`);
            }
            if (!['link', 'insert', 'replace', 'insert-and-replace'].includes(fieldValue._name)) {
                throw new Error(`Identifying element"${Model}/${fieldName}"is expecting a command of type"insert-and-replace","replace","insert"or"link"."${fieldValue._name}"was given instead.`);
            }
            const relationValue = fieldValue._value;
            if (!relationValue) {
                throw new Error(`Identifying element"${Model}/${fieldName}"is lacking a relation value.`);
            }
            return `${fieldName}:${this._getRecordIndex(OtherModel,relationValue)}`;
        }).join(', ')})`;}
_insert(Model,data={}){this._ensureNoLockingListener();const isMulti=typeof data[Symbol.iterator]==='function';const dataList=isMulti?data:[data];const records=[];for(const data of dataList){const localId=this._getRecordIndex(Model,data);let record=Model.get(localId);if(!record){record=this._create(Model,localId);this._update(record,this._addDefaultData(Model,data),{allowWriteReadonly:true});}else{this._update(record,data);}
records.push(record);}
return isMulti?records:records[0];}
_makeInverseRelationField(Model,field){const relFunc=field.relationType==='many2many'?ModelField.many2many:field.relationType==='many2one'?ModelField.one2many:field.relationType==='one2many'?ModelField.many2one:field.relationType==='one2one'?ModelField.one2one:undefined;if(!relFunc){throw new Error(`Cannot compute inverse Relation of "${Model}/${field.fieldName}".`);}
const inverseField=new ModelField(Object.assign({},relFunc(Model.modelName,{inverse:field.fieldName}),{fieldName:`_inverse_${Model}/${field.fieldName}`,}));return inverseField;}
_markListenerToNotify(listener,info){if(!(listener instanceof Listener)){throw new Error(`Listener is not a listener ${listener}`);}
if(listener.isPartOfUpdateCycle){const entry=this._listenersToNotifyInUpdateCycle.get(listener);if(entry){entry.push(info);}else{this._listenersToNotifyInUpdateCycle.set(listener,[info]);}}
if(!listener.isPartOfUpdateCycle){const entry=this._listenersToNotifyAfterUpdateCycle.get(listener);if(entry){entry.push(info);}else{this._listenersToNotifyAfterUpdateCycle.set(listener,[info]);}}}
_markRecordFieldAsChanged(record,field){for(const[listener,infoList]of this._listenersObservingFieldOfLocalId.get(record.localId).get(field).entries()){this._markListenerToNotify(listener,{listener,reason:`_update: ${field} of ${record}`,infoList,});}}
_notifyListenersAfterUpdateCycle(){for(const[listener,infoList]of this._listenersToNotifyAfterUpdateCycle.entries()){this._listenersToNotifyAfterUpdateCycle.delete(listener);listener.onChange(infoList);}}
_notifyListenersInUpdateCycle(){const hasChanged=this._listenersToNotifyInUpdateCycle.size>0;for(const[listener,infoList]of this._listenersToNotifyInUpdateCycle.entries()){this._listenersToNotifyInUpdateCycle.delete(listener);listener.onChange(infoList);}
if(hasChanged){this._flushUpdateCycle();}}
_processDeclaredFieldsOnModels(Models){for(const Model of Object.values(Models)){if(!Object.prototype.hasOwnProperty.call(Model,'fields')){Model.fields={};}
Model.inverseRelations=[];const sumContributionsByFieldName=new Map();for(const[fieldName,fieldData]of Object.entries(Model.fields)){Model.fields[fieldName]=new ModelField(Object.assign({},fieldData,{fieldName,}));if(fieldData.sum){const[relationFieldName,contributionFieldName]=fieldData.sum.split('.');if(!sumContributionsByFieldName.has(relationFieldName)){sumContributionsByFieldName.set(relationFieldName,[]);}
sumContributionsByFieldName.get(relationFieldName).push({from:contributionFieldName,to:fieldName,});}}
for(const[fieldName,sumContributions]of sumContributionsByFieldName){Model.fields[fieldName].sumContributions=sumContributions;}}
for(const Model of Object.values(Models)){for(const field of Object.values(Model.fields)){if(field.fieldType!=='relation'){continue;}
if(field.inverse){continue;}
const RelatedModel=Models[field.to];const inverseField=this._makeInverseRelationField(Model,field);field.inverse=inverseField.fieldName;RelatedModel.fields[inverseField.fieldName]=inverseField;}}
for(const Model of Object.values(Models)){Model.__combinedFields={};for(const field of Object.values(Model.fields)){Model.__combinedFields[field.fieldName]=field;}
let TargetModel=Model.__proto__;while(TargetModel&&TargetModel.fields){for(const targetField of Object.values(TargetModel.fields)){const field=Model.__combinedFields[targetField.fieldName];if(!field){Model.__combinedFields[targetField.fieldName]=targetField;}}
TargetModel=TargetModel.__proto__;}}
for(const Model of Object.values(Models)){Model.__fieldMap=Model.__combinedFields;Model.__fieldList=Object.values(Model.__fieldMap);Model.__requiredFieldsList=Model.__fieldList.filter(field=>field.required);for(const field of Model.__fieldList){Object.defineProperty(Model.prototype,field.fieldName,{get:function getFieldValue(){if(this.modelManager._listeners.size){if(!this.modelManager._listenersObservingLocalId.has(this.localId)){this.modelManager._listenersObservingLocalId.set(this.localId,new Map());}
const entryLocalId=this.modelManager._listenersObservingLocalId.get(this.localId);const reason=`getField - ${field} of ${this}`;const entryField=this.modelManager._listenersObservingFieldOfLocalId.get(this.localId).get(field);for(const listener of this.modelManager._listeners){listener.lastObservedLocalIds.add(this.localId);const info={listener,reason};if(entryLocalId.has(listener)){entryLocalId.get(listener).push(info);}else{entryLocalId.set(listener,[info]);}
if(!listener.lastObservedFieldsByLocalId.has(this.localId)){listener.lastObservedFieldsByLocalId.set(this.localId,new Set());}
listener.lastObservedFieldsByLocalId.get(this.localId).add(field);if(entryField.has(listener)){entryField.get(listener).push(info);}else{entryField.set(listener,[info]);}}}
return field.get(this);},});}
delete Model.__combinedFields;}}
_update(record,data,options={}){this._ensureNoLockingListener();if(!record.exists()){throw Error(`Cannot update already deleted record ${record.localId}.`);}
const{allowWriteReadonly=false}=options;const Model=record.constructor;let hasChanged=false;const sortedFieldNames=Object.keys(data);sortedFieldNames.sort((a,b)=>{if(Model.__identifyingFieldsFlattened.has(a)&&!Model.__identifyingFieldsFlattened.has(b)){return-1;}
if(!Model.__identifyingFieldsFlattened.has(a)&&Model.__identifyingFieldsFlattened.has(b)){return 1;}
return 0;});for(const fieldName of sortedFieldNames){if(data[fieldName]===undefined){continue;}
const field=Model.__fieldMap[fieldName];if(!field){throw new Error(`Cannot create/update record with data unrelated to a field. (record: "${record.localId}", non-field attempted update: "${fieldName}")`);}
const newVal=data[fieldName];if(!field.parseAndExecuteCommands(record,newVal,options)){continue;}
if(field.readonly&&!allowWriteReadonly){throw new Error(`read-only ${field} on ${record} was updated`);}
hasChanged=true;this._markRecordFieldAsChanged(record,field);}
if(hasChanged){this._updatedRecordsCheckRequired.add(record);}
return hasChanged;}}
return __exports;});;

/* /mail/static/src/model/model_onchange.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/model/model_onchange',async function(require){'use strict';let __exports={};const OnChange=__exports.OnChange=class OnChange{constructor({dependencies,methodName}){this.dependencies=dependencies;this.methodName=methodName;}
toString(){return`onChange(${this.methodName})`;}}
return __exports;});;

/* /mail/static/src/model/model_utils.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/model/model_utils',async function(require){'use strict';let __exports={};__exports.followRelations=followRelations;function followRelations(record,relatedPath){let target=record;for(const field of relatedPath.split('.')){if(!target.constructor.__fieldMap[field]){throw Error(`field(${field}) does not exist on ${target}`);}
target=target[field];if(!target){break;}}
return target;}
return __exports;});;

/* /mail/static/src/models/activity/activity.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/activity/activity',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one}=require('@mail/model/model_field');const{clear,insert,unlink,unlinkAll}=require('@mail/model/model_field_command');function factory(dependencies){class Activity extends dependencies['mail.model']{async deleteServerRecord(){await this.async(()=>this.env.services.rpc({model:'mail.activity',method:'unlink',args:[[this.id]],}));this.delete();}
static convertData(data){const data2={};if('activity_category'in data){data2.category=data.activity_category;}
if('can_write'in data){data2.canWrite=data.can_write;}
if('create_date'in data){data2.dateCreate=data.create_date;}
if('date_deadline'in data){data2.dateDeadline=data.date_deadline;}
if('chaining_type'in data){data2.chaining_type=data.chaining_type;}
if('icon'in data){data2.icon=data.icon;}
if('id'in data){data2.id=data.id;}
if('note'in data){data2.note=data.note;}
if('state'in data){data2.state=data.state;}
if('summary'in data){data2.summary=data.summary;}
if('activity_type_id'in data){if(!data.activity_type_id){data2.type=unlinkAll();}else{data2.type=insert({displayName:data.activity_type_id[1],id:data.activity_type_id[0],});}}
if('create_uid'in data){if(!data.create_uid){data2.creator=unlinkAll();}else{data2.creator=insert({id:data.create_uid[0],display_name:data.create_uid[1],});}}
if('mail_template_ids'in data){data2.mailTemplates=insert(data.mail_template_ids);}
if('res_id'in data&&'res_model'in data){data2.thread=insert({id:data.res_id,model:data.res_model,});}
if('user_id'in data){if(!data.user_id){data2.assignee=unlinkAll();}else{data2.assignee=insert({id:data.user_id[0],display_name:data.user_id[1],});}}
if('request_partner_id'in data){if(!data.request_partner_id){data2.requestingPartner=unlink();}else{data2.requestingPartner=insert({id:data.request_partner_id[0],display_name:data.request_partner_id[1],});}}
return data2;}
edit(){const action={type:'ir.actions.act_window',name:this.env._t("Schedule Activity"),res_model:'mail.activity',view_mode:'form',views:[[false,'form']],target:'new',context:{default_res_id:this.thread.id,default_res_model:this.thread.model,},res_id:this.id,};this.env.bus.trigger('do-action',{action,options:{on_close:()=>this.fetchAndUpdate()},});}
async fetchAndUpdate(){const[data]=await this.env.services.rpc({model:'mail.activity',method:'activity_format',args:[this.id],},{shadow:true}).catch(e=>{const errorName=e.message&&e.message.data&&e.message.data.name;if(errorName==='odoo.exceptions.MissingError'){return[];}else{throw e;}});let shouldDelete=false;if(data){this.update(this.constructor.convertData(data));}else{shouldDelete=true;}
this.thread.refreshActivities();this.thread.refresh();if(shouldDelete){this.delete();}}
async markAsDone({attachments=[],feedback=false}){const attachmentIds=attachments.map(attachment=>attachment.id);await this.async(()=>this.env.services.rpc({model:'mail.activity',method:'action_feedback',args:[[this.id]],kwargs:{attachment_ids:attachmentIds,feedback,},}));this.thread.refresh();this.delete();}
async markAsDoneAndScheduleNext({feedback}){const action=await this.async(()=>this.env.services.rpc({model:'mail.activity',method:'action_feedback_schedule_next',args:[[this.id]],kwargs:{feedback},}));this.thread.refresh();const thread=this.thread;this.delete();if(!action){thread.refreshActivities();return;}
this.env.bus.trigger('do-action',{action,options:{on_close:()=>{thread.refreshActivities();},},});}
_computeIsCurrentPartnerAssignee(){if(!this.assignee||!this.assignee.partner||!this.messaging.currentPartner){return false;}
return this.assignee.partner===this.messaging.currentPartner;}
_computeNote(){if(this.note==='<p><br></p>'){return clear();}
return this.note;}}
Activity.fields={assignee:many2one('mail.user'),attachments:many2many('mail.attachment',{inverse:'activities',}),canWrite:attr({default:false,}),category:attr(),creator:many2one('mail.user'),dateCreate:attr(),dateDeadline:attr(),feedbackBackup:attr(),chaining_type:attr({default:'suggest',}),icon:attr(),id:attr({readonly:true,required:true,}),isCurrentPartnerAssignee:attr({compute:'_computeIsCurrentPartnerAssignee',default:false,}),mailTemplates:many2many('mail.mail_template',{inverse:'activities',}),note:attr({compute:'_computeNote',}),requestingPartner:many2one('mail.partner'),state:attr(),summary:attr(),thread:many2one('mail.thread',{inverse:'activities',}),type:many2one('mail.activity_type',{inverse:'activities',}),};Activity.identifyingFields=['id'];Activity.modelName='mail.activity';return Activity;}
registerNewModel('mail.activity',factory);return __exports;});;

/* /mail/static/src/models/activity_type/activity_type.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/activity_type/activity_type',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,one2many}=require('@mail/model/model_field');function factory(dependencies){class ActivityType extends dependencies['mail.model']{}
ActivityType.fields={activities:one2many('mail.activity',{inverse:'type',}),displayName:attr(),id:attr({readonly:true,required:true,}),};ActivityType.identifyingFields=['id'];ActivityType.modelName='mail.activity_type';return ActivityType;}
registerNewModel('mail.activity_type',factory);return __exports;});;

/* /mail/static/src/models/attachment/attachment.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/attachment/attachment',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one,one2many}=require('@mail/model/model_field');const{clear,insert}=require('@mail/model/model_field_command');function factory(dependencies){class Attachment extends dependencies['mail.model']{_created(){this.onClickDownload=this.onClickDownload.bind(this);}
static convertData(data){const data2={};if('filename'in data){data2.filename=data.filename;}
if('id'in data){data2.id=data.id;}
if('mimetype'in data){data2.mimetype=data.mimetype;}
if('name'in data){data2.name=data.name;}
if('res_id'in data&&'res_model'in data){data2.originThread=insert({id:data.res_id,model:data.res_model,});}
if('originThread'in data){data2.originThread=data.originThread;}
return data2;}
download(){const downloadLink=document.createElement('a');downloadLink.setAttribute('href',`/web/content/ir.attachment/${this.id}/datas?download=true`);downloadLink.setAttribute('download','');downloadLink.click();}
onClickDownload(ev){ev.stopPropagation();this.download();}
async remove(){if(this.isUnlinkPending){return;}
if(!this.isUploading){this.update({isUnlinkPending:true});try{await this.async(()=>this.env.services.rpc({route:`/mail/attachment/delete`,params:{access_token:this.accessToken,attachment_id:this.id,},},{shadow:true}));}finally{this.update({isUnlinkPending:false});}}else if(this.uploadingAbortController){this.uploadingAbortController.abort();}
this.delete();}
_computeDefaultSource(){if(this.isImage){return`/web/image/${this.id}?signature=${this.checksum}`;}
if(this.isPdf){const pdf_lib=`/web/static/lib/pdfjs/web/viewer.html?file=`
if(!this.accessToken&&this.originThread&&this.originThread.model==='mail.channel'){return`${pdf_lib}/mail/channel/${this.originThread.id}/attachment/${this.id}`;}
const accessToken=this.accessToken?`?access_token%3D${this.accessToken}`:'';return`${pdf_lib}/web/content/${this.id}${accessToken}`;}
if(this.isUrlYoutube){const urlArr=this.url.split('/');let token=urlArr[urlArr.length-1];if(token.includes('watch')){token=token.split('v=')[1];const amp=token.indexOf('&');if(amp!==-1){token=token.substring(0,amp);}}
return`https://www.youtube.com/embed/${token}`;}
if(!this.accessToken&&this.originThread&&this.originThread.model==='mail.channel'){return`/mail/channel/${this.originThread.id}/attachment/${this.id}`;}
const accessToken=this.accessToken?`?access_token=${this.accessToken}`:'';return`/web/content/${this.id}${accessToken}`;}
_computeDisplayName(){const displayName=this.name||this.filename;if(displayName){return displayName;}
return clear();}
_computeDownloadUrl(){if(!this.accessToken&&this.originThread&&this.originThread.model==='mail.channel'){return`/mail/channel/${this.originThread.id}/attachment/${this.id}`;}
const accessToken=this.accessToken?`?access_token=${this.accessToken}`:'';return`/web/content/ir.attachment/${this.id}/datas${accessToken}`;}
_computeExtension(){const extension=this.filename&&this.filename.split('.').pop();if(extension){return extension;}
return clear();}
_computeIsEditable(){if(!this.messaging){return;}
return this.messages.length?this.messages.some(message=>(message.canBeDeleted||(message.author&&message.author===this.messaging.currentPartner)||(message.guestAuthor&&message.guestAuthor===this.messaging.currentGuest))):true;}
_computeIsPdf(){return this.mimetype==='application/pdf';}
_computeIsImage(){const imageMimetypes=['image/bmp','image/gif','image/jpeg','image/png','image/svg+xml','image/tiff','image/x-icon',];return imageMimetypes.includes(this.mimetype);}
_computeIsText(){const textMimeType=['application/javascript','application/json','text/css','text/html','text/plain',];return textMimeType.includes(this.mimetype);}
_computeIsVideo(){const videoMimeTypes=['audio/mpeg','video/x-matroska','video/mp4','video/webm',];return videoMimeTypes.includes(this.mimetype);}
_computeIsUrl(){return this.type==='url'&&this.url;}
_computeIsViewable(){return this.isText||this.isImage||this.isVideo||this.isPdf||this.isUrlYoutube;}
_computeIsUrlYoutube(){return!!this.url&&this.url.includes('youtu');}
_computeMediaType(){return this.mimetype&&this.mimetype.split('/').shift();}
_computeUploadingAbortController(){if(this.isUploading){if(!this.uploadingAbortController){const abortController=new AbortController();abortController.signal.onabort=()=>{this.messaging.messagingBus.trigger('o-attachment-upload-abort',{attachment:this});};return abortController;}
return this.uploadingAbortController;}
return;}}
Attachment.fields={accessToken:attr(),activities:many2many('mail.activity',{inverse:'attachments',}),attachmentCards:one2many('mail.attachment_card',{inverse:'attachment',isCausal:true,}),attachmentImages:one2many('mail.attachment_image',{inverse:'attachment',isCausal:true,}),attachmentLists:many2many('mail.attachment_list',{inverse:'attachments',}),attachmentViewer:many2many('mail.attachment_viewer',{inverse:'attachments',}),checksum:attr(),composer:many2one('mail.composer',{inverse:'attachments',}),defaultSource:attr({compute:'_computeDefaultSource',}),dialogRef:attr(),displayName:attr({compute:'_computeDisplayName',}),downloadUrl:attr({compute:'_computeDownloadUrl',}),extension:attr({compute:'_computeExtension',}),filename:attr(),id:attr({readonly:true,required:true,}),isEditable:attr({compute:'_computeIsEditable',}),isImage:attr({compute:'_computeIsImage',}),is_main:attr(),isPdf:attr({compute:'_computeIsPdf',}),isText:attr({compute:'_computeIsText',}),isUnlinkPending:attr({default:false,}),isUploading:attr({default:false,}),isUrl:attr({compute:'_computeIsUrl',}),isUrlYoutube:attr({compute:'_computeIsUrlYoutube',}),isVideo:attr({compute:'_computeIsVideo',}),isViewable:attr({compute:'_computeIsViewable',}),mediaType:attr({compute:'_computeMediaType',}),messages:many2many('mail.message',{inverse:'attachments',}),mimetype:attr({default:'',}),name:attr(),originThread:many2one('mail.thread',{inverse:'originThreadAttachments',}),size:attr(),threads:many2many('mail.thread',{inverse:'attachments',}),type:attr(),uploadingAbortController:attr({compute:'_computeUploadingAbortController',}),url:attr(),};Attachment.identifyingFields=['id'];Attachment.modelName='mail.attachment';return Attachment;}
registerNewModel('mail.attachment',factory);return __exports;});;

/* /mail/static/src/models/attachment_card/attachment_card.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/attachment_card/attachment_card',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one}=require('@mail/model/model_field');const{insert,insertAndReplace,replace}=require('@mail/model/model_field_command');function factory(dependencies){class AttachmentCard extends dependencies['mail.model']{_created(){this.onClickUnlink=this.onClickUnlink.bind(this);this.onClickImage=this.onClickImage.bind(this);this.onDeleteConfirmDialogClosed=this.onDeleteConfirmDialogClosed.bind(this);}
onClickImage(){if(!this.attachment||!this.attachment.isViewable){return;}
this.messaging.dialogManager.update({dialogs:insert({attachmentViewer:insertAndReplace({attachment:replace(this.attachment),attachmentList:replace(this.attachmentList),}),}),});}
onClickUnlink(ev){ev.stopPropagation();if(!this.attachment){return;}
if(this.attachmentList.composerView){this.component.trigger('o-attachment-removed',{attachmentLocalId:this.attachment.localId});this.attachment.remove();}else{this.update({hasDeleteConfirmDialog:true});}}
onDeleteConfirmDialogClosed(){if(!this.exists()){return;}
this.update({hasDeleteConfirmDialog:false});}}
AttachmentCard.fields={attachment:many2one('mail.attachment',{inverse:'attachmentCards',readonly:true,required:true,}),attachmentList:many2one('mail.attachment_list',{inverse:'attachmentCards',readonly:true,required:true,}),component:attr(),hasDeleteConfirmDialog:attr({default:false,}),};AttachmentCard.identifyingFields=['attachmentList','attachment'];AttachmentCard.modelName='mail.attachment_card';return AttachmentCard;}
registerNewModel('mail.attachment_card',factory);return __exports;});;

/* /mail/static/src/models/attachment_image/attachment_image.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/attachment_image/attachment_image',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one}=require('@mail/model/model_field');const{clear,insert,insertAndReplace,replace}=require('@mail/model/model_field_command');function factory(dependencies){class AttachmentImage extends dependencies['mail.model']{_created(){this.onClickUnlink=this.onClickUnlink.bind(this);this.onDeleteConfirmDialogClosed=this.onDeleteConfirmDialogClosed.bind(this);this.onClickImage=this.onClickImage.bind(this);}
onClickImage(){if(!this.attachment||!this.attachment.isViewable){return;}
this.messaging.dialogManager.update({dialogs:insert({attachmentViewer:insertAndReplace({attachment:replace(this.attachment),attachmentList:replace(this.attachmentList),}),}),});}
onClickUnlink(ev){ev.stopPropagation();if(!this.attachment){return;}
if(this.attachmentList.composerView){this.component.trigger('o-attachment-removed',{attachmentLocalId:this.attachment.localId});this.attachment.remove();}else{this.update({hasDeleteConfirmDialog:true});}}
onDeleteConfirmDialogClosed(){if(!this.exists()){return;}
this.update({hasDeleteConfirmDialog:false});}
_computeHeight(){if(!this.attachmentList){return clear();}
if(this.attachmentList.composerView){return 50;}
if(this.attachmentList.chatter){return 160;}
if(this.attachmentList.message){return 300;}}
_computeImageUrl(){if(!this.attachment){return;}
if(!this.attachment.accessToken&&this.attachment.originThread&&this.attachment.originThread.model==='mail.channel'){return`/mail/channel/${this.attachment.originThread.id}/image/${this.attachment.id}/${this.width}x${this.height}`;}
const accessToken=this.attachment.accessToken?`?access_token=${this.attachment.accessToken}`:'';return`/web/image/${this.attachment.id}/${this.width}x${this.height}${accessToken}`;}
_computeWidth(){return 1920;}}
AttachmentImage.fields={attachment:many2one('mail.attachment',{inverse:'attachmentImages',readonly:true,required:true,}),attachmentList:many2one('mail.attachment_list',{inverse:'attachmentImages',readonly:true,required:true,}),component:attr(),hasDeleteConfirmDialog:attr({default:false,}),height:attr({compute:'_computeHeight',required:true,}),imageUrl:attr({compute:'_computeImageUrl',}),width:attr({compute:'_computeWidth',required:true,}),};AttachmentImage.identifyingFields=['attachmentList','attachment'];AttachmentImage.modelName='mail.attachment_image';return AttachmentImage;}
registerNewModel('mail.attachment_image',factory);return __exports;});;

/* /mail/static/src/models/attachment_list/attachment_list.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/attachment_list/attachment_list',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{many2many,many2one,one2many,one2one}=require('@mail/model/model_field');const{clear,insertAndReplace,replace}=require('@mail/model/model_field_command');function factory(dependencies){class AttachmentList extends dependencies['mail.model']{_computeAttachments(){if(this.message){return replace(this.message.attachments);}
if(this.chatter&&this.chatter.thread){return replace(this.chatter.thread.allAttachments);}
if(this.composerView&&this.composerView.composer){return replace(this.composerView.composer.attachments);}
return clear();}
_computeAttachmentImages(){return insertAndReplace(this.imageAttachments.map(attachment=>{return{attachment:replace(attachment),};}));}
_computeAttachmentCards(){return insertAndReplace(this.nonImageAttachments.map(attachment=>{return{attachment:replace(attachment),};}));}
_computeImageAttachments(){return replace(this.attachments.filter(attachment=>attachment.isImage));}
_computeNonImageAttachments(){return replace(this.attachments.filter(attachment=>!attachment.isImage));}
_computeViewableAttachments(){return replace(this.attachments.filter(attachment=>attachment.isViewable));}}
AttachmentList.fields={attachments:many2many('mail.attachment',{compute:'_computeAttachments',inverse:'attachmentLists',}),attachmentCards:one2many('mail.attachment_card',{compute:'_computeAttachmentCards',inverse:'attachmentList',isCausal:true,}),attachmentImages:one2many('mail.attachment_image',{compute:'_computeAttachmentImages',inverse:'attachmentList',isCausal:true,}),attachmentViewer:one2many('mail.attachment_viewer',{inverse:'attachmentList',isCausal:true,}),chatter:one2one('mail.chatter',{inverse:'attachmentList',readonly:true,}),composerView:one2one('mail.composer_view',{inverse:'attachmentList',readonly:true,}),imageAttachments:many2many('mail.attachment',{compute:'_computeImageAttachments',}),message:many2one('mail.message',{related:'messageView.message'}),messageView:one2one('mail.message_view',{inverse:'attachmentList',readonly:true,}),nonImageAttachments:many2many('mail.attachment',{compute:'_computeNonImageAttachments',}),viewableAttachments:many2many('mail.attachment',{compute:'_computeViewableAttachments',}),};AttachmentList.identifyingFields=[['composerView','messageView','chatter']];AttachmentList.modelName='mail.attachment_list';return AttachmentList;}
registerNewModel('mail.attachment_list',factory);return __exports;});;

/* /mail/static/src/models/attachment_viewer/attachment_viewer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/attachment_viewer/attachment_viewer',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one,one2one}=require('@mail/model/model_field');function factory(dependencies){class AttachmentViewer extends dependencies['mail.model']{close(){const dialog=this.messaging.models['mail.dialog'].find(dialog=>dialog.record===this);if(dialog){dialog.delete();}}
_computeImageUrl(){if(!this.attachment){return;}
if(!this.attachment.accessToken&&this.attachment.originThread&&this.attachment.originThread.model==='mail.channel'){return`/mail/channel/${this.attachment.originThread.id}/image/${this.attachment.id}`;}
const accessToken=this.attachment.accessToken?`?access_token=${this.attachment.accessToken}`:'';return`/web/image/${this.attachment.id}${accessToken}`;}}
AttachmentViewer.fields={angle:attr({default:0,}),attachment:many2one('mail.attachment'),attachmentList:many2one('mail.attachment_list',{inverse:'attachmentViewer',readonly:true,required:true,}),attachments:many2many('mail.attachment',{inverse:'attachmentViewer',related:'attachmentList.viewableAttachments',}),dialog:one2one('mail.dialog',{inverse:'attachmentViewer',isCausal:true,readonly:true,}),imageUrl:attr({compute:'_computeImageUrl',readonly:true,}),isImageLoading:attr({default:false,}),scale:attr({default:1,}),};AttachmentViewer.identifyingFields=['attachmentList'];AttachmentViewer.modelName='mail.attachment_viewer';return AttachmentViewer;}
registerNewModel('mail.attachment_viewer',factory);return __exports;});;

/* /mail/static/src/models/canned_response/canned_response.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/canned_response/canned_response',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr}=require('@mail/model/model_field');const{cleanSearchTerm}=require('@mail/utils/utils');function factory(dependencies){class CannedResponse extends dependencies['mail.model']{static fetchSuggestions(searchTerm,{thread}={}){}
static getSuggestionSortFunction(searchTerm,{thread}={}){const cleanedSearchTerm=cleanSearchTerm(searchTerm);return(a,b)=>{const cleanedAName=cleanSearchTerm(a.source||'');const cleanedBName=cleanSearchTerm(b.source||'');if(cleanedAName.startsWith(cleanedSearchTerm)&&!cleanedBName.startsWith(cleanedSearchTerm)){return-1;}
if(!cleanedAName.startsWith(cleanedSearchTerm)&&cleanedBName.startsWith(cleanedSearchTerm)){return 1;}
if(cleanedAName<cleanedBName){return-1;}
if(cleanedAName>cleanedBName){return 1;}
return a.id-b.id;};}
static searchSuggestions(searchTerm,{thread}={}){const cleanedSearchTerm=cleanSearchTerm(searchTerm);return[this.messaging.cannedResponses.filter(cannedResponse=>cleanSearchTerm(cannedResponse.source).includes(cleanedSearchTerm))];}
getMentionText(){return this.substitution;}}
CannedResponse.fields={id:attr({readonly:true,required:true,}),source:attr(),substitution:attr(),};CannedResponse.identifyingFields=['id'];CannedResponse.modelName='mail.canned_response';return CannedResponse;}
registerNewModel('mail.canned_response',factory);return __exports;});;

/* /mail/static/src/models/channel_command/channel_command.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/channel_command/channel_command',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr}=require('@mail/model/model_field');const{cleanSearchTerm}=require('@mail/utils/utils');function factory(dependencies){class ChannelCommand extends dependencies['mail.model']{static fetchSuggestions(searchTerm,{thread}={}){}
static getSuggestionSortFunction(searchTerm,{thread}={}){const cleanedSearchTerm=cleanSearchTerm(searchTerm);return(a,b)=>{const isATypeSpecific=a.channel_types;const isBTypeSpecific=b.channel_types;if(isATypeSpecific&&!isBTypeSpecific){return-1;}
if(!isATypeSpecific&&isBTypeSpecific){return 1;}
const cleanedAName=cleanSearchTerm(a.name||'');const cleanedBName=cleanSearchTerm(b.name||'');if(cleanedAName.startsWith(cleanedSearchTerm)&&!cleanedBName.startsWith(cleanedSearchTerm)){return-1;}
if(!cleanedAName.startsWith(cleanedSearchTerm)&&cleanedBName.startsWith(cleanedSearchTerm)){return 1;}
if(cleanedAName<cleanedBName){return-1;}
if(cleanedAName>cleanedBName){return 1;}
return a.id-b.id;};}
static searchSuggestions(searchTerm,{thread}={}){if(thread.model!=='mail.channel'){return[[]];}
const cleanedSearchTerm=cleanSearchTerm(searchTerm);return[this.messaging.commands.filter(command=>{if(!cleanSearchTerm(command.name).includes(cleanedSearchTerm)){return false;}
if(command.channel_types){return command.channel_types.includes(thread.channel_type);}
return true;})];}
async execute({channel,body=''}){return this.env.services.rpc({model:'mail.channel',method:this.methodName,args:[[channel.id]],kwargs:{body},});}
getMentionText(){return this.name;}}
ChannelCommand.fields={channel_types:attr(),help:attr({required:true,}),methodName:attr({required:true,}),name:attr({readonly:true,required:true,}),};ChannelCommand.identifyingFields=['name'];ChannelCommand.modelName='mail.channel_command';return ChannelCommand;}
registerNewModel('mail.channel_command',factory);return __exports;});;

/* /mail/static/src/models/channel_invitation_form/channel_invitation_form.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/channel_invitation_form/channel_invitation_form',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one,one2one}=require('@mail/model/model_field');const{clear,insertAndReplace,link,replace,unlink,unlinkAll}=require('@mail/model/model_field_command');const{cleanSearchTerm}=require('@mail/utils/utils');function factory(dependencies){class ChannelInvitationForm extends dependencies['mail.model']{_created(){this.onClickInvite=this.onClickInvite.bind(this);this.onInputSearch=this.onInputSearch.bind(this);}
async onClickInvite(ev){if(this.thread.channel_type==='chat'){const partners_to=[...new Set([this.messaging.currentPartner.id,...this.thread.members.map(member=>member.id),...this.selectedPartners.map(partner=>partner.id),])];const channel=await this.messaging.models['mail.thread'].createGroupChat({partners_to});if(this.thread.rtc){await this.async(()=>channel.toggleCall({startWithVideo:!!this.thread.rtc.videoTrack,videoType:this.thread.rtc.sendUserVideo?'user-video':'display',}));}
channel.open();}else{await this.env.services.rpc(({model:'mail.channel',method:'add_members',args:[[this.thread.id]],kwargs:{partner_ids:this.selectedPartners.map(partner=>partner.id),invite_to_rtc_call:!!this.thread.rtc,},}));}
this.update({searchTerm:"",selectedPartners:unlinkAll(),});this.delete();}
onClickSelectablePartner(partner,ev){if(this.selectedPartners.includes(partner)){this.update({selectedPartners:unlink(partner)});return;}
this.update({selectedPartners:link(partner)});}
onClickSelectedPartner(partner,ev){this.update({selectedPartners:unlink(partner)});}
onComponentUpdate(){if(this.doFocusOnSearchInput&&this.searchInputRef.el){this.searchInputRef.el.focus();this.searchInputRef.el.setSelectionRange(this.searchTerm.length,this.searchTerm.length);this.update({doFocusOnSearchInput:clear()});}}
onInputPartnerCheckbox(partner,ev){if(!ev.target.checked){this.update({selectedPartners:unlink(partner)});return;}
this.update({selectedPartners:link(partner)});}
async onInputSearch(ev){this.update({searchTerm:ev.target.value});this.searchPartnersToInvite();}
async searchPartnersToInvite(){if(this.hasSearchRpcInProgress){this.update({hasPendingSearchRpc:true});return;}
this.update({hasPendingSearchRpc:false,hasSearchRpcInProgress:true,});try{const channelId=(this.thread&&this.thread.model==='mail.channel')?this.thread.id:undefined;const{count,partners:partnersData}=await this.env.services.rpc({model:'res.partner',method:'search_for_channel_invite',kwargs:{channel_id:channelId,search_term:cleanSearchTerm(this.searchTerm),},},{shadow:true});if(!this.exists()){return;}
this.update({searchResultCount:count,selectablePartners:insertAndReplace(partnersData.map(partnerData=>this.messaging.models['mail.partner'].convertData(partnerData))),});}finally{if(this.exists()){this.update({hasSearchRpcInProgress:false});if(this.hasPendingSearchRpc){this.searchPartnersToInvite();}}}}
_computeInviteButtonText(){if(!this.thread){return clear();}
switch(this.thread.channel_type){case'chat':return this.env._t("Create group chat");case'group':return this.env._t("Invite to group chat");}
return this.env._t("Invite to Channel");}
_computeThread(){if(this.threadView&&this.threadView.thread){return replace(this.threadView.thread);}
if(this.chatWindow&&this.chatWindow.thread){return replace(this.chatWindow.thread);}
return clear();}}
ChannelInvitationForm.fields={chatWindow:one2one('mail.chat_window',{inverse:'channelInvitationForm',readonly:true,}),component:attr(),doFocusOnSearchInput:attr(),hasPendingSearchRpc:attr({default:false,}),hasSearchRpcInProgress:attr({default:false,}),inviteButtonText:attr({compute:'_computeInviteButtonText',}),popoverView:one2one('mail.popover_view',{inverse:'channelInvitationForm',isCausal:true,}),searchInputRef:attr(),searchResultCount:attr({default:0,}),searchTerm:attr({default:"",}),selectablePartners:many2many('mail.partner'),selectedPartners:many2many('mail.partner'),thread:many2one('mail.thread',{compute:'_computeThread',readonly:true,required:true,}),threadView:one2one('mail.thread_view',{inverse:'channelInvitationForm',readonly:true,}),};ChannelInvitationForm.identifyingFields=[['chatWindow','threadView']];ChannelInvitationForm.modelName='mail.channel_invitation_form';return ChannelInvitationForm;}
registerNewModel('mail.channel_invitation_form',factory);return __exports;});;

/* /mail/static/src/models/chat_window/chat_window.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/chat_window/chat_window',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one,one2one}=require('@mail/model/model_field');const{clear,insertAndReplace,link,unlink}=require('@mail/model/model_field_command');const{markEventHandled}=require('@mail/utils/utils');function factory(dependencies){class ChatWindow extends dependencies['mail.model']{_created(){super._created();this.onClickHideInviteForm=this.onClickHideInviteForm.bind(this);this.onClickHideMemberList=this.onClickHideMemberList.bind(this);this.onClickShowInviteForm=this.onClickShowInviteForm.bind(this);this.onClickShowMemberList=this.onClickShowMemberList.bind(this);this.onFocusInNewMessageFormInput=this.onFocusInNewMessageFormInput.bind(this);}
close({notifyServer}={}){if(notifyServer===undefined){notifyServer=!this.messaging.device.isMobile;}
if(this.messaging.device.isMobile&&!this.messaging.discuss.isOpen){this.messaging.messagingMenu.update({isOpen:true});}
if(this.thread&&notifyServer&&!this.messaging.currentGuest){this.thread.notifyFoldStateToServer('closed');}
if(this.exists()){this.delete();}}
expand(){if(this.thread){this.thread.open({expanded:true});}}
focus(){if(!this.thread){this.update({isDoFocus:true});}
if(this.threadView&&this.threadView.composerView){this.threadView.composerView.update({doFocus:true});}}
focusNextVisibleUnfoldedChatWindow(){const nextVisibleUnfoldedChatWindow=this._getNextVisibleUnfoldedChatWindow();if(nextVisibleUnfoldedChatWindow){nextVisibleUnfoldedChatWindow.focus();}}
focusPreviousVisibleUnfoldedChatWindow(){const previousVisibleUnfoldedChatWindow=this._getNextVisibleUnfoldedChatWindow({reverse:true});if(previousVisibleUnfoldedChatWindow){previousVisibleUnfoldedChatWindow.focus();}}
fold({notifyServer}={}){if(notifyServer===undefined){notifyServer=!this.messaging.device.isMobile;}
this.update({isFolded:true});if(this.thread&&notifyServer&&!this.messaging.currentGuest){this.thread.notifyFoldStateToServer('folded');}}
makeActive(options){this.makeVisible();this.unfold(options);if((options&&options.focus!==undefined)?options.focus:!this.messaging.device.isMobileDevice){this.focus();}}
makeVisible(){if(this.isVisible){return;}
const lastVisible=this.manager.lastVisible;this.manager.swap(this,lastVisible);}
onClickHideInviteForm(ev){markEventHandled(ev,'ChatWindow.onClickCommand');this.update({channelInvitationForm:clear()});}
onClickHideMemberList(ev){markEventHandled(ev,'ChatWindow.onClickHideMemberList');this.update({isMemberListOpened:false});if(this.threadViewer.threadView){this.threadViewer.threadView.addComponentHint('member-list-hidden');}}
onClickShowInviteForm(ev){markEventHandled(ev,'ChatWindow.onClickCommand');this.update({channelInvitationForm:insertAndReplace({doFocusOnSearchInput:true,}),isMemberListOpened:false,});if(!this.messaging.isCurrentUserGuest){this.channelInvitationForm.searchPartnersToInvite();}}
onClickShowMemberList(ev){markEventHandled(ev,'ChatWindow.onClickShowMemberList');this.update({channelInvitationForm:clear(),isMemberListOpened:true,});}
onFocusInNewMessageFormInput(ev){if(this.exists()){this.update({isFocused:true});}}
shiftPrev(){this.manager.shiftPrev(this);}
shiftNext(){this.manager.shiftNext(this);}
unfold({notifyServer}={}){if(notifyServer===undefined){notifyServer=!this.messaging.device.isMobile;}
this.update({isFolded:false});if(this.thread&&notifyServer&&!this.messaging.currentGuest){this.thread.notifyFoldStateToServer('open');}}
_computeHasCallButtons(){return Boolean(this.thread)&&this.thread.rtcSessions.length===0&&['channel','chat','group'].includes(this.thread.channel_type);}
_computeHasInviteFeature(){return Boolean(this.thread&&this.thread.hasInviteFeature&&this.messaging&&this.messaging.device&&this.messaging.device.isMobile);}
_computeHasNewMessageForm(){return this.isVisible&&!this.isFolded&&!this.thread;}
_computeHasShiftPrev(){if(!this.manager){return false;}
const allVisible=this.manager.allOrderedVisible;const index=allVisible.findIndex(visible=>visible===this);if(index===-1){return false;}
return index<allVisible.length-1;}
_computeHasShiftNext(){if(!this.manager){return false;}
const index=this.manager.allOrderedVisible.findIndex(visible=>visible===this);if(index===-1){return false;}
return index>0;}
_computeHasThreadView(){return this.isVisible&&!this.isFolded&&!!this.thread&&!this.isMemberListOpened&&!this.channelInvitationForm;}
_computeIsFolded(){const thread=this.thread;if(thread){return thread.foldState==='folded';}
return this.isFolded;}
_computeIsVisible(){if(!this.manager){return false;}
return this.manager.allOrderedVisible.includes(this);}
_computeName(){if(this.thread){return this.thread.displayName;}
return this.env._t("New message");}
_computeThreadViewer(){return insertAndReplace({compact:true,hasThreadView:this.hasThreadView,thread:this.thread?link(this.thread):unlink(),});}
_computeVisibleIndex(){if(!this.manager){return clear();}
const visible=this.manager.visual.visible;const index=visible.findIndex(visible=>visible.chatWindowLocalId===this.localId);if(index===-1){return clear();}
return index;}
_computeVisibleOffset(){if(!this.manager){return 0;}
const visible=this.manager.visual.visible;const index=visible.findIndex(visible=>visible.chatWindowLocalId===this.localId);if(index===-1){return 0;}
return visible[index].offset;}
_getNextVisibleUnfoldedChatWindow({reverse=false}={}){const orderedVisible=this.manager.allOrderedVisible;const _getNextIndex=index=>{const directionOffset=reverse?1:-1;let nextIndex=index+directionOffset;if(nextIndex>orderedVisible.length-1){nextIndex=0;}
if(nextIndex<0){nextIndex=orderedVisible.length-1;}
return nextIndex;};const currentIndex=orderedVisible.findIndex(visible=>visible===this);let nextIndex=_getNextIndex(currentIndex);let nextToFocus=orderedVisible[nextIndex];while(nextToFocus.isFolded){nextIndex=_getNextIndex(nextIndex);nextToFocus=orderedVisible[nextIndex];}
return nextToFocus;}}
ChatWindow.fields={channelInvitationForm:one2one('mail.channel_invitation_form',{inverse:'chatWindow',isCausal:true,}),hasCallButtons:attr({default:false,compute:'_computeHasCallButtons',}),hasInviteFeature:attr({compute:'_computeHasInviteFeature',}),hasNewMessageForm:attr({compute:'_computeHasNewMessageForm',}),hasShiftPrev:attr({compute:'_computeHasShiftPrev',default:false,}),hasShiftNext:attr({compute:'_computeHasShiftNext',default:false,}),hasThreadView:attr({compute:'_computeHasThreadView',}),isDoFocus:attr({default:false,}),isFocused:attr({default:false,}),isFolded:attr({default:false,}),isMemberListOpened:attr({default:false,}),isVisible:attr({compute:'_computeIsVisible',}),manager:many2one('mail.chat_window_manager',{inverse:'chatWindows',readonly:true,}),managerAsNewMessage:one2one('mail.chat_window_manager',{inverse:'newMessageChatWindow',readonly:true,}),name:attr({compute:'_computeName',}),thread:one2one('mail.thread',{inverse:'chatWindow',readonly:true,}),threadView:one2one('mail.thread_view',{related:'threadViewer.threadView',}),threadViewer:one2one('mail.thread_viewer',{compute:'_computeThreadViewer',inverse:'chatWindow',isCausal:true,readonly:true,required:true,}),visibleIndex:attr({compute:'_computeVisibleIndex',}),visibleOffset:attr({compute:'_computeVisibleOffset',}),};ChatWindow.identifyingFields=['manager',['thread','managerAsNewMessage']];ChatWindow.modelName='mail.chat_window';return ChatWindow;}
registerNewModel('mail.chat_window',factory);return __exports;});;

/* /mail/static/src/models/chat_window_manager/chat_window_manager.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/chat_window_manager/chat_window_manager',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one,one2many,one2one}=require('@mail/model/model_field');const{insertAndReplace,link,replace,unlink}=require('@mail/model/model_field_command');function factory(dependencies){const BASE_VISUAL={availableVisibleSlots:0,hidden:{chatWindowLocalIds:[],isVisible:false,offset:0,},visible:[],};class ChatWindowManager extends dependencies['mail.model']{closeAll(){const chatWindows=this.allOrdered;for(const chatWindow of chatWindows){chatWindow.close();}}
closeHiddenMenu(){this.update({isHiddenMenuOpen:false});}
closeThread(thread,options){for(const chatWindow of this.chatWindows){if(chatWindow.thread===thread){chatWindow.close(options);}}}
openHiddenMenu(){this.update({isHiddenMenuOpen:true});}
openNewMessage(){if(!this.newMessageChatWindow){this.update({newMessageChatWindow:insertAndReplace({manager:replace(this)})});}
this.newMessageChatWindow.makeActive();}
openThread(thread,{focus,isFolded=false,makeActive=false,notifyServer,replaceNewMessage=false}={}){if(notifyServer===undefined){notifyServer=!this.messaging.device.isMobile;}
let chatWindow=this.chatWindows.find(chatWindow=>chatWindow.thread===thread);if(!chatWindow){chatWindow=this.messaging.models['mail.chat_window'].create({isFolded,manager:link(this),thread:link(thread),});}else{chatWindow.update({isFolded});}
if(replaceNewMessage&&this.newMessageChatWindow){this.swap(chatWindow,this.newMessageChatWindow);this.newMessageChatWindow.close();}
if(makeActive){chatWindow.makeActive({focus,notifyServer:false});}
if(notifyServer&&!this.messaging.currentGuest){const foldState=chatWindow.isFolded?'folded':'open';thread.notifyFoldStateToServer(foldState);}}
shiftPrev(chatWindow){const chatWindows=this.allOrdered;const index=chatWindows.findIndex(cw=>cw===chatWindow);if(index===chatWindows.length-1){return;}
const otherChatWindow=chatWindows[index+1];const _newOrdered=[...this.allOrdered];_newOrdered[index]=otherChatWindow;_newOrdered[index+1]=chatWindow;this.update({allOrdered:replace(_newOrdered)});chatWindow.focus();}
shiftNext(chatWindow){const chatWindows=this.allOrdered;const index=chatWindows.findIndex(cw=>cw===chatWindow);if(index===0){return;}
const otherChatWindow=chatWindows[index-1];const _newOrdered=[...this.allOrdered];_newOrdered[index]=otherChatWindow;_newOrdered[index-1]=chatWindow;this.update({allOrdered:replace(_newOrdered)});chatWindow.focus();}
swap(chatWindow1,chatWindow2){const ordered=this.allOrdered;const index1=ordered.findIndex(chatWindow=>chatWindow===chatWindow1);const index2=ordered.findIndex(chatWindow=>chatWindow===chatWindow2);if(index1===-1||index2===-1){return;}
const _newOrdered=[...this.allOrdered];_newOrdered[index1]=chatWindow2;_newOrdered[index2]=chatWindow1;this.update({allOrdered:replace(_newOrdered)});}
_computeAllOrdered(){return link(this.chatWindows);}
_computeAllOrderedHidden(){return replace(this.visual.hidden.chatWindowLocalIds.map(chatWindowLocalId=>this.messaging.models['mail.chat_window'].get(chatWindowLocalId)));}
_computeAllOrderedVisible(){return replace(this.visual.visible.map(({chatWindowLocalId})=>this.messaging.models['mail.chat_window'].get(chatWindowLocalId)));}
_computeHasHiddenChatWindows(){return this.allOrderedHidden.length>0;}
_computeHasVisibleChatWindows(){return this.allOrderedVisible.length>0;}
_computeLastVisible(){const{length:l,[l-1]:lastVisible}=this.allOrderedVisible;if(!lastVisible){return unlink();}
return link(lastVisible);}
_computeUnreadHiddenConversationAmount(){const allHiddenWithThread=this.allOrderedHidden.filter(chatWindow=>chatWindow.thread);let amount=0;for(const chatWindow of allHiddenWithThread){if(chatWindow.thread.localMessageUnreadCounter>0){amount++;}}
return amount;}
_computeVisual(){let visual=JSON.parse(JSON.stringify(BASE_VISUAL));if(!this.messaging||!this.messaging.device){return visual;}
const device=this.messaging.device;const discuss=this.messaging.discuss;const BETWEEN_GAP_WIDTH=5;const CHAT_WINDOW_WIDTH=325;const END_GAP_WIDTH=device.isMobile?0:10;const GLOBAL_WINDOW_WIDTH=device.globalWindowInnerWidth;const HIDDEN_MENU_WIDTH=200;const START_GAP_WIDTH=device.isMobile?0:10;const chatWindows=this.allOrdered;if(!device.isMobile&&discuss.isOpen){return visual;}
if(!chatWindows.length){return visual;}
const relativeGlobalWindowWidth=GLOBAL_WINDOW_WIDTH-START_GAP_WIDTH-END_GAP_WIDTH;let maxAmountWithoutHidden=Math.floor(relativeGlobalWindowWidth/(CHAT_WINDOW_WIDTH+BETWEEN_GAP_WIDTH));let maxAmountWithHidden=Math.floor((relativeGlobalWindowWidth-HIDDEN_MENU_WIDTH-BETWEEN_GAP_WIDTH)/(CHAT_WINDOW_WIDTH+BETWEEN_GAP_WIDTH));if(device.isMobile){maxAmountWithoutHidden=1;maxAmountWithHidden=1;}
if(chatWindows.length<=maxAmountWithoutHidden){for(let i=0;i<chatWindows.length;i++){const chatWindowLocalId=chatWindows[i].localId;const offset=START_GAP_WIDTH+i*(CHAT_WINDOW_WIDTH+BETWEEN_GAP_WIDTH);visual.visible.push({chatWindowLocalId,offset});}
visual.availableVisibleSlots=maxAmountWithoutHidden;}else if(maxAmountWithHidden>0){for(let i=0;i<maxAmountWithHidden;i++){const chatWindowLocalId=chatWindows[i].localId;const offset=START_GAP_WIDTH+i*(CHAT_WINDOW_WIDTH+BETWEEN_GAP_WIDTH);visual.visible.push({chatWindowLocalId,offset});}
if(chatWindows.length>maxAmountWithHidden){visual.hidden.isVisible=!device.isMobile;visual.hidden.offset=visual.visible[maxAmountWithHidden-1].offset
+CHAT_WINDOW_WIDTH+BETWEEN_GAP_WIDTH;}
for(let j=maxAmountWithHidden;j<chatWindows.length;j++){visual.hidden.chatWindowLocalIds.push(chatWindows[j].localId);}
visual.availableVisibleSlots=maxAmountWithHidden;}else{visual.hidden.isVisible=!device.isMobile;visual.hidden.offset=START_GAP_WIDTH;visual.hidden.chatWindowLocalIds.concat(chatWindows.map(chatWindow=>chatWindow.localId));console.warn('cannot display any visible chat windows (screen is too small)');visual.availableVisibleSlots=0;}
return visual;}}
ChatWindowManager.fields={allOrdered:one2many('mail.chat_window',{compute:'_computeAllOrdered',}),allOrderedHidden:one2many('mail.chat_window',{compute:'_computeAllOrderedHidden',}),allOrderedVisible:one2many('mail.chat_window',{compute:'_computeAllOrderedVisible',}),chatWindows:one2many('mail.chat_window',{inverse:'manager',isCausal:true,}),hasHiddenChatWindows:attr({compute:'_computeHasHiddenChatWindows',}),hasVisibleChatWindows:attr({compute:'_computeHasVisibleChatWindows',}),isHiddenMenuOpen:attr({default:false,}),lastVisible:many2one('mail.chat_window',{compute:'_computeLastVisible',}),newMessageChatWindow:one2one('mail.chat_window',{inverse:'managerAsNewMessage',isCausal:true,}),unreadHiddenConversationAmount:attr({compute:'_computeUnreadHiddenConversationAmount',}),visual:attr({compute:'_computeVisual',default:BASE_VISUAL,}),};ChatWindowManager.identifyingFields=['messaging'];ChatWindowManager.modelName='mail.chat_window_manager';return ChatWindowManager;}
registerNewModel('mail.chat_window_manager',factory);return __exports;});;

/* /mail/static/src/models/chatter/chatter.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/chatter/chatter',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one,one2one}=require('@mail/model/model_field');const{clear,insert,insertAndReplace,link,unlink}=require('@mail/model/model_field_command');const{OnChange}=require('@mail/model/model_onchange');function factory(dependencies){const getThreadNextTemporaryId=(function(){let tmpId=0;return()=>{tmpId-=1;return tmpId;};})();const getMessageNextTemporaryId=(function(){let tmpId=0;return()=>{tmpId-=1;return tmpId;};})();class Chatter extends dependencies['mail.model']{_created(){this._attachmentsLoaderTimeout=undefined;this._isPreparingAttachmentsLoading=undefined;this.onClickActivityBoxTitle=this.onClickActivityBoxTitle.bind(this);this.onClickButtonAttachments=this.onClickButtonAttachments.bind(this);this.onClickChatterTopbarClose=this.onClickChatterTopbarClose.bind(this);this.onClickLogNote=this.onClickLogNote.bind(this);this.onClickScheduleActivity=this.onClickScheduleActivity.bind(this);this.onClickSendMessage=this.onClickSendMessage.bind(this);this.onScrollScrollPanel=this.onScrollScrollPanel.bind(this);}
_willDelete(){this._stopAttachmentsLoading();return super._willDelete(...arguments);}
focus(){if(this.composerView){this.composerView.update({doFocus:true});}}
onClickActivityBoxTitle(ev){this.update({isActivityBoxVisible:!this.isActivityBoxVisible});}
onClickButtonAttachments(ev){this.update({isAttachmentBoxVisible:!this.isAttachmentBoxVisible});}
onClickChatterTopbarClose(ev){this.componentChatterTopbar.trigger('o-close-chatter');}
onClickLogNote(){if(this.composerView&&this.composerView.composer.isLog){this.update({composerView:clear()});}else{this.showLogNote();}}
onClickScheduleActivity(ev){const action={type:'ir.actions.act_window',name:this.env._t("Schedule Activity"),res_model:'mail.activity',view_mode:'form',views:[[false,'form']],target:'new',context:{default_res_id:this.thread.id,default_res_model:this.thread.model,},res_id:false,};return this.env.bus.trigger('do-action',{action,options:{on_close:()=>{if(!this.componentChatterTopbar){return;}
this.componentChatterTopbar.trigger('reload',{keepChanges:true});},},});}
onClickSendMessage(ev){if(this.composerView&&!this.composerView.composer.isLog){this.update({composerView:clear()});}else{this.showSendMessage();}}
onScrollScrollPanel(ev){if(!this.threadRef.comp){return;}
this.threadRef.comp.onScroll(ev);}
async refresh(){if(this.hasActivities){this.thread.refreshActivities();}
if(this.hasFollowers){this.thread.refreshFollowers();this.thread.fetchAndUpdateSuggestedRecipients();}
if(this.hasMessageList){this.thread.refresh();}}
showLogNote(){this.update({composerView:insertAndReplace()});this.composerView.composer.update({isLog:true});this.focus();}
showSendMessage(){this.update({composerView:insertAndReplace()});this.composerView.composer.update({isLog:false});this.focus();}
_computeAttachmentList(){return(this.thread&&this.thread.allAttachments.length>0)?insertAndReplace():clear();}
_computeHasThreadView(){return Boolean(this.thread&&this.hasMessageList);}
_computeIsDisabled(){return Boolean(!this.thread||this.thread.isTemporary);}
_computeThreadViewer(){return insertAndReplace({hasThreadView:this.hasThreadView,order:'desc',thread:this.thread?link(this.thread):unlink(),});}
_onThreadIdOrThreadModelChanged(){if(this.threadId){if(this.thread&&this.thread.isTemporary){this.thread.delete();}
this.update({isAttachmentBoxVisible:this.isAttachmentBoxVisibleInitially,thread:insert({hasActivities:this.hasActivities?true:undefined,id:this.threadId,model:this.threadModel,}),});if(this.hasActivities){this.thread.refreshActivities();}
if(this.hasFollowers){this.thread.refreshFollowers();this.thread.fetchAndUpdateSuggestedRecipients();}
if(this.hasMessageList){this.thread.refresh();}}else if(!this.thread||!this.thread.isTemporary){const currentPartner=this.messaging.currentPartner;const message=this.messaging.models['mail.message'].create({author:link(currentPartner),body:this.env._t("Creating a new record..."),id:getMessageNextTemporaryId(),isTemporary:true,});const nextId=getThreadNextTemporaryId();this.update({isAttachmentBoxVisible:false,thread:insert({areAttachmentsLoaded:true,id:nextId,isTemporary:true,model:this.threadModel,}),});this.thread.cache.update({messages:link(message)});}}
_onThreadIsLoadingAttachmentsChanged(){if(!this.thread||!this.thread.isLoadingAttachments){this._stopAttachmentsLoading();this.update({isShowingAttachmentsLoading:false});return;}
if(this._isPreparingAttachmentsLoading||this.isShowingAttachmentsLoading){return;}
this._prepareAttachmentsLoading();}
_prepareAttachmentsLoading(){this._isPreparingAttachmentsLoading=true;this._attachmentsLoaderTimeout=this.env.browser.setTimeout(()=>{this.update({isShowingAttachmentsLoading:true});this._isPreparingAttachmentsLoading=false;},this.messaging.loadingBaseDelayDuration);}
_stopAttachmentsLoading(){this.env.browser.clearTimeout(this._attachmentsLoaderTimeout);this._attachmentsLoaderTimeout=null;this._isPreparingAttachmentsLoading=false;}}
Chatter.fields={attachmentList:one2one('mail.attachment_list',{compute:'_computeAttachmentList',inverse:'chatter',isCausal:true,readonly:true,}),componentChatterTopbar:attr(),composerView:one2one('mail.composer_view',{inverse:'chatter',isCausal:true,}),context:attr({default:{},}),hasActivities:attr({default:true,}),hasExternalBorder:attr({default:true,}),hasFollowers:attr({default:true,}),hasMessageList:attr({default:true,}),hasMessageListScrollAdjust:attr({default:false,}),hasThreadView:attr({compute:'_computeHasThreadView',}),hasTopbarCloseButton:attr({default:false,}),id:attr({readonly:true,required:true,}),isActivityBoxVisible:attr({default:true,}),isAttachmentBoxVisible:attr({default:false,}),isAttachmentBoxVisibleInitially:attr({default:false,}),isDisabled:attr({compute:'_computeIsDisabled',default:false,}),isShowingAttachmentsLoading:attr({default:false,}),thread:many2one('mail.thread'),threadId:attr(),threadModel:attr(),threadRef:attr(),threadView:one2one('mail.thread_view',{related:'threadViewer.threadView',}),threadViewer:one2one('mail.thread_viewer',{compute:'_computeThreadViewer',inverse:'chatter',isCausal:true,readonly:true,required:true,}),};Chatter.identifyingFields=['id'];Chatter.onChanges=[new OnChange({dependencies:['threadId','threadModel'],methodName:'_onThreadIdOrThreadModelChanged',}),new OnChange({dependencies:['thread.isLoadingAttachments'],methodName:'_onThreadIsLoadingAttachmentsChanged',}),];Chatter.modelName='mail.chatter';return Chatter;}
registerNewModel('mail.chatter',factory);return __exports;});;

/* /mail/static/src/models/composer/composer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/composer/composer',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one,one2many,one2one}=require('@mail/model/model_field');const{clear,replace,unlink}=require('@mail/model/model_field_command');function factory(dependencies){class Composer extends dependencies['mail.model']{_computeActiveThread(){if(this.messageViewInEditing&&this.messageViewInEditing.message&&this.messageViewInEditing.message.originThread){return replace(this.messageViewInEditing.message.originThread);}
if(this.thread){return replace(this.thread);}
return clear();}
_computeCanPostMessage(){if(this.thread&&!this.textInputContent&&this.attachments.length===0){return false;}
return!this.hasUploadingAttachment&&!this.isPostingMessage;}
_computeHasUploadingAttachment(){return this.attachments.some(attachment=>attachment.isUploading);}
_computeMentionedPartners(){const unmentionedPartners=[];const namesIndex={};for(const partner of this.mentionedPartners){const fromIndex=namesIndex[partner.name]!==undefined?namesIndex[partner.name]+1:0;const index=this.textInputContent.indexOf(`@${partner.name}`,fromIndex);if(index!==-1){namesIndex[partner.name]=index;}else{unmentionedPartners.push(partner);}}
return unlink(unmentionedPartners);}
_computeMentionedChannels(){const unmentionedChannels=[];const namesIndex={};for(const channel of this.mentionedChannels){const fromIndex=namesIndex[channel.name]!==undefined?namesIndex[channel.name]+1:0;const index=this.textInputContent.indexOf(`#${channel.name}`,fromIndex);if(index!==-1){namesIndex[channel.name]=index;}else{unmentionedChannels.push(channel);}}
return unlink(unmentionedChannels);}
_computeRecipients(){const recipients=[...this.mentionedPartners];if(this.activeThread&&!this.isLog){for(const recipient of this.activeThread.suggestedRecipientInfoList){if(recipient.partner&&recipient.isSelected){recipients.push(recipient.partner);}}}
return replace(recipients);}
_reset(){this.update({attachments:clear(),isLastStateChangeProgrammatic:true,mentionedChannels:clear(),mentionedPartners:clear(),textInputContent:clear(),textInputCursorEnd:clear(),textInputCursorStart:clear(),textInputSelectionDirection:clear(),});}}
Composer.fields={activeThread:many2one('mail.thread',{compute:'_computeActiveThread',readonly:true,required:true,}),attachments:one2many('mail.attachment',{inverse:'composer',}),canPostMessage:attr({compute:'_computeCanPostMessage',default:false,}),composerViews:one2many('mail.composer_view',{inverse:'composer',isCausal:true,}),hasUploadingAttachment:attr({compute:'_computeHasUploadingAttachment',}),isLastStateChangeProgrammatic:attr({default:false,}),isLog:attr({default:true,}),isPostingMessage:attr(),mentionedChannels:many2many('mail.thread',{compute:'_computeMentionedChannels',}),mentionedPartners:many2many('mail.partner',{compute:'_computeMentionedPartners',}),messageViewInEditing:one2one('mail.message_view',{inverse:'composerForEditing',readonly:true,}),recipients:many2many('mail.partner',{compute:'_computeRecipients',}),textInputContent:attr({default:"",}),textInputCursorEnd:attr({default:0,}),textInputCursorStart:attr({default:0,}),textInputSelectionDirection:attr({default:"none",}),thread:one2one('mail.thread',{inverse:'composer',readonly:true,}),};Composer.identifyingFields=[['thread','messageViewInEditing']];Composer.modelName='mail.composer';return Composer;}
registerNewModel('mail.composer',factory);return __exports;});;

/* /mail/static/src/models/composer_view/composer_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/composer_view/composer_view',async function(require){'use strict';let __exports={};const{emojis}=require('@mail/js/emojis');const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one,one2one}=require('@mail/model/model_field');const{clear,insertAndReplace,link,replace,unlink,unlinkAll}=require('@mail/model/model_field_command');const{OnChange}=require('@mail/model/model_onchange');const{addLink,escapeAndCompactTextContent,parseAndTransform}=require('@mail/js/utils');function factory(dependencies){class ComposerView extends dependencies['mail.model']{_willCreate(){const res=super._willCreate(...arguments);this._hasMentionRpcInProgress=false;this._nextMentionRpcFunction=undefined;return res;}
_created(){this.onClickCancelLink=this.onClickCancelLink.bind(this);this.onClickSaveLink=this.onClickSaveLink.bind(this);this.onClickStopReplying=this.onClickStopReplying.bind(this);}
_willDelete(){this._nextMentionRpcFunction=undefined;return super._willDelete(...arguments);}
closeSuggestions(){this.update({suggestionDelimiterPosition:clear()});}
discard(){if(this.messageViewInEditing){this.messageViewInEditing.stopEditing();}
if(this.threadView&&this.threadView.replyingToMessageView){const{threadView}=this;if(this.threadView.thread===this.messaging.inbox){this.delete();}
threadView.update({replyingToMessageView:clear()});}}
handleCurrentPartnerIsTyping(){if(!this.composer.thread){return;}
if(this.messaging.isCurrentUserGuest){return;}
if(this.suggestionModelName==='mail.channel_command'||this._getCommandFromText(this.composer.textInputContent)){return;}
if(this.composer.thread.typingMembers.includes(this.messaging.currentPartner)){this.composer.thread.refreshCurrentPartnerIsTyping();}else{this.composer.thread.registerCurrentPartnerIsTyping();}}
insertIntoTextInput(content){const partA=this.composer.textInputContent.slice(0,this.composer.textInputCursorStart);const partB=this.composer.textInputContent.slice(this.composer.textInputCursorEnd,this.composer.textInputContent.length);let suggestionDelimiterPosition=this.suggestionDelimiterPosition;if(suggestionDelimiterPosition!==undefined&&suggestionDelimiterPosition>=this.composer.textInputCursorStart){suggestionDelimiterPosition=suggestionDelimiterPosition+content.length;}
this.composer.update({isLastStateChangeProgrammatic:true,textInputContent:partA+content+partB,textInputCursorEnd:this.composer.textInputCursorStart+content.length,textInputCursorStart:this.composer.textInputCursorStart+content.length,});this.update({suggestionDelimiterPosition});}
insertSuggestion(){const cursorPosition=this.composer.textInputCursorStart;let textLeft=this.composer.textInputContent.substring(0,this.suggestionDelimiterPosition+1);let textRight=this.composer.textInputContent.substring(cursorPosition,this.composer.textInputContent.length);if(this.suggestionDelimiter===':'){textLeft=this.composer.textInputContent.substring(0,this.suggestionDelimiterPosition);textRight=this.composer.textInputContent.substring(cursorPosition,this.composer.textInputContent.length);}
const recordReplacement=this.activeSuggestedRecord.getMentionText();const updateData={isLastStateChangeProgrammatic:true,textInputContent:textLeft+recordReplacement+' '+textRight,textInputCursorEnd:textLeft.length+recordReplacement.length+1,textInputCursorStart:textLeft.length+recordReplacement.length+1,};switch(this.activeSuggestedRecord.constructor.modelName){case'mail.thread':Object.assign(updateData,{mentionedChannels:link(this.activeSuggestedRecord)});break;case'mail.partner':Object.assign(updateData,{mentionedPartners:link(this.activeSuggestedRecord)});break;}
this.composer.update(updateData);}
onClickCancelLink(ev){ev.preventDefault();this.discard();}
onClickSaveLink(ev){ev.preventDefault();if(!this.composer.canPostMessage){if(this.composer.hasUploadingAttachment){this.env.services['notification'].notify({message:this.env._t("Please wait while the file is uploading."),type:'warning',});}
return;}
if(this.messageViewInEditing){this.updateMessage();return;}
this.postMessage();}
onClickStopReplying(ev){this.threadView.update({replyingToMessageView:clear(),});}
async openFullComposer(){const attachmentIds=this.composer.attachments.map(attachment=>attachment.id);const context={default_attachment_ids:attachmentIds,default_body:escapeAndCompactTextContent(this.composer.textInputContent),default_is_log:this.composer.isLog,default_model:this.composer.activeThread.model,default_partner_ids:this.composer.recipients.map(partner=>partner.id),default_res_id:this.composer.activeThread.id,mail_post_autofollow:true,};const action={type:'ir.actions.act_window',res_model:'mail.compose.message',view_mode:'form',views:[[false,'form']],target:'new',context:context,};const composer=this.composer;const options={on_close:()=>{if(!composer.exists()){return;}
composer._reset();if(composer.activeThread){composer.activeThread.loadNewMessages();}},};await this.env.bus.trigger('do-action',{action,options});}
async postMessage(){const composer=this.composer;if(composer.thread.model==='mail.channel'){const command=this._getCommandFromText(composer.textInputContent);if(command){await command.execute({channel:composer.thread,body:composer.textInputContent});if(composer.exists()){composer._reset();}
return;}}
if(this.messaging.currentPartner){composer.thread.unregisterCurrentPartnerIsTyping({immediateNotify:true});}
const escapedAndCompactContent=escapeAndCompactTextContent(composer.textInputContent);let body=escapedAndCompactContent.replace(/&nbsp;/g,' ').trim();body=this._generateMentionsLinks(body);body=parseAndTransform(body,addLink);body=this._generateEmojisOnHtml(body);const postData={attachment_ids:composer.attachments.map(attachment=>attachment.id),body,message_type:'comment',partner_ids:composer.recipients.map(partner=>partner.id),};const params={'post_data':postData,'thread_id':composer.thread.id,'thread_model':composer.thread.model,};try{composer.update({isPostingMessage:true});if(composer.thread.model==='mail.channel'){Object.assign(postData,{subtype_xmlid:'mail.mt_comment',});}else{Object.assign(postData,{subtype_xmlid:composer.isLog?'mail.mt_note':'mail.mt_comment',});if(!composer.isLog){params.context={mail_post_autofollow:true};}}
if(this.threadView&&this.threadView.replyingToMessageView&&this.threadView.thread!==this.messaging.inbox){postData.parent_id=this.threadView.replyingToMessageView.message.id;}
const{threadView={}}=this;const{thread:chatterThread}=this.chatter||{};const{thread:threadViewThread}=threadView;const messageData=await this.env.services.rpc({route:`/mail/message/post`,params});if(!this.messaging){return;}
const message=this.messaging.models['mail.message'].insert(this.messaging.models['mail.message'].convertData(messageData));for(const threadView of message.originThread.threadViews){threadView.update({hasAutoScrollOnMessageReceived:true});}
if(chatterThread){if(this.exists()){this.delete();}
if(chatterThread.exists()){chatterThread.refreshFollowers();chatterThread.fetchAndUpdateSuggestedRecipients();}}
if(threadViewThread){if(threadViewThread===this.messaging.inbox){if(this.exists()){this.delete();}
this.env.services['notification'].notify({message:_.str.sprintf(this.env._t(`Message posted on "%s"`),message.originThread.displayName),type:'info',});}
if(threadView&&threadView.exists()){threadView.update({replyingToMessageView:clear()});}}
if(composer.exists()){composer._reset();}}finally{if(composer.exists()){composer.update({isPostingMessage:false});}}}
setFirstSuggestionActive(){const suggestedRecords=this.mainSuggestedRecords.concat(this.extraSuggestedRecords);const firstRecord=suggestedRecords[0];this.update({activeSuggestedRecord:link(firstRecord)});}
setLastSuggestionActive(){const suggestedRecords=this.mainSuggestedRecords.concat(this.extraSuggestedRecords);const{length,[length-1]:lastRecord}=suggestedRecords;this.update({activeSuggestedRecord:link(lastRecord)});}
setNextSuggestionActive(){const suggestedRecords=this.mainSuggestedRecords.concat(this.extraSuggestedRecords);const activeElementIndex=suggestedRecords.findIndex(suggestion=>suggestion===this.activeSuggestedRecord);if(activeElementIndex===suggestedRecords.length-1){this.setFirstSuggestionActive();return;}
const nextRecord=suggestedRecords[activeElementIndex+1];this.update({activeSuggestedRecord:link(nextRecord)});}
setPreviousSuggestionActive(){const suggestedRecords=this.mainSuggestedRecords.concat(this.extraSuggestedRecords);const activeElementIndex=suggestedRecords.findIndex(suggestion=>suggestion===this.activeSuggestedRecord);if(activeElementIndex===0){this.setLastSuggestionActive();return;}
const previousRecord=suggestedRecords[activeElementIndex-1];this.update({activeSuggestedRecord:link(previousRecord)});}
async updateMessage(){const composer=this.composer;if(!composer.textInputContent){this.messageViewInEditing.messageActionList.update({showDeleteConfirm:true});return;}
const escapedAndCompactContent=escapeAndCompactTextContent(composer.textInputContent);let body=escapedAndCompactContent.replace(/&nbsp;/g,' ').trim();body=this._generateMentionsLinks(body);body=parseAndTransform(body,addLink);body=this._generateEmojisOnHtml(body);let data={body:body,attachment_ids:composer.attachments.concat(this.messageViewInEditing.message.attachments).map(attachment=>attachment.id),};try{composer.update({isPostingMessage:true});const messageViewInEditing=this.messageViewInEditing;await messageViewInEditing.message.updateContent(data);if(messageViewInEditing.exists()){messageViewInEditing.stopEditing();}}finally{if(composer.exists()){composer.update({isPostingMessage:false});}}}
_computeActiveSuggestedRecord(){if(this.mainSuggestedRecords.length===0&&this.extraSuggestedRecords.length===0){return unlink();}
if(this.mainSuggestedRecords.includes(this.activeSuggestedRecord)||this.extraSuggestedRecords.includes(this.activeSuggestedRecord)){return;}
const suggestedRecords=this.mainSuggestedRecords.concat(this.extraSuggestedRecords);const firstRecord=suggestedRecords[0];return link(firstRecord);}
_computeAttachmentList(){return(this.composer&&this.composer.attachments.length>0)?insertAndReplace():clear();}
_computeComposer(){if(this.threadView){if(this.threadView&&this.threadView.replyingToMessageView){return replace(this.threadView.replyingToMessageView.message.originThread.composer);}
if(this.threadView.thread&&this.threadView.thread.composer){return replace(this.threadView.thread.composer);}}
if(this.messageViewInEditing&&this.messageViewInEditing.composerForEditing){return replace(this.messageViewInEditing.composerForEditing);}
if(this.chatter&&this.chatter.thread&&this.chatter.thread.composer){return replace(this.chatter.thread.composer);}
return clear();}
_computeExtraSuggestedRecords(){if(this.suggestionDelimiterPosition===undefined){return unlinkAll();}
return unlink(this.mainSuggestedRecords);}
_computeHasSuggestions(){return this.mainSuggestedRecords.length>0||this.extraSuggestedRecords.length>0;}
_computeMainSuggestedRecords(){if(this.suggestionDelimiterPosition===undefined){return unlinkAll();}}
_computeSendButtonText(){if(this.composer&&this.composer.isLog&&this.composer.activeThread&&this.composer.activeThread.model!=='mail.channel'){return this.env._t("Log");}
return this.env._t("Send");}
_computeSuggestionDelimiter(){if(!this.composer||this.suggestionDelimiterPosition===undefined||this.suggestionDelimiterPosition>=this.composer.textInputContent.length){return clear();}
return this.composer.textInputContent[this.suggestionDelimiterPosition];}
_computeSuggestionModelName(){switch(this.suggestionDelimiter){case'@':return'mail.partner';case':':return'mail.canned_response';case'/':return'mail.channel_command';case'#':return'mail.thread';default:return clear();}}
_computeSuggestionSearchTerm(){if(!this.composer||this.suggestionDelimiterPosition===undefined||this.suggestionDelimiterPosition>=this.composer.textInputCursorStart){return clear();}
return this.composer.textInputContent.substring(this.suggestionDelimiterPosition+1,this.composer.textInputCursorStart);}
async _executeOrQueueFunction(func){if(this._hasMentionRpcInProgress){this._nextMentionRpcFunction=func;return;}
this._hasMentionRpcInProgress=true;this._nextMentionRpcFunction=undefined;await func();if(this.exists()){this._hasMentionRpcInProgress=false;if(this._nextMentionRpcFunction){this._executeOrQueueFunction(this._nextMentionRpcFunction);}}}
_generateEmojisOnHtml(htmlString){for(const emoji of emojis){for(const source of emoji.sources){const escapedSource=String(source).replace(/([.*+?=^!:${}()|[\]/\\])/g,'\\$1');const regexp=new RegExp('(\\s|^)('+escapedSource+')(?=\\s|$)','g');htmlString=htmlString.replace(regexp,'$1'+emoji.unicode);}}
return htmlString;}
_generateMentionsLinks(body){const mentions=[];for(const partner of this.composer.mentionedPartners){const placeholder=`@-mention-partner-${partner.id}`;const text=`@${owl.utils.escape(partner.name)}`;mentions.push({class:'o_mail_redirect',id:partner.id,model:'res.partner',placeholder,text,});body=body.replace(text,placeholder);}
for(const channel of this.composer.mentionedChannels){const placeholder=`#-mention-channel-${channel.id}`;const text=`#${owl.utils.escape(channel.name)}`;mentions.push({class:'o_channel_redirect',id:channel.id,model:'mail.channel',placeholder,text,});body=body.replace(text,placeholder);}
const baseHREF=this.env.session.url('/web');for(const mention of mentions){const href=`href='${baseHREF}#model=${mention.model}&id=${mention.id}'`;const attClass=`class='${mention.class}'`;const dataOeId=`data-oe-id='${mention.id}'`;const dataOeModel=`data-oe-model='${mention.model}'`;const target=`target='_blank'`;const link=`<a ${href} ${attClass} ${dataOeId} ${dataOeModel} ${target}>${mention.text}</a>`;body=body.replace(mention.placeholder,link);}
return body;}
_getCommandFromText(content){if(content.startsWith('/')){const firstWord=content.substring(1).split(/\s/)[0];return this.messaging.commands.find(command=>{if(command.name!==firstWord){return false;}
if(command.channel_types){return command.channel_types.includes(this.composer.thread.channel_type);}
return true;});}
return undefined;}
_onChangeComposer(){this.composer.update({isLastStateChangeProgrammatic:true});}
_onChangeDetectSuggestionDelimiterPosition(){if(!this.composer){return;}
if(this.composer.textInputCursorStart!==this.composer.textInputCursorEnd){return this.update({suggestionDelimiterPosition:clear()});}
const candidatePositions=[];if(this.suggestionDelimiterPosition!==undefined&&this.suggestionDelimiterPosition<this.composer.textInputCursorStart){candidatePositions.push(this.suggestionDelimiterPosition);}
if(this.composer.textInputCursorStart>0){candidatePositions.push(this.composer.textInputCursorStart-1);}
const suggestionDelimiters=['@',':','#','/'];for(const candidatePosition of candidatePositions){if(candidatePosition<0||candidatePosition>=this.composer.textInputContent.length){continue;}
const candidateChar=this.composer.textInputContent[candidatePosition];if(candidateChar==='/'&&candidatePosition!==0){continue;}
if(!suggestionDelimiters.includes(candidateChar)){continue;}
const charBeforeCandidate=this.composer.textInputContent[candidatePosition-1];if(charBeforeCandidate&&!/\s/.test(charBeforeCandidate)){continue;}
this.update({suggestionDelimiterPosition:candidatePosition});return;}
return this.update({suggestionDelimiterPosition:clear()});}
_onChangeUpdateSuggestionList(){if(this.messaging.isCurrentUserGuest){return;}
this._updateSuggestionList();this._executeOrQueueFunction(async()=>{if(!this.exists()||this.suggestionDelimiterPosition===undefined||this.suggestionSearchTerm===undefined||!this.suggestionModelName){return;}
const Model=this.messaging.models[this.suggestionModelName];const searchTerm=this.suggestionSearchTerm;await this.async(()=>Model.fetchSuggestions(searchTerm,{thread:this.composer.activeThread}));if(!this.exists()){return;}
this._updateSuggestionList();if(this.suggestionSearchTerm&&this.suggestionSearchTerm===searchTerm&&this.suggestionModelName&&this.messaging.models[this.suggestionModelName]===Model&&!this.hasSuggestions){this.closeSuggestions();}});}
_updateSuggestionList(){if(this.suggestionDelimiterPosition===undefined||this.suggestionSearchTerm===undefined||!this.suggestionModelName){return;}
const Model=this.messaging.models[this.suggestionModelName];const[mainSuggestedRecords,extraSuggestedRecords=[],]=Model.searchSuggestions(this.suggestionSearchTerm,{thread:this.composer.activeThread});const sortFunction=Model.getSuggestionSortFunction(this.suggestionSearchTerm,{thread:this.composer.activeThread});mainSuggestedRecords.sort(sortFunction);extraSuggestedRecords.sort(sortFunction);const limit=8;mainSuggestedRecords.length=Math.min(mainSuggestedRecords.length,limit);extraSuggestedRecords.length=Math.min(extraSuggestedRecords.length,limit-mainSuggestedRecords.length);this.update({extraSuggestedRecords:replace(extraSuggestedRecords),hasToScrollToActiveSuggestion:true,mainSuggestedRecords:replace(mainSuggestedRecords),});}}
ComposerView.fields={activeSuggestedRecord:many2one('mail.model',{compute:'_computeActiveSuggestedRecord',}),attachmentList:one2one('mail.attachment_list',{compute:'_computeAttachmentList',inverse:'composerView',isCausal:true,readonly:true,}),chatter:one2one('mail.chatter',{inverse:'composerView',readonly:true,}),composer:many2one('mail.composer',{compute:'_computeComposer',inverse:'composerViews',required:true,}),doFocus:attr(),extraSuggestedRecords:many2many('mail.model',{compute:'_computeExtraSuggestedRecords',}),hasFocus:attr({default:false,}),hasSuggestions:attr({compute:'_computeHasSuggestions',default:false,}),hasToScrollToActiveSuggestion:attr({default:false,}),mainSuggestedRecords:many2many('mail.model',{compute:'_computeMainSuggestedRecords',}),messageViewInEditing:one2one('mail.message_view',{inverse:'composerViewInEditing',readonly:true,}),sendButtonText:attr({compute:'_computeSendButtonText',}),suggestionDelimiter:attr({compute:'_computeSuggestionDelimiter',}),suggestionDelimiterPosition:attr(),suggestionModelName:attr({compute:'_computeSuggestionModelName',}),suggestionSearchTerm:attr({compute:'_computeSuggestionSearchTerm',}),threadView:one2one('mail.thread_view',{inverse:'composerView',readonly:true,}),};ComposerView.identifyingFields=[['threadView','messageViewInEditing','chatter']];ComposerView.onChanges=[new OnChange({dependencies:['composer'],methodName:'_onChangeComposer',}),new OnChange({dependencies:['composer.textInputContent','composer.textInputCursorEnd','composer.textInputCursorStart'],methodName:'_onChangeDetectSuggestionDelimiterPosition',}),new OnChange({dependencies:['suggestionDelimiterPosition','suggestionModelName','suggestionSearchTerm','composer.activeThread'],methodName:'_onChangeUpdateSuggestionList',}),];ComposerView.modelName='mail.composer_view';return ComposerView;}
registerNewModel('mail.composer_view',factory);return __exports;});;

/* /mail/static/src/models/country/country.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/country/country',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr}=require('@mail/model/model_field');const{clear}=require('@mail/model/model_field_command');function factory(dependencies){class Country extends dependencies['mail.model']{_computeFlagUrl(){if(!this.code){return clear();}
return`/base/static/img/country_flags/${this.code}.png`;}}
Country.fields={code:attr(),flagUrl:attr({compute:'_computeFlagUrl',}),id:attr({readonly:true,required:true,}),name:attr(),};Country.identifyingFields=['id'];Country.modelName='mail.country';return Country;}
registerNewModel('mail.country',factory);return __exports;});;

/* /mail/static/src/models/device/device.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/device/device',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr}=require('@mail/model/model_field');function factory(dependencies){class Device extends dependencies['mail.model']{_created(){const res=super._created(...arguments);this._refresh();this._onResize=_.debounce(()=>this._refresh(),100);return res;}
_willDelete(){window.removeEventListener('resize',this._onResize);return super._willDelete(...arguments);}
start(){window.addEventListener('resize',this._onResize);}
_refresh(){this.update({globalWindowInnerHeight:this.env.browser.innerHeight,globalWindowInnerWidth:this.env.browser.innerWidth,isMobile:this.env.device.isMobile,isMobileDevice:this.messaging.device.isMobileDevice,sizeClass:this.env.device.size_class,});}}
Device.fields={globalWindowInnerHeight:attr(),globalWindowInnerWidth:attr(),isMobile:attr(),isMobileDevice:attr(),sizeClass:attr(),};Device.identifyingFields=['messaging'];Device.modelName='mail.device';return Device;}
registerNewModel('mail.device',factory);return __exports;});;

/* /mail/static/src/models/dialog/dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/dialog/dialog',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{many2one,one2one}=require('@mail/model/model_field');const{replace}=require('@mail/model/model_field_command');function factory(dependencies){class Dialog extends dependencies['mail.model']{_computeRecord(){if(this.attachmentViewer){return replace(this.attachmentViewer);}
if(this.followerSubtypeList){return replace(this.followerSubtypeList);}}}
Dialog.fields={attachmentViewer:one2one('mail.attachment_viewer',{isCausal:true,inverse:'dialog',readonly:true,}),followerSubtypeList:one2one('mail.follower_subtype_list',{isCausal:true,inverse:'dialog',readonly:true,}),manager:many2one('mail.dialog_manager',{inverse:'dialogs',readonly:true,}),record:one2one('mail.model',{compute:'_computeRecord',isCausal:true,readonly:true,required:true,}),};Dialog.identifyingFields=['manager',['attachmentViewer','followerSubtypeList']];Dialog.modelName='mail.dialog';return Dialog;}
registerNewModel('mail.dialog',factory);return __exports;});;

/* /mail/static/src/models/dialog_manager/dialog_manager.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/dialog_manager/dialog_manager',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{one2many}=require('@mail/model/model_field');function factory(dependencies){class DialogManager extends dependencies['mail.model']{}
DialogManager.fields={dialogs:one2many('mail.dialog',{inverse:'manager',isCausal:true,}),};DialogManager.identifyingFields=['messaging'];DialogManager.modelName='mail.dialog_manager';return DialogManager;}
registerNewModel('mail.dialog_manager',factory);return __exports;});;

/* /mail/static/src/models/discuss/discuss.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/discuss/discuss',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one,one2one}=require('@mail/model/model_field');const{clear,insertAndReplace,link,unlink}=require('@mail/model/model_field_command');function factory(dependencies){class Discuss extends dependencies['mail.model']{_created(){super._created();this.onClickStartAMeetingButton=this.onClickStartAMeetingButton.bind(this);}
clearIsAddingItem(){this.update({addingChannelValue:"",isAddingChannel:false,isAddingChat:false,});}
close(){this.update({isOpen:false});}
focus(){if(this.threadView&&this.threadView.composerView){this.threadView.composerView.update({doFocus:true});}}
async handleAddChannelAutocompleteSelect(ev,ui){const name=this.addingChannelValue;this.clearIsAddingItem();if(ui.item.special){const channel=await this.async(()=>this.messaging.models['mail.thread'].performRpcCreateChannel({name,privacy:ui.item.special,}));channel.open();}else{const channel=this.messaging.models['mail.thread'].insert({id:ui.item.id,model:'mail.channel',});await channel.join();channel.update({isServerPinned:true});channel.open();}}
async handleAddChannelAutocompleteSource(req,res){this.update({addingChannelValue:req.term});const threads=await this.messaging.models['mail.thread'].searchChannelsToOpen({limit:10,searchTerm:req.term});const items=threads.map((thread)=>{const escapedName=owl.utils.escape(thread.name);return{id:thread.id,label:escapedName,value:escapedName,};});const escapedValue=owl.utils.escape(req.term);items.push({label:_.str.sprintf(`<strong>${this.env._t('Create %s')}</strong>`,`<em><span class="fa fa-hashtag"/>${escapedValue}</em>`,),escapedValue,special:'public'},{label:_.str.sprintf(`<strong>${this.env._t('Create %s')}</strong>`,`<em><span class="fa fa-lock"/>${escapedValue}</em>`,),escapedValue,special:'private'});res(items);}
handleAddChatAutocompleteSelect(ev,ui){this.messaging.openChat({partnerId:ui.item.id});this.clearIsAddingItem();}
handleAddChatAutocompleteSource(req,res){const value=owl.utils.escape(req.term);this.messaging.models['mail.partner'].imSearch({callback:partners=>{const suggestions=partners.map(partner=>{return{id:partner.id,value:partner.nameOrDisplayName,label:partner.nameOrDisplayName,};});res(_.sortBy(suggestions,'label'));},keyword:value,limit:10,});}
onClickMobileNewChatButton(ev){this.update({isAddingChat:true});}
onClickMobileNewChannelButton(ev){this.update({isAddingChannel:true});}
async onClickStartAMeetingButton(ev){const meetingChannel=await this.messaging.models['mail.thread'].createGroupChat({default_display_mode:'video_full_screen',partners_to:[this.messaging.currentPartner.id],});meetingChannel.toggleCall({startWithVideo:true});await meetingChannel.open({focus:false});if(!meetingChannel.exists()||!this.threadView){return;}
this.threadView.topbar.openInvitePopoverView();}
openInitThread(){const[model,id]=typeof this.initActiveId==='number'?['mail.channel',this.initActiveId]:this.initActiveId.split('_');const thread=this.messaging.models['mail.thread'].findFromIdentifyingData({id:model!=='mail.box'?Number(id):id,model,});if(!thread){return;}
thread.open();if(this.messaging.device.isMobile&&thread.channel_type){this.update({activeMobileNavbarTabId:thread.channel_type});}}
async openThread(thread,{focus}={}){this.update({thread:link(thread),});if(focus!==undefined?focus:!this.messaging.device.isMobileDevice){this.focus();}
if(!this.isOpen){this.env.bus.trigger('do-action',{action:'mail.action_discuss',options:{active_id:this.threadToActiveId(this),clear_breadcrumbs:false,on_reverse_breadcrumb:()=>this.close(),},});}}
threadToActiveId(thread){return`${thread.model}_${thread.id}`;}
onInputQuickSearch(value){if(!this.sidebarQuickSearchValue){this.categoryChat.open();this.categoryChannel.open();}
this.update({sidebarQuickSearchValue:value});}
_computeActiveId(){if(!this.thread){return clear();}
return this.threadToActiveId(this.thread);}
_computeAddingChannelValue(){if(!this.isOpen){return"";}
return this.addingChannelValue;}
_computeHasThreadView(){if(!this.thread||!this.isOpen){return false;}
if(this.messaging.device.isMobile&&(this.activeMobileNavbarTabId!=='mailbox'||this.thread.model!=='mail.box')){return false;}
return true;}
_computeIsAddingChannel(){if(!this.isOpen){return false;}
return this.isAddingChannel;}
_computeIsAddingChat(){if(!this.isOpen){return false;}
return this.isAddingChat;}
_computeThread(){if(!this.thread||!this.thread.isPinned){return unlink();}}
_computeThreadViewer(){return insertAndReplace({hasMemberList:true,hasThreadView:this.hasThreadView,hasTopbar:true,thread:this.thread?link(this.thread):unlink(),});}}
Discuss.fields={activeId:attr({compute:'_computeActiveId',}),activeMobileNavbarTabId:attr({default:'mailbox',}),addingChannelValue:attr({compute:'_computeAddingChannelValue',default:"",}),categoryChannel:one2one('mail.discuss_sidebar_category',{inverse:'discussAsChannel',isCausal:true,}),categoryChat:one2one('mail.discuss_sidebar_category',{inverse:'discussAsChat',isCausal:true,}),hasThreadView:attr({compute:'_computeHasThreadView',}),initActiveId:attr({default:'mail.box_inbox',}),isAddingChannel:attr({compute:'_computeIsAddingChannel',default:false,}),isAddingChat:attr({compute:'_computeIsAddingChat',default:false,}),isInitThreadHandled:attr({default:false,}),isOpen:attr({default:false,}),menu_id:attr({default:null,}),sidebarQuickSearchValue:attr({default:"",}),startAMeetingButtonRef:attr(),thread:many2one('mail.thread',{compute:'_computeThread',}),threadView:one2one('mail.thread_view',{related:'threadViewer.threadView',}),threadViewer:one2one('mail.thread_viewer',{compute:'_computeThreadViewer',inverse:'discuss',isCausal:true,readonly:true,required:true,}),};Discuss.identifyingFields=['messaging'];Discuss.modelName='mail.discuss';return Discuss;}
registerNewModel('mail.discuss',factory);return __exports;});;

/* /mail/static/src/models/discuss_public_view/discuss_public_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/discuss_public_view/discuss_public_view',async function(require){'use strict';let __exports={};const{attr,one2one}=require('@mail/model/model_field');const{registerNewModel}=require('@mail/model/model_core');const{clear,insertAndReplace,link}=require('@mail/model/model_field_command');function factory(dependencies){class DiscussPublicView extends dependencies['mail.model']{async switchToThreadView(){this.update({threadViewer:insertAndReplace({extraClass:'flex-grow-1',hasMemberList:true,hasThreadView:true,hasTopbar:true,thread:link(this.channel),}),welcomeView:clear(),});if(this.isChannelTokenSecret){window.history.replaceState(window.history.state,null,`/discuss/channel/${this.channel.id}${window.location.search}`);}
if(this.channel.defaultDisplayMode==='video_full_screen'){await this.channel.toggleCall({startWithVideo:true});await this.threadView.rtcCallViewer.activateFullScreen();}}
switchToWelcomeView(){this.update({threadViewer:clear(),welcomeView:insertAndReplace({channel:link(this.channel),isDoFocusGuestNameInput:true,originalGuestName:this.messaging.currentGuest&&this.messaging.currentGuest.name,pendingGuestName:this.messaging.currentGuest&&this.messaging.currentGuest.name,}),});if(this.welcomeView.mediaPreview){this.welcomeView.mediaPreview.enableMicrophone();this.welcomeView.mediaPreview.enableVideo();}}}
DiscussPublicView.fields={channel:one2one('mail.thread',{readonly:true,required:true,}),isChannelTokenSecret:attr({default:true,}),shouldAddGuestAsMemberOnJoin:attr({default:false,readonly:true,}),shouldDisplayWelcomeViewInitially:attr({default:false,readonly:true,}),threadView:one2one('mail.thread_view',{readonly:true,related:'threadViewer.threadView',}),threadViewer:one2one('mail.thread_viewer',{inverse:'discussPublicView',isCausal:true,}),welcomeView:one2one('mail.welcome_view',{inverse:'discussPublicView',isCausal:true,}),};DiscussPublicView.identifyingFields=['messaging'];DiscussPublicView.modelName='mail.discuss_public_view';return DiscussPublicView;}
registerNewModel('mail.discuss_public_view',factory);return __exports;});;

/* /mail/static/src/models/discuss_sidebar_category/discuss_sidebar_category.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/discuss_sidebar_category/discuss_sidebar_category',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,one2many,one2one}=require('@mail/model/model_field');const{clear,insertAndReplace,replace}=require('@mail/model/model_field_command');const{OnChange}=require('@mail/model/model_onchange');function factory(dependencies){class DiscussSidebarCategory extends dependencies['mail.model']{_created(){this.onClick=this.onClick.bind(this);this.onHideAddingItem=this.onHideAddingItem.bind(this);this.onAddItemAutocompleteSelect=this.onAddItemAutocompleteSelect.bind(this);this.onAddItemAutocompleteSource=this.onAddItemAutocompleteSource.bind(this);this.onClickCommandAdd=this.onClickCommandAdd.bind(this);this.onClickCommandView=this.onClickCommandView.bind(this);return super._created();}
static async performRpcSetResUsersSettings(resUsersSettings){return this.env.services.rpc({model:'res.users.settings',method:'set_res_users_settings',args:[[this.messaging.currentUser.resUsersSettingsId]],kwargs:{new_settings:resUsersSettings,},},{shadow:true},);}
async close(){this.update({isPendingOpen:false});await this.messaging.models['mail.discuss_sidebar_category'].performRpcSetResUsersSettings({[this.serverStateKey]:false,});}
async open(){this.update({isPendingOpen:true});await this.messaging.models['mail.discuss_sidebar_category'].performRpcSetResUsersSettings({[this.serverStateKey]:true,});}
_computeActiveItem(){const thread=this.messaging.discuss.thread;if(thread&&this.supportedChannelTypes.includes(thread.channel_type)){return insertAndReplace({channel:replace(thread),category:replace(this),});}
return clear();}
_computeFilteredCategoryItems(){let categoryItems=this.categoryItems;const searchValue=this.messaging.discuss.sidebarQuickSearchValue;if(searchValue){const qsVal=searchValue.toLowerCase();categoryItems=categoryItems.filter(categoryItem=>{const nameVal=categoryItem.channel.displayName.toLowerCase();return nameVal.includes(qsVal);});}
return replace(categoryItems);}
_computeIsOpen(){return this.isPendingOpen!==undefined?this.isPendingOpen:this.isServerOpen;}
_sortDefinitionCategoryItems(){switch(this.sortComputeMethod){case'name':return[['defined-first','channel'],['defined-first','channel.displayName'],['case-insensitive-asc','channel.displayName'],['smaller-first','channel.id'],];case'last_action':return[['defined-first','channel'],['defined-first','channel.lastInterestDateTime'],['greater-first','channel.lastInterestDateTime'],['greater-first','channel.id'],];}}
async onClick(){if(this.isOpen){await this.close();}else{await this.open();}}
onHideAddingItem(ev){ev.stopPropagation();this.update({isAddingItem:false});}
onAddItemAutocompleteSelect(ev,ui){switch(this.autocompleteMethod){case'channel':this.messaging.discuss.handleAddChannelAutocompleteSelect(ev,ui);break;case'chat':this.messaging.discuss.handleAddChatAutocompleteSelect(ev,ui);break;}}
onAddItemAutocompleteSource(req,res){switch(this.autocompleteMethod){case'channel':this.messaging.discuss.handleAddChannelAutocompleteSource(req,res);break;case'chat':this.messaging.discuss.handleAddChatAutocompleteSource(req,res);break;}}
onClickCommandAdd(ev){ev.stopPropagation();this.update({isAddingItem:true});}
onClickCommandView(ev){ev.stopPropagation();return this.env.bus.trigger('do-action',{action:{name:this.env._t("Public Channels"),type:'ir.actions.act_window',res_model:'mail.channel',views:[[false,'kanban'],[false,'form']],domain:[['public','!=','private']],},});}
_onIsServerOpenChanged(){if(this.isServerOpen===this.isPendingOpen){this.update({isPendingOpen:clear()});}}}
DiscussSidebarCategory.fields={activeItem:one2one('mail.discuss_sidebar_category_item',{compute:'_computeActiveItem',}),autocompleteMethod:attr(),commandAddTitleText:attr(),categoryItems:one2many('mail.discuss_sidebar_category_item',{inverse:'category',isCausal:true,sort:'_sortDefinitionCategoryItems',}),counter:attr({default:0,readonly:true,sum:'categoryItems.categoryCounterContribution',}),discussAsChannel:one2one('mail.discuss',{inverse:'categoryChannel',readonly:true,}),discussAsChat:one2one('mail.discuss',{inverse:'categoryChat',readonly:true,}),filteredCategoryItems:one2many('mail.discuss_sidebar_category_item',{compute:'_computeFilteredCategoryItems',readonly:true,}),name:attr(),hasAddCommand:attr({default:false,}),hasViewCommand:attr({default:false,}),isAddingItem:attr({default:false,}),isOpen:attr({compute:'_computeIsOpen',}),isPendingOpen:attr(),isServerOpen:attr(),newItemPlaceholderText:attr(),serverStateKey:attr({readonly:true,required:true,}),sortComputeMethod:attr({required:true,}),supportedChannelTypes:attr({required:true,readonly:true,}),};DiscussSidebarCategory.identifyingFields=[['discussAsChannel','discussAsChat']];DiscussSidebarCategory.onChanges=[new OnChange({dependencies:['isServerOpen'],methodName:['_onIsServerOpenChanged'],}),];DiscussSidebarCategory.modelName='mail.discuss_sidebar_category';return DiscussSidebarCategory;}
registerNewModel('mail.discuss_sidebar_category',factory);return __exports;});;

/* /mail/static/src/models/discuss_sidebar_category_item/discuss_sidebar_category_item.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/discuss_sidebar_category_item/discuss_sidebar_category_item',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one,one2one}=require('@mail/model/model_field');const{clear,link}=require('@mail/model/model_field_command');const{isEventHandled}=require('@mail/utils/utils');const Dialog=require('web.Dialog');function factory(dependencies){class DiscussSidebarCategoryItem extends dependencies['mail.model']{_created(){this.onClick=this.onClick.bind(this);this.onClickCommandLeave=this.onClickCommandLeave.bind(this);this.onClickCommandSettings=this.onClickCommandSettings.bind(this);this.onClickCommandUnpin=this.onClickCommandUnpin.bind(this);}
_computeAvatarUrl(){switch(this.channelType){case'channel':case'group':return`/web/image/mail.channel/${this.channel.id}/avatar_128?unique=${this.channel.avatarCacheKey}`;case'chat':if(this.channel.correspondent){return this.channel.correspondent.avatarUrl;}}
return'/mail/static/src/img/smiley/avatar.jpg';}
_computeCategoryCounterContribution(){switch(this.channel.channel_type){case'channel':return this.channel.message_needaction_counter>0?1:0;case'chat':case'group':return this.channel.localMessageUnreadCounter>0?1:0;}}
_computeCounter(){switch(this.channelType){case'channel':return this.channel.message_needaction_counter;case'chat':case'group':return this.channel.localMessageUnreadCounter;}}
_computeHasLeaveCommand(){return(['channel','group'].includes(this.channelType)&&!this.channel.message_needaction_counter&&!this.channel.group_based_subscription);}
_computeHasSettingsCommand(){return this.channelType==='channel';}
_computeHasUnpinCommand(){return this.channelType==='chat'&&!this.channel.localMessageUnreadCounter;}
_computeIsActive(){return this.messaging.discuss&&this.channel===this.messaging.discuss.thread;}
_computeIsUnread(){if(!this.channel){return clear();}
return this.channel.localMessageUnreadCounter>0;}
_computeHasThreadIcon(){switch(this.channelType){case'channel':return this.channel.public==='private';case'chat':return true;case'group':return false;}}
onClick(ev){if(isEventHandled(ev,'EditableText.click')){return;}
this.channel.open();}
async onClickCommandLeave(ev){ev.stopPropagation();if(this.channel.channel_type!=='group'&&this.channel.creator===this.messaging.currentUser){await this._askAdminConfirmation();}
if(this.channel.channel_type==='group'){await this._askLeaveGroupConfirmation();}
this.channel.leave();}
onClickCommandSettings(ev){ev.stopPropagation();return this.env.bus.trigger('do-action',{action:{type:'ir.actions.act_window',res_model:this.channel.model,res_id:this.channel.id,views:[[false,'form']],target:'current',},});}
onClickCommandUnpin(ev){ev.stopPropagation();this.channel.unsubscribe();}
_askAdminConfirmation(){return new Promise(resolve=>{Dialog.confirm(this,this.env._t("You are the administrator of this channel. Are you sure you want to leave?"),{buttons:[{text:this.env._t("Leave"),classes:'btn-primary',close:true,click:resolve,},{text:this.env._t("Discard"),close:true,},],});});}
_askLeaveGroupConfirmation(){return new Promise(resolve=>{Dialog.confirm(this,this.env._t("You are about to leave this group conversation and will no longer have access to it unless you are invited again. Are you sure you want to continue?"),{buttons:[{text:this.env._t("Leave"),classes:'btn-primary',close:true,click:resolve},{text:this.env._t("Discard"),close:true}]});});}}
DiscussSidebarCategoryItem.fields={avatarUrl:attr({compute:'_computeAvatarUrl',}),category:many2one('mail.discuss_sidebar_category',{inverse:'categoryItems',readonly:true,required:true,}),categoryCounterContribution:attr({compute:'_computeCategoryCounterContribution',readonly:true,}),counter:attr({compute:'_computeCounter',}),hasLeaveCommand:attr({compute:'_computeHasLeaveCommand',}),hasSettingsCommand:attr({compute:'_computeHasSettingsCommand',}),hasThreadIcon:attr({compute:'_computeHasThreadIcon',}),hasUnpinCommand:attr({compute:'_computeHasUnpinCommand',}),isActive:attr({compute:'_computeIsActive',}),isUnread:attr({compute:'_computeIsUnread',}),channel:one2one('mail.thread',{inverse:'discussSidebarCategoryItem',readonly:true,required:true,}),channelType:attr({related:'channel.channel_type',}),};DiscussSidebarCategoryItem.identifyingFields=['category','channel'];DiscussSidebarCategoryItem.modelName='mail.discuss_sidebar_category_item';return DiscussSidebarCategoryItem;}
registerNewModel('mail.discuss_sidebar_category_item',factory);return __exports;});;

/* /mail/static/src/models/follower/follower.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/follower/follower',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one,one2many}=require('@mail/model/model_field');const{clear,insert,insertAndReplace,link,replace,unlink,unlinkAll}=require('@mail/model/model_field_command');function factory(dependencies){class Follower extends dependencies['mail.model']{static convertData(data){const data2={};if('id'in data){data2.id=data.id;}
if('is_active'in data){data2.isActive=data.is_active;}
if('is_editable'in data){data2.isEditable=data.is_editable;}
if('partner_id'in data){if(!data.partner_id){data2.partner=unlinkAll();}else{const partnerData={display_name:data.display_name,email:data.email,id:data.partner_id,name:data.name,};data2.partner=insert(partnerData);}}
if(data.partner){data2.partner=insertAndReplace(this.models['mail.partner'].convertData(data.partner));}
return data2;}
closeSubtypes(){this.update({subtypeList:clear()});}
async openProfile(){return this.partner.openProfile();}
async remove(){const partner_ids=[];partner_ids.push(this.partner.id);await this.async(()=>this.env.services.rpc({model:this.followedThread.model,method:'message_unsubscribe',args:[[this.followedThread.id],partner_ids]}));const followedThread=this.followedThread;this.delete();followedThread.fetchAndUpdateSuggestedRecipients();}
selectSubtype(subtype){if(!this.selectedSubtypes.includes(subtype)){this.update({selectedSubtypes:link(subtype)});}}
async showSubtypes(){const subtypesData=await this.async(()=>this.env.services.rpc({route:'/mail/read_subscription_data',params:{follower_id:this.id},}));this.update({subtypes:unlinkAll()});for(const data of subtypesData){const subtype=this.messaging.models['mail.follower_subtype'].insert(this.messaging.models['mail.follower_subtype'].convertData(data));this.update({subtypes:link(subtype)});if(data.followed){this.update({selectedSubtypes:link(subtype)});}else{this.update({selectedSubtypes:unlink(subtype)});}}
this.messaging.dialogManager.update({dialogs:insert({followerSubtypeList:insertAndReplace({follower:replace(this),}),}),});}
unselectSubtype(subtype){if(this.selectedSubtypes.includes(subtype)){this.update({selectedSubtypes:unlink(subtype)});}}
async updateSubtypes(){if(this.selectedSubtypes.length===0){this.remove();}else{const kwargs={subtype_ids:this.selectedSubtypes.map(subtype=>subtype.id),};if(this.partner){kwargs.partner_ids=[this.partner.id];}
await this.async(()=>this.env.services.rpc({model:this.followedThread.model,method:'message_subscribe',args:[[this.followedThread.id]],kwargs,}));this.env.services['notification'].notify({type:'success',message:this.env._t("The subscription preferences were successfully applied."),});}
this.closeSubtypes();}}
Follower.fields={followedThread:many2one('mail.thread',{inverse:'followers',}),id:attr({readonly:true,required:true,}),isActive:attr({default:true,}),isEditable:attr({default:false,}),partner:many2one('mail.partner',{required:true,}),selectedSubtypes:many2many('mail.follower_subtype'),subtypeList:one2many('mail.follower_subtype_list',{inverse:'follower',isCausal:true,}),subtypes:many2many('mail.follower_subtype'),};Follower.identifyingFields=['id'];Follower.modelName='mail.follower';return Follower;}
registerNewModel('mail.follower',factory);return __exports;});;

/* /mail/static/src/models/follower_subtype/follower_subtype.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/follower_subtype/follower_subtype',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr}=require('@mail/model/model_field');function factory(dependencies){class FollowerSubtype extends dependencies['mail.model']{static convertData(data){const data2={};if('default'in data){data2.isDefault=data.default;}
if('id'in data){data2.id=data.id;}
if('internal'in data){data2.isInternal=data.internal;}
if('name'in data){data2.name=data.name;}
if('parent_model'in data){data2.parentModel=data.parent_model;}
if('res_model'in data){data2.resModel=data.res_model;}
if('sequence'in data){data2.sequence=data.sequence;}
return data2;}}
FollowerSubtype.fields={id:attr({readonly:true,required:true,}),isDefault:attr({default:false,}),isInternal:attr({default:false,}),name:attr(),parentModel:attr(),resModel:attr(),sequence:attr(),};FollowerSubtype.identifyingFields=['id'];FollowerSubtype.modelName='mail.follower_subtype';return FollowerSubtype;}
registerNewModel('mail.follower_subtype',factory);return __exports;});;

/* /mail/static/src/models/follower_subtype_list/follower_subtype_list.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/follower_subtype_list/follower_subtype_list',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{many2one,one2one}=require('@mail/model/model_field');function factory(dependencies){class FollowerSubtypeList extends dependencies['mail.model']{}
FollowerSubtypeList.fields={dialog:one2one('mail.dialog',{inverse:'followerSubtypeList',isCausal:true,readonly:true,}),follower:many2one('mail.follower',{inverse:'subtypeList',readonly:true,required:true,}),};FollowerSubtypeList.identifyingFields=['follower'];FollowerSubtypeList.modelName='mail.follower_subtype_list';return FollowerSubtypeList;}
registerNewModel('mail.follower_subtype_list',factory);return __exports;});;

/* /mail/static/src/models/guest/guest.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/guest/guest',async function(require){'use strict';let __exports={};const{attr,one2many,one2one}=require('@mail/model/model_field');const{registerNewModel}=require('@mail/model/model_core');function factory(dependencies){class Guest extends dependencies['mail.model']{static async performRpcGuestUpdateName({id,name}){await this.env.services.rpc({route:'/mail/guest/update_name',params:{guest_id:id,name,},});}
_computeAvatarUrl(){return`/web/image/mail.guest/${this.id}/avatar_128?unique=${this.name}`;}}
Guest.fields={authoredMessages:one2many('mail.message',{inverse:'guestAuthor',}),avatarUrl:attr({compute:'_computeAvatarUrl',}),id:attr({required:true,readonly:true,}),name:attr(),rtcSessions:one2many('mail.rtc_session',{inverse:'guest',}),volumeSetting:one2one('mail.volume_setting',{inverse:'guest',}),};Guest.identifyingFields=['id'];Guest.modelName='mail.guest';return Guest;}
registerNewModel('mail.guest',factory);return __exports;});;

/* /mail/static/src/models/locale/locale.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/locale/locale',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr}=require('@mail/model/model_field');function factory(dependencies){class Locale extends dependencies['mail.model']{_computeLanguage(){return this.env._t.database.parameters.code;}
_computeTextDirection(){return this.env._t.database.parameters.direction;}}
Locale.fields={language:attr({compute:'_computeLanguage',}),textDirection:attr({compute:'_computeTextDirection',}),};Locale.identifyingFields=['messaging'];Locale.modelName='mail.locale';return Locale;}
registerNewModel('mail.locale',factory);return __exports;});;

/* /mail/static/src/models/mail_template/mail_template.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/mail_template/mail_template',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many}=require('@mail/model/model_field');function factory(dependencies){class MailTemplate extends dependencies['mail.model']{preview(activity){const action={name:this.env._t("Compose Email"),type:'ir.actions.act_window',res_model:'mail.compose.message',views:[[false,'form']],target:'new',context:{default_res_id:activity.thread.id,default_model:activity.thread.model,default_use_template:true,default_template_id:this.id,force_email:true,},};this.env.bus.trigger('do-action',{action,options:{on_close:()=>{activity.thread.refresh();},},});}
async send(activity){await this.async(()=>this.env.services.rpc({model:activity.thread.model,method:'activity_send_mail',args:[[activity.thread.id],this.id],}));activity.thread.refresh();}}
MailTemplate.fields={activities:many2many('mail.activity',{inverse:'mailTemplates',}),id:attr({readonly:true,required:true,}),name:attr(),};MailTemplate.identifyingFields=['id'];MailTemplate.modelName='mail.mail_template';return MailTemplate;}
registerNewModel('mail.mail_template',factory);return __exports;});;

/* /mail/static/src/models/media_preview/media_preview.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/media_preview/media_preview',async function(require){'use strict';let __exports={};const{attr}=require('@mail/model/model_field');const{registerNewModel}=require('@mail/model/model_core');function factory(dependencies){class MediaPreview extends dependencies['mail.model']{_created(){super._created();this.onClickDisableMicrophoneButton=this.onClickDisableMicrophoneButton.bind(this);this.onClickDisableVideoButton=this.onClickDisableVideoButton.bind(this);this.onClickEnableMicrophoneButton=this.onClickEnableMicrophoneButton.bind(this);this.onClickEnableVideoButton=this.onClickEnableVideoButton.bind(this);}
static stopTracksOnMediaStream(mediaStream){for(const track of mediaStream.getTracks()){track.stop();}}
disableMicrophone(){this.audioRef.el.srcObject=null;if(!this.audioStream){return;}
this.messaging.models['mail.media_preview'].stopTracksOnMediaStream(this.audioStream);this.update({audioStream:null});}
disableVideo(){this.videoRef.el.srcObject=null;if(!this.videoStream){return;}
this.messaging.models['mail.media_preview'].stopTracksOnMediaStream(this.videoStream);this.update({videoStream:null});}
async enableMicrophone(){if(!this.doesBrowserSupportMediaDevices){return;}
try{const audioStream=await navigator.mediaDevices.getUserMedia({audio:true});this.update({audioStream});this.audioRef.el.srcObject=this.audioStream;}catch{}}
async enableVideo(){if(!this.doesBrowserSupportMediaDevices){return;}
try{const videoStream=await navigator.mediaDevices.getUserMedia({video:true});this.update({videoStream});this.videoRef.el.srcObject=this.videoStream;}catch{}}
onClickDisableMicrophoneButton(){this.disableMicrophone();}
onClickDisableVideoButton(){this.disableVideo();}
onClickEnableMicrophoneButton(){this.enableMicrophone();}
onClickEnableVideoButton(){this.enableVideo();}
_computeDoesBrowserSupportMediaDevices(){return Boolean(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&window.MediaStream);}
_computeIsMicrophoneEnabled(){return this.audioStream!==null;}
_computeIsVideoEnabled(){return this.videoStream!==null;}}
MediaPreview.fields={audioRef:attr(),audioStream:attr({default:null,}),doesBrowserSupportMediaDevices:attr({compute:'_computeDoesBrowserSupportMediaDevices',}),isMicrophoneEnabled:attr({compute:'_computeIsMicrophoneEnabled',}),isVideoEnabled:attr({compute:'_computeIsVideoEnabled',}),videoRef:attr(),videoStream:attr({default:null,}),};MediaPreview.identifyingFields=['messaging'];MediaPreview.modelName='mail.media_preview';return MediaPreview;}
registerNewModel('mail.media_preview',factory);return __exports;});;

/* /mail/static/src/models/message/message.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/message/message',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one,one2many}=require('@mail/model/model_field');const{clear,insert,insertAndReplace,replace,unlinkAll}=require('@mail/model/model_field_command');const emojis=require('@mail/js/emojis')[Symbol.for("default")];const{addLink,htmlToTextContentInline,parseAndTransform,timeFromNow}=require('@mail/js/utils');const{session}=require('@web/session');const{str_to_datetime}=require('web.time');function factory(dependencies){class Message extends dependencies['mail.model']{static convertData(data){const data2={};if('attachment_ids'in data){if(!data.attachment_ids){data2.attachments=unlinkAll();}else{data2.attachments=insertAndReplace(data.attachment_ids.map(attachmentData=>this.messaging.models['mail.attachment'].convertData(attachmentData)));}}
if('author_id'in data){if(!data.author_id){data2.author=unlinkAll();}else if(data.author_id[0]!==0){data2.author=insert({display_name:data.author_id[1],id:data.author_id[0],});}}
if('body'in data){data2.body=data.body;}
if('date'in data&&data.date){data2.date=moment(str_to_datetime(data.date));}
if('email_from'in data){data2.email_from=data.email_from;}
if('guestAuthor'in data){data2.guestAuthor=data.guestAuthor;}
if('history_partner_ids'in data&&this.messaging.currentPartner){data2.isHistory=data.history_partner_ids.includes(this.messaging.currentPartner.id);}
if('id'in data){data2.id=data.id;}
if('is_discussion'in data){data2.is_discussion=data.is_discussion;}
if('is_note'in data){data2.is_note=data.is_note;}
if('is_notification'in data){data2.is_notification=data.is_notification;}
if('messageReactionGroups'in data){data2.messageReactionGroups=data.messageReactionGroups;}
if('message_type'in data){data2.message_type=data.message_type;}
if('model'in data&&'res_id'in data&&data.model&&data.res_id){const originThreadData={id:data.res_id,model:data.model,};if('record_name'in data&&data.record_name){originThreadData.name=data.record_name;}
if('res_model_name'in data&&data.res_model_name){originThreadData.model_name=data.res_model_name;}
if('module_icon'in data){originThreadData.moduleIcon=data.module_icon;}
data2.originThread=insertAndReplace(originThreadData);}
if('needaction_partner_ids'in data&&this.messaging.currentPartner){data2.isNeedaction=data.needaction_partner_ids.includes(this.messaging.currentPartner.id);}
if('notifications'in data){data2.notifications=insert(data.notifications.map(notificationData=>this.messaging.models['mail.notification'].convertData(notificationData)));}
if('parentMessage'in data){if(!data.parentMessage){data2.parentMessage=clear();}else{data2.parentMessage=insertAndReplace(this.convertData(data.parentMessage));}}
if('partner_ids'in data&&this.messaging.currentPartner){data2.recipients=insertAndReplace(data.partner_ids.map(partner_id=>({id:partner_id})));}
if('recipients'in data){data2.recipients=insertAndReplace(data.recipients);}
if('starred_partner_ids'in data&&this.messaging.currentPartner){data2.isStarred=data.starred_partner_ids.includes(this.messaging.currentPartner.id);}
if('subject'in data){data2.subject=data.subject;}
if('subtype_description'in data){data2.subtype_description=data.subtype_description;}
if('subtype_id'in data){data2.subtype_id=data.subtype_id;}
if('tracking_value_ids'in data){data2.tracking_value_ids=data.tracking_value_ids;}
return data2;}
static async markAllAsRead(domain){await this.env.services.rpc({model:'mail.message',method:'mark_all_as_read',kwargs:{domain},});}
static async markAsRead(messages){await this.env.services.rpc({model:'mail.message',method:'set_message_done',args:[messages.map(message=>message.id)]});}
static async performRpcMessageFetch(route,params){const messagesData=await this.env.services.rpc({route,params},{shadow:true});if(!this.messaging){return;}
const messages=this.messaging.models['mail.message'].insert(messagesData.map(messageData=>this.messaging.models['mail.message'].convertData(messageData)));for(const message of messages){for(const thread of message.threads){if(thread.model!=='mail.channel'||thread.channel_type==='channel'){continue;}
this.messaging.models['mail.message_seen_indicator'].insert({thread:replace(thread),message:replace(message),});}}
return messages;}
static async unstarAll(){await this.env.services.rpc({model:'mail.message',method:'unstar_all',});}
async addReaction(content){const messageData=await this.env.services.rpc({route:'/mail/message/add_reaction',params:{content,message_id:this.id},});if(!this.exists()){return;}
this.update(messageData);}
async markAsRead(){await this.async(()=>this.env.services.rpc({model:'mail.message',method:'set_message_done',args:[[this.id]]}));}
openResendAction(){this.env.bus.trigger('do-action',{action:'mail.mail_resend_message_action',options:{additional_context:{mail_message_to_resend:this.id,},},});}
refreshDateFromNow(){this.update({dateFromNow:this._computeDateFromNow()});}
async removeReaction(content){const messageData=await this.env.services.rpc({route:'/mail/message/remove_reaction',params:{content,message_id:this.id},});if(!this.exists()){return;}
this.update(messageData);}
async toggleStar(){await this.async(()=>this.env.services.rpc({model:'mail.message',method:'toggle_message_starred',args:[[this.id]]}));}
async updateContent({body,attachment_ids}){const messageData=await this.env.services.rpc({route:'/mail/message/update_content',params:{body,attachment_ids,message_id:this.id,},});if(!this.messaging){return;}
this.messaging.models['mail.message'].insert(messageData);}
_computeAuthorName(){if(this.author){return this.author.nameOrDisplayName;}
if(this.guestAuthor){return this.guestAuthor.name;}
if(this.email_from){return this.email_from;}
return this.env._t("Anonymous");}
_computeCanBeDeleted(){if(!session.is_admin&&!this.isCurrentUserOrGuestAuthor){return false;}
if(!this.originThread){return false;}
if(this.tracking_value_ids.length>0){return false;}
if(this.message_type!=='comment'){return false;}
if(this.originThread.model==='mail.channel'){return true;}
return this.is_note;}
_computeCanStarBeToggled(){return!this.messaging.isCurrentUserGuest&&!this.isTemporary&&!this.isTransient;}
_computeDateDay(){if(!this.date){return this.env._t("Today");}
const date=this.date.format('YYYY-MM-DD');if(date===moment().format('YYYY-MM-DD')){return this.env._t("Today");}else if(date===moment().subtract(1,'days').format('YYYY-MM-DD')){return this.env._t("Yesterday");}
return this.date.format('LL');}
_computeDateFromNow(){if(!this.date){return clear();}
return timeFromNow(this.date);}
_computeFailureNotifications(){return replace(this.notifications.filter(notifications=>['exception','bounce'].includes(notifications.notification_status)));}
_computeHasAttachments(){return this.attachments.length>0;}
_computeHasReactionIcon(){return!this.isTemporary&&!this.isTransient;}
_computeIsCurrentUserOrGuestAuthor(){return!!(this.author&&this.messaging.currentPartner&&this.messaging.currentPartner===this.author)||!!(this.guestAuthor&&this.messaging.currentGuest&&this.messaging.currentGuest===this.guestAuthor);}
_computeIsBodyEmpty(){return(!this.body||['','<p></p>','<p><br></p>','<p><br/></p>',].includes(this.body.replace(/\s/g,'')));}
_computeIsBodyEqualSubtypeDescription(){if(!this.body||!this.subtype_description){return false;}
const inlineBody=htmlToTextContentInline(this.body);return inlineBody.toLowerCase()===this.subtype_description.toLowerCase();}
_computeIsCurrentPartnerMentioned(){return this.recipients.includes(this.messaging.currentPartner);}
_computeIsEmpty(){return(this.isBodyEmpty&&!this.hasAttachments&&this.tracking_value_ids.length===0&&!this.subtype_description);}
_computeIsHighlighted(){return(this.isCurrentPartnerMentioned&&this.originThread&&this.originThread.model==='mail.channel');}
_computeIsSubjectSimilarToOriginThreadName(){if(!this.subject||!this.originThread||!this.originThread.name){return false;}
const threadName=this.originThread.name.toLowerCase().trim();const prefixList=['re:','fw:','fwd:'];let cleanedSubject=this.subject.toLowerCase();let wasSubjectCleaned=true;while(wasSubjectCleaned){wasSubjectCleaned=false;if(threadName===cleanedSubject){return true;}
for(const prefix of prefixList){if(cleanedSubject.startsWith(prefix)){cleanedSubject=cleanedSubject.replace(prefix,'').trim();wasSubjectCleaned=true;break;}}}
return false;}
_computePrettyBody(){if(!this.body){return clear();}
let prettyBody;for(const emoji of emojis){const{unicode}=emoji;const regexp=new RegExp(`(?:^|\\s|<[a-z]*>)(${unicode})(?=\\s|$|</[a-z]*>)`,"g");const originalBody=this.body;prettyBody=this.body.replace(regexp,` <span class="o_mail_emoji">${unicode}</span> `);if(_.str.count(prettyBody,"o_mail_emoji")>200){prettyBody=originalBody;}}
return parseAndTransform(prettyBody,addLink);}
_computeThreads(){const threads=[];if(this.isHistory&&this.messaging.history){threads.push(this.messaging.history);}
if(this.isNeedaction&&this.messaging.inbox){threads.push(this.messaging.inbox);}
if(this.isStarred&&this.messaging.starred){threads.push(this.messaging.starred);}
if(this.originThread){threads.push(this.originThread);}
return replace(threads);}}
Message.fields={authorName:attr({compute:'_computeAuthorName',}),attachments:many2many('mail.attachment',{inverse:'messages',}),author:many2one('mail.partner',{inverse:'messagesAsAuthor',}),body:attr({default:"",}),canBeDeleted:attr({compute:'_computeCanBeDeleted',}),canStarBeToggled:attr({compute:'_computeCanStarBeToggled',}),date:attr(),dateDay:attr({compute:'_computeDateDay',}),dateFromNow:attr({compute:'_computeDateFromNow',}),email_from:attr(),failureNotifications:one2many('mail.notification',{compute:'_computeFailureNotifications',}),guestAuthor:many2one('mail.guest',{inverse:'authoredMessages',}),hasAttachments:attr({compute:'_computeHasAttachments',}),hasReactionIcon:attr({compute:'_computeHasReactionIcon',}),id:attr({readonly:true,required:true,}),isCurrentUserOrGuestAuthor:attr({compute:'_computeIsCurrentUserOrGuestAuthor',default:false,}),isBodyEmpty:attr({compute:'_computeIsBodyEmpty',}),isBodyEqualSubtypeDescription:attr({compute:'_computeIsBodyEqualSubtypeDescription',default:false,}),isEmpty:attr({compute:'_computeIsEmpty',}),isSubjectSimilarToOriginThreadName:attr({compute:'_computeIsSubjectSimilarToOriginThreadName',}),isTemporary:attr({default:false,}),isTransient:attr({default:false,}),is_discussion:attr({default:false,}),isHistory:attr({default:false,}),isNeedaction:attr({default:false,}),is_note:attr({default:false,}),is_notification:attr({default:false,}),isCurrentPartnerMentioned:attr({compute:'_computeIsCurrentPartnerMentioned',default:false,}),isHighlighted:attr({compute:'_computeIsHighlighted',}),isStarred:attr({default:false,}),messageReactionGroups:one2many('mail.message_reaction_group',{inverse:'message',isCausal:true,}),message_type:attr(),messageSeenIndicators:one2many('mail.message_seen_indicator',{inverse:'message',isCausal:true,}),messageViews:one2many('mail.message_view',{inverse:'message',isCausal:true,}),notifications:one2many('mail.notification',{inverse:'message',isCausal:true,}),originThread:many2one('mail.thread',{inverse:'messagesAsOriginThread',}),parentMessage:many2one('mail.message'),prettyBody:attr({compute:'_computePrettyBody',default:"",}),recipients:many2many('mail.partner'),subject:attr(),subtype_description:attr(),subtype_id:attr(),threads:many2many('mail.thread',{compute:'_computeThreads',inverse:'messages',}),tracking_value_ids:attr({default:[],}),};Message.identifyingFields=['id'];Message.modelName='mail.message';return Message;}
registerNewModel('mail.message',factory);return __exports;});;

/* /mail/static/src/models/message_action_list/message_action_list.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/message_action_list/message_action_list',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one,one2one}=require('@mail/model/model_field');const{clear,insertAndReplace,replace}=require('@mail/model/model_field_command');const{markEventHandled}=require('@mail/utils/utils');function factory(dependencies){class MessageActionList extends dependencies['mail.model']{_created(){this.onClick=this.onClick.bind(this);this.onClickConfirmDelete=this.onClickConfirmDelete.bind(this);this.onClickDelete=this.onClickDelete.bind(this);this.onClickEdit=this.onClickEdit.bind(this);this.onClickMarkAsRead=this.onClickMarkAsRead.bind(this);this.onReactionPopoverOpened=this.onReactionPopoverOpened.bind(this);this.onReactionPopoverClosed=this.onReactionPopoverClosed.bind(this);this.onClickReplyTo=this.onClickReplyTo.bind(this);this.onClickToggleStar=this.onClickToggleStar.bind(this);this.onDeleteConfirmDialogClosed=this.onDeleteConfirmDialogClosed.bind(this);this.onEmojiSelection=this.onEmojiSelection.bind(this);}
onClick(ev){markEventHandled(ev,'MessageActionList.Click');}
onClickConfirmDelete(ev){this.message.updateContent({body:'',attachment_ids:[],});}
onClickDelete(ev){this.update({showDeleteConfirm:true});}
onClickEdit(ev){this.messageView.startEditing();}
onClickMarkAsRead(ev){this.message.markAsRead();}
onReactionPopoverClosed(ev){this.update({isReactionPopoverOpened:false});}
onReactionPopoverOpened(ev){this.update({isReactionPopoverOpened:true});}
onClickReplyTo(ev){markEventHandled(ev,'MessageActionList.replyTo');this.messageView.replyTo();}
onClickToggleStar(ev){this.message.toggleStar();}
onDeleteConfirmDialogClosed(ev){this.update({showDeleteConfirm:false});}
onEmojiSelection(ev){this.message.addReaction(ev.detail.unicode);}
_computeHasMarkAsReadIcon(){return Boolean(this.messaging&&this.messaging.inbox&&this.messageView&&this.messageView.threadView&&this.messageView.threadView.thread&&this.messageView.threadView.thread===this.messaging.inbox);}
_computeHasReplyIcon(){return Boolean(this.messaging&&this.messaging.inbox&&this.message&&!this.message.isTemporary&&!this.message.isTransient&&this.messageView&&this.messageView.threadView&&this.messageView.threadView.thread&&(this.messageView.threadView.thread===this.messaging.inbox||this.messageView.threadView.thread.model==='mail.channel'));}
_computeIsReactionPopoverOpened(){return Boolean(this.reactionPopoverRef&&this.reactionPopoverRef.comp&&this.reactionPopoverRef.comp.state.displayed);}
_computeMessageViewForDelete(){return this.message?insertAndReplace({message:replace(this.message)}):clear();}}
MessageActionList.fields={hasMarkAsReadIcon:attr({compute:'_computeHasMarkAsReadIcon',}),hasReplyIcon:attr({compute:'_computeHasReplyIcon',}),isReactionPopoverOpened:attr({compute:'_computeIsReactionPopoverOpened',}),message:many2one('mail.message',{related:'messageView.message',}),messageView:one2one('mail.message_view',{inverse:'messageActionList',readonly:true,required:true,}),messageViewForDelete:one2one('mail.message_view',{compute:'_computeMessageViewForDelete',inverse:'messageActionListWithDelete',isCausal:true,}),reactionPopoverRef:attr(),showDeleteConfirm:attr({default:false,}),};MessageActionList.identifyingFields=['messageView'];MessageActionList.modelName='mail.message_action_list';return MessageActionList;}
registerNewModel('mail.message_action_list',factory);return __exports;});;

/* /mail/static/src/models/message_in_reply_to_view/message_in_reply_to_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/message_in_reply_to_view/message_in_reply_to_view',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,one2one}=require('@mail/model/model_field');const{clear,replace}=require('@mail/model/model_field_command');const{markEventHandled}=require('@mail/utils/utils');function factory(dependencies){class MessageInReplyToView extends dependencies['mail.model']{_created(){this.onClickReply=this.onClickReply.bind(this);}
onClickReply(ev){markEventHandled(ev,'MessageInReplyToView.ClickMessageInReplyTo');const threadView=this.messageView&&this.messageView.threadView;const parentMessage=this.messageView.message.parentMessage;if(!threadView||!parentMessage){return;}
const parentMessageView=this.messaging.models['mail.message_view'].findFromIdentifyingData({message:replace(parentMessage),threadView:replace(threadView),});if(!parentMessageView){return;}
threadView.addComponentHint('highlight-reply',parentMessageView);}
_computeHasAttachmentBackLink(){const parentMessage=this.messageView.message.parentMessage;return parentMessage.isBodyEmpty&&parentMessage.hasAttachments;}
_computeHasBodyBackLink(){return!this.messageView.message.parentMessage.isBodyEmpty;}}
MessageInReplyToView.fields={hasAttachmentBackLink:attr({compute:'_computeHasAttachmentBackLink',}),hasBodyBackLink:attr({compute:'_computeHasBodyBackLink',}),messageView:one2one('mail.message_view',{inverse:'messageInReplyToView',readonly:true,required:true,}),};MessageInReplyToView.identifyingFields=['messageView'];MessageInReplyToView.modelName='mail.message_in_reply_to_view';return MessageInReplyToView;}
registerNewModel('mail.message_in_reply_to_view',factory);return __exports;});;

/* /mail/static/src/models/message_reaction_group/message_reaction_group.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/message_reaction_group/message_reaction_group',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one}=require('@mail/model/model_field');const{insertAndReplace}=require('@mail/model/model_field_command');const{markEventHandled}=require('@mail/utils/utils');function factory(dependencies){class MessageReactionGroup extends dependencies['mail.model']{_created(){super._created();this.onClick=this.onClick.bind(this);}
onClick(ev){markEventHandled(ev,'MessageReactionGroup.Click');if(this.hasUserReacted){this.message.removeReaction(this.content);}else{this.message.addReaction(this.content);}}
_computeHasUserReacted(){return Boolean((this.messaging.currentPartner&&this.partners.includes(this.messaging.currentPartner))||(this.messaging.currentGuest&&this.guests.includes(this.messaging.currentGuest)));}
_computeMessage(){return insertAndReplace({id:this.messageId});}
_computeSummary(){const{length,0:firstUser,1:secondUser,2:thirdUser,}=[...this.partners.map(partner=>{if(this.message.originThread){return this.message.originThread.getMemberName(partner);}
return partner.nameOrDisplayName;}),...this.guests.map(guest=>guest.name),];switch(length){case 1:return _.str.sprintf(this.env._t('%s has reacted with %s'),firstUser,this.content);case 2:return _.str.sprintf(this.env._t('%s and %s have reacted with %s'),firstUser,secondUser,this.content);case 3:return _.str.sprintf(this.env._t('%s, %s, %s have reacted with %s'),firstUser,secondUser,thirdUser,this.content);case 4:return _.str.sprintf(this.env._t('%s, %s, %s and 1 other person have reacted with %s'),firstUser,secondUser,thirdUser,this.content);default:return _.str.sprintf(this.env._t('%s, %s, %s and %s other persons have reacted with %s'),firstUser,secondUser,thirdUser,length-3,this.content);}}}
MessageReactionGroup.fields={content:attr({readonly:true,required:true,}),count:attr({required:true,}),guests:many2many('mail.guest'),hasUserReacted:attr({compute:'_computeHasUserReacted',default:false,}),message:many2one('mail.message',{compute:'_computeMessage',inverse:'messageReactionGroups',readonly:true,required:true,}),messageId:attr({readonly:true,required:true,}),partners:many2many('mail.partner'),summary:attr({compute:'_computeSummary',}),};MessageReactionGroup.identifyingFields=['message','content'];MessageReactionGroup.modelName='mail.message_reaction_group';return MessageReactionGroup;}
registerNewModel('mail.message_reaction_group',factory);return __exports;});;

/* /mail/static/src/models/message_seen_indicator/message_seen_indicator.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/message_seen_indicator/message_seen_indicator',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one}=require('@mail/model/model_field');const{replace,unlinkAll}=require('@mail/model/model_field_command');function factory(dependencies){class MessageSeenIndicator extends dependencies['mail.model']{static recomputeFetchedValues(channel=undefined){const indicatorFindFunction=channel?localIndicator=>localIndicator.thread===channel:undefined;const indicators=this.messaging.models['mail.message_seen_indicator'].all(indicatorFindFunction);for(const indicator of indicators){indicator.update({hasEveryoneFetched:indicator._computeHasEveryoneFetched(),hasSomeoneFetched:indicator._computeHasSomeoneFetched(),partnersThatHaveFetched:indicator._computePartnersThatHaveFetched(),});}}
static recomputeSeenValues(channel=undefined){const indicatorFindFunction=channel?localIndicator=>localIndicator.thread===channel:undefined;const indicators=this.messaging.models['mail.message_seen_indicator'].all(indicatorFindFunction);for(const indicator of indicators){indicator.update({hasEveryoneSeen:indicator._computeHasEveryoneSeen(),hasSomeoneFetched:indicator._computeHasSomeoneFetched(),hasSomeoneSeen:indicator._computeHasSomeoneSeen(),isMessagePreviousToLastCurrentPartnerMessageSeenByEveryone:indicator._computeIsMessagePreviousToLastCurrentPartnerMessageSeenByEveryone(),partnersThatHaveFetched:indicator._computePartnersThatHaveFetched(),partnersThatHaveSeen:indicator._computePartnersThatHaveSeen(),});}}
_computeHasEveryoneFetched(){if(!this.message||!this.thread||!this.thread.partnerSeenInfos){return false;}
const otherPartnerSeenInfosDidNotFetch=this.thread.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner!==this.message.author&&(!partnerSeenInfo.lastFetchedMessage||partnerSeenInfo.lastFetchedMessage.id<this.message.id));return otherPartnerSeenInfosDidNotFetch.length===0;}
_computeHasEveryoneSeen(){if(!this.message||!this.thread||!this.thread.partnerSeenInfos){return false;}
const otherPartnerSeenInfosDidNotSee=this.thread.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner!==this.message.author&&(!partnerSeenInfo.lastSeenMessage||partnerSeenInfo.lastSeenMessage.id<this.message.id));return otherPartnerSeenInfosDidNotSee.length===0;}
_computeHasSomeoneFetched(){if(!this.message||!this.thread||!this.thread.partnerSeenInfos){return false;}
const otherPartnerSeenInfosFetched=this.thread.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner!==this.message.author&&partnerSeenInfo.lastFetchedMessage&&partnerSeenInfo.lastFetchedMessage.id>=this.message.id);return otherPartnerSeenInfosFetched.length>0;}
_computeHasSomeoneSeen(){if(!this.message||!this.thread||!this.thread.partnerSeenInfos){return false;}
const otherPartnerSeenInfosSeen=this.thread.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner!==this.message.author&&partnerSeenInfo.lastSeenMessage&&partnerSeenInfo.lastSeenMessage.id>=this.message.id);return otherPartnerSeenInfosSeen.length>0;}
_computeIsMessagePreviousToLastCurrentPartnerMessageSeenByEveryone(){if(!this.message||!this.thread||!this.thread.lastCurrentPartnerMessageSeenByEveryone){return false;}
return this.message.id<this.thread.lastCurrentPartnerMessageSeenByEveryone.id;}
_computePartnersThatHaveFetched(){if(!this.message||!this.thread||!this.thread.partnerSeenInfos){return unlinkAll();}
const otherPartnersThatHaveFetched=this.thread.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner&&partnerSeenInfo.partner!==this.message.author&&partnerSeenInfo.lastFetchedMessage&&partnerSeenInfo.lastFetchedMessage.id>=this.message.id).map(partnerSeenInfo=>partnerSeenInfo.partner);if(otherPartnersThatHaveFetched.length===0){return unlinkAll();}
return replace(otherPartnersThatHaveFetched);}
_computePartnersThatHaveSeen(){if(!this.message||!this.thread||!this.thread.partnerSeenInfos){return unlinkAll();}
const otherPartnersThatHaveSeen=this.thread.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner&&partnerSeenInfo.partner!==this.message.author&&partnerSeenInfo.lastSeenMessage&&partnerSeenInfo.lastSeenMessage.id>=this.message.id).map(partnerSeenInfo=>partnerSeenInfo.partner);if(otherPartnersThatHaveSeen.length===0){return unlinkAll();}
return replace(otherPartnersThatHaveSeen);}}
MessageSeenIndicator.modelName='mail.message_seen_indicator';MessageSeenIndicator.fields={hasEveryoneFetched:attr({compute:'_computeHasEveryoneFetched',default:false,}),hasEveryoneSeen:attr({compute:'_computeHasEveryoneSeen',default:false,}),hasSomeoneFetched:attr({compute:'_computeHasSomeoneFetched',default:false,}),hasSomeoneSeen:attr({compute:'_computeHasSomeoneSeen',default:false,}),id:attr(),isMessagePreviousToLastCurrentPartnerMessageSeenByEveryone:attr({compute:'_computeIsMessagePreviousToLastCurrentPartnerMessageSeenByEveryone',default:false,}),message:many2one('mail.message',{inverse:'messageSeenIndicators',readonly:true,required:true,}),partnersThatHaveFetched:many2many('mail.partner',{compute:'_computePartnersThatHaveFetched',}),partnersThatHaveSeen:many2many('mail.partner',{compute:'_computePartnersThatHaveSeen',}),thread:many2one('mail.thread',{inverse:'messageSeenIndicators',readonly:true,required:true,}),};MessageSeenIndicator.identifyingFields=['thread','message'];return MessageSeenIndicator;}
registerNewModel('mail.message_seen_indicator',factory);return __exports;});;

/* /mail/static/src/models/message_view/message_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/message_view/message_view',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one,one2one}=require('@mail/model/model_field');const{clear,insertAndReplace,replace}=require('@mail/model/model_field_command');function factory(dependencies){class MessageView extends dependencies['mail.model']{highlight(){this.env.browser.clearTimeout(this.highlightTimeout);this.update({isHighlighted:true,highlightTimeout:this.env.browser.setTimeout(()=>{if(!this.exists()){return;}
this.update({isHighlighted:false});},2000),});}
replyTo(){if(this.threadView.replyingToMessageView===this){this.threadView.composerView.discard();return;}
this.message.originThread.update({composer:insertAndReplace({isLog:!this.message.is_discussion&&!this.message.is_notification,}),});this.threadView.update({replyingToMessageView:replace(this),composerView:insertAndReplace({doFocus:true,}),});}
startEditing(){const parser=new DOMParser();const htmlDoc=parser.parseFromString(this.message.body.replaceAll('<br>','\n').replaceAll('</br>','\n'),"text/html");const textInputContent=htmlDoc.body.textContent;this.update({composerForEditing:insertAndReplace({isLastStateChangeProgrammatic:true,mentionedPartners:replace(this.message.recipients),textInputContent,textInputCursorEnd:textInputContent.length,textInputCursorStart:textInputContent.length,textInputSelectionDirection:'none',}),composerViewInEditing:insertAndReplace({doFocus:true,}),});}
stopEditing(){if(this.threadView&&this.threadView.composerView&&!this.messaging.device.isMobileDevice){this.threadView.composerView.update({doFocus:true});}
this.update({composerForEditing:clear(),composerViewInEditing:clear(),});}
_computeAttachmentList(){return(this.message&&this.message.attachments.length>0)?insertAndReplace():clear();}
_computeMessageActionList(){return(!this.messageActionListWithDelete)?insertAndReplace():clear();}
_computeMessageInReplyToView(){return(this.message&&this.message.originThread&&this.message.originThread.model==='mail.channel'&&this.message.parentMessage)?insertAndReplace():clear();}}
MessageView.fields={attachmentList:one2one('mail.attachment_list',{compute:'_computeAttachmentList',inverse:'messageView',isCausal:true,readonly:true,}),component:attr(),composerForEditing:one2one('mail.composer',{inverse:'messageViewInEditing',isCausal:true,}),composerViewInEditing:one2one('mail.composer_view',{inverse:'messageViewInEditing',isCausal:true,}),highlightTimeout:attr(),isHighlighted:attr(),isSquashed:attr({default:false,}),messageActionList:one2one('mail.message_action_list',{compute:'_computeMessageActionList',inverse:'messageView',isCausal:true,readonly:true,}),messageActionListWithDelete:one2one('mail.message_action_list',{inverse:'messageViewForDelete',isCausal:true,readonly:true,}),message:many2one('mail.message',{inverse:'messageViews',readonly:true,required:true,}),messageInReplyToView:one2one('mail.message_in_reply_to_view',{compute:'_computeMessageInReplyToView',inverse:'messageView',isCausal:true,readonly:true,}),threadView:many2one('mail.thread_view',{inverse:'messageViews',readonly:true,}),};MessageView.identifyingFields=[['threadView','messageActionListWithDelete'],'message'];MessageView.modelName='mail.message_view';return MessageView;}
registerNewModel('mail.message_view',factory);return __exports;});;

/* /mail/static/src/models/messaging/messaging.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/messaging/messaging',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one,one2many,one2one}=require('@mail/model/model_field');const{OnChange}=require('@mail/model/model_onchange');const{insertAndReplace,replace,link,unlink}=require('@mail/model/model_field_command');const{makeDeferred}=require('@mail/utils/deferred/deferred');const{EventBus}=owl.core;function factory(dependencies){class Messaging extends dependencies['mail.model']{_created(){super._created();this._handleGlobalWindowFocus=this._handleGlobalWindowFocus.bind(this);}
_willDelete(){if(this.env.services['bus_service']){this.env.services['bus_service'].off('window_focus',null,this._handleGlobalWindowFocus);}
return super._willDelete(...arguments);}
async start(){this.env.services['bus_service'].on('window_focus',null,this._handleGlobalWindowFocus);await this.async(()=>this.initializer.start());this.notificationHandler.start();this.update({isInitialized:true});this.initializedPromise.resolve();}
async getChat({partnerId,userId}){if(userId){const user=this.messaging.models['mail.user'].insert({id:userId});return user.getChat();}
if(partnerId){const partner=this.messaging.models['mail.partner'].insert({id:partnerId});return partner.getChat();}}
async openChat(person,options){const chat=await this.async(()=>this.getChat(person));if(!chat){return;}
await this.async(()=>chat.open(options));return chat;}
async openDocument({id,model}){this.env.bus.trigger('do-action',{action:{type:'ir.actions.act_window',res_model:model,views:[[false,'form']],res_id:id,},});if(this.messaging.device.isMobile){this.messaging.messagingMenu.close();}}
async openProfile({id,model}){if(model==='res.partner'){const partner=this.messaging.models['mail.partner'].insert({id});return partner.openProfile();}
if(model==='res.users'){const user=this.messaging.models['mail.user'].insert({id});return user.openProfile();}
if(model==='mail.channel'){let channel=this.messaging.models['mail.thread'].findFromIdentifyingData({id,model:'mail.channel'});if(!channel){channel=(await this.async(()=>this.messaging.models['mail.thread'].performRpcChannelInfo({ids:[id]})))[0];}
if(!channel){this.env.services['notification'].notify({message:this.env._t("You can only open the profile of existing channels."),type:'warning',});return;}
return channel.openProfile();}
return this.messaging.openDocument({id,model});}
refreshIsNotificationPermissionDefault(){this.update({isNotificationPermissionDefault:this._computeIsNotificationPermissionDefault()});}
toggleFocusedRtcSession(sessionId){const rtcSession=this.messaging.models['mail.rtc_session'].findFromIdentifyingData({id:sessionId,});const focusedSessionId=this.focusedRtcSession&&this.focusedRtcSession.id;if(!sessionId||focusedSessionId===sessionId){this.update({focusedRtcSession:unlink()});return;}
this.update({focusedRtcSession:link(rtcSession)});if(this.userSetting.rtcLayout!=='tiled'){return;}
this.userSetting.update({rtcLayout:'sidebar'});}
_computeInitializedPromise(){return makeDeferred();}
_computeIsCurrentUserGuest(){return Boolean(!this.currentPartner&&this.currentGuest);}
_computeMessagingBus(){if(this.messagingBus){return;}
return new EventBus();}
_computeIsNotificationPermissionDefault(){const browserNotification=this.env.browser.Notification;return browserNotification?browserNotification.permission==='default':false;}
_handleGlobalWindowFocus(){this.update({outOfFocusUnreadMessageCounter:0});this.env.bus.trigger('set_title_part',{part:'_chat',});}
_onChangeRingingThreads(){if(this.ringingThreads&&this.ringingThreads.length>0){this.soundEffects.incomingCall.play({loop:true});}else{this.soundEffects.incomingCall.stop();}}
_onChangeFocusedRtcSession(){this.rtc.filterIncomingVideoTraffic(this.focusedRtcSession&&[this.focusedRtcSession.peerToken]);}}
Messaging.fields={allRecords:one2many('mail.model',{inverse:'messaging',isCausal:true,}),autofetchPartnerImStatus:attr({default:true,}),cannedResponses:one2many('mail.canned_response'),chatWindowManager:one2one('mail.chat_window_manager',{default:insertAndReplace(),isCausal:true,readonly:true,}),commands:one2many('mail.channel_command'),companyName:attr(),currentGuest:one2one('mail.guest'),currentPartner:one2one('mail.partner'),currentUser:one2one('mail.user'),device:one2one('mail.device',{default:insertAndReplace(),isCausal:true,readonly:true,}),dialogManager:one2one('mail.dialog_manager',{default:insertAndReplace(),isCausal:true,readonly:true,}),disableAnimation:attr({default:false,}),discuss:one2one('mail.discuss',{default:insertAndReplace(),isCausal:true,readonly:true,}),focusedRtcSession:one2one('mail.rtc_session'),history:one2one('mail.thread'),inbox:one2one('mail.thread'),initializedPromise:attr({compute:'_computeInitializedPromise',required:true,readonly:true,}),initializer:one2one('mail.messaging_initializer',{default:insertAndReplace(),isCausal:true,readonly:true,}),isCurrentUserGuest:attr({compute:'_computeIsCurrentUserGuest',}),isInitialized:attr({default:false,}),isNotificationPermissionDefault:attr({compute:'_computeIsNotificationPermissionDefault',}),isQUnitTest:attr({default:false,}),locale:one2one('mail.locale',{default:insertAndReplace(),isCausal:true,readonly:true,}),loadingBaseDelayDuration:attr({default:400,}),messagingBus:attr({compute:'_computeMessagingBus',readonly:true,required:true,}),messagingMenu:one2one('mail.messaging_menu',{default:insertAndReplace(),isCausal:true,readonly:true,}),notificationGroupManager:one2one('mail.notification_group_manager',{default:insertAndReplace(),isCausal:true,readonly:true,}),notificationHandler:one2one('mail.messaging_notification_handler',{default:insertAndReplace(),isCausal:true,readonly:true,}),outOfFocusUnreadMessageCounter:attr({default:0,}),partnerRoot:many2one('mail.partner'),publicPartners:many2many('mail.partner'),ringingThreads:one2many('mail.thread',{inverse:'messagingAsRingingThread',}),rtc:one2one('mail.rtc',{default:insertAndReplace(),isCausal:true,readonly:true,}),soundEffects:one2one('mail.sound_effects',{default:insertAndReplace(),isCausal:true,readonly:true,}),starred:one2one('mail.thread'),userSetting:one2one('mail.user_setting',{isCausal:true,}),};Messaging.identifyingFields=[];Messaging.onChanges=[new OnChange({dependencies:['ringingThreads'],methodName:'_onChangeRingingThreads',}),new OnChange({dependencies:['focusedRtcSession'],methodName:'_onChangeFocusedRtcSession',}),];Messaging.modelName='mail.messaging';return Messaging;}
registerNewModel('mail.messaging',factory);return __exports;});;

/* /mail/static/src/models/messaging_initializer/messaging_initializer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/messaging_initializer/messaging_initializer',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{executeGracefully}=require('@mail/utils/utils');const{link,insert,insertAndReplace}=require('@mail/model/model_field_command');function factory(dependencies){class MessagingInitializer extends dependencies['mail.model']{async start(){this.messaging.update({history:insertAndReplace({id:'history',isServerPinned:true,model:'mail.box',name:this.env._t("History"),}),inbox:insertAndReplace({id:'inbox',isServerPinned:true,model:'mail.box',name:this.env._t("Inbox"),}),starred:insertAndReplace({id:'starred',isServerPinned:true,model:'mail.box',name:this.env._t("Starred"),}),});const device=this.messaging.device;device.start();const data=await this.async(()=>this.env.services.rpc({route:'/mail/init_messaging',},{shadow:true}));await this.async(()=>this._init(data));if(this.messaging.autofetchPartnerImStatus){this.messaging.models['mail.partner'].startLoopFetchImStatus();}
if(this.messaging.currentUser){this._loadMessageFailures();}}
async _init({channels,commands=[],companyName,current_partner,currentGuest,current_user_id,current_user_settings,mail_failures=[],menu_id,needaction_inbox_counter=0,partner_root,public_partners,shortcodes=[],starred_counter=0}){const discuss=this.messaging.discuss;this._initPartners({currentGuest,current_partner,current_user_id,partner_root,public_partners,});this._initMailboxes({needaction_inbox_counter,starred_counter,});if(current_user_settings){this._initResUsersSettings(current_user_settings);}else{this.messaging.update({userSetting:insertAndReplace({id:-1,}),});}
this._initCannedResponses(shortcodes);if(!this.messaging.isCurrentUserGuest){this._initCommands();}
await this.async(()=>this._initChannels(channels));this._initMailFailures(mail_failures);discuss.update({menu_id});this.messaging.update({companyName});}
_initCannedResponses(cannedResponsesData){this.messaging.update({cannedResponses:insert(cannedResponsesData),});}
async _initChannels(channelsData){return executeGracefully(channelsData.map(channelData=>()=>{const convertedData=this.messaging.models['mail.thread'].convertData(channelData);if(!convertedData.members){if(this.messaging.currentPartner){convertedData.members=link(this.messaging.currentPartner);}
if(this.messaging.currentGuest){convertedData.guestMembers=link(this.messaging.currentGuest);}}
const channel=this.messaging.models['mail.thread'].insert(Object.assign({model:'mail.channel'},convertedData));if(!channel.isPinned){channel.pin();}}));}
_initCommands(){this.messaging.update({commands:insert([{help:this.env._t("Show a helper message"),methodName:'execute_command_help',name:"help",},{help:this.env._t("Leave this channel"),methodName:'execute_command_leave',name:"leave",},{channel_types:['channel','chat'],help:this.env._t("List users in the current channel"),methodName:'execute_command_who',name:"who",}]),});}
_initMailboxes({needaction_inbox_counter,starred_counter,}){this.messaging.inbox.update({counter:needaction_inbox_counter});this.messaging.starred.update({counter:starred_counter});}
async _initMailFailures(mailFailuresData){await executeGracefully(mailFailuresData.map(messageData=>()=>{const message=this.messaging.models['mail.message'].insert(this.messaging.models['mail.message'].convertData(messageData));if(!message.author&&this.messaging.currentPartner){message.update({author:link(this.messaging.currentPartner)});}}));this.messaging.notificationGroupManager.computeGroups();}
_initResUsersSettings({id,is_discuss_sidebar_category_channel_open,is_discuss_sidebar_category_chat_open,use_push_to_talk,push_to_talk_key,voice_active_duration,volume_settings=[],}){this.messaging.currentUser.update({resUsersSettingsId:id});this.messaging.update({userSetting:insertAndReplace({id,usePushToTalk:use_push_to_talk,pushToTalkKey:push_to_talk_key,voiceActiveDuration:voice_active_duration,volumeSettings:volume_settings,}),});this.messaging.discuss.update({categoryChannel:insertAndReplace({autocompleteMethod:'channel',commandAddTitleText:this.env._t("Add or join a channel"),hasAddCommand:true,hasViewCommand:true,isServerOpen:is_discuss_sidebar_category_channel_open,name:this.env._t("Channels"),newItemPlaceholderText:this.env._t("Find or create a channel..."),serverStateKey:'is_discuss_sidebar_category_channel_open',sortComputeMethod:'name',supportedChannelTypes:['channel'],}),categoryChat:insertAndReplace({autocompleteMethod:'chat',commandAddTitleText:this.env._t("Start a conversation"),hasAddCommand:true,isServerOpen:is_discuss_sidebar_category_chat_open,name:this.env._t("Direct Messages"),newItemPlaceholderText:this.env._t("Find or start a conversation..."),serverStateKey:'is_discuss_sidebar_category_chat_open',sortComputeMethod:'last_action',supportedChannelTypes:['chat','group'],}),});}
_initPartners({currentGuest,current_partner,current_user_id:currentUserId,partner_root,public_partners=[],}){if(currentGuest){this.messaging.update({currentGuest:insert(currentGuest)});}
if(current_partner){const partnerData=this.messaging.models['mail.partner'].convertData(current_partner);partnerData.user=insert({id:currentUserId});this.messaging.update({currentPartner:insert(partnerData),currentUser:insert({id:currentUserId}),});}
this.messaging.update({partnerRoot:insert(this.messaging.models['mail.partner'].convertData(partner_root)),publicPartners:insert(public_partners.map(publicPartner=>this.messaging.models['mail.partner'].convertData(publicPartner))),});}
async _loadMessageFailures(){const data=await this.env.services.rpc({route:'/mail/load_message_failures',},{shadow:true});this._initMailFailures(data);}}
MessagingInitializer.identifyingFields=['messaging'];MessagingInitializer.modelName='mail.messaging_initializer';return MessagingInitializer;}
registerNewModel('mail.messaging_initializer',factory);return __exports;});;

/* /mail/static/src/models/messaging_menu/messaging_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/messaging_menu/messaging_menu',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,one2many}=require('@mail/model/model_field');function factory(dependencies){class MessagingMenu extends dependencies['mail.model']{close(){this.update({isOpen:false});}
toggleMobileNewMessage(){this.update({isMobileNewMessageToggled:!this.isMobileNewMessageToggled});}
toggleOpen(){this.update({isOpen:!this.isOpen});this.messaging.refreshIsNotificationPermissionDefault();if(this.isOpen){this.messaging.inbox.cache.update({isCacheRefreshRequested:true});}}
_computeCounter(){if(!this.messaging){return 0;}
const inboxCounter=this.messaging.inbox?this.messaging.inbox.counter:0;const unreadChannelsCounter=this.pinnedAndUnreadChannels.length;const notificationGroupsCounter=this.messaging.notificationGroupManager?this.messaging.notificationGroupManager.groups.reduce((total,group)=>total+group.notifications.length,0):0;const notificationPemissionCounter=this.messaging.isNotificationPermissionDefault?1:0;return inboxCounter+unreadChannelsCounter+notificationGroupsCounter+notificationPemissionCounter;}}
MessagingMenu.fields={activeTabId:attr({default:'all',}),counter:attr({compute:'_computeCounter',}),isMobileNewMessageToggled:attr({default:false,}),isOpen:attr({default:false,}),pinnedAndUnreadChannels:one2many('mail.thread',{inverse:'messagingMenuAsPinnedAndUnreadChannel',readonly:true,}),};MessagingMenu.identifyingFields=['messaging'];MessagingMenu.modelName='mail.messaging_menu';return MessagingMenu;}
registerNewModel('mail.messaging_menu',factory);return __exports;});;

/* /mail/static/src/models/messaging_notification_handler/messaging_notification_handler.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/messaging_notification_handler/messaging_notification_handler',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{decrement,increment,insert,insertAndReplace,link,replace,unlink}=require('@mail/model/model_field_command');const{htmlToTextContentInline}=require('@mail/js/utils');const{str_to_datetime}=require('web.time');const PREVIEW_MSG_MAX_SIZE=350;function factory(dependencies){class MessagingNotificationHandler extends dependencies['mail.model']{_willDelete(){if(this.env.services['bus_service']){this.env.services['bus_service'].off('notification');this.env.services['bus_service'].stopPolling();}
return super._willDelete(...arguments);}
start(){this.env.services.bus_service.onNotification(null,notifs=>this._handleNotifications(notifs));this.env.services.bus_service.startPolling();}
async _handleNotifications(notifications){const channelsLeft=new Set(notifications.filter(notification=>notification.type==='mail.channel/leave').map(notification=>notification.payload.id));const proms=notifications.map(message=>{if(typeof message==='object'){switch(message.type){case'ir.attachment/delete':return this._handleNotificationAttachmentDelete(message.payload);case'mail.channel.partner/seen':return this._handleNotificationChannelPartnerSeen(message.payload);case'mail.channel.partner/fetched':return this._handleNotificationChannelPartnerFetched(message.payload);case'mail.channel.partner/typing_status':return this._handleNotificationChannelPartnerTypingStatus(message.payload);case'mail.channel/new_message':if(channelsLeft.has(message.payload.id)){return;}
return this._handleNotificationChannelMessage(message.payload);case'mail.message/delete':return this._handleNotificationMessageDelete(message.payload);case'mail.message/inbox':return this._handleNotificationNeedaction(message.payload);case'mail.message/mark_as_read':return this._handleNotificationPartnerMarkAsRead(message.payload);case'mail.message/notification_update':return this._handleNotificationPartnerMessageNotificationUpdate(message.payload);case'simple_notification':return this._handleNotificationSimpleNotification(message.payload);case'mail.message/toggle_star':return this._handleNotificationPartnerToggleStar(message.payload);case'mail.channel/transient_message':return this._handleNotificationPartnerTransientMessage(message.payload);case'mail.channel/leave':return this._handleNotificationChannelLeave(message.payload);case'res.users/connection':return this._handleNotificationPartnerUserConnection(message.payload);case'mail.activity/updated':return this.env.bus.trigger('activity_updated',message.payload);case'mail.channel/unpin':return this._handleNotificationChannelUnpin(message.payload);case'mail.channel/joined':return this._handleNotificationChannelJoined(message.payload);case'mail.channel/last_interest_dt_changed':return this._handleNotificationChannelLastInterestDateTimeChanged(message.payload);case'mail.channel/legacy_insert':return this.messaging.models['mail.thread'].insert(this.messaging.models['mail.thread'].convertData({model:'mail.channel',...message.payload}));case'mail.channel/insert':return this._handleNotificationChannelUpdate(message.payload);case'mail.guest/insert':return this.messaging.models['mail.guest'].insert(message.payload);case'mail.message/insert':return this.messaging.models['mail.message'].insert(message.payload);case'mail.channel.rtc.session/insert':return this.messaging.models['mail.rtc_session'].insert(message.payload);case'res.users.settings/changed':return this._handleNotificationResUsersSettings(message.payload);case'mail.channel.rtc.session/peer_notification':return this._handleNotificationRtcPeerToPeer(message.payload);case'mail.channel/rtc_sessions_update':return this._handleNotificationRtcSessionUpdate(message.payload);case'mail.channel.rtc.session/ended':return this._handleNotificationRtcSessionEnded(message.payload);case'res.users.settings/volumes_update':return this._handleNotificationVolumeSettingUpdate(message.payload);default:return this._handleNotification(message);}}});await this.async(()=>Promise.all(proms));}
_handleNotification(message){}
_handleNotificationAttachmentDelete(payload){const attachment=this.messaging.models['mail.attachment'].findFromIdentifyingData(payload);if(attachment){attachment.delete();}}
async _handleNotificationChannelPartnerFetched({channel_id:channelId,last_message_id,partner_id,}){const channel=this.messaging.models['mail.thread'].findFromIdentifyingData({id:channelId,model:'mail.channel',});if(!channel){return;}
if(channel.channel_type==='channel'){return;}
this.messaging.models['mail.thread_partner_seen_info'].insert({lastFetchedMessage:insert({id:last_message_id}),partner:insertAndReplace({id:partner_id}),thread:replace(channel),});this.messaging.models['mail.message_seen_indicator'].insert({message:insertAndReplace({id:last_message_id}),thread:replace(channel),});this.messaging.models['mail.message_seen_indicator'].recomputeFetchedValues(channel);}
_handleNotificationChannelJoined({channel:channelData,invited_by_user_id:invitedByUserId}){const channel=this.messaging.models['mail.thread'].insert(this.messaging.models['mail.thread'].convertData(channelData));if(this.messaging.currentUser&&invitedByUserId!==this.messaging.currentUser.id){this.env.services['notification'].notify({message:_.str.sprintf(this.env._t("You have been invited to #%s"),channel.displayName),type:'info',});}}
_handleNotificationChannelLastInterestDateTimeChanged({id,last_interest_dt}){const channel=this.messaging.models['mail.thread'].findFromIdentifyingData({id:id,model:'mail.channel',});if(channel){channel.update({lastInterestDateTime:str_to_datetime(last_interest_dt),});}}
async _handleNotificationChannelMessage({id:channelId,message:messageData}){let channel=this.messaging.models['mail.thread'].findFromIdentifyingData({id:channelId,model:'mail.channel',});if(!channel&&this.messaging.isCurrentUserGuest){return;}
const convertedData=this.messaging.models['mail.message'].convertData(messageData);if(!channel){channel=(await this.async(()=>this.messaging.models['mail.thread'].performRpcChannelInfo({ids:[channelId]})))[0];}
if(!channel.isPinned){channel.pin();}
const message=this.messaging.models['mail.message'].insert(convertedData);this._notifyThreadViewsMessageReceived(message);if(message.author===this.messaging.currentPartner){return;}
const isChatWithOdooBot=(channel.correspondent&&channel.correspondent===this.messaging.partnerRoot);if(!isChatWithOdooBot){const isOdooFocused=this.env.services['bus_service'].isOdooFocused();if(!isOdooFocused&&channel.isChatChannel){this._notifyNewChannelMessageWhileOutOfFocus({channel,message,});}
if(channel.model==='mail.channel'&&channel.channel_type!=='channel'&&!this.messaging.currentGuest){channel.markAsFetched();}
if(channel.channel_type!=='channel'&&!this.messaging.device.isMobile&&!channel.chatWindow){this.messaging.chatWindowManager.openThread(channel);}}}
async _handleNotificationChannelPartnerSeen({channel_id:channelId,last_message_id,partner_id,}){const channel=this.messaging.models['mail.thread'].findFromIdentifyingData({id:channelId,model:'mail.channel',});if(!channel){return;}
const lastMessage=this.messaging.models['mail.message'].insert({id:last_message_id});const shouldComputeSeenIndicators=channel.channel_type!=='channel';if(shouldComputeSeenIndicators){this.messaging.models['mail.thread_partner_seen_info'].insert({lastSeenMessage:link(lastMessage),partner:insertAndReplace({id:partner_id}),thread:replace(channel),});this.messaging.models['mail.message_seen_indicator'].insert({message:replace(lastMessage),thread:replace(channel),});}
if(this.messaging.currentPartner&&this.messaging.currentPartner.id===partner_id){channel.update({lastSeenByCurrentPartnerMessageId:last_message_id,pendingSeenMessageId:undefined,});}
if(shouldComputeSeenIndicators){this.messaging.models['mail.thread'].computeLastCurrentPartnerMessageSeenByEveryone(channel);this.messaging.models['mail.message_seen_indicator'].recomputeSeenValues(channel);}}
_handleNotificationChannelPartnerTypingStatus({channel_id,is_typing,partner_id,partner_name}){const channel=this.messaging.models['mail.thread'].findFromIdentifyingData({id:channel_id,model:'mail.channel',});if(!channel){return;}
const partner=this.messaging.models['mail.partner'].insert({id:partner_id,name:partner_name,});if(partner===this.messaging.currentPartner){return;}
if(is_typing){if(channel.typingMembers.includes(partner)){channel.refreshOtherMemberTypingMember(partner);}else{channel.registerOtherMemberTypingMember(partner);}}else{if(!channel.typingMembers.includes(partner)){return;}
channel.unregisterOtherMemberTypingMember(partner);}}
_handleNotificationChannelUpdate(channelData){this.messaging.models['mail.thread'].insert({model:'mail.channel',...channelData});}
_handleNotificationResUsersSettings(settings){if('is_discuss_sidebar_category_channel_open'in settings){this.messaging.discuss.categoryChannel.update({isServerOpen:settings.is_discuss_sidebar_category_channel_open,});}
if('is_discuss_sidebar_category_chat_open'in settings){this.messaging.discuss.categoryChat.update({isServerOpen:settings.is_discuss_sidebar_category_chat_open,});}
this.messaging.userSetting.update({usePushToTalk:settings.use_push_to_talk,pushToTalkKey:settings.push_to_talk_key,voiceActiveDuration:settings.voice_active_duration,});}
_handleNotificationNeedaction(data){const message=this.messaging.models['mail.message'].insert(this.messaging.models['mail.message'].convertData(data));this.messaging.inbox.update({counter:increment()});const originThread=message.originThread;if(originThread&&message.isNeedaction){originThread.update({message_needaction_counter:increment()});}}
_handleNotificationRtcPeerToPeer({sender,notifications}){for(const content of notifications){this.messaging.rtc.handleNotification(sender,content);}}
_handleNotificationSimpleNotification({message,sticky,title,warning}){this.env.services['notification'].notify({message,sticky,title,type:warning?'warning':'danger',});}
async _handleNotificationVolumeSettingUpdate({volumeSettings}){this.messaging&&this.messaging.userSetting.update({volumeSettings:volumeSettings,});}
async _handleNotificationRtcSessionEnded({sessionId}){const currentSession=this.messaging.rtc.currentRtcSession;if(currentSession&&currentSession.id===sessionId){this.messaging.rtc.channel.endCall();this.env.services['notification'].notify({message:this.env._t("Disconnected from the RTC call by the server"),type:'warning',});}}
async _handleNotificationRtcSessionUpdate({id,rtcSessions}){const channel=this.messaging.models['mail.thread'].findFromIdentifyingData({id,model:'mail.channel'});if(!channel){return;}
channel.updateRtcSessions(rtcSessions);}
_handleNotificationMessageDelete({message_ids}){for(const id of message_ids){const message=this.messaging.models['mail.message'].findFromIdentifyingData({id});if(message){message.delete();}}
this.messaging.notificationGroupManager.computeGroups();}
_handleNotificationPartnerMessageNotificationUpdate({elements}){for(const messageData of elements){const message=this.messaging.models['mail.message'].insert(this.messaging.models['mail.message'].convertData(messageData));if(!message.author&&this.messaging.currentPartner){message.update({author:link(this.messaging.currentPartner)});}}
this.messaging.notificationGroupManager.computeGroups();}
_handleNotificationPartnerMarkAsRead({message_ids=[],needaction_inbox_counter}){for(const message_id of message_ids){const message=this.messaging.models['mail.message'].findFromIdentifyingData({id:message_id});if(!message){continue;}
const originThread=message.originThread;if(originThread&&message.isNeedaction){originThread.update({message_needaction_counter:decrement()});}
message.update({isHistory:true,isNeedaction:false,});}
const inbox=this.messaging.inbox;if(needaction_inbox_counter!==undefined){inbox.update({counter:needaction_inbox_counter});}else{inbox.update({counter:decrement(message_ids.length)});}
if(inbox.counter>inbox.cache.fetchedMessages.length){inbox.cache.update({hasToLoadMessages:true});}}
_handleNotificationPartnerToggleStar({message_ids=[],starred}){const starredMailbox=this.messaging.starred;for(const messageId of message_ids){const message=this.messaging.models['mail.message'].findFromIdentifyingData({id:messageId,});if(!message){continue;}
message.update({isStarred:starred});starredMailbox.update({counter:starred?increment():decrement(),});}}
_handleNotificationPartnerTransientMessage(data){const convertedData=this.messaging.models['mail.message'].convertData(data);const lastMessageId=this.messaging.models['mail.message'].all().reduce((lastMessageId,message)=>Math.max(lastMessageId,message.id),0);const partnerRoot=this.messaging.partnerRoot;const message=this.messaging.models['mail.message'].create(Object.assign(convertedData,{author:link(partnerRoot),id:lastMessageId+0.01,isTransient:true,}));this._notifyThreadViewsMessageReceived(message);}
_handleNotificationChannelLeave({id}){const channel=this.messaging.models['mail.thread'].findFromIdentifyingData({id,model:'mail.channel',});if(!channel){return;}
const message=_.str.sprintf(this.env._t("You unsubscribed from %s."),channel.displayName);this.env.services['notification'].notify({message,type:'info'});channel.update({isServerPinned:false,members:unlink(this.messaging.currentPartner)});}
_handleNotificationChannelUnpin({id}){const channel=this.messaging.models['mail.thread'].findFromIdentifyingData({id,model:'mail.channel',});if(!channel){return;}
const message=_.str.sprintf(this.env._t("You unpinned your conversation with %s."),channel.displayName);this.env.services['notification'].notify({message,type:'info'});channel.update({isServerPinned:false,members:unlink(this.messaging.currentPartner)});}
async _handleNotificationPartnerUserConnection({partnerId,username}){const message=_.str.sprintf(this.env._t('%s connected'),username);const title=this.env._t("This is their first connection. Wish them luck.");this.env.services['bus_service'].sendNotification({message,title,type:'info'});const chat=await this.async(()=>this.messaging.getChat({partnerId}));if(!chat||this.messaging.device.isMobile){return;}
this.messaging.chatWindowManager.openThread(chat);}
_notifyNewChannelMessageWhileOutOfFocus({channel,message}){const author=message.author;const messaging=this.messaging;let notificationTitle;if(!author){notificationTitle=this.env._t("New message");}else{if(channel.channel_type==='channel'){const channelIcon=this.env.qweb.renderToString('mail.ThreadIcon',{env:this.env,thread:channel,});const channelName=channel.displayName;const channelNameWithIcon=channelIcon+channelName;notificationTitle=_.str.sprintf(this.env._t("%s from %s"),author.nameOrDisplayName,channelNameWithIcon);}else{notificationTitle=author.nameOrDisplayName;}}
const notificationContent=owl.utils.escape(htmlToTextContentInline(message.body).substr(0,PREVIEW_MSG_MAX_SIZE));this.env.services['bus_service'].sendNotification({message:notificationContent,title:notificationTitle,type:'info',});messaging.update({outOfFocusUnreadMessageCounter:increment()});const titlePattern=messaging.outOfFocusUnreadMessageCounter===1?this.env._t("%d Message"):this.env._t("%d Messages");this.env.bus.trigger('set_title_part',{part:'_chat',title:_.str.sprintf(titlePattern,messaging.outOfFocusUnreadMessageCounter),});}
_notifyThreadViewsMessageReceived(message){for(const thread of message.threads){for(const threadView of thread.threadViews){threadView.addComponentHint('message-received',{message});}}}}
MessagingNotificationHandler.identifyingFields=['messaging'];MessagingNotificationHandler.modelName='mail.messaging_notification_handler';return MessagingNotificationHandler;}
registerNewModel('mail.messaging_notification_handler',factory);return __exports;});;

/* /mail/static/src/models/model/model.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/model/model',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{RecordDeletedError}=require('@mail/model/model_errors');const{many2one}=require('@mail/model/model_field');const{insertAndReplace}=require('@mail/model/model_field_command');function factory(){class Model{constructor({localId,valid=false}={}){if(!valid){throw new Error("Record must always be instantiated from static method 'create()'");}
Object.assign(this,{localId,__listeners:[],__values:{},});}
_willCreate(){}
_created(){}
_willDelete(){}
static all(filterFunc){return this.modelManager.all(this,filterFunc);}
static create(data){return this.modelManager.create(this,data);}
static get env(){return this.modelManager.env;}
static find(findFunc){return this.modelManager.find(this,findFunc);}
static findFromIdentifyingData(data){return this.modelManager.findFromIdentifyingData(this,data);}
static get(localId,{isCheckingInheritance}={}){return this.modelManager.get(this,localId,{isCheckingInheritance});}
static insert(data={}){return this.modelManager.insert(this,data);}
static get messaging(){return this.modelManager.messaging;}
static get models(){return this.modelManager.models;}
static toString(){return`model(${this.modelName})`;}
async async(func){return new Promise((resolve,reject)=>{Promise.resolve(func()).then(result=>{if(this.exists()){resolve(result);}else{reject(new RecordDeletedError(this.localId));}}).catch(error=>{if(this.exists()){reject(error);}else{reject(new RecordDeletedError(this.localId));}});});}
delete(){this.modelManager.delete(this);}
get env(){return this.modelManager.env;}
exists(){return this.modelManager.exists(this.constructor,this);}
get modelManager(){return this.constructor.modelManager;}
get models(){return this.modelManager.models;}
toString(){return`record(${this.localId})`;}
update(data={}){this.modelManager.update(this,data);}}
Model.fields={messaging:many2one('mail.messaging',{default:insertAndReplace(),inverse:'allRecords',readonly:true,required:true,}),};Model.identifyingFields=['messaging'];Model.modelName='mail.model';return Model;}
registerNewModel('mail.model',factory);return __exports;});;

/* /mail/static/src/models/notification/notification.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/notification/notification',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one}=require('@mail/model/model_field');const{insert,unlinkAll}=require('@mail/model/model_field_command');function factory(dependencies){class Notification extends dependencies['mail.model']{static convertData(data){const data2={};if('failure_type'in data){data2.failure_type=data.failure_type;}
if('id'in data){data2.id=data.id;}
if('notification_status'in data){data2.notification_status=data.notification_status;}
if('notification_type'in data){data2.notification_type=data.notification_type;}
if('res_partner_id'in data){if(!data.res_partner_id){data2.partner=unlinkAll();}else{data2.partner=insert({display_name:data.res_partner_id[1],id:data.res_partner_id[0],});}}
return data2;}}
Notification.fields={failure_type:attr(),id:attr({readonly:true,required:true,}),message:many2one('mail.message',{inverse:'notifications',}),notification_status:attr(),notification_type:attr(),partner:many2one('mail.partner'),};Notification.identifyingFields=['id'];Notification.modelName='mail.notification';return Notification;}
registerNewModel('mail.notification',factory);return __exports;});;

/* /mail/static/src/models/notification_group/notification_group.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/notification_group/notification_group',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one,one2many}=require('@mail/model/model_field');const{clear,insert,unlink}=require('@mail/model/model_field_command');function factory(dependencies){class NotificationGroup extends dependencies['mail.model']{openCancelAction(){if(this.notification_type!=='email'){return;}
this.env.bus.trigger('do-action',{action:'mail.mail_resend_cancel_action',options:{additional_context:{default_model:this.res_model,unread_counter:this.notifications.length,},},});}
openDocuments(){if(this.thread){this.thread.open();}else{this._openDocuments();}}
_computeThread(){const notificationsThreadIds=this.notifications.filter(notification=>notification.message&&notification.message.originThread).map(notification=>notification.message.originThread.id);const threadIds=new Set(notificationsThreadIds);if(threadIds.size!==1){return unlink();}
return insert({id:notificationsThreadIds[0],model:this.res_model,});}
_computeDate(){const dates=this.notifications.filter(notification=>notification.message&&notification.message.date).map(notification=>notification.message.date);if(dates.length===0){return clear();}
return moment.max(dates);}
_computeSequence(){return-Math.max(...this.notifications.map(notification=>notification.message.id));}
_openDocuments(){if(this.notification_type!=='email'){return;}
this.env.bus.trigger('do-action',{action:{name:this.env._t("Mail Failures"),type:'ir.actions.act_window',view_mode:'kanban,list,form',views:[[false,'kanban'],[false,'list'],[false,'form']],target:'current',res_model:this.res_model,domain:[['message_has_error','=',true]],},});if(this.messaging.device.isMobile){this.messaging.messagingMenu.close();}}}
NotificationGroup.fields={date:attr({compute:'_computeDate',}),id:attr({readonly:true,required:true,}),notification_type:attr(),notifications:one2many('mail.notification'),res_model:attr(),res_model_name:attr(),sequence:attr({compute:'_computeSequence',default:0,}),thread:many2one('mail.thread',{compute:'_computeThread',})};NotificationGroup.identifyingFields=['id'];NotificationGroup.modelName='mail.notification_group';return NotificationGroup;}
registerNewModel('mail.notification_group',factory);return __exports;});;

/* /mail/static/src/models/notification_group_manager/notification_group_manager.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/notification_group_manager/notification_group_manager',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{one2many}=require('@mail/model/model_field');const{link}=require('@mail/model/model_field_command');function factory(dependencies){class NotificationGroupManager extends dependencies['mail.model']{computeGroups(){if(this.messaging.isCurrentUserGuest){return;}
for(const group of this.groups){group.delete();}
const groups=[];this.messaging.currentPartner.failureNotifications.forEach(notification=>{const thread=notification.message.originThread;const channelId=thread.model==='mail.channel'?thread.id:null;const id=`${thread.model}/${channelId}/${notification.notification_type}`;const group=this.messaging.models['mail.notification_group'].insert({id,notification_type:notification.notification_type,res_model:thread.model,res_model_name:thread.model_name,});group.update({notifications:link(notification)});if(!groups.includes(group)){groups.push(group);}});this.update({groups:link(groups)});}}
NotificationGroupManager.fields={groups:one2many('mail.notification_group'),};NotificationGroupManager.identifyingFields=['messaging'];NotificationGroupManager.modelName='mail.notification_group_manager';return NotificationGroupManager;}
registerNewModel('mail.notification_group_manager',factory);return __exports;});;

/* /mail/static/src/models/partner/partner.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/partner/partner',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one,one2many,one2one}=require('@mail/model/model_field');const{insert,link,unlinkAll}=require('@mail/model/model_field_command');const{cleanSearchTerm}=require('@mail/utils/utils');function factory(dependencies){class Partner extends dependencies['mail.model']{static convertData(data){const data2={};if('active'in data){data2.active=data.active;}
if('country'in data){if(!data.country){data2.country=unlinkAll();}else{data2.country=insert({id:data.country[0],name:data.country[1],});}}
if('display_name'in data){data2.display_name=data.display_name;}
if('email'in data){data2.email=data.email;}
if('id'in data){data2.id=data.id;}
if('is_muted'in data){data2.isMuted=data.is_muted;}
if('im_status'in data){data2.im_status=data.im_status;}
if('name'in data){data2.name=data.name;}
if('user_id'in data){if(!data.user_id){data2.user=unlinkAll();}else{let user={};if(Array.isArray(data.user_id)){user={id:data.user_id[0],display_name:data.user_id[1],};}else{user={id:data.user_id,};}
user.isInternalUser=data.is_internal_user;data2.user=insert(user);}}
return data2;}
static async fetchSuggestions(searchTerm,{thread}={}){const kwargs={search:searchTerm};const isNonPublicChannel=thread&&thread.model==='mail.channel'&&thread.public!=='public';if(isNonPublicChannel){kwargs.channel_id=thread.id;}
const suggestedPartners=await this.env.services.rpc({model:'res.partner',method:'get_mention_suggestions',kwargs,},{shadow:true},);const partners=this.messaging.models['mail.partner'].insert(suggestedPartners.map(data=>this.messaging.models['mail.partner'].convertData(data)));if(isNonPublicChannel){thread.update({members:link(partners)});}}
static async imSearch({callback,keyword,limit=10}){let partners=[];const cleanedSearchTerm=cleanSearchTerm(keyword);const currentPartner=this.messaging.currentPartner;for(const partner of this.all(partner=>partner.active)){if(partners.length<limit){if(partner!==currentPartner&&partner.name&&partner.user&&cleanSearchTerm(partner.name).includes(cleanedSearchTerm)){partners.push(partner);}}}
if(!partners.length){const partnersData=await this.env.services.rpc({model:'res.partner',method:'im_search',args:[keyword,limit]},{shadow:true});const newPartners=this.insert(partnersData.map(partnerData=>this.convertData(partnerData)));partners.push(...newPartners);}
callback(partners);}
static searchSuggestions(searchTerm,{thread}={}){let partners;const isNonPublicChannel=thread&&thread.model==='mail.channel'&&thread.public!=='public';if(isNonPublicChannel){partners=thread.members;}else{partners=this.messaging.models['mail.partner'].all();}
const cleanedSearchTerm=cleanSearchTerm(searchTerm);const mainSuggestionList=[];const extraSuggestionList=[];for(const partner of partners){if((!partner.active&&partner!==this.messaging.partnerRoot)||partner.id<=0||this.messaging.publicPartners.includes(partner)){continue;}
if((partner.nameOrDisplayName&&cleanSearchTerm(partner.nameOrDisplayName).includes(cleanedSearchTerm))||(partner.email&&cleanSearchTerm(partner.email).includes(cleanedSearchTerm))){if(partner.user){mainSuggestionList.push(partner);}else{extraSuggestionList.push(partner);}}}
return[mainSuggestionList,extraSuggestionList];}
static async startLoopFetchImStatus(){await this._fetchImStatus();this._loopFetchImStatus();}
async checkIsUser(){const userIds=await this.async(()=>this.env.services.rpc({model:'res.users',method:'search',args:[[['partner_id','=',this.id]]],kwargs:{context:{active_test:false},},},{shadow:true}));this.update({hasCheckedUser:true});if(userIds.length>0){this.update({user:insert({id:userIds[0]})});}}
async getChat(){if(!this.user&&!this.hasCheckedUser){await this.async(()=>this.checkIsUser());}
if(!this.user){this.env.services['notification'].notify({message:this.env._t("You can only chat with partners that have a dedicated user."),type:'info',});return;}
return this.user.getChat();}
getMentionText(){return this.name;}
static getSuggestionSortFunction(searchTerm,{thread}={}){const cleanedSearchTerm=cleanSearchTerm(searchTerm);return(a,b)=>{const isAInternalUser=a.user&&a.user.isInternalUser;const isBInternalUser=b.user&&b.user.isInternalUser;if(isAInternalUser&&!isBInternalUser){return-1;}
if(!isAInternalUser&&isBInternalUser){return 1;}
if(thread&&thread.model==='mail.channel'){const isAMember=thread.members.includes(a);const isBMember=thread.members.includes(b);if(isAMember&&!isBMember){return-1;}
if(!isAMember&&isBMember){return 1;}}
if(thread){const isAFollower=thread.followersPartner.includes(a);const isBFollower=thread.followersPartner.includes(b);if(isAFollower&&!isBFollower){return-1;}
if(!isAFollower&&isBFollower){return 1;}}
const cleanedAName=cleanSearchTerm(a.nameOrDisplayName||'');const cleanedBName=cleanSearchTerm(b.nameOrDisplayName||'');if(cleanedAName.startsWith(cleanedSearchTerm)&&!cleanedBName.startsWith(cleanedSearchTerm)){return-1;}
if(!cleanedAName.startsWith(cleanedSearchTerm)&&cleanedBName.startsWith(cleanedSearchTerm)){return 1;}
if(cleanedAName<cleanedBName){return-1;}
if(cleanedAName>cleanedBName){return 1;}
const cleanedAEmail=cleanSearchTerm(a.email||'');const cleanedBEmail=cleanSearchTerm(b.email||'');if(cleanedAEmail.startsWith(cleanedSearchTerm)&&!cleanedAEmail.startsWith(cleanedSearchTerm)){return-1;}
if(!cleanedBEmail.startsWith(cleanedSearchTerm)&&cleanedBEmail.startsWith(cleanedSearchTerm)){return 1;}
if(cleanedAEmail<cleanedBEmail){return-1;}
if(cleanedAEmail>cleanedBEmail){return 1;}
return a.id-b.id;};}
async openChat(options){const chat=await this.async(()=>this.getChat());if(!chat){return;}
await this.async(()=>chat.open(options));return chat;}
async openProfile(){return this.messaging.openDocument({id:this.id,model:'res.partner',});}
_computeAvatarUrl(){if(this===this.messaging.partnerRoot){return'/mail/static/src/img/odoobot.png';}
return`/web/image/res.partner/${this.id}/avatar_128`;}
static async _fetchImStatus(){const partnerIds=[];for(const partner of this.all()){if(partner.im_status!=='im_partner'&&partner.id>0){partnerIds.push(partner.id);}}
if(partnerIds.length===0){return;}
const dataList=await this.env.services.rpc({route:'/longpolling/im_status',params:{partner_ids:partnerIds,},},{shadow:true});this.insert(dataList);}
static _loopFetchImStatus(){setTimeout(async()=>{await this._fetchImStatus();this._loopFetchImStatus();},50*1000);}
_computeDisplayName(){return this.display_name||this.user&&this.user.display_name;}
_computeIsOnline(){return['online','away'].includes(this.im_status);}
_computeNameOrDisplayName(){return this.name||this.display_name;}}
Partner.fields={active:attr({default:true,}),avatarUrl:attr({compute:'_computeAvatarUrl',}),country:many2one('mail.country'),display_name:attr({compute:'_computeDisplayName',default:"",}),email:attr(),failureNotifications:one2many('mail.notification',{related:'messagesAsAuthor.failureNotifications',}),hasCheckedUser:attr({default:false,}),id:attr({readonly:true,required:true,}),im_status:attr(),isOnline:attr({compute:'_computeIsOnline',}),isMuted:attr({default:false,}),memberThreads:many2many('mail.thread',{inverse:'members',}),messagesAsAuthor:one2many('mail.message',{inverse:'author',}),model:attr({default:'res.partner',}),name:attr(),nameOrDisplayName:attr({compute:'_computeNameOrDisplayName',}),partnerSeenInfos:one2many('mail.thread_partner_seen_info',{inverse:'partner',isCausal:true,}),rtcSessions:one2many('mail.rtc_session',{inverse:'partner',}),user:one2one('mail.user',{inverse:'partner',}),volumeSetting:one2one('mail.volume_setting',{inverse:'partner',}),};Partner.identifyingFields=['id'];Partner.modelName='mail.partner';return Partner;}
registerNewModel('mail.partner',factory);return __exports;});;

/* /mail/static/src/models/popover_view/popover_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/popover_view/popover_view',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,one2one}=require('@mail/model/model_field');const{clear}=require('@mail/model/model_field_command');function factory(dependencies){class PopoverView extends dependencies['mail.model']{_created(){this._onClickCaptureGlobal=this._onClickCaptureGlobal.bind(this);document.addEventListener('click',this._onClickCaptureGlobal,true);}
_willDelete(){document.removeEventListener('click',this._onClickCaptureGlobal,true);}
_computeAnchorRef(){if(this.threadViewTopbarOwner){return this.threadViewTopbarOwner.inviteButtonRef;}
return clear();}
_computePosition(){if(this.threadViewTopbarOwner){return'bottom';}
return clear();}
_onClickCaptureGlobal(ev){if(!this.component||!this.component.el){return;}
if(this.anchorRef&&this.anchorRef.el&&this.anchorRef.el.contains(ev.target)){return;}
if(this.component.el.contains(ev.target)){return;}
this.delete();}}
PopoverView.fields={anchorRef:attr({compute:'_computeAnchorRef',required:true,}),channelInvitationForm:one2one('mail.channel_invitation_form',{inverse:'popoverView',isCausal:true,readonly:true,required:true,}),component:attr(),position:attr({compute:'_computePosition',default:'top',}),threadViewTopbarOwner:one2one('mail.thread_view_topbar',{inverse:'invitePopoverView',readonly:true,}),};PopoverView.identifyingFields=['threadViewTopbarOwner','channelInvitationForm'];PopoverView.modelName='mail.popover_view';return PopoverView;}
registerNewModel('mail.popover_view',factory);return __exports;});;

/* /mail/static/src/models/rtc/rtc.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/rtc/rtc',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registerNewModel}=require('@mail/model/model_core');const{attr,one2many,one2one}=require('@mail/model/model_field');const{clear,insert,unlink}=require('@mail/model/model_field_command');const{monitorAudio}=require('@mail/utils/media_monitoring/media_monitoring');const TRANSCEIVER_ORDER=['audio','video'];function factory(dependencies){const getRTCPeerNotificationNextTemporaryId=(function(){let tmpId=0;return()=>{tmpId+=1;return tmpId;};})();class Rtc extends dependencies['mail.model']{_created(){super._created();this._dataChannels={};this._disconnectAudioMonitor=undefined;this._fallBackTimeouts={};this._outGoingCallTokens=new Set();this._peerConnections={};this._pushToTalkTimeoutId=undefined;this._onKeyDown=this._onKeyDown.bind(this);this._onKeyUp=this._onKeyUp.bind(this);browser.addEventListener('keydown',this._onKeyDown);browser.addEventListener('keyup',this._onKeyUp);this._onBeforeUnload=this._onBeforeUnload.bind(this);browser.addEventListener('beforeunload',this._onBeforeUnload);this._intervalId=browser.setInterval(async()=>{if(!this.currentRtcSession||!this.channel){return;}
await this._pingServer();if(!this.currentRtcSession||!this.channel){return;}
this._callSessions();},30000);}
async _willDelete(){browser.removeEventListener('beforeunload',this._onBeforeUnload);browser.removeEventListener('keydown',this._onKeyDown);browser.removeEventListener('keyup',this._onKeyUp);browser.clearInterval(this._intervalId);return super._willDelete(...arguments);}
async filterCallees(currentSessions){const currentSessionsTokens=new Set(currentSessions.map(session=>session.peerToken));for(const token of Object.keys(this._peerConnections)){if(!currentSessionsTokens.has(token)){this._addLogEntry(token,'session removed from the server');this._removePeer(token);}}
if(this.channel&&this.currentRtcSession&&!currentSessionsTokens.has(this.currentRtcSession.peerToken)){this.channel.endCall();}}
filterIncomingVideoTraffic(allowedTokens){const tokenSet=new Set(allowedTokens);for(const[token,peerConnection]of Object.entries(this._peerConnections)){const fullDirection=this.videoTrack?'sendrecv':'recvonly';const limitedDirection=this.videoTrack?'sendonly':'inactive';const transceiver=this._getTransceiver(peerConnection,'video');if(!transceiver){continue;}
if(!tokenSet.size||tokenSet.has(token)){transceiver.direction=fullDirection;}else{transceiver.direction=limitedDirection;}}}
async handleNotification(sender,content){const{event,channelId,payload}=JSON.parse(content);const rtcSession=this.messaging.models['mail.rtc_session'].findFromIdentifyingData({id:sender});if(!rtcSession||rtcSession.channel!==this.channel){return;}
if(!this.isClientRtcCompatible){return;}
if(!this._peerConnections[sender]&&(!channelId||!this.channel||channelId!==this.channel.id)){return;}
switch(event){case"offer":this._addLogEntry(sender,`received notification: ${event}`,{step:'received offer'});await this._handleRtcTransactionOffer(rtcSession.peerToken,payload);break;case"answer":this._addLogEntry(sender,`received notification: ${event}`,{step:'received answer'});await this._handleRtcTransactionAnswer(rtcSession.peerToken,payload);break;case"ice-candidate":await this._handleRtcTransactionICECandidate(rtcSession.peerToken,payload);break;case"disconnect":this._addLogEntry(sender,`received notification: ${event}`,{step:' peer cleanly disconnected '});this._removePeer(rtcSession.peerToken);break;case'trackChange':this._handleTrackChange(rtcSession,payload);break;}}
async initSession({currentSessionId,iceServers,startWithAudio,startWithVideo,videoType='user-video'}){this.reset();this.update({currentRtcSession:insert({id:currentSessionId}),iceServers:iceServers||this.iceServers,});await this._callSessions();await this.updateLocalAudioTrack(startWithAudio);if(startWithVideo){await this._toggleVideoBroadcast({type:videoType});}}
reset(){if(this._peerConnections){const peerTokens=Object.keys(this._peerConnections);for(const token of peerTokens){this._removePeer(token);}}
this._disconnectAudioMonitor&&this._disconnectAudioMonitor();this.audioTrack&&this.audioTrack.stop();this.videoTrack&&this.videoTrack.stop();this._disconnectAudioMonitor=undefined;this._dataChannels={};this._fallBackTimeouts={};this._outGoingCallTokens=new Set();this._peerConnections={};this.update({currentRtcSession:clear(),logs:clear(),sendUserVideo:clear(),sendDisplay:clear(),videoTrack:clear(),audioTrack:clear(),});}
async toggleMicrophone({requestAudioDevice=true}={}){const shouldMute=this.currentRtcSession.isDeaf||!this.currentRtcSession.isMuted;this.currentRtcSession.updateAndBroadcast({isMuted:shouldMute||!this.audioTrack});if(!this.audioTrack&&!shouldMute&&requestAudioDevice){await this.updateLocalAudioTrack(true);}
await this.async(()=>this._updateLocalAudioTrackEnabledState());}
async toggleScreenShare(){this._toggleVideoBroadcast({type:'display'});}
async toggleUserVideo(){this._toggleVideoBroadcast({type:'user-video'});}
async updateLocalAudioTrack(audio){if(this.audioTrack){this.audioTrack.stop();}
this.update({audioTrack:clear()});if(!this.channel){return;}
if(audio){let audioTrack;try{const audioStream=await browser.navigator.mediaDevices.getUserMedia({audio:this.messaging.userSetting.getAudioConstraints()});audioTrack=audioStream.getAudioTracks()[0];}catch(e){this.env.services.notification.notify({message:_.str.sprintf(this.env._t(`"%s" requires microphone access`),window.location.host,),type:'warning',});if(this.currentRtcSession){this.currentRtcSession.updateAndBroadcast({isMuted:true});}
return;}
if(!this.currentRtcSession){audioTrack.stop();return;}
audioTrack.addEventListener('ended',async()=>{await this.async(()=>this.updateLocalAudioTrack(false));this.currentRtcSession.updateAndBroadcast({isMuted:true});await this.async(()=>this._updateLocalAudioTrackEnabledState());});this.currentRtcSession.updateAndBroadcast({isMuted:false});audioTrack.enabled=!this.currentRtcSession.isMuted&&this.currentRtcSession.isTalking;this.update({audioTrack});await this.async(()=>this.updateVoiceActivation());for(const[token,peerConnection]of Object.entries(this._peerConnections)){await this._updateRemoteTrack(peerConnection,'audio',{token});}}}
updateVideoConfig(constraints){const videoConfig=Object.assign(this.videoConfig,constraints);this.update({videoConfig});this.videoTrack&&this.videoTrack.applyConstraints(this.videoConfig);}
async updateVoiceActivation(){this._disconnectAudioMonitor&&this._disconnectAudioMonitor();if(this.messaging.userSetting.usePushToTalk||!this.channel||!this.audioTrack){this.currentRtcSession.update({isTalking:false});await this._updateLocalAudioTrackEnabledState();return;}
try{this._disconnectAudioMonitor=await monitorAudio(this.audioTrack,{onThreshold:async(isAboveThreshold)=>{this._setSoundBroadcast(isAboveThreshold);},volumeThreshold:this.messaging.userSetting.voiceActivationThreshold,});}catch(e){this.env.services.notification.notify({message:this.env._t("Your browser does not support voice activation"),type:'warning',});this.currentRtcSession.update({isTalking:true});}
await this._updateLocalAudioTrackEnabledState();}
_addLogEntry(token,entry,{error,step,state}={}){if(!this.modelManager.isDebug){return;}
if(!(token in this.logs)){this.logs[token]={step:'',state:'',logs:[]};}
const trace=window.Error().stack||'';this.logs[token].logs.push({event:`${window.moment().format('h:mm:ss')}: ${entry}`,error:error&&{name:error.name,message:error.message,stack:error.stack&&error.stack.split('\n'),},trace:trace.split('\n'),});if(step){this.logs[token].step=step;}
if(state){this.logs[token].state=state;}}
async _callPeer(token){const peerConnection=this._createPeerConnection(token);for(const trackKind of TRANSCEIVER_ORDER){await this._updateRemoteTrack(peerConnection,trackKind,{initTransceiver:true,token});}
this._outGoingCallTokens.add(token);}
_callSessions(){if(!this.channel.rtcSessions){return;}
for(const session of this.channel.rtcSessions){if(session.peerToken in this._peerConnections){continue;}
if(session===this.currentRtcSession){continue;}
session.update({connectionState:'Not connected: sending initial RTC offer',});this._addLogEntry(session.peerToken,'init call',{step:'init call'});this._callPeer(session.peerToken);}}
_computeIsClientRtcCompatible(){return window.RTCPeerConnection&&window.MediaStream;}
_createPeerConnection(token){const peerConnection=new window.RTCPeerConnection({iceServers:this.iceServers});this._addLogEntry(token,`RTCPeerConnection created`,{step:'peer connection created'});peerConnection.onicecandidate=async(event)=>{if(!event.candidate){return;}
await this._notifyPeers([token],{event:'ice-candidate',payload:{candidate:event.candidate},});};peerConnection.oniceconnectionstatechange=(event)=>{this._onICEConnectionStateChange(peerConnection.iceConnectionState,token);};peerConnection.onconnectionstatechange=(event)=>{this._onConnectionStateChange(peerConnection.connectionState,token);};peerConnection.onicecandidateerror=async(error)=>{this._addLogEntry(token,`ice candidate error`);this._recoverConnection(token,{delay:this.recoveryTimeout,reason:'ice candidate error'});};peerConnection.onnegotiationneeded=async(event)=>{const offer=await peerConnection.createOffer();try{await peerConnection.setLocalDescription(offer);}catch(e){this._addLogEntry(token,`couldn't setLocalDescription`,{error:e});return;}
this._addLogEntry(token,`sending notification: offer`,{step:'sending offer'});await this._notifyPeers([token],{event:'offer',payload:{sdp:peerConnection.localDescription},});};peerConnection.ontrack=({transceiver,track})=>{this._addLogEntry(token,`received ${track.kind} track`);this._updateExternalSessionTrack(track,token);};const dataChannel=peerConnection.createDataChannel("notifications",{negotiated:true,id:1});dataChannel.onmessage=(event)=>{this.handleNotification(token,event.data);};dataChannel.onopen=async()=>{try{await this._notifyPeers([token],{event:'trackChange',type:'peerToPeer',payload:{type:'audio',state:{isTalking:this.currentRtcSession.isTalking,isMuted:this.currentRtcSession.isMuted},},});}catch(e){if(!(e instanceof DOMException)||e.name!=="OperationError"){throw e;}
this._addLogEntry(token,`failed to send on datachannel; dataChannelInfo: ${this._serializeRTCDataChannel(dataChannel)}`,{error:e});}};this._peerConnections[token]=peerConnection;this._dataChannels[token]=dataChannel;return peerConnection;}
_getTransceiver(peerConnection,trackKind){const transceivers=peerConnection.getTransceivers();return transceivers[TRANSCEIVER_ORDER.indexOf(trackKind)];}
async _handleRtcTransactionAnswer(fromToken,{sdp}){const peerConnection=this._peerConnections[fromToken];if(!peerConnection||this.invalidIceConnectionStates.has(peerConnection.iceConnectionState)||peerConnection.signalingState==='stable'){return;}
if(peerConnection.signalingState==='have-remote-offer'){return;}
const rtcSessionDescription=new window.RTCSessionDescription(sdp);try{await peerConnection.setRemoteDescription(rtcSessionDescription);}catch(e){this._addLogEntry(fromToken,'answer handling: Failed at setting remoteDescription',{error:e});}}
async _handleRtcTransactionICECandidate(fromToken,{candidate}){const peerConnection=this._peerConnections[fromToken];if(!peerConnection||this.invalidIceConnectionStates.has(peerConnection.iceConnectionState)){return;}
const rtcIceCandidate=new window.RTCIceCandidate(candidate);try{await peerConnection.addIceCandidate(rtcIceCandidate);}catch(error){this._addLogEntry(fromToken,'ICE candidate handling: failed at adding the candidate to the connection',{error});this._recoverConnection(fromToken,{delay:this.recoveryTimeout,reason:'failed at adding ice candidate'});}}
async _handleRtcTransactionOffer(fromToken,{sdp}){const peerConnection=this._peerConnections[fromToken]||this._createPeerConnection(fromToken);if(!peerConnection||this.invalidIceConnectionStates.has(peerConnection.iceConnectionState)){return;}
if(peerConnection.signalingState==='have-remote-offer'){return;}
const rtcSessionDescription=new window.RTCSessionDescription(sdp);try{await peerConnection.setRemoteDescription(rtcSessionDescription);}catch(e){this._addLogEntry(fromToken,'offer handling: failed at setting remoteDescription',{error:e});return;}
await this._updateRemoteTrack(peerConnection,'audio',{token:fromToken});await this._updateRemoteTrack(peerConnection,'video',{token:fromToken});let answer;try{answer=await peerConnection.createAnswer();}catch(e){this._addLogEntry(fromToken,'offer handling: failed at creating answer',{error:e});return;}
try{await peerConnection.setLocalDescription(answer);}catch(e){this._addLogEntry(fromToken,'offer handling: failed at setting localDescription',{error:e});return;}
this._addLogEntry(fromToken,`sending notification: answer`,{step:'sending answer'});await this._notifyPeers([fromToken],{event:'answer',payload:{sdp:peerConnection.localDescription},});this._recoverConnection(fromToken,{delay:this.recoveryTimeout,reason:'standard answer timeout'});}
_handleTrackChange(rtcSession,{type,state}){const{isMuted,isTalking,isSendingVideo,isDeaf}=state;if(type==='audio'){if(!rtcSession.audioStream){return;}
rtcSession.update({isMuted,isTalking,isDeaf,});}
if(type==='video'&&isSendingVideo===false){rtcSession.update({videoStream:clear()});}}
async _notifyPeers(targetTokens,{event,payload,type='server'}){if(!targetTokens.length||!this.channel||!this.currentRtcSession){return;}
if(type==='server'){this.update({peerNotificationsToSend:insert({channelId:this.channel.id,event,id:getRTCPeerNotificationNextTemporaryId(),payload,senderId:this.currentRtcSession.id,targetTokens}),});await this._sendPeerNotifications();}
if(type==='peerToPeer'){for(const token of targetTokens){const dataChannel=this._dataChannels[token];if(!dataChannel||dataChannel.readyState!=='open'){continue;}
dataChannel.send(JSON.stringify({event,channelId:this.channel.id,payload,}));}}}
async _pingServer(){const channel=this.channel;const{rtcSessions}=await this.env.services.rpc({route:'/mail/channel/ping',params:{'channel_id':channel.id,'check_rtc_session_ids':channel.rtcSessions.map(rtcSession=>rtcSession.id),'rtc_session_id':this.currentRtcSession.id,},},{shadow:true});if(channel.exists()){channel.updateRtcSessions(rtcSessions);}}
_recoverConnection(token,{delay=0,reason=''}={}){if(this._fallBackTimeouts[token]){return;}
this._fallBackTimeouts[token]=browser.setTimeout(async()=>{delete this._fallBackTimeouts[token];const peerConnection=this._peerConnections[token];if(!peerConnection||!this.channel){return;}
if(this._outGoingCallTokens.has(token)){return;}
if(peerConnection.iceConnectionState==='connected'){return;}
this._addLogEntry(token,`calling back to recover ${peerConnection.iceConnectionState} connection, reason: ${reason}`);await this._notifyPeers([token],{event:'disconnect',});this._removePeer(token);this._callPeer(token);},delay);}
_removePeer(token){const rtcSession=this.messaging.models['mail.rtc_session'].findFromIdentifyingData({id:token});if(rtcSession){rtcSession.reset();}
const dataChannel=this._dataChannels[token];if(dataChannel){dataChannel.close();}
delete this._dataChannels[token];const peerConnection=this._peerConnections[token];if(peerConnection){this._removeRemoteTracks(peerConnection);peerConnection.close();}
delete this._peerConnections[token];browser.clearTimeout(this._fallBackTimeouts[token]);delete this._fallBackTimeouts[token];this._outGoingCallTokens.delete(token);this._addLogEntry(token,'peer removed',{step:'peer removed'});}
_removeRemoteTracks(peerConnection){const RTCRtpSenders=peerConnection.getSenders();for(const sender of RTCRtpSenders){try{peerConnection.removeTrack(sender);}catch(e){}}
for(const transceiver of peerConnection.getTransceivers()){try{transceiver.stop();}catch(e){}}}
async _sendPeerNotifications(){if(this.isNotifyPeersRPCInProgress){return;}
this.update({isNotifyPeersRPCInProgress:true});await new Promise(resolve=>setTimeout(resolve,this.peerNotificationWaitDelay));const peerNotifications=this.peerNotificationsToSend;try{await this.env.services.rpc({route:'/mail/rtc/session/notify_call_members',params:{'peer_notifications':peerNotifications.map(peerNotification=>[peerNotification.senderId,peerNotification.targetTokens,JSON.stringify({event:peerNotification.event,channelId:peerNotification.channelId,payload:peerNotification.payload,}),],),},},{shadow:true});if(!this.exists()){return;}
this.update({peerNotificationsToSend:unlink(peerNotifications)});}finally{if(this.exists()){this.update({isNotifyPeersRPCInProgress:false});if(this.peerNotificationsToSend.length>0){this._sendPeerNotifications();}}}}
_serializeRTCDataChannel(dataChannel){const toLog=["binaryType","bufferedAmount","bufferedAmountLowThreshold","id","label","maxPacketLifeTime","maxRetransmits","negotiated","ordered","protocol","readyState",];return JSON.stringify(Object.fromEntries(toLog.map(p=>[p,dataChannel[p]])));}
async _setSoundBroadcast(isTalking){if(!this.currentRtcSession){return;}
if(isTalking===this.currentRtcSession.isTalking){return;}
this.currentRtcSession.update({isTalking});if(!this.currentRtcSession.isMuted){await this._updateLocalAudioTrackEnabledState();}}
async _toggleVideoBroadcast(trackOptions){if(!this.channel){return;}
await this._toggleLocalVideoTrack(trackOptions);for(const[token,peerConnection]of Object.entries(this._peerConnections)){await this._updateRemoteTrack(peerConnection,'video',{token});}
if(!this.currentRtcSession){return;}
this.currentRtcSession.updateAndBroadcast({isScreenSharingOn:!!this.sendDisplay,isCameraOn:!!this.sendUserVideo,});}
async _toggleLocalVideoTrack({type,force}){if(type==='user-video'){const sendUserVideo=force!==undefined?force:!this.sendUserVideo;await this._updateLocalVideoTrack(type,sendUserVideo);}
if(type==='display'){const sendDisplay=force!==undefined?force:!this.sendDisplay;await this._updateLocalVideoTrack(type,sendDisplay);}
if(!this.currentRtcSession){return;}
if(!this.videoTrack){this.currentRtcSession.removeVideo();}else{this._updateExternalSessionTrack(this.videoTrack,this.currentRtcSession.peerToken);}}
_updateExternalSessionTrack(track,token){const rtcSession=this.messaging.models['mail.rtc_session'].findFromIdentifyingData({id:token});if(!rtcSession){return;}
const stream=new window.MediaStream();stream.addTrack(track);if(track.kind==='audio'){rtcSession.setAudio({audioStream:stream,isMuted:false,isTalking:false,});}
if(track.kind==='video'){rtcSession.update({videoStream:stream,});}}
async _updateLocalAudioTrackEnabledState(){if(!this.audioTrack){return;}
this.audioTrack.enabled=!this.currentRtcSession.isMuted&&this.currentRtcSession.isTalking;await this._notifyPeers(Object.keys(this._peerConnections),{event:'trackChange',type:'peerToPeer',payload:{type:'audio',state:{isTalking:this.currentRtcSession.isTalking&&!this.currentRtcSession.isMuted,isMuted:this.currentRtcSession.isMuted,isDeaf:this.currentRtcSession.isDeaf,},},});}
async _updateLocalVideoTrack(type,activateVideo){if(this.videoTrack){this.videoTrack.stop();}
this.update({sendDisplay:false,sendUserVideo:false,videoTrack:clear(),});let videoStream;if(!activateVideo){if(type==='display'){this.messaging.soundEffects.screenSharing.play();}
return;}
try{if(type==='user-video'){videoStream=await browser.navigator.mediaDevices.getUserMedia({video:this.videoConfig});}
if(type==='display'){videoStream=await browser.navigator.mediaDevices.getDisplayMedia({video:this.videoConfig});this.messaging.soundEffects.screenSharing.play();}}catch(e){this.env.services.notification.notify({message:_.str.sprintf(this.env._t(`"%s" requires "%s" access`),window.location.host,type==='user-video'?'camera':'display',),type:'warning',});return;}
const videoTrack=videoStream?videoStream.getVideoTracks()[0]:undefined;if(videoTrack){videoTrack.addEventListener('ended',async()=>{await this.async(()=>this._toggleVideoBroadcast({force:false,type}));});}
this.update({videoTrack,sendUserVideo:type==='user-video'&&!!videoTrack,sendDisplay:type==='display'&&!!videoTrack,});}
async _updateRemoteTrack(peerConnection,trackKind,{initTransceiver,token}={}){this._addLogEntry(token,`updating ${trackKind} transceiver`);const track=trackKind==='audio'?this.audioTrack:this.videoTrack;const fullDirection=track?'sendrecv':'recvonly';const limitedDirection=track?'sendonly':'inactive';let transceiverDirection=fullDirection;if(trackKind==='video'){const focusedToken=this.messaging.focusedRtcSession&&this.messaging.focusedRtcSession.peerToken;transceiverDirection=!focusedToken||focusedToken===token?fullDirection:limitedDirection;}
let transceiver;if(initTransceiver){transceiver=peerConnection.addTransceiver(trackKind);}else{transceiver=this._getTransceiver(peerConnection,trackKind);}
if(track){try{await transceiver.sender.replaceTrack(track);transceiver.direction=transceiverDirection;}catch(e){}
return;}
try{await transceiver.sender.replaceTrack(null);transceiver.direction=transceiverDirection;}catch(e){}
if(trackKind==='video'){this._notifyPeers([token],{event:'trackChange',type:'peerToPeer',payload:{type:'video',state:{isSendingVideo:false},},});}}
async _onBeforeUnload(ev){if(this.channel){await this.channel.performRpcLeaveCall();}}
async _onConnectionStateChange(state,token){this._addLogEntry(token,`connection state changed: ${state}`);switch(state){case"closed":this._removePeer(token);break;case"failed":case"disconnected":await this._recoverConnection(token,{delay:this.recoveryDelay,reason:`connection ${state}`});break;}}
async _onICEConnectionStateChange(connectionState,token){this._addLogEntry(token,`ICE connection state changed: ${connectionState}`,{state:connectionState});const rtcSession=this.messaging.models['mail.rtc_session'].findFromIdentifyingData({id:token});if(!rtcSession){return;}
rtcSession.update({connectionState,});switch(connectionState){case"closed":this._removePeer(token);break;case"failed":case"disconnected":await this._recoverConnection(token,{delay:this.recoveryDelay,reason:`ice connection ${connectionState}`});break;}}
_onKeyDown(ev){if(!this.channel){return;}
if(this.messaging.userSetting.rtcConfigurationMenu.isRegisteringKey){return;}
if(!this.messaging.userSetting.usePushToTalk||!this.messaging.userSetting.isPushToTalkKey(ev)){return;}
if(this._pushToTalkTimeoutId){browser.clearTimeout(this._pushToTalkTimeoutId);}
if(!this.currentRtcSession.isTalking&&!this.currentRtcSession.isMuted){this.messaging.soundEffects.pushToTalk.play({volume:0.3});}
this._setSoundBroadcast(true);}
_onKeyUp(ev){if(!this.channel){return;}
if(!this.messaging.userSetting.usePushToTalk||!this.messaging.userSetting.isPushToTalkKey(ev,{ignoreModifiers:true})){return;}
if(!this.currentRtcSession.isTalking){return;}
if(!this.currentRtcSession.isMuted){this.messaging.soundEffects.pushToTalk.play({volume:0.3});}
this._pushToTalkTimeoutId=browser.setTimeout(()=>{this._setSoundBroadcast(false);},this.messaging.userSetting.voiceActiveDuration||0,);}}
Rtc.fields={audioTrack:attr(),channel:one2one('mail.thread',{inverse:'rtc',}),currentRtcSession:one2one('mail.rtc_session',{inverse:'rtc',}),iceServers:attr({default:[{urls:['stun:stun1.l.google.com:19302','stun:stun2.l.google.com:19302',],},],}),invalidIceConnectionStates:attr({default:new Set(['disconnected','failed','closed']),readonly:true,}),isClientRtcCompatible:attr({compute:'_computeIsClientRtcCompatible',default:true,}),isNotifyPeersRPCInProgress:attr({default:false,}),logs:attr({default:{},}),peerNotificationsToSend:one2many('mail.rtc_peer_notification',{isCausal:true,}),peerNotificationWaitDelay:attr({default:50,}),recoveryTimeout:attr({default:15000,}),recoveryDelay:attr({default:3000,}),sendUserVideo:attr({default:false,}),sendDisplay:attr({default:false,}),videoConfig:attr({default:{aspectRatio:16/9,frameRate:{max:30,},},}),videoTrack:attr(),};Rtc.identifyingFields=['messaging'];Rtc.modelName='mail.rtc';return Rtc;}
registerNewModel('mail.rtc',factory);return __exports;});;

/* /mail/static/src/models/rtc_call_participant_card/rtc_call_participant_card.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/rtc_call_participant_card/rtc_call_participant_card',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one,one2one}=require('@mail/model/model_field');const{isEventHandled,markEventHandled}=require('@mail/utils/utils');function factory(dependencies){class RtcCallParticipantCard extends dependencies['mail.model']{_created(){super._created();this.onChangeVolume=this.onChangeVolume.bind(this);this.onClick=this.onClick.bind(this);this.onClickVolumeAnchor=this.onClickVolumeAnchor.bind(this);}
onChangeVolume(ev){this.rtcSession&&this.rtcSession.setVolume(parseFloat(ev.target.value));}
async onClick(ev){if(isEventHandled(ev,'CallParticipantCard.clickVolumeAnchor')){return;}
if(!this.invitedPartner&&!this.invitedGuest){if(!this.isMinimized){this.messaging.toggleFocusedRtcSession(this.rtcSession.id);}
return;}
const channel=this.channel;const channelData=await this.env.services.rpc(({route:'/mail/rtc/channel/cancel_call_invitation',params:{channel_id:this.channel.id,partner_ids:this.invitedPartner&&[this.invitedPartner.id],guest_ids:this.invitedGuest&&[this.invitedGuest.id],},}));if(!channel.exists()){return;}
channel.update(channelData);}
async onClickVolumeAnchor(ev){markEventHandled(ev,'CallParticipantCard.clickVolumeAnchor');}
_computeAvatarUrl(){if(!this.channel){return;}
if(this.rtcSession){return this.rtcSession.avatarUrl;}
if(this.invitedPartner){return`/mail/channel/${this.channel.id}/partner/${this.invitedPartner.id}/avatar_128`;}
if(this.invitedGuest){return`/mail/channel/${this.channel.id}/guest/${this.invitedGuest.id}/avatar_128?unique=${this.invitedGuest.name}`;}}
_computeIsMinimized(){const callViewer=this.rtcCallViewerOfMainCard||this.rtcCallViewerOfTile;return Boolean(callViewer&&callViewer.isMinimized);}
_computeIsInvitation(){return Boolean(this.invitedPartner||this.invitedGuest);}
_computeIsTalking(){return Boolean(this.rtcSession&&this.rtcSession.isTalking&&!this.rtcSession.isMuted);}
_computeName(){if(this.rtcSession){return this.rtcSession.name;}
if(this.invitedPartner){return this.invitedPartner.name;}
if(this.invitedGuest){return this.invitedGuest.name;}}}
RtcCallParticipantCard.fields={avatarUrl:attr({compute:'_computeAvatarUrl',}),channel:many2one('mail.thread',{required:true,}),invitedGuest:many2one('mail.guest'),invitedPartner:many2one('mail.partner'),isInvitation:attr({compute:'_computeIsInvitation'}),isMinimized:attr({default:false,compute:'_computeIsMinimized',}),isTalking:attr({default:false,compute:'_computeIsTalking',}),name:attr({default:'Anonymous',compute:'_computeName',}),relationalId:attr({readonly:true,required:true,}),rtcCallViewerOfMainCard:one2one('mail.rtc_call_viewer',{inverse:'mainParticipantCard',}),rtcCallViewerOfTile:many2one('mail.rtc_call_viewer',{inverse:'tileParticipantCards',}),rtcSession:many2one('mail.rtc_session'),};RtcCallParticipantCard.identifyingFields=['relationalId'];RtcCallParticipantCard.modelName='mail.rtc_call_participant_card';return RtcCallParticipantCard;}
registerNewModel('mail.rtc_call_participant_card',factory);return __exports;});;

/* /mail/static/src/models/rtc_call_viewer/rtc_call_viewer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/rtc_call_viewer/rtc_call_viewer',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registerNewModel}=require('@mail/model/model_core');const{attr,one2one,one2many}=require('@mail/model/model_field');const{OnChange}=require('@mail/model/model_onchange');const{clear,insert,insertAndReplace,link,unlink}=require('@mail/model/model_field_command');const{isEventHandled,markEventHandled}=require('@mail/utils/utils');function factory(dependencies){class RtcCallViewer extends dependencies['mail.model']{_created(){super._created();this._timeoutId=undefined;this.onClick=this.onClick.bind(this);this.onLayoutSettingsDialogClosed=this.onLayoutSettingsDialogClosed.bind(this);this.onMouseMove=this.onMouseMove.bind(this);this.onMouseMoveOverlay=this.onMouseMoveOverlay.bind(this);this.onRtcSettingsDialogClosed=this.onRtcSettingsDialogClosed.bind(this);this._onFullScreenChange=this._onFullScreenChange.bind(this);browser.addEventListener('fullscreenchange',this._onFullScreenChange);}
_willDelete(){browser.clearTimeout(this._timeoutId);browser.removeEventListener('fullscreenchange',this._onFullScreenChange);return super._willDelete(...arguments);}
onClick(ev){this._showOverlay();}
onLayoutSettingsDialogClosed(ev){this.toggleLayoutMenu();}
onMouseMove(ev){if(!this.exists()){return;}
if(isEventHandled(ev,'RtcCallViewer.MouseMoveOverlay')){return;}
this._showOverlay();}
onMouseMoveOverlay(ev){if(!this.exists()){return;}
markEventHandled(ev,'RtcCallViewer.MouseMoveOverlay');this.update({showOverlay:true,});browser.clearTimeout(this._timeoutId);}
onRtcSettingsDialogClosed(ev){this.messaging.userSetting.rtcConfigurationMenu.toggle();}
async activateFullScreen(){const el=document.body;try{if(el.requestFullscreen){await el.requestFullscreen();}else if(el.mozRequestFullScreen){await el.mozRequestFullScreen();}else if(el.webkitRequestFullscreen){await el.webkitRequestFullscreen();}
if(this.exists()){this.update({isFullScreen:true});}}catch(e){if(this.exists()){this.update({isFullScreen:false});}
this.env.services.notification.notify({message:this.env._t("The FullScreen mode was denied by the browser"),type:'warning',});}}
async deactivateFullScreen(){const fullScreenElement=document.webkitFullscreenElement||document.fullscreenElement;if(fullScreenElement){if(document.exitFullscreen){await document.exitFullscreen();}else if(document.mozCancelFullScreen){await document.mozCancelFullScreen();}else if(document.webkitCancelFullScreen){await document.webkitCancelFullScreen();}}
if(this.exists()){this.update({isFullScreen:false});}}
toggleLayoutMenu(){if(!this.rtcLayoutMenu){this.update({rtcLayoutMenu:insertAndReplace()});return;}
this.update({rtcLayoutMenu:unlink()});}
_computeAspectRatio(){const rtcAspectRatio=this.messaging.rtc.videoConfig&&this.messaging.rtc.videoConfig.aspectRatio;const aspectRatio=rtcAspectRatio||16/9;return this.isMinimized?1:aspectRatio;}
_computeIsControllerFloating(){return(this.isFullScreen||this.layout!=="tiled"&&!this.threadView.compact);}
_computeIsMinimized(){if(!this.threadView){return true;}
if(this.isFullScreen||this.threadView.compact){return false;}
return!this.threadView.thread.rtc||this.threadView.thread.videoCount===0;}
_computeLayout(){if(!this.threadView){return'tiled';}
if(this.isMinimized){return'tiled';}
if(!this.threadView.thread.rtc){return'tiled';}
if(!this.mainParticipantCard){return'tiled';}
if(this.threadView.thread.rtcSessions.length+
this.threadView.thread.invitedPartners.length+
this.threadView.thread.invitedGuests.length<2){return"tiled";}
if(this.threadView.compact&&this.messaging.userSetting.rtcLayout==='sidebar'){return'spotlight';}
return this.messaging.userSetting.rtcLayout;}
_computeLayoutSettingsTitle(){return this.env._t("Change Layout");}
_computeMainParticipantCard(){if(!this.messaging||!this.threadView){return unlink();}
if(this.messaging.focusedRtcSession&&this.messaging.focusedRtcSession.channel===this.threadView.thread){return insert({relationalId:`rtc_session_${this.messaging.focusedRtcSession.localId}_${this.threadView.thread.localId}`,rtcSession:link(this.messaging.focusedRtcSession),channel:link(this.threadView.thread),});}
return unlink();}
_computeSettingsTitle(){return this.env._t("Settings");}
_computeTileParticipantCards(){if(!this.threadView){return clear();}
const tileCards=[];const sessionPartners=new Set();const sessionGuests=new Set();for(const rtcSession of this.threadView.thread.rtcSessions){rtcSession.partner&&sessionPartners.add(rtcSession.partner.id);rtcSession.guest&&sessionPartners.add(rtcSession.guest.id);tileCards.push({relationalId:`rtc_session_${rtcSession.localId}_${this.threadView.thread.localId}`,rtcSession:link(rtcSession),channel:link(this.threadView.thread),});}
for(const partner of this.threadView.thread.invitedPartners){if(sessionPartners.has(partner.id)){continue;}
tileCards.push({relationalId:`invited_partner_${partner.localId}_${this.threadView.thread.localId}`,invitedPartner:link(partner),channel:link(this.threadView.thread),});}
for(const guest of this.threadView.thread.invitedGuests){if(sessionGuests.has(guest.id)){continue;}
tileCards.push({relationalId:`invited_guest_${guest.localId}_${this.threadView.thread.localId}`,invitedGuest:link(guest),channel:link(this.threadView.thread),});}
return insertAndReplace(tileCards);}
_debounce(f,{delay=0}={}){browser.clearTimeout(this._timeoutId);this._timeoutId=browser.setTimeout(()=>{if(!this.exists()){return;}
f();},delay);}
_onChangeRtcChannel(){this.deactivateFullScreen();this.update({filterVideoGrid:false});}
_onChangeVideoCount(){if(this.threadView.thread.videoCount===0){this.update({filterVideoGrid:false});}}
_showOverlay(){this.update({showOverlay:true,});this._debounce(()=>{if(!this.exists()){return;}
this.update({showOverlay:false});},{delay:3000});}
_onFullScreenChange(){const fullScreenElement=document.webkitFullscreenElement||document.fullscreenElement;if(fullScreenElement){this.update({isFullScreen:true});return;}
this.update({isFullScreen:false});}}
RtcCallViewer.fields={aspectRatio:attr({default:16/9,compute:'_computeAspectRatio',}),filterVideoGrid:attr({default:false,}),isControllerFloating:attr({default:false,compute:'_computeIsControllerFloating',}),isFullScreen:attr({default:false,}),isMinimized:attr({default:false,compute:'_computeIsMinimized',}),layout:attr({default:'tiled',compute:'_computeLayout',}),layoutSettingsTitle:attr({compute:'_computeLayoutSettingsTitle',}),mainParticipantCard:one2one('mail.rtc_call_participant_card',{compute:'_computeMainParticipantCard',inverse:'rtcCallViewerOfMainCard',}),rtcController:one2one('mail.rtc_controller',{default:insertAndReplace(),readonly:true,required:true,inverse:'callViewer',isCausal:true,}),rtcLayoutMenu:one2one('mail.rtc_layout_menu',{inverse:'callViewer',isCausal:true,}),settingsTitle:attr({compute:'_computeSettingsTitle',}),showOverlay:attr({default:true,}),threadView:one2one('mail.thread_view',{inverse:'rtcCallViewer',readonly:true,required:true,}),tileParticipantCards:one2many('mail.rtc_call_participant_card',{compute:'_computeTileParticipantCards',inverse:'rtcCallViewerOfTile',}),};RtcCallViewer.identifyingFields=['threadView'];RtcCallViewer.onChanges=[new OnChange({dependencies:['threadView.thread.rtc'],methodName:'_onChangeRtcChannel',}),new OnChange({dependencies:['threadView.thread.videoCount'],methodName:'_onChangeVideoCount',}),];RtcCallViewer.modelName='mail.rtc_call_viewer';return RtcCallViewer;}
registerNewModel('mail.rtc_call_viewer',factory);return __exports;});;

/* /mail/static/src/models/rtc_configuration_menu/rtc_configuration_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/rtc_configuration_menu/rtc_configuration_menu',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registerNewModel}=require('@mail/model/model_core');const{attr,one2one}=require('@mail/model/model_field');function factory(dependencies){class RtcConfigurationMenu extends dependencies['mail.model']{_created(){const res=super._created(...arguments);this._onKeyDown=this._onKeyDown.bind(this);this._onKeyUp=this._onKeyUp.bind(this);browser.addEventListener('keydown',this._onKeyDown);browser.addEventListener('keyup',this._onKeyUp);return res;}
_willDelete(){browser.removeEventListener('keydown',this._onKeyDown);browser.removeEventListener('keyup',this._onKeyUp);return super._willDelete(...arguments);}
onChangeDelay(value){this.userSetting.setDelayValue(value);}
onChangePushToTalk(){if(this.userSetting.usePushToTalk){this.update({isRegisteringKey:false,});}
this.userSetting.togglePushToTalk();}
onChangeSelectAudioInput(value){this.userSetting.setAudioInputDevice(value);}
onChangeThreshold(value){this.userSetting.setThresholdValue(parseFloat(value));}
onClickRegisterKeyButton(){this.update({isRegisteringKey:!this.isRegisteringKey,});}
toggle(){this.update({isOpen:!this.isOpen});}
_onKeyDown(ev){if(!this.isRegisteringKey){return;}
ev.stopPropagation();ev.preventDefault();this.userSetting.setPushToTalkKey(ev);}
_onKeyUp(ev){if(!this.isRegisteringKey){return;}
ev.stopPropagation();ev.preventDefault();this.update({isRegisteringKey:false,});}}
RtcConfigurationMenu.fields={isOpen:attr({default:false,}),isRegisteringKey:attr({default:false,}),userSetting:one2one('mail.user_setting',{inverse:'rtcConfigurationMenu',readonly:true,required:true,}),};RtcConfigurationMenu.identifyingFields=['userSetting'];RtcConfigurationMenu.modelName='mail.rtc_configuration_menu';return RtcConfigurationMenu;}
registerNewModel('mail.rtc_configuration_menu',factory);return __exports;});;

/* /mail/static/src/models/rtc_controller/rtc_controller.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/rtc_controller/rtc_controller',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,one2one}=require('@mail/model/model_field');const{insertAndReplace}=require('@mail/model/model_field_command');function factory(dependencies){class RtcController extends dependencies['mail.model']{_created(){super._created();this.onClickCamera=this.onClickCamera.bind(this);this.onClickDeafen=this.onClickDeafen.bind(this);this.onClickMicrophone=this.onClickMicrophone.bind(this);this.onClickRejectCall=this.onClickRejectCall.bind(this);this.onClickScreen=this.onClickScreen.bind(this);this.onClickToggleAudioCall=this.onClickToggleAudioCall.bind(this);this.onClickToggleVideoCall=this.onClickToggleVideoCall.bind(this);}
onClickCamera(ev){this.messaging.rtc.toggleUserVideo();}
async onClickDeafen(ev){await this.messaging.rtc.currentRtcSession.toggleDeaf();}
onClickMicrophone(ev){this.messaging.rtc.toggleMicrophone();}
async onClickRejectCall(ev){if(this.callViewer.threadView.thread.hasPendingRtcRequest){return;}
await this.callViewer.threadView.thread.leaveCall();}
onClickScreen(ev){this.messaging.rtc.toggleScreenShare();}
async onClickToggleAudioCall(ev){if(this.callViewer.threadView.thread.hasPendingRtcRequest){return;}
await this.callViewer.threadView.thread.toggleCall();}
async onClickToggleVideoCall(ev){if(this.callViewer.threadView.thread.hasPendingRtcRequest){return;}
await this.callViewer.threadView.thread.toggleCall({startWithVideo:true,});}
_computeIsSmall(){return Boolean(this.callViewer&&this.callViewer.threadView.compact&&!this.callViewer.isFullScreen);}}
RtcController.fields={callViewer:one2one('mail.rtc_call_viewer',{inverse:'rtcController',readonly:true,required:true,}),isSmall:attr({compute:'_computeIsSmall',}),rtcOptionList:one2one('mail.rtc_option_list',{default:insertAndReplace(),inverse:'rtcController',isCausal:true,required:true,}),};RtcController.identifyingFields=['callViewer'];RtcController.modelName='mail.rtc_controller';return RtcController;}
registerNewModel('mail.rtc_controller',factory);return __exports;});;

/* /mail/static/src/models/rtc_layout_menu/rtc_layout_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/rtc_layout_menu/rtc_layout_menu',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,one2one}=require('@mail/model/model_field');const{clear}=require('@mail/model/model_field_command');function factory(dependencies){class RtcLayoutMenu extends dependencies['mail.model']{_created(){super._created();this.onClickFilter=this.onClickFilter.bind(this);this.onClickLayout=this.onClickLayout.bind(this);}
onClickFilter(ev){ev.preventDefault();switch(ev.target.value){case'all':this.callViewer.update({filterVideoGrid:false,});break;case'video':this.callViewer.update({filterVideoGrid:true,});if(this.messaging.focusedRtcSession&&!this.messaging.focusedRtcSession.videoStream){this.messaging.update({focusedRtcSession:clear()});}
break;}}
onClickLayout(ev){ev.preventDefault();this.messaging.userSetting.update({rtcLayout:ev.target.value,});this.component.trigger('dialog-closed');}}
RtcLayoutMenu.fields={component:attr(),callViewer:one2one('mail.rtc_call_viewer',{inverse:'rtcLayoutMenu',readonly:true,}),};RtcLayoutMenu.identifyingFields=['callViewer'];RtcLayoutMenu.modelName='mail.rtc_layout_menu';return RtcLayoutMenu;}
registerNewModel('mail.rtc_layout_menu',factory);return __exports;});;

/* /mail/static/src/models/rtc_option_list/rtc_option_list.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/rtc_option_list/rtc_option_list',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,one2one}=require('@mail/model/model_field');function factory(dependencies){class RtcOptionList extends dependencies['mail.model']{_created(){super._created();this.onClickDownloadLogs=this.onClickDownloadLogs.bind(this);this.onClickActivateFullScreen=this.onClickActivateFullScreen.bind(this);this.onClickDeactivateFullScreen=this.onClickDeactivateFullScreen.bind(this);this.onClickLayout=this.onClickLayout.bind(this);this.onClickOptions=this.onClickOptions.bind(this);}
async onClickDownloadLogs(ev){const channel=this.rtcController.callViewer.threadView.thread;if(!channel.rtc){return;}
const data=window.JSON.stringify(channel.rtc.logs);const blob=new window.Blob([data],{type:'application/json'});const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`RtcLogs_Channel${channel.id}_Session${channel.rtc.currentRtcSession.id}_${window.moment().format('YYYY-MM-DD_HH-mm')}.json`;a.click();window.URL.revokeObjectURL(url);this.component.trigger('o-popover-close');}
onClickActivateFullScreen(ev){this.rtcController.callViewer.activateFullScreen();this.component.trigger('o-popover-close');}
onClickDeactivateFullScreen(ev){this.rtcController.callViewer.deactivateFullScreen();this.component.trigger('o-popover-close');}
onClickLayout(ev){this.rtcController.callViewer.toggleLayoutMenu();this.component.trigger('o-popover-close');}
onClickOptions(ev){this.messaging.userSetting.rtcConfigurationMenu.toggle();this.component.trigger('o-popover-close');}}
RtcOptionList.fields={component:attr(),rtcController:one2one('mail.rtc_controller',{inverse:'rtcOptionList',readonly:true,required:true,}),};RtcOptionList.identifyingFields=['rtcController'];RtcOptionList.modelName='mail.rtc_option_list';return RtcOptionList;}
registerNewModel('mail.rtc_option_list',factory);return __exports;});;

/* /mail/static/src/models/rtc_peer_notification/rtc_peer_notification.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/rtc_peer_notification/rtc_peer_notification',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr}=require('@mail/model/model_field');function factory(dependencies){class RTCPeerNotification extends dependencies['mail.model']{}
RTCPeerNotification.fields={channelId:attr({readonly:true,required:true,}),event:attr({readonly:true,required:true,}),id:attr({readonly:true,required:true,}),payload:attr({readonly:true,}),senderId:attr({readonly:true,required:true,}),targetTokens:attr({readonly:true,required:true,}),};RTCPeerNotification.identifyingFields=['id'];RTCPeerNotification.modelName='mail.rtc_peer_notification';return RTCPeerNotification;}
registerNewModel('mail.rtc_peer_notification',factory);return __exports;});;

/* /mail/static/src/models/rtc_session/rtc_session.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/rtc_session/rtc_session',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one,one2one,one2many}=require('@mail/model/model_field');const{clear}=require('@mail/model/model_field_command');function factory(dependencies){class RtcSession extends dependencies['mail.model']{_created(){super._created();this._timeoutId=undefined;}
_willDelete(){this.reset();return super._willDelete(...arguments);}
reset(){this._timeoutId&&browser.clearTimeout(this._timeoutId);this._removeAudio();this.removeVideo();this.update({audioElement:clear(),isTalking:clear(),});}
removeVideo(){if(this.videoStream){for(const track of this.videoStream.getTracks()||[]){track.stop();}}
this.update({videoStream:clear(),});}
async setAudio({audioStream,isMuted,isTalking}){const audioElement=this.audioElement||new window.Audio();try{audioElement.srcObject=audioStream;}catch(error){this.update({isAudioInError:true});console.error(error);}
audioElement.load();if(this.partner&&this.partner.volumeSetting){audioElement.volume=this.partner.volumeSetting.volume;}else if(this.guest&&this.guest.volumeSetting){audioElement.volume=this.guest.volumeSetting.volume;}else{audioElement.volume=this.volume;}
audioElement.muted=this.messaging.rtc.currentRtcSession.isDeaf;audioElement.autoplay=true;this.update({audioElement,audioStream,isMuted,isTalking,});try{await audioElement.play();if(!this.exists()){return;}
this.update({isAudioInError:false});}catch(error){if(typeof error==='object'&&error.name==='NotAllowedError'){return;}
if(this.exists()){this.update({isAudioInError:true});}
console.error(error);}}
setVolume(volume){this.update({volume});if(this.audioElement){this.audioElement.volume=volume;}
if(this.isOwnSession){return;}
if(this.partner&&this.partner.volumeSetting){this.partner.volumeSetting.update({volume});}
if(this.guest&&this.guest.volumeSetting){this.guest.volumeSetting.update({volume});}
if(this.messaging.isCurrentUserGuest){return;}
this.messaging.userSetting.saveVolumeSetting({partnerId:this.partner&&this.partner.id,guestId:this.guest&&this.guest.id,volume,});}
async toggleDeaf(){if(!this.rtc){return;}
this.updateAndBroadcast({isDeaf:!this.isDeaf,});for(const session of this.messaging.models['mail.rtc_session'].all()){if(!session.audioElement){continue;}
session.audioElement.muted=this.isDeaf;}
if(this.channel.rtc){await this.async(()=>this.channel.rtc.toggleMicrophone({requestAudioDevice:false,}));}}
updateAndBroadcast(data){if(!this.rtc){return;}
this.update(data);this._debounce(async()=>{if(!this.exists()){return;}
await this.async(()=>{this.env.services.rpc({route:'/mail/rtc/session/update_and_broadcast',params:{session_id:this.id,values:{is_camera_on:this.isCameraOn,is_deaf:this.isDeaf,is_muted:this.isMuted,is_screen_sharing_on:this.isScreenSharingOn,},},},{shadow:true});});},3000);}
_computeAvatarUrl(){if(!this.channel){return;}
if(this.partner){return`/mail/channel/${this.channel.id}/partner/${this.partner.id}/avatar_128`;}
if(this.guest){return`/mail/channel/${this.channel.id}/guest/${this.guest.id}/avatar_128?unique=${this.guest.name}`;}}
_computeIsOwnSession(){if(!this.messaging){return;}
return(this.partner&&this.messaging.currentPartner===this.partner)||(this.guest&&this.messaging.currentGuest===this.guest);}
_computeName(){if(this.partner){return this.partner.name;}
if(this.guest){return this.guest.name;}}
_computePeerToken(){return String(this.id);}
_computeVolume(){if(this.partner&&this.partner.volumeSetting){return this.partner.volumeSetting.volume;}else if(this.guest&&this.guest.volumeSetting){return this.guest.volumeSetting.volume;}
if(this.audioElement){return this.audioElement.volume;}}
_debounce(f,delay){this._timeoutId&&browser.clearTimeout(this._timeoutId);this._timeoutId=browser.setTimeout(()=>{if(!this.exists()){return;}
f();},delay);}
_removeAudio(){if(this.audioStream){for(const track of this.audioStream.getTracks()||[]){track.stop();}}
if(this.audioElement){this.audioElement.pause();try{this.audioElement.srcObject=undefined;}catch(error){}}
this.update({audioStream:clear(),isAudioInError:false,});}}
RtcSession.fields={audioElement:attr(),audioStream:attr(),avatarUrl:attr({compute:'_computeAvatarUrl',}),channel:many2one('mail.thread',{inverse:'rtcSessions',}),connectionState:attr({default:'Waiting for the peer to send a RTC offer',}),guest:many2one('mail.guest',{inverse:'rtcSessions',}),id:attr({readonly:true,required:true,}),calledChannels:one2many('mail.thread',{inverse:'rtcInvitingSession',}),isAudioInError:attr({default:false,}),isCameraOn:attr({default:false,}),isDeaf:attr({default:false,}),isMuted:attr({default:false,}),isOwnSession:attr({compute:'_computeIsOwnSession',}),isScreenSharingOn:attr({default:false,}),isTalking:attr({default:false,}),name:attr({compute:'_computeName',}),partner:many2one('mail.partner',{inverse:'rtcSessions',}),peerToken:attr({compute:'_computePeerToken',}),rtc:one2one('mail.rtc',{inverse:'currentRtcSession',}),videoStream:attr(),volume:attr({default:0.5,compute:'_computeVolume',}),};RtcSession.identifyingFields=['id'];RtcSession.modelName='mail.rtc_session';return RtcSession;}
registerNewModel('mail.rtc_session',factory);return __exports;});;

/* /mail/static/src/models/sound_effect/sound_effect.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/sound_effect/sound_effect',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr}=require('@mail/model/model_field');function factory(dependencies){class SoundEffect extends dependencies['mail.model']{play({loop=false,volume=1}={}){if(typeof(Audio)==="undefined"){return;}
if(!this.audio){const audio=new window.Audio();const ext=audio.canPlayType("audio/ogg; codecs=vorbis")?".ogg":".mp3";audio.src=this.path+this.filename+ext;this.update({audio});}
this.audio.pause();this.audio.currentTime=0;this.audio.loop=loop;this.audio.volume=volume;Promise.resolve(this.audio.play()).catch(()=>{});}
stop(){if(this.audio){this.audio.pause();this.audio.currentTime=0;}}}
SoundEffect.fields={audio:attr(),filename:attr({readonly:true,required:true,}),path:attr({default:'/mail/static/src/audio/',readonly:true,required:true,}),};SoundEffect.identifyingFields=['path','filename'];SoundEffect.modelName='mail.sound_effect';return SoundEffect;}
registerNewModel('mail.sound_effect',factory);return __exports;});;

/* /mail/static/src/models/sound_effects/sound_effects.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/sound_effects/sound_effects',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{one2one}=require('@mail/model/model_field');const{insertAndReplace}=require('@mail/model/model_field_command');function factory(dependencies){class SoundEffects extends dependencies['mail.model']{}
SoundEffects.fields={channelJoin:one2one('mail.sound_effect',{default:insertAndReplace({filename:'channel_01_in'}),isCausal:true,}),channelLeave:one2one('mail.sound_effect',{default:insertAndReplace({filename:'channel_04_out'}),isCausal:true,}),incomingCall:one2one('mail.sound_effect',{default:insertAndReplace({filename:'call_02_in_'}),isCausal:true,}),memberLeave:one2one('mail.sound_effect',{default:insertAndReplace({filename:'channel_01_out'}),isCausal:true,}),newMessage:one2one('mail.sound_effect',{default:insertAndReplace({filename:'dm_02'}),isCausal:true,}),pushToTalk:one2one('mail.sound_effect',{default:insertAndReplace({filename:'dm_01'}),isCausal:true,}),screenSharing:one2one('mail.sound_effect',{default:insertAndReplace({filename:'share_02'}),isCausal:true,}),};SoundEffects.identifyingFields=['messaging'];SoundEffects.modelName='mail.sound_effects';return SoundEffects;}
registerNewModel('mail.sound_effects',factory);return __exports;});;

/* /mail/static/src/models/suggested_recipient_info/suggested_recipient_info.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/suggested_recipient_info/suggested_recipient_info',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one}=require('@mail/model/model_field');function factory(dependencies){class SuggestedRecipientInfo extends dependencies['mail.model']{_computeIsSelected(){return this.partner?this.isSelected:false;}
_computeName(){return this.partner&&this.partner.nameOrDisplayName||this.name;}}
SuggestedRecipientInfo.fields={email:attr({readonly:true,}),id:attr({readonly:true,}),isSelected:attr({compute:'_computeIsSelected',default:true,}),name:attr({compute:'_computeName',}),partner:many2one('mail.partner'),reason:attr(),thread:many2one('mail.thread',{inverse:'suggestedRecipientInfoList',required:true,}),};SuggestedRecipientInfo.identifyingFields=['id'];SuggestedRecipientInfo.modelName='mail.suggested_recipient_info';return SuggestedRecipientInfo;}
registerNewModel('mail.suggested_recipient_info',factory);return __exports;});;

/* /mail/static/src/models/thread/thread.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/thread/thread',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one,one2many,one2one}=require('@mail/model/model_field');const{clear,insert,insertAndReplace,link,replace,unlink,unlinkAll}=require('@mail/model/model_field_command');const{OnChange}=require('@mail/model/model_onchange');const throttle=require('@mail/utils/throttle/throttle')[Symbol.for("default")];const Timer=require('@mail/utils/timer/timer')[Symbol.for("default")];const{cleanSearchTerm}=require('@mail/utils/utils');const mailUtils=require('@mail/js/utils');const{str_to_datetime}=require('web.time');function factory(dependencies){const getSuggestedRecipientInfoNextTemporaryId=(function(){let tmpId=0;return()=>{tmpId+=1;return tmpId;};})();class Thread extends dependencies['mail.model']{_willCreate(){const res=super._willCreate(...arguments);this._currentPartnerInactiveTypingTimer=new Timer(this.env,()=>this.async(()=>{if(this.messaging.currentPartner){return this._onCurrentPartnerInactiveTypingTimeout();}}),5*1000);this._currentPartnerLastNotifiedIsTyping=undefined;this._currentPartnerLongTypingTimer=new Timer(this.env,()=>this.async(()=>this._onCurrentPartnerLongTypingTimeout()),50*1000);this._forceNotifyNextCurrentPartnerTypingStatus=false;this._otherMembersLongTypingTimers=new Map();this._throttleNotifyCurrentPartnerTypingStatus=throttle(this.env,({isTyping})=>this.async(()=>this._notifyCurrentPartnerTypingStatus({isTyping})),2.5*1000);return res;}
_created(){super._created();this.onClick=this.onClick.bind(this);this.onClickLoadMoreMembers=this.onClickLoadMoreMembers.bind(this);}
_willDelete(){this._currentPartnerInactiveTypingTimer.clear();this._currentPartnerLongTypingTimer.clear();this._throttleNotifyCurrentPartnerTypingStatus.clear();for(const timer of this._otherMembersLongTypingTimers.values()){timer.clear();}
if(this.isTemporary){for(const message of this.messages){message.delete();}}
return super._willDelete(...arguments);}
async changeDescription(description){this.update({description});return this.env.services.rpc({model:'mail.channel',method:'channel_change_description',args:[[this.id]],kwargs:{description},});}
static computeLastCurrentPartnerMessageSeenByEveryone(thread=undefined){const threads=thread?[thread]:this.messaging.models['mail.thread'].all();threads.map(localThread=>{localThread.update({lastCurrentPartnerMessageSeenByEveryone:localThread._computeLastCurrentPartnerMessageSeenByEveryone(),});});}
static convertData(data){const data2={};if('avatarCacheKey'in data){data2.avatarCacheKey=data.avatarCacheKey;}
if('defaultDisplayMode'in data){data2.defaultDisplayMode=data.defaultDisplayMode;}
if('description'in data){data2.description=data.description;}
if('model'in data){data2.model=data.model;}
if('channel_type'in data){data2.channel_type=data.channel_type;data2.model='mail.channel';}
if('create_uid'in data){data2.creator=insert({id:data.create_uid});}
if('custom_channel_name'in data){data2.custom_channel_name=data.custom_channel_name;}
if('group_based_subscription'in data){data2.group_based_subscription=data.group_based_subscription;}
if('id'in data){data2.id=data.id;}
if('invitedGuests'in data){data2.invitedGuests=data.invitedGuests;}
if('invitedPartners'in data){data2.invitedPartners=data.invitedPartners;}
if('is_minimized'in data&&'state'in data){data2.serverFoldState=data.is_minimized?data.state:'closed';}
if('is_pinned'in data){data2.isServerPinned=data.is_pinned;}
if('last_interest_dt'in data&&data.last_interest_dt){data2.lastInterestDateTime=str_to_datetime(data.last_interest_dt);}
if('last_message'in data&&data.last_message){const messageData=this.messaging.models['mail.message'].convertData({id:data.last_message.id,model:data2.model,res_id:data2.id,});data2.serverLastMessage=insert(messageData);}
if('last_message_id'in data&&data.last_message_id){const messageData=this.messaging.models['mail.message'].convertData({id:data.last_message_id,model:data2.model,res_id:data2.id,});data2.serverLastMessage=insert(messageData);}
if('memberCount'in data){data2.memberCount=data.memberCount;}
if('message_needaction_counter'in data){data2.message_needaction_counter=data.message_needaction_counter;}
if('message_unread_counter'in data){data2.serverMessageUnreadCounter=data.message_unread_counter;}
if('name'in data){data2.name=data.name;}
if('public'in data){data2.public=data.public;}
if('seen_message_id'in data){data2.lastSeenByCurrentPartnerMessageId=data.seen_message_id||0;}
if('uuid'in data){data2.uuid=data.uuid;}
if('members'in data){if(!data.members){data2.members=[unlinkAll()];}else{data2.members=[insertAndReplace(data.members.map(memberData=>this.messaging.models['mail.partner'].convertData(memberData)))];}}
if('rtc_inviting_session'in data){data2.rtcInvitingSession=insert(data.rtc_inviting_session);}
if('rtcSessions'in data){data2.rtcSessions=data.rtcSessions;}
if('seen_partners_info'in data){if(!data.seen_partners_info){data2.partnerSeenInfos=unlinkAll();}else{data2.partnerSeenInfos=insertAndReplace(data.seen_partners_info.map(({fetched_message_id,partner_id,seen_message_id})=>{return{lastFetchedMessage:fetched_message_id?insert({id:fetched_message_id}):unlinkAll(),lastSeenMessage:seen_message_id?insert({id:seen_message_id}):unlinkAll(),partner:insertAndReplace({id:partner_id}),};}));if(data.id||this.id){const messageIds=data.seen_partners_info.reduce((currentSet,{fetched_message_id,seen_message_id})=>{if(fetched_message_id){currentSet.add(fetched_message_id);}
if(seen_message_id){currentSet.add(seen_message_id);}
return currentSet;},new Set());if(messageIds.size>0){data2.messageSeenIndicators=insertAndReplace([...messageIds].map(messageId=>{return{message:insertAndReplace({id:messageId}),};}));}}}}
return data2;}
static async createGroupChat({default_display_mode,partners_to}){const channelData=await this.env.services.rpc({model:'mail.channel',method:'create_group',kwargs:{default_display_mode,partners_to,},});return this.messaging.models['mail.thread'].insert(this.messaging.models['mail.thread'].convertData(channelData));}
endCall(){if(this.rtc){this.rtc.reset();this.messaging.soundEffects.channelLeave.play();}
this.update({rtc:unlink(),rtcInvitingSession:unlink(),});}
static async fetchSuggestions(searchTerm,{thread}={}){const channelsData=await this.env.services.rpc({model:'mail.channel',method:'get_mention_suggestions',kwargs:{search:searchTerm},},{shadow:true},);this.messaging.models['mail.thread'].insert(channelsData.map(channelData=>Object.assign({model:'mail.channel'},this.messaging.models['mail.thread'].convertData(channelData),)));}
static getSuggestionSortFunction(searchTerm,{thread}={}){const cleanedSearchTerm=cleanSearchTerm(searchTerm);return(a,b)=>{const isAPublic=a.model==='mail.channel'&&a.public==='public';const isBPublic=b.model==='mail.channel'&&b.public==='public';if(isAPublic&&!isBPublic){return-1;}
if(!isAPublic&&isBPublic){return 1;}
const isMemberOfA=a.model==='mail.channel'&&a.members.includes(this.messaging.currentPartner);const isMemberOfB=b.model==='mail.channel'&&b.members.includes(this.messaging.currentPartner);if(isMemberOfA&&!isMemberOfB){return-1;}
if(!isMemberOfA&&isMemberOfB){return 1;}
const cleanedAName=cleanSearchTerm(a.name||'');const cleanedBName=cleanSearchTerm(b.name||'');if(cleanedAName.startsWith(cleanedSearchTerm)&&!cleanedBName.startsWith(cleanedSearchTerm)){return-1;}
if(!cleanedAName.startsWith(cleanedSearchTerm)&&cleanedBName.startsWith(cleanedSearchTerm)){return 1;}
if(cleanedAName<cleanedBName){return-1;}
if(cleanedAName>cleanedBName){return 1;}
return a.id-b.id;};}
static async loadPreviews(threads){const channelIds=threads.reduce((list,thread)=>{if(thread.model==='mail.channel'){return list.concat(thread.id);}
return list;},[]);if(channelIds.length===0){return;}
const channelPreviews=await this.env.services.rpc({model:'mail.channel',method:'channel_fetch_preview',args:[channelIds],},{shadow:true});this.messaging.models['mail.message'].insert(channelPreviews.filter(p=>p.last_message).map(channelPreview=>this.messaging.models['mail.message'].convertData(channelPreview.last_message)));}
static async performRpcChannelFold(uuid,state){return this.env.services.rpc({model:'mail.channel',method:'channel_fold',kwargs:{state,uuid,}},{shadow:true});}
static async performRpcChannelInfo({ids}){const channelInfos=await this.env.services.rpc({model:'mail.channel',method:'channel_info',args:[ids],},{shadow:true});const channels=this.messaging.models['mail.thread'].insert(channelInfos.map(channelInfo=>this.messaging.models['mail.thread'].convertData(channelInfo)));return channels;}
static async performRpcChannelSeen({id,lastMessageId}){return this.env.services.rpc({route:`/mail/channel/set_last_seen_message`,params:{channel_id:id,last_message_id:lastMessageId,},},{shadow:true});}
static async performRpcChannelPin({pinned=false,uuid}){return this.env.services.rpc({model:'mail.channel',method:'channel_pin',kwargs:{uuid,pinned,},},{shadow:true});}
static async performRpcCreateChannel({name,privacy}){const device=this.messaging.device;const data=await this.env.services.rpc({model:'mail.channel',method:'channel_create',args:[name,privacy],kwargs:{context:Object.assign({},this.env.session.user_content,{isMobile:device.isMobile,}),},});return this.messaging.models['mail.thread'].insert(this.messaging.models['mail.thread'].convertData(data));}
static async performRpcCreateChat({partnerIds,pinForCurrentPartner}){const device=this.messaging.device;const data=await this.env.services.rpc({model:'mail.channel',method:'channel_get',kwargs:{context:Object.assign({},this.env.session.user_content,{isMobile:device.isMobile,}),partners_to:partnerIds,pin:pinForCurrentPartner,},});if(!data){return;}
return this.messaging.models['mail.thread'].insert(this.messaging.models['mail.thread'].convertData(data));}
async performRpcLeaveCall(){await this.async(()=>this.env.services.rpc({route:'/mail/rtc/channel/leave_call',params:{channel_id:this.id},},{shadow:true}));}
static async performRpcMailGetSuggestedRecipients({model,res_ids}){const data=await this.env.services.rpc({route:'/mail/get_suggested_recipients',params:{model,res_ids,},},{shadow:true});for(const id in data){const recipientInfoList=data[id].map(recipientInfoData=>{const[partner_id,emailInfo,reason]=recipientInfoData;const[name,email]=emailInfo&&mailUtils.parseEmail(emailInfo);return{email,id:getSuggestedRecipientInfoNextTemporaryId(),name,partner:partner_id?insert({id:partner_id}):unlink(),reason,};});this.insert({id:parseInt(id),model,suggestedRecipientInfoList:insertAndReplace(recipientInfoList),});}}
static async searchChannelsToOpen({limit,searchTerm}){const domain=[['channel_type','=','channel'],['name','ilike',searchTerm],];const fields=['channel_type','name'];const channelsData=await this.env.services.rpc({model:"mail.channel",method:"search_read",kwargs:{domain,fields,limit,},});return this.insert(channelsData.map(channelData=>this.convertData(channelData)));}
static searchSuggestions(searchTerm,{thread}={}){let threads;if(thread&&thread.model==='mail.channel'&&thread.public!=='public'){threads=[thread];}else{threads=this.messaging.models['mail.thread'].all();}
const cleanedSearchTerm=cleanSearchTerm(searchTerm);return[threads.filter(thread=>!thread.isTemporary&&thread.model==='mail.channel'&&thread.channel_type==='channel'&&thread.displayName&&cleanSearchTerm(thread.displayName).includes(cleanedSearchTerm))];}
async fetchAttachments(){const attachmentsData=await this.async(()=>this.env.services.rpc({model:'ir.attachment',method:'search_read',domain:[['res_id','=',this.id],['res_model','=',this.model],],fields:['id','name','mimetype'],orderBy:[{name:'id',asc:false}],},{shadow:true}));this.update({originThreadAttachments:insertAndReplace(attachmentsData),});this.update({areAttachmentsLoaded:true});}
async fetchAndUpdateSuggestedRecipients(){if(this.isTemporary){return;}
return this.messaging.models['mail.thread'].performRpcMailGetSuggestedRecipients({model:this.model,res_ids:[this.id],});}
async follow(){await this.async(()=>this.env.services.rpc({model:this.model,method:'message_subscribe',args:[[this.id]],kwargs:{partner_ids:[this.messaging.currentPartner.id],},}));this.refreshFollowers();this.fetchAndUpdateSuggestedRecipients();}
async toggleCall(options){this.update({hasPendingRtcRequest:true});const isActiveCall=!!this.rtc;if(this.messaging.rtc.channel){await this.messaging.rtc.channel.leaveCall();}
if(isActiveCall){this.update({hasPendingRtcRequest:false});return;}
await this._joinCall(options);this.update({hasPendingRtcRequest:false});}
async _joinCall({startWithVideo=false,videoType}={}){if(this.model!=='mail.channel'){return;}
if(!this.messaging.rtc.isClientRtcCompatible){this.env.services.notification.notify({message:this.env._t("Your browser does not support webRTC."),type:'warning',});return;}
const{rtcSessions,iceServers,sessionId,invitedPartners,invitedGuests}=await this.async(()=>this.env.services.rpc({route:'/mail/rtc/channel/join_call',params:{channel_id:this.id,check_rtc_session_ids:this.rtcSessions.map(rtcSession=>rtcSession.id),},},{shadow:true}));if(!this.exists()){return;}
this.update({rtc:link(this.messaging.rtc),rtcInvitingSession:unlink(),rtcSessions,invitedGuests,invitedPartners,});await this.async(()=>this.messaging.rtc.initSession({currentSessionId:sessionId,iceServers,startWithAudio:true,startWithVideo,videoType,}));this.messaging.soundEffects.channelJoin.play();}
async leaveCall(){await this.performRpcLeaveCall();this.endCall();}
updateRtcSessions(rtcSessions){const oldCount=this.rtcSessions.length;this.update({rtcSessions});if(this.rtc){const newCount=this.rtcSessions.length;if(newCount>oldCount){this.messaging.soundEffects.channelJoin.play();}
if(newCount<oldCount){this.messaging.soundEffects.memberLeave.play();}}
this.rtc&&this.rtc.filterCallees(this.rtcSessions);if(this.rtc&&!this.rtc.currentRtcSession){this.endCall();}}
getMemberName(partner){return partner.nameOrDisplayName;}
getMentionText(){return this.name;}
async join(){await this.env.services.rpc({model:'mail.channel',method:'add_members',args:[[this.id]],kwargs:{partner_ids:[this.messaging.currentPartner.id]}});}
async leave(){await this.env.services.rpc({model:'mail.channel',method:'action_unfollow',args:[[this.id]],});}
loadNewMessages(){this.cache.loadNewMessages();}
async markAsFetched(){await this.async(()=>this.env.services.rpc({model:'mail.channel',method:'channel_fetched',args:[[this.id]],},{shadow:true}));}
async markAsSeen(message){if(this.messaging.currentGuest){return;}
if(this.model!=='mail.channel'){return;}
if(this.pendingSeenMessageId&&message.id<=this.pendingSeenMessageId){return;}
if(this.lastSeenByCurrentPartnerMessageId&&message.id<=this.lastSeenByCurrentPartnerMessageId){return;}
this.update({pendingSeenMessageId:message.id});return this.messaging.models['mail.thread'].performRpcChannelSeen({id:this.id,lastMessageId:message.id,});}
async markNeedactionMessagesAsOriginThreadAsRead(){await this.async(()=>this.messaging.models['mail.message'].markAsRead(this.needactionMessagesAsOriginThread));}
async notifyFoldStateToServer(state){if(this.model!=='mail.channel'){return;}
if(!this.uuid){return;}
return this.messaging.models['mail.thread'].performRpcChannelFold(this.uuid,state);}
async notifyPinStateToServer(){if(this.channel_type==='channel'){await this.leave();return;}
await this.messaging.models['mail.thread'].performRpcChannelPin({pinned:this.isPendingPinned,uuid:this.uuid,});}
onClickMemberAvatar(member){member.openChat();}
onClickMemberName(member){member.openProfile();}
async open({expanded=false,focus}={}){const discuss=this.messaging.discuss;if(!['mail.box','mail.channel'].includes(this.model)){if(expanded||discuss.isOpen){this.messaging.chatWindowManager.closeThread(this);await this.messaging.openDocument({id:this.id,model:this.model,});return;}}
const device=this.messaging.device;if((!device.isMobile&&(discuss.isOpen||expanded))||this.model==='mail.box'){return discuss.openThread(this,{focus:focus!==undefined?focus:!this.messaging.device.isMobileDevice,});}
return this.messaging.chatWindowManager.openThread(this,{makeActive:true,});}
async openProfile(){return this.messaging.openDocument({id:this.id,model:this.model,});}
async pin(){this.update({isPendingPinned:true});if(this.messaging.currentGuest){return;}
await this.notifyPinStateToServer();}
promptAddPartnerFollower(){this._promptAddFollower();}
async refresh(){if(this.isTemporary){return;}
this.loadNewMessages();this.update({isLoadingAttachments:true});await this.async(()=>this.fetchAttachments());this.update({isLoadingAttachments:false});}
async refreshActivities(){if(!this.hasActivities){return;}
if(this.isTemporary){return;}
const[{activity_ids:newActivityIds}]=await this.async(()=>this.env.services.rpc({model:this.model,method:'read',args:[this.id,['activity_ids']]},{shadow:true}));const activitiesData=await this.async(()=>this.env.services.rpc({model:'mail.activity',method:'activity_format',args:[newActivityIds]},{shadow:true}));const activities=this.messaging.models['mail.activity'].insert(activitiesData.map(activityData=>this.messaging.models['mail.activity'].convertData(activityData)));this.update({activities:replace(activities)});}
async refreshFollowers(){if(this.isTemporary){this.update({followers:unlinkAll()});return;}
const{followers}=await this.async(()=>this.env.services.rpc({route:'/mail/read_followers',params:{res_id:this.id,res_model:this.model,},},{shadow:true}));this.update({areFollowersLoaded:true});if(followers.length>0){this.update({followers:insertAndReplace(followers.map(data=>this.messaging.models['mail.follower'].convertData(data))),});}else{this.update({followers:unlinkAll(),});}}
refreshCurrentPartnerIsTyping(){this._currentPartnerInactiveTypingTimer.reset();}
refreshOtherMemberTypingMember(partner){this._otherMembersLongTypingTimers.get(partner).reset();}
async registerCurrentPartnerIsTyping(){this._currentPartnerInactiveTypingTimer.start();this._currentPartnerLongTypingTimer.start();const currentPartner=this.messaging.currentPartner;const newOrderedTypingMemberLocalIds=this.orderedTypingMemberLocalIds.filter(localId=>localId!==currentPartner.localId);newOrderedTypingMemberLocalIds.push(currentPartner.localId);this.update({orderedTypingMemberLocalIds:newOrderedTypingMemberLocalIds,typingMembers:link(currentPartner),});await this._throttleNotifyCurrentPartnerTypingStatus({isTyping:true});}
registerOtherMemberTypingMember(partner){const timer=new Timer(this.env,()=>this.async(()=>this._onOtherMemberLongTypingTimeout(partner)),60*1000);this._otherMembersLongTypingTimers.set(partner,timer);timer.start();const newOrderedTypingMemberLocalIds=this.orderedTypingMemberLocalIds.filter(localId=>localId!==partner.localId);newOrderedTypingMemberLocalIds.push(partner.localId);this.update({orderedTypingMemberLocalIds:newOrderedTypingMemberLocalIds,typingMembers:link(partner),});}
async rename(name){this.update({name});return this.env.services.rpc({model:'mail.channel',method:'channel_rename',args:[[this.id]],kwargs:{name},});}
async setCustomName(newName){return this.env.services.rpc({model:'mail.channel',method:'channel_set_custom_name',args:[this.id],kwargs:{name:newName},});}
async unfollow(){const currentPartnerFollower=this.followers.find(follower=>follower.partner===this.messaging.currentPartner);await this.async(()=>currentPartnerFollower.remove());}
async unpin(){this.update({isPendingPinned:false});if(this.messaging.currentGuest){return;}
await this.notifyPinStateToServer();}
async unregisterCurrentPartnerIsTyping({immediateNotify=false}={}){this._currentPartnerInactiveTypingTimer.clear();this._currentPartnerLongTypingTimer.clear();const currentPartner=this.messaging.currentPartner;const newOrderedTypingMemberLocalIds=this.orderedTypingMemberLocalIds.filter(localId=>localId!==currentPartner.localId);this.update({orderedTypingMemberLocalIds:newOrderedTypingMemberLocalIds,typingMembers:unlink(currentPartner),});if(immediateNotify){this._throttleNotifyCurrentPartnerTypingStatus.clear();}
await this.async(()=>this._throttleNotifyCurrentPartnerTypingStatus({isTyping:false}));}
unregisterOtherMemberTypingMember(partner){this._otherMembersLongTypingTimers.get(partner).clear();this._otherMembersLongTypingTimers.delete(partner);const newOrderedTypingMemberLocalIds=this.orderedTypingMemberLocalIds.filter(localId=>localId!==partner.localId);this.update({orderedTypingMemberLocalIds:newOrderedTypingMemberLocalIds,typingMembers:unlink(partner),});}
unsubscribe(){this.leaveCall();this.messaging.chatWindowManager.closeThread(this);this.unpin();}
_computeAllAttachments(){const allAttachments=[...new Set(this.originThreadAttachments.concat(this.attachments))].sort((a1,a2)=>{if(!a1.isUploading&&a2.isUploading){return 1;}
if(a1.isUploading&&!a2.isUploading){return-1;}
return Math.abs(a2.id)-Math.abs(a1.id);});return replace(allAttachments);}
_computeComposer(){if(this.model==='mail.box'){return clear();}
return insertAndReplace();}
_computeCorrespondent(){if(this.channel_type==='channel'){return unlink();}
const correspondents=this.members.filter(partner=>partner!==this.messaging.currentPartner);if(correspondents.length===1){return link(correspondents[0]);}
if(this.members.length===1){return link(this.members[0]);}
return unlink();}
_computeDiscussSidebarCategoryItem(){if(this.model!=='mail.channel'){return clear();}
if(!this.isPinned){return clear();}
const discussSidebarCategory=this._getDiscussSidebarCategory();if(!discussSidebarCategory){return clear();}
return insertAndReplace({category:replace(discussSidebarCategory)});}
_computeDisplayName(){if(this.channel_type==='chat'&&this.correspondent){return this.custom_channel_name||this.correspondent.nameOrDisplayName;}
if(this.channel_type==='group'){return this.name||this.members.map(partner=>partner.nameOrDisplayName).join(', ');}
return this.name;}
_computeFetchMessagesParams(){if(this.model==='mail.box'){return{};}
if(this.model==='mail.channel'){return{'channel_id':this.id};}
return{'thread_id':this.id,'thread_model':this.model,};}
_computeFetchMessagesUrl(){switch(this){case this.messaging.inbox:return'/mail/inbox/messages';case this.messaging.history:return'/mail/history/messages';case this.messaging.starred:return'/mail/starred/messages';}
if(this.model==='mail.channel'){return`/mail/channel/messages`;}
return`/mail/thread/messages`;}
_computeFutureActivities(){return replace(this.activities.filter(activity=>activity.state==='planned'));}
_computeHasInviteFeature(){return this.model==='mail.channel';}
_computeHasSeenIndicators(){if(this.model!=='mail.channel'){return false;}
return['chat','livechat'].includes(this.channel_type);}
_computeIsChannelDescriptionChangeable(){return this.model==='mail.channel'&&['channel','group'].includes(this.channel_type);}
_computeIsChannelRenamable(){return(this.model==='mail.channel'&&['chat','channel','group'].includes(this.channel_type));}
_computeHasMemberListFeature(){return this.model==='mail.channel'&&['channel','group'].includes(this.channel_type);}
_computeInvitationLink(){if(!this.uuid||!this.channel_type||this.channel_type==='chat'){return clear();}
return`${window.location.origin}/chat/${this.id}/${this.uuid}`;}
_computeIsChatChannel(){return this.channel_type==='chat'||this.channel_type==='group';}
_computeIsCurrentPartnerFollowing(){return this.followers.some(follower=>follower.partner&&follower.partner===this.messaging.currentPartner);}
_computeIsPinned(){return this.isPendingPinned!==undefined?this.isPendingPinned:this.isServerPinned;}
_computeLastCurrentPartnerMessageSeenByEveryone(){const otherPartnerSeenInfos=this.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner!==this.messaging.currentPartner);if(otherPartnerSeenInfos.length===0){return unlinkAll();}
const otherPartnersLastSeenMessageIds=otherPartnerSeenInfos.map(partnerSeenInfo=>partnerSeenInfo.lastSeenMessage?partnerSeenInfo.lastSeenMessage.id:0);if(otherPartnersLastSeenMessageIds.length===0){return unlinkAll();}
const lastMessageSeenByAllId=Math.min(...otherPartnersLastSeenMessageIds);const currentPartnerOrderedSeenMessages=this.orderedNonTransientMessages.filter(message=>message.author===this.messaging.currentPartner&&message.id<=lastMessageSeenByAllId);if(!currentPartnerOrderedSeenMessages||currentPartnerOrderedSeenMessages.length===0){return unlinkAll();}
return link(currentPartnerOrderedSeenMessages.slice().pop());}
_computeLastMessage(){const{length:l,[l-1]:lastMessage,}=this.orderedMessages;if(lastMessage){return link(lastMessage);}
return unlink();}
_computeLastNonTransientMessage(){const{length:l,[l-1]:lastMessage,}=this.orderedNonTransientMessages;if(lastMessage){return link(lastMessage);}
return unlink();}
_computeLastSeenByCurrentPartnerMessageId(){const firstMessage=this.orderedMessages[0];if(firstMessage&&this.lastSeenByCurrentPartnerMessageId&&this.lastSeenByCurrentPartnerMessageId<firstMessage.id){return this.lastSeenByCurrentPartnerMessageId;}
let lastSeenByCurrentPartnerMessageId=this.lastSeenByCurrentPartnerMessageId;for(const message of this.orderedMessages){if(message.id<=this.lastSeenByCurrentPartnerMessageId){continue;}
if((message.author&&this.messaging.currentPartner&&message.author===this.messaging.currentPartner)||(message.guestAuthor&&this.messaging.currentGuest&&message.guestAuthor===this.messaging.currentGuest)||message.isTransient){lastSeenByCurrentPartnerMessageId=message.id;continue;}
return lastSeenByCurrentPartnerMessageId;}
return lastSeenByCurrentPartnerMessageId;}
_computeLastNeedactionMessageAsOriginThread(){const orderedNeedactionMessagesAsOriginThread=this.needactionMessagesAsOriginThread.sort((m1,m2)=>m1.id<m2.id?-1:1);const{length:l,[l-1]:lastNeedactionMessageAsOriginThread,}=orderedNeedactionMessagesAsOriginThread;if(lastNeedactionMessageAsOriginThread){return link(lastNeedactionMessageAsOriginThread);}
return unlink();}
_computeLocalMessageUnreadCounter(){if(this.model!=='mail.channel'){return clear();}
let baseCounter=this.serverMessageUnreadCounter;let countFromId=this.serverLastMessage?this.serverLastMessage.id:0;const firstMessage=this.orderedMessages[0];if(firstMessage&&this.lastSeenByCurrentPartnerMessageId&&this.lastSeenByCurrentPartnerMessageId>=firstMessage.id){baseCounter=0;countFromId=this.lastSeenByCurrentPartnerMessageId;}
return this.orderedMessages.reduce((total,message)=>{if(message.id<=countFromId){return total;}
return total+1;},baseCounter);}
_computeMessagingAsRingingThread(){if(this.rtcInvitingSession){return replace(this.messaging);}
return clear();}
_computeMessagingMenuAsPinnedAndUnreadChannel(){if(!this.messaging.messagingMenu){return clear();}
return(this.model==='mail.channel'&&this.isPinned&&this.localMessageUnreadCounter>0)?replace(this.messaging.messagingMenu):clear();}
_computeNeedactionMessagesAsOriginThread(){return replace(this.messagesAsOriginThread.filter(message=>message.isNeedaction));}
_computeMessageAfterNewMessageSeparator(){if(this.model!=='mail.channel'){return unlink();}
if(this.localMessageUnreadCounter===0){return unlink();}
const index=this.orderedMessages.findIndex(message=>message.id===this.lastSeenByCurrentPartnerMessageId);if(index===-1){return unlink();}
const message=this.orderedMessages[index+1];if(!message){return unlink();}
return link(message);}
_computeOrderedOfflineMembers(){return replace(this._sortMembers(this.members.filter(member=>!member.isOnline)));}
_computeOrderedOnlineMembers(){return replace(this._sortMembers(this.members.filter(member=>member.isOnline)));}
_computeOrderedMessages(){return replace(this.messages.sort((m1,m2)=>m1.id<m2.id?-1:1));}
_computeOrderedNonTransientMessages(){return replace(this.orderedMessages.filter(m=>!m.isTransient));}
_computeOrderedOtherTypingMembers(){return replace(this.orderedTypingMembers.filter(member=>member!==this.messaging.currentPartner));}
_computeOrderedTypingMembers(){return[['replace',this.orderedTypingMemberLocalIds.map(localId=>this.messaging.models['mail.partner'].get(localId)).filter(member=>!!member),]];}
_computeOverdueActivities(){return replace(this.activities.filter(activity=>activity.state==='overdue'));}
_computeTodayActivities(){return replace(this.activities.filter(activity=>activity.state==='today'));}
_computeTypingStatusText(){if(this.orderedOtherTypingMembers.length===0){return this.constructor.fields.typingStatusText.default;}
if(this.orderedOtherTypingMembers.length===1){return _.str.sprintf(this.env._t("%s is typing..."),this.getMemberName(this.orderedOtherTypingMembers[0]));}
if(this.orderedOtherTypingMembers.length===2){return _.str.sprintf(this.env._t("%s and %s are typing..."),this.getMemberName(this.orderedOtherTypingMembers[0]),this.getMemberName(this.orderedOtherTypingMembers[1]));}
return _.str.sprintf(this.env._t("%s, %s and more are typing..."),this.getMemberName(this.orderedOtherTypingMembers[0]),this.getMemberName(this.orderedOtherTypingMembers[1]));}
_computeUnknownMemberCount(){return this.memberCount-this.members.length;}
_computeUrl(){const baseHref=this.env.session.url('/web');if(this.model==='mail.channel'){return`${baseHref}#action=mail.action_discuss&active_id=${this.model}_${this.id}`;}
return`${baseHref}#model=${this.model}&id=${this.id}`;}
_computeVideoCount(){return this.rtcSessions.filter(session=>session.videoStream).length;}
_getDiscussSidebarCategory(){switch(this.channel_type){case'channel':return this.messaging.discuss.categoryChannel;case'chat':case'group':return this.messaging.discuss.categoryChat;}}
async _notifyCurrentPartnerTypingStatus({isTyping}){if(this._forceNotifyNextCurrentPartnerTypingStatus||isTyping!==this._currentPartnerLastNotifiedIsTyping){if(this.model==='mail.channel'){await this.async(()=>this.env.services.rpc({model:'mail.channel',method:'notify_typing',args:[this.id],kwargs:{is_typing:isTyping},},{shadow:true}));}
if(isTyping&&this._currentPartnerLongTypingTimer.isRunning){this._currentPartnerLongTypingTimer.reset();}}
this._forceNotifyNextCurrentPartnerTypingStatus=false;this._currentPartnerLastNotifiedIsTyping=isTyping;}
_onChangeLastSeenByCurrentPartnerMessageId(){this.messaging.messagingBus.trigger('o-thread-last-seen-by-current-partner-message-id-changed',{thread:this,});}
_onIsServerPinnedChanged(){if(this.isServerPinned===this.isPendingPinned){this.update({isPendingPinned:clear()});}}
_onServerFoldStateChanged(){if(!this.messaging.chatWindowManager){return;}
if(this.messaging.device.isMobile){return;}
if(this.serverFoldState==='closed'){this.messaging.chatWindowManager.closeThread(this,{notifyServer:false,});}else{this.messaging.chatWindowManager.openThread(this,{isFolded:this.serverFoldState==='folded',notifyServer:false,});}}
_promptAddFollower(){const action={type:'ir.actions.act_window',res_model:'mail.wizard.invite',view_mode:'form',views:[[false,'form']],name:this.env._t("Invite Follower"),target:'new',context:{default_res_model:this.model,default_res_id:this.id,},};this.env.bus.trigger('do-action',{action,options:{on_close:async()=>{await this.async(()=>this.refreshFollowers());this.env.bus.trigger('mail.thread:promptAddFollower-closed');},},});}
_sortMembers(members){return[...members].sort((a,b)=>{const cleanedAName=cleanSearchTerm(a.nameOrDisplayName||'');const cleanedBName=cleanSearchTerm(b.nameOrDisplayName||'');if(cleanedAName<cleanedBName){return-1;}
if(cleanedAName>cleanedBName){return 1;}
return a.id-b.id;});}
async onClick(){await this.open();}
async onClickLoadMoreMembers(){const members=await this.env.services.rpc({model:'mail.channel',method:'load_more_members',args:[[this.id]],kwargs:{'known_member_ids':this.members.map(partner=>partner.id),},});this.update({members});}
async _onCurrentPartnerInactiveTypingTimeout(){await this.async(()=>this.unregisterCurrentPartnerIsTyping());}
async _onCurrentPartnerLongTypingTimeout(){this._forceNotifyNextCurrentPartnerTypingStatus=true;this._throttleNotifyCurrentPartnerTypingStatus.clear();await this.async(()=>this._throttleNotifyCurrentPartnerTypingStatus({isTyping:true}));}
async _onOtherMemberLongTypingTimeout(partner){if(!this.typingMembers.includes(partner)){this._otherMembersLongTypingTimers.delete(partner);return;}
this.unregisterOtherMemberTypingMember(partner);}}
Thread.fields={activities:one2many('mail.activity',{inverse:'thread',}),allAttachments:many2many('mail.attachment',{compute:'_computeAllAttachments',}),areAttachmentsLoaded:attr({default:false,}),areFollowersLoaded:attr({default:false,}),attachments:many2many('mail.attachment',{inverse:'threads',}),avatarCacheKey:attr(),cache:one2one('mail.thread_cache',{default:insertAndReplace(),inverse:'thread',isCausal:true,readonly:true,required:true,}),channel_type:attr(),chatWindow:one2one('mail.chat_window',{inverse:'thread',isCausal:true,}),composer:one2one('mail.composer',{compute:'_computeComposer',inverse:'thread',isCausal:true,readonly:true,}),correspondent:many2one('mail.partner',{compute:'_computeCorrespondent',}),counter:attr({default:0,}),creator:many2one('mail.user'),custom_channel_name:attr(),defaultDisplayMode:attr(),description:attr(),discussSidebarCategoryItem:one2one('mail.discuss_sidebar_category_item',{compute:'_computeDiscussSidebarCategoryItem',inverse:'channel',isCausal:true,readonly:true,}),displayName:attr({compute:'_computeDisplayName',}),fetchMessagesParams:attr({compute:'_computeFetchMessagesParams',}),fetchMessagesUrl:attr({compute:'_computeFetchMessagesUrl',}),followersPartner:many2many('mail.partner',{related:'followers.partner',}),followers:one2many('mail.follower',{inverse:'followedThread',}),futureActivities:one2many('mail.activity',{compute:'_computeFutureActivities',}),group_based_subscription:attr({default:false,}),guestMembers:many2many('mail.guest'),hasActivities:attr({default:false,}),hasInviteFeature:attr({compute:'_computeHasInviteFeature',}),hasMemberListFeature:attr({compute:'_computeHasMemberListFeature',}),hasPendingRtcRequest:attr({default:false,}),hasSeenIndicators:attr({compute:'_computeHasSeenIndicators',default:false,}),id:attr({readonly:true,required:true,}),invitationLink:attr({compute:'_computeInvitationLink',}),invitedGuests:many2many('mail.guest'),invitedPartners:many2many('mail.partner'),isChannelDescriptionChangeable:attr({compute:'_computeIsChannelDescriptionChangeable',}),isChannelRenamable:attr({compute:'_computeIsChannelRenamable',}),isChatChannel:attr({compute:'_computeIsChatChannel',default:false,}),isCurrentPartnerFollowing:attr({compute:'_computeIsCurrentPartnerFollowing',default:false,}),isLoadingAttachments:attr({default:false,}),isPendingPinned:attr(),isPinned:attr({compute:'_computeIsPinned',}),isServerPinned:attr({default:false,}),isTemporary:attr({default:false,}),lastInterestDateTime:attr(),lastCurrentPartnerMessageSeenByEveryone:many2one('mail.message',{compute:'_computeLastCurrentPartnerMessageSeenByEveryone',}),lastMessage:many2one('mail.message',{compute:'_computeLastMessage',}),lastNeedactionMessageAsOriginThread:many2one('mail.message',{compute:'_computeLastNeedactionMessageAsOriginThread',}),lastNonTransientMessage:many2one('mail.message',{compute:'_computeLastNonTransientMessage',}),lastSeenByCurrentPartnerMessageId:attr({compute:'_computeLastSeenByCurrentPartnerMessageId',default:0,}),localMessageUnreadCounter:attr({compute:'_computeLocalMessageUnreadCounter',}),memberCount:attr(),members:many2many('mail.partner',{inverse:'memberThreads',}),mentionedChannelsBackup:many2many('mail.thread'),mentionedPartnersBackup:many2many('mail.partner'),messageAfterNewMessageSeparator:many2one('mail.message',{compute:'_computeMessageAfterNewMessageSeparator',}),message_needaction_counter:attr({default:0,}),messages:many2many('mail.message',{inverse:'threads',readonly:true,}),messagesAsOriginThread:one2many('mail.message',{inverse:'originThread',isCausal:true,}),messageSeenIndicators:one2many('mail.message_seen_indicator',{inverse:'thread',isCausal:true,}),messagingAsRingingThread:many2one('mail.messaging',{compute:'_computeMessagingAsRingingThread',inverse:'ringingThreads',readonly:true,}),messagingMenuAsPinnedAndUnreadChannel:many2one('mail.messaging_menu',{compute:'_computeMessagingMenuAsPinnedAndUnreadChannel',inverse:'pinnedAndUnreadChannels',readonly:true,}),model:attr({readonly:true,required:true,}),model_name:attr(),moduleIcon:attr(),name:attr(),needactionMessagesAsOriginThread:many2many('mail.message',{compute:'_computeNeedactionMessagesAsOriginThread',}),orderedOfflineMembers:many2many('mail.partner',{compute:'_computeOrderedOfflineMembers',}),orderedOnlineMembers:many2many('mail.partner',{compute:'_computeOrderedOnlineMembers',}),orderedMessages:many2many('mail.message',{compute:'_computeOrderedMessages',}),orderedNonTransientMessages:many2many('mail.message',{compute:'_computeOrderedNonTransientMessages',}),orderedOtherTypingMembers:many2many('mail.partner',{compute:'_computeOrderedOtherTypingMembers',}),orderedTypingMembers:many2many('mail.partner',{compute:'_computeOrderedTypingMembers',}),orderedTypingMemberLocalIds:attr({default:[],}),originThreadAttachments:one2many('mail.attachment',{inverse:'originThread',isCausal:true,}),overdueActivities:one2many('mail.activity',{compute:'_computeOverdueActivities',}),partnerSeenInfos:one2many('mail.thread_partner_seen_info',{inverse:'thread',isCausal:true,}),pendingSeenMessageId:attr(),public:attr(),rtc:one2one('mail.rtc',{inverse:'channel',}),rtcInvitingSession:many2one('mail.rtc_session',{inverse:'calledChannels',}),rtcSessions:one2many('mail.rtc_session',{inverse:'channel',isCausal:true,}),serverFoldState:attr({default:'closed',}),serverLastMessage:many2one('mail.message'),serverMessageUnreadCounter:attr({default:0,}),suggestedRecipientInfoList:one2many('mail.suggested_recipient_info',{inverse:'thread',isCausal:true,}),textInputContentBackup:attr({default:"",}),textInputCursorEndBackup:attr({default:0,}),textInputCursorStartBackup:attr({default:0,}),textInputSelectionDirectionBackup:attr({default:"none",}),threadViews:one2many('mail.thread_view',{inverse:'thread',}),todayActivities:one2many('mail.activity',{compute:'_computeTodayActivities',}),typingMembers:many2many('mail.partner'),typingStatusText:attr({compute:'_computeTypingStatusText',default:'',}),unknownMemberCount:attr({compute:'_computeUnknownMemberCount',}),url:attr({compute:'_computeUrl',default:'',}),uuid:attr(),videoCount:attr({compute:'_computeVideoCount',default:0,}),};Thread.identifyingFields=['model','id'];Thread.onChanges=[new OnChange({dependencies:['lastSeenByCurrentPartnerMessageId'],methodName:'_onChangeLastSeenByCurrentPartnerMessageId',}),new OnChange({dependencies:['isServerPinned'],methodName:'_onIsServerPinnedChanged',}),new OnChange({dependencies:['serverFoldState'],methodName:'_onServerFoldStateChanged',}),];Thread.modelName='mail.thread';return Thread;}
registerNewModel('mail.thread',factory);return __exports;});;

/* /mail/static/src/models/thread_cache/thread_cache.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/thread_cache/thread_cache',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2many,many2one,one2many,one2one}=require('@mail/model/model_field');const{link,replace,unlink,unlinkAll}=require('@mail/model/model_field_command');const{OnChange}=require('@mail/model/model_onchange');function factory(dependencies){class ThreadCache extends dependencies['mail.model']{async loadMoreMessages(){if(this.isAllHistoryLoaded||this.isLoading){return;}
if(!this.isLoaded){this.update({isCacheRefreshRequested:true});return;}
this.update({isLoadingMore:true});const messageIds=this.fetchedMessages.map(message=>message.id);const limit=30;let fetchedMessages;let success;try{fetchedMessages=await this._loadMessages({limit,maxId:Math.min(...messageIds)});success=true;}catch(e){success=false;}
if(!this.exists()){return;}
if(success){if(fetchedMessages.length<limit){this.update({isAllHistoryLoaded:true});}
for(const threadView of this.threadViews){threadView.addComponentHint('more-messages-loaded',{fetchedMessages});}}
this.update({isLoadingMore:false});}
async loadNewMessages(){if(this.isLoading){return;}
if(!this.isLoaded){this.update({isCacheRefreshRequested:true});return;}
const messageIds=this.fetchedMessages.map(message=>message.id);const fetchedMessages=this._loadMessages({minId:Math.max(...messageIds)});if(!fetchedMessages){return;}
for(const threadView of this.threadViews){threadView.addComponentHint('new-messages-loaded',{fetchedMessages});}
return fetchedMessages;}
_computeFetchedMessages(){if(!this.thread){return unlinkAll();}
const toUnlinkMessages=[];for(const message of this.fetchedMessages){if(!this.thread.messages.includes(message)){toUnlinkMessages.push(message);}}
return unlink(toUnlinkMessages);}
_computeLastFetchedMessage(){const{length:l,[l-1]:lastFetchedMessage,}=this.orderedFetchedMessages;if(!lastFetchedMessage){return unlink();}
return link(lastFetchedMessage);}
_computeLastMessage(){const{length:l,[l-1]:lastMessage,}=this.orderedMessages;if(!lastMessage){return unlink();}
return link(lastMessage);}
_computeMessages(){if(!this.thread){return unlinkAll();}
let newerMessages;if(!this.lastFetchedMessage){newerMessages=this.thread.messages;}else{newerMessages=this.thread.messages.filter(message=>message.id>this.lastFetchedMessage.id);}
return replace(this.fetchedMessages.concat(newerMessages));}
_computeOrderedFetchedMessages(){return replace(this.fetchedMessages.sort((m1,m2)=>m1.id<m2.id?-1:1));}
_computeOrderedMessages(){return replace(this.messages.sort((m1,m2)=>m1.id<m2.id?-1:1));}
_computeOrderedNonEmptyMessages(){return replace(this.orderedMessages.filter(message=>!message.isEmpty));}
_computeHasToLoadMessages(){const res={hasToLoadMessages:false};if(!this.thread){return res;}
if(this.hasLoadingFailed){return res;}
const wasCacheRefreshRequested=this.isCacheRefreshRequested;if(this.isCacheRefreshRequested){res.isCacheRefreshRequested=false;}
if(this.thread.isTemporary){return res;}
if(!wasCacheRefreshRequested&&this.threadViews.length===0){return res;}
if(this.isLoading){return res;}
if(!wasCacheRefreshRequested&&this.isLoaded){return res;}
if(this.isLoaded){return res;}
res.hasToLoadMessages=true;return res;}
async _loadMessages({limit=30,maxId,minId}={}){this.update({isLoading:true});let messages;try{messages=await this.messaging.models['mail.message'].performRpcMessageFetch(this.thread.fetchMessagesUrl,{...this.thread.fetchMessagesParams,limit,'max_id':maxId,'min_id':minId,});}catch(e){if(this.exists()){this.update({hasLoadingFailed:true,isLoading:false,});}
throw e;}
if(!this.exists()){return;}
this.update({fetchedMessages:link(messages),hasLoadingFailed:false,isLoaded:true,isLoading:false,});if(!minId&&messages.length<limit){this.update({isAllHistoryLoaded:true});}
this.messaging.messagingBus.trigger('o-thread-cache-loaded-messages',{fetchedMessages:messages,threadCache:this,});return messages;}
_onChangeForHasToLoadMessages(){this.update(this._computeHasToLoadMessages());}
_onChangeMarkAllAsRead(){if(this.messaging.currentGuest){return;}
if(!this.isMarkAllAsReadRequested||!this.isLoaded||this.isLoading){return;}
this.update({isMarkAllAsReadRequested:false});if(this.thread.isTemporary||this.thread.model==='mail.box'||this.threadViews.length===0){return;}
this.messaging.models['mail.message'].markAllAsRead([['model','=',this.thread.model],['res_id','=',this.thread.id],]);}
async _onHasToLoadMessagesChanged(){if(!this.hasToLoadMessages){return;}
const fetchedMessages=await this._loadMessages();for(const threadView of this.threadViews){threadView.addComponentHint('messages-loaded',{fetchedMessages});}}}
ThreadCache.fields={fetchedMessages:many2many('mail.message',{compute:'_computeFetchedMessages',}),hasLoadingFailed:attr({default:false,}),hasToLoadMessages:attr(),isAllHistoryLoaded:attr({default:false,}),isLoaded:attr({default:false,}),isLoading:attr({default:false,}),isLoadingMore:attr({default:false,}),isCacheRefreshRequested:attr({default:false,}),isMarkAllAsReadRequested:attr({default:false,}),lastFetchedMessage:many2one('mail.message',{compute:'_computeLastFetchedMessage',}),lastMessage:many2one('mail.message',{compute:'_computeLastMessage',}),messages:many2many('mail.message',{compute:'_computeMessages',}),orderedFetchedMessages:many2many('mail.message',{compute:'_computeOrderedFetchedMessages',}),orderedMessages:many2many('mail.message',{compute:'_computeOrderedMessages',}),orderedNonEmptyMessages:many2many('mail.message',{compute:'_computeOrderedNonEmptyMessages',}),thread:one2one('mail.thread',{inverse:'cache',readonly:true,required:true,}),threadViews:one2many('mail.thread_view',{inverse:'threadCache',}),};ThreadCache.identifyingFields=['thread'];ThreadCache.onChanges=[new OnChange({dependencies:['hasLoadingFailed','isCacheRefreshRequested','isLoaded','isLoading','thread.isTemporary','threadViews'],methodName:'_onChangeForHasToLoadMessages',}),new OnChange({dependencies:['isLoaded','isLoading','isMarkAllAsReadRequested','thread.isTemporary','thread.model','threadViews'],methodName:'_onChangeMarkAllAsRead',}),new OnChange({dependencies:['hasToLoadMessages'],methodName:'_onHasToLoadMessagesChanged',}),];ThreadCache.modelName='mail.thread_cache';return ThreadCache;}
registerNewModel('mail.thread_cache',factory);return __exports;});;

/* /mail/static/src/models/thread_partner_seen_info/thread_partner_seen_info.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/thread_partner_seen_info/thread_partner_seen_info',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{many2one}=require('@mail/model/model_field');function factory(dependencies){class ThreadPartnerSeenInfo extends dependencies['mail.model']{}
ThreadPartnerSeenInfo.fields={lastFetchedMessage:many2one('mail.message'),lastSeenMessage:many2one('mail.message'),partner:many2one('mail.partner',{inverse:'partnerSeenInfos',readonly:true,required:true,}),thread:many2one('mail.thread',{inverse:'partnerSeenInfos',readonly:true,required:true,}),};ThreadPartnerSeenInfo.identifyingFields=['thread','partner'];ThreadPartnerSeenInfo.modelName='mail.thread_partner_seen_info';return ThreadPartnerSeenInfo;}
registerNewModel('mail.thread_partner_seen_info',factory);return __exports;});;

/* /mail/static/src/models/thread_view/thread_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/thread_view/thread_view',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{RecordDeletedError}=require('@mail/model/model_errors');const{attr,many2many,many2one,one2many,one2one}=require('@mail/model/model_field');const{clear,insertAndReplace,link,replace,unlink,update}=require('@mail/model/model_field_command');const{OnChange}=require('@mail/model/model_onchange');function factory(dependencies){class ThreadView extends dependencies['mail.model']{_created(){this._loaderTimeout=undefined;}
_willDelete(){this.env.browser.clearTimeout(this._loaderTimeout);return super._willDelete(...arguments);}
addComponentHint(hintType,hintData){const hint={data:hintData,type:hintType};this.update({componentHintList:this.componentHintList.concat([hint]),});}
handleVisibleMessage(message){if(!this.lastVisibleMessage||this.lastVisibleMessage.id<message.id){this.update({lastVisibleMessage:link(message)});}}
markComponentHintProcessed(hint){this.update({componentHintList:this.componentHintList.filter(h=>h!==hint),});this.messaging.messagingBus.trigger('o-thread-view-hint-processed',{hint,threadViewer:this.threadViewer,});}
startEditingLastMessageFromCurrentUser(){const messageViews=this.messageViews;messageViews.reverse();const messageView=messageViews.find(messageViews=>messageViews.message.isCurrentUserOrGuestAuthor&&messageViews.message.canBeDeleted);if(messageView){messageView.startEditing();}}
_computeRtcCallViewer(){return(this.thread&&this.thread.model==='mail.channel'&&this.thread.rtcSessions.length>0)?insertAndReplace():clear();}
_computeComposerView(){if(!this.thread||this.thread.model==='mail.box'){return clear();}
if(this.threadViewer&&this.threadViewer.chatter){return clear();}
return insertAndReplace();}
_computeHasSquashCloseMessages(){return Boolean(this.threadViewer&&!this.threadViewer.chatter&&this.thread&&this.thread.model!=='mail.box');}
_computeMessageViews(){if(!this.threadCache){return clear();}
const orderedMessages=this.threadCache.orderedNonEmptyMessages;if(this.order==='desc'){orderedMessages.reverse();}
const messageViewsData=[];let prevMessage;for(const message of orderedMessages){messageViewsData.push({isSquashed:this._shouldMessageBeSquashed(prevMessage,message),message:replace(message),});prevMessage=message;}
return insertAndReplace(messageViewsData);}
_computeTextInputSendShortcuts(){if(!this.thread){return;}
if(!this.messaging.device){return;}
if(this.messaging.device.isMobile||(this.messaging.discuss.threadView===this&&this.messaging.discuss.thread===this.messaging.inbox)){return['ctrl-enter','meta-enter'];}
return['enter'];}
_computeThreadCacheInitialScrollHeight(){if(!this.threadCache){return clear();}
const threadCacheInitialScrollHeight=this.threadCacheInitialScrollHeights[this.threadCache.localId];if(threadCacheInitialScrollHeight!==undefined){return threadCacheInitialScrollHeight;}
return clear();}
_computeThreadCacheInitialScrollPosition(){if(!this.threadCache){return clear();}
const threadCacheInitialScrollPosition=this.threadCacheInitialScrollPositions[this.threadCache.localId];if(threadCacheInitialScrollPosition!==undefined){return threadCacheInitialScrollPosition;}
return clear();}
_computeThreadShouldBeSetAsSeen(){if(!this.thread){return;}
if(!this.thread.lastNonTransientMessage){return;}
if(!this.lastVisibleMessage){return;}
if(this.lastVisibleMessage!==this.lastMessage){return;}
if(!this.hasComposerFocus){return;}
if(this.messaging.currentGuest){return;}
this.thread.markAsSeen(this.thread.lastNonTransientMessage).catch(e=>{if(!(e instanceof RecordDeletedError)){throw e;}});}
_computeTopbar(){return this.hasTopbar?insertAndReplace():clear();}
_onThreadCacheChanged(){this.update({componentHintList:clear()});this.addComponentHint('change-of-thread-cache');if(this.threadCache){this.threadCache.update({isCacheRefreshRequested:true,isMarkAllAsReadRequested:true,});}
this.update({lastVisibleMessage:unlink()});}
_onThreadCacheIsLoadingChanged(){if(this.threadCache&&this.threadCache.isLoading){if(!this.isLoading&&!this.isPreparingLoading){this.update({isPreparingLoading:true});this.async(()=>new Promise(resolve=>{this._loaderTimeout=this.env.browser.setTimeout(resolve,400);})).then(()=>{const isLoading=this.threadCache?this.threadCache.isLoading:false;this.update({isLoading,isPreparingLoading:false});});}
return;}
this.env.browser.clearTimeout(this._loaderTimeout);this.update({isLoading:false,isPreparingLoading:false});}
_shouldMessageBeSquashed(prevMessage,message){if(!this.hasSquashCloseMessages){return false;}
if(message.parentMessage){return false;}
if(!prevMessage){return false;}
if(!prevMessage.date&&message.date){return false;}
if(message.date&&prevMessage.date&&Math.abs(message.date.diff(prevMessage.date))>60000){return false;}
if(prevMessage.dateDay!==message.dateDay){return false;}
if(prevMessage.message_type!=='comment'||message.message_type!=='comment'){return false;}
if(prevMessage.author!==message.author||prevMessage.guestAuthor!==message.guestAuthor){return false;}
if(prevMessage.originThread!==message.originThread){return false;}
if(prevMessage.notifications.length>0||message.notifications.length>0){return false;}
const prevOriginThread=prevMessage.originThread;const originThread=message.originThread;if(prevOriginThread&&originThread&&prevOriginThread.model===originThread.model&&originThread.model!=='mail.channel'&&prevOriginThread.id!==originThread.id){return false;}
return true;}}
ThreadView.fields={compact:attr({related:'threadViewer.compact',}),channelInvitationForm:one2one('mail.channel_invitation_form',{inverse:'threadView',isCausal:true,}),componentHintList:attr({default:[],}),composerView:one2one('mail.composer_view',{compute:'_computeComposerView',inverse:'threadView',isCausal:true,}),extraClass:attr({related:'threadViewer.extraClass',}),hasComposerFocus:attr({related:'composerView.hasFocus',}),hasMemberList:attr({related:'threadViewer.hasMemberList',}),hasSquashCloseMessages:attr({compute:'_computeHasSquashCloseMessages',}),hasTopbar:attr({related:'threadViewer.hasTopbar',}),isLoading:attr({default:false,}),isMemberListOpened:attr({default:false,}),isPreparingLoading:attr({default:false,}),hasAutoScrollOnMessageReceived:attr({default:true,}),lastMessage:many2one('mail.message',{related:'thread.lastMessage',}),lastVisibleMessage:many2one('mail.message'),messages:many2many('mail.message',{related:'threadCache.messages',}),messageViews:one2many('mail.message_view',{compute:'_computeMessageViews',inverse:'threadView',isCausal:true,}),order:attr({related:'threadViewer.order',}),replyingToMessageView:many2one('mail.message_view'),rtcCallViewer:one2one('mail.rtc_call_viewer',{compute:'_computeRtcCallViewer',inverse:'threadView',isCausal:true,readonly:true,}),textInputSendShortcuts:attr({compute:'_computeTextInputSendShortcuts',}),thread:many2one('mail.thread',{inverse:'threadViews',readonly:true,related:'threadViewer.thread',}),threadCache:many2one('mail.thread_cache',{inverse:'threadViews',readonly:true,related:'threadViewer.threadCache',}),threadCacheInitialScrollHeight:attr({compute:'_computeThreadCacheInitialScrollHeight',}),threadCacheInitialScrollPosition:attr({compute:'_computeThreadCacheInitialScrollPosition',}),threadCacheInitialScrollHeights:attr({default:{},related:'threadViewer.threadCacheInitialScrollHeights',}),threadCacheInitialScrollPositions:attr({default:{},related:'threadViewer.threadCacheInitialScrollPositions',}),threadViewer:one2one('mail.thread_viewer',{inverse:'threadView',readonly:true,required:true,}),topbar:one2one('mail.thread_view_topbar',{compute:'_computeTopbar',inverse:'threadView',isCausal:true,readonly:true,}),};ThreadView.identifyingFields=['threadViewer'];ThreadView.onChanges=[new OnChange({dependencies:['threadCache'],methodName:'_onThreadCacheChanged',}),new OnChange({dependencies:['threadCache.isLoading'],methodName:'_onThreadCacheIsLoadingChanged',}),new OnChange({dependencies:['hasComposerFocus','lastMessage','thread.lastNonTransientMessage','lastVisibleMessage','threadCache'],methodName:'_computeThreadShouldBeSetAsSeen',}),];ThreadView.modelName='mail.thread_view';return ThreadView;}
registerNewModel('mail.thread_view',factory);return __exports;});;

/* /mail/static/src/models/thread_view/thread_viewer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/thread_view/thread_viewer',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one,one2one}=require('@mail/model/model_field');const{clear,insertAndReplace}=require('@mail/model/model_field_command');function factory(dependencies){class ThreadViewer extends dependencies['mail.model']{saveThreadCacheScrollHeightAsInitial(scrollHeight,threadCache){threadCache=threadCache||this.threadCache;if(!threadCache){return;}
if(this.chatter){return;}
this.update({threadCacheInitialScrollHeights:Object.assign({},this.threadCacheInitialScrollHeights,{[threadCache.localId]:scrollHeight,}),});}
saveThreadCacheScrollPositionsAsInitial(scrollTop,threadCache){threadCache=threadCache||this.threadCache;if(!threadCache){return;}
if(this.chatter){return;}
this.update({threadCacheInitialScrollPositions:Object.assign({},this.threadCacheInitialScrollPositions,{[threadCache.localId]:scrollTop,}),});}
_computeThreadView(){return this.hasThreadView?insertAndReplace():clear();}}
ThreadViewer.fields={chatter:one2one('mail.chatter',{inverse:'threadViewer',readonly:true,}),chatWindow:one2one('mail.chat_window',{inverse:'threadViewer',readonly:true,}),compact:attr({default:false,}),discuss:one2one('mail.discuss',{inverse:'threadViewer',readonly:true,}),discussPublicView:one2one('mail.discuss_public_view',{inverse:'threadViewer',readonly:true,}),extraClass:attr(),hasMemberList:attr({default:false,}),hasThreadView:attr({default:false,}),hasTopbar:attr({default:false,}),order:attr({default:'asc',}),thread:many2one('mail.thread'),threadCache:many2one('mail.thread_cache',{related:'thread.cache',}),threadCacheInitialScrollHeights:attr({default:{},}),threadCacheInitialScrollPositions:attr({default:{},}),threadView:one2one('mail.thread_view',{compute:'_computeThreadView',inverse:'threadViewer',isCausal:true,}),};ThreadViewer.identifyingFields=[['chatter','chatWindow','discuss','discussPublicView']];ThreadViewer.modelName='mail.thread_viewer';return ThreadViewer;}
registerNewModel('mail.thread_viewer',factory);return __exports;});;

/* /mail/static/src/models/thread_view_topbar/thread_view_topbar.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/thread_view_topbar/thread_view_topbar',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,many2one,one2one}=require('@mail/model/model_field');const{clear,insertAndReplace,replace}=require('@mail/model/model_field_command');function factory(dependencies){class ThreadViewTopbar extends dependencies['mail.model']{_created(){this.onClickHideMemberList=this.onClickHideMemberList.bind(this);this.onClickInboxMarkAllAsRead=this.onClickInboxMarkAllAsRead.bind(this);this.onClickInviteButton=this.onClickInviteButton.bind(this);this.onClickShowMemberList=this.onClickShowMemberList.bind(this);this.onClickTopbarThreadName=this.onClickTopbarThreadName.bind(this);this.onClickUnstarAll=this.onClickUnstarAll.bind(this);this.onClickUserName=this.onClickUserName.bind(this);this.onInputGuestNameInput=this.onInputGuestNameInput.bind(this);this.onInputThreadNameInput=this.onInputThreadNameInput.bind(this);this.onKeyDownGuestNameInput=this.onKeyDownGuestNameInput.bind(this);this.onKeyDownThreadNameInput=this.onKeyDownThreadNameInput.bind(this);this.onMouseEnterUserName=this.onMouseEnterUserName.bind(this);this.onMouseEnterTopbarThreadName=this.onMouseEnterTopbarThreadName.bind(this);this.onMouseLeaveUserName=this.onMouseLeaveUserName.bind(this);this.onMouseLeaveTopbarThreadName=this.onMouseLeaveTopbarThreadName.bind(this);this._onClickCaptureGlobal=this._onClickCaptureGlobal.bind(this);this.onClickTopbarThreadDescription=this.onClickTopbarThreadDescription.bind(this);this.onInputThreadDescriptionInput=this.onInputThreadDescriptionInput.bind(this);this.onKeyDownThreadDescriptionInput=this.onKeyDownThreadDescriptionInput.bind(this);this.onMouseEnterTopbarThreadDescription=this.onMouseEnterTopbarThreadDescription.bind(this);this.onMouseLeaveTopbarThreadDescription=this.onMouseLeaveTopbarThreadDescription.bind(this);document.addEventListener('click',this._onClickCaptureGlobal,true);return super._created();}
_willDelete(){document.removeEventListener('click',this._onClickCaptureGlobal,true);return super._willDelete();}
onClickHideMemberList(ev){this.threadView.update({isMemberListOpened:false});this.threadView.addComponentHint('member-list-hidden');}
onClickInboxMarkAllAsRead(ev){this.messaging.models['mail.message'].markAllAsRead();}
onClickInviteButton(ev){if(this.invitePopoverView){this.update({invitePopoverView:clear()});}else{this.openInvitePopoverView();}}
onClickShowMemberList(ev){this.threadView.update({isMemberListOpened:true});}
onClickTopbarThreadName(ev){if(!this.thread||!this.thread.isChannelRenamable){return;}
if(this.messaging.isCurrentUserGuest){return;}
const selection=window.getSelection();this.update({doFocusOnThreadNameInput:true,doSetSelectionDirectionOnThreadNameInput:selection.anchorOffset<selection.focusOffset?'forward':'backward',doSetSelectionEndOnThreadNameInput:Math.max(selection.focusOffset,selection.anchorOffset),doSetSelectionStartOnThreadNameInput:Math.min(selection.focusOffset,selection.anchorOffset),isEditingThreadName:true,isMouseOverThreadName:false,pendingThreadName:this.thread.displayName,});}
onClickTopbarThreadDescription(ev){if(!this.thread||!this.thread.isChannelDescriptionChangeable){return;}
if(this.messaging.isCurrentUserGuest){return;}
const selection=window.getSelection();this.update({doFocusOnThreadDescriptionInput:true,doSetSelectionDirectionOnThreadDescriptionInput:selection.anchorOffset<selection.focusOffset?'forward':'backward',doSetSelectionEndOnThreadDescriptionInput:Math.max(selection.focusOffset,selection.anchorOffset),doSetSelectionStartOnThreadDescriptionInput:Math.min(selection.focusOffset,selection.anchorOffset),isEditingThreadDescription:true,isMouseOverThreadDescription:false,pendingThreadDescription:this.thread.description||"",});}
onClickUnstarAll(ev){this.messaging.models['mail.message'].unstarAll();}
onClickUserName(ev){if(!this.messaging.isCurrentUserGuest){return;}
const selection=window.getSelection();this.update({doFocusOnGuestNameInput:true,doSetSelectionDirectionOnGuestNameInput:selection.anchorOffset<selection.focusOffset?'forward':'backward',doSetSelectionEndOnGuestNameInput:Math.max(selection.focusOffset,selection.anchorOffset),doSetSelectionStartOnGuestNameInput:Math.min(selection.focusOffset,selection.anchorOffset),isEditingGuestName:true,isMouseOverUserName:false,pendingGuestName:this.messaging.currentGuest.name,});}
onComponentUpdate(){if(this.doFocusOnGuestNameInput){this.guestNameInputRef.el.focus();this.update({doFocusOnGuestNameInput:clear()});}
if(this.doFocusOnThreadNameInput){this.threadNameInputRef.el.focus();this.update({doFocusOnThreadNameInput:clear()});}
if(this.doFocusOnThreadDescriptionInput){this.threadDescriptionInputRef.el.focus();this.update({doFocusOnThreadDescriptionInput:clear()});}
if(this.doSetSelectionStartOnGuestNameInput!==undefined&&this.doSetSelectionEndOnGuestNameInput!==undefined&&this.doSetSelectionDirectionOnGuestNameInput!==undefined){this.guestNameInputRef.el.setSelectionRange(this.doSetSelectionStartOnGuestNameInput,this.doSetSelectionEndOnGuestNameInput,this.doSetSelectionDirectionOnGuestNameInput);this.update({doSetSelectionDirectionOnGuestNameInput:clear(),doSetSelectionEndOnGuestNameInput:clear(),doSetSelectionStartOnGuestNameInput:clear(),});}
if(this.doSetSelectionStartOnThreadNameInput!==undefined&&this.doSetSelectionEndOnThreadNameInput!==undefined&&this.doSetSelectionDirectionOnThreadNameInput!==undefined){this.threadNameInputRef.el.setSelectionRange(this.doSetSelectionStartOnThreadNameInput,this.doSetSelectionEndOnThreadNameInput,this.doSetSelectionDirectionOnThreadNameInput);this.update({doSetSelectionDirectionOnThreadNameInput:clear(),doSetSelectionEndOnThreadNameInput:clear(),doSetSelectionStartOnThreadNameInput:clear(),});}
if(this.doSetSelectionStartOnThreadDescriptionInput!==undefined&&this.doSetSelectionEndOnThreadDescriptionInput!==undefined&&this.doSetSelectionDirectionOnThreadDescriptionInput!==undefined){this.threadDescriptionInputRef.el.setSelectionRange(this.doSetSelectionStartOnThreadDescriptionInput,this.doSetSelectionEndOnThreadDescriptionInput,this.doSetSelectionDirectionOnThreadDescriptionInput);this.update({doSetSelectionDirectionOnThreadDescriptionInput:clear(),doSetSelectionEndOnThreadDescriptionInput:clear(),doSetSelectionStartOnThreadDescriptionInput:clear(),});}}
onInputGuestNameInput(ev){this.update({pendingGuestName:this.guestNameInputRef.el.value});}
onInputThreadNameInput(ev){this.update({pendingThreadName:ev.target.value});}
onInputThreadDescriptionInput(ev){this.update({pendingThreadDescription:ev.target.value});}
onKeyDownGuestNameInput(ev){switch(ev.key){case'Enter':if(this.pendingGuestName.trim()!==''){this._applyGuestRename();}
break;case'Escape':this._resetGuestNameInput();break;}}
onKeyDownThreadNameInput(ev){switch(ev.key){case'Enter':this._applyThreadRename();break;case'Escape':this._discardThreadRename();break;}}
onKeyDownThreadDescriptionInput(ev){switch(ev.key){case'Enter':this._applyThreadChangeDescription();break;case'Escape':this._discardThreadChangeDescription();break;}}
onMouseEnterTopbarThreadName(ev){if(!this.thread||!this.thread.isChannelRenamable){return;}
this.update({isMouseOverThreadName:true});}
onMouseEnterTopbarThreadDescription(ev){if(!this.thread||!this.thread.isChannelDescriptionChangeable){return;}
this.update({isMouseOverThreadDescription:true});}
onMouseEnterUserName(ev){this.update({isMouseOverUserName:true});}
onMouseLeaveTopbarThreadName(ev){this.update({isMouseOverThreadName:false});}
onMouseLeaveTopbarThreadDescription(ev){this.update({isMouseOverThreadDescription:false});}
onMouseLeaveUserName(ev){this.update({isMouseOverUserName:false});}
openInvitePopoverView(){this.threadView.update({channelInvitationForm:insertAndReplace()});this.update({invitePopoverView:insertAndReplace({channelInvitationForm:replace(this.threadView.channelInvitationForm),}),});if(this.messaging.isCurrentUserGuest){return;}
this.threadView.channelInvitationForm.update({doFocusOnSearchInput:true});this.threadView.channelInvitationForm.searchPartnersToInvite();}
_applyGuestRename(){if(this.hasGuestNameChanged){this.messaging.models['mail.guest'].performRpcGuestUpdateName({id:this.messaging.currentGuest.id,name:this.pendingGuestName.trim(),});}
this._resetGuestNameInput();}
_applyThreadRename(){const newName=this.pendingThreadName;this.update({isEditingThreadName:false,pendingThreadName:clear(),});if(this.thread.channel_type==='chat'&&newName!==this.thread.custom_channel_name){this.thread.setCustomName(newName);}
if(newName&&this.thread.channel_type==='channel'&&newName!==this.thread.name){this.thread.rename(newName);}
if(this.thread.channel_type==='group'&&newName!==this.thread.name){this.thread.rename(newName);}}
_applyThreadChangeDescription(){const newDescription=this.pendingThreadDescription||"";this.update({isEditingThreadDescription:false,pendingThreadDescription:clear(),});if(newDescription!==this.thread.description){this.thread.changeDescription(newDescription);}}
_computeAvatarUrl(){if(this.messaging.isCurrentUserGuest){if(!this.thread){return'';}
return`/mail/channel/${this.thread.id}/guest/${this.messaging.currentGuest.id}/avatar_128?unique=${this.messaging.currentGuest.name}`;}
return this.messaging.currentPartner.avatarUrl;}
_computeHasGuestNameChanged(){return Boolean(this.messaging.currentGuest&&this.pendingGuestName!==this.messaging.currentGuest.name);}
_discardThreadRename(){this.update({isEditingThreadName:false,pendingThreadName:clear(),});}
_discardThreadChangeDescription(){this.update({isEditingThreadDescription:false,pendingThreadDescription:clear(),});}
_onClickCaptureGlobal(ev){if(this.isEditingGuestName&&this.guestNameInputRef.el&&!this.guestNameInputRef.el.contains(ev.target)){if(this.pendingGuestName.trim()!==''){this._applyGuestRename();}else{this._resetGuestNameInput();}}
if(this.isEditingThreadName&&this.threadNameInputRef.el&&!this.threadNameInputRef.el.contains(ev.target)){this._applyThreadRename();}
if(this.isEditingThreadDescription&&this.threadDescriptionInputRef.el&&!this.threadDescriptionInputRef.el.contains(ev.target)){this._applyThreadChangeDescription();}}
_resetGuestNameInput(){this.update({isEditingGuestName:false,pendingGuestName:clear(),});}}
ThreadViewTopbar.fields={avatarUrl:attr({compute:'_computeAvatarUrl',readonly:true,}),doFocusOnGuestNameInput:attr(),doFocusOnThreadNameInput:attr(),doFocusOnThreadDescriptionInput:attr(),doSetSelectionDirectionOnGuestNameInput:attr(),doSetSelectionDirectionOnThreadNameInput:attr(),doSetSelectionDirectionOnThreadDescriptionInput:attr(),doSetSelectionEndOnGuestNameInput:attr(),doSetSelectionEndOnThreadNameInput:attr(),doSetSelectionEndOnThreadDescriptionInput:attr(),doSetSelectionStartOnGuestNameInput:attr(),doSetSelectionStartOnThreadNameInput:attr(),doSetSelectionStartOnThreadDescriptionInput:attr(),guestNameInputRef:attr(),hasGuestNameChanged:attr({compute:'_computeHasGuestNameChanged',readonly:true,}),isEditingGuestName:attr({default:false,}),inviteButtonRef:attr(),invitePopoverView:one2one('mail.popover_view',{isCausal:true,inverse:'threadViewTopbarOwner',}),isEditingThreadName:attr({default:false,}),isEditingThreadDescription:attr({default:false,}),isMouseOverThreadName:attr({default:false,}),isMouseOverThreadDescription:attr({default:false,}),isMouseOverUserName:attr({default:false,}),pendingGuestName:attr({default:"",}),pendingThreadName:attr({default:"",}),pendingThreadDescription:attr({default:"",}),thread:many2one('mail.thread',{related:'threadView.thread',}),threadNameInputRef:attr(),threadDescriptionInputRef:attr(),threadView:one2one('mail.thread_view',{inverse:'topbar',readonly:true,required:true,}),};ThreadViewTopbar.identifyingFields=['threadView'];ThreadViewTopbar.modelName='mail.thread_view_topbar';return ThreadViewTopbar;}
registerNewModel('mail.thread_view_topbar',factory);return __exports;});;

/* /mail/static/src/models/user/user.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/user/user',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,one2one}=require('@mail/model/model_field');const{insert,unlink}=require('@mail/model/model_field_command');function factory(dependencies){class User extends dependencies['mail.model']{static convertData(data){const data2={};if('id'in data){data2.id=data.id;}
if('partner_id'in data){if(!data.partner_id){data2.partner=unlink();}else{const partnerNameGet=data['partner_id'];const partnerData={display_name:partnerNameGet[1],id:partnerNameGet[0],};data2.partner=insert(partnerData);}}
return data2;}
static async performRpcRead({context,fields,ids}){const usersData=await this.env.services.rpc({model:'res.users',method:'read',args:[ids],kwargs:{context,fields,},},{shadow:true});return this.messaging.models['mail.user'].insert(usersData.map(userData=>this.messaging.models['mail.user'].convertData(userData)));}
async fetchPartner(){return this.messaging.models['mail.user'].performRpcRead({ids:[this.id],fields:['partner_id'],context:{active_test:false},});}
async getChat(){if(!this.partner){await this.async(()=>this.fetchPartner());}
if(!this.partner){this.env.services['notification'].notify({message:this.env._t("You can only chat with existing users."),type:'warning',});return;}
let chat=this.messaging.models['mail.thread'].find(thread=>thread.channel_type==='chat'&&thread.correspondent===this.partner&&thread.model==='mail.channel'&&thread.public==='private');if(!chat||!chat.isPinned){chat=await this.async(()=>this.messaging.models['mail.thread'].performRpcCreateChat({partnerIds:[this.partner.id],}));}
if(!chat){this.env.services['notification'].notify({message:this.env._t("An unexpected error occurred during the creation of the chat."),type:'warning',});return;}
return chat;}
async openChat(options){const chat=await this.async(()=>this.getChat());if(!chat){return;}
await this.async(()=>chat.open(options));return chat;}
async openProfile(){if(!this.partner){await this.async(()=>this.fetchPartner());}
if(!this.partner){this.env.services['notification'].notify({message:this.env._t("You can only open the profile of existing users."),type:'warning',});return;}
return this.partner.openProfile();}
_computeDisplayName(){return this.display_name||this.partner&&this.partner.display_name;}
_computeNameOrDisplayName(){return this.partner&&this.partner.nameOrDisplayName||this.display_name;}}
User.fields={id:attr({readonly:true,required:true,}),isInternalUser:attr(),display_name:attr({compute:'_computeDisplayName',}),model:attr({default:'res.user',}),nameOrDisplayName:attr({compute:'_computeNameOrDisplayName',}),partner:one2one('mail.partner',{inverse:'user',}),resUsersSettingsId:attr(),};User.identifyingFields=['id'];User.modelName='mail.user';return User;}
registerNewModel('mail.user',factory);return __exports;});;

/* /mail/static/src/models/user_setting/user_setting.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/user_setting/user_setting',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registerNewModel}=require('@mail/model/model_core');const{attr,one2one,one2many}=require('@mail/model/model_field');const{insertAndReplace}=require('@mail/model/model_field_command');function factory(dependencies){class UserSetting extends dependencies['mail.model']{_created(){const res=super._created(...arguments);this._timeoutIds={};this._loadLocalSettings();return res;}
_willDelete(){for(const timeoutId of Object.values(this._timeoutIds)){browser.clearTimeout(timeoutId);}
return super._willDelete(...arguments);}
static convertData(data){const data2={};if('use_push_to_talk'in data){data2.usePushToTalk=data.use_push_to_talk;}
if('push_to_talk_key'in data){data2.pushToTalkKey=data.push_to_talk_key||'';}
if('voice_active_duration'in data){data2.voiceActiveDuration=data.voice_active_duration;}
if('id'in data){data2.id=data.id;}
return data2;}
getAudioConstraints(){const constraints={echoCancellation:true,noiseSuppression:true,};if(this.audioInputDeviceId){constraints.deviceId=this.audioInputDeviceId;}
return constraints;}
isPushToTalkKey(ev,{ignoreModifiers=false}={}){if(!this.usePushToTalk||!this.pushToTalkKey){return;}
const{key,shiftKey,ctrlKey,altKey}=this.pushToTalkKeyFormat();if(ignoreModifiers){return ev.key===key;}
return(ev.key===key&&ev.shiftKey===shiftKey&&ev.ctrlKey===ctrlKey&&ev.altKey===altKey);}
pushToTalkKeyFormat(){if(!this.pushToTalkKey){return;}
const[shiftKey,ctrlKey,altKey,key]=this.pushToTalkKey.split('.');return{shiftKey:!!shiftKey,ctrlKey:!!ctrlKey,altKey:!!altKey,key:key||false,};}
pushToTalkKeyToString(){const{shiftKey,ctrlKey,altKey,key}=this.pushToTalkKeyFormat();const f=(k,name)=>k?name:'';return`${f(ctrlKey, 'Ctrl + ')}${f(altKey, 'Alt + ')}${f(shiftKey, 'Shift + ')}${key}`;}
async setAudioInputDevice(audioInputDeviceId){this.update({audioInputDeviceId,});this.env.services.local_storage.setItem('mail_user_setting_audio_input_device_id',audioInputDeviceId);await this.messaging.rtc.updateLocalAudioTrack(true);}
setDelayValue(value){const voiceActiveDuration=parseInt(value,10);this.update({voiceActiveDuration});if(!this.messaging.isCurrentUserGuest){this._saveSettings();}}
async setPushToTalkKey(ev){const pushToTalkKey=`${ev.shiftKey || ''}.${ev.ctrlKey || ev.metaKey || ''}.${ev.altKey || ''}.${ev.key}`;this.update({pushToTalkKey});if(!this.messaging.isCurrentUserGuest){this._saveSettings();}}
async saveVolumeSetting({guestId,partnerId,volume}){this._debounce(async()=>{await this.async(()=>this.env.services.rpc({model:'res.users.settings',method:'set_volume_setting',args:[[this.messaging.currentUser.resUsersSettingsId],partnerId,volume,],kwargs:{guest_id:guestId,},},{shadow:true},));},5000,`sound_${partnerId}`);}
async setThresholdValue(voiceActivationThreshold){this.update({voiceActivationThreshold});this.env.services.local_storage.setItem('mail_user_setting_voice_threshold',voiceActivationThreshold);await this.messaging.rtc.updateVoiceActivation();}
async togglePushToTalk(){this.update({usePushToTalk:!this.usePushToTalk});await this.messaging.rtc.updateVoiceActivation();if(!this.messaging.isCurrentUserGuest){this._saveSettings();}}
toggleLayoutSettingsWindow(){this.update({isRtcLayoutSettingDialogOpen:!this.isRtcLayoutSettingDialogOpen});}
toggleWindow(){this.update({isOpen:!this.isOpen});}
_debounce(f,delay,key){this._timeoutIds[key]&&browser.clearTimeout(this._timeoutIds[key]);this._timeoutIds[key]=browser.setTimeout(()=>{if(!this.exists()){return;}
f();},delay);}
_loadLocalSettings(){const voiceActivationThresholdString=this.env.services.local_storage.getItem("mail_user_setting_voice_threshold");const audioInputDeviceId=this.env.services.local_storage.getItem("mail_user_setting_audio_input_device_id");const voiceActivationThreshold=parseFloat(voiceActivationThresholdString);if(voiceActivationThreshold>0){this.update({voiceActivationThreshold,audioInputDeviceId,});}}
async _saveSettings(){this._debounce(async()=>{await this.async(()=>this.env.services.rpc({model:'res.users.settings',method:'set_res_users_settings',args:[[this.messaging.currentUser.resUsersSettingsId],{push_to_talk_key:this.pushToTalkKey,use_push_to_talk:this.usePushToTalk,voice_active_duration:this.voiceActiveDuration,}],},{shadow:true},));},2000,'globalSettings');}}
UserSetting.fields={audioInputDeviceId:attr({default:'',}),id:attr({readonly:true,required:true,}),isRtcLayoutSettingDialogOpen:attr({default:false,}),pushToTalkKey:attr({default:'',}),rtcConfigurationMenu:one2one('mail.rtc_configuration_menu',{default:insertAndReplace(),inverse:'userSetting',isCausal:true,required:true,}),rtcLayout:attr({default:'tiled',}),usePushToTalk:attr({default:false,}),voiceActivationThreshold:attr({default:0.05,}),voiceActiveDuration:attr({default:0,}),volumeSettings:one2many('mail.volume_setting',{inverse:'userSetting',isCausal:true,}),};UserSetting.identifyingFields=['id'];UserSetting.modelName='mail.user_setting';return UserSetting;}
registerNewModel('mail.user_setting',factory);return __exports;});;

/* /mail/static/src/models/volume_setting/volume_setting.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/volume_setting/volume_setting',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,one2one,many2one}=require('@mail/model/model_field');const{insert}=require('@mail/model/model_field_command');const{OnChange}=require('@mail/model/model_onchange');function factory(dependencies){class VolumeSetting extends dependencies['mail.model']{_onChangeVolume(){let rtcSessions;if(this.partner){rtcSessions=this.partner.rtcSessions;}else if(this.guest){rtcSessions=this.guest.rtcSessions;}else{return;}
for(const rtcSession of rtcSessions){if(rtcSession.audioElement){rtcSession.audioElement.volume=this.volume;}}}}
VolumeSetting.fields={guest:one2one('mail.guest',{inverse:'volumeSetting',}),id:attr({readonly:true,required:true,}),partner:one2one('mail.partner',{inverse:'volumeSetting',}),userSetting:many2one('mail.user_setting',{inverse:'volumeSettings',required:true,}),volume:attr({default:0.5,}),};VolumeSetting.identifyingFields=['id'];VolumeSetting.onChanges=[new OnChange({dependencies:['volume'],methodName:'_onChangeVolume',}),];VolumeSetting.modelName='mail.volume_setting';return VolumeSetting;}
registerNewModel('mail.volume_setting',factory);return __exports;});;

/* /mail/static/src/models/welcome_view/welcome_view.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/models/welcome_view/welcome_view',async function(require){'use strict';let __exports={};const{registerNewModel}=require('@mail/model/model_core');const{attr,one2one}=require('@mail/model/model_field');const{clear,insertAndReplace}=require('@mail/model/model_field_command');function factory(dependencies){const getNextGuestNameInputId=(function(){let id=0;return()=>++id;})();class WelcomeView extends dependencies['mail.model']{_created(){super._created();this.onClickJoinButton=this.onClickJoinButton.bind(this);this.onInputGuestNameInput=this.onInputGuestNameInput.bind(this);this.onKeydownGuestNameInput=this.onKeydownGuestNameInput.bind(this);}
async joinChannel(){if(this.hasGuestNameChanged){await this.messaging.models['mail.guest'].performRpcGuestUpdateName({id:this.messaging.currentGuest.id,name:this.pendingGuestName.trim(),});}
if(this.discussPublicView.shouldAddGuestAsMemberOnJoin){await this.performRpcAddGuestAsMember();}
this.discussPublicView.switchToThreadView();}
onClickJoinButton(ev){this.joinChannel();}
onComponentUpdate(){this._handleFocus();}
onInputGuestNameInput(ev){this._updateGuestNameWithInputValue();}
onKeydownGuestNameInput(ev){if(ev.key==='Enter'){this.joinChannel();}}
async performRpcAddGuestAsMember(){await this.env.services.rpc({route:'/mail/channel/add_guest_as_member',params:{channel_id:this.channel.id,channel_uuid:this.channel.uuid,},});}
_computeGuestNameInputUniqueId(){return`o_WelcomeView_guestNameInput_${getNextGuestNameInputId()}`;}
_computeHasGuestNameChanged(){return Boolean(this.messaging.currentGuest&&this.originalGuestName!==this.pendingGuestName);}
_computeIsJoinButtonDisabled(){return Boolean(this.messaging.currentGuest&&this.pendingGuestName.trim()==='');}
_computeMediaPreview(){return(this.channel&&this.channel.defaultDisplayMode==='video_full_screen')?insertAndReplace():clear();}
_handleFocus(){if(this.isDoFocusGuestNameInput){if(!this.guestNameInputRef.el){return;}
this.update({isDoFocusGuestNameInput:false});this.guestNameInputRef.el.focus();const{length}=(this.pendingGuestName||'');this.guestNameInputRef.el.setSelectionRange(length,length);}}
_updateGuestNameWithInputValue(){this.update({pendingGuestName:this.guestNameInputRef.el.value});}}
WelcomeView.fields={channel:one2one('mail.thread',{readonly:true,required:true,}),discussPublicView:one2one('mail.discuss_public_view',{inverse:'welcomeView',readonly:true,required:true,}),guestNameInputRef:attr(),guestNameInputUniqueId:attr({compute:'_computeGuestNameInputUniqueId',readonly:true,}),hasGuestNameChanged:attr({compute:'_computeHasGuestNameChanged',readonly:true,}),isDoFocusGuestNameInput:attr(),isJoinButtonDisabled:attr({compute:'_computeIsJoinButtonDisabled'}),mediaPreview:one2one('mail.media_preview',{compute:'_computeMediaPreview',isCausal:true,readonly:true,}),originalGuestName:attr(),pendingGuestName:attr(),};WelcomeView.identifyingFields=['messaging'];WelcomeView.modelName='mail.welcome_view';return WelcomeView;}
registerNewModel('mail.welcome_view',factory);return __exports;});;

/* /mail/static/src/services/chat_window_service/chat_window_service.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/services/chat_window_service/chat_window_service',async function(require){'use strict';let __exports={};const{getMessagingComponent}=require("@mail/utils/messaging_component");const AbstractService=require('web.AbstractService');const{bus}=require('web.core');const ChatWindowService=__exports.ChatWindowService=AbstractService.extend({dependencies:['messaging'],start(){this._super(...arguments);this._listenHomeMenu();},destroy(){if(this.component){this.component.destroy();this.component=undefined;}},_getParentNode(){return document.querySelector('body');},_listenHomeMenu(){bus.on('web_client_ready',this,this._onWebClientReady.bind(this));},async _mount(){if(this.component){this.component.destroy();this.component=undefined;}
const ChatWindowManagerComponent=getMessagingComponent("ChatWindowManager");this.component=new ChatWindowManagerComponent(null);const parentNode=this._getParentNode();await this.component.mount(parentNode);},async _onWebClientReady(){await this._mount();},});return __exports;});;

/* /mail/static/src/services/dialog_service/dialog_service.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/services/dialog_service/dialog_service',async function(require){'use strict';let __exports={};const{getMessagingComponent}=require("@mail/utils/messaging_component");const AbstractService=require('web.AbstractService');const{bus}=require('web.core');const DialogService=__exports.DialogService=AbstractService.extend({dependencies:['messaging'],start(){this._super(...arguments);this._listenHomeMenu();},destroy(){if(this.component){this.component.destroy();this.component=undefined;}},_getParentNode(){return document.querySelector('body');},_listenHomeMenu(){bus.on('web_client_ready',this,this._onWebClientReady.bind(this));},async _mount(){if(this.component){this.component.destroy();this.component=undefined;}
const DialogManagerComponent=getMessagingComponent("DialogManager");this.component=new DialogManagerComponent(null);const parentNode=this._getParentNode();await this.component.mount(parentNode);},async _onWebClientReady(){await this._mount();}});return __exports;});;

/* /mail/static/src/services/messaging/messaging.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/services/messaging/messaging',async function(require){'use strict';let __exports={};const{ModelManager}=require('@mail/model/model_manager');const AbstractService=require('web.AbstractService');const MessagingService=__exports.MessagingService=AbstractService.extend({dependencies:['bus_service'],messagingValues:{},init(env){this._super(env);this.modelManager=new ModelManager(env);},start(){this._super();this.modelManager.start(this.messagingValues);},async get(){return this.modelManager.getMessaging();}});return __exports;});;

/* /mail/static/src/services/systray_service/systray_service.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/services/systray_service/systray_service',async function(require){'use strict';let __exports={};const{getMessagingComponent}=require('@mail/utils/messaging_component');const AbstractService=require('web.AbstractService');const{registry}=require('@web/core/registry');const systrayRegistry=registry.category('systray');const SystrayService=__exports.SystrayService=AbstractService.extend({dependencies:['messaging'],async start(){await owl.Component.env.services.messaging.modelManager.messagingCreatedPromise;systrayRegistry.add('mail.MessagingMenu',{Component:getMessagingComponent('MessagingMenu'),});systrayRegistry.add('mail.RtcActivityNotice',{Component:getMessagingComponent('RtcActivityNotice'),});},});return __exports;});;

/* /mail/static/src/webclient/commands/command_category.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/webclient/commands/command_category',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{_lt}=require("@web/core/l10n/translation");const commandCategoryRegistry=registry.category("command_categories");commandCategoryRegistry.add("mail",{},{sequence:20});return __exports;});;

/* /mail/static/src/webclient/commands/mail_providers.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/webclient/commands/mail_providers',async function(require){'use strict';let __exports={};const{_lt}=require("@web/core/l10n/translation");const{registry}=require("@web/core/registry");const{Component}=owl;const{xml}=owl.tags;class DialogCommand extends Component{}
DialogCommand.template=xml`
    <div class="o_command_default">
        <span t-esc="props.name"/>
        <span t-if="props.email" t-esc="props.email"/>
    </div>
`;const commandEmptyMessageRegistry=registry.category("command_empty_list");commandEmptyMessageRegistry.add("@",_lt("No user found"));commandEmptyMessageRegistry.add("#",_lt("No channel found"));const commandProviderRegistry=registry.category("command_provider");commandProviderRegistry.add("partner",{namespace:"@",async provide(newEnv,options){const messaging=await Component.env.services.messaging.get();const suggestions=[];await messaging.models['mail.partner'].imSearch({callback(partners){partners.forEach((partner)=>{suggestions.push({Component:DialogCommand,action(){partner.openChat();},name:partner.nameOrDisplayName,props:{email:partner.email,},});});},keyword:options.searchValue,limit:10,});return suggestions;},});commandProviderRegistry.add("channel",{namespace:"#",async provide(newEnv,options){const messaging=await Component.env.services.messaging.get();const channels=await messaging.models['mail.thread'].searchChannelsToOpen({limit:10,searchTerm:options.searchValue,});return channels.map((channel)=>({async action(){await channel.join();channel.update({isServerPinned:true});channel.open();},name:channel.displayName,}));},});return __exports;});;

/* /mail/static/src/widgets/discuss/discuss.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/widgets/discuss/discuss',async function(require){'use strict';let __exports={};const{getMessagingComponent}=require("@mail/utils/messaging_component");const AbstractAction=require('web.AbstractAction');const{Component}=owl;const DiscussWidget=__exports.DiscussWidget=AbstractAction.extend({template:'mail.widgets.Discuss',init(parent,action,options={}){this._super(...arguments);this.action=action;this.actionManager=parent;this.discuss=undefined;this.options=options;this.component=undefined;this._lastPushStateActiveThread=null;this.env=Component.env;Component.env.services.messaging.modelManager.messagingCreatedPromise.then(async()=>{const messaging=Component.env.services.messaging.modelManager.messaging;const initActiveId=this.options.active_id||(this.action.context&&this.action.context.active_id)||(this.action.params&&this.action.params.default_active_id)||'mail.box_inbox';this.discuss=messaging.discuss;this.discuss.update({initActiveId,isOpen:true});await messaging.initializedPromise;if(!this.discuss.isInitThreadHandled){this.discuss.update({isInitThreadHandled:true});if(!this.discuss.thread){this.discuss.openInitThread();}}});},destroy(){if(this.component){this.component.destroy();this.component=undefined;}
if(this.$buttons){this.$buttons.off().remove();}
this._super(...arguments);},on_attach_callback(){this._super(...arguments);if(this.component){return;}
const DiscussComponent=getMessagingComponent("Discuss");this.component=new DiscussComponent();this._pushStateActionManagerEventListener=ev=>{ev.stopPropagation();if(this._lastPushStateActiveThread===this.discuss.thread){return;}
this._pushStateActionManager();this._lastPushStateActiveThread=this.discuss.thread;};this._showRainbowManEventListener=ev=>{ev.stopPropagation();this._showRainbowMan();};this.el.addEventListener('o-push-state-action-manager',this._pushStateActionManagerEventListener);this.el.addEventListener('o-show-rainbow-man',this._showRainbowManEventListener);return this.component.mount(this.el);},on_detach_callback(){this._super(...arguments);if(this.component){this.component.destroy();}
this.component=undefined;this.el.removeEventListener('o-push-state-action-manager',this._pushStateActionManagerEventListener);this.el.removeEventListener('o-show-rainbow-man',this._showRainbowManEventListener);},_pushStateActionManager(){this.actionManager.do_push_state({action:this.action.id,active_id:this.discuss.activeId,});},_showRainbowMan(){this.trigger_up('show_effect',{message:this.env._t("Congratulations, your inbox is empty!"),type:'rainbow_man',});},});return __exports;});;

/* /mail/static/src/widgets/form_renderer/form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/widgets/form_renderer/form_renderer',async function(require){'use strict';let __exports={};const{getMessagingComponent}=require("@mail/utils/messaging_component");const FormRenderer=require('web.FormRenderer');const{ComponentWrapper}=require('web.OwlCompatibility');class ChatterContainerWrapperComponent extends ComponentWrapper{}
FormRenderer.include({init(parent,state,params){this._super(...arguments);this.chatterFields=params.chatterFields;this.mailFields=params.mailFields;this._chatterContainerComponent=undefined;this._chatterContainerTarget=undefined;this._isFromFormViewDialog=params.isFromFormViewDialog;},destroy(){this._super(...arguments);this._chatterContainerComponent=undefined;this.off('o_attachments_changed',this);this.off('o_chatter_rendered',this);this.off('o_message_posted',this);owl.Component.env.bus.off('mail.thread:promptAddFollower-closed',this);},_hasChatter(){return!!this._chatterContainerTarget;},_makeChatterContainerComponent(){const props=this._makeChatterContainerProps();this._chatterContainerComponent=new ChatterContainerWrapperComponent(this,getMessagingComponent("ChatterContainer"),props);this.on('o_chatter_rendered',this,ev=>this._onChatterRendered(ev));if(this.chatterFields.hasRecordReloadOnMessagePosted){this.on('o_message_posted',this,ev=>{this.trigger_up('reload',{keepChanges:true});});}
if(this.chatterFields.hasRecordReloadOnAttachmentsChanged){this.on('o_attachments_changed',this,ev=>this.trigger_up('reload',{keepChanges:true}));}
if(this.chatterFields.hasRecordReloadOnFollowersUpdate){owl.Component.env.bus.on('mail.thread:promptAddFollower-closed',this,ev=>this.trigger_up('reload',{keepChanges:true}));}},_makeChatterContainerProps(){return{hasActivities:this.chatterFields.hasActivityIds,hasFollowers:this.chatterFields.hasMessageFollowerIds,hasMessageList:this.chatterFields.hasMessageIds,isAttachmentBoxVisibleInitially:this.chatterFields.isAttachmentBoxVisibleInitially,threadId:this.state.res_id,threadModel:this.state.model,};},_makeChatterContainerTarget(){const $el=$('<div class="o_FormRenderer_chatterContainer"/>');this._chatterContainerTarget=$el[0];return $el;},async _mountChatterContainerComponent(){try{await this._chatterContainerComponent.mount(this._chatterContainerTarget);}catch(error){if(error.message!=="Mounting operation cancelled"){throw error;}}},_renderNode(node){if(node.tag==='div'&&node.attrs.class==='oe_chatter'){if(this._isFromFormViewDialog){return $('<div/>');}
return this._makeChatterContainerTarget();}
return this._super(...arguments);},async __renderView(){await this._super(...arguments);if(this._hasChatter()){if(!this._chatterContainerComponent){this._makeChatterContainerComponent();}else{await this._updateChatterContainerComponent();}
await this._mountChatterContainerComponent();}},async _updateChatterContainerComponent(){const props=this._makeChatterContainerProps();try{await this._chatterContainerComponent.update(props);}catch(error){if(error.message!=="Mounting operation cancelled"){throw error;}}},_onChatterRendered(ev){},});return __exports;});;

/* /mail/static/src/widgets/notification_alert/notification_alert.js defined in bundle 'web.assets_backend' */
odoo.define('@mail/widgets/notification_alert/notification_alert',async function(require){'use strict';let __exports={};const{getMessagingComponent}=require("@mail/utils/messaging_component");const{ComponentWrapper,WidgetAdapterMixin}=require('web.OwlCompatibility');const Widget=require('web.Widget');const widgetRegistry=require('web.widget_registry');class NotificationAlertWrapper extends ComponentWrapper{}
const NotificationAlertWidget=Widget.extend(WidgetAdapterMixin,{init(){this._super(...arguments);this.component=undefined;},async start(){await this._super(...arguments);this.component=new NotificationAlertWrapper(this,getMessagingComponent("NotificationAlert"),{});await this.component.mount(this.el);},});widgetRegistry.add('notification_alert',NotificationAlertWidget);__exports[Symbol.for("default")]=NotificationAlertWidget;return __exports;});;

/* /web_editor/static/src/js/wysiwyg/dialog.js defined in bundle 'web.assets_backend' */
odoo.define('wysiwyg.widgets.Dialog',function(require){'use strict';var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var _t=core._t;var WysiwygDialog=Dialog.extend({init:function(parent,options){this.options=options||{};if(config.device.isMobile){options.fullscreen=true;}
this._super(parent,_.extend({},{buttons:[{text:this.options.save_text||_t("Save"),classes:'btn-primary',click:this.save,},{text:_t("Discard"),close:true,}]},this.options));this.destroyAction='cancel';var self=this;this.opened(function(){self.$('input:visible:first').focus();self.$el.closest('.modal').addClass('o_web_editor_dialog');self.$el.closest('.modal').on('hidden.bs.modal',self.options.onClose);});this.on('closed',this,function(){self._toggleFullScreen();this.trigger(this.destroyAction,this.final_data||null);});},_toggleFullScreen:function(){if(config.device.isMobile&&!this.hasFullScreen){$('#iframe_target[isMobile="true"] #web_editor-top-edit .o_fullscreen').click();}},save:function(){this.destroyAction="save";this.close();},open:function(){this.hasFullScreen=$(window.top.document.body).hasClass('o_field_widgetTextHtml_fullscreen');this._toggleFullScreen();return this._super.apply(this,arguments);},});return WysiwygDialog;});;

/* /web_editor/static/src/js/frontend/loader.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.loader',function(require){'use strict';var ajax=require('web.ajax');let wysiwygPromise;const exports={};function loadWysiwyg(additionnalAssets=[]){return ajax.loadLibs({assetLibs:['web_editor.compiled_assets_wysiwyg',...additionnalAssets]},undefined,'/web_editor/public_render_template');}
exports.loadWysiwyg=loadWysiwyg;exports.createWysiwyg=async(parent,options,additionnalAssets=[])=>{const wysiwygAlias=options.wysiwygAlias||'web_editor.wysiwyg';if(!wysiwygPromise){wysiwygPromise=new Promise(async(resolve)=>{await loadWysiwyg(additionnalAssets);const stringFunction=`return new Promise(resolve => {
                odoo.define('${wysiwygAlias}.loaded', require => {
                    `+'require'+`('${wysiwygAlias}');
                    resolve();
                });
            });`;await new Function(stringFunction)();resolve();});}
await wysiwygPromise;const Wysiwyg=odoo.__DEBUG__.services[wysiwygAlias];return new Wysiwyg(parent,options);};exports.loadFromTextarea=async(parent,textarea,options)=>{var loading=textarea.nextElementSibling;if(loading&&!loading.classList.contains('o_wysiwyg_loading')){loading=null;}
const $textarea=$(textarea);const currentOptions=Object.assign({},options);currentOptions.value=currentOptions.value||$textarea.val()||'';if(!currentOptions.value.trim()){currentOptions.value='<p><br></p>';}
const wysiwyg=await exports.createWysiwyg(parent,currentOptions);const $wysiwygWrapper=$textarea.closest('.o_wysiwyg_textarea_wrapper');const $form=$textarea.closest('form');$textarea.hide();$form.append($textarea);$wysiwygWrapper.html('');await wysiwyg.appendTo($wysiwygWrapper);$form.find('.note-editable').data('wysiwyg',wysiwyg);$form.find('.note-editable').find('img.o_we_selected_image').removeClass('o_we_selected_image');$form.on('click','button[type=submit]',(e)=>{$form.find('.note-editable').find('img.o_we_selected_image').removeClass('o_we_selected_image');$form.find('.note-editable').find('img.float-left').removeClass('float-left');$textarea.html(wysiwyg.getValue());});return wysiwyg;};return exports;});;

/* /web_editor/static/src/js/backend/QWebPlugin.js defined in bundle 'web.assets_backend' */
odoo.define('@web_editor/js/backend/QWebPlugin',async function(require){'use strict';let __exports={};const{ancestors}=require('@web_editor/js/common/wysiwyg_utils');const QWebPlugin=__exports.QWebPlugin=class QWebPlugin{constructor(options={}){this._options=options;if(this._options.editor){this._editable=this._options.editor.editable;this._document=this._options.editor.document;}else{this._editable=this._options.editable;this._document=this._options.document||window.document;}
this._editable=this._options.editable||(this._options.editor&&this._options.editor.editable);this._document=this._options.document||(this._options.editor&&this._options.editor.document)||window.document;this._tGroupCount=0;this._hideBranchingSelection=this._hideBranchingSelection.bind(this);this._makeBranchingSelection();this._clickListeners=[];}
destroy(){this._selectElWrapper.remove();for(const listener of this._clickListeners){document.removeEventListener('click',listener);}}
cleanForSave(editable){for(const node of editable.querySelectorAll('[data-oe-t-group]')){node.removeAttribute('data-oe-t-group');node.removeAttribute('data-oe-t-inline');node.removeAttribute('data-oe-t-selectable');}}
sanitizeElement(subRoot){if(subRoot.nodeType!==Node.ELEMENT_NODE){return;}
if(this._options.editor){this._options.editor.observerUnactive('qweb-plugin-sanitize');}
this._fixInlines(subRoot);const demoElements=subRoot.querySelectorAll('[t-esc], [t-raw], [t-out]');for(const element of demoElements){element.setAttribute('contenteditable','false');}
this._groupQwebBranching(subRoot);if(this._options.editor){this._options.editor.observerActive('qweb-plugin-sanitize');}}
_groupQwebBranching(subRoot){const tNodes=subRoot.querySelectorAll('[t-if], [t-elif], [t-else]');const groupsEncounter=new Set();for(const node of tNodes){const parentTNode=[...node.parentElement.children];const index=parentTNode.indexOf(node);const prevNode=parentTNode[index-1];let groupId;if(prevNode&&node.previousElementSibling===prevNode&&!node.hasAttribute('t-if')){prevNode.setAttribute('data-oe-t-selectable','true');groupId=parseInt(prevNode.getAttribute('data-oe-t-group'));node.setAttribute('data-oe-t-selectable','true');}else{groupId=this._tGroupCount++;}
groupsEncounter.add(groupId);node.setAttribute('data-oe-t-group',groupId);const clickListener=e=>{e.stopImmediatePropagation();this._showBranchingSelection(node);};this._clickListeners.push(clickListener);node.addEventListener('click',clickListener);}
for(const groupId of groupsEncounter){const isOneElementActive=subRoot.querySelector(`[data-oe-t-group='${groupId}'][data-oe-t-group-active]`,);if(!isOneElementActive){subRoot.querySelector(`[data-oe-t-group='${groupId}']`).setAttribute('data-oe-t-group-active','true');}}}
_fixInlines(subRoot){const checkAllInline=el=>{return[...el.children].every(child=>{if(child.tagName==='T'){return checkAllInline(child);}else{return(child.nodeType!==Node.ELEMENT_NODE||window.getComputedStyle(child).display==='inline');}});};const tElements=subRoot.querySelectorAll('t');setTimeout(()=>{if(this._options.editor){this._options.editor.observerUnactive('qweb-plugin-checkAllInline');}
for(const tElement of tElements){if(checkAllInline(tElement)){tElement.setAttribute('data-oe-t-inline','true');}}
if(this._options.editor){this._options.editor.observerActive('qweb-plugin-checkAllInline');}});}
_makeBranchingSelection(){const document=this._options.document||window.document;this._selectElWrapper=document.createElement('div');this._selectElWrapper.classList.add('oe-qweb-select');this._selectElWrapper.innerHTML='';document.body.append(this._selectElWrapper);this._hideBranchingSelection();}
_showBranchingSelection(target){this._hideBranchingSelection();const branchingHierarchyElements=[target,...ancestors(target,this._editable)].filter(element=>element.getAttribute('data-oe-t-group-active')==='true').filter(element=>{const itemGroupId=element.getAttribute('data-oe-t-group');const groupItemsNodes=element.parentElement.querySelectorAll(`[data-oe-t-group='${itemGroupId}']`,);return groupItemsNodes.length>1;});if(!branchingHierarchyElements.length)return;const groupsActive=branchingHierarchyElements.map(node=>node.getAttribute('data-oe-t-group'),);for(const branchingElement of branchingHierarchyElements){this._selectElWrapper.prepend(this._renderBranchingSelection(branchingElement));}
const closeSelectHandler=event=>{const path=[event.target,...ancestors(event.target)];const shouldClose=!path.find(element=>element===this._selectElWrapper||groupsActive.includes(element.getAttribute('data-oe-t-group')),);if(shouldClose){this._hideBranchingSelection();document.removeEventListener('mousedown',closeSelectHandler);}};document.addEventListener('mousedown',closeSelectHandler);this._selectElWrapper.style.display='flex';this._updateBranchingSelectionPosition(branchingHierarchyElements[branchingHierarchyElements.length-1],);}
_updateBranchingSelectionPosition(target){window.addEventListener('mousewheel',this._hideBranchingSelection);const box=target.getBoundingClientRect();const selBox=this._selectElWrapper.getBoundingClientRect();this._selectElWrapper.style.left=`${window.scrollX + box.left}px`;this._selectElWrapper.style.top=`${window.scrollY + box.top - selBox.height}px`;}
_renderBranchingSelection(target){const selectEl=document.createElement('select');const groupId=parseInt(target.getAttribute('data-oe-t-group'));const groupElements=target.parentElement.querySelectorAll(`[data-oe-t-group='${groupId}']`,);for(const element of groupElements){const optionElement=document.createElement('option');if(element.hasAttribute('t-if')){optionElement.innerText='if';}else if(element.hasAttribute('t-elif')){optionElement.innerText='elif';}else if(element.hasAttribute('t-else')){optionElement.innerText='else';}
if(element.hasAttribute('data-oe-t-group-active')){optionElement.selected=true;}
selectEl.appendChild(optionElement);}
selectEl.onchange=()=>{let activeElement;for(let i=0;i<groupElements.length;i++){if(i===selectEl.selectedIndex){activeElement=groupElements[i];groupElements[i].setAttribute('data-oe-t-group-active','true');}else{groupElements[i].removeAttribute('data-oe-t-group-active');}}
this._showBranchingSelection(activeElement);};return selectEl;}
_hideBranchingSelection(){this._selectElWrapper.style.display='none';this._selectElWrapper.innerHTML=``;window.removeEventListener('mousewheel',this._hideBranchingSelection);}}
return __exports;});;

/* /web_editor/static/src/js/backend/convert_inline.js defined in bundle 'web.assets_backend' */
odoo.define('@web_editor/js/backend/convert_inline',async function(require){'use strict';let __exports={};'use strict';const FieldHtml=require('web_editor.field.html');const{isBlock,rgbToHex}=require("@web_editor/../lib/odoo-editor/src/utils/utils");const RE_COL_MATCH=/(^| )col(-[\w\d]+)*( |$)/;const RE_COMMAS_OUTSIDE_PARENTHESES=/,(?![^(]*?\))/g;const RE_OFFSET_MATCH=/(^| )offset(-[\w\d]+)*( |$)/;const RE_PADDING=/([\d.]+)/;const RE_WHITESPACE=/[\s\u200b]*/;const SELECTORS_IGNORE=/(^\*$|:hover|:before|:after|:active|:link|::|'|\([^(),]+[,(])/;const TABLE_ATTRIBUTES={cellspacing:0,cellpadding:0,border:0,width:'100%',align:'center',role:'presentation',};const TABLE_STYLES={'border-collapse':'collapse','text-align':'inherit','font-size':'unset','line-height':'unset',};function addTables($editable){const editable=$editable.get(0);for(const snippet of editable.querySelectorAll('.o_mail_snippet_general, .o_layout')){const table=_createTable(snippet.attributes);const row=document.createElement('tr');const col=document.createElement('td');row.appendChild(col);table.appendChild(row);for(const child of[...snippet.childNodes]){col.appendChild(child);}
snippet.before(table);snippet.remove();const childTables=[...col.children].filter(child=>child.nodeName==='TABLE');if(!childTables.length){const tableB=_createTable();const rowB=document.createElement('tr');const colB=document.createElement('td');rowB.appendChild(colB);tableB.appendChild(rowB);for(const child of[...col.childNodes]){colB.appendChild(child);}
col.appendChild(tableB);}}}
function attachmentThumbnailToLinkImg($editable){const editable=$editable.get(0);const links=[...editable.querySelectorAll(`a[href*="/web/content/"][data-mimetype]:empty`)].filter(link=>(RE_WHITESPACE.test(link.textContent)));for(const link of links){const image=document.createElement('img');image.setAttribute('src',_getStylePropertyValue(link,'background-image').replace(/(^url\(['"])|(['"]\)$)/g,''));image.setAttribute('height',Math.max(1,_getHeight(link))+'px');image.setAttribute('width',Math.max(1,_getWidth(link))+'px');link.prepend(image);};}
function bootstrapToTable($editable){const editable=$editable.get(0);for(const rowInColumn of[...editable.querySelectorAll('.row')].filter(row=>RE_COL_MATCH.test(row.parentElement.className))){_wrap(rowInColumn,'div','o_fake_table');}
for(const masonryGrid of editable.querySelectorAll('.o_masonry_grid_container')){masonryGrid.style.setProperty('padding',0);for(const fakeTable of[...masonryGrid.children].filter(c=>c.classList.contains('o_fake_table'))){fakeTable.style.setProperty('height',_getHeight(fakeTable));}}
for(const masonryRow of editable.querySelectorAll('.o_masonry_grid_container > .o_fake_table > .row.h-100')){masonryRow.style.removeProperty('height');masonryRow.parentElement.style.setProperty('height','100%');}
for(const container of[...editable.querySelectorAll('.container, .container-fluid, .o_fake_table')].filter(n=>[...n.children].some(c=>c.classList.contains('row')))){const table=_createTable(container.attributes);for(const child of[...container.childNodes]){table.append(child);}
table.classList.remove('container','container-fluid','o_fake_table');if(!table.className){table.removeAttribute('class');}
container.before(table);container.remove();for(const row of[...table.children].filter(child=>isBlock(child)&&!child.classList.contains('row'))){const newCol=_wrap(row,'div','col-12');_wrap(newCol,'div','row');}
for(const bootstrapRow of[...table.children].filter(c=>c.classList.contains('row'))){const tr=document.createElement('tr');for(const attr of bootstrapRow.attributes){tr.setAttribute(attr.name,attr.value);}
tr.classList.remove('row');if(!tr.className){tr.removeAttribute('class');}
for(const child of[...bootstrapRow.childNodes]){tr.append(child);}
bootstrapRow.before(tr);bootstrapRow.remove();const bootstrapColumns=[...tr.children].filter(column=>column.className&&column.className.match(RE_COL_MATCH));const flexColumns=bootstrapColumns.filter(column=>!/\d/.test(column.className.match(RE_COL_MATCH)[0]||'0'));const colTotalSize=bootstrapColumns.map(child=>_getColumnSize(child)).reduce((a,b)=>a+b);const colSize=Math.max(1,Math.round((12-colTotalSize)/flexColumns.length));for(const flexColumn of flexColumns){flexColumn.classList.remove(flexColumn.className.match(RE_COL_MATCH)[0].trim());flexColumn.classList.add(`col-${colSize}`);}
let grid=_createColumnGrid();let gridIndex=0;let currentRow=tr.cloneNode();tr.after(currentRow);let currentCol;let columnIndex=0;for(const bootstrapColumn of bootstrapColumns){const columnSize=_getColumnSize(bootstrapColumn);if(gridIndex+columnSize<12){currentCol=grid[gridIndex];_applyColspan(currentCol,columnSize);if(columnIndex===bootstrapColumns.length-1){grid[gridIndex].setAttribute('colspan',12-gridIndex);currentRow.append(...grid.filter(td=>td.getAttribute('colspan')));}
gridIndex+=columnSize;}else if(gridIndex+columnSize===12){currentCol=grid[gridIndex];_applyColspan(currentCol,columnSize);currentRow.append(...grid.filter(td=>td.getAttribute('colspan')));if(columnIndex!==bootstrapColumns.length-1){const previousRow=currentRow;currentRow=currentRow.cloneNode();previousRow.after(currentRow);grid=_createColumnGrid();gridIndex=0;}}else{_applyColspan(grid[gridIndex],12-gridIndex);currentRow.append(...grid.filter(td=>td.getAttribute('colspan')));const previousRow=currentRow;currentRow=currentRow.cloneNode();previousRow.after(currentRow);grid=_createColumnGrid();currentCol=grid[0];_applyColspan(currentCol,columnSize);gridIndex=columnSize;if(columnIndex===bootstrapColumns.length-1&&gridIndex<12){grid[gridIndex].setAttribute('colspan',12-gridIndex);currentRow.append(...grid.filter(td=>td.getAttribute('colspan')));_applyColspan(grid[gridIndex],12-gridIndex);}}
if(currentCol){for(const attr of bootstrapColumn.attributes){if(attr.name!=='colspan'){currentCol.setAttribute(attr.name,attr.value);}}
const colMatch=bootstrapColumn.className.match(RE_COL_MATCH);currentCol.classList.remove(colMatch[0].trim());if(!currentCol.className){currentCol.removeAttribute('class');}
for(const child of[...bootstrapColumn.childNodes]){currentCol.append(child);}
_applyColspan(currentCol,+currentCol.getAttribute('colspan'));}
columnIndex++;}
tr.remove();}}}
function cardToTable($editable){const editable=$editable.get(0);for(const card of editable.querySelectorAll('.card')){const table=_createTable(card.attributes);table.style.removeProperty('overflow');for(const child of[...card.childNodes]){const row=document.createElement('tr');const col=document.createElement('td');if(child.nodeName==='IMG'){col.append(child);}else if(child.nodeType===Node.TEXT_NODE){if(child.textContent.replace(RE_WHITESPACE,'').length){col.append(child);}else{continue;}}else{for(const attr of child.attributes){col.setAttribute(attr.name,attr.value);}
for(const descendant of[...child.childNodes]){col.append(descendant);}
child.remove();}
const subTable=_createTable();const superRow=document.createElement('tr');const superCol=document.createElement('td');row.append(col);subTable.append(row);superCol.append(subTable);superRow.append(superCol);table.append(superRow);}
card.before(table);card.remove();}}
function classToStyle($editable,cssRules){const editable=$editable.get(0);const writes=[];const nodeToRules=new Map();const rulesToProcess=[];for(const rule of cssRules){const nodes=editable.querySelectorAll(rule.selector);if(nodes.length){rulesToProcess.push(rule);}
for(const node of nodes){const nodeRules=nodeToRules.get(node);if(!nodeRules){nodeToRules.set(node,[rule]);}else{nodeRules.push(rule);}}}
_computeStyleAndSpecificityOnRules(rulesToProcess);for(const rules of nodeToRules.values()){rules.sort((a,b)=>a.specificity-b.specificity);}
for(const node of nodeToRules.keys()){const nodeRules=nodeToRules.get(node);const css=nodeRules?_getMatchedCSSRules(node,nodeRules):{};for(const styleName of node.style){if(styleName.includes('flex')||`${node.style[styleName]}`.includes('flex')){writes.push(()=>{node.style[styleName]='';});}}
if('font-family'in css){delete css['font-family'];}
let style=node.getAttribute('style')||'';style=style.replace(/!important/g,'');for(const[key,value]of Object.entries(css)){if(!(new RegExp(`(^|;)\\s*${key}`).test(style))){style=`${key}:${value};${style}`;}};if(_.isEmpty(style)){writes.push(()=>{node.removeAttribute('style');});}else{writes.push(()=>{node.setAttribute('style',style);if(node.style.width){node.setAttribute('width',node.style.width);}});}
if(node.nodeName==='IMG'&&node.classList.contains('s_media_list_img')){writes.push(()=>{node.style.removeProperty('height');});}
if(node.nodeName==='TD'&&!node.childNodes.length){writes.push(()=>{node.appendChild(document.createTextNode('&nbsp;'));});}
if(node.nodeName==='A'&&node.classList.contains('btn')&&!node.classList.contains('btn-link')&&!node.children.length){writes.push(()=>{node.prepend(document.createComment('[if mso]><i style="letter-spacing: 25px; mso-font-width: -100%; mso-text-raise: 30pt;">&nbsp;</i><![endif]'));});writes.push(()=>{node.append(document.createComment('[if mso]><i style="letter-spacing: 25px; mso-font-width: -100%;">&nbsp;</i><![endif]'));});}else if(node.nodeName==='IMG'&&node.classList.contains('mx-auto')&&node.classList.contains('d-block')){writes.push(()=>{_wrap(node,'p','o_outlook_hack','text-align:center;margin:0');});}};writes.forEach(fn=>fn());}
function toInline($editable,cssRules,$iframe){const editable=$editable.get(0);const iframe=$iframe&&$iframe.get(0);const doc=editable.ownerDocument;cssRules=cssRules||doc._rulesCache;if(!cssRules){cssRules=getCSSRules(doc);doc._rulesCache=cssRules;}
const displaysToRestore=[];if(_isHidden(editable)){let ancestor=editable;while(ancestor&&ancestor.nodeName!=='html'&&_isHidden(ancestor)){if(_getStylePropertyValue(ancestor,'display')==='none'){displaysToRestore.push([ancestor,ancestor.style.display]);ancestor.style.setProperty('display','block');}
ancestor=ancestor.parentElement;if((!ancestor||ancestor.nodeName==='HTML')&&iframe){ancestor=iframe;}}}
for(const attributeName of['width','height']){const images=editable.querySelectorAll('img');for(const image of images){let value=image.getAttribute(attributeName)||(attributeName==='height'&&image.offsetHeight);if(!value){value=attributeName==='width'?_getWidth(image):_getHeight(image);;}
image.setAttribute(attributeName,value);image.style.setProperty(attributeName,image.getAttribute(attributeName));};};attachmentThumbnailToLinkImg($editable);fontToImg($editable);classToStyle($editable,cssRules);bootstrapToTable($editable);cardToTable($editable);listGroupToTable($editable);addTables($editable);formatTables($editable);normalizeColors($editable);const rootFontSizeProperty=getComputedStyle(editable.ownerDocument.documentElement).fontSize;const rootFontSize=parseFloat(rootFontSizeProperty.replace(/[^\d\.]/g,''));normalizeRem($editable,rootFontSize);for(const[node,displayValue]of displaysToRestore){node.style.setProperty('display',displayValue);}}
function fontToImg($editable){const editable=$editable.get(0);const fonts=odoo.__DEBUG__.services["wysiwyg.fonts"];for(const font of editable.querySelectorAll('.fa')){let icon,content;fonts.fontIcons.find(fontIcon=>{return fonts.getCssSelectors(fontIcon.parser).find(data=>{if(font.matches(data.selector.replace(/::?before/g,''))){icon=data.names[0].split('-').shift();content=data.css.match(/content:\s*['"]?(.)['"]?/)[1];return true;}});});if(content){const color=_getStylePropertyValue(font,'color').replace(/\s/g,'');let backgroundColoredElement=font;let bg,isTransparent;do{bg=_getStylePropertyValue(backgroundColoredElement,'background-color').replace(/\s/g,'');isTransparent=bg==='transparent'||bg==='rgba(0,0,0,0)';backgroundColoredElement=backgroundColoredElement.parentElement;}while(isTransparent&&backgroundColoredElement);if(bg==='rgba(0,0,0,0)'&&isTransparent){bg='rgb(255,255,255)';}
const style=font.getAttribute('style');const width=_getWidth(font);const height=_getHeight(font);const lineHeight=_getStylePropertyValue(font,'line-height');font.style.setProperty('height','fit-content');font.style.setProperty('width','fit-content');font.style.setProperty('line-height','normal');const intrinsicWidth=_getWidth(font);const intrinsicHeight=_getHeight(font);const hPadding=width&&(width-intrinsicWidth)/2;const vPadding=height&&(height-intrinsicHeight)/2;let padding='';if(hPadding||vPadding){padding=vPadding?vPadding+'px ':'0 ';padding+=hPadding?hPadding+'px':'0';}
const image=document.createElement('img');image.setAttribute('width',width);image.setAttribute('height',height);image.setAttribute('src',`/web_editor/font_to_img/${content.charCodeAt(0)}/${window.encodeURI(color)}/${window.encodeURI(bg)}/${Math.max(1, Math.round(intrinsicWidth))}x${Math.max(1, Math.round(intrinsicHeight))}`);image.setAttribute('data-class',font.getAttribute('class'));image.setAttribute('data-style',style);image.setAttribute('style',style);image.style.setProperty('box-sizing','border-box');image.style.setProperty('line-height',lineHeight);image.style.setProperty('width',intrinsicWidth+'px');image.style.setProperty('height',intrinsicHeight+'px');image.style.setProperty('display','block');if(!padding){image.style.setProperty('margin',_getStylePropertyValue(font,'margin'));}
const wrapper=document.createElement('span');wrapper.style.setProperty('display','inline-block');wrapper.append(image);font.before(wrapper);font.remove();wrapper.style.setProperty('padding',padding);wrapper.style.setProperty('width',width+'px');wrapper.style.setProperty('height',height+'px');wrapper.style.setProperty('vertical-align','middle');wrapper.style.setProperty('background-color',image.style.backgroundColor);wrapper.setAttribute('class',font.getAttribute('class').replace(new RegExp('(^|\\s+)'+icon+'(-[^\\s]+)?','gi'),''));}else{font.remove();}}}
function formatTables($editable){const editable=$editable.get(0);const writes=[];for(const table of editable.querySelectorAll('table.o_mail_snippet_general, .o_mail_snippet_general table')){const tablePaddingTop=parseFloat(_getStylePropertyValue(table,'padding-top').match(RE_PADDING)[1]);const tablePaddingRight=parseFloat(_getStylePropertyValue(table,'padding-right').match(RE_PADDING)[1]);const tablePaddingBottom=parseFloat(_getStylePropertyValue(table,'padding-bottom').match(RE_PADDING)[1]);const tablePaddingLeft=parseFloat(_getStylePropertyValue(table,'padding-left').match(RE_PADDING)[1]);const rows=[...table.querySelectorAll('tr')].filter(tr=>tr.closest('table')===table);const columns=[...table.querySelectorAll('td')].filter(td=>td.closest('table')===table);for(const column of columns){const columnsInRow=[...column.closest('tr').querySelectorAll('td')].filter(td=>td.closest('table')===table);const columnIndex=columnsInRow.findIndex(col=>col===column);const rowIndex=rows.findIndex(row=>row===column.closest('tr'));if(!rowIndex){const match=_getStylePropertyValue(column,'padding-top').match(RE_PADDING);const columnPaddingTop=match?parseFloat(match[1]):0;writes.push(()=>{column.style['padding-top']=`${columnPaddingTop + tablePaddingTop}px`;});}
if(columnIndex===columnsInRow.length-1){const match=_getStylePropertyValue(column,'padding-right').match(RE_PADDING);const columnPaddingRight=match?parseFloat(match[1]):0;writes.push(()=>{column.style['padding-right']=`${columnPaddingRight + tablePaddingRight}px`;});}
if(rowIndex===rows.length-1){const match=_getStylePropertyValue(column,'padding-bottom').match(RE_PADDING);const columnPaddingBottom=match?parseFloat(match[1]):0;writes.push(()=>{column.style['padding-bottom']=`${columnPaddingBottom + tablePaddingBottom}px`;});}
if(!columnIndex){const match=_getStylePropertyValue(column,'padding-left').match(RE_PADDING);const columnPaddingLeft=match?parseFloat(match[1]):0;writes.push(()=>{column.style['padding-left']=`${columnPaddingLeft + tablePaddingLeft}px`;});}}
writes.push(()=>{table.style.removeProperty('padding');});}
writes.forEach((fn)=>fn());for(const table of[...editable.querySelectorAll('table')].filter(n=>![...n.children].some(c=>c.nodeName==='TBODY'))){const contents=[...table.childNodes];const tbody=document.createElement('tbody');tbody.style.setProperty('vertical-align','top');table.prepend(tbody);tbody.append(...contents);}
for(const node of[...editable.querySelectorAll('*')].filter(n=>(n.style&&n.style.getPropertyValue('height')==='100%'&&(!n.parentElement.style.getPropertyValue('height')||n.parentElement.style.getPropertyValue('height').includes('%'))))){let parent=node.parentElement;let height=parent.style.getPropertyValue('height');while(parent&&height&&height.includes('%')){parent=parent.parentElement;height=parent.style.getPropertyValue('height');}
if(parent){parent.style.setProperty('height',$(parent).height());}}
for(const cell of editable.querySelectorAll('td')){const alignSelf=cell.style.alignSelf;const justifyContent=cell.style.justifyContent;if(alignSelf==='start'||justifyContent==='start'||justifyContent==='flex-start'){cell.style.verticalAlign='top';}else if(alignSelf==='center'||justifyContent==='center'){cell.style.verticalAlign='middle';}else if(alignSelf==='end'||justifyContent==='end'||justifyContent==='flex-end'){cell.style.verticalAlign='bottom';}}
for(const cell of editable.querySelectorAll('tr')){const alignItems=cell.style.alignItems;if(alignItems==='flex-start'){cell.style.verticalAlign='top';}else if(alignItems==='center'){cell.style.verticalAlign='middle';}else if(alignItems==='flex-end'||alignItems==='baseline'){cell.style.verticalAlign='bottom';}}}
function getCSSRules(doc){const cssRules=[];for(const sheet of doc.styleSheets){let rules;try{rules=sheet.rules||sheet.cssRules;}catch(e){console.log("Can't read the css rules of: "+sheet.href,e);continue;}
for(const rule of(rules||[])){const subRules=[rule];const conditionText=rule.conditionText;const minWidthMatch=conditionText&&conditionText.match(/\(min-width *: *(\d+)/);const minWidth=minWidthMatch&&+(minWidthMatch[1]||'0');if(minWidth&&minWidth>=1200){let mediaRules;try{mediaRules=rule.rules||rule.cssRules;subRules.push(...mediaRules);}catch(e){console.log(`Can't read the css rules of: ${sheet.href} (${conditionText})`,e);}}
for(const subRule of subRules){const selectorText=subRule.selectorText||'';for(const selector of selectorText.split(RE_COMMAS_OUTSIDE_PARENTHESES)){if(selector&&!SELECTORS_IGNORE.test(selector)){cssRules.push({selector:selector.trim(),rawRule:subRule});if(selector==='body'){cssRules.push({selector:'.o_layout',rawRule:subRule,specificity:1});}}}}}}
return cssRules;}
function listGroupToTable($editable){const editable=$editable.get(0);for(const listGroup of editable.querySelectorAll('.list-group')){let table;if(listGroup.querySelectorAll('.list-group-item').length){table=_createTable(listGroup.attributes);}else{table=listGroup.cloneNode();for(const attr of listGroup.attributes){table.setAttribute(attr.name,attr.value);}}
for(const child of[...listGroup.childNodes]){if(child.classList&&child.classList.contains('list-group-item')){const row=document.createElement('tr');const col=document.createElement('td');for(const attr of child.attributes){col.setAttribute(attr.name,attr.value);}
col.append(...child.childNodes);col.classList.remove('list-group-item');if(!col.className){col.removeAttribute('class');}
row.append(col);table.append(row);child.remove();}else if(child.nodeName==='LI'){table.append(...child.childNodes);}else{table.append(child);}}
table.classList.remove('list-group');if(!table.className){table.removeAttribute('class');}
if(listGroup.nodeName==='TD'){listGroup.append(table);listGroup.classList.remove('list-group');if(!listGroup.className){listGroup.removeAttribute('class');}}else{listGroup.before(table);listGroup.remove();}}}
function normalizeColors($editable){const editable=$editable.get(0);for(const node of editable.querySelectorAll('[style*="rgb"]')){const rgbMatch=node.getAttribute('style').match(/rgb?\(([\d\.]*,?\s?){3,4}\)/g);for(const rgb of rgbMatch||[]){node.setAttribute('style',node.getAttribute('style').replace(rgb,rgbToHex(rgb)));}}}
function normalizeRem($editable,rootFontSize=16){const editable=$editable.get(0);for(const node of editable.querySelectorAll('[style*="rem"]')){const remMatch=node.getAttribute('style').match(/[\d\.]+\s*rem/g);for(const rem of remMatch||[]){const remValue=parseFloat(rem.replace(/[^\d\.]/g,''));const pxValue=Math.round(remValue*rootFontSize*100)/100;node.setAttribute('style',node.getAttribute('style').replace(rem,pxValue+'px'));}}}
function _applyColspan(element,colspan){element.setAttribute('colspan',colspan);const width=(Math.round(+element.getAttribute('colspan')*10000/12)/100)+'%';element.setAttribute('width',width);element.style.setProperty('width',width);}
function _computeSpecificity(selector){let a=0;selector=selector.replace(/#[a-z0-9_-]+/gi,()=>{a++;return'';});let b=0;selector=selector.replace(/(\.[a-z0-9_-]+)|(\[.*?\])/gi,()=>{b++;return'';});let c=0;selector=selector.replace(/(^|\s+|:+)[a-z0-9_-]+/gi,a=>{if(!a.includes(':not('))c++;return'';});return(a*100)+(b*10)+c;}
function _computeStyleAndSpecificityOnRules(cssRules){for(const cssRule of cssRules){if(!cssRule.style&&cssRule.rawRule.style){const style=_normalizeStyle(cssRule.rawRule.style);if(Object.keys(style).length){Object.assign(cssRule,{style,specificity:_computeSpecificity(cssRule.selector)});}}}}
function _createColumnGrid(){return new Array(12).fill().map(()=>document.createElement('td'));}
function _createTable(attributes=[]){const table=document.createElement('table');Object.entries(TABLE_ATTRIBUTES).forEach(([att,value])=>table.setAttribute(att,value));table.style.setProperty('width','100%','important');for(const attr of attributes){if(!(attr.name==='width'&&attr.value==='100%')){table.setAttribute(attr.name,attr.value);}}
if(table.classList.contains('o_layout')){const layoutStyles={...TABLE_STYLES};delete layoutStyles['font-size'];delete layoutStyles['line-height'];Object.entries(layoutStyles).forEach(([att,value])=>table.style[att]=value)}else{for(const styleName in TABLE_STYLES){if(!('style'in attributes&&attributes.style.value.includes(styleName+':'))){table.style[styleName]=TABLE_STYLES[styleName];}}}
return table;}
function _getColumnSize(column){const colMatch=column.className.match(RE_COL_MATCH);const colOptions=colMatch[2]&&colMatch[2].substr(1).split('-');const colSize=colOptions&&(colOptions.length===2?+colOptions[1]:+colOptions[0])||0;const offsetMatch=column.className.match(RE_OFFSET_MATCH);const offsetOptions=offsetMatch&&offsetMatch[2]&&offsetMatch[2].substr(1).split('-');const offsetSize=offsetOptions&&(offsetOptions.length===2?+offsetOptions[1]:+offsetOptions[0])||0;return colSize+offsetSize;}
function _getMatchedCSSRules(node,cssRules){node.matches=node.matches||node.webkitMatchesSelector||node.mozMatchesSelector||node.msMatchesSelector||node.oMatchesSelector;const styles=cssRules.map((rule)=>rule.style).filter(Boolean);if(node.style.length){const inlineStyles={};for(const styleName of node.style){inlineStyles[styleName]=node.style[styleName];}
styles.push(inlineStyles);}
const processedStyle={};for(const style of styles){for(const[key,value]of Object.entries(style)){if(!processedStyle[key]||!processedStyle[key].includes('important')||value.includes('important')){processedStyle[key]=value;}}}
for(const[key,value]of Object.entries(processedStyle)){if(value.endsWith('important')){processedStyle[key]=value.replace(/\s*!important\s*$/,'');}};if(processedStyle.display==='block'&&!(node.classList&&node.classList.contains('btn-block'))){delete processedStyle.display;}
if(!processedStyle['box-sizing']){processedStyle['box-sizing']='border-box';}
for(const info of[{name:'margin'},{name:'padding'},{name:'border',suffix:'-style',defaultValue:'none'},]){const positions=['top','right','bottom','left'];const positionalKeys=positions.map(position=>`${info.name}-${position}${info.suffix || ''}`);const hasStyles=positionalKeys.some(key=>processedStyle[key]);const inherits=positionalKeys.some(key=>['inherit','initial'].includes((processedStyle[key]||'').trim()));if(hasStyles&&!inherits){const propertyName=`${info.name}${info.suffix || ''}`;processedStyle[propertyName]=positionalKeys.every(key=>processedStyle[positionalKeys[0]]===processedStyle[key])?processedStyle[propertyName]=processedStyle[positionalKeys[0]]:positionalKeys.map(key=>processedStyle[key]||(info.defaultValue||0)).join(' ');for(const prop of positionalKeys){delete processedStyle[prop];}}};if(processedStyle['border-bottom-left-radius']){processedStyle['border-radius']=processedStyle['border-bottom-left-radius'];delete processedStyle['border-bottom-left-radius'];delete processedStyle['border-bottom-right-radius'];delete processedStyle['border-top-left-radius'];delete processedStyle['border-top-right-radius'];}
for(const styleName in processedStyle){if(styleName.includes('border')&&processedStyle[styleName]==='initial'){delete processedStyle[styleName];}};if(processedStyle['text-decoration-line']){processedStyle['text-decoration']=processedStyle['text-decoration-line'];delete processedStyle['text-decoration-line'];delete processedStyle['text-decoration-color'];delete processedStyle['text-decoration-style'];delete processedStyle['text-decoration-thickness'];}
for(const styleName in processedStyle){if(styleName.includes('flex')||`${processedStyle[styleName]}`.includes('flex')){delete processedStyle[styleName];}}
return processedStyle;}
let lastComputedStyleElement;let lastComputedStyle
function _getStylePropertyValue(element,propertyName){const computedStyle=lastComputedStyleElement===element?lastComputedStyle:getComputedStyle(element)
lastComputedStyleElement=element;lastComputedStyle=computedStyle;return computedStyle[propertyName]||element.style.getPropertyValue(propertyName);}
function _getWidth(element){return parseFloat(getComputedStyle(element).width.replace('px',''));}
function _getHeight(element){return parseFloat(getComputedStyle(element).height.replace('px',''));}
function _isHidden(element){return element.offsetParent===null;}
function _normalizeStyle(style){const normalizedStyle={};for(const styleName of style){const value=style[styleName];if(value&&!styleName.includes('animation')&&!styleName.includes('-webkit')&&_.isString(value)){const normalizedStyleName=styleName.replace(/-(.)/g,(a,b)=>b.toUpperCase());normalizedStyle[styleName]=style[normalizedStyleName];if(style.getPropertyPriority(styleName)==='important'){normalizedStyle[styleName]+=' !important';}}}
return normalizedStyle;}
function _wrap(element,wrapperTag,wrapperClass,wrapperStyle){const wrapper=document.createElement(wrapperTag);wrapper.className=wrapperClass;wrapper.style.cssText=wrapperStyle;element.parentElement.insertBefore(wrapper,element);wrapper.append(element);return wrapper;}
FieldHtml.include({commitChanges:function(){if(this.nodeOptions['style-inline']&&this.mode==="edit"){this._toInline();}
return this._super();},_toInline:function(){var $editable=this.wysiwyg.getEditable();var html=this.wysiwyg.getValue();const $odooEditor=$editable.closest('.odoo-editor');$odooEditor.removeClass('odoo-editor');$editable.html(html);toInline($editable,this.cssRules,this.wysiwyg.$iframe);$odooEditor.addClass('odoo-editor');this.wysiwyg.setValue($editable.html(),{notifyChange:false,});},});__exports[Symbol.for("default")]={addTables:addTables,attachmentThumbnailToLinkImg:attachmentThumbnailToLinkImg,bootstrapToTable:bootstrapToTable,cardToTable:cardToTable,classToStyle:classToStyle,fontToImg:fontToImg,formatTables:formatTables,getCSSRules:getCSSRules,listGroupToTable:listGroupToTable,normalizeColors:normalizeColors,normalizeRem:normalizeRem,toInline:toInline,};return __exports;});odoo.define(`web_editor.convertInline`,async function(require){return require('@web_editor/js/backend/convert_inline')[Symbol.for("default")];});;

/* /web_editor/static/src/js/backend/field_html.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.field.html',function(require){'use strict';var ajax=require('web.ajax');var basic_fields=require('web.basic_fields');var core=require('web.core');var wysiwygLoader=require('web_editor.loader');var field_registry=require('web.field_registry');const{QWebPlugin}=require('@web_editor/js/backend/QWebPlugin');require('web._field_registry');var _lt=core._lt;var TranslatableFieldMixin=basic_fields.TranslatableFieldMixin;var QWeb=core.qweb;var FieldHtml=basic_fields.DebouncedField.extend(TranslatableFieldMixin,{description:_lt("Html"),className:'oe_form_field oe_form_field_html',supportedFieldTypes:['html'],isQuickEditable:true,quickEditExclusion:['[href]',],custom_events:{wysiwyg_focus:'_onWysiwygFocus',wysiwyg_blur:'_onWysiwygBlur',wysiwyg_change:'_onChange',wysiwyg_attachment:'_onAttachmentChange',},willStart:async function(){this.isRendered=false;this._onUpdateIframeId='onLoad_'+_.uniqueId('FieldHtml');await this._super();if(this.nodeOptions.cssReadonly){this.cssReadonly=await ajax.loadAsset(this.nodeOptions.cssReadonly);}
if(this.nodeOptions.cssEdit||this.nodeOptions['style-inline']){this.cssEdit=await ajax.loadAsset(this.nodeOptions.cssEdit||'web_editor.assets_edit_html_field');}},destroy:function(){delete window.top[this._onUpdateIframeId];if(this.$iframe){this.$iframe.remove();}
if(this._qwebPlugin){this._qwebPlugin.destroy();}
this._super();},activate:function(options){if(this.wysiwyg){this.wysiwyg.focus();return true;}},commitChanges:function(){if(this.mode=="readonly"||!this.isRendered){return this._super();}
var _super=this._super.bind(this);this.wysiwyg.odooEditor.clean();return this.wysiwyg.saveModifiedImages(this.$content).then(()=>{this._isDirty=this.wysiwyg.isDirty();_super();});},isSet:function(){var value=this.value&&this.value.split('&nbsp;').join('').replace(/\s/g,'');return value&&value!=="<p></p>"&&value!=="<p><br></p>"&&value.match(/\S/);},getFocusableElement:function(){return this.wysiwyg&&this.wysiwyg.$editable||$();},reset:function(record,event){this._reset(record,event);var value=this.value;if(this.nodeOptions.wrapper){value=this._wrap(value);}
value=this._textToHtml(value);if(!event||event.target!==this){if(this.mode==='edit'&&this.wysiwyg){this.wysiwyg.setValue(value);}else if(this.cssReadonly){return Promise.resolve();}else{this.$content.html(value);}}
return Promise.resolve();},_getValue:function(){let value;if(!this._$codeview||this._$codeview.hasClass('d-none')){value=this.wysiwyg.getValue();}else{value=this._$codeview.val();}
if(this.nodeOptions.wrapper){return this._unWrap(value);}
return value;},_createWysiwygIntance:async function(){this.wysiwyg=await wysiwygLoader.createWysiwyg(this,this._getWysiwygOptions());return this.wysiwyg.appendTo(this.$el).then(()=>{this.$content=this.wysiwyg.$editable;this._onLoadWysiwyg();this.isRendered=true;});},_getWysiwygOptions:function(){return Object.assign({},this.nodeOptions,{recordInfo:{context:this.record.getContext(this.recordParams),res_model:this.model,res_id:this.res_id,},placeholder:this.attrs&&this.attrs.placeholder,collaborationChannel:!!this.nodeOptions.collaborative&&{collaborationModelName:this.model,collaborationFieldName:this.name,collaborationResId:parseInt(this.res_id),},noAttachment:this.nodeOptions['no-attachment'],inIframe:!!this.nodeOptions.cssEdit,iframeCssAssets:this.nodeOptions.cssEdit,snippets:this.nodeOptions.snippets,value:this.value,mediaModalParams:{noVideos:'noVideos'in this.nodeOptions?this.nodeOptions.noVideos:true,},linkForceNewWindow:true,tabsize:0,height:this.nodeOptions.height,minHeight:this.nodeOptions.minHeight,maxHeight:this.nodeOptions.maxHeight,resizable:'resizable'in this.nodeOptions?this.nodeOptions.resizable:false,editorPlugins:[QWebPlugin],});},_toggleCodeView:function($codeview){this.wysiwyg.odooEditor.observerUnactive();$codeview.height(this.$content.height());$codeview.toggleClass('d-none');this.$content.toggleClass('d-none');if($codeview.hasClass('d-none')){if(this.resizerHandleObserver){this.resizerHandleObserver.disconnect();delete this.resizerHandleObserver;}
this.wysiwyg.odooEditor.observerActive();this.wysiwyg.setValue($codeview.val());}else{this.resizerHandleObserver=new MutationObserver((mutations,observer)=>{for(let mutation of mutations){if(mutation.type==='attributes'&&mutation.attributeName==='style'){$codeview[0].style.height=this.$content[0].style.height;}}});this.resizerHandleObserver.observe(this.$content[0],{attributes:true});$codeview.val(this.$content.html());this.wysiwyg.odooEditor.observerActive();}},_onAttachmentChange:function(attachments){if(!this.fieldNameAttachment){return;}
this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:_.object([this.fieldNameAttachment],[{operation:'ADD_M2M',ids:attachments}])});},_renderEdit:function(){if(this.nodeOptions.notEditable){return this._renderReadonly();}
var value=this._textToHtml(this.value);if(this.nodeOptions.wrapper){value=this._wrap(value);}
var fieldNameAttachment=_.chain(this.recordData).pairs().find(function(value){return _.isObject(value[1])&&value[1].model==="ir.attachment";}).first().value();if(fieldNameAttachment){this.fieldNameAttachment=fieldNameAttachment;}
if(this.nodeOptions.cssEdit){this._createWysiwygIntance();}else{return this._createWysiwygIntance();}},_renderReadonly:function(){var self=this;var value=this._textToHtml(this.value);if(this.nodeOptions.wrapper){value=this._wrap(value);}
this.$el.empty();var resolver;var def=new Promise(function(resolve){resolver=resolve;});if(this.nodeOptions.cssReadonly){this.$iframe=$('<iframe class="o_readonly d-none"/>');this.$iframe.appendTo(this.$el);var avoidDoubleLoad=0;this.$iframe.data('loadDef',def);window.top[this._onUpdateIframeId]=function(_avoidDoubleLoad){if(_avoidDoubleLoad!==avoidDoubleLoad){console.warn('Wysiwyg iframe double load detected');return;}
self.$content=$('#iframe_target',self.$iframe[0].contentWindow.document.body);resolver();self.trigger_up('iframe_updated',{$iframe:self.$iframe});};this.$iframe.on('load',function onLoad(){var _avoidDoubleLoad=++avoidDoubleLoad;ajax.loadAsset(self.nodeOptions.cssReadonly).then(function(asset){if(_avoidDoubleLoad!==avoidDoubleLoad){console.warn('Wysiwyg immediate iframe double load detected');return;}
var cwindow=self.$iframe[0].contentWindow;try{cwindow.document;}catch(e){return;}
cwindow.document.open("text/html","replace").write('<!DOCTYPE html><html>'+'<head>'+'<meta charset="utf-8"/>'+'<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>\n'+'<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>\n'+
_.map(asset.cssLibs,function(cssLib){return'<link type="text/css" rel="stylesheet" href="'+cssLib+'"/>';}).join('\n')+'\n'+
_.map(asset.cssContents,function(cssContent){return'<style type="text/css">'+cssContent+'</style>';}).join('\n')+'\n'+'</head>\n'+'<body class="o_in_iframe o_readonly" style="overflow: hidden;">\n'+'<div id="iframe_target">'+value+'</div>\n'+'<script type="text/javascript">'+'if (window.top.'+self._onUpdateIframeId+') {'+'window.top.'+self._onUpdateIframeId+'('+_avoidDoubleLoad+')'+'}'+'</script>\n'+'</body>'+'</html>');var height=cwindow.document.body.scrollHeight;self.$iframe.css('height',Math.max(30,Math.min(height,500))+'px');$(cwindow).on('click',function(ev){if(!ev.target.closest("[href]")){self._onClick(ev);}});});});}else{this.$content=$('<div class="o_readonly"/>').html(value);this.$content.appendTo(this.$el);this._qwebPlugin=new QWebPlugin();this._qwebPlugin.sanitizeElement(this.$content[0]);resolver();}
def.then(function(){self.$content.on('click','ul.o_checklist > li',self._onReadonlyClickChecklist.bind(self));if(self.$iframe){self.$iframe.removeClass('d-none');}});},_textToHtml:function(text){var value=text||"";try{$(text)[0].innerHTML;}catch(e){if(value.match(/^\s*$/)){value='<p><br/></p>';}else{value="<p>"+value.split(/<br\/?>/).join("<br/></p><p>")+"</p>";value=value.replace(/<p><\/p>/g,'').replace('<p><p>','<p>').replace('<p><p ','<p ').replace('</p></p>','</p>');}}
return value;},_unWrap:function(html){var $wrapper=$(html).find('#wrapper');return $wrapper.length?$wrapper.html():html;},_wrap:function(html){return $(QWeb.render(this.nodeOptions.wrapper)).find('#wrapper').html(html).end().prop('outerHTML');},_onChange:function(ev){this._doDebouncedAction.apply(this,arguments);var $lis=this.$content.find('.note-editable ul.o_checklist > li:not(:has(> ul.o_checklist))');if(!$lis.length){return;}
var max=0;var ids=[];$lis.map(function(){var checklistId=parseInt(($(this).attr('id')||'0').replace(/^checklist-id-/,''));if(ids.indexOf(checklistId)===-1){if(checklistId>max){max=checklistId;}
ids.push(checklistId);}else{$(this).removeAttr('id');}});$lis.not('[id]').each(function(){$(this).attr('id','checklist-id-'+(++max));});},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ENTER){ev.stopPropagation();return;}
this._super.apply(this,arguments);},_onReadonlyClickChecklist:function(ev){var self=this;if(ev.offsetX>0){return;}
ev.stopPropagation();ev.preventDefault();var checked=$(ev.target).hasClass('o_checked');var checklistId=parseInt(($(ev.target).attr('id')||'0').replace(/^checklist-id-/,''));this._rpc({route:'/web_editor/checklist',params:{res_model:this.model,res_id:this.res_id,filename:this.name,checklistId:checklistId,checked:!checked,},}).then(function(value){self._setValue(value);});},_onLoadWysiwyg:function(){var $button=this._renderTranslateButton();$button.css({'font-size':'15px',position:'absolute',right:odoo.debug&&this.nodeOptions.codeview?'40px':'5px',top:'5px',});this.$el.append($button);if(odoo.debug&&this.nodeOptions.codeview){const $codeviewButtonToolbar=$(`
                <div id="codeview-btn-group" class="btn-group">
                    <button class="o_codeview_btn btn btn-primary">
                        <i class="fa fa-code"></i>
                    </button>
                </div>
            `);this.$floatingCodeViewButton=$codeviewButtonToolbar.clone();this._$codeview=$('<textarea class="o_codeview d-none"/>');this.wysiwyg.$editable.after(this._$codeview);this._$codeview.after(this.$floatingCodeViewButton);this.wysiwyg.toolbar.$el.append($codeviewButtonToolbar);$codeviewButtonToolbar.click(()=>this._toggleCodeView(this._$codeview));this.$floatingCodeViewButton.click(()=>this._toggleCodeView(this._$codeview));}},_onWysiwygBlur:function(ev){ev.stopPropagation();this._doAction();if(ev.data.key==='TAB'){this.trigger_up('navigation_move',{direction:ev.data.shiftKey?'left':'right',});}},_onWysiwygFocus:function(ev){},});field_registry.add('html',FieldHtml);return FieldHtml;});;

/* /resource/static/src/js/section_fields_backend.js defined in bundle 'web.assets_backend' */
odoo.define('resource.section_backend',function(require){"use strict";var FieldOne2Many=require('web.relational_fields').FieldOne2Many;var fieldRegistry=require('web.field_registry');var ListRenderer=require('web.ListRenderer');var SectionListRenderer=ListRenderer.extend({_renderBodyCell:function(record,node,index,options){var $cell=this._super.apply(this,arguments);var isSection=record.data.display_type==='line_section';if(isSection){if(node.attrs.widget==="handle"){return $cell;}else if(node.attrs.name==="display_name"){var nbrColumns=this._getNumberOfCols();if(this.handleField){nbrColumns--;}
if(this.addTrashIcon){nbrColumns--;}
$cell.attr('colspan',nbrColumns);}else{return $cell.addClass('o_hidden');}}
return $cell;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(record.data.display_type){$row.addClass('o_is_'+record.data.display_type);}
return $row;},_renderView:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$('.o_list_table').addClass('o_section_list_view');self.$('.o_is_line_section .o_list_record_remove').remove()});},});var SectionFieldOne2Many=FieldOne2Many.extend({_getRenderer:function(){if(this.view.arch.tag==='tree'){return SectionListRenderer;}
return this._super.apply(this,arguments);},});fieldRegistry.add('section_one2many',SectionFieldOne2Many);});;

/* /documents/static/src/js/documents_controller_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('documents.controllerMixin',function(require){'use strict';const DocumentsInspector=require('documents.DocumentsInspector');const DocumentViewer=require('documents.DocumentViewer');const{computeMultiSelection}=require('documents.utils');const{getMessagingComponent}=require('@mail/utils/messaging_component');const{_t,qweb}=require('web.core');const config=require('web.config');const{Markup}=require('web.utils');const fileUploadMixin=require('web.fileUploadMixin');const session=require('web.session');const{ComponentWrapper}=require('web.OwlCompatibility');const Dialog=require('web.Dialog');class ChatterContainerWrapperComponent extends ComponentWrapper{}
const DocumentsControllerMixin=Object.assign({},fileUploadMixin,{events:{'click .o_documents_kanban_share_domain':'_onClickDocumentsShareDomain','click .o_documents_kanban_upload':'_onClickDocumentsUpload','click .o_documents_kanban_url':'_onClickDocumentsUploadFromUrl','click .o_documents_kanban_request':'_onClickDocumentsRequest','dragleave .o_documents_view':'_onDragleaveDocumentsView','dragover .o_documents_view':'_onDragoverDocumentsView','dragstart .o_document_draggable':'_onDragstartDocumentDraggable','drop .o_documents_view':'_onDropDocumentsView',},custom_events:Object.assign({},fileUploadMixin.custom_events,{archive_records:'_onArchiveRecords',delete_model:'_onDeleteModel',delete_records:'_onDeleteRecords',document_viewer_attachment_changed:'_onDocumentViewerAttachmentChanged',download:'_onDownload',edit_model:'_onEditModel',get_search_panel_tags:'_onGetSearchPanelTags',history_item_delete:'_onHistoryItemDelete',history_item_download:'_onHistoryItemDownload',history_item_restore:'_onHistoryItemRestore',kanban_image_clicked:'_onKanbanImageClicked',lock_attachment:'_onLockAttachment',o_close_chatter:'_onDocumentsCloseChatter',open_chatter:'_onOpenChatter',open_record:'_onOpenRecord',save_multi:'_onSaveMulti',select_record:'_onSelectRecord',set_focus_tag_input:'_onSetFocusTagInput',set_file:'_onSetFile',share_ids:'_onShareIds',trigger_rule:'_onTriggerRule',}),init(parent,model,renderer,params){this._anchorId=null;this._chatterContainerComponent=undefined;this._documentsInspector=null;this._isInspectorTagInputFocusOnMount=false;this._selectedRecordIds=params.selectedRecordIds||[];fileUploadMixin.init.call(this);this._hasShareReadAccessRights=undefined;},async willStart(){const parentPromise=this._super(...arguments);const readAccessRightsPromise=this._rpc({model:'documents.share',method:'check_access_rights',kwargs:{'operation':'read','raise_exception':false,},}).then((res)=>{this._hasShareReadAccessRights=res;});return Promise.all([parentPromise,readAccessRightsPromise]);},start(){this._updateSelection();},exportState(){const state=this._super(...arguments)||{};state.selectedRecordIds=this._selectedRecordIds;return state;},async reload(){this._updateSelection();await this._renderFileUploads();const folderIds=[...new Set(Object.values(this._fileUploads).map(upload=>upload.folderId))];this._updateSearchPanel({uploadingFolderIds:folderIds});},renderButtons($node){this.$buttons=$(qweb.render('DocumentsViews.buttons'));if($node){this.$buttons.appendTo($node);}},_closeChatter(){this.$('.o_content').removeClass('o_chatter_open');this.$('.o_document_chatter_container').remove();if(this._chatterContainerComponent){this._chatterContainerComponent.destroy();this._chatterContainerComponent=undefined;}},async _deferredRenderInspector(ev){const state=this.model.get(this.handle);return new Promise((resolve)=>{setTimeout(()=>{this._renderDocumentsInspector(state);resolve();});});},_getFileUploadRenderOptions(){const currentFolderId=this.searchModel.get('selectedFolderId');return{predicate:fileUpload=>{return!currentFolderId||fileUpload.recordId||currentFolderId===fileUpload.folderId;},targetCallback:fileUpload=>{const $targetCard=this.$(`.o_documents_attachment[data-id="${fileUpload.recordId}"]`);$targetCard.find('.o_record_selector').addClass('o_hidden');return $targetCard;},};},_getFileUploadRoute(){return'/documents/upload_attachment';},_getRules(documents){const ruleIdsByRecord=documents.map(record=>record.available_rule_ids.res_ids);const commonRuleIds=_.intersection.apply(_,ruleIdsByRecord);const record=documents[0];const rules=commonRuleIds.map(ruleId=>{const rule=record.available_rule_ids.data.find(record=>record.res_id===ruleId);return rule.data;});return rules.filter(rule=>!rule.limited_to_single_record);},_makeChatterContainerProps(){return{hasActivities:this.modelName==='documents.document',hasFollowers:true,hasTopbarCloseButton:true,threadId:this._selectedRecordIds[0],threadModel:this.modelName,};},_makeDragIcon({dataTransfer,lockedCount,draggedRecordIds}){let dragIconContent;if(lockedCount>0){dragIconContent=_.str.sprintf(_t("%s Documents (%s locked)"),draggedRecordIds.length,lockedCount);}else{dragIconContent=_.str.sprintf(_t("%s Documents"),draggedRecordIds.length);}
if(draggedRecordIds.length===1){const state=this.model.get(this.handle);const record=state.data.find(record=>record.res_id===draggedRecordIds[0]);if(record){dragIconContent=record.data.name?record.data.display_name:_t("Unnamed");}}
const $dragIcon=$(qweb.render('documents.dragIcon',{dragIconContent,})).appendTo($('body'));dataTransfer.setDragImage($dragIcon[0],-5,-5);setTimeout(()=>$dragIcon.remove());},_makeFileUpload({recordId}){return Object.assign({folderId:this.searchModel.get('selectedFolderId'),tag_ids:this.searchModel.get('selectedTagIds'),recordId,},fileUploadMixin._makeFileUpload.apply(this,arguments));},_makeFileUploadFormDataKeys({recordId}){const context=this.model.get(this.handle,{raw:true}).getContext();return{document_id:recordId,folder_id:this.searchModel.get('selectedFolderId'),tag_ids:this.searchModel.get('selectedTagIds'),owner_id:context&&context.default_owner_id,partner_id:context&&context.default_partner_id,};},_promptFileInput($uploadInput){$uploadInput.click();},async _renderChatter(){if(this._selectedRecordIds.length!==1){return;}
this._closeChatter();const props=this._makeChatterContainerProps();this._chatterContainerComponent=new ChatterContainerWrapperComponent(this,getMessagingComponent('ChatterContainer'),props);const $chatterContainer=$(qweb.render('documents.ChatterContainer'));this.$('.o_content').addClass('o_chatter_open');if(this.$('.o_documents_mobile_inspector').length){this.$('.o_documents_mobile_inspector').append($chatterContainer);}else{this.$('.o_content').append($chatterContainer);}
const target=$chatterContainer[0].querySelector(':scope .o_documents_chatter_placeholder');await this._chatterContainerComponent.mount(target);},async _renderDocumentsInspector(state,shareAliases=[]){let localState;if(this._documentsInspector){localState=this._documentsInspector.getLocalState();this._documentsInspector.destroy();}
this._documentsInspector=new DocumentsInspector(this,{focusTagInput:this._isInspectorTagInputFocusOnMount,folderId:this.searchModel.get('selectedFolderId'),folders:this.searchModel.get('folders'),recordIds:this._selectedRecordIds,state,tags:this.searchModel.get('tags'),viewType:this.viewType,shareAliases:shareAliases,});this._isInspectorTagInputFocusOnMount=false;await this._documentsInspector.insertAfter(this.renderer.$el);if(localState){this._documentsInspector.setLocalState(localState);}},async _shareDocuments(vals){if(!vals.folder_id){return;}
const result=await this._rpc({model:'documents.share',method:'open_share_popup',args:[vals],});this.do_action(result,{fullscreen:config.device.isMobile,});},async _triggerRule(ruleId,recordIds,{preventReload}={}){const result=await this._rpc({model:'documents.workflow.rule',method:'apply_actions',args:[[ruleId],recordIds],});if(preventReload){return;}
if(_.isObject(result)){if(result.hasOwnProperty('warning')){let documents=Markup(result['warning']['documents'].map((d)=>Markup`<li>${d}</li>`).join(''));this.displayNotification({title:result['warning']['title'],message:Markup`<ul>${documents}</ul>`,type:'danger',});this.reload();}else{await this.do_action(result,{on_close:()=>this.reload()});}}else{await this.reload();}},async _update(state,{controllerState:{selectedRecordIds,}={},}={}){if(selectedRecordIds){this._selectedRecordIds=selectedRecordIds;}
const recordIds=state.data.map(record=>record.res_id);this._selectedRecordIds=_.intersection(this._selectedRecordIds,recordIds);await this._updateChatter();const shareAliases=await this._updateHelper(state.getDomain());await this._renderDocumentsInspector(state,shareAliases);},updateButtons(){const selectedFolderId=this.searchModel.get('selectedFolderId');this.$buttons.find('.o_documents_kanban_upload').prop('disabled',!selectedFolderId);this.$buttons.find('.o_documents_kanban_url').prop('disabled',!selectedFolderId);this.$buttons.find('.o_documents_kanban_request').prop('disabled',!selectedFolderId);this.$buttons.find('.o_documents_kanban_share_domain').prop('disabled',!selectedFolderId);},async _updateChatter(){if(!this._chatterContainerComponent){return;}
if(this._selectedRecordIds.length===1){const props=this._makeChatterContainerProps();this._chatterContainerComponent.update(props);const chatterContainer=this.el.querySelector(':scope .o_document_chatter_container');const target=chatterContainer.querySelector(':scope .o_documents_chatter_placeholder');await this._chatterContainerComponent.mount(target);}else{this._closeChatter();}},async _updateHelper(searchDomain){var self=this;const rpcDomain=searchDomain.filter(elem=>Array.isArray(elem)&&elem.includes('folder_id'))
if(rpcDomain.length&&this._hasShareReadAccessRights){return await this._rpc({model:'documents.share',method:'search_read',kwargs:{domain:rpcDomain,fields:['id','alias_id'],},}).then((shares)=>{if(shares.length){const shareAliases=_.map(_.pluck(shares,'alias_id'),(vals)=>_.object(['alias_id','aliasName'],vals));this.renderer.updateHelper(shareAliases);return shareAliases;}});}},_updateSelection(){this.renderer.updateSelection(this._selectedRecordIds);},_uploadFilesHandler(multiple){return(ev)=>{const recordId=ev.data?ev.data.id:undefined;const $uploadInput=this.hiddenUploadInputFile?this.hiddenUploadInputFile.off('change'):(this.hiddenUploadInputFile=$('<input>',{type:'file',name:'files[]',class:'o_hidden'}).appendTo(this.$el));$uploadInput.attr('multiple',multiple?true:null);const cleanup=$.prototype.remove.bind($uploadInput);$uploadInput.on('change',async changeEv=>{await this._uploadFiles(changeEv.target.files,{recordId}).finally(cleanup);});this._promptFileInput($uploadInput);};},async _onArchiveRecords(ev){ev.stopPropagation();const recordIds=ev.data.records.map(record=>record.id);await this.model.toggleActive(recordIds,this.handle);await this.update({},{reload:false});},async _onBeforeUpload(){fileUploadMixin._onBeforeUpload.apply(this,arguments);const folderIds=[...new Set(Object.values(this._fileUploads).map(upload=>upload.folderId))];this._updateSearchPanel({uploadingFolderIds:folderIds});},_onClickDocumentsRequest(ev){ev.preventDefault();const context=this.model.get(this.handle,{raw:true}).getContext();this.do_action('documents.action_request_form',{additional_context:{default_partner_id:context.default_partner_id||false,default_folder_id:this.searchModel.get('selectedFolderId'),default_tag_ids:[[6,0,this.searchModel.get('selectedTagIds')]],},fullscreen:config.device.isMobile,on_close:()=>this.reload(),});},_onClickDocumentsShareDomain(){const state=this.model.get(this.handle,{raw:true});this._shareDocuments({domain:state.domain,folder_id:this.searchModel.get('selectedFolderId'),tag_ids:[[6,0,this.searchModel.get('selectedTagIds')]],type:this._selectedRecordIds.length?'ids':'domain',document_ids:this._selectedRecordIds.length?[[6,0,this._selectedRecordIds]]:false,});},_onClickDocumentsUpload(ev){this._uploadFilesHandler(true)(ev);},_onClickDocumentsUploadFromUrl(ev){ev.preventDefault();const context=this.model.get(this.handle,{raw:true}).getContext();this.do_action('documents.action_url_form',{additional_context:{default_partner_id:context.default_partner_id||false,default_folder_id:this.searchModel.get('selectedFolderId'),default_tag_ids:[[6,0,this.searchModel.get('selectedTagIds')]],},fullscreen:config.device.isMobile,on_close:async()=>await this.reload()});},_onDeleteModel:function(ev){Dialog.confirm(this,_t("Are you confirm deletion ?"),{confirm_callback:()=>{var documentIds=[ev.data.documentId];this._rpc({model:'documents.workflow.rule',method:'unlink_record',args:[documentIds]}).then(()=>{this.reload();});},});},async _onDeleteRecords(ev){ev.stopPropagation();const recordIds=ev.data.records.map(record=>record.id);await this.model.deleteRecords(recordIds,this.modelName);const resIds=ev.data.records.map(record=>record.res_id);this._selectedRecordIds=_.difference(this._selectedRecordIds,resIds);await this.reload();},_onDocumentsCloseChatter(){this._closeChatter();},async _onDropDocumentsView(ev){if(!ev.originalEvent.dataTransfer.types.includes('Files')){return;}
ev.preventDefault();this.renderer.$el.removeClass('o_documents_drop_over');this.$('.o_documents_upload_text').remove();await this._uploadFiles(ev.originalEvent.dataTransfer.files);},async _onDocumentViewerAttachmentChanged(ev){ev.stopPropagation();if(ev.data.documentIds){this._selectedRecordIds=ev.data.documentIds;await this.reload();}else{await this.update({});}},_onDownload(ev){ev.stopPropagation();const resIds=ev.data.resIds;if(resIds.length===1){window.location=`/documents/content/${resIds[0]}`;}else{session.get_file({url:'/document/zip',data:{file_ids:resIds,zip_name:`documents-${moment().format('YYYY-MM-DD')}.zip`},});}},_onDragoverDocumentsView(ev){if(!this.searchModel.get('selectedFolderId')||!ev.originalEvent.dataTransfer.types.includes('Files')){return;}
ev.preventDefault();this.renderer.$el.addClass('o_documents_drop_over');if(this.$('.o_documents_upload_text').length===0){this.$('.o_content').append($(qweb.render('documents.uploadText')));}},_onDragleaveDocumentsView(ev){if($(ev.target).closest(this.renderer.$el)&&ev.target!==this.renderer.el){return;}
this.renderer.$el.removeClass('o_documents_drop_over');this.$('.o_documents_upload_text').remove();},_onDragstartDocumentDraggable(ev){let isTargetSelected;let resId;switch(this.viewType){case'kanban':isTargetSelected=ev.currentTarget.classList.contains('o_record_selected');resId=$(ev.currentTarget).data('id')
break;case'list':isTargetSelected=$(ev.currentTarget).find('.o_list_record_selector input').prop('checked');resId=$(ev.currentTarget).closest('.o_data_row').data('res-id');break;}
if(!isTargetSelected){this.trigger_up('select_record',{isKeepSelection:false,originalEvent:ev,resId,});}
const unlockedRecordIds=this.model.get(this.handle,{raw:true}).data.filter(record=>!record.data.lock_uid||record.data.lock_uid===session.uid).map(record=>record.res_id);const draggedRecordIds=_.intersection(this._selectedRecordIds,unlockedRecordIds);if(draggedRecordIds.length===0){ev.preventDefault();return;}
const lockedCount=this._selectedRecordIds.length-draggedRecordIds.length;ev.originalEvent.dataTransfer.setData('o_documents_data',JSON.stringify({recordIds:draggedRecordIds,lockedCount,}));this._makeDragIcon({dataTransfer:ev.originalEvent.dataTransfer,lockedCount,draggedRecordIds,});},_onEditModel:function(ev){ev.stopPropagation();const document=ev.data.document;let defaultResourceRef=`${document['res_model']},${document['res_id']}`;if(defaultResourceRef.includes('undefined')){defaultResourceRef=false;}
this._rpc({model:'ir.model',method:'search_read',domain:[['model','=',document['res_model']],],fields:['id'],limit:1,}).then((models)=>{let action={name:_t('Edit the linked Record'),type:'ir.actions.act_window',res_model:'documents.link_to_record_wizard',views:[[false,'form']],target:'new',context:{'default_document_ids':[document['id']],'default_resource_ref':defaultResourceRef,'default_is_readonly_model':true,'default_model_id':models[0].id,}};this.do_action(action,{on_close:()=>{this.reload();}});});},_onGetSearchPanelTags(ev){ev.data.callback(this.searchModel.get('tags'));},async _onHistoryItemDelete(ev){ev.stopPropagation();await this._rpc({model:'ir.attachment',method:'unlink',args:[[ev.data.attachmentId]],});await this.reload();},_onHistoryItemDownload(ev){ev.stopPropagation();window.location=`/web/content/${ev.data.attachmentId}?download=true`;},async _onHistoryItemRestore(ev){ev.stopPropagation();await this._rpc({model:'documents.document',method:'write',args:[[ev.data.resId],{attachment_id:ev.data.attachmentId}],});await this.reload();},async _onKanbanImageClicked(ev){ev.stopPropagation();const documents=ev.data.recordList;const recordId=ev.data.recordId;const rules=this._getRules(documents);const documentViewer=new DocumentViewer(this,documents,recordId,{openPdfManager:ev.data.openPdfManager,rules,});await documentViewer.appendTo(this.$('.o_documents_view'));},async _onLockAttachment(ev){ev.stopPropagation();try{await this._rpc({model:'documents.document',method:'toggle_lock',args:[ev.data.resId],});}catch(err){}
await this.reload();},async _onOpenChatter(ev){ev.stopPropagation();await this._renderChatter();},async _onOpenRecord(ev){ev.stopPropagation();let viewId=false;try{viewId=await this._rpc({model:ev.data.resModel,method:'get_formview_id',args:[ev.data.resId],});}catch(err){}
this.do_action({res_id:ev.data.resId,res_model:ev.data.resModel,type:'ir.actions.act_window',views:[[viewId,'form']],});},async _onSaveMulti(ev){ev.stopPropagation();try{await this.model.saveMulti(ev.data.dataPointIds,ev.data.changes,this.handle);await this.reload({});}finally{ev.data.callback&&ev.data.callback();}},async _onSelectRecord(ev){const state=this.model.get(this.handle);const recordIds=state.data.map(record=>record.res_id);const{newSelection,anchor}=computeMultiSelection(recordIds,ev.data.resId,{anchor:this._anchorId,isKeepSelection:ev.data.isKeepSelection||ev.data.originalEvent.ctrlKey||ev.data.originalEvent.metaKey,isRangeSelection:ev.data.originalEvent.shiftKey&&this._anchorId,selected:this._selectedRecordIds,});this._selectedRecordIds=[...new Set(newSelection)];this._anchorId=anchor;await this._updateChatter();this._deferredRenderInspector(ev);this._updateSelection();},_onSetFocusTagInput(){this._isInspectorTagInputFocusOnMount=true;},_onSetFile(ev){this._uploadFilesHandler(false)(ev);},_onShareIds(ev){ev.stopPropagation();this._shareDocuments({document_ids:[[6,0,ev.data.resIds]],folder_id:this.searchModel.get('selectedFolderId'),type:'ids',});},async _onTriggerRule(ev){ev.stopPropagation();if(ev.data.recordIds){this._selectedRecordIds=ev.data.recordIds;}
const recordIds=ev.data.recordIds?ev.data.recordIds:ev.data.records.map(record=>record.res_id);await this._triggerRule(ev.data.ruleId,recordIds,{preventReload:ev.data.preventReload});},_onUploadLoad({xhr}){const result=xhr.status===200?JSON.parse(xhr.response):{error:_.str.sprintf(_t("status code: %s, message: %s"),xhr.status,xhr.response)};if(result.error){this.displayNotification({title:_t("Error"),message:result.error,sticky:true});}else if(result.ids&&result.ids.length>0){this._selectedRecordIds=result.ids;}
fileUploadMixin._onUploadLoad.apply(this,arguments);},});return DocumentsControllerMixin;});;

/* /documents/static/src/js/documents_model_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('documents.modelMixin',function(require){'use strict';const DocumentsModelMixin={async fetchActivities(recordId){const record=this.localData[recordId];record.specialData.activity_ids=await this._fetchSpecialActivity(record,'activity_ids');},get(dataPointId){const result=this._super(...arguments);if(result&&result.type==='list'){const dataPoint=this.localData[dataPointId];result.size=dataPoint.size;}
return result;},async load(params){const prom=this._super(...arguments);const dataPointId=await this._fetchAdditionalData(prom,params);this._currentRootDataPointId=dataPointId;return dataPointId;},reload(id,options){const prom=this._super(...arguments);if(this._currentRootDataPointId===id){return this._fetchAdditionalData(prom,options);}else{return prom;}},saveMulti(recordIds,values,parentId){return this.mutex.exec(()=>this._saveMulti(recordIds,values,parentId));},async _fetchAdditionalData(prom,params){const proms=[prom];proms.push(this._fetchSize(params));const results=await Promise.all(proms);const dataPointId=results[0];const size=results[1];const dataPoint=this.localData[dataPointId];dataPoint.size=size;return dataPointId;},async _fetchSize({domain}={}){const result=await this._rpc({model:'documents.document',method:'read_group',domain:domain||[],fields:['file_size'],groupBy:[],});const size=result[0].file_size/(1000*1000);return Math.round(size*100)/100;},_saveMulti(recordIds,values,parentId){const parent=this.localData[parentId];const resIds=recordIds.map(recordId=>this.localData[recordId].res_id);const changes=_.mapObject(values,(value,fieldName)=>{const field=parent.fields[fieldName];if(field.type==='many2one'){value=value.id||false;}else if(field.type==='many2many'){const command=value.operation==='FORGET'?3:4;value=value.resIds.map(resId=>[command,resId]);}
return value;});return this._rpc({model:parent.model,method:'write',args:[resIds,changes],});},};return DocumentsModelMixin;});;

/* /documents/static/src/js/documents_utils.js defined in bundle 'web.assets_backend' */
odoo.define('documents.utils',function(require){'use strict';const selection={computeMultiSelection(items,target,{anchor,isCheckbox=false,isKeepSelection=false,isRangeSelection=false,selected=[]}={}){if(isCheckbox){isKeepSelection=isRangeSelection?false:isKeepSelection;}
const wasSelected=selected.includes(target);const isBasicSelection=!isRangeSelection&&!isKeepSelection;let newSelection;if(isBasicSelection){if(selected.length>1){newSelection=[target];}else{newSelection=wasSelected?[]:[target];}}else{let selectedRecordsIds;if(isRangeSelection){const anchorIndex=items.indexOf(anchor);const selectedRecordIndex=items.indexOf(target);const lowerIndex=Math.min(anchorIndex,selectedRecordIndex);const upperIndex=Math.max(anchorIndex,selectedRecordIndex);selectedRecordsIds=items.slice(lowerIndex,upperIndex+1);}else{selectedRecordsIds=[target];}
if(isKeepSelection){newSelection=wasSelected?selected.filter(id=>id!==target):selected.concat(selectedRecordsIds);}else{newSelection=selectedRecordsIds;}}
if(!isRangeSelection){if(newSelection.includes(target)){anchor=target;}else{anchor=undefined;}}
return{newSelection,anchor};},};return selection;});;

/* /documents/static/src/js/documents_view_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('documents.viewMixin',function(require){'use strict';const DocumentsViewMixin={inspectorFields:['active','activity_ids','available_rule_ids','checksum','display_name','folder_id','lock_uid','message_attachment_count','message_follower_ids','message_ids','mimetype','name','owner_id','partner_id','previous_attachment_ids','res_id','res_model','res_model_name','res_name','share_ids','tag_ids','type','url',],init(viewInfo,{controllerState:{selectedRecordIds,}={},}={}){this._super(...arguments);this.withSearchPanel=true;this.rendererParams.withSearchPanel=true;this.controllerParams.selectedRecordIds=selectedRecordIds;_.defaults(this.fieldsInfo[this.viewType],_.pick(this.fields,this.inspectorFields));this.fieldsInfo[this.viewType].available_rule_ids=Object.assign({},{fieldsInfo:{default:{display_name:{},note:{},limited_to_single_record:{},create_model:{},},},relatedFields:{display_name:{type:'string'},note:{type:'string'},limited_to_single_record:{type:'boolean'},create_model:{type:'string'},},viewType:'default',},this.fieldsInfo[this.viewType].available_rule_ids);},};return DocumentsViewMixin;});;

/* /documents/static/src/js/documents_document_viewer.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentViewer',function(require){'use strict';const PdfManager=require('documents.component.PdfManager');const DocumentViewer=require('@mail/js/document_viewer')[Symbol.for("default")];const{_t}=require('web.core');const{ComponentWrapper,WidgetAdapterMixin}=require('web.OwlCompatibility');const DocumentsDocumentViewer=DocumentViewer.extend(WidgetAdapterMixin,{template:"DocumentsDocumentViewer",events:Object.assign({},DocumentViewer.prototype.events,{'click .o_documents_pdf_manager_button':'_onClickDocumentsPdfManagerButton',}),custom_events:Object.assign({},DocumentViewer.prototype.custom_events,{process_documents:'_onProcessDocuments',pdf_manager_error:'_onPdfManagerError',}),init(parent,attachments,activeAttachmentID,{openPdfManager,rules}={}){this._super(...arguments);this.modelName='documents.document';this._documents=attachments;this._isPdfManagerMounted=false;this._openPdfManager=openPdfManager;this._newDocumentIds=[];this._pdfManager=undefined;this._workflowRules=rules.filter((rule)=>rule.create_model!=="link.to.record");},async start(){await this._super(...arguments);const isPdfOnly=this._documents.every(record=>record.mimetype==='application/pdf');if(this._openPdfManager&&isPdfOnly){await this._renderPdfManager(this._documents);}},destroy(){if(this._newDocumentIds.length){this.trigger_up('document_viewer_attachment_changed',{documentIds:this._newDocumentIds});}
this._pdfManager&&this._pdfManager.destroy();this._super(...arguments);},async _renderPdfManager(documents){const $documentViewerElements=this.$('.o_viewer_content, .move_previous, .move_next');$documentViewerElements.addClass('o_hidden');this._pdfManager=new ComponentWrapper(this,PdfManager,{documents,rules:this._workflowRules,});await this._pdfManager.mount(this.el);this._isPdfManagerMounted=true;},async _onClickDocumentsPdfManagerButton(ev){ev.stopPropagation();ev.preventDefault();await this._renderPdfManager([this.activeAttachment]);},_onKeyUp(e){if(this._isPdfManagerMounted){return;}
this._super(...arguments);},_onKeydown(e){if(this._isPdfManagerMounted){return;}
this._super(...arguments);},_onPdfManagerError(ev){ev.stopPropagation();const{message}=ev.data;this.displayNotification({title:_t("Error"),message});},_onProcessDocuments(ev){ev.stopPropagation();const{documentIds,ruleId,exit}=ev.data||{};if(documentIds&&documentIds.length){this._newDocumentIds=[...new Set(this._newDocumentIds.concat(documentIds))];}
if(ruleId){this.trigger_up('trigger_rule',{recordIds:documentIds,ruleId,preventReload:!exit,});}
if(exit){this.destroy();}},});return DocumentsDocumentViewer;});;

/* /documents/static/src/js/documents_kanban_color_widget.js defined in bundle 'web.assets_backend' */
odoo.define('documents.Many2ManyColorWidget',function(require){'use strict';const fieldRegistry=require('web.field_registry');const{KanbanFieldMany2ManyTags,FieldMany2ManyTags}=require('web.relational_fields');const Many2ManyColorMixin={async start(){this.tags=[];this.trigger_up('get_search_panel_tags',{callback:val=>{this.tags=val;}});await this._super(...arguments);},_render(){if(!this.tags.length){return this._super(...arguments);}
this.$el.empty().addClass('o_field_many2manytags o_kanban_tags');const tagIDs=this.value.data.map(m2m=>m2m.data.id);for(const tag of this.tags){if(tagIDs.includes(tag.id)){const color=tag.group_hex_color||'#00000022';$('<span>',{class:'o_tag',text:tag.display_name,title:tag.group_name+' > '+tag.name,}).prepend($('<span>',{style:'color: '+color+';',text:'●',})).appendTo(this.$el);}}},};const Many2ManyColorWidget=KanbanFieldMany2ManyTags.extend(Many2ManyColorMixin);const ListMany2ManyColorWidget=FieldMany2ManyTags.extend(Many2ManyColorMixin);fieldRegistry.add('documents_many2many_tags',Many2ManyColorWidget);fieldRegistry.add('documents_tree_many2many_tags',ListMany2ManyColorWidget);});;

/* /documents/static/src/js/documents_kanban_controller.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsKanbanController',function(require){'use strict';const DocumentsControllerMixin=require('documents.controllerMixin');const KanbanController=require('web.KanbanController');var DocumentsKanbanController=KanbanController.extend(DocumentsControllerMixin,{events:Object.assign({},KanbanController.prototype.events,DocumentsControllerMixin.events),custom_events:Object.assign({},KanbanController.prototype.custom_events,DocumentsControllerMixin.custom_events),init(){this._super(...arguments);DocumentsControllerMixin.init.apply(this,arguments);},async start(){this.$('.o_content').addClass('o_documents_content o_documents_kanban');await this._super(...arguments);DocumentsControllerMixin.start.apply(this,arguments);},async reload(){await this._super(...arguments);await DocumentsControllerMixin.reload.apply(this,arguments);},async _update(){await this._super(...arguments);await DocumentsControllerMixin._update.apply(this,arguments);},updateButtons(){this._super(...arguments);DocumentsControllerMixin.updateButtons.apply(this,arguments);},});return DocumentsKanbanController;});;

/* /documents/static/src/js/documents_kanban_controller_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsKanbanControllerMobile',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const DocumentsKanbanController=require('documents.DocumentsKanbanController');const DocumentsListController=require('documents.DocumentsListController');const{qweb}=require('web.core');const DocumentControllerMobileMixin={renderButtons(){this._super(...arguments);const $buttons=this.$buttons.find('button');const $dropdownButton=$(qweb.render('documents.ControlPanelButtonsMobile'));$buttons.addClass('dropdown-item').appendTo($dropdownButton.find('.dropdown-menu'));this.$buttons=$dropdownButton;},async _deferredRenderInspector(ev){await this._super(...arguments);if(!ev.data.isKeepSelection&&this._selectedRecordIds.length===1){this._documentsInspector.open();}},async _onSelectRecord(ev){if(ev.data.isKeepSelection||this._selectedRecordIds.length!==1||this._selectedRecordIds[0]!==ev.data.resId){await this._super(...arguments);}},};DocumentsKanbanController.include(DocumentControllerMobileMixin);DocumentsListController.include(DocumentControllerMobileMixin);});;

/* /documents/static/src/js/documents_kanban_model.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsKanbanModel',function(require){"use strict";const DocumentsModelMixin=require('documents.modelMixin');const KanbanModel=require('web.KanbanModel');const DocumentsKanbanModel=KanbanModel.extend(DocumentsModelMixin);return DocumentsKanbanModel;});;

/* /documents/static/src/js/documents_kanban_record.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsKanbanRecord',function(require){'use strict';const KanbanRecord=require('web.KanbanRecord');const DocumentsKanbanRecord=KanbanRecord.extend({events:Object.assign({},KanbanRecord.prototype.events,{'click':'_onSelectRecord','click .o_record_selector':'_onAddRecordToSelection','click .oe_kanban_previewer':'_onImageClicked','click .o_request_image':'_onRequestImage',}),getResId(){return this.id;},async update(){const isSelected=this.$el.hasClass('o_record_selected');await this._super(...arguments);if(isSelected){this.$el.addClass('o_record_selected');}},updateSelection(selected){this.$el.toggleClass('o_record_selected',selected);},_toggleSelect(ev,{isKeepSelection=false}={}){this.trigger_up('select_record',{isKeepSelection,originalEvent:ev,resId:this.getResId(),});},_onAddRecordToSelection(ev){ev.preventDefault();ev.stopPropagation();this._toggleSelect(ev,{isKeepSelection:true});},_onImageClicked(ev){ev.preventDefault();ev.stopPropagation();this.trigger_up('kanban_image_clicked',{recordList:[this.recordData],recordId:this.recordData.id});},_onKeyDownOpenFirstLink(ev){switch(ev.keyCode){case $.ui.keyCode.ENTER:this._toggleSelect(ev,{isKeepSelection:false});break;}},_onRequestImage(ev){ev.preventDefault();ev.stopPropagation();this.trigger_up('set_file',{id:this.id});},_onSelectRecord(ev){ev.preventDefault();if(!$(ev.target).hasClass('oe_kanban_action')){this._toggleSelect(ev,{isKeepSelection:false});}},});return DocumentsKanbanRecord;});;

/* /documents/static/src/js/documents_kanban_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsKanbanRenderer',function(require){'use strict';const DocumentsKanbanRecord=require('documents.DocumentsKanbanRecord');const KanbanRenderer=require('web.KanbanRenderer');const core=require('web.core');var qweb=core.qweb;const DocumentsKanbanRenderer=KanbanRenderer.extend({config:Object.assign({},KanbanRenderer.prototype.config,{KanbanRecord:DocumentsKanbanRecord,}),async start(){this.$el.addClass('o_documents_kanban_view o_documents_view position-relative align-content-start flex-grow-1 flex-shrink-1');await this._super(...arguments);},updateSelection(selectedRecordIds){for(const widget of this.widgets){const isSelected=selectedRecordIds.includes(widget.getResId());widget.updateSelection(isSelected);}},updateHelper(shareAliases){this.$('.o_view_nocontent_smiling_face').append(qweb.render('documents.HelperMailLine',shareAliases[0]));},});return DocumentsKanbanRenderer;});;

/* /documents/static/src/js/documents_kanban_view.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsKanbanView',function(require){'use strict';const DocumentsKanbanController=require('documents.DocumentsKanbanController');const DocumentsKanbanModel=require('documents.DocumentsKanbanModel');const DocumentsKanbanRenderer=require('documents.DocumentsKanbanRenderer');const DocumentsSearchPanel=require('documents.DocumentsSearchPanel');const DocumentsViewMixin=require('documents.viewMixin');const KanbanView=require('web.KanbanView');const viewRegistry=require('web.view_registry');const{_lt}=require('web.core');const DocumentsKanbanView=KanbanView.extend(DocumentsViewMixin,{config:Object.assign({},KanbanView.prototype.config,{Controller:DocumentsKanbanController,Model:DocumentsKanbanModel,Renderer:DocumentsKanbanRenderer,SearchPanel:DocumentsSearchPanel,}),display_name:_lt('Attachments Kanban'),searchMenuTypes:['filter','favorite'],});viewRegistry.add('documents_kanban',DocumentsKanbanView);return DocumentsKanbanView;});;

/* /documents/static/src/js/documents_list_controller.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsListController',function(require){'use strict';const DocumentsControllerMixin=require('documents.controllerMixin');const ListController=require('web.ListController');const{qweb}=require('web.core');const DocumentsListController=ListController.extend(DocumentsControllerMixin,{events:Object.assign({},ListController.prototype.events,DocumentsControllerMixin.events),custom_events:Object.assign({},ListController.prototype.custom_events,DocumentsControllerMixin.custom_events,{documents_view_rendered:'_onDocumentsViewRendered',toggle_all:'_onToggleAll',}),init(){this._super(...arguments);DocumentsControllerMixin.init.apply(this,arguments);},async start(){this.$('.o_content').addClass('o_documents_content');await this._super(...arguments);DocumentsControllerMixin.start.apply(this,arguments);},async reload(){await this._super(...arguments);await DocumentsControllerMixin.reload.apply(this,arguments);},async _update(){await this._super(...arguments);await DocumentsControllerMixin._update.apply(this,arguments);},updateButtons(){this._super(...arguments);DocumentsControllerMixin.updateButtons.apply(this,arguments);},_onDocumentsViewRendered(){this.$('.o_data_row').attr('draggable',true).addClass('o_document_draggable o_document_list_record');const localData=this.model.localData;for(const key in localData){const $record=this.$(`.o_document_list_record[data-id="${key}"]`);$record.attr('data-res-id',localData[key].data.id);const lockLocalId=localData[key].data.lock_uid;if(lockLocalId){const lockUidData=localData[lockLocalId].data;$record.find('.o_data_cell:nth(0)').append(qweb.render('documents.lockIcon',{tooltip:lockUidData.display_name,}));}}},async _onToggleAll(ev){const state=this.model.get(this.handle);this._selectedRecordIds=ev.data.checked?state.data.map(record=>record.res_id):[];await Promise.all([this._updateChatter(state),this._renderDocumentsInspector(state)]);this._updateSelection();},});return DocumentsListController;});;

/* /documents/static/src/js/documents_list_model.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsListModel',function(require){'use strict';const ListModel=require('web.ListModel');const DocumentsModelMixin=require('documents.modelMixin');const DocumentsListModel=ListModel.extend(DocumentsModelMixin);return DocumentsListModel;});;

/* /documents/static/src/js/documents_list_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsListRenderer',function(require){'use strict';const ListRenderer=require('web.ListRenderer');const core=require('web.core');var qweb=core.qweb;const DocumentsListRenderer=ListRenderer.extend({events:Object.assign({},ListRenderer.prototype.events,{'click .o_data_row .o_list_record_selector':'_onClickListSelector',}),async start(){this.$el.addClass('o_documents_list_view o_documents_view');await this._super(...arguments);},updateSelection(selectedRecordIds){this.$('.o_data_row > .o_list_record_selector input:checked').prop('checked',false);for(const id of selectedRecordIds){this.$(`.o_document_list_record[data-res-id="${id}"] .o_list_record_selector input`).prop('checked',true);}
this._updateSelection();},updateHelper(shareAliases){this.$('.o_view_nocontent_smiling_face').append(qweb.render('documents.HelperMailLine',shareAliases[0]));},async _renderView(){await this._super(...arguments);this.trigger_up('documents_view_rendered');},_toggleSelect(ev,{isKeepSelection,resId}){if(!resId){return;}
this.trigger_up('select_record',{isKeepSelection,originalEvent:ev,resId,});},_onClickListSelector(ev){ev.preventDefault();ev.stopPropagation();const resId=$(ev.currentTarget).closest('.o_data_row').data('res-id');this._toggleSelect(ev,{isKeepSelection:true,resId,});},_onKeyDown(ev){if(ev.keyCode===13){ev.stopPropagation();const $tr=$(ev.currentTarget).closest('tr');this._toggleSelect(ev,{isKeepSelection:false,resId:$tr.data('res-id'),});}else if(ev.keyCode===32){ev.preventDefault();ev.stopPropagation();const $tr=$(ev.currentTarget).closest('tr');this._toggleSelect(ev,{isKeepSelection:true,resId:$tr.data('res-id'),});}else{return this._super(...arguments);}},_onRowClicked(ev){ev.stopPropagation();this._toggleSelect(ev,{isKeepSelection:false,resId:$(ev.currentTarget).data('res-id'),});},_onToggleSelection(ev){const checked=$(ev.currentTarget).prop('checked')||false;this.trigger_up('toggle_all',{checked,});},});return DocumentsListRenderer;});;

/* /documents/static/src/js/documents_list_view.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsListView',function(require){"use strict";const DocumentsListController=require('documents.DocumentsListController');const DocumentsListModel=require('documents.DocumentsListModel');const DocumentsListRenderer=require('documents.DocumentsListRenderer');const DocumentsSearchPanel=require('documents.DocumentsSearchPanel');const DocumentsView=require('documents.viewMixin');const ListView=require('web.ListView');const viewRegistry=require('web.view_registry');const DocumentsListView=ListView.extend(DocumentsView,{config:Object.assign({},ListView.prototype.config,{Controller:DocumentsListController,Model:DocumentsListModel,Renderer:DocumentsListRenderer,SearchPanel:DocumentsSearchPanel,}),searchMenuTypes:['filter','favorite'],});viewRegistry.add('documents_list',DocumentsListView);return DocumentsListView;});;

/* /documents/static/src/js/documents_search_panel.js defined in bundle 'web.assets_backend' */
odoo.define("documents.DocumentsSearchPanel",function(require){"use strict";const{device}=require("web.config");const SearchPanel=require("web.searchPanel");const{sprintf}=require("web.utils");const VALUE_SELECTOR=[".o_search_panel_category_value",".o_search_panel_filter_value",].join();class DocumentsSearchPanel extends SearchPanel{_isUploading(valueId){return this.props.uploadingFolderIds.includes(Number(valueId));}
_isValidElement(target,dataTransfer){return(dataTransfer&&dataTransfer.types.includes("o_documents_data")&&target&&target.closest(VALUE_SELECTOR));}
_hasValidFieldName(sectionId){const{fieldName}=this.model.get("sections",s=>s.id===sectionId)[0];return["folder_id","tag_ids"].includes(fieldName);}
_updateDragOverClass(newDragFocus){const allSelected=this.el.querySelectorAll(":scope .o_drag_over_selector");for(const selected of allSelected){selected.classList.remove("o_drag_over_selector");}
if(newDragFocus){newDragFocus.classList.add("o_drag_over_selector");}}
_onDragEnter(sectionId,valueId,{currentTarget,dataTransfer}){if(valueId!==false&&this._isValidElement(currentTarget,dataTransfer)&&this._hasValidFieldName(sectionId)){this._updateDragOverClass(currentTarget);const[section]=this.model.get("sections",(s)=>s.id===sectionId);const{childrenIds}=section.values.get(valueId);if(childrenIds&&childrenIds.length){this.state.expanded[sectionId][valueId]=true;}}else{this._updateDragOverClass();}}
_onDragLeave({relatedTarget,dataTransfer}){if(!this._isValidElement(relatedTarget,dataTransfer)){this._updateDragOverClass(null);}}
async _onDrop(sectionId,valueId,{currentTarget,dataTransfer}){this._updateDragOverClass(null);if(valueId===false||currentTarget.classList.contains("active")||!this._isValidElement(currentTarget,dataTransfer)||!this._hasValidFieldName(sectionId)){return;}
const{fieldName}=this.model.get("sections",s=>s.id===sectionId)[0];const data=JSON.parse(dataTransfer.getData("o_documents_data"));if(data.lockedCount){return this.env.services.notification.notify({title:"Partial transfer",message:sprintf(this.env._t("%s file(s) not moved because they are locked by another user"),data.lockedCount),type:"warning",});}
if(fieldName==="folder_id"){this.model.dispatch("updateRecordFolderId",data.recordIds,valueId);}else{this.model.dispatch("updateRecordTagId",data.recordIds,valueId);}}}
DocumentsSearchPanel.modelExtension="DocumentsSearchPanel";DocumentsSearchPanel.defaultProps=Object.assign({},SearchPanel.defaultProps,{uploadingFolderIds:[]});DocumentsSearchPanel.props=Object.assign({},SearchPanel.props,{uploadingFolderIds:Array,});if(!device.isMobile){DocumentsSearchPanel.template="documents.SearchPanel";}
return DocumentsSearchPanel;});;

/* /documents/static/src/js/documents_search_panel_model_extension.js defined in bundle 'web.assets_backend' */
odoo.define("documents/static/src/js/documents_search_panel_model_extension",function(require){"use strict";const ActionModel=require("web.ActionModel");const SearchPanelModelExtension=require("web.searchPanelModelExtension");const isFolderCategory=(s)=>s.type==="category"&&s.fieldName==="folder_id";const isTagFilter=(s)=>s.type==="filter"&&s.fieldName==="tag_ids";class DocumentsSearchPanelModelExtension extends SearchPanelModelExtension{get(property){switch(property){case"folders":return this.getFolders();case"selectedFolderId":return this.getSelectedFolderId();case"selectedTagIds":return this.getSelectedTagIds();case"tags":return this.getTags();}
return super.get(...arguments);}
getFolders(){const{values}=this.getSections(isFolderCategory)[0];return[...values.values()];}
getSelectedFolderId(){const{activeValueId}=this.getSections(isFolderCategory)[0];return activeValueId;}
getSelectedTagIds(){const{values}=this.getSections(isTagFilter)[0];return[...values.values()].filter((value)=>value.checked).map((value)=>value.id);}
getTags(){const{values}=this.getSections(isTagFilter)[0];return[...values.values()].sort((a,b)=>{if(a.group_sequence===b.group_sequence){return a.sequence-b.sequence;}else{return a.group_sequence-b.group_sequence;}});}
toggleCategoryValue(sectionId,valueId){super.toggleCategoryValue(...arguments);const{fieldName}=this.state.sections.get(sectionId);const storageKey=this._getStorageKey(fieldName);this.env.services.local_storage.setItem(storageKey,valueId);}
async updateRecordFolderId(recordIds,valueId){await this.env.services.rpc({model:"documents.document",method:"write",args:[recordIds,{folder_id:valueId}],});}
async updateRecordTagId(recordIds,valueId){await this.env.services.rpc({model:"documents.document",method:"write",args:[recordIds,{tag_ids:[[4,valueId]]}],});}
_ensureCategoryValue(category,valueIds){if(valueIds.includes(category.activeValueId)){return;}
const storageKey=this._getStorageKey(category.fieldName);category.activeValueId=this.env.services.local_storage.getItem(storageKey);if(valueIds.includes(category.activeValueId)){return;}
category.activeValueId=valueIds[Math.min(valueIds.length-1,1)];}
_getStorageKey(fieldName){return`searchpanel_${this.config.modelName}_${fieldName}`;}
_shouldWaitForData(){return true;}}
ActionModel.registry.add("DocumentsSearchPanel",DocumentsSearchPanelModelExtension,30);return DocumentsSearchPanelModelExtension;});;

/* /documents/static/src/js/documents_inspector.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsInspector',function(require){'use strict';const{_t,qweb}=require('web.core');const{Markup}=require('web.utils');const fieldRegistry=require('web.field_registry');const session=require('web.session');const{str_to_datetime}=require('web.time');const dialogs=require('web.view_dialogs');const Widget=require('web.Widget');const TAGS_SEARCH_LIMIT=8;const DocumentsInspector=Widget.extend({template:'documents.DocumentsInspector',custom_events:{field_changed:'_onFieldChanged',},events:{'click .o_inspector_archive':'_onArchive','click .o_inspector_request_icon':'_onClickRequestIcon','click .o_inspector_delete':'_onDelete','click .o_inspector_download':'_onDownload','click .o_inspector_replace':'_onReplace','click .o_inspector_split':'_onClickSplit','click .o_inspector_history_item_delete':'_onClickHistoryItemDelete','click .o_inspector_history_item_download':'_onClickHistoryItemDownload','click .o_inspector_history_item_restore':'_onClickHistoryItemRestore','click .o_inspector_lock':'_onLock','click .o_inspector_share':'_onShare','click .o_inspector_open_chatter':'_onOpenChatter','click .o_inspector_tag_add':'_onTagInputClicked','click .o_inspector_tag_remove':'_onRemoveTag','click .o_inspector_trigger_rule':'_onTriggerRule','click .o_inspector_object_name':'_onOpenResource','click .o_preview_available':'_onOpenPreview','click .o_document_pdf':'_onOpenPDF','click .o_inspector_model_edit':'_onEditModel','click .o_inspector_model_delete':'_onDeleteModel','mouseover .o_inspector_trigger_hover':'_onMouseoverRule','mouseout .o_inspector_trigger_hover':'_onMouseoutRule',},init:function(parent,params){this._super(...arguments);this._viewType=params.viewType;this.nbDocuments=params.state.count;this.size=params.state.size;this.focusTagInput=params.focusTagInput;this.currentFolder=_.findWhere(params.folders,{id:params.folderId});if(this.currentFolder&&this.currentFolder['description']){this.currentFolder.description=Markup(this.currentFolder['description']);}
this.recordsData={};this.shareAliases=params.shareAliases;this.records=[];for(const resId of params.recordIds){const record=params.state.data.find(record=>record.res_id===resId);if(record){let youtubeToken;let youtubeUrlMatch;if(record.data.url&&record.data.url.length){youtubeUrlMatch=record.data.url.match('youtu(?:\.be|be\.com)/(?:.*v(?:/|=)|(?:.*/)?)([a-zA-Z0-9-_]{11})');}
if(youtubeUrlMatch&&youtubeUrlMatch.length>1){youtubeToken=youtubeUrlMatch[1];}
this.recordsData[record.id]={isGif:new RegExp('image.*(gif)').test(record.data.mimetype),isImage:new RegExp('image.*(jpeg|jpg|png)').test(record.data.mimetype),isYouTubeVideo:!!youtubeToken,youtubeToken,};this.records.push(record);}}
this.tags=params.tags;const tagIdsByRecord=this.records.map(record=>record.data.tag_ids.res_ids);this.commonTagIds=_.intersection(...tagIdsByRecord);const ruleIdsByRecord=this.records.map(record=>record.data.available_rule_ids.res_ids);const commonRuleIds=_.intersection.apply(_,ruleIdsByRecord);const record=this.records[0];this._rules=commonRuleIds.map(ruleId=>{const rule=record.data.available_rule_ids.data.find(record=>record.res_id===ruleId);return rule.data;});this.pendingSavingRequests=0;this._isLocked=this.records.some(record=>record.data.lock_uid&&record.data.lock_uid.res_id!==session.uid);this.isPdfOnly=this.records.every(record=>record.data.mimetype==='application/pdf');},async start(){this._renderTags();this._renderHistory();this._renderRules();this._renderModel();this._updateButtons();await Promise.all([this._renderFields(),this._renderHeader(),this._super(...arguments)]);this.$('.o_inspector_table .o_input').prop('disabled',this._isLocked);},getLocalState:function(){return{scrollTop:this.el.scrollTop,};},setLocalState:function(state){this.el.scrollTop=state.scrollTop;},_computeClasses:function(record){const classes=["o_document_preview"];const nbPreviews=this.records.length;const recordData=this.recordsData[record.id];if(record.data.type==='empty'){classes.push("o_document_request_preview");}
if(nbPreviews===1){classes.push("o_documents_single_preview");}
if((recordData.isImage||recordData.isYouTubeVideo)){classes.push("o_documents_preview_image");}else{classes.push("o_documents_preview_mimetype");}
if((recordData.isYouTubeVideo||recordData.isGif)){classes.push("o_non_image_preview");}
return classes.join(" ");},_generateCommonRecord:function(fieldName){const record=Object.assign({},this.records[0],{id:null,res_id:null,});record.data=Object.assign({},record.data);record.data[fieldName]={data:{display_name:_t('Multiple values'),id:null,},};return record;},_renderField:function(fieldName,options){options=options||{};const values=_.uniq(this.records.map(record=>{return record.data[fieldName]&&record.data[fieldName].res_id;}));let record;if(values.length>1){record=this._generateCommonRecord(fieldName);}else{record=this.records[0];}
const $row=$(qweb.render('documents.DocumentsInspector.infoRow'));const $label=$(qweb.render('documents.DocumentsInspector.fieldLabel',{icon:options.icon,label:options.label||record.fields[fieldName].string,name:fieldName,}));$label.appendTo($row.find('.o_inspector_label'));const type=record.fields[fieldName].type;const FieldWidget=fieldRegistry.get(type);options=Object.assign({},options,{noOpen:true,viewType:this._viewType,});const fieldWidget=new FieldWidget(this,fieldName,record,options);fieldWidget.nodeOptions.no_quick_create=true;const prom=fieldWidget.appendTo($row.find('.o_inspector_value')).then(function(){fieldWidget.getFocusableElement().attr('id',fieldName);if(type==='many2one'&&values.length>1){fieldWidget.$el.addClass('o_multiple_values');}});$row.insertBefore(this.$('.o_inspector_fields tbody tr.o_inspector_divider'));return prom;},_renderFields:function(){const options={mode:'edit'};const proms=[];if(this.records.length===1){proms.push(this._renderField('name',options));if(this.records[0].data.type==='url'){proms.push(this._renderField('url',options));}
proms.push(this._renderField('partner_id',options));}
if(this.records.length>0){proms.push(this._renderField('owner_id',options));proms.push(this._renderField('folder_id',{icon:'fa fa-folder o_documents_folder_color',mode:'edit',}));}
return Promise.all(proms);},async _renderHistory(){const attachment_ids=this.records.length===1?this.records[0].data.previous_attachment_ids.res_ids:[];if(!attachment_ids){return;}
const attachments=await this._rpc({model:'ir.attachment',method:'read',args:[attachment_ids,['name','create_date','create_uid']],orderBy:[{name:'create_date',asc:false}],});$(qweb.render('documents.inspector.attachmentHistory',{attachments,str_to_datetime,})).appendTo(this.$('.o_inspector_history'));},_renderModel:function(){if(this.records.length!==1){return;}
const resModelName=this.records[0].data.res_model_name;if(!resModelName||this.records[0].data.res_model==='documents.document'){return;}
const $modelContainer=this.$('.o_model_container');const options={res_model:resModelName,res_name:this.records[0].data.res_name,is_editable_attachment:false,};this._rpc({model:this.records[0].data.res_model,method:'check_access_rights',args:['write',false]}).then((res)=>{options['is_editable_attachment']=(res&&this.records[0].data.is_editable_attachment&&!this._isLocked);$modelContainer.append(qweb.render('documents.DocumentsInspector.resModel',options));}).catch(()=>{$modelContainer.append(qweb.render('documents.DocumentsInspector.resModel',options));});},_renderRules:function(){if(!this.currentFolder||this._isLocked){return;}
for(const rule of this._rules){if(this.records.length===1||!rule.limited_to_single_record){const $rule=$(qweb.render('documents.DocumentsInspector.rule',rule));$rule.appendTo(this.$('.o_inspector_rules'));}}},_renderTags:function(){const $tags=this.$('.o_inspector_tags');const commonTags=this.tags.filter(tag=>this.commonTagIds.includes(tag.id));for(const tag of commonTags){if(tag){const $tag=$(qweb.render('documents.DocumentsInspector.tag',tag));$tag.appendTo(this.$('.o_inspector_tags'));}};if(this.tags.length>this.commonTagIds.length){this.$tagInput=$('<input>',{class:'o_input o_inspector_tag_add',type:'text',}).attr('placeholder',_t("+ Add a tag "));this.$tagInput.autocomplete({delay:0,minLength:0,autoFocus:true,select:(event,ui)=>{this.trigger_up('set_focus_tag_input');const currentId=ui.item.id;if(ui.item.special){if(ui.item.special==='more'){this._searchMore(this._lastSearchVal);}}else if(currentId){this._saveMulti({tag_ids:{operation:'ADD_M2M',resIds:[currentId],},});}},source:(req,resp)=>{resp(this._search(req.term));this._lastSearchVal=req.term;},});const disabled=this._isLocked||(this.records.length===1&&!this.records[0].data.active);$tags.closest('.o_inspector_custom_field').toggleClass('o_disabled',disabled);this.$tagInput.appendTo($tags);if(this.focusTagInput){this.$tagInput.focus();}}},_renderHeader(){if(this.shareAliases.length){this.$('.o_folder_description_alias').text(this.shareAliases[0].aliasName)}},_saveMulti:function(changes){this.pendingSavingRequests++;this.trigger_up('save_multi',{changes:changes,dataPointIds:_.pluck(this.records,'id'),callback:()=>{this.pendingSavingRequests--;},});},_search:function(value){const tags=[];for(const tag of this.tags){if(!_.contains(this.commonTagIds,tag.id)){tags.push({id:tag.id,label:tag.group_name+' > '+tag.display_name,});}}
const lowerValue=value.toLowerCase();const allSearchResults=tags.filter(tag=>tag.label.toLowerCase().includes(lowerValue));const searchResults=allSearchResults.slice(0,TAGS_SEARCH_LIMIT);if(allSearchResults.length>TAGS_SEARCH_LIMIT){searchResults.push({label:_t("Search more..."),special:'more',classname:'o_m2o_dropdown_option',});}
return searchResults;},_searchCreatePopup(dynamicFilters=[]){this.$('.o_inspector_tag_add').val('');return new dialogs.SelectCreateDialog(this,{domain:[['folder_id','=',this.currentFolder.id]],dynamicFilters:dynamicFilters||[],no_create:true,on_selected:records=>this._saveMulti({tag_ids:{operation:'ADD_M2M',resIds:records.map(record=>record.id),},}),res_model:'documents.tag',title:_t('Select tags'),}).open();},async _searchMore(value){let results;if(value){results=await this._rpc({model:'documents.tag',method:'search_read',fields:['id'],domain:['&','&',['id','not in',this.commonTagIds],['folder_id','=',this.currentFolder.id],'|',['facet_id.name','ilike',value],['name','ilike',value]],});}
let dynamicFilters;if(results){const ids=results.map(result=>result.id);dynamicFilters=[{description:_.str.sprintf(_t('Name or Category contains: %s'),value),domain:[['id','in',ids]],}];}
await this._searchCreatePopup(dynamicFilters);},_updateButtons:function(){const binary=this.records.some(record=>record.data.type==='binary');if(this._isLocked){this.$('.o_inspector_replace').prop('disabled',true);this.$('.o_inspector_delete').prop('disabled',true);this.$('.o_inspector_archive').prop('disabled',true);this.$('.o_inspector_lock').prop('disabled',true);this.$('.o_inspector_table .o_field_widget').prop('disabled',true);}
if(!binary&&(this.records.length>1||(this.records.length&&this.records[0].data.type==='empty'))){this.$('.o_inspector_download').prop('disabled',true);}},_onArchive:function(){this.trigger_up('archive_records',{records:this.records,});},_onClickHistoryItemDelete(ev){this.trigger_up('history_item_delete',{attachmentId:$(ev.currentTarget).data('id'),});},_onClickHistoryItemDownload(ev){this.trigger_up('history_item_download',{attachmentId:$(ev.currentTarget).data('id'),});},_onClickHistoryItemRestore(ev){this.trigger_up('history_item_restore',{resId:this.records[0].res_id,attachmentId:$(ev.currentTarget).data('id'),});},_onClickRequestIcon(ev){const documentId=$(ev.currentTarget).data('id');this.trigger_up('set_file',{id:documentId,});},_onClickSplit(ev){ev.preventDefault();ev.stopPropagation();if(this.pendingSavingRequests>0){return;}
const records=this.records.map(record=>record.data);this.trigger_up('kanban_image_clicked',{recordId:records[0].id,recordList:records,openPdfManager:true,});},_onDelete:function(){this.trigger_up('delete_records',{records:this.records,});},_onDeleteModel:function(ev){this.trigger_up('delete_model',{documentId:this.records[0].data['id'],});},_onDownload:function(){this.trigger_up('download',{resIds:this.records.map(record=>record.res_id),});},_onEditModel:function(ev){this.trigger_up('edit_model',{document:this.records[0].data,});},_onFieldChanged:function(ev){ev.stopPropagation();this._saveMulti(ev.data.changes);},_onLock:function(){this.trigger_up('lock_attachment',{resId:this.records[0].res_id,});},_onMouseoverRule:function(ev){$(ev.currentTarget).closest('.o_inspector_trigger_hover_target').addClass('o_inspector_hover');},_onMouseoutRule:function(ev){$(ev.currentTarget).closest('.o_inspector_trigger_hover_target').removeClass('o_inspector_hover');},_onOpenChatter:function(){this.trigger_up('open_chatter');},_onOpenPreview:function(ev){ev.preventDefault();ev.stopPropagation();if(this.pendingSavingRequests>0)
return;const activeId=$(ev.currentTarget).data('id');if(activeId){const records=this.records.map(record=>record.data);this.trigger_up('kanban_image_clicked',{recordId:activeId,recordList:records});}},_onOpenResource:function(){const record=this.records[0];this.trigger_up('open_record',{resId:record.data.res_id,resModel:record.data.res_model,});},_onRemoveTag:function(ev){ev.stopPropagation();const tagId=$(ev.currentTarget).closest('.o_inspector_tag').data('id');const changes={tag_ids:{operation:'FORGET',resIds:[tagId],},};this._saveMulti(changes);},_onReplace:function(){this.trigger_up('set_file',{id:this.records[0].data.id,});},_onShare:function(){this.trigger_up('share_ids',{resIds:this.records.map(record=>record.res_id),});},_onTagInputClicked:function(){if(this.$tagInput.autocomplete("widget").is(":visible")){this.$tagInput.autocomplete("close");}else{this.$tagInput.autocomplete('search');}},_onTriggerRule:function(ev){const $btn=$(ev.currentTarget);const ruleId=$btn.closest('.o_inspector_rule').data('id');$btn.prop('disabled',true);this.trigger_up('trigger_rule',{records:this.records,ruleId:ruleId});},});return DocumentsInspector;});;

/* /documents/static/src/js/documents_inspector_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsInspectorMobile',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var DocumentsInspector=require('documents.DocumentsInspector');DocumentsInspector.include({template:'documents.DocumentsInspectorMobile',init:function(){this._super.apply(this,arguments);this.isMobile=true;},async start(){await this._super(...arguments);this.trigger_up('open_chatter');},getLocalState:function(){return _.extend({},this._super.apply(this,arguments),{open:this.el.getAttribute('open')==='',});},setLocalState:function(state){this._super.apply(this,arguments);if(state.open){this.open();}},open:function(){this.el.setAttribute('open','');},});});;

/* /documents/static/src/owl/components/pdf_manager/pdf_manager.js defined in bundle 'web.assets_backend' */
odoo.define('documents.component.PdfManager',function(require){'use strict';const PdfGroupName=require('documents.component.PdfGroupName');const PdfPage=require('documents.component.PdfPage');const{computeMultiSelection}=require('documents.utils');const{isEventHandled,markEventHandled}=require('@mail/utils/utils');const ajax=require('web.ajax');const{csrf_token,_t}=require('web.core');const{useState}=owl.hooks;class PdfManager extends owl.Component{constructor(){super(...arguments);this.state=useState({uploadingLock:false,groupData:{},groupIds:[],pages:{},viewedPage:undefined,archive:true,anchorId:undefined,lShiftKeyDown:false,rShiftKeyDown:false,});this._newFiles={};this._pageCanvas={};this._onGlobalKeydown=this._onGlobalKeydown.bind(this);this._onGlobalCaptureKeyup=this._onGlobalCaptureKeyup.bind(this);}
async willStart(){await this._loadAssets();}
mounted(){document.addEventListener('keydown',this._onGlobalKeydown);document.addEventListener('keyup',this._onGlobalCaptureKeyup,true);for(const pdf_document of this.props.documents){this._addFile(pdf_document.name,{url:`/documents/content/${pdf_document.id}`,documentId:pdf_document.id,});}}
willUnmount(){document.removeEventListener('keydown',this._onGlobalKeydown);document.removeEventListener('keyup',this._onGlobalCaptureKeyup);}
get ignoredPageIds(){return Object.keys(this.state.pages).filter(key=>!this.state.pages[key].isSelected&&this.state.pages[key].groupId);}
get activePageIds(){return Object.keys(this.state.pages).filter(key=>this.state.pages[key].isSelected&&this.state.pages[key].groupId);}
async _addFile(name,{documentId,file,url}){if(!url){if(!file&&!documentId){return;}
url=URL.createObjectURL(file);}
this.state.uploadingLock=true;const fileId=_.uniqueId('file');const pdf=await this._getPdf(url);if(file){this._newFiles[fileId]={type:'file',file};}else if(documentId){this._newFiles[fileId]={type:'document',documentId};}
name=name||_t("New File");const extIndex=name.indexOf('.pdf');if(extIndex>=0){name=name.substring(0,extIndex);}
const pageCount=pdf.numPages;const{pageIds,newPages}=this._createPages({fileId,name,pageCount});await this._loadCanvases({newPages,pageCount,pdf});this._newFiles[fileId].pageIds=this._newFiles[fileId].activePageIds=pageIds;this.state.uploadingLock=false;}
_addPage(pageId,groupId,{index}={}){if(!this.state.groupData[groupId]){return;}
this._removePage(pageId);if(index!==undefined){this.state.groupData[groupId].pageIds.splice(index,0,pageId);}else{this.state.groupData[groupId].pageIds.push(pageId);}
this.state.pages[pageId].groupId=groupId;}
async _applyChanges(ruleId){const processedPageIds=this.activePageIds;if(processedPageIds.length===0){this.trigger('pdf-manager-error',{message:_t("No document has been selected")});return;}
const pageIds=this.ignoredPageIds;for(const pageId of pageIds){this._removePage(pageId);}
const exit=!pageIds.length;try{const result=await this._sendChanges({exit,ruleId});const documentIds=JSON.parse(result);this.trigger('process-documents',{documentIds,ruleId,exit});if(!exit){for(const pageId of processedPageIds){this._removePage(pageId,{fromFile:true});}
this._createGroup({name:_t("Remaining Pages"),pageIds,isSelected:true});}}catch(error){this.trigger('pdf-manager-error',{message:error.message||error});if(pageIds.length){this._createGroup({name:_t("Remaining Pages"),pageIds:pageIds,isSelected:true});}}finally{this.state.uploadingLock=false;this.state.anchorId=undefined;}}
_createGroup({name,pageIds,index,isSelected}={}){const groupId=_.uniqueId('group');pageIds=pageIds||[];this.state.groupData[groupId]={groupId,name:name||_t("New Group"),pageIds,};for(const pageId of pageIds){this.state.pages[pageId].groupId=groupId;if(isSelected!==undefined){this.state.pages[pageId].isSelected=isSelected;}}
if(index){this.state.groupIds.splice(index,0,groupId);}else{this.state.groupIds.push(groupId);}
return groupId;}
_createPages({fileId,name,pageCount}){let groupId;let groupName=name;let groupLock=false;const pageIds=[];const newPages={};for(let pageNumber=1;pageNumber<=pageCount;pageNumber++){if(!groupLock){groupId=this._createGroup({name:groupName});groupLock=this.props.documents.length>1;groupName=`${name}-p${pageNumber + 1}`;}
const pageId=_.uniqueId('page');this.state.pages[pageId]={pageId,groupId,fileId,localPageNumber:pageNumber,isSelected:true,};newPages[pageNumber]=pageId;this._pageCanvas[pageId]={};this.state.groupData[groupId].pageIds.push(pageId);pageIds.push(pageId);}
return{pageIds,newPages};}
_createXhr(){return new window.XMLHttpRequest();}
async _getPdf(url){return window.pdfjsLib.getDocument(url).promise;}
async _loadAssets(){let asset;try{asset=await ajax.loadAsset('documents.pdf_js_assets');}catch(error){asset=await ajax.loadAsset('web.pdf_js_lib');}finally{await ajax.loadLibs(asset);}}
async _loadCanvases({newPages,pageCount,pdf}){for(let pageNumber=1;pageNumber<=pageCount;pageNumber++){const pageId=newPages[pageNumber];const page=await pdf.getPage(pageNumber);const canvas=await this._renderCanvas(page,{width:160,height:230,});this._pageCanvas[pageId]={page,canvas};const pdfPage=this.__owl__.refs[`PdfPage_${pageId}`];if(pdfPage){pdfPage.renderPage(canvas);}}}
_removeGroup(groupId){if(this.state.groupData[groupId].pageIds.length>0){return;}
for(const pageId in this.state.pages){const page=this.state.pages[pageId];if(page.groupId===groupId){page.groupId=false;}}
this.state.groupIds=this.state.groupIds.filter(listedGroupId=>listedGroupId!==groupId);delete this.state.groupData[groupId];}
_removePage(pageId,{fromFile}={}){const page=this.state.pages[pageId];if(!page){return;}
const pageIds=this.state.groupData[page.groupId].pageIds;this.state.groupData[page.groupId].pageIds=pageIds.filter(number=>number!==pageId);if(page.groupId){this._removeGroup(page.groupId);}
page.groupId=false;if(fromFile){const activePageIds=this._newFiles[page.fileId].activePageIds;this._newFiles[page.fileId].activePageIds=activePageIds.filter(number=>number!==pageId);if(this._newFiles[page.fileId].activePageIds.length===0){this._removeFile(page.fileId);}
page.fileId=false;}}
_removeFile(fileId){for(const pageId of this._newFiles[fileId].pageIds){delete this._pageCanvas[pageId];delete this.state.pages[pageId];}
delete this._newFiles[fileId];}
async _renderCanvas(page,{width,height}){const viewPort=page.getViewport({scale:1});const canvas=document.createElement("canvas");canvas.className="o_documents_pdf_canvas";canvas.width=width;canvas.height=height;const scale=Math.min(canvas.width/viewPort.width,canvas.height/viewPort.height);await page.render({canvasContext:canvas.getContext("2d"),viewport:page.getViewport({scale}),}).promise;return canvas;}
async _sendChanges({exit,ruleId}={}){this.state.uploadingLock=true;const data=new FormData();const fileIds=[];const files=[];for(const key in this._newFiles){if(this._newFiles[key].type==='file'){files.push(this._newFiles[key].file);fileIds.push(key);}}
const fileGroups=JSON.parse(JSON.stringify(this.state.groupData));const newFiles=Object.values(fileGroups);newFiles.forEach((newFile)=>{newFile.new_pages=[];for(const pageId of newFile.pageIds){const fileId=this.state.pages[pageId].fileId;const file=this._newFiles[fileId];const old_file_type=file.type;const old_file_index=old_file_type==='file'?fileIds.indexOf(fileId):file.documentId;newFile.new_pages.push({old_file_type,old_file_index,old_page_number:this.state.pages[pageId].localPageNumber,});}
delete newFile.pageIds;});return new Promise((resolve,reject)=>{const xhr=this._createXhr();xhr.open('POST','/documents/pdf_split');data.append('csrf_token',csrf_token);for(const file of files){data.append('ufile',file);}
data.append('new_files',JSON.stringify(newFiles));data.append('archive',this.state.archive);const document=this.props.documents[0];data.append('vals',JSON.stringify({folder_id:document.folder_id.res_id,tag_ids:document.tag_ids.res_ids,owner_id:document.owner_id.res_id,partner_id:document.partner_id.res_id,}));xhr.send(data);xhr.onload=()=>{if(xhr.status===200){resolve(xhr.response);}else{reject(xhr.response);}};xhr.onerror=()=>{reject();};});}
_onClickArchive(ev){ev.stopPropagation;ev.target.blur();this.state.archive=!this.state.archive;}
_onClickDropdown(ev){markEventHandled(ev,'PdfManager.toggleDropdown');}
_onClickGlobalAdd(ev){ev.stopPropagation();const $uploadInput=$('<input/>',{type:'file',name:'files[]',multiple:'multiple',accept:'application/pdf',});$uploadInput.on('change',async e=>{const files=$uploadInput[0].files;$uploadInput.remove();for(const file of files){await this._addFile(file.name,{file});}});$uploadInput.click();}
_onClickGlobalClose(ev){ev.stopPropagation();this.trigger('process-documents',{exit:true});}
_onSelectClicked(ev){const{pageId,isCheckbox,isRangeSelection,isKeepSelection}=ev.detail;const selectedPageIds=this.activePageIds;const anchorId=this.state.anchorId||selectedPageIds[0];const recordIds=[];for(const groupId of this.state.groupIds){recordIds.push(...this.state.groupData[groupId].pageIds);}
const{newSelection,anchor}=computeMultiSelection(recordIds,pageId,{anchor:anchorId,isCheckbox,isKeepSelection,isRangeSelection:isRangeSelection&&anchorId,selected:selectedPageIds,});const selectionSet=new Set(newSelection);this.state.anchorId=anchor;for(const pageId in this.state.pages){this.state.pages[pageId].isSelected=selectionSet.has(pageId);}}
_onClickManager(ev){if(isEventHandled(ev,'PdfManager.toggleDropdown')){return;}
ev.stopPropagation();this.previewCanvas=undefined;this.state.viewedPage=undefined;}
async _onClickPage(ev){ev.stopPropagation();const pageId=ev.detail;const page=this._pageCanvas[pageId].page;if(!page){return;}
this.previewCanvas=await this._renderCanvas(page,{width:1300,height:1800,});this.state.viewedPage=pageId;}
_onClickPageSeparator(pageId,groupId,ev){ev.stopPropagation();const page=this.state.pages[pageId];const groupPageIds=this.state.groupData[groupId].pageIds;const pageIndex=groupPageIds.indexOf(pageId);const groupIndex=this.state.groupIds.indexOf(groupId);const isLastPage=pageIndex===groupPageIds.length-1;if(isLastPage){const targetGroupId=this.state.groupIds[groupIndex+1];if(targetGroupId){const pageIds=this.state.groupData[targetGroupId].pageIds;for(const pageId of pageIds){this._addPage(pageId,page.groupId);}}}else{const newGroupPages=groupPageIds.slice(pageIndex+1);const name=this.state.groupData[groupId].name;const newGroupId=this._createGroup({name,index:groupIndex+1,});for(const page of newGroupPages){this._addPage(page,newGroupId);}}}
_onClickPreview(ev){ev.stopPropagation();this.previewCanvas=undefined;this.state.viewedPage=undefined;}
_onClickRule(ruleId,ev){ev.stopPropagation();this._applyChanges(ruleId);}
_onClickSplit(ev){ev.stopPropagation();this._applyChanges();}
_onEditName(ev){ev.stopPropagation();const groupId=ev.detail.groupId;this.state.groupData[groupId].name=ev.detail.name||_t("unnamed");}
_onGlobalCaptureKeyup(ev){if(ev.code==='ShiftLeft'){this.state.lShiftKeyDown=false;}else if(ev.code==='ShiftRight'){this.state.rShiftKeyDown=false;}}
_onGlobalKeydown(ev){if($(ev.target).is('input')){return;}
if(ev.key==='A'){for(const pageId in this.state.pages){this.state.pages[pageId].isSelected=true;}}else if(ev.code==='ShiftLeft'){this.state.lShiftKeyDown=true;}else if(ev.code==='ShiftRight'){this.state.rShiftKeyDown=true;}}
_onPageDragStart(ev){ev.stopPropagation();}
_onPageDrop(ev){ev.stopPropagation();const targetPageId=ev.detail.targetPageId;const pageId=ev.detail.pageId;const targetGroupId=this.state.pages[targetPageId].groupId;const index=this.state.groupData[targetGroupId].pageIds.indexOf(targetPageId);this._addPage(pageId,targetGroupId,{index});}}
PdfManager.components={PdfPage,PdfGroupName};PdfManager.defaultProps={rules:[],};PdfManager.props={documents:Array,rules:Array,};PdfManager.template='documents.component.PdfManager';return PdfManager;});;

/* /documents/static/src/owl/components/pdf_page/pdf_page.js defined in bundle 'web.assets_backend' */
odoo.define('documents.component.PdfPage',function(require){'use strict';const{useState,useRef}=owl.hooks;class PdfPage extends owl.Component{constructor(){super(...arguments);this.state=useState({isHover:false,isRendered:false,});this.canvasWrapperRef=useRef("canvasWrapper");}
mounted(){this.renderPage(this.props.canvas);}
patched(){this.renderPage(this.props.canvas);}
renderPage(canvas){if(!canvas||this.isRendered){return;}
this.canvasWrapperRef.el.appendChild(canvas);this.isRendered=true;}
_onClickWrapper(ev){ev.stopPropagation();this.trigger('page-clicked',this.props.pageId);}
_onClickSelect(ev){ev.stopPropagation();this.trigger('select-clicked',{pageId:this.props.pageId,isCheckbox:true,isRangeSelection:ev.shiftKey,isKeepSelection:true,});}
_onDragEnter(ev){ev.stopPropagation();ev.preventDefault();this.state.isHover=true;}
_onDragLeave(ev){ev.stopPropagation();ev.preventDefault();this.state.isHover=false;}
_onDragOver(ev){ev.preventDefault();}
_onDragStart(ev){ev.stopPropagation();this.trigger('page-dragged');ev.dataTransfer.setData('o_documents_pdf_data',this.props.pageId);}
_onDrop(ev){this.state.isHover=false;if(!ev.dataTransfer.types.includes('o_documents_pdf_data')){return;}
const pageId=ev.dataTransfer.getData('o_documents_pdf_data');if(pageId===this.props.pageId){return;}
this.trigger('page-dropped',{targetPageId:this.props.pageId,pageId});}}
PdfPage.defaultProps={isPreview:false,isSelected:false,};PdfPage.props={canvas:{type:Object,optional:true,},isPreview:Boolean,isSelected:Boolean,pageId:String,};PdfPage.template='documents.component.PdfPage';return PdfPage;});;

/* /documents/static/src/owl/components/pdf_group_name/pdf_group_name.js defined in bundle 'web.assets_backend' */
odoo.define('documents.component.PdfGroupName',function(require){'use strict';const{useRef,useState}=owl.hooks;class PdfGroupName extends owl.Component{constructor(){super(...arguments);this.state=useState({edit:false,});this.nameInputRef=useRef('nameInput');}
_onBlur(){this.trigger('edit-name',{groupId:this.props.groupId,name:this.nameInputRef.el.value,});this.state.edit=false;}
_onClickGroupName(ev){ev.stopPropagation();this.state.edit=true;}
_onKeyDown(ev){if(ev.code!=="Enter"){return;}
ev.stopPropagation();this.trigger('edit-name',{groupId:this.props.groupId,name:this.nameInputRef.el.value,});this.state.edit=false;}}
PdfGroupName.props={groupId:String,name:String,};PdfGroupName.template='documents.component.PdfGroupName';return PdfGroupName;});;

/* /documents/static/src/js/systray_activity_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@documents/js/systray_activity_menu',async function(require){'use strict';let __exports={};const ActivityMenu=require('@mail/js/systray/systray_activity_menu')[Symbol.for("default")];const session=require('web.session');ActivityMenu.include({events:_.extend({},ActivityMenu.prototype.events,{'click .o_sys_documents_request':'_onRequestDocument',}),async willStart(){await this._super(...arguments);this.hasDocumentUserGroup=await session.user_has_group('documents.group_documents_user');},_onRequestDocument:function(ev){ev.preventDefault();ev.stopPropagation();this.$('.dropdown-toggle').dropdown('toggle');this.do_action('documents.action_request_form');},});return __exports;});;

/* /documents/static/src/js/tours/documents.js defined in bundle 'web.assets_backend' */
odoo.define('documents.tour',function(require){"use strict";const{_t}=require('web.core');const{Markup}=require('web.utils');const tour=require('web_tour.tour');tour.register('documents_tour',{url:"/web",rainbowManMessage:_t("Wow... 6 documents processed in a few seconds, You're good.<br/>The tour is complete. Try uploading your own documents now."),sequence:180,},[{trigger:'.o_app[data-menu-xmlid="documents.menu_root"]',content:Markup(_t("Want to become a <b>paperless company</b>? Let's discover Odoo Documents.")),position:'bottom',},{trigger:'img[src="https://img.youtube.com/vi/Ayab6wZ_U1A/0.jpg"]',content:Markup(_t("Click on a thumbnail to <b>preview the document</b>.")),position:'bottom',run:function(actions){$('.o_close_btn').click();},},{trigger:'.o_search_panel_filter_value:eq(0)',extra_trigger:'.o_search_panel_label',content:Markup(_t("Let's process documents in your Inbox.<br/><i>Tip: Use Tags to filter documents and structure your process.</i>")),position:'bottom',run:function(actions){$('.o_search_panel_filter_value:eq(0) .o_search_panel_label_title').click();},},{trigger:'.o_kanban_record:contains(mail.png)',extra_trigger:'.o_documents_kanban',content:Markup(_t("Click on a card to <b>select the document</b>.")),position:'bottom',},{trigger:'.o_inspector_rule[data-id="3"] .o_inspector_trigger_rule',extra_trigger:'.o_documents_image_background',content:Markup(_t("Let's tag this mail as legal<br/> <i>Tips: actions can be tailored to your process, according to the workspace.</i>")),position:'bottom',},{trigger:'.o_kanban_record:nth(0):contains(Mails_inbox.pdf)',extra_trigger:'.o_documents_kanban',content:_t("Let's process this document, coming from our scanner."),position:'bottom',},{trigger:'.o_inspector_split',extra_trigger:'[title="Mails_inbox.pdf"]',content:_t("As this PDF contains multiple documents, let's split and process in bulk."),position:'bottom',},{trigger:'.o_page_splitter_wrapper:nth(3)',extra_trigger:'.o_documents_pdf_canvas:nth(5)',content:Markup(_t("Click on the <b>page separator</b>: we don't want to split these two pages as they belong to the same document.")),position:'right',},{trigger:'.o_documents_pdf_page_selector:nth(5)',extra_trigger:'.o_documents_pdf_manager',content:Markup(_t("<b>Deselect this page</b> as we plan to process all bills first.")),position:'left',},{trigger:'.o_pdf_rule_buttons:nth-last-child(2)',extra_trigger:'.o_documents_pdf_manager',content:_t("Let's process these bills: send to Finance workspace."),position:'bottom',},{trigger:'.o_pdf_rule_buttons:first',extra_trigger:'.o_pdf_rule_buttons:not(:disabled)',content:_t("Send this letter to the legal department, by assigning the right tags."),position:'bottom',}]);});;

/* /base_import/static/lib/javascript-state-machine/state-machine.js defined in bundle 'web.assets_backend' */
(function(window){StateMachine={VERSION:"2.1.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4,},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300,},WILDCARD:'*',ASYNC:'async',create:function(cfg,target){var initial=(typeof cfg.initial=='string')?{state:cfg.initial}:cfg.initial;var fsm=target||cfg.target||{};var events=cfg.events||[];var callbacks=cfg.callbacks||{};var map={};var add=function(e){var from=(e.from instanceof Array)?e.from:(e.from?[e.from]:[StateMachine.WILDCARD]);map[e.name]=map[e.name]||{};for(var n=0;n<from.length;n++)
map[e.name][from[n]]=e.to||from[n];};if(initial){initial.event=initial.event||'startup';add({name:initial.event,from:'none',to:initial.state});}
for(var n=0;n<events.length;n++)
add(events[n]);for(var name in map){if(map.hasOwnProperty(name))
fsm[name]=StateMachine.buildEvent(name,map[name]);}
for(var name in callbacks){if(callbacks.hasOwnProperty(name))
fsm[name]=callbacks[name]}
fsm.current='none';fsm.is=function(state){return this.current==state;};fsm.can=function(event){return!this.transition&&(map[event].hasOwnProperty(this.current)||map[event].hasOwnProperty(StateMachine.WILDCARD));}
fsm.cannot=function(event){return!this.can(event);};fsm.error=cfg.error||function(name,from,to,args,error,msg){throw msg;};if(initial&&!initial.defer)
fsm[initial.event]();return fsm;},doCallback:function(fsm,func,name,from,to,args){if(func){try{return func.apply(fsm,[name,from,to].concat(args));}
catch(e){return fsm.error(name,from,to,args,StateMachine.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function");}}},beforeEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onbefore'+name],name,from,to,args);},afterEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onafter'+name]||fsm['on'+name],name,from,to,args);},leaveState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onleave'+from],name,from,to,args);},enterState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onenter'+to]||fsm['on'+to],name,from,to,args);},changeState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onchangestate'],name,from,to,args);},buildEvent:function(name,map){return function(){var from=this.current;var to=map[from]||map[StateMachine.WILDCARD]||from;var args=Array.prototype.slice.call(arguments);if(this.transition)
return this.error(name,from,to,args,StateMachine.Error.PENDING_TRANSITION,"event "+name+" inappropriate because previous transition did not complete");if(this.cannot(name))
return this.error(name,from,to,args,StateMachine.Error.INVALID_TRANSITION,"event "+name+" inappropriate in current state "+this.current);if(false===StateMachine.beforeEvent(this,name,from,to,args))
return StateMachine.CANCELLED;if(from===to){StateMachine.afterEvent(this,name,from,to,args);return StateMachine.NOTRANSITION;}
var fsm=this;this.transition=function(){fsm.transition=null;fsm.current=to;StateMachine.enterState(fsm,name,from,to,args);StateMachine.changeState(fsm,name,from,to,args);StateMachine.afterEvent(fsm,name,from,to,args);};var leave=StateMachine.leaveState(this,name,from,to,args);if(false===leave){this.transition=null;return StateMachine.CANCELLED;}
else if("async"===leave){return StateMachine.ASYNC;}
else{if(this.transition)
this.transition();return StateMachine.SUCCEEDED;}};}};if("function"===typeof define){define("statemachine",[],function(){return StateMachine;});}
else{window.StateMachine=StateMachine;}}(this));;

/* /base_import/static/src/import_records/import_records.js defined in bundle 'web.assets_backend' */
odoo.define('@base_import/import_records/import_records',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{Component}=owl;const favoriteMenuRegistry=registry.category("favoriteMenu");const ImportRecords=__exports.ImportRecords=class ImportRecords extends Component{setup(){this.action=useService("action");}
importRecords(){const{context,resModel}=this.env.searchModel;this.action.doAction({type:"ir.actions.client",tag:"import",params:{model:resModel,context}});}}
ImportRecords.template="base_import.ImportRecords";const importRecordsItem={Component:ImportRecords,groupNumber:4,isDisplayed:({config,isSmall})=>!isSmall&&config.actionType==="ir.actions.act_window"&&["kanban","list"].includes(config.viewType)};favoriteMenuRegistry.add("import-menu",importRecordsItem,{sequence:1});return __exports;});;

/* /base_import/static/src/legacy/js/import_action.js defined in bundle 'web.assets_backend' */
odoo.define('base_import.import',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var session=require('web.session');var time=require('web.time');var fieldUtils=require('web.field_utils');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var StateMachine=window.StateMachine;function jsonp(form,attributes,callback){attributes=attributes||{};var options={jsonp:_.uniqueId('import_callback_')};window[options.jsonp]=function(){delete window[options.jsonp];callback.apply(null,arguments);};if('data'in attributes){_.extend(attributes.data,options);}else{_.extend(attributes,{data:options});}
_.extend(attributes,{dataType:'script',});$(form).ajaxSubmit(attributes);}
function _make_option(term){return{id:term,text:term};}
function _from_data(data,term){return _.findWhere(data,{id:term})||_make_option(term);}
function dataFilteredQuery(q){var suggestions=_.clone(this.data);if(q.term){var exact=_.filter(suggestions,function(s){return s.id===q.term||s.text===q.term;});if(exact.length){suggestions=exact;}else{suggestions=[_make_option(q.term)].concat(_.filter(suggestions,function(s){return s.id.indexOf(q.term)!==-1||s.text.indexOf(q.term)!==-1}));}}
q.callback({results:suggestions});}
var DataImport=AbstractAction.extend({hasControlPanel:true,contentTemplate:'ImportView',opts:[{name:'encoding',label:_lt("Encoding:"),value:''},{name:'separator',label:_lt("Separator:"),value:''},{name:'quoting',label:_lt("Text Delimiter:"),value:'"'}],spreadsheet_opts:[{name:'sheet',label:_lt("Selected Sheet:"),value:''},],parse_opts_formats:[{name:'date_format',label:_lt("Date Format:"),value:''},{name:'datetime_format',label:_lt("Datetime Format:"),value:''},],parse_opts_separators:[{name:'float_thousand_separator',label:_lt("Thousands Separator:"),value:','},{name:'float_decimal_separator',label:_lt("Decimal Separator:"),value:'.'}],events:{'change .oe_import_file':'loaded_file','change input.oe_import_has_header, .oe_import_sheet':'settings_changed','change input.oe_import_advanced_mode':function(e){this.do_not_change_match=true;this['settings_changed']();},'click .oe_import_report a.oe_import_report_count':function(e){e.preventDefault();$(e.target).parent().find('i.arrow').toggleClass('up down');$(e.target).parent().parent().toggleClass('oe_import_report_showmore');},'click .oe_import_report_see_possible_value':function(e){e.preventDefault();$(e.target).parent().toggleClass('oe_import_report_showmore');},'click .oe_import_moreinfo_action a':function(e){e.preventDefault();var action=JSON.parse($(e.target).attr('data-action'));action.views=_(action.views).map(function(view){var id=view[0],type=view[1];return[id,type!=='tree'?type:action.view_type==='form'?'list':'tree'];});this.do_action(_.extend(action,{target:'new',flags:{search_view:true,display_title:true,pager:true,list:{selectable:false}}}));},},init:function(parent,action){this._super.apply(this,arguments);this.action_manager=parent;this.res_model=action.params.model;this.parent_context=action.params.context||{};this.id=null;this.session=session;this._title=_t('Import a File');this.do_not_change_match=false;this.sheets=[];this.selectionFields={};},willStart:function(){var self=this;var def=this._rpc({model:this.res_model,method:'get_import_templates',context:this.parent_context,}).then(function(result){self.importTemplates=result;});return Promise.all([this._super.apply(this,arguments),def]);},start:function(){var self=this;this.$form=this.$('form');this.setup_encoding_picker();this.setup_separator_picker();this.setup_float_format_picker();this.setup_date_format_picker();this.setup_sheets_picker();return Promise.all([this._super(),self.create_model().then(function(id){self.id=id;self.$('input[name=import_id]').val(id);self.renderButtons();var status={cp_content:{$buttons:self.$buttons},};self.updateControlPanel(status);}),]);},create_model:function(){return this._rpc({model:'base_import.import',method:'create',args:[{res_model:this.res_model}],kwargs:{context:session.user_context},});},renderButtons:function(){var self=this;this.$buttons=$(QWeb.render("ImportView.buttons",this));this.$buttons.filter('.o_import_validate').on('click',this.validate.bind(this));this.$buttons.filter('.o_import_import').on('click',this.import.bind(this));this.$buttons.filter('.oe_import_file').on('click',function(){self.$('.o_content .oe_import_file').click();});this.$buttons.filter('.o_import_cancel').on('click',function(e){e.preventDefault();self.exit();});},setup_encoding_picker:function(){this.$('input.oe_import_encoding').select2({width:'50%',data:_.map(('utf-8 utf-16 windows-1252 latin1 latin2 big5 gb18030 shift_jis windows-1251 koir8_r').split(/\s+/),_make_option),query:dataFilteredQuery,minimumResultsForSearch:-1,initSelection:function($e,c){return c(_make_option($e.val()));}});},setup_separator_picker:function(){var data=[{id:',',text:_t("Comma")},{id:';',text:_t("Semicolon")},{id:'\t',text:_t("Tab")},{id:' ',text:_t("Space")}];this.$('input.oe_import_separator').select2({width:'50%',data:data,query:dataFilteredQuery,minimumResultsForSearch:-1,initSelection:function($e,c){c(_from_data(data,$e.val())||_make_option($e.val()))}});},setup_float_format_picker:function(){var data_decimal=[{id:',',text:_t("Comma")},{id:'.',text:_t("Dot")},];var data_digits=data_decimal.concat([{id:'',text:_t("No Separator")}]);this.$('input.oe_import_float_thousand_separator').select2({width:'50%',data:data_digits,query:dataFilteredQuery,minimumResultsForSearch:-1,initSelection:function($e,c){c(_from_data(data_digits,$e.val())||_make_option($e.val()))}});this.$('input.oe_import_float_decimal_separator').select2({width:'50%',data:data_decimal,query:dataFilteredQuery,minimumResultsForSearch:-1,initSelection:function($e,c){c(_from_data(data_decimal,$e.val())||_make_option($e.val()))}});},setup_date_format_picker:function(){var data=_(['YYYY-MM-DD','DD/MM/YY','DD/MM/YYYY','DD-MM-YYYY','DD-MMM-YY','DD-MMM-YYYY','MM/DD/YY','MM/DD/YYYY','MM-DD-YY','MM-DD-YYYY','DDMMYY','DDMMYYYY','YYMMDD','YYYYMMDD','YY/MM/DD','YYYY/MM/DD','MMDDYY','MMDDYYYY',]).map(_make_option);this.$('input.oe_import_date_format').select2({width:'50%',data:data,query:dataFilteredQuery,minimumResultsForSearch:-1,initSelection:function($e,c){c(_from_data(data,$e.val())||_make_option($e.val()));}})},setup_sheets_picker:function(){var data=this.sheets.map(_make_option);this.$('input.oe_import_sheet').select2({width:'100%',data:data,query:dataFilteredQuery,minimumResultsForSearch:-1,initSelection:function($e,c){c(_from_data(data,$e.val())||_make_option($e.val()))},});},import_options:function(){var self=this;var options={has_headers:this.$('input.oe_import_has_header').prop('checked'),advanced:this.$('input.oe_import_advanced_mode').prop('checked'),keep_matches:this.do_not_change_match,name_create_enabled_fields:{},import_set_empty_fields:[],import_skip_records:[],fallback_values:{},skip:Number(this.$('#oe_import_row_start').val())-1||0,limit:Number(this.$('#oe_import_batch_limit').val())||null,};_.each(_.union(this.opts,this.spreadsheet_opts),function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});_(this.parse_opts_formats).each(function(opt){options[opt.name]=time.moment_to_strftime_format(self.$('input.oe_import_'+opt.name).val());});_(this.parse_opts_separators).each(function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});options['fields']=[];if(this.do_not_change_match){options['fields']=this.$('input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();}
this.do_not_change_match=false;this.$('select.o_import_create_option').each(function(){var field=this.getAttribute('field');var type=this.getAttribute('type');if(field){if(['boolean','many2one','many2many','selection'].includes(type)&&this.value==='skip_record'){options.import_skip_records.push(field);}else if(['many2one',"many2many","selection"].includes(type)){if(this.value==='set_empty'){options.import_set_empty_fields.push(field);}else{options.name_create_enabled_fields[field]=this.value==='create';}}else if(['boolean','selection'].includes(type)&&this.value!=='prevent'){options.fallback_values[field]={fallback_value:this.value,field_model:this.getAttribute('model'),field_type:type};}}});return options;},onfile_loaded:function(event,from,to,arg){if(arg!=null){var savedSkipLines=0;var isPartialEnabled=this.$('.oe_import').hasClass('o_import_partial_mode');if(isPartialEnabled){savedSkipLines=this.$('#oe_import_row_start').val();}
this.toggle_partial(null);if(isPartialEnabled&&savedSkipLines){this.$('#oe_import_row_start').val(savedSkipLines);}}
this.$buttons.filter('.o_import_import, .o_import_validate').addClass('d-none');if(!this.$('input.oe_import_file').val()){return this['settings_changed']();}
this.$('.oe_import_date_format').select2('val','');this.$('.oe_import_datetime_format').val('');this.$('.oe_import_sheet').val('');this.$form.removeClass('oe_import_preview oe_import_error');var import_toggle=false;var file=this.$('input.oe_import_file')[0].files[0];var isCSV=((file.type&&_.last(file.type.split('/'))==="csv")||(_.last(file.name.split('.'))==="csv"))
this.$form.find('.o_import_formatting').toggleClass('d-none',!isCSV);var fileName=file.name.split('.');var fileExtension=fileName.pop();fileName=fileName.join('.');this.$('#oe_imported_file').text(fileName);this.$('#oe_imported_file_extension').text('.'+fileExtension);this.$form.find('.oe_import_box').toggle(true);jsonp(this.$form,{url:'/base_import/set_file'},this.proxy('settings_changed'));},onpreviewing:function(){var self=this;this.$buttons.filter('.o_import_import, .o_import_validate').addClass('d-none');this.$form.addClass('oe_import_with_file');this.$form.removeClass('oe_import_preview_error oe_import_error');this.$form.toggleClass('oe_import_noheaders',!this.$('input.oe_import_has_header').prop('checked'));this.$('input.oe_import_file').val('');this.$('.oe_import_options_cell,.oe_import_options_header').addClass('d-none');this._cleanComments();$.blockUI({message:QWeb.render('Throbber')});$(document.body).addClass('o_ui_blocked');$('.oe_throbber_message').text(_t("Loading file..."));this._rpc({model:'base_import.import',method:'parse_preview',args:[this.id,this.import_options()],kwargs:{context:session.user_context},}).then(function(result){var signal=result.error?'preview_failed':'preview_succeeded';self[signal](result);$(document.body).removeClass('o_ui_blocked');$.unblockUI();});},onpreview_error:function(event,from,to,result){this.$('.oe_import_options').show();this.$form.addClass('oe_import_preview_error oe_import_error');this.$form.find('.oe_import_box, .oe_import_with_file').removeClass('d-none');this.$form.find('.o_view_nocontent').addClass('d-none');this.$('.oe_import_error_report').html(QWeb.render('ImportView.preview.error',result));},onpreview_success:function(event,from,to,result){var self=this;this.$buttons.filter('.oe_import_file').text(_t('Load File')).removeClass('btn-primary').addClass('btn-secondary').blur();this.$buttons.filter('.o_import_import, .o_import_validate').removeClass('d-none');this.$form.find('.oe_import_box, .oe_import_with_file').removeClass('d-none');this.$form.find('.o_view_nocontent').addClass('d-none');this.$form.addClass('oe_import_preview');this.$('input.oe_import_advanced_mode').prop('checked',result.advanced_mode);this.$('.oe_import_grid').html(QWeb.render('ImportView.preview',result));this.$('.oe_import_grid .o_import_preview').each((index,element)=>{$(element).popover({title:_t("Preview"),trigger:'hover',html:true,content:QWeb.render('ImportView.preview_popover',{preview:result.preview[index]}),});});this.fileLength=result.file_length;this.$('.o_import_batch').toggleClass('d-none',!(this.fileLength>100));this.$('.o_import_batch_alert').toggleClass('d-none',!result.batch);var messages=[];if(result.headers.length===1){messages.push({type:'warning',message:_t("A single column was found in the file, this often means the file separator is incorrect")});}
if(!_.isEmpty(messages)){this.$('.oe_import_options').show();this.onresults(null,null,null,{'messages':messages});}
if(!_.isEqual(this.sheets,result.options.sheets)){this.sheets=result.options.sheets||[];this.setup_sheets_picker();}
this.$('div.oe_import_has_multiple_sheets').toggle(this.sheets.length>1);_.each(['encoding','separator','float_thousand_separator','float_decimal_separator','sheet'],function(id){self.$('.oe_import_'+id).select2('val',result.options[id])});this.$('.oe_import_date_format').select2('val',time.strftime_to_moment_format(result.options.date_format));this.$('.oe_import_datetime_format').val(time.strftime_to_moment_format(result.options.datetime_format));this.$('.oe_import_debug_option').toggleClass('d-none',!result.debug);var $fields=this.$('.oe_import_match_field');this.render_fields_matches(result,$fields);var data=this._generate_fields_completion(result);var item_finder=function(id,items){items=items||data;for(var i=0;i<items.length;++i){var item=items[i];if(item.id===id){return item;}
var val;if(item.children&&(val=item_finder(id,item.children))){return val;}}
return'';};$fields.each(function(k,v){var $fieldInput=$(v);var filteredData=self._generate_fields_completion(result,k);var updateFieldInformation=function(fieldInfo){var $commentCell=$fieldInput.closest('tr.oe_import_grid-row').find('.oe_import_comment_cell');var $optionsDiv=$commentCell.find('.oe_import_options_div');var isRelational=fieldInfo.type==='many2many'||fieldInfo.type==='many2one';var setEmpty=!fieldInfo.required&&(isRelational||fieldInfo.type==='selection');var isO2MField=false;if(isRelational&&fieldInfo.id.includes('/')){var fieldName=fieldInfo.id.split('/')[0];var field=result.fields.find((field)=>field.name===fieldName);if(field&&field.type==='one2many'){isO2MField=true;}}
var showSkipRecord=setEmpty&&!isO2MField||(!fieldInfo.required&&fieldInfo.type==='boolean');if(isRelational||fieldInfo.type==='boolean'){$optionsDiv.empty();$optionsDiv.append(QWeb.render('ImportView.create_record_option',{data:fieldInfo,is_relational:isRelational,set_empty:setEmpty,show_skip_record:showSkipRecord}));}else if(fieldInfo.type==='selection'){self._rpc({model:fieldInfo.comodel_name||fieldInfo.model_name,method:'fields_get',}).then(function(values){var selectionField=fieldInfo.id.split('/').pop();var selectionLabels=values[selectionField]["selection"].map(value=>value[1]);$optionsDiv.empty();$optionsDiv.append(QWeb.render('ImportView.create_record_option',{data:fieldInfo,values:selectionLabels,set_empty:setEmpty,show_skip_record:showSkipRecord}));self.selectionFields[data.id]=values;});}else if($optionsDiv.find('.o_import_create_option').length==1){$optionsDiv.empty();}
$commentCell.attr('field',fieldInfo.id||"");$commentCell.attr('model',fieldInfo.comodel_name||fieldInfo.model_name||"");var $fieldDropdown=$fieldInput.closest('.oe_import_match_cell').find('.select2-choice');var oldType=$fieldDropdown.getAttributes()['type'];$fieldDropdown.removeClass(`o_import_field_${oldType}`).addClass(`o_import_field_icon o_import_field_${fieldInfo.type}`);$fieldDropdown.attr('type',fieldInfo.type);};var default_value=$fieldInput.val();var fieldInfo=item_finder(default_value);if(!fieldInfo){$fieldInput.val('');}
$fieldInput.select2({allowClear:true,minimumInputLength:0,data:filteredData,initSelection:function(element,callback){if(!default_value){callback('');return;}
updateFieldInformation(fieldInfo);callback(fieldInfo);self._handleMappingComments(v,fieldInfo);},formatSelection:function(object,container){var fieldTooltipString=`%(label)s: %(labelValue)s
%(name)s: %(nameValue)s
%(type)s: %(typeValue)s
%(model)s: %(modelValue)s`;var tooltip=_.str.sprintf(fieldTooltipString,{'label':_t("Label"),'labelValue':object.text,'name':_t("Name"),'nameValue':object.id,'type':_t("Type"),'typeValue':object.type,'model':_t("Model"),'modelValue':object.comodel_name||object.model_name,});$(container[0]).closest('a').attr('title',tooltip);return object.text;},formatResultCssClass:function(object){if(object.required){return"font-weight-bold text-decoration-underline";}
return"";},placeholder:_t('To import, select a field...'),width:'resolve',dropdownCssClass:'oe_import_selector'}).on('change',function(event){var changedField=event.currentTarget;var fieldRemovedId=event.removed?event.removed.id:false;self._cleanFieldComments(changedField,fieldRemovedId);var fieldInfo=item_finder(changedField.value);updateFieldInformation(fieldInfo);self._handleMappingComments(changedField,fieldInfo);if(!event.val){var $matchingCell=$(changedField).closest('.oe_import_match_cell')
$matchingCell.find('.o_import_field_icon').removeClass('o_import_field_icon');$matchingCell.find('a.select2-choice').removeAttr("title");}});$fieldInput.closest('.oe_import_match_cell').find('.select2-input').attr('placeholder',_t('Search for a field...'));});},_cleanFieldComments:function(changedField,fieldRemovedId){if(fieldRemovedId){var $sameMappedFields=this.$(`.oe_import_comment_cell[field=\"${fieldRemovedId}\"]`).find('.oe_import_same_mapped_field');if($sameMappedFields.length==2){$sameMappedFields.remove();}}
var $fieldRow=$(changedField).closest('tr.oe_import_grid-row');$fieldRow.find('.oe_import_comments_div').empty();$fieldRow.find('.oe_import_options_div').addClass("d-none");},_cleanComments:function(){this.$('.oe_import_error_report').empty();this.$('.oe_import_comments_div').find('.alert-error,.alert-warning').remove();this.$form.removeClass('oe_import_error');},_onBatchStart:function(){var recordsDone=this.batchSize*(this.currentBatchNumber-1);var percentage=parseInt(recordsDone/this.totalToImport*100);$('.o_import_progress_dialog').find('.progress-bar').text(percentage+"%").attr('aria-valuenow',percentage).css('width',percentage+'%');$('.o_import_progress_dialog').find('.o_import_progress_dialog_batch_count').text(this.currentBatchNumber);if(percentage!==0){var estimatedTimeLeftMinutes=((Date.now()-this.importStartTime)*((100-percentage)/percentage))/60000;$('.o_import_progress_dialog_time_left').removeClass('d-none');$('.o_import_progress_dialog_time_left_text').text(fieldUtils.format.float_time(estimatedTimeLeftMinutes));}},_onStopImport:function(event){var $currentTarget=$(event.currentTarget);$currentTarget.enable(false);$currentTarget.closest('.o_import_progress_dialog').find('.o_import_progress_dialog_stop, .o_import_progress_dialog_batch').toggleClass('d-none');this.stopImport=true;},_handleMappingComments:function(changedField,fieldInfo){var commentsToAdd=[];var $sameMappedFields=this.$('.oe_import_comment_cell[field="'+fieldInfo.id+'"]');if(fieldInfo.type=='many2many'){commentsToAdd.push(QWeb.render('ImportView.comment_m2m_field'));}
if($sameMappedFields.length>=2){if(['char','text',"many2many"].includes(fieldInfo.type)){commentsToAdd.push(QWeb.render('ImportView.comment_same_mapped_field',{field:fieldInfo.text,}));}else{var $targetMappedFieldId=$(changedField).parent().find('div.oe_import_match_field').getAttributes()['id'];_.each($sameMappedFields,function(fieldComment){var $mappingCell=$(fieldComment).parent().find('div.oe_import_match_field');if($mappingCell.getAttributes()['id']!==$targetMappedFieldId){$mappingCell.find('.select2-search-choice-close').trigger('mousedown').trigger('click');}});}}
var $commentDiv=$sameMappedFields.find(".oe_import_comments_div");$commentDiv.empty();_.each($commentDiv,function(fieldComment){_.each(commentsToAdd,function(comment){$(fieldComment).append(comment);});});},_generate_fields_completion:function(root,index){var self=this;var basic=[];var regulars=[];var o2m=[];var suggested=[];var header_types=root.header_types;function traverse(field,ancestors,collection,type){var subfields=field.fields;var advanced_mode=self.$('input.oe_import_advanced_mode').prop('checked');var field_path=ancestors.concat(field);var label=_(field_path).pluck('string').join(' / ');var id=_(field_path).pluck('name').join('/');if(!collection){if(field.name==='id'){collection=basic;}else if(_.isEmpty(subfields)||_.isEqual(_.pluck(subfields,'name'),['id','.id'])){collection=(type&&type.indexOf(field['type'])!==-1)?suggested:regulars;}else{collection=o2m;}}
collection.push({id:id,text:label,required:field.required,type:field.type,default_value:field.default_value,comodel_name:field.comodel_name,model_name:field.model_name,});if(advanced_mode){for(var i=0,end=subfields.length;i<end;++i){traverse(subfields[i],field_path,collection,type);}}}
_(root.fields).each(function(field){if(index===undefined){traverse(field,[]);}
else{if(self.$('input.oe_import_advanced_mode').prop('checked')){traverse(field,[],undefined,['all']);}
else{traverse(field,[],undefined,header_types[index]);}}});var cmp=function(field1,field2){return field1.text.localeCompare(field2.text);};suggested.sort(cmp);regulars.sort(cmp);o2m.sort(cmp);if(!_.isEmpty(regulars)&&!_.isEmpty(o2m)){if(!_.isEmpty(suggested)){basic=basic.concat({text:_t("Suggested Fields"),children:suggested});}
return basic.concat([{text:!_.isEmpty(suggested)?_t("Additional Fields"):_t("Standard Fields"),children:regulars},{text:_t("Relation Fields"),children:o2m},]);}else{return basic.concat(suggested,regulars,o2m);}},render_fields_matches:function(result,$fields){if(_(result.matches).isEmpty()){return;}
$fields.each(function(index,input){var match=result.matches[index];if(!match){return;}
var current_field=result;input.value=_(match).chain().map(function(name){return current_field=_(current_field.fields).find(function(subfield){return subfield.name===name;});}).pluck('name').value().join('/');});},call_import:function(kwargs){var fields=this.$('input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();var columns=this.$('.o_import_header_name').map(function(){return $(this).text().trim().toLowerCase()||false;}).get();var tracking_disable='tracking_disable'in kwargs?kwargs.tracking_disable:!this.$('#oe_import_tracking').prop('checked');delete kwargs.tracking_disable;kwargs.context=_.extend({},this.parent_context,{tracking_disable:tracking_disable});this.importStartTime=Date.now();this.stopImport=false;this.totalToImport=this.fileLength-parseInt(this.$('#oe_import_row_start').val());this.batchSize=parseInt(this.$('#oe_import_batch_limit').val()||0);var isBatch=this.batchSize!==0&&this.totalToImport>this.batchSize;var totalSteps=isBatch?Math.floor(this.totalToImport/this.batchSize)+1:1;this.currentBatchNumber=1;$.blockUI({message:QWeb.render('base_import.progressDialog',{importMode:kwargs.dryrun?_t('Testing'):_t('Importing'),isBatch:isBatch,totalSteps:totalSteps,})});$(document.body).addClass('o_ui_blocked');$('.o_import_progress_dialog').find('.o_progress_stop_import').on('click',this._onStopImport.bind(this));var opts=this.import_options();return this._batchedImport(opts,[this.id,fields,columns],kwargs,{done:0,prev:0}).then(null,function(reason){var error=reason.message;var event=reason.event;if(event){event.preventDefault();}
var msg;var errordata=error.data||{};if(errordata.type==='xhrerror'){var xhr=errordata.objects[0];switch(xhr.status){case 504:msg=_t("Import timed out. Please retry. If you still encounter this issue, the file may be too big for the system's configuration, try to split it (import less records per file).");break;default:msg=_t("An unknown issue occurred during import (possibly lost connection, data limit exceeded or memory limits exceeded). Please retry in case the issue is transient. If the issue still occurs, try to split the file rather than import it at once.");}}else{msg=errordata.arguments&&(errordata.arguments[1]||errordata.arguments[0])||error.message;}
return Promise.resolve({'messages':[{type:'error',record:false,message:msg,}]});}).finally(function(){$(document.body).removeClass('o_ui_blocked');$.unblockUI();});},_batchedImport:function(opts,args,kwargs,rec){var self=this;opts.callback&&opts.callback(this);this._onBatchStart();this.currentBatchNumber+=1;if(this.stopImport){$(document.body).removeClass('o_ui_blocked');$.unblockUI();return Promise.resolve({});}
return this._rpc({model:'base_import.import',method:'execute_import',args:args.concat([opts]),kwargs:kwargs},{shadow:true,}).then(function(results){_.each(results.messages,offset_by(opts.skip));if(!kwargs.dryrun&&!results.ids){self.$('#oe_import_row_start').val(opts.skip+1);if(opts.skip){results.messages.push({type:'info',priority:true,message:_.str.sprintf(_t("This file has been successfully imported up to line %d."),opts.skip)});}
return results;}
if(!results.nextrow){return results;}
return self._batchedImport(_.defaults({skip:results.nextrow},opts),args,kwargs,{done:rec.done+(results.ids||[]).length,prev:results.nextrow}).then(function(r2){return{name:_.zip(results.name,r2.name).map(function(names){return names[0]||names[1];}),ids:(results.ids||[]).concat(r2.ids||[]),messages:r2.messages?results.messages.concat(r2.messages):results.messages,skip:r2.skip||results.nextrow,nextrow:r2.nextrow}});});},onvalidate:function(){var prom=this.call_import({dryrun:true,tracking_disable:true});prom.then(this.proxy('validated'));return prom;},onimport:function(){var self=this;var prom=this.call_import({dryrun:false});prom.then(function(results){if(self.stopImport){var recordsImported=results.ids?results.ids.length:0;if(recordsImported){self.$('#oe_import_row_start').val((results.skip||0)+1);self.displayNotification({message:_.str.sprintf(_t("%d records successfully imported"),recordsImported)});}
self['import_interrupted'](results);}else if(!_.any(results.messages,function(message){return message.type==='error';})){self['import_succeeded'](results);return;}
self['import_failed'](results);});return prom;},onimported:function(event,from,to,results){this.displayNotification({message:_.str.sprintf(_t("%d records successfully imported"),results.ids.length)});this.exit();},exit:function(){this.trigger_up('history_back');},onresults:function(event,from,to,results){var self=this;var fields=this.$('input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();var error_type="warning";var errorMessages=results.messages;if(_.isEmpty(errorMessages)&&event!=='import_interrupted'){errorMessages.push({type:'info',message:_t("Everything seems valid.")});error_type=false;}else if(event==='import_interrupted'&&results.ids){this.toggle_partial(results);error_type=false;}else if(event==='import_failed'&&results.ids){this.toggle_partial(results);}
var offset=1;if(this.import_options().has_headers){offset+=1;}
var errorsSorted=_.sortBy(_(errorMessages).groupBy('message'),function(group){if(group[0].priority){return-2;}
var order=0;switch(group[0].type){case'error':order=0;error_type='error';break;case'warning':order=fields.length+1;break;case'info':order=2*(fields.length+1);break;default:order=3*(fields.length+1);break;}
return order+_.indexOf(fields,group[0].field);});var errorsByFields=this._regroupErrorsByFields(errorsSorted);if(!errorsByFields[0]&&error_type){var message=error_type==="warning"?_t("The file contains non-blocking warnings (see below)"):_t("The file contains blocking errors (see below)");errorsByFields[0]=[{'type':error_type,'message':message,}];}
self._cleanComments();_.each(errorsByFields,function(errors,field){var $errorCell=self.$('.oe_import_comment_cell[field="'+field+'"]');var $errorDiv=$errorCell.find(".oe_import_comments_div");var errorTemplate='ImportView.fieldError';if($errorDiv.length===0){$errorDiv=self.$('.oe_import_error_report');self.$form.addClass('oe_import_error');field=0;errorTemplate='ImportView.error';}
$errorDiv.append(QWeb.render(errorTemplate,{errors:errors,field:field,result_names:results.name,offset:offset,}));var mainError=errors[0];if(!mainError.not_matching_error&&mainError.type==="error"){$errorCell.find(".oe_import_options_div").removeClass('d-none');}});},_regroupErrorsByFields:function(errorsSorted){var errorsByFields={}
_.each(errorsSorted,function(errors){var mainError=errors[0];var field=mainError.field_path?mainError.field_path.join('/'):mainError.field||0;if(errors.length>1&&mainError.rows){var rowFrom=mainError.rows.from;var rowTo=errors[errors.length-1].rows.to;errors=mainError;mainError.rows.from=rowFrom;mainError.rows.to=rowTo;}else{errors=mainError;}
if(!errorsByFields[field]){errorsByFields[field]=[errors];}else{errorsByFields[field].push(errors);}});return errorsByFields;},toggle_partial:function(result){var $form=this.$('.oe_import');var $partial_warning=this.$('.o_import_partial_alert');var $partial_count=this.$('.o_import_partial_count');if(result==null){$partial_warning.addClass('d-none');$form.add(this.$buttons).removeClass('o_import_partial_mode');var $skip=this.$('#oe_import_row_start');$skip.val($skip.attr('value'));$partial_count.text('');return;}
this.$('.o_import_batch_alert').addClass('d-none');$partial_warning.removeClass('d-none');$form.add(this.$buttons).addClass('o_import_partial_mode');$partial_count.text((result.skip||0)+1);}});core.action_registry.add('import',DataImport);StateMachine.create({target:DataImport.prototype,events:[{name:'loaded_file',from:['none','file_loaded','preview_error','preview_success','results','imported'],to:'file_loaded'},{name:'settings_changed',from:['file_loaded','preview_error','preview_success','results'],to:'previewing'},{name:'preview_failed',from:'previewing',to:'preview_error'},{name:'preview_succeeded',from:'previewing',to:'preview_success'},{name:'validate',from:'preview_success',to:'validating'},{name:'validate',from:'results',to:'validating'},{name:'validated',from:'validating',to:'results'},{name:'import',from:['preview_success','results'],to:'importing'},{name:'import_succeeded',from:'importing',to:'imported'},{name:'import_interrupted',from:'importing',to:'results'},{name:'import_failed',from:'importing',to:'results'}],});function offset_by(by){return function offset_message(msg){if(msg.rows){msg.rows.from+=by;msg.rows.to+=by;}}}
return{DataImport:DataImport,};});;

/* /base_import/static/src/legacy/js/import_menu.js defined in bundle 'web.assets_backend' */
odoo.define('base_import.ImportMenu',function(require){"use strict";const FavoriteMenu=require('web.FavoriteMenu');const{useModel}=require('web.Model');const{Component}=owl;class ImportMenu extends Component{constructor(){super(...arguments);this.model=useModel('searchModel');}
importRecords(){const action={type:'ir.actions.client',tag:'import',params:{model:this.model.config.modelName,context:this.model.config.context,}};this.trigger('do-action',{action:action});}
static shouldBeDisplayed(env){return env.view&&['kanban','list'].includes(env.view.type)&&env.action.type==='ir.actions.act_window'&&!env.device.isMobile&&!!JSON.parse(env.view.arch.attrs.import||'1')&&!!JSON.parse(env.view.arch.attrs.create||'1');}}
ImportMenu.props={};ImportMenu.template="base_import.ImportRecords";FavoriteMenu.registry.add('import-menu',ImportMenu,1);return ImportMenu;});;

/* /web_enterprise/static/src/search/control_panel/control_panel.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/search/control_panel/control_panel',async function(require){'use strict';let __exports={};const{ControlPanel}=require("@web/search/control_panel/control_panel");const{patch}=require("@web/core/utils/patch");const{useExternalListener,useState}=owl.hooks;const{Portal}=owl.misc;const STICKY_CLASS="o_mobile_sticky";patch(ControlPanel.prototype,"web_enterprise.ControlPanel",{setup(){this._super();this.state=useState({showSearchBar:false,showMobileSearch:false,showViewSwitcher:false,});useExternalListener(window,"click",this.onWindowClick);const display=this.display;if(!("adaptToScroll"in display)||display.adaptToScroll){useExternalListener(document,"scroll",this.onScrollThrottled);}},mounted(){this.oldScrollTop=0;this.initialScrollTop=document.documentElement.scrollTop;this.el.style.top="0px";this._super();},resetSearchState(){Object.assign(this.state,{showSearchBar:false,showMobileSearch:false,showViewSwitcher:false,});},onScrollThrottled(){if(this.isScrolling){return;}
this.isScrolling=true;requestAnimationFrame(()=>(this.isScrolling=false));const scrollTop=document.documentElement.scrollTop;const delta=Math.round(scrollTop-this.oldScrollTop);if(scrollTop>this.initialScrollTop){const elRect=this.el.getBoundingClientRect();this.el.classList.add(STICKY_CLASS);this.el.style.top=delta<0?`${Math.min(0, elRect.top - delta)}px`:`${Math.max(-elRect.height, elRect.top - delta)}px`;}else{this.el.classList.remove(STICKY_CLASS);}
this.oldScrollTop=scrollTop;},onViewClicked(){this.resetSearchState();this._super(...arguments);},onWindowClick(ev){if(this.state.showViewSwitcher&&!ev.target.closest(".o_cp_switch_buttons")){this.state.showViewSwitcher=false;}},});patch(ControlPanel,"web_enterprise.ControlPanel",{template:"web_enterprise.ControlPanel",components:{...ControlPanel.components,Portal,},});return __exports;});;

/* /web_enterprise/static/src/search/search_panel/search_panel.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/search/search_panel/search_panel',async function(require){'use strict';let __exports={};const{SearchPanel}=require("@web/search/search_panel/search_panel");const{patch}=require("@web/core/utils/patch");const{Portal}=owl.misc;const isFilter=(s)=>s.type==="filter";const isActiveCategory=(s)=>s.type==="category"&&s.activeValueId;const nameOfCheckedValues=(values)=>{const names=[];for(const[,value]of values){if(value.checked){names.push(value.display_name);}}
return names;};patch(SearchPanel.prototype,"web_enterprise.SearchPanel",{setup(){this._super(...arguments);this.state.showMobileSearch=false;},getCategorySelection(){const activeCategories=this.env.searchModel.getSections(isActiveCategory);const selection=[];for(const category of activeCategories){const parentIds=this.getAncestorValueIds(category,category.activeValueId);const orderedCategoryNames=[...parentIds,category.activeValueId].map((valueId)=>category.values.get(valueId).display_name);selection.push({values:orderedCategoryNames,icon:category.icon,color:category.color,});}
return selection;},getFilterSelection(){const filters=this.env.searchModel.getSections(isFilter);const selection=[];for(const{groups,values,icon,color}of filters){let filterValues;if(groups){filterValues=Object.keys(groups).map((groupId)=>nameOfCheckedValues(groups[groupId].values)).flat();}else if(values){filterValues=nameOfCheckedValues(values);}
if(filterValues.length){selection.push({values:filterValues,icon,color});}}
return selection;},});patch(SearchPanel,"web_enterprise.SearchPanel",{template:"web_enterprise.SearchPanel",components:{...SearchPanel.components,Portal,},});return __exports;});;

/* /web_enterprise/static/src/webclient/barcode/barcode_scanner.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/webclient/barcode/barcode_scanner',async function(require){'use strict';let __exports={};const Dialog=require("web.OwlDialog");const{delay}=require("web.concurrency");const{loadAssets}=require("@web/core/assets");const{core,Component,hooks,mount}=owl;const{_t}=require('web.core');const{useRef}=hooks;const bus=new core.EventBus();const busOk="BarcodeDialog-Ok";const busError="BarcodeDialog-Error";const HAVE_NOTHING=0;const HAVE_METADATA=1;function isVideoElementReady(video){return![HAVE_NOTHING,HAVE_METADATA].includes(video.readyState);}
function buildZXingBarcodeDetector(ZXing){const ZXingFormats=new Map([["aztec",ZXing.BarcodeFormat.AZTEC],["code_39",ZXing.BarcodeFormat.CODE_39],["code_128",ZXing.BarcodeFormat.CODE_128],["data_matrix",ZXing.BarcodeFormat.DATA_MATRIX],["ean_8",ZXing.BarcodeFormat.EAN_8],["ean_13",ZXing.BarcodeFormat.EAN_13],["itf",ZXing.BarcodeFormat.ITF],["pdf417",ZXing.BarcodeFormat.PDF_417],["qr_code",ZXing.BarcodeFormat.QR_CODE],["upc_a",ZXing.BarcodeFormat.UPC_A],["upc_e",ZXing.BarcodeFormat.UPC_E],]);const allSupportedFormats=Array.from(ZXingFormats.keys());class ZXingBarcodeDetector{constructor(opts={}){const formats=opts.formats||allSupportedFormats;const hints=new Map([[ZXing.DecodeHintType.POSSIBLE_FORMATS,formats.map((format)=>ZXingFormats.get(format))],[ZXing.DecodeHintType.TRY_HARDER,true],]);this.reader=new ZXing.MultiFormatReader();this.reader.setHints(hints);}
async detect(video){if(!(video instanceof HTMLVideoElement)){throw new DOMException("imageDataFrom() requires an HTMLVideoElement","InvalidArgumentError");}
if(!isVideoElementReady(video)){throw new DOMException("HTMLVideoElement is not ready","InvalidStateError");}
const canvas=document.createElement("canvas");const ctx=canvas.getContext("2d");canvas.width=video.videoWidth;canvas.height=video.videoHeight;ctx.drawImage(video,0,0,video.videoWidth,video.videoHeight);const luminanceSource=new ZXing.HTMLCanvasElementLuminanceSource(canvas);const binaryBitmap=new ZXing.BinaryBitmap(new ZXing.HybridBinarizer(luminanceSource));try{const result=this.reader.decode(binaryBitmap);const format=Array.from(ZXingFormats).find(([k,val])=>val===result.getBarcodeFormat());const rawValue=result.getText();return[{format,rawValue,},];}catch(err){if(err.name==="NotFoundException"){return[];}
throw err;}}}
ZXingBarcodeDetector.getSupportedFormats=async()=>allSupportedFormats;return ZXingBarcodeDetector;}
class BarcodeDialog extends Component{constructor(){super(...arguments);this.videoPreviewRef=useRef("videoPreview");this.interval=null;this.stream=null;this.detector=null;}
async willStart(){let DetectorClass;if("BarcodeDetector"in window){DetectorClass=BarcodeDetector;}else{await loadAssets({jsLibs:["/web_enterprise/static/lib/zxing-library/zxing-library.js"],});DetectorClass=buildZXingBarcodeDetector(window.ZXing);}
const formats=await DetectorClass.getSupportedFormats();this.detector=new DetectorClass({formats});}
async mounted(){const constraints={video:{facingMode:"environment"},audio:false,};try{this.stream=await navigator.mediaDevices.getUserMedia(constraints);}catch(err){const errors={NotFoundError:_t('No device can be found.'),NotAllowedError:_t('Odoo needs your authorization first.'),};const errorMessage=_t('Could not start scanning. ')+(errors[err.name]||err.message);this.onError(new Error(errorMessage));return;}
this.videoPreviewRef.el.srcObject=this.stream;await this.isVideoReady();this.interval=setInterval(this.detectCode.bind(this),100);}
willUnmount(){clearInterval(this.interval);this.interval=null;if(this.stream){this.stream.getTracks().forEach((track)=>track.stop());this.stream=null;}}
async isVideoReady(){return new Promise(async(resolve)=>{while(!isVideoElementReady(this.videoPreviewRef.el)){await delay(10);}
resolve();});}
onResult(result){this.closeDialog();bus.trigger(busOk,result);}
onError(error){this.closeDialog();bus.trigger(busError,{error});}
closeDialog(){this.destroy();}
async detectCode(){try{const codes=await this.detector.detect(this.videoPreviewRef.el);if(codes.length===0){return;}
this.onResult(codes[0].rawValue);}catch(err){this.onError(err);}}}
Object.assign(BarcodeDialog,{components:{Dialog,},template:"web_enterprise.BarcodeDialog",});__exports.isBarcodeScannerSupported=isBarcodeScannerSupported;function isBarcodeScannerSupported(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia;}
__exports.scanBarcode=scanBarcode;async function scanBarcode(){const promise=new Promise((resolve,reject)=>{bus.on(busOk,null,resolve);bus.on(busError,null,reject);});await mount(BarcodeDialog,{target:document.body});return promise;}
return __exports;});;

/* /web_enterprise/static/src/webclient/burger_menu/burger_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/webclient/burger_menu/burger_menu',async function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{BurgerUserMenu}=require("@web_enterprise/webclient/burger_menu/user_menu/user_menu");const{MobileSwitchCompanyMenu}=require("@web_enterprise/webclient/burger_menu/mobile_switch_company_menu/mobile_switch_company_menu");const{MenuItem}=require("@web/webclient/navbar/navbar");const SWIPE_ACTIVATION_THRESHOLD=100;const BurgerMenu=__exports.BurgerMenu=class BurgerMenu extends owl.Component{setup(){this.company=useService("company");this.user=useService("user");this.menuRepo=useService("menu");this.hm=useService("home_menu");this.state=owl.hooks.useState({isUserMenuOpened:false,isBurgerOpened:false,});this.swipeStartX=null;owl.hooks.onMounted(()=>{this.env.bus.on("HOME-MENU:TOGGLED",this,()=>{this._closeBurger();});this.env.bus.on("ACTION_MANAGER:UPDATE",this,(req)=>{if(req.id){this._closeBurger();}});});}
get currentApp(){return!this.hm.hasHomeMenu&&this.menuRepo.getCurrentApp();}
get currentAppSections(){return((this.currentApp&&this.menuRepo.getMenuAsTree(this.currentApp.id).childrenTree)||[]);}
get isUserMenuUnfolded(){return!this.isUserMenuTogglable||this.state.isUserMenuOpened;}
get isUserMenuTogglable(){return this.currentApp&&this.currentAppSections.length>0;}
_closeBurger(){this.state.isUserMenuOpened=false;this.state.isBurgerOpened=false;}
_openBurger(){this.state.isBurgerOpened=true;}
_toggleUserMenu(){this.state.isUserMenuOpened=!this.state.isUserMenuOpened;}
_onMenuClicked(menu){this.menuRepo.selectMenu(menu);}
_onSwipeStart(ev){this.swipeStartX=ev.changedTouches[0].clientX;}
_onSwipeEnd(ev){if(!this.swipeStartX){return;}
const deltaX=ev.changedTouches[0].clientX-this.swipeStartX;if(deltaX<SWIPE_ACTIVATION_THRESHOLD){return;}
this._closeBurger();this.swipeStartX=null;}}
BurgerMenu.template="web_enterprise.BurgerMenu";BurgerMenu.components={Portal:owl.misc.Portal,MenuItem,BurgerUserMenu,MobileSwitchCompanyMenu,};const systrayItem={Component:BurgerMenu,isDisplayed:(env)=>env.isSmall,};registry.category("systray").add("burger_menu",systrayItem,{sequence:0});return __exports;});;

/* /web_enterprise/static/src/webclient/burger_menu/mobile_switch_company_menu/mobile_switch_company_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/webclient/burger_menu/mobile_switch_company_menu/mobile_switch_company_menu',async function(require){'use strict';let __exports={};const{SwitchCompanyMenu}=require("@web/webclient/switch_company_menu/switch_company_menu");const MobileSwitchCompanyMenu=__exports.MobileSwitchCompanyMenu=class MobileSwitchCompanyMenu extends SwitchCompanyMenu{}
MobileSwitchCompanyMenu.template="web_enterprise.MobileSwitchCompanyMenu";return __exports;});;

/* /web_enterprise/static/src/webclient/burger_menu/user_menu/user_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/webclient/burger_menu/user_menu/user_menu',async function(require){'use strict';let __exports={};const{UserMenu}=require("@web/webclient/user_menu/user_menu");const BurgerUserMenu=__exports.BurgerUserMenu=class BurgerUserMenu extends UserMenu{_onItemClicked(callback){callback();}}
BurgerUserMenu.template="web_enterprise.BurgerUserMenu";return __exports;});;

/* /web_enterprise/static/src/webclient/home_menu/enterprise_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/webclient/home_menu/enterprise_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{session}=require("@web/session");const enterpriseService=__exports.enterpriseService={name:"enterprise",dependencies:[],start(){return{expirationDate:session.expiration_date,expirationReason:session.expiration_reason,isMailInstalled:"notification_type"in session,warning:session.warning,};},};registry.category("services").add("enterprise",enterpriseService);return __exports;});;

/* /web_enterprise/static/src/webclient/home_menu/expiration_panel.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/webclient/home_menu/expiration_panel',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{useService}=require("@web/core/utils/hooks");const{Component,hooks}=owl;const{useState,useRef}=hooks;const{DateTime}=luxon;const ExpirationPanel=__exports.ExpirationPanel=class ExpirationPanel extends Component{constructor(){super(...arguments);this.enterprise=useService("enterprise");if(!this.enterprise.warning){this.state={display:false};return;}
this.cookie=useService("cookie");this.ui=useService("ui");this.rpc=useService("rpc");this.orm=useService("orm");let expirationDate;if(this.enterprise.expirationDate){expirationDate=this._parseExpirationDate(this.enterprise.expirationDate);}else{expirationDate=new DateTime.local().plus({days:30});}
const diffDays=this._computeDiffDays(expirationDate);const hideCookie=this.cookie.current.oe_instance_hide_panel;let alertType="info";if(diffDays<=6){alertType="danger";}else if(diffDays<=16){alertType="warning";}
this.state=useState({display:(diffDays<=30&&!hideCookie)||diffDays<=0,alertType,buttonText:"Register",diffDays,message:"register",expirationDate,});this.inputRef=useRef("input");this.expirationReason=this.enterprise.expirationReason;this.notYetRegistered=["trial","demo",false].includes(this.expirationReason);this.isMailInstalled=this.enterprise.isMailInstalled;this.warning=this.enterprise.warning;}
mounted(){if(this.state.diffDays<=0){this.isUIBlocked=true;this.ui.block({message:this.el,css:{cursor:"auto"},overlayCSS:{cursor:"auto"},});}}
_clearState(){for(const key in this.state){if(key!=="display"){delete this.state[key];}}}
_computeDiffDays(date){const today=new DateTime.local();const duration=date.diff(today,"days");return Math.round(duration.values.days);}
_parseExpirationDate(date){const fmt="yyyy-MM-dd hh:mm:ss";return new DateTime.fromFormat(date,fmt);}
_onHide(){this.cookie.setCookie("oe_instance_hide_panel",true,24*60*60);this.state.display=false;}
_onClickRegister(){this.state.displayRegisterForm=!this.state.displayRegisterForm;}
async _onBuy(){const limitDate=new DateTime.local().minus({days:15}).toFormat("yyyy-MM-dd");const args=[[["share","=",false],["login_date",">=",limitDate],],];const nbUsers=await this.orm.call("res.users","search_count",args);browser.location=`https://www.odoo.com/odoo-enterprise/upgrade?num_users=${nbUsers}`;}
async _onCodeSubmit(){const input=this.inputRef.el;const enterpriseCode=input.value;if(!enterpriseCode){const inputTitle=input.getAttribute("title");input.setAttribute("placeholder",inputTitle);return;}
const[oldDate,,linkedSubscriptionUrl,emailLinked]=await Promise.all([this.orm.call("ir.config_parameter","get_param",["database.expiration_date"]),this.orm.call("ir.config_parameter","set_param",["database.enterprise_code",enterpriseCode,]),this.orm.call("ir.config_parameter","get_param",["database.already_linked_subscription_url",]),this.orm.call("ir.config_parameter","get_param",["database.already_linked_email"]),]);this.cookie.setCookie("oe_instance_hide_panel","",-1);await this.orm.call("publisher_warranty.contract","update_notification",[[]]);const expirationDate=await this.orm.call("ir.config_parameter","get_param",["database.expiration_date",]);if(this.isUIBlocked){this.ui.unblock();}
this._clearState();if(expirationDate!==oldDate&&!linkedSubscriptionUrl){this.state.message="success";this.state.displayRegisterForm=false;this.state.alertType="success";this.state.expirationDate=this._parseExpirationDate(expirationDate);}else{this.state.alertType="danger";this.state.buttonText="Retry";this.state.displayRegisterForm=true;if(linkedSubscriptionUrl){this.state.message="link";this.state.linkedSubscriptionUrl=linkedSubscriptionUrl;this.state.emailDelivery=null;this.state.emailLinked=emailLinked;}else{this.state.message="error";}}}
async _onCheckStatus(){const oldDateStr=await this.orm.call("ir.config_parameter","get_param",["database.expiration_date",]);const oldDate=this._parseExpirationDate(oldDateStr);if(this._computeDiffDays(oldDate)>=30){return;}
await this.orm.call("publisher_warranty.contract","update_notification",[[]]);const expirationDateStr=await this.orm.call("ir.config_parameter","get_param",["database.expiration_date",]);const expirationDate=this._parseExpirationDate(expirationDateStr);if(expirationDateStr!==oldDateStr&&expirationDate>new DateTime.local()){if(this.isUIBlocked){this.ui.unblock();}
this._clearState();this.state.message="update";this.state.alertType="success";this.state.expirationDate=expirationDate;this.state.diffDays=this._computeDiffDays(expirationDate);}else{browser.location.reload();}}
async _onSendUnlinkEmail(){const args=["database.already_linked_send_mail_url"];const unlink_mail_send_url=await this.orm.call("ir.config_parameter","get_param",args);this.state.emailDelivery="ongoing";const{result,reason}=await this.rpc(unlink_mail_send_url,{});if(result){this.emailDelivery="success";}else{this.state.emailDelivery="fail";this.state.failReason=reason;}}
async _onRenew(){const oldDate=await this.orm.call("ir.config_parameter","get_param",["database.expiration_date",]);this.cookie.setCookie("oe_instance_hide_panel","",-1);await this.orm.call("publisher_warranty.contract","update_notification",[[]]);const[expirationDateStr,enterpriseCode]=await Promise.all([this.orm.call("ir.config_parameter","get_param",["database.expiration_date"]),this.orm.call("ir.config_parameter","get_param",["database.enterprise_code"]),]);const expirationDate=this._parseExpirationDate(expirationDateStr);if(expirationDateStr!==oldDate&&expirationDate>new DateTime.local()){if(this.isUIBlocked){this.ui.unblock();}
this._clearState();this.state.message="success";this.state.alertType="success";this.state.expirationDate=expirationDate;this.state.diffDays=this._computeDiffDays(expirationDate);}else{const params=enterpriseCode?{contract:enterpriseCode}:{};this.env.services.navigate("https://www.odoo.com/odoo-enterprise/renew",params);}}
async _onUpsell(){const limitDate=new DateTime.local().minus({days:15}).toFormat("yyyy-MM-dd");const[enterpriseCode,nbUsers]=await Promise.all([this.orm.call("ir.config_parameter","get_param",["database.enterprise_code"]),this.orm.call("res.users","search_count",[[["share","=",false],["login_date",">=",limitDate],],]),]);const url="https://www.odoo.com/odoo-enterprise/upsell";const contractQueryString=enterpriseCode?`&contract=${enterpriseCode}`:"";browser.location=`${url}?num_users=${nbUsers}${contractQueryString}`;}}
ExpirationPanel.template="DatabaseExpirationPanel";return __exports;});;

/* /web_enterprise/static/src/webclient/home_menu/home_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/webclient/home_menu/home_menu',async function(require){'use strict';let __exports={};const{ExpirationPanel}=require("@web_enterprise/webclient/home_menu/expiration_panel");const{useService}=require("@web/core/utils/hooks");const{isIosApp}=require("@web/core/browser/feature_detection");const{fuzzyLookup}=require("@web/core/utils/search");const{Component,hooks}=owl;const{useExternalListener,useState,useRef}=hooks;const HomeMenu=__exports.HomeMenu=class HomeMenu extends Component{setup(){super.setup();this.menus=useService("menu");this.homeMenuService=useService("home_menu");this.ui=useService("ui");this.availableApps=this.props.apps;this.displayedMenuItems=[];this.inputRef=useRef("input");this.mainContentRef=useRef("mainContent");this.state=useState({focusedIndex:null,isSearching:false,query:"",isIosApp:isIosApp(),});if(!this.env.isSmall){useExternalListener(window,"keydown",this._onKeydown);}}
async willUpdateProps(){this.state.focusedIndex=null;this.state.isSearching=false;this.state.query="";this.inputRef.el.value="";this.availableApps=this.props.apps;this.displayedMenuItems=[];}
mounted(){this._updateScrollBarWidth();}
patched(){if(this.state.focusedIndex!==null&&!this.env.isSmall){const selectedItem=document.querySelector(".o_home_menu .o_menuitem.o_focused");if(selectedItem){selectedItem.scrollIntoView({block:"center"});selectedItem.focus();}}
this._updateScrollBarWidth();}
get appIndex(){const appLength=this.displayedApps.length;const focusedIndex=this.state.focusedIndex;return focusedIndex<appLength?focusedIndex:null;}
get displayedApps(){return this.availableApps;}
get maxIconNumber(){const w=window.innerWidth;if(w<576){return 3;}else if(w<768){return 4;}else{return 6;}}
get menuIndex(){const appLength=this.displayedApps.length;const focusedIndex=this.state.focusedIndex;return focusedIndex>=appLength?focusedIndex-appLength:null;}
_filter(array){return fuzzyLookup(this.state.query,array,(el)=>(el.parents+" / "+el.label).split("/").reverse().join("/"));}
_openMenu(menu){return this.menus.selectMenu(menu);}
_updateFocusedIndex(cmd){const nbrApps=this.displayedApps.length;const nbrMenuItems=this.displayedMenuItems.length;const lastIndex=nbrApps+nbrMenuItems-1;let oldIndex=this.state.focusedIndex;if(lastIndex<0){return;}
if(!this.state.isSearching){if(document.activeElement.classList.contains("o_menuitem")){oldIndex=[...this.el.getElementsByClassName("o_menuitem")].indexOf(document.activeElement);}else{this.el.getElementsByClassName("o_menuitem")[0].focus();return;}}
const appIndex=this.state.isSearching?this.appIndex:oldIndex;const lastAppIndex=nbrApps-1;const appFocused=appIndex!==null;const lineNumber=Math.ceil(nbrApps/this.maxIconNumber);const currentLine=appFocused?Math.ceil((appIndex+1)/this.maxIconNumber):null;let newIndex;switch(cmd){case"previousElem":newIndex=oldIndex-1;break;case"nextElem":newIndex=oldIndex+1;break;case"previousColumn":if(!appFocused){newIndex=oldIndex;}else if(oldIndex%this.maxIconNumber){newIndex=oldIndex-1;}else{newIndex=oldIndex+Math.min(lastAppIndex-oldIndex,this.maxIconNumber-1);}
break;case"nextColumn":if(!appFocused){newIndex=oldIndex;}else if(oldIndex===lastAppIndex||(oldIndex+1)%this.maxIconNumber===0){newIndex=(currentLine-1)*this.maxIconNumber;}else{newIndex=oldIndex+1;}
break;case"previousLine":if(!appFocused){if(oldIndex>lastAppIndex+1){newIndex=oldIndex-1;}else{newIndex=(lineNumber-1)*this.maxIconNumber;}}else if(currentLine===1){if(nbrMenuItems>0){newIndex=lastIndex;}else{newIndex=oldIndex+(lineNumber-1)*this.maxIconNumber;if(newIndex>lastAppIndex){newIndex=lastAppIndex;}}}else{newIndex=oldIndex-this.maxIconNumber;}
break;case"nextLine":if(!appFocused){newIndex=oldIndex+1;}else if(currentLine===lineNumber){if(nbrMenuItems>0){newIndex=lastAppIndex+1;}else{newIndex=oldIndex%this.maxIconNumber;}}else{newIndex=oldIndex+Math.min(this.maxIconNumber,lastAppIndex-oldIndex);}
break;}
if(newIndex<0){newIndex=lastIndex;}else if(newIndex>lastIndex){newIndex=0;}
if(this.state.isSearching){this.state.focusedIndex=newIndex;}else{const item=this.el.getElementsByClassName("o_menuitem")[newIndex];item.focus();}}
_updateQuery(query){this.state.query=query;this.inputRef.el.value=this.state.query;this.state.isSearching=true;if(query===""){this.availableApps=this.props.apps;this.displayedMenuItems=[];}else{this.availableApps=this._filter(this.props.apps);this.displayedMenuItems=this._filter(this.props.menuItems);}
const total=this.displayedApps.length+this.displayedMenuItems.length;this.state.focusedIndex=total?0:null;}
_updateScrollBarWidth(){const{clientWidth,offsetWidth,style}=this.mainContentRef.el;style.paddingLeft=`${offsetWidth - clientWidth}px`;}
_onAppClick(app){this._openMenu(app);}
_onInputSearch(ev){this._updateQuery(ev.target.value);}
_onKeydown(ev){const isEditable=ev.target.tagName==="INPUT"||ev.target.tagName==="TEXTAREA"||ev.target.isContentEditable;const input=this.inputRef.el;if(isEditable&&ev.target!==input){return;}
if(this.ui.activeElement!==document){return;}
switch(ev.key){case"ArrowDown":this._updateFocusedIndex("nextLine");ev.preventDefault();break;case"ArrowRight":if(input===document.activeElement&&input.selectionEnd<this.state.query.length){return;}
this._updateFocusedIndex("nextColumn");ev.preventDefault();break;case"ArrowUp":this._updateFocusedIndex("previousLine");ev.preventDefault();break;case"ArrowLeft":if(input===document.activeElement&&input.selectionStart>0){return;}
this._updateFocusedIndex("previousColumn");ev.preventDefault();break;case"Tab":if(!this.state.isSearching){return;}
ev.preventDefault();this._updateFocusedIndex(ev.shiftKey?"previousElem":"nextElem");break;case"Enter":if(this.state.focusedIndex!==null){const isApp=this.appIndex!==null;const menu=isApp?this.displayedApps[this.appIndex]:this.displayedMenuItems[this.menuIndex];this._openMenu(menu);ev.preventDefault();}
return;case"Alt":case"AltGraph":case"Control":case"Meta":case"PageDown":case"PageUp":case"Shift":break;case"Escape":{const currentQuery=this.state.query;if(currentQuery){this._updateQuery("");}else{this.homeMenuService.toggle(false);}
break;}
case"c":case"x":if(ev.ctrlKey||ev.metaKey){break;}
default:if(document.activeElement!==input){input.focus();}}}
_onMenuitemClick(menu){this._openMenu(menu);}}
HomeMenu.components={ExpirationPanel};HomeMenu.props={apps:{type:Array,element:{type:Object,shape:{actionID:Number,appID:Number,id:Number,label:String,parents:String,webIcon:[Boolean,String,{type:Object,optional:1,shape:{iconClass:String,color:String,backgroundColor:String,},},],webIconData:{type:String,optional:1},xmlid:String,},},},menuItems:{type:Array,element:{type:Object,shape:{actionID:Number,appID:Number,id:Number,label:String,menuID:Number,parents:String,xmlid:String,},},},};HomeMenu.template="web_enterprise.HomeMenu";return __exports;});;

/* /web_enterprise/static/src/webclient/home_menu/home_menu_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/webclient/home_menu/home_menu_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Mutex}=require("@web/core/utils/concurrency");const{useService}=require("@web/core/utils/hooks");const{computeAppsAndMenuItems}=require("@web/webclient/menus/menu_helpers");const{ControllerNotFoundError}=require("@web/webclient/actions/action_service");const{HomeMenu}=require("@web_enterprise/webclient/home_menu/home_menu");const{Component,tags}=owl;const homeMenuService=__exports.homeMenuService={dependencies:["action","router"],start(env){let hasHomeMenu=false;let hasBackgroundAction=false;const mutex=new Mutex();class HomeMenuAction extends Component{setup(){this.router=useService("router");this.menus=useService("menu");this.homeMenuProps=computeAppsAndMenuItems(this.menus.getMenuAsTree("root"));}
async mounted(){const{breadcrumbs=[]}=this.env.config;hasHomeMenu=true;hasBackgroundAction=breadcrumbs.length>0;this.router.pushState({menu_id:undefined},{lock:false,replace:true});this.env.bus.trigger("HOME-MENU:TOGGLED");}
willUnmount(){hasHomeMenu=false;hasBackgroundAction=false;const currentMenuId=this.menus.getCurrentApp();if(currentMenuId){this.router.pushState({menu_id:currentMenuId.id},{lock:true});}
this.env.bus.trigger("HOME-MENU:TOGGLED");}}
HomeMenuAction.components={HomeMenu};HomeMenuAction.target="current";HomeMenuAction.template=tags.xml`<HomeMenu t-props="homeMenuProps"/>`;registry.category("actions").add("menu",HomeMenuAction);return{get hasHomeMenu(){return hasHomeMenu;},get hasBackgroundAction(){return hasBackgroundAction;},async toggle(show){return mutex.exec(async()=>{show=show===undefined?!hasHomeMenu:Boolean(show);if(show!==hasHomeMenu){if(show){await env.services.action.doAction("menu");}else{try{await env.services.action.restore();}catch(err){if(!(err instanceof ControllerNotFoundError)){throw err;}}}}
return new Promise((r)=>setTimeout(r));});},};},};registry.category("services").add("home_menu",homeMenuService);return __exports;});;

/* /web_enterprise/static/src/webclient/navbar/navbar.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/webclient/navbar/navbar',async function(require){'use strict';let __exports={};const{NavBar}=require("@web/webclient/navbar/navbar");const{useService}=require("@web/core/utils/hooks");const{hooks}=owl;const{useRef}=hooks;const EnterpriseNavBar=__exports.EnterpriseNavBar=class EnterpriseNavBar extends NavBar{setup(){super.setup();this.hm=useService("home_menu");this.menuAppsRef=useRef("menuApps");this.menuBrand=useRef("menuBrand");hooks.onMounted(()=>{this.env.bus.on("HOME-MENU:TOGGLED",this,()=>this._updateMenuAppsIcon());this._updateMenuAppsIcon();});hooks.onPatched(()=>{this._updateMenuAppsIcon();});}
get hasBackgroundAction(){return this.hm.hasBackgroundAction;}
get isInApp(){return!this.hm.hasHomeMenu;}
_updateMenuAppsIcon(){const menuAppsEl=this.menuAppsRef.el;menuAppsEl.classList.toggle("o_hidden",!this.isInApp&&!this.hasBackgroundAction);menuAppsEl.classList.toggle("fa-th",this.isInApp);menuAppsEl.classList.toggle("fa-chevron-left",!this.isInApp&&this.hasBackgroundAction);const title=!this.isInApp&&this.hasBackgroundAction?"Previous view":"Home menu";menuAppsEl.title=title;menuAppsEl.ariaLabel=title;const menuBrand=this.menuBrand.el;if(menuBrand){menuBrand.classList.toggle("o_hidden",!this.isInApp);}
const appSubMenus=this.appSubMenus.el;if(appSubMenus){appSubMenus.classList.toggle("o_hidden",!this.isInApp);}}}
EnterpriseNavBar.template="web_enterprise.EnterpriseNavBar";return __exports;});;

/* /web_enterprise/static/src/webclient/switch_company_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/webclient/switch_company_menu',async function(require){'use strict';let __exports={};const{patch}=require("@web/core/utils/patch");const{systrayItem}=require("@web/webclient/switch_company_menu/switch_company_menu");patch(systrayItem,"web_enterprise.CompanyMenuItem",{isDisplayed(env){return this._super(...arguments)&&!env.isSmall;},});return __exports;});;

/* /web_enterprise/static/src/webclient/user_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/webclient/user_menu',async function(require){'use strict';let __exports={};const{patch}=require("@web/core/utils/patch");const{systrayItem}=require("@web/webclient/user_menu/user_menu");patch(systrayItem,"web_enterprise.UserMenuItem",{isDisplayed:(env)=>!env.isSmall,});return __exports;});;

/* /web_enterprise/static/src/webclient/webclient.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/webclient/webclient',async function(require){'use strict';let __exports={};const{WebClient}=require("@web/webclient/webclient");const{useService}=require("@web/core/utils/hooks");const{EnterpriseNavBar}=require("@web_enterprise/webclient/navbar/navbar");const{hasTouch}=require("@web/core/browser/feature_detection");const{hooks}=owl;const WebClientEnterprise=__exports.WebClientEnterprise=class WebClientEnterprise extends WebClient{setup(){super.setup();this.hm=useService("home_menu");useService("enterprise_legacy_service_provider");hooks.onMounted(()=>{this.env.bus.on("HOME-MENU:TOGGLED",this,()=>{if(!this.el){return;}
this._updateClassList();});this._updateClassList();this.el.classList.toggle("o_touch_device",hasTouch());});}
_updateClassList(){this.el.classList.toggle("o_home_menu_background",this.hm.hasHomeMenu);this.el.classList.toggle("o_has_home_menu",this.hm.hasHomeMenu);}
_loadDefaultApp(){return this.hm.toggle(true);}}
WebClientEnterprise.components={...WebClient.components,NavBar:EnterpriseNavBar};return __exports;});;

/* /web_enterprise/static/src/views/pivot/pivot_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/views/pivot/pivot_renderer',async function(require){'use strict';let __exports={};const{patch}=require("@web/core/utils/patch");const{PivotRenderer}=require("@web/views/pivot/pivot_renderer");const{useEffect}=require("@web/core/utils/hooks");patch(PivotRenderer.prototype,"web_enterprise.PivotRendererMobile",{setup(){this._super();if(this.env.isSmall){useEffect(()=>{const tooltipElems=this.el.querySelectorAll("*[data-tooltip]");for(const el of tooltipElems){el.removeAttribute("data-tooltip");el.removeAttribute("data-tooltip-position");}});}},getPadding(cell){if(this.env.isSmall){return 5+cell.indent*5;}
return this._super(...arguments);},});return __exports;});;

/* /web_enterprise/static/src/legacy/js/control_panel.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.ControlPanel',function(require){"use strict";const ControlPanel=require('web.ControlPanel');const{device}=require('web.config');const{patch}=require('web.utils');const{Portal}=owl.misc;const{useState}=owl.hooks;const STICKY_CLASS='o_mobile_sticky';if(!device.isMobile){return;}
patch(ControlPanel.prototype,'web_enterprise.ControlPanel',{setup(){this._super(...arguments);this.state=useState({showSearchBar:false,showMobileSearch:false,showViewSwitcher:false,});},mounted(){this.onWindowClick=this._onWindowClick.bind(this);this.onWindowScroll=this._onScrollThrottled.bind(this);window.addEventListener('click',this.onWindowClick);document.addEventListener('scroll',this.onWindowScroll);this.oldScrollTop=0;this.initialScrollTop=document.documentElement.scrollTop;this.el.style.top='0px';this._super(...arguments);},willUnmount(){window.removeEventListener('click',this.onWindowClick);document.removeEventListener('scroll',this.onWindowScroll);},_getToday(){return new Date().getDate();},_resetSearchState(){Object.assign(this.state,{showSearchBar:false,showMobileSearch:false,showViewSwitcher:false,});},_onScrollThrottled(){if(this.isScrolling){return;}
this.isScrolling=true;requestAnimationFrame(()=>this.isScrolling=false);const scrollTop=document.documentElement.scrollTop;const delta=Math.round(scrollTop-this.oldScrollTop);if(scrollTop>this.initialScrollTop){const elRect=this.el.getBoundingClientRect();this.el.classList.add(STICKY_CLASS);this.el.style.top=delta<0?`${Math.min(0, elRect.top - delta)}px`:`${Math.max(-elRect.height, elRect.top - delta)}px`;}else{this.el.classList.remove(STICKY_CLASS);}
this.oldScrollTop=scrollTop;},_onSwitchView(){this._resetSearchState();},_onWindowClick(ev){if(this.state.showViewSwitcher&&!ev.target.closest('.o_cp_switch_buttons')){this.state.showViewSwitcher=false;}},});patch(ControlPanel,'web_enterprise.ControlPanel',{template:'web_enterprise._ControlPanel',components:{...ControlPanel.components,Portal,},});});;

/* /web_enterprise/static/src/legacy/js/core/dialog.js defined in bundle 'web.assets_backend' */
odoo.define("web_enterprise.Dialog",function(require){"use strict";const config=require("web.config");if(!config.device.isMobile){return;}
const Dialog=require("web.Dialog");Dialog.include({init(parent,{headerButtons}){this._super.apply(this,arguments);this.headerButtons=headerButtons||[];},async willStart(){const prom=await this._super.apply(this,arguments);if(this.renderHeader&&this.fullscreen){const $modalHeader=this.$modal.find(".modal-header");$modalHeader.find("button.close").remove();const $navigationBtn=$("<button>",{class:"btn fa fa-arrow-left","data-dismiss":"modal","aria-label":"close",});$modalHeader.prepend($navigationBtn);const $btnContainer=$("<div>");this._setButtonsTo($btnContainer,this.headerButtons);$modalHeader.append($btnContainer);}
this.scrollPosition={top:window.scrollY||document.documentElement.scrollTop,left:window.scrollX||document.documentElement.scrollLeft,};return prom;},destroy(){if(this.$modal&&$('.modal[role="dialog"]').filter(":visible").length<=1){this.$modal.closest("body").removeClass("modal-open");window.scrollTo(this.scrollPosition);}
this._super(...arguments);},});});;

/* /web_enterprise/static/src/legacy/js/res_config_settings.js defined in bundle 'web.assets_backend' */
odoo.define('base.settingsMobile',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var BaseSetting=require('base.settings');var KanbanTabsMobileMixin=require('web.KanbanTabsMobileMixin');BaseSetting.Renderer.include(Object.assign({},KanbanTabsMobileMixin,{start:function(){var prom=this._super.apply(this,arguments);core.bus.on("DOM_updated",this,function(){this._moveToTab(this.currentIndex||this._currentAppIndex());});return prom;},on_attach_callback:function(){this._super.apply(this,arguments);this._computeTabPosition(this.modules,this.currentIndex,this.$('.settings_tab'));},_activateSettingMobileTab:function(currentTab){var self=this;var moveTo=currentTab;var next=moveTo+1;var previous=moveTo-1;this.$(".settings .app_settings_block").removeClass("previous next current before after");this.$(".settings_tab .tab").removeClass("previous next current before after");_.each(this.modules,function(module,index){var tab=self.$(".tab[data-key='"+module.key+"']");var view=module.settingView;if(index===previous){tab.addClass("previous");view.addClass("previous");}else if(index===next){tab.addClass("next");view.addClass("next");}else if(index<moveTo){tab.addClass("before");view.addClass("before");}else if(index===moveTo){tab.addClass("current");view.addClass("current");}else if(index>moveTo){tab.addClass("after");view.addClass("after");}});this._computeTabPosition(this.modules,moveTo,this.$('.settings_tab'));},_enableSwipe:function(){var self=this;this.$('.settings').swipe({swipeLeft:function(){self._moveToTab(self.currentIndex+1);},swipeRight:function(){self._moveToTab(self.currentIndex-1);}});},_getTabWidth:function(column){return this.$(".tab[data-key='"+column.key+"']").outerWidth();},_moveToTab:function(index){this._super.apply(this,arguments);if(this.currentIndex!==-1){this.activeTab.removeClass("selected");this._activateSettingMobileTab(this.currentIndex);}},_onKeyUpSearch:function(event){this.$('.settings_tab').addClass('o_hidden');this.$('.settings').addClass('d-block');this._super.apply(this,arguments);},_resetSearch:function(){this._super.apply(this,arguments);this.$('.settings_tab').removeClass('o_hidden');this.$('.settings').removeClass('d-block');},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self._enableSwipe();});}}));var view_registry=require('web.view_registry');var BaseSettingsView=view_registry.get('base_settings');BaseSettingsView.include({init:function(){this.jsLibs.push('/web/static/lib/jquery.touchSwipe/jquery.touchSwipe.js');this._super.apply(this,arguments);},});});;

/* /web_enterprise/static/src/legacy/js/search_panel_mobile.js defined in bundle 'web.assets_backend' */
odoo.define("web.SearchPanelMobile",function(require){"use strict";const SearchPanel=require("web.searchPanel");const{device}=require("web.config");const{patch}=require('web.utils');if(!device.isMobile){return;}
const{Portal}=owl.misc;const isFilter=(s)=>s.type==="filter";function nameOfCheckedValues(values){const names=[];for(const[_,value]of values){if(value.checked){names.push(value.display_name);}}
return names;}
patch(SearchPanel.prototype,"web_enterprise.SearchPanel.Mobile",{setup(){this._super(...arguments);this.state.showMobileSearch=false;},_getCategorySelection(){const activeCategories=this.model.get("sections",(s)=>s.type==="category"&&s.activeValueId);const selection=[];for(const category of activeCategories){const parentIds=this._getAncestorValueIds(category,category.activeValueId);const orderedCategoryNames=[...parentIds,category.activeValueId,].map((valueId)=>category.values.get(valueId).display_name);selection.push({values:orderedCategoryNames,icon:category.icon,color:category.color,});}
return selection;},_getFilterSelection(){const filters=this.model.get("sections",isFilter);const selection=[];for(const{groups,values,icon,color}of filters){let filterValues;if(groups){filterValues=Object.keys(groups).map((groupId)=>nameOfCheckedValues(groups[groupId].values)).flat();}else if(values){filterValues=nameOfCheckedValues(values);}
if(filterValues.length){selection.push({values:filterValues,icon,color});}}
return selection;},});patch(SearchPanel,"web_enterprise.SearchPanel.Mobile",{template:"web_enterprise.Legacy.SearchPanel.Mobile",components:{...SearchPanel.components,Portal,},});});;

/* /web_enterprise/static/src/legacy/js/views/barcode_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.barcode_fields',function(require){"use strict";var field_registry=require('web.field_registry');require('web._field_registry');var relational_fields=require('web.relational_fields');const{_t}=require('web.core');const BarcodeScanner=require('@web_enterprise/webclient/barcode/barcode_scanner');var FieldMany2OneBarcode=relational_fields.FieldMany2One.extend({template:"FieldMany2OneBarcode",events:_.extend({},relational_fields.FieldMany2One.prototype.events,{'click .o_barcode_mobile':'_onBarcodeButtonClick',}),start:function(){var result=this._super.apply(this,arguments);this._startBarcode();return result;},_isExternalButtonVisible:function(){return this.$external_button.is(':visible');},_manageSearchMore(values){return values;},_renderEdit:function(){this._super.apply(this,arguments);if(this.$barcode_button){this.$barcode_button.toggle(!this._isExternalButtonVisible());}},_startBarcode:function(){this.$barcode_button=this.$('.o_barcode_mobile');this.$barcode_button.toggle(!this.isSet());},async _onBarcodeButtonClick(){const barcode=await BarcodeScanner.scanBarcode();if(barcode){this._onBarcodeScanned(barcode);if('vibrate'in window.navigator){window.navigator.vibrate(100);}}else{this.displayNotification({type:'warning',message:'Please, scan again !',});}},async _onBarcodeScanned(barcode){const results=await this._search(barcode);const records=results.filter(r=>!!r.id);if(records.length===1){this._setValue({id:records[0].id});}else{const dynamicFilters=[{description:_.str.sprintf(_t('Quick search: %s'),barcode),domain:[['id','in',records.map(r=>r.id)]],}];this._searchCreatePopup("search",false,{},dynamicFilters);}},});if(BarcodeScanner.isBarcodeScannerSupported()){field_registry.add('many2one_barcode',FieldMany2OneBarcode);}
return FieldMany2OneBarcode;});;

/* /web_enterprise/static/src/legacy/js/views/basic/basic_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.BasicRenderer',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const BasicRenderer=require('web.BasicRenderer');BasicRenderer.include({SHOW_AFTER_DELAY:250,init(){this._super(...arguments);this.showTimer=undefined;this.tooltipNodes=[];this._onTouchStartTooltipBind=this._onTouchStartTooltip.bind(this);this._onTouchEndTooltipBind=this._onTouchEndTooltip.bind(this);},on_attach_callback(){this._super(...arguments);this._addListener();},on_detach_callback(){this._removeListeners();this._super(...arguments);},_addListener:function(){this.tooltipNodes.forEach((nodeElement)=>{nodeElement.addEventListener('touchstart',this._onTouchStartTooltipBind);nodeElement.addEventListener('touchend',this._onTouchEndTooltipBind);nodeElement.classList.add('o_user_select_none');});},_addFieldTooltip:function(widget,$node){this._super(...arguments);$node=$node.length?$node:widget.$el;const nodeElement=$node[0];if(!this.tooltipNodes.some(node=>node===nodeElement)){this.tooltipNodes.push(nodeElement);}},_getTooltipOptions:function(){return Object.assign({},this._super(...arguments),{trigger:'manual',});},_render:function(){return this._super(...arguments).then(()=>{this._addListener();});},_removeListeners:function(){while(this.tooltipNodes.length){const node=this.tooltipNodes.shift();node.removeEventListener('touchstart',this._onTouchStartTooltipBind);node.removeEventListener('touchend',this._onTouchEndTooltipBind);node.classList.remove('o_user_select_none');}},_onTouchEndTooltip:function(event){clearTimeout(this.showTimer);const $node=$(event.target);$node.tooltip('hide');},_onTouchStartTooltip:function(event){if(!event.target.classList.contains('o_user_select_none')){return;}
const $node=$(event.target);clearTimeout(this.showTimer);this.showTimer=setTimeout(()=>{$node.tooltip('show');},this.SHOW_AFTER_DELAY);},});});;

/* /web_enterprise/static/src/legacy/js/views/calendar/calendar_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.CalendarController',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const CalendarController=require('web.CalendarController');CalendarController.include({custom_events:_.extend({},CalendarController.prototype.custom_events,{today_button_click:'_onTodayButtonClicked',}),_onTodayButtonClicked:function(){this._move('today');},_renderButtonsParameters:function(){return _.extend({},this._super.apply(this,arguments),{isMobile:config.device.isMobile,});},});});;

/* /web_enterprise/static/src/legacy/js/views/calendar/calendar_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.CalendarRenderer',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const{qweb}=require('web.core');const CalendarRenderer=require('web.CalendarRenderer');CalendarRenderer.include({events:_.extend({},CalendarRenderer.events,{'click .o_other_calendar_panel':'_toggleSidePanel',}),init:function(parent,state,params){this._super.apply(this,arguments);this.isSwipeEnabled=true;this.isSidePanelVisible=false;this.filtersMobile=[];},on_attach_callback:function(){this.$el.height($(window).height()-this.$el.offset().top);this._super(...arguments);},start:function(){const promise=this._super();this._bindSwipe();return promise;},_bindSwipe:function(){const self=this;let touchStartX;let touchEndX;this.calendarElement.addEventListener('touchstart',function(event){self.isSwipeEnabled=true;touchStartX=event.touches[0].pageX;});this.calendarElement.addEventListener('touchend',function(event){if(!self.isSwipeEnabled){return;}
touchEndX=event.changedTouches[0].pageX;if(touchStartX-touchEndX>100){self.trigger_up('next');}else if(touchStartX-touchEndX<-100){self.trigger_up('prev');}});},_getFilters:function(){const filters=this.state.filters;return Object.keys(filters).filter(key=>filters[key].filters).map(key=>({label:filters[key].title,values:this._prepareDataFilterForQWeb(filters[key].filters),countItems:filters[key].filters.length,}));},_getFullCalendarOptions:function(){const oldOptions=this._super(...arguments);oldOptions.views.dayGridMonth.columnHeaderFormat='ddd';oldOptions.weekNumbersWithinDays=false;oldOptions.views.dayGridMonth.weekLabel='';const oldEventDragStart=oldOptions.eventDragStart;const oldEventPositioned=oldOptions.eventPositioned;const oldEventRender=oldOptions.eventRender;const oldEventResize=oldOptions.eventResize;const oldEventResizeStart=oldOptions.eventResizeStart;const oldSelectAllow=oldOptions.selectAllow;const oldSelect=oldOptions.select;oldOptions.eventDragStart=(info)=>{this.isSwipeEnabled=false;if(oldEventDragStart){oldEventDragStart.call(this.calendar,info);}};oldOptions.eventPositioned=(info)=>{this.isSwipeEnabled=false;if(oldEventPositioned){oldEventPositioned.call(this.calendar,info);}};oldOptions.eventRender=(info)=>{this.isSwipeEnabled=false;if(oldEventRender){oldEventRender.call(this.calendar,info);}};oldOptions.eventResize=(eventResizeInfo)=>{this.isSwipeEnabled=false;if(oldEventResize){oldEventResize.call(this.calendar,eventResizeInfo);}};oldOptions.eventResizeStart=(mouseResizeInfo)=>{this.isSwipeEnabled=false;if(oldEventResizeStart){oldEventResizeStart.call(this.calendar,mouseResizeInfo);}};oldOptions.selectAllow=(selectInfo)=>{this.isSwipeEnabled=false;if(oldSelectAllow){return oldSelectAllow.call(this.calendar,selectInfo);}
return true;};oldOptions.select=(selectionInfo)=>{selectionInfo.jsEvent.isSelectiong=true;if(oldSelect){return oldSelect.call(this.calendar,selectionInfo);}};oldOptions.dateClick=(dateClickInfo)=>{if(dateClickInfo.jsEvent.isSelectiong){return;}
if(dateClickInfo.view.type===this.scalesInfo.month){this.trigger_up('changeDate',{date:moment(dateClickInfo.date),scale:'day',});return;}
const data={start:dateClickInfo.date,allDay:dateClickInfo.allDay};this._preOpenCreate(data);};oldOptions.yearDateClick=(yearDateClickInfo)=>{this.trigger_up('changeDate',{date:moment(yearDateClickInfo.date),scale:'day',});};return oldOptions;},_getPopoverParams:function(eventData){const popoverParameters=this._super.apply(this,arguments);popoverParameters.container='body';return popoverParameters;},_onPopoverShown:function($popoverElement,calendarPopover){this._super.apply(this,arguments);const $popover=$($popoverElement.data('bs.popover').tip);setTimeout(()=>{$popover.toggleClass(['bs-popover-left','bs-popover-right',],false);$popover.find('.arrow').remove();$popover.css({display:'flex',bottom:0,right:0,borderWidth:0,maxWidth:'100%',transform:'translate3d(0px, 0px, 0px)',});$popover.find('.o_cw_body').css({display:'flex',flex:'1 0 auto',flexDirection:'column',});$popover.find('.o_cw_popover_fields_secondary').toggleClass('o_cw_popover_fields_secondary',false).css({flexGrow:1,});$popover.on('touchmove',(event)=>{event.preventDefault();});$popover.on('mousewheel',(event)=>{event.preventDefault();});$popover.on('wheel',(event)=>{event.preventDefault();});$popover.find('a.o_field_widget[href]').on('click',(event)=>{$('.o_cw_popover').popover('dispose');});},0);},_prepareDataFilterForQWeb:function(array){const self=this;return array.filter(element=>element.active).map(function(element){return Object.assign({},element,{color:self.getColor(element.color_index),});});},async _renderView(){return this._super(...arguments).then(()=>{this.$('.o_calendar_mini').toggleClass('d-none',true);this._renderOtherCalendar();});},_renderFilters:function(){return this._super(...arguments).then(()=>{this.filtersMobile=this._getFilters();const reduce=!!this.filtersMobile.reduce((visible,filter)=>visible|(filter.countItems>0),false);this.$('.o_calendar_sidebar .o_view_nocontent').toggleClass('d-none',reduce);});},_renderOtherCalendar:function(){this.$('.o_other_calendar_panel').remove();this.otherCalendarMobile=$(qweb.render('CalendarView.OtherCalendarMobile',{filters:this.filtersMobile,isSidePanelVisible:this.isSidePanelVisible,}));this.$el.prepend(this.otherCalendarMobile);},_toggleSidePanel:async function(){this.isSidePanelVisible=!this.isSidePanelVisible;this.$('.o_calendar_view').toggleClass('d-none',this.isSidePanelVisible);this.$('.o_calendar_sidebar_container').toggleClass('d-none',!this.isSidePanelVisible);this._renderOtherCalendar();},_unselectEvent:function(){this._super.apply(this,arguments);$('.o_cw_popover').popover('dispose');},});});;

/* /web_enterprise/static/src/legacy/js/views/form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.MobileFormRenderer',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const core=require('web.core');const FormRenderer=require('web.FormRenderer');const qweb=core.qweb;FormRenderer.include({updateState:function(){this.isStatusbarButtonsDropdownOpen=undefined;return this._super(...arguments);},_renderStatusbarButtons:function(buttons){const $visibleButtons=buttons.filter(button=>{return!($(button).hasClass('o_invisible_modifier')||(this.mode==='edit'&&$(button).hasClass('oe_read_only')));});if($visibleButtons.length>1){const $statusbarButtonsDropdown=$(qweb.render('StatusbarButtonsDropdown',{open:this.isStatusbarButtonsDropdownOpen,}));$statusbarButtonsDropdown.find('.btn-group').on('show.bs.dropdown',()=>{this.isStatusbarButtonsDropdownOpen=true;});$statusbarButtonsDropdown.find('.btn-group').on('hide.bs.dropdown',()=>{this.isStatusbarButtonsDropdownOpen=false;});const $dropdownMenu=$statusbarButtonsDropdown.find('.dropdown-menu');buttons.forEach(button=>{const dropdownButton=$(button).addClass('dropdown-item');return $dropdownMenu.append(dropdownButton);});return $statusbarButtonsDropdown;}
buttons.forEach(button=>$(button).removeClass('dropdown-item'));return this._super.apply(this,arguments);},_updateAllModifiers:function(){return this._super.apply(this,arguments).then(()=>{const $statusbarButtonsContainer=this.$('.o_statusbar_buttons');const $statusbarButtons=$statusbarButtonsContainer.find('button.btn').toArray();$statusbarButtonsContainer.replaceWith(this._renderStatusbarButtons($statusbarButtons));});},});});;

/* /web_enterprise/static/src/legacy/js/views/form_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.FormView',function(require){"use strict";var config=require('web.config');var FormView=require('web.FormView');var QuickCreateFormView=require('web.QuickCreateFormView');FormView.include({init:function(){this._super.apply(this,arguments);if(config.device.isMobile){this.controllerParams.disableAutofocus=true;}},});QuickCreateFormView.include({init:function(){this._super.apply(this,arguments);this.controllerParams.disableAutofocus=false;},});});;

/* /web_enterprise/static/src/legacy/js/views/kanban/kanban_column.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanColumnMobile',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const KanbanColumn=require('web.KanbanColumn');KanbanColumn.include({init(){this._super(...arguments);this.recordsDraggable=false;this.canBeFolded=false;},});});;

/* /web_enterprise/static/src/legacy/js/views/kanban/kanban_column_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.kanban_column_quick_create',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const KanbanRenderer=require('web.kanban_column_quick_create');KanbanRenderer.include({init(){this._super(...arguments);this.isMobile=true;},_cancel(){if(!this.folded){this.$input.val('');}},});});;

/* /web_enterprise/static/src/legacy/js/views/kanban/kanban_renderer_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanRendererMobile',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var KanbanRenderer=require('web.KanbanRenderer');var KanbanTabsMobileMixin=require('web.KanbanTabsMobileMixin');var _t=core._t;var qweb=core.qweb;KanbanRenderer.include(Object.assign({},KanbanTabsMobileMixin,{custom_events:_.extend({},KanbanRenderer.prototype.custom_events||{},{quick_create_column_created:'_onColumnAdded',}),events:_.extend({},KanbanRenderer.prototype.events,{'click .o_kanban_mobile_tab':'_onMobileTabClicked','click .o_kanban_mobile_add_column':'_onMobileQuickCreateClicked',}),ANIMATE:true,init:function(){this._super.apply(this,arguments);this.activeColumnIndex=0;this._lastGroupedByField=null;this._scrollPosition=null;},on_attach_callback:function(){if(this._scrollPosition&&this.state.groupedBy.length&&this.widgets.length){var $column=this.widgets[this.activeColumnIndex].$el;$column.scrollLeft(this._scrollPosition.left);$column.scrollTop(this._scrollPosition.top);}
this._computeTabPosition(this.widgets,this.activeColumnIndex,this.$('.o_kanban_mobile_tabs'));this._super.apply(this,arguments);},on_detach_callback:function(){if(this.state.groupedBy.length&&this.widgets.length){var $column=this.widgets[this.activeColumnIndex].$el;this._scrollPosition={left:$column.scrollLeft(),top:$column.scrollTop(),};}else{this._scrollPosition=null;}
this._super.apply(this,arguments);},addQuickCreate:function(){if(this._canCreateColumn()&&!this.quickCreate.folded){this._onMobileQuickCreateClicked();}
return this.widgets[this.activeColumnIndex].addQuickCreate();},updateColumn:function(localID){var index=_.findIndex(this.widgets,{db_id:localID});var $column=this.widgets[index].$el;var scrollTop=$column.scrollTop();return this._super.apply(this,arguments).then(()=>this._layoutUpdate(false)).then(()=>$column.scrollTop(scrollTop));},_canCreateColumn:function(){return this.quickCreateEnabled&&this.quickCreate&&this.widgets.length;},_computeColumnPosition:function(animate){if(this.widgets.length){const rtl=_t.database.parameters.direction==='rtl';this.$('.o_kanban_group').show();const $columnAfter=this._toNode(this.widgets.filter((widget,index)=>index>this.activeColumnIndex));const promiseAfter=this._updateColumnCss($columnAfter,rtl?{right:'100%'}:{left:'100%'},animate);const $columnBefore=this._toNode(this.widgets.filter((widget,index)=>index<this.activeColumnIndex));const promiseBefore=this._updateColumnCss($columnBefore,rtl?{right:'-100%'}:{left:'-100%'},animate);const $columnCurrent=this._toNode(this.widgets.filter((widget,index)=>index===this.activeColumnIndex));const promiseCurrent=this._updateColumnCss($columnCurrent,rtl?{right:'0%'}:{left:'0%'},animate);promiseAfter.then(promiseBefore).then(promiseCurrent).then(()=>{$columnAfter.hide();$columnBefore.hide();});}},_computeCurrentColumn:function(){if(this.widgets.length){var column=this.widgets[this.activeColumnIndex];if(!column){return;}
var columnID=column.id||column.db_id;this.$('.o_kanban_mobile_tab.o_current, .o_kanban_group.o_current').removeClass('o_current');this.$('.o_kanban_group[data-id="'+columnID+'"], '+'.o_kanban_mobile_tab[data-id="'+columnID+'"]').addClass('o_current');}},_enableSwipe:function(){var self=this;var step=_t.database.parameters.direction==='rtl'?-1:1;this.$el.swipe({excludedElements:".o_kanban_mobile_tabs",swipeLeft:function(){var moveToIndex=self.activeColumnIndex+step;if(moveToIndex<self.widgets.length){self._moveToGroup(moveToIndex,self.ANIMATE);}},swipeRight:function(){var moveToIndex=self.activeColumnIndex-step;if(moveToIndex>-1){self._moveToGroup(moveToIndex,self.ANIMATE);}}});},_getTabWidth:function(column){var columnID=column.id||column.db_id;return this.$('.o_kanban_mobile_tab[data-id="'+columnID+'"]').outerWidth();},_layoutUpdate:function(animate){this._computeCurrentColumn();this._computeTabPosition(this.widgets,this.activeColumnIndex,this.$('.o_kanban_mobile_tabs'));this._computeColumnPosition(animate);},_moveToGroup:function(moveToIndex,animate){if(moveToIndex<0||moveToIndex>=this.widgets.length){this._layoutUpdate(animate);return Promise.resolve();}
this.activeColumnIndex=moveToIndex;this._lastGroupedByField=this.columnOptions.groupedBy;var column=this.widgets[this.activeColumnIndex];if(column.data.isOpen){this._layoutUpdate(animate);}else{this.trigger_up('column_toggle_fold',{db_id:column.db_id,onSuccess:()=>this._layoutUpdate(animate)});}
this._enableSwipe();return Promise.resolve();},_renderExampleBackground:function(){},_renderGrouped:function(fragment){var self=this;var newFragment=document.createDocumentFragment();this._super.apply(this,[newFragment]);this.defs.push(Promise.all(this.defs).then(function(){var data=[];_.each(self.state.data,function(group){if(!group.value){group=_.extend({},group,{value:_t('Undefined')});data.unshift(group);}else{data.push(group);}});var kanbanColumnContainer=document.createElement('div');kanbanColumnContainer.classList.add('o_kanban_columns_content');kanbanColumnContainer.appendChild(newFragment);fragment.appendChild(kanbanColumnContainer);if(data.length){$(qweb.render('KanbanView.MobileTabs',{data:data,quickCreateEnabled:self._canCreateColumn()})).prependTo(fragment);}}));},_renderView:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.state.groupedBy.length){if(self._lastGroupedByField!==self.columnOptions.groupedBy){self.activeColumnIndex=0;}
return self._moveToGroup(self.activeColumnIndex);}else{if(self._canCreateColumn()){self._onMobileQuickCreateClicked();}
return Promise.resolve();}});},_toNode:function(widgets){const selectorCss=widgets.map(widget=>'.o_kanban_group[data-id="'+(widget.id||widget.db_id)+'"]').join(', ');return this.$(selectorCss);},_updateColumnCss:function($column,cssProperties,animate){if(animate){return new Promise(resolve=>$column.animate(cssProperties,'fast',resolve));}else{$column.css(cssProperties);return Promise.resolve();}},_onColumnAdded:function(){this._computeTabPosition(this.widgets,this.activeColumnIndex,this.$('.o_kanban_mobile_tabs'));if(this._canCreateColumn()&&!this.quickCreate.folded){this.quickCreate.toggleFold();}},_onMobileQuickCreateClicked:function(){this.$('.o_kanban_group').toggle();this.quickCreate.toggleFold();},_onMobileTabClicked:function(event){if(this._canCreateColumn()&&!this.quickCreate.folded){this.quickCreate.toggleFold();}
this._moveToGroup($(event.currentTarget).index(),true);},}));});;

/* /web_enterprise/static/src/legacy/js/views/kanban/kanban_tabs_mobile_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanTabsMobileMixin',function(){"use strict";const KanbanTabsMobileMixin={_computeTabPosition(tabs,moveToIndex,$tabsContainer){this._computeTabJustification(tabs,$tabsContainer);this._computeTabScrollPosition(tabs,moveToIndex,$tabsContainer);},_computeTabScrollPosition(tabs,moveToIndex,$tabsContainer){if(tabs.length){const lastItemIndex=tabs.length-1;let scrollToLeft=0;for(let i=0;i<moveToIndex;i++){const columnWidth=this._getTabWidth(tabs[i]);if(moveToIndex!==lastItemIndex&&i===moveToIndex-1){const partialWidth=0.75;scrollToLeft+=columnWidth*partialWidth;}else{scrollToLeft+=columnWidth;}}
$tabsContainer.scrollLeft(scrollToLeft);}},_computeTabJustification(tabs,$tabsContainer){if(tabs.length){const widthChilds=tabs.reduce((total,column)=>total+this._getTabWidth(column),0);$tabsContainer.toggleClass('justify-content-between',$tabsContainer.outerWidth()>=widthChilds);}},_getTabWidth(tab){}};return KanbanTabsMobileMixin;});;

/* /web_enterprise/static/src/legacy/js/views/kanban/kanban_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanViewMobile',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const KanbanView=require('web.KanbanView');KanbanView.include({init(){this._super(...arguments);this.jsLibs.push('/web/static/lib/jquery.touchSwipe/jquery.touchSwipe.js');},});});;

/* /web_enterprise/static/src/legacy/js/views/list/list_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.ListControllerMobile',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const ListController=require('web.ListController');ListController.include({events:Object.assign({},ListController.prototype.events,{'click .o_discard_selection':'_onDiscardSelection'}),renderButtons(){this._super(...arguments);this.$buttons.find('.o_list_export_xlsx').hide();},updateButtons(){this._super(...arguments);this.$buttons.find('.o_list_export_xlsx').hide();},async updateControlPanel(){const value=await this._super(...arguments);const displayBanner=Boolean(this.$selectionBox);if(displayBanner){this._controlPanelWrapper.el.querySelector('.o_cp_bottom').prepend(this.$selectionBox[0]);}
return value;},_onDiscardSelection(){this.renderer.$('tbody .o_list_record_selector input:not(":disabled")').prop('checked',false);this.renderer._updateSelection();}});});;

/* /web_enterprise/static/src/legacy/js/views/list/list_renderer_desktop.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.ListRenderer',function(require){"use strict";const config=require('web.config');if(config.device.isMobile){return;}
const{qweb}=require('web.core');const ListRenderer=require('web.ListRenderer');const ListView=require('web.ListView');const session=require('web.session');const{patch}=require('web.utils');const PromoteStudioDialog=require('web_enterprise.PromoteStudioDialog');patch(ListView.prototype,'web_enterprise.ListView',{init:function(viewInfo,params){this._super(viewInfo,params);this.rendererParams.isStudioEditable=params.action&&!!params.action.xml_id;},});patch(ListRenderer.prototype,'web_enterprise.ListRenderer',{init:function(parent,state,params){this._super(...arguments);this.isStudioEditable=params.isStudioEditable;},_renderOptionalColumnsDropdown:function(){const $optionalColumnsDropdown=this._super(...arguments);if(session.is_system&&this.isStudioEditable){const $dropdownMenu=$optionalColumnsDropdown.find('.dropdown-menu');if(this.optionalColumns.length){$dropdownMenu.append($("<hr />"));}
const $addCustomField=$(qweb.render('web_enterprise.open_studio_button'));$dropdownMenu.append($addCustomField);$addCustomField.click(this._onAddCustomFieldClick.bind(this));}
return $optionalColumnsDropdown;},_shouldRenderOptionalColumnsDropdown:function(){return this._super(...arguments)||session.is_system;},_onAddCustomFieldClick:function(event){event.stopPropagation();new PromoteStudioDialog(this).open();},});});;

/* /web_enterprise/static/src/legacy/js/views/list/list_renderer_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.MobileListRenderer',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const ListRenderer=require('web.ListRenderer');ListRenderer.include({events:Object.assign({},ListRenderer.prototype.events,{'touchstart .o_data_row':'_onTouchStartSelectionMode','touchmove .o_data_row':'_onTouchMoveSelectionMode','touchend .o_data_row':'_onTouchEndSelectionMode',}),init(){this._super(...arguments);this.longTouchTimer=null;this.LONG_TOUCH_THRESHOLD=400;},isEditable(){return this.editable;},_getSelectableRecordCheckboxes(){return this.$('tbody .o_list_record_selector input:not(:disabled)');},_isRecordEditable(){return this.editable;},_resetLongTouchTimer(){if(this.longTouchTimer){clearTimeout(this.longTouchTimer);this.longTouchTimer=null;}},_updateSelection(){this._super(...arguments);this._getSelectableRecordCheckboxes().each((index,input)=>{$(input).closest('.o_data_row').toggleClass('o_data_row_selected',input.checked);});},_onRowClicked(ev){if(this.selection.length){ev.preventDefault();return;}
this._super(...arguments);},_onTouchEndSelectionMode(){const elapsedTime=Date.now()-this.touchStartMs;if(elapsedTime<this.LONG_TOUCH_THRESHOLD){this._resetLongTouchTimer();}},_onTouchMoveSelectionMode(){this._resetLongTouchTimer();},_onTouchStartSelectionMode(ev){if(this.selection.length){ev.preventDefault();$(ev.currentTarget).find('.o_list_record_selector').click();return;}
this.touchStartMs=Date.now();if(this.longTouchTimer===null){this.longTouchTimer=setTimeout(()=>{$(ev.currentTarget).find('.o_list_record_selector').click();this._resetLongTouchTimer();},this.LONG_TOUCH_THRESHOLD);}},});});;

/* /web_enterprise/static/src/legacy/js/views/relational_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.relational_fields',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var relational_fields=require('web.relational_fields');var FieldStatus=relational_fields.FieldStatus;var FieldMany2One=relational_fields.FieldMany2One;var FieldX2Many=relational_fields.FieldX2Many;var qweb=core.qweb;FieldStatus.include({isEmpty:function(){return!this.isSet();},_render:function(){this.$el.html(qweb.render("FieldStatus.content.mobile",{selection:this.status_information,status:_.findWhere(this.status_information,{selected:true}),clickable:this.isClickable,}));},});FieldMany2One.include({start:function(){var superRes=this._super.apply(this,arguments);this.$input.prop('readonly',true);return superRes;},_bindAutoComplete:function(){},_getSearchCreatePopupOptions:function(){var self=this;var searchCreatePopupOptions=this._super.apply(this,arguments);_.extend(searchCreatePopupOptions,{selectionMode:true,on_clear:function(){self.reinitialize(false);},});return searchCreatePopupOptions;},_toggleAutoComplete:function(){this._searchCreatePopup("search");},});FieldX2Many.include({_renderButtons:function(){var result=this._super.apply(this,arguments);if(this.$buttons){this.$buttons.find('.btn-secondary').removeClass('btn-secondary').addClass('btn-primary btn-add-record');}
return result;}});});;

/* /web_enterprise/static/src/legacy/js/views/upgrade_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.upgrade_widgets',function(require){"use strict";var basic_fields=require('web.basic_fields');var field_registry=require('web.field_registry');var relational_fields=require('web.relational_fields');var UpgradeBoolean=basic_fields.FieldBoolean.extend({renderWithLabel:function(){},});var UpgradeRadio=relational_fields.FieldRadio.extend({});field_registry.add('upgrade_boolean',UpgradeBoolean).add('upgrade_radio',UpgradeRadio);});;

/* /web_enterprise/static/src/legacy/js/views/view_dialogs.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.view_dialogs',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var view_dialogs=require('web.view_dialogs');var _t=core._t;view_dialogs.FormViewDialog.include({init(parent,options){options.headerButtons=options.headerButtons||[];this._super.apply(this,arguments);},_setRemoveButtonOption(options,btnClasses){options.headerButtons.push({text:_t("Remove"),classes:`btn-secondary ${btnClasses}`,click:async()=>{await this._remove();this.close();},});},});view_dialogs.SelectCreateDialog.include({init:function(){this._super.apply(this,arguments);this.on_clear=this.options.on_clear||(function(){});this.viewType='kanban';},_prepareButtons:function(){this._super.apply(this,arguments);if(this.options.disable_multiple_selection){if(this.options.selectionMode){this.headerButtons.push({text:_t("Clear"),classes:'btn-secondary o_clear_button',close:true,click:function(){this.on_clear();},});}}else{this.__buttons=this.__buttons.filter(button=>!button.classes.split(' ').includes('o_select_button'));}},});});;

/* /web_enterprise/static/src/legacy/js/widgets/promote_studio_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.PromoteStudioDialog',function(require){"use strict";const core=require('web.core');const Dialog=require('web.Dialog');const framework=require('web.framework');const localStorage=require('web.local_storage');const qweb=core.qweb;const PromoteStudioDialog=Dialog.extend({events:_.extend({},Dialog.prototype.events,{'click button.o_install_studio':'_onInstallStudio',}),init:function(parent,options){options=_.defaults(options||{},{$content:$(qweb.render('web_enterprise.install_web_studio')),renderHeader:false,renderFooter:false,size:'large',});this._super(parent,options);},start:async function(){await this._super.apply(this,arguments);core.bus.on('click',this,this._onWindowClick);},_onInstallStudio:async function(event){event.stopPropagation();this.disableClick=true;framework.blockUI();const modules=await this._rpc({model:'ir.module.module',method:'search_read',fields:['id'],domain:[['name','=','web_studio']],});await this._rpc({model:'ir.module.module',method:'button_immediate_install',args:[[modules[0].id]],});framework.blockUI();localStorage.setItem('openStudioOnReload','main');this._reloadPage();},_onWindowClick:function(event){const $modal=$(event.target).closest('.modal-studio');if(!$modal.length&&!this.disableClick){this._onCloseDialog(event);}
event.stopPropagation();},_reloadPage:function(){window.location.reload();},});return PromoteStudioDialog;});;

/* /web_enterprise/static/src/legacy/legacy_service_provider.js defined in bundle 'web.assets_backend' */
odoo.define('@web_enterprise/legacy/legacy_service_provider',async function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const legacyServiceProvider=__exports.legacyServiceProvider={dependencies:["home_menu"],start({services}){browser.addEventListener("show-home-menu",()=>{services.home_menu.toggle(true);});},};registry.category("services").add("enterprise_legacy_service_provider",legacyServiceProvider);return __exports;});;

/* /documents_spreadsheet/static/src/actions/abstract_spreadsheet_action.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/actions/abstract_spreadsheet_action',async function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{loadAssets}=require("@web/core/assets");const{UNTITLED_SPREADSHEET_NAME}=require("@documents_spreadsheet/constants");const{useState}=owl.hooks;const AbstractSpreadsheetAction=__exports.AbstractSpreadsheetAction=class AbstractSpreadsheetAction extends owl.Component{setup(){const params=this.props.action.params;this.resId=params.spreadsheet_id||params.active_id;this.router=useService("router");this.actionService=useService("action");this.notifications=useService("notification");this.state=useState({spreadsheetName:UNTITLED_SPREADSHEET_NAME,});this.initCallback=this.props.state?undefined:this.props.action.params.initCallback;}
async willStart(){const assets=loadAssets({jsLibs:["/web/static/lib/Chart/Chart.js"],});const record=await this.service.fetchData(this.resId);this._loadData(record);await assets;}
mounted(){this.router.pushState({spreadsheet_id:this.resId});this.trigger("controller-title-updated",this.state.spreadsheetName);}
async _onMakeCopy(ev){const id=await this.service.copy(this.resId,ev.detail);this._openSpreadsheet(id);}
async _onNewSpreadsheet(){const id=await this.service.createEmpty();this._openSpreadsheet(id);}
async _onSpreadsheetSaved(ev){const{data,thumbnail}=ev.detail;this.service.save(this.resId,{data,thumbnail});}
_onSpreadSheetNameChanged(ev){const{name}=ev.detail;this.state.spreadsheetName=name;this.trigger("controller-title-updated",this.state.spreadsheetName);return this.service.saveName(this.resId,name);}
_openSpreadsheet(spreadsheet_id){this.notifications.add(this.notificationMessage,{type:"info",sticky:false,});this.actionService.doAction({type:"ir.actions.client",tag:this.props.action.tag,params:{spreadsheet_id},},{clear_breadcrumbs:true});}}
return __exports;});;

/* /documents_spreadsheet/static/src/actions/control_panel/spreadsheet_control_panel.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/actions/control_panel/spreadsheet_control_panel',async function(require){'use strict';let __exports={};const{ControlPanel}=require("@web/search/control_panel/control_panel");const{SpreadsheetName}=require("@documents_spreadsheet/actions/control_panel/spreadsheet_name");const{useService}=require("@web/core/utils/hooks");const{Component,hooks}=owl;const{useSubEnv}=hooks;const SpreadsheetControlPanel=__exports.SpreadsheetControlPanel=class SpreadsheetControlPanel extends Component{constructor(){super(...arguments);this.controlPanelDisplay={"bottom-left":false,"bottom-right":false,}
this.actionService=useService("action");}
onBreadcrumbClicked(jsId){this.actionService.restore(jsId);}
_toggleFavorited(){this.trigger("favorite-toggled");}}
SpreadsheetControlPanel.template="documents_spreadsheet.SpreadsheetControlPanel";SpreadsheetControlPanel.components={ControlPanel,SpreadsheetName,};SpreadsheetControlPanel.props={spreadsheetName:String,isFavorited:{type:Boolean,optional:true},isSpreadsheetSynced:{type:Boolean,optional:true},numberOfConnectedUsers:{type:Number,optional:true},isReadonly:{type:Boolean,optional:true},};return __exports;});;

/* /documents_spreadsheet/static/src/actions/control_panel/spreadsheet_name.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/actions/control_panel/spreadsheet_name',async function(require){'use strict';let __exports={};const{UNTITLED_SPREADSHEET_NAME}=require("@documents_spreadsheet/constants");const{useState,useRef}=owl.hooks;const WIDTH_MARGIN=3;const PADDING_RIGHT=5;const PADDING_LEFT=PADDING_RIGHT-WIDTH_MARGIN;const SpreadsheetName=__exports.SpreadsheetName=class SpreadsheetName extends owl.Component{constructor(){super(...arguments);this.placeholder=UNTITLED_SPREADSHEET_NAME;this.state=useState({inputSize:1,isUntitled:this._isUntitled(this.props.name),});this.input=useRef("speadsheetNameInput");}
mounted(){this._setInputSize(this.props.name);}
_setInputSize(text){const{fontFamily,fontSize}=window.getComputedStyle(this.input.el);const font=`${fontSize} ${fontFamily}`;this.state.inputSize=this._computeTextWidth(text||this.placeholder,font)+
PADDING_RIGHT+
PADDING_LEFT;}
_computeTextWidth(text,font){const canvas=document.createElement("canvas");const context=canvas.getContext("2d");context.font=font;const width=context.measureText(text).width;return Math.ceil(width)+WIDTH_MARGIN;}
_isUntitled(name){name=name.trim();return!name||name===UNTITLED_SPREADSHEET_NAME.toString();}
_onFocus(ev){if(this._isUntitled(ev.target.value)){ev.target.value=this.placeholder;ev.target.select();}}
_onInput(ev){const value=ev.target.value;this.state.isUntitled=this._isUntitled(value);this._setInputSize(value);}
_onNameChanged(ev){const value=ev.target.value.trim();ev.target.value=value;this._setInputSize(value);this.trigger("spreadsheet-name-changed",{name:value,});ev.target.blur();}}
SpreadsheetName.template="documents_spreadsheet.SpreadsheetName";SpreadsheetName.props={name:String,isReadonly:Boolean};return __exports;});;

/* /documents_spreadsheet/static/src/actions/spreadsheet/spreadsheet_action.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/actions/spreadsheet/spreadsheet_action',async function(require){'use strict';let __exports={};const SpreadsheetComponent=require("documents_spreadsheet.SpreadsheetComponent");const SpreadsheetCollaborativeChannel=require("@documents_spreadsheet/js/collaborative/spreadsheet_collaborative_channel")[Symbol.for("default")]
const{SpreadsheetControlPanel}=require("@documents_spreadsheet/actions/control_panel/spreadsheet_control_panel");const{SpreadsheetName}=require("@documents_spreadsheet/actions/control_panel/spreadsheet_name");const{download}=require("@web/core/network/download");const{useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{AbstractSpreadsheetAction}=require("@documents_spreadsheet/actions/abstract_spreadsheet_action");const{UNTITLED_SPREADSHEET_NAME}=require("@documents_spreadsheet/constants");const{useState,useRef}=owl.hooks;const SpreadsheetAction=__exports.SpreadsheetAction=class SpreadsheetAction extends AbstractSpreadsheetAction{setup(){super.setup();this.orm=useService("orm");this.service=useService("spreadsheet");this.actionService=useService("action");this.spreadsheetRef=useRef("spreadsheet");this.notificationMessage=this.env._t("New spreadsheet created in Documents");if(this.props.action.params.transportService){this.transportService=this.props.action.params.transportService;}else if(owl.Component.env.services.bus_service){this.transportService=new SpreadsheetCollaborativeChannel(owl.Component.env,this.resId);}
this.state=useState({numberOfConnectedUsers:1,isSynced:true,isFavorited:false,spreadsheetName:UNTITLED_SPREADSHEET_NAME,});}
_loadData(record){this.state.isFavorited=record.is_favorited;this.spreadsheetData=JSON.parse(record.raw);this.stateUpdateMessages=record.revisions;this.snapshotRequested=record.snapshot_requested;this.state.spreadsheetName=record.name;this.isReadonly=record.isReadonly;}
async _onDownload(ev){await download({url:"/documents/xlsx",data:{zip_name:`${ev.detail.name}.xlsx`,files:JSON.stringify(ev.detail.files),},});}
_onSpreadSheetFavoriteToggled(ev){this.state.isFavorited=!this.state.isFavorited
return this.orm.call("documents.document","toggle_favorited",[[this.resId]]);}
_onSpreadsheetSyncStatus(ev){this.state.isSynced=ev.detail.synced;this.state.numberOfConnectedUsers=ev.detail.numberOfConnectedUsers;}
_onUnexpectedRevisionId(){this.actionService.doAction("reload_context");}}
SpreadsheetAction.template="documents_spreadsheet.SpreadsheetAction";SpreadsheetAction.components={SpreadsheetComponent,SpreadsheetControlPanel,SpreadsheetName};registry.category("actions").add("action_open_spreadsheet",SpreadsheetAction);return __exports;});;

/* /documents_spreadsheet/static/src/actions/spreadsheet/spreadsheet_service.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/actions/spreadsheet/spreadsheet_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{sprintf}=require("@web/core/utils/strings");const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{buildViewLink}=require("@documents_spreadsheet/js/o_spreadsheet/registries/odoo_menu_link_cell");const{createEmptySpreadsheet}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/helpers");const{UNTITLED_SPREADSHEET_NAME}=require("@documents_spreadsheet/constants");const{markdownLink}=spreadsheet.helpers;function getInsertMenuCallback(isEmptySpreadsheet,actionToLink){return(model)=>{if(!isEmptySpreadsheet){const sheetId=model.uuidGenerator.uuidv4();const sheetIdFrom=model.getters.getActiveSheetId();model.dispatch("CREATE_SHEET",{sheetId,position:model.getters.getVisibleSheets().length,});model.dispatch("ACTIVATE_SHEET",{sheetIdFrom,sheetIdTo:sheetId});}
const viewLink=buildViewLink(actionToLink);model.dispatch("UPDATE_CELL",{sheetId:model.getters.getActiveSheetId(),content:markdownLink(actionToLink.name,viewLink),col:0,row:0,});};}
class SpreadsheetService{constructor(env,{orm,notification,action}){this.env=env;this.orm=orm;this.action=action;this.notification=notification;}
async copy(documentId,{data,thumbnail}){const defaultValues={mimetype:"application/o-spreadsheet",raw:JSON.stringify(data),spreadsheet_snapshot:false,thumbnail,};return this.orm.call("documents.document","copy",[documentId],{default:defaultValues,});}
async createEmpty(){const data={name:UNTITLED_SPREADSHEET_NAME,mimetype:"application/o-spreadsheet",raw:"{}",handler:"spreadsheet",};return this.orm.create("documents.document",data);}
async save(documentId,{data,thumbnail}){await this.orm.write("documents.document",[documentId],{thumbnail,raw:JSON.stringify(data),mimetype:"application/o-spreadsheet",});}
async saveName(documentId,name){await this.orm.write("documents.document",[documentId],{name});}
async fetchData(documentId){return this.orm.call("documents.document","join_spreadsheet_session",[documentId]);}
async insertInSpreadsheet(spreadsheet,actionToLink){let documentId;let notificationMessage;if(!spreadsheet){documentId=await createEmptySpreadsheet(this.orm);notificationMessage=this.env._t("New spreadsheet created in Documents");}else{documentId=spreadsheet.id;notificationMessage=sprintf(this.env._t("New sheet inserted in '%s'"),spreadsheet.name);}
this.notification.add(notificationMessage,{type:"info"});this.action.doAction({type:"ir.actions.client",tag:"action_open_spreadsheet",params:{spreadsheet_id:documentId,initCallback:getInsertMenuCallback(!spreadsheet,actionToLink),},});}}
const spreadsheetService=__exports.spreadsheetService={dependencies:["orm","notification","action"],start(env,dependencies){return new SpreadsheetService(env,dependencies);},};registry.category("services").add("spreadsheet",spreadsheetService);return __exports;});;

/* /documents_spreadsheet/static/src/actions/spreadsheet_template/spreadsheet_template_action.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/actions/spreadsheet_template/spreadsheet_template_action',async function(require){'use strict';let __exports={};const SpreadsheetComponent=require("documents_spreadsheet.SpreadsheetComponent");const{SpreadsheetControlPanel}=require("@documents_spreadsheet/actions/control_panel/spreadsheet_control_panel");const{base64ToJson}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_helpers")
const{useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{SpreadsheetTemplateService}=require("@documents_spreadsheet/actions/spreadsheet_template/spreadsheet_template_service");const{AbstractSpreadsheetAction}=require("@documents_spreadsheet/actions/abstract_spreadsheet_action");const{useRef}=owl.hooks;const SpreadsheetTemplateAction=__exports.SpreadsheetTemplateAction=class SpreadsheetTemplateAction extends AbstractSpreadsheetAction{setup(){super.setup();this.notificationMessage=this.env._t("New spreadsheet template created");const orm=useService("orm");this.service=new SpreadsheetTemplateService(orm);this.spreadsheetRef=useRef("spreadsheet");}
_loadData(record){this.spreadsheetData=base64ToJson(record.data);this.state.spreadsheetName=record.name;this.isReadonly=record.isReadonly;}}
SpreadsheetTemplateAction.template="documents_spreadsheet.SpreadsheetTemplateAction"
SpreadsheetTemplateAction.components={SpreadsheetComponent,SpreadsheetControlPanel,};registry.category("actions").add("action_open_template",SpreadsheetTemplateAction);return __exports;});;

/* /documents_spreadsheet/static/src/actions/spreadsheet_template/spreadsheet_template_service.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/actions/spreadsheet_template/spreadsheet_template_service',async function(require){'use strict';let __exports={};const{jsonToBase64}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_helpers");const{_t}=require("@web/core/l10n/translation");const SpreadsheetTemplateService=__exports.SpreadsheetTemplateService=class SpreadsheetTemplateService{constructor(orm){this.orm=orm;}
async copy(spreadsheetTemplateId,{data,thumbnail}){const defaultValues={data:jsonToBase64(data),thumbnail,};return this.orm.call("spreadsheet.template","copy",[spreadsheetTemplateId],{default:defaultValues,});}
async createEmpty(){const data={name:_t("Untitled spreadsheet template"),data:btoa("{}"),};return this.orm.create("spreadsheet.template",data);}
async save(spreadsheetTemplateId,{data,thumbnail}){await this.orm.write("spreadsheet.template",[spreadsheetTemplateId],{data:jsonToBase64(data),thumbnail,});}
async saveName(spreadsheetTemplateId,name){await this.orm.write("spreadsheet.template",[spreadsheetTemplateId],{name});}
async fetchData(spreadsheetTemplateId){return this.orm.call("spreadsheet.template","fetch_template_data",[spreadsheetTemplateId]);}}
return __exports;});;

/* /documents_spreadsheet/static/src/constants.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/constants',async function(require){'use strict';let __exports={};const{_lt}=require("@web/core/l10n/translation");const UNTITLED_SPREADSHEET_NAME=__exports.UNTITLED_SPREADSHEET_NAME=_lt("Untitled spreadsheet")
return __exports;});;

/* /documents_spreadsheet/static/src/insert_action_link_menu/insert_action_link_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/insert_action_link_menu/insert_action_link_menu',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const SpreadsheetSelectorDialog=require("documents_spreadsheet.SpreadsheetSelectorDialog");const{Component}=owl;const favoriteMenuRegistry=registry.category("favoriteMenu");const InsertViewSpreadsheet=__exports.InsertViewSpreadsheet=class InsertViewSpreadsheet extends Component{setup(){this.orm=useService("orm");this.spreadsheet=useService("spreadsheet");}
async linkInSpreadsheet(){const spreadsheets=await this.orm.call("documents.document","get_spreadsheets_to_display");const dialog=new SpreadsheetSelectorDialog(this,{spreadsheets}).open();dialog.on("confirm",this,this.insertInSpreadsheet);}
async insertInSpreadsheet({id:spreadsheet}){const actionToLink=this.getViewDescription();return this.spreadsheet.insertInSpreadsheet(spreadsheet,actionToLink);}
getViewDescription(){const{resModel}=this.env.searchModel;const{displayName,views=[]}=this.env.config;const{context,domain}=this.env.searchModel.getIrFilterValues();const action={domain,context,modelName:resModel,views:views.map(([,type])=>[false,type]),};return{viewType:this.env.config.viewType,action,name:displayName,};}}
InsertViewSpreadsheet.props={};InsertViewSpreadsheet.template="documents_spreadsheet.InsertActionSpreadsheet";favoriteMenuRegistry.add("insert-action-link-in-spreadsheet",{Component:InsertViewSpreadsheet,groupNumber:4,isDisplayed:({config,isSmall})=>!isSmall&&config.actionType==="ir.actions.act_window"},{sequence:1});return __exports;});;

/* /documents_spreadsheet/static/src/js/collaborative/operational_transform.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/collaborative/operational_transform',async function(require){'use strict';let __exports={};const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{inverseCommandRegistry,otRegistry}=spreadsheet.registries;function identity(cmd){return[cmd];}
otRegistry.addTransformation("REMOVE_GLOBAL_FILTER",["EDIT_GLOBAL_FILTER"],(toTransform,executed)=>toTransform.id===executed.id?undefined:toTransform).addTransformation("ADD_PIVOT",["ADD_PIVOT"],(toTransform)=>({...toTransform,id:toTransform.id+1,pivot:{...toTransform.pivot,id:toTransform.pivot.id+1},})).addTransformation("ADD_PIVOT",["ADD_PIVOT_FORMULA"],(toTransform)=>({...toTransform,args:[toTransform.args[0]+1,...toTransform.args.slice(1)],})).addTransformation("ADD_ODOO_LIST",["ADD_ODOO_LIST_FORMULA"],(toTransform)=>({...toTransform,args:[toTransform.args[0]+1,...toTransform.args.slice(1)],})).addTransformation("ADD_ODOO_LIST",["ADD_ODOO_LIST"],(toTransform)=>({...toTransform,list:{...toTransform.list,id:toTransform.list.id+1},}));inverseCommandRegistry.add("ADD_GLOBAL_FILTER",(cmd)=>{return[{type:"REMOVE_GLOBAL_FILTER",id:cmd.id,},];}).add("REMOVE_GLOBAL_FILTER",(cmd)=>{return[{type:"ADD_GLOBAL_FILTER",id:cmd.id,filter:{},},];}).add("ADD_PIVOT",identity).add("EDIT_GLOBAL_FILTER",identity).add("ADD_PIVOT_FORMULA",identity).add("ADD_ODOO_LIST",identity).add("ADD_ODOO_LIST_FORMULA",identity);return __exports;});odoo.define(`documents_spreadsheet.OperationalTransform`,async function(require){return require('@documents_spreadsheet/js/collaborative/operational_transform')[Symbol.for("default")];});;

/* /documents_spreadsheet/static/src/js/collaborative/spreadsheet_collaborative_channel.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/collaborative/spreadsheet_collaborative_channel',async function(require){'use strict';let __exports={};const SpreadsheetCollaborativeChannel=__exports[Symbol.for("default")]=class SpreadsheetCollaborativeChannel{constructor(env,documentId){this.env=env;this._documentId=documentId;this._listener;this._queue=[];this._channel=`spreadsheet_collaborative_session_${this._documentId}`;this.env.services.bus_service.addChannel(this._channel);this.env.services.bus_service.onNotification(this,(notifs)=>this._handleNotifications(this._filterSpreadsheetNotifs(notifs)));}
onNewMessage(id,callback){this._listener=callback;for(let message of this._queue){callback(message);}
this._queue=[];}
sendMessage(message){return this.env.services.rpc({model:"documents.document",method:"dispatch_spreadsheet_message",args:[this._documentId,message],},{shadow:true});}
leave(){this._listener=undefined;}
_filterSpreadsheetNotifs(notifs){return notifs.filter((notification)=>{const{payload,type}=notification;return type==='spreadsheet'&&payload.id===this._documentId;});}
_handleNotifications(notifs){for(const{payload}of notifs){if(!this._listener){this._queue.push(payload);}else{this._listener(payload);}}}}
return __exports;});odoo.define(`documents_spreadsheet.SpreadsheetCollaborativeChannel`,async function(require){return require('@documents_spreadsheet/js/collaborative/spreadsheet_collaborative_channel')[Symbol.for("default")];});;

/* /documents_spreadsheet/static/src/js/components/filter_date_value.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.DateFilterValue",function(require){"use strict";const{getPeriodOptions}=require("web.searchUtils");const{_lt}=require('web.core');const dateTypeOptions={quarter:["first_quarter","second_quarter","third_quarter","fourth_quarter"],year:["this_year","last_year","antepenultimate_year"],};const monthsOptions=[{id:"january",description:_lt("January")},{id:"february",description:_lt("February")},{id:"march",description:_lt("March")},{id:"april",description:_lt("April")},{id:"may",description:_lt("May")},{id:"june",description:_lt("June")},{id:"july",description:_lt("July")},{id:"august",description:_lt("August")},{id:"september",description:_lt("September")},{id:"october",description:_lt("October")},{id:"november",description:_lt("November")},{id:"december",description:_lt("December")},];function dateOptions(type){if(type==="month"){return monthsOptions;}else{return getPeriodOptions(moment()).filter(({id})=>dateTypeOptions[type].includes(id));}}
class DateFilterValue extends owl.Component{dateOptions(type){return type?dateOptions(type):[];}
isYear(){return this.props.type==="year";}
isSelected(periodId){return[this.props.year,this.props.period].includes(periodId);}
getCurrentDateFilterValue(){const period=dateOptions(this.props.type).filter(period=>this.isSelected(period.id))
let value=period.length&&period[0].description||""
if(!this.isYear()){const year=dateOptions("year").filter(period=>this.isSelected(period.id))
value+=` ${year.length && year[0].description || ""}`}
return value}
onPeriodChanged(ev){const value=ev.target.value;this.trigger("time-range-changed",{year:this.props.year||this.dateOptions('year')[0].id,period:value!=="empty"?value:undefined,});}
onYearChanged(ev){const value=ev.target.value;this.trigger("time-range-changed",{year:value!=="empty"?value:undefined,period:this.props.period,});}}
DateFilterValue.template="documents_spreadsheet.DateFilterValue";return DateFilterValue;});;

/* /documents_spreadsheet/static/src/js/components/filter_editor_side_panel.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.filter_editor_side_panel",function(require){"use strict";const core=require("web.core");const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const DateFilterValue=require("documents_spreadsheet.DateFilterValue");const CommandResult=require("documents_spreadsheet.CommandResult");const{FieldSelectorWidget,FieldSelectorAdapter,}=require("documents_spreadsheet.field_selector_widget");const{ModelSelectorWidgetAdapter,}=require("documents_spreadsheet.model_selector_widget");const{StandaloneMany2OneField}=require("@documents_spreadsheet/js/widgets/standalone_many2one_field");const{TagSelectorWidget,TagSelectorWidgetAdapter,}=require("documents_spreadsheet.tag_selector_widget");const{useService}=require("@web/core/utils/hooks");const _t=core._t;const{useState}=owl.hooks;const sidePanelRegistry=spreadsheet.registries.sidePanelRegistry;const uuidGenerator=new spreadsheet.helpers.UuidGenerator();class FilterEditorSidePanel extends owl.Component{constructor(parent,props){super(...arguments);this.id=undefined;this.state=useState({saved:false,label:undefined,type:undefined,pivotFields:{},listFields:{},text:{defaultValue:undefined,},date:{defaultValue:{},type:undefined,options:[],},relation:{defaultValue:[],displayNames:[],relatedModelID:undefined,relatedModelName:undefined,},});this.getters=this.env.getters;this.pivotIds=this.getters.getPivotIds();this.listIds=this.getters.getListIds();this.loadValues(props);this.FieldSelectorWidget=FieldSelectorWidget;this.StandaloneMany2OneField=StandaloneMany2OneField;this.TagSelectorWidget=TagSelectorWidget;this.orm=useService("orm");this.notification=useService("notification");}
get placeholder(){return _.str.sprintf(_t("New %s filter"),this.state.type);}
get missingLabel(){return this.state.saved&&!this.state.label;}
get missingPivotField(){return this.state.saved&&Object.keys(this.state.pivotFields).length===0;}
get missingListField(){return this.state.saved&&Object.keys(this.state.listFields).length===0;}
get missingModel(){return(this.state.saved&&this.state.type==="relation"&&!this.state.relation.relatedModelID);}
get relatedModels(){const pivots=this.pivotIds.map((pivotId)=>Object.values(this.getters.getPivotFields(pivotId)));const lists=this.listIds.map((listId)=>Object.values(this.getters.getListFields(listId)));const all=pivots.concat(lists);return[...new Set(all.flat().filter((field)=>field.type==="many2one").map((field)=>field.relation)),];}
loadValues(props){this.id=props.id;const globalFilter=this.id&&this.getters.getGlobalFilter(this.id);this.state.label=globalFilter&&globalFilter.label;this.state.type=globalFilter?globalFilter.type:props.type;this.state.pivotFields=globalFilter?globalFilter.pivotFields:{};this.state.listFields=globalFilter?globalFilter.listFields:{};this.state.date.type=this.state.type==="date"&&globalFilter?globalFilter.rangeType:"year";if(globalFilter){this.state[this.state.type].defaultValue=globalFilter.defaultValue;if(this.state.type==="relation"){this.state.relation.relatedModelName=globalFilter.modelName;}}}
async willStart(){const proms=[];proms.push(this.fetchModelFromName());for(const pivotId of this.getters.getPivotIds()){proms.push(this.getters.waitForPivotMetaData(pivotId));}
await Promise.all(proms);}
mounted(){this.el.querySelector(".o_global_filter_label").focus();}
_findRelation(fields){return Object.entries(fields).find(([,fieldDesc])=>fieldDesc.type==="many2one"&&fieldDesc.relation===this.state.relation.relatedModelName)||[];}
async onModelSelected(ev){if(this.state.relation.relatedModelID!==ev.detail.value){this.state.relation.defaultValue=[];}
this.state.relation.relatedModelID=ev.detail.value;await this.fetchModelFromId();for(const pivotId of this.pivotIds){const[field,fieldDesc]=this._findRelation(this.getters.getPivotFields(pivotId));this.state.pivotFields[pivotId]=field?{field,type:fieldDesc.type}:undefined;}
for(const listId of this.listIds){const[field,fieldDesc]=this._findRelation(this.getters.getListFields(listId));this.state.listFields[listId]=field?{field,type:fieldDesc.type}:undefined;}}
async fetchModelFromName(){if(!this.state.relation.relatedModelName){this.state.relation.relatedModelID=undefined;return;}
const result=await this.orm.searchRead("ir.model",[["model","=",this.state.relation.relatedModelName]],["id","name"]);this.state.relation.relatedModelID=result[0]&&result[0].id;if(!this.state.label){this.state.label=result[0]&&result[0].name;}}
async fetchModelFromId(){if(!this.state.relation.relatedModelID){this.state.relation.relatedModelName=undefined;return;}
const result=await this.orm.searchRead("ir.model",[["id","=",this.state.relation.relatedModelID]],["model","name"]);this.state.relation.relatedModelName=result[0]&&result[0].model;if(!this.state.label){this.state.label=result[0]&&result[0].name;}}
onSelectedPivotField(id,ev){const fieldName=ev.detail.chain[0];const field=this.getters.getPivotField(id,fieldName);if(field){this.state.pivotFields[id]={field:fieldName,type:field.type,};}}
onSelectedListField(listId,ev){const fieldName=ev.detail.chain[0];const field=this.getters.getListField(listId,fieldName);if(field){this.state.listFields[listId]={field:fieldName,type:field.type,};}}
onSave(){this.state.saved=true;const missingField=(this.listIds.length!==0&&this.missingListField)||(this.pivotIds.length!==0&&this.missingPivotField);if(this.missingLabel||missingField||this.missingModel){this.notification.add(this.env._t("Some required fields are not valid"),{type:"danger",sticky:false,});return;}
const cmd=this.id?"EDIT_GLOBAL_FILTER":"ADD_GLOBAL_FILTER";const id=this.id||uuidGenerator.uuidv4();const filter={id,type:this.state.type,label:this.state.label,modelName:this.state.relation.relatedModelName,defaultValue:this.state[this.state.type].defaultValue,defaultValueDisplayNames:this.state[this.state.type].displayNames,rangeType:this.state.date.type,pivotFields:this.state.pivotFields,listFields:this.state.listFields,};const result=this.env.dispatch(cmd,{id,filter});if(result.isCancelledBecause(CommandResult.DuplicatedFilterLabel)){this.notification.add(this.env._t("Duplicated Label"),{type:"danger",sticky:false,});return;}
this.env.openSidePanel("GLOBAL_FILTERS_SIDE_PANEL",{});}
onCancel(){this.env.openSidePanel("GLOBAL_FILTERS_SIDE_PANEL",{});}
onValuesSelected(ev){this.state.relation.defaultValue=ev.detail.value.map((record)=>record.id);this.state.relation.displayNames=ev.detail.value.map((record)=>record.display_name);}
onTimeRangeChanged(ev){this.state.date.defaultValue=ev.detail;}
onDelete(){if(this.id){this.env.dispatch("REMOVE_GLOBAL_FILTER",{id:this.id});}
this.env.openSidePanel("GLOBAL_FILTERS_SIDE_PANEL",{});}
onDateOptionChange(ev){this.state.date.type=ev.target.value;this.state.date.defaultValue={};}}
FilterEditorSidePanel.template="documents_spreadsheet.FilterEditorSidePanel";FilterEditorSidePanel.components={FieldSelectorAdapter,ModelSelectorWidgetAdapter,TagSelectorWidgetAdapter,DateFilterValue,};sidePanelRegistry.add("FILTERS_SIDE_PANEL",{title:_t("Filter properties"),Body:FilterEditorSidePanel,});return FilterEditorSidePanel;});;

/* /documents_spreadsheet/static/src/js/components/global_filters_side_panel.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.global_filters_side_panel",function(require){"use strict";const core=require("web.core");const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const DateFilterValue=require("documents_spreadsheet.DateFilterValue");const{TagSelectorWidget,TagSelectorWidgetAdapter,}=require("documents_spreadsheet.tag_selector_widget");const{getPeriodOptions}=require("web.searchUtils");const _t=core._t;const sidePanelRegistry=spreadsheet.registries.sidePanelRegistry;class GlobalFiltersSidePanel extends owl.Component{constructor(){super(...arguments);this.TagSelectorWidget=TagSelectorWidget;this.periodOptions=getPeriodOptions(moment());this.getters=this.env.getters;}
get isReadonly(){return this.env.getters.isReadonly();}
get filters(){return this.env.getters.getGlobalFilters();}
newText(){this.env.openSidePanel("FILTERS_SIDE_PANEL",{type:"text"});}
newDate(){this.env.openSidePanel("FILTERS_SIDE_PANEL",{type:"date"});}
newRelation(){this.env.openSidePanel("FILTERS_SIDE_PANEL",{type:"relation"});}
onEdit(id){this.env.openSidePanel("FILTERS_SIDE_PANEL",{id});}
onDateInput(id,event){const value=event.detail;this.env.dispatch("SET_GLOBAL_FILTER_VALUE",{id,value});}
onTextInput(id,event){const value=event.target.value;this.env.dispatch("SET_GLOBAL_FILTER_VALUE",{id,value});}
onTagSelected(id,event){const values=event.detail.value;this.env.dispatch("SET_GLOBAL_FILTER_VALUE",{id,value:values.map((record)=>record.id),displayNames:values.map((record)=>record.display_name),});}
onDelete(){if(this.id){this.env.dispatch("REMOVE_GLOBAL_FILTER",{id:this.id});}
this.trigger("close-side-panel");}}
GlobalFiltersSidePanel.template="documents_spreadsheet.GlobalFiltersSidePanel";GlobalFiltersSidePanel.components={TagSelectorWidgetAdapter,DateFilterValue};sidePanelRegistry.add("GLOBAL_FILTERS_SIDE_PANEL",{title:_t("Filters"),Body:GlobalFiltersSidePanel,});return GlobalFiltersSidePanel;});;

/* /documents_spreadsheet/static/src/js/components/insert_action_link/insert_action_link_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/components/insert_action_link/insert_action_link_menu',async function(require){'use strict';let __exports={};const FavoriteMenu=require("web.FavoriteMenu");const pyUtils=require("web.py_utils");const Domain=require("web.Domain");const{useService}=require("@web/core/utils/hooks");const{useModel}=require("web.Model");const SpreadsheetSelectorDialog=require("documents_spreadsheet.SpreadsheetSelectorDialog");const{Component}=owl;const InsertViewSpreadsheet=__exports.InsertViewSpreadsheet=class InsertViewSpreadsheet extends Component{constructor(){super(...arguments);this.model=useModel("searchModel");this.spreadsheet=useService("spreadsheet");}
async linkInSpreadsheet(){const spreadsheets=await this.rpc({model:"documents.document",method:"get_spreadsheets_to_display",args:[],});const dialog=new SpreadsheetSelectorDialog(this,{spreadsheets}).open();dialog.on("confirm",this,this._insertInSpreadsheet);}
async _insertInSpreadsheet({id:spreadsheet}){const actionToLink=this._getViewDescription();return this.spreadsheet.insertInSpreadsheet(spreadsheet,actionToLink);}
_getViewDescription(){const irFilterValues=this.model.get("irFilterValues");const domain=pyUtils.assembleDomains([Domain.prototype.arrayToString(this.env.action.domain),Domain.prototype.arrayToString(irFilterValues.domain),],"AND");const action={domain,context:irFilterValues.context,modelName:this.env.action.res_model,views:this.env.action.views.map((view)=>[false,view.type]),};return{viewType:this.env.view.type,action:action,name:this.env.action.name,};}
static shouldBeDisplayed(env){return env.view&&env.action.type==="ir.actions.act_window"&&!env.device.isMobile;}}
InsertViewSpreadsheet.props={};InsertViewSpreadsheet.template="documents_spreadsheet.InsertActionSpreadsheet";FavoriteMenu.registry.add("insert-action-link-in-spreadsheet",InsertViewSpreadsheet,1);return __exports;});;

/* /documents_spreadsheet/static/src/js/components/insert_list_spreadsheet_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/components/insert_list_spreadsheet_menu',async function(require){'use strict';let __exports={};const FavoriteMenu=require("web.FavoriteMenu");const{useModel}=require("web.Model");const{Component}=owl;const InsertListSpreadsheetMenu=__exports.InsertListSpreadsheetMenu=class InsertListSpreadsheetMenu extends Component{constructor(){super(...arguments);this.model=useModel("searchModel");}
_onClick(){this.model.trigger("insert-list-spreadsheet");}
static shouldBeDisplayed(env){return(env.view&&env.view.type==="list"&&env.action.type==="ir.actions.act_window"&&!env.device.isMobile);}}
InsertListSpreadsheetMenu.props={};InsertListSpreadsheetMenu.template="documents_spreadsheet.InsertListSpreadsheetMenu";FavoriteMenu.registry.add("insert-list-spreadsheet-menu",InsertListSpreadsheetMenu,5);return __exports;});;

/* /documents_spreadsheet/static/src/js/components/ir_menu_selector/ir_menu_selector.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/components/ir_menu_selector/ir_menu_selector',async function(require){'use strict';let __exports={};const{ComponentAdapter}=require("web.OwlCompatibility");const{Dialog}=require("@web/core/dialog/dialog");const{_lt}=require("@web/core/l10n/translation");const{useService}=require("@web/core/utils/hooks");const{StandaloneMany2OneField}=require("@documents_spreadsheet/js/widgets/standalone_many2one_field");const{xml,css}=owl.tags;const{useState,useExternalListener}=owl.hooks;const STYLE=css`
    .o-ir-menu-selector .o_field_many2one {
        width: 100%;
    }
`;class MenuSelectorWidgetAdapter extends ComponentAdapter{setup(){this.env=owl.Component.env;}
mounted(){this.widget.getFocusableElement().focus();}
get widgetArgs(){const domain=[["action","!=",false],"|",["groups_id","=",false],["groups_id","in",this.props.userGroups],]
const attrs={placeholder:this.env._t("Select a menu..."),string:this.env._t("Menu Items"),};return["ir.ui.menu",this.props.menuId,domain,attrs];}}
const IrMenuSelector=__exports.IrMenuSelector=class IrMenuSelector extends Dialog{setup(){super.setup();this.StandaloneMany2OneField=StandaloneMany2OneField;this.user=useService("user");this.orm=useService("orm");this.selectedMenu=useState({id:undefined,});useExternalListener(document.body,"click",(ev)=>ev.stopPropagation())}
async willStart(){const[{groups_id}]=await this.orm.read("res.users",[this.user.userId],["groups_id"]);this.userGroups=groups_id;}
_onConfirm(){this.props.onMenuSelected(this.selectedMenu.id);}
_onValueChanged(ev){this.selectedMenu.id=ev.detail.value;}}
IrMenuSelector.components={MenuSelectorWidgetAdapter};IrMenuSelector.style=STYLE;IrMenuSelector.title=_lt("Select an Odoo menu to link in your spreadsheet");IrMenuSelector.size="model-sm";IrMenuSelector.bodyTemplate=xml`
    <MenuSelectorWidgetAdapter
        class="o-ir-menu-selector"
        t-on-click.stop=""
        Component="StandaloneMany2OneField"
        menuId="props.menuId"
        userGroups="userGroups"
        t-on-value-changed="_onValueChanged"
    />
`;IrMenuSelector.footerTemplate="documents_spreadsheet.IrMenuSelectorFooter";return __exports;});;

/* /documents_spreadsheet/static/src/js/components/spreadsheet_component.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/components/spreadsheet_component',async function(require){'use strict';let __exports={};const{_t}=require("web.core");const Dialog=require("web.OwlDialog");const{useSetupAction}=require("@web/webclient/actions/action_hook");const PivotDialog=require("documents_spreadsheet.PivotDialog");const{jsonToBase64}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_helpers");const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_extended")[Symbol.for("default")];const CachedRPC=require("@documents_spreadsheet/js/o_spreadsheet/helpers/cached_rpc")[Symbol.for("default")];const{DEFAULT_LINES_NUMBER}=require("@documents_spreadsheet/js/o_spreadsheet/constants");const{useService}=require("@web/core/utils/hooks");const{legacyRPC}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/helpers");const uuidGenerator=new spreadsheet.helpers.UuidGenerator();const{Spreadsheet,Model}=spreadsheet;const{useState,useRef,useSubEnv,useExternalListener}=owl.hooks;const SpreadsheetComponent=__exports[Symbol.for("default")]=class SpreadsheetComponent extends owl.Component{constructor(parent,props){super(...arguments);this.orm=useService("orm");const rpc=legacyRPC(this.orm);this.cacheRPC=new CachedRPC(rpc);const user=useService("user");this.ui=useService("ui");useSubEnv({newSpreadsheet:this.newSpreadsheet.bind(this),saveAsTemplate:this._saveAsTemplate.bind(this),makeCopy:this.makeCopy.bind(this),openPivotDialog:this.openPivotDialog.bind(this),download:this._download.bind(this),delayedRPC:this.cacheRPC.delayedRPC.bind(this.cacheRPC),getLinesNumber:this._getLinesNumber.bind(this),});useSetupAction({beforeLeave:this._onLeave.bind(this),});this.state=useState({dialog:{isDisplayed:false,title:undefined,isEditText:false,inputContent:undefined,isEditInteger:false,inputIntegerContent:undefined,},pivotDialog:{isDisplayed:false,},});this.spreadsheet=useRef("spreadsheet");this.dialogContent=undefined;this.pivot=undefined;this.insertPivotValueCallback=undefined;this.confirmDialog=()=>true;this.data=props.data;this.stateUpdateMessages=props.stateUpdateMessages;this.client={id:uuidGenerator.uuidv4(),name:user.name,userId:user.uid,};this.isReadonly=props.isReadonly;this.transportService=this.props.transportService;useExternalListener(window,"beforeunload",this._onLeave.bind(this));}
get model(){return this.spreadsheet.comp.model;}
mounted(){this.model.on("update",this,()=>this.trigger("spreadsheet-sync-status",{synced:this.model.getters.isFullySynchronized(),numberOfConnectedUsers:this.getConnectedUsers(),}));if(this.props.showFormulas){this.model.dispatch("SET_FORMULA_VISIBILITY",{show:true});}
if(this.props.initCallback){this.props.initCallback(this.model);}
if(this.props.download){this._download();}}
getConnectedUsers(){return new Set([...this.model.getters.getConnectedClients().values()].map((client)=>client.userId)).size;}
willUnmount(){this._onLeave();}
askConfirmation(ev){this.dialogContent=ev.detail.content;this.confirmDialog=()=>{ev.detail.confirm();this.closeDialog();};this.state.dialog.isDisplayed=true;}
editText(ev){this.dialogContent=undefined;this.state.dialog.title=ev.detail.title&&ev.detail.title.toString();this.state.dialog.isEditText=true;this.state.inputContent=ev.detail.placeholder;this.confirmDialog=()=>{this.closeDialog();ev.detail.callback(this.state.inputContent);};this.state.dialog.isDisplayed=true;}
_getLinesNumber(callback){this.dialogContent=_t("Select the number of records to insert");this.state.dialog.title=_t("Re-insert list");this.state.dialog.isEditInteger=true;this.state.dialog.inputIntegerContent=DEFAULT_LINES_NUMBER;this.confirmDialog=()=>{this.closeDialog();callback(this.state.dialog.inputIntegerContent);};this.state.dialog.isDisplayed=true;}
closeDialog(){this.dialogContent=undefined;this.confirmDialog=()=>true;this.state.dialog.title=undefined;this.state.dialog.isDisplayed=false;this.state.dialog.isEditText=false;this.state.dialog.isEditInteger=false;this.spreadsheet.comp.focusGrid();}
closePivotDialog(){this.state.pivotDialog.isDisplayed=false;this.spreadsheet.comp.focusGrid();}
_onCellClicked(ev){this.insertPivotValueCallback(ev.detail.formula);this.closePivotDialog();}
getSaveData(){const data=this.spreadsheet.comp.model.exportData();return{data,revisionId:data.revisionId,thumbnail:this.getThumbnail(),};}
getMissingValueDialogTitle(){const title=_t("Insert pivot cell");const pivotTitle=this.getPivotTitle();if(pivotTitle){return`${title} - ${pivotTitle}`;}
return title;}
getPivotTitle(){if(this.pivotId){return this.model.getters.getPivotDisplayName(this.pivotId);}
return"";}
getThumbnail(){const dimensions=spreadsheet.SPREADSHEET_DIMENSIONS;const canvas=this.spreadsheet.comp.grid.comp.canvas.el;const canvasResizer=document.createElement("canvas");const size=this.props.thumbnailSize;canvasResizer.width=size;canvasResizer.height=size;const canvasCtx=canvasResizer.getContext("2d");const sourceSize=Math.min(25*dimensions.DEFAULT_CELL_HEIGHT,canvas.width,canvas.height);canvasCtx.drawImage(canvas,dimensions.HEADER_WIDTH-1,dimensions.HEADER_HEIGHT-1,sourceSize,sourceSize,0,0,size,size);return canvasResizer.toDataURL().replace("data:image/png;base64,","");}
makeCopy(){const{data,thumbnail}=this.getSaveData();this.trigger("make-copy",{data,thumbnail,});}
newSpreadsheet(){this.trigger("new-spreadsheet");}
async _download(){this.ui.block();try{const{files}=await this.spreadsheet.comp.env.exportXLSX();this.trigger("download",{name:this.props.name,files,});}finally{this.ui.unblock();}}
async _saveAsTemplate(){const model=new Model(this.spreadsheet.comp.model.exportData(),{mode:"headless",evalContext:{env:this.env},});await model.waitForIdle();model.dispatch("CONVERT_PIVOT_TO_TEMPLATE");const data=model.exportData();const name=this.props.name;this.trigger("do-action",{action:"documents_spreadsheet.save_spreadsheet_template_action",options:{additional_context:{default_template_name:`${name} - Template`,default_data:jsonToBase64(data),default_thumbnail:this.getThumbnail(),},},});}
notifyUser(ev){this.dialogContent=ev.detail.content;this.confirmDialog=this.closeDialog;this.state.dialog.isDisplayed=true;}
openPivotDialog(ev){this.pivotId=ev.pivotId;this.insertPivotValueCallback=ev.insertPivotValueCallback;this.state.pivotDialog.isDisplayed=true;}
_onLeave(){if(this.alreadyLeft){return;}
this.alreadyLeft=true;this.spreadsheet.comp.model.off("update",this);if(!this.isReadonly){this.trigger("spreadsheet-saved",this.getSaveData());}}}
SpreadsheetComponent.template="documents_spreadsheet.SpreadsheetComponent";SpreadsheetComponent.components={Spreadsheet,Dialog,PivotDialog};Spreadsheet._t=_t;SpreadsheetComponent.props={name:String,data:Object,thumbnailSize:Number,isReadonly:Boolean,snapshotRequested:Boolean,showFormulas:Boolean,download:Boolean,stateUpdateMessages:Array,initCallback:{optional:true,type:Function,},transportService:{optional:true,type:Object}}
SpreadsheetComponent.defaultProps={isReadonly:false,download:false,snapshotRequested:false,showFormulas:false,stateUpdateMessages:[],}
return __exports;});odoo.define(`documents_spreadsheet.SpreadsheetComponent`,async function(require){return require('@documents_spreadsheet/js/components/spreadsheet_component')[Symbol.for("default")];});;

/* /documents_spreadsheet/static/src/js/components/spreadsheet_pivot_dialog.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.PivotDialog",function(require){"use strict";const core=require("web.core");const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const PivotDialogTable=require("documents_spreadsheet.PivotDialogTable");const _t=core._t;const{useState}=owl.hooks;const formatDecimal=spreadsheet.helpers.formatDecimal;class PivotDialog extends owl.Component{constructor(){super(...arguments);this.state=useState({showMissingValuesOnly:false,});}
async willStart(){await this.getters.waitForPivotDataReady(this.pivotId);this.data={columns:this._buildColHeaders(),rows:this._buildRowHeaders(),values:this._buildValues(),};}
get pivotId(){return this.props.pivotId;}
get getters(){return this.props.getters;}
get pivotData(){return this.getters.getPivotStructureData(this.pivotId);}
getTableData(){if(!this.state.showMissingValuesOnly){return this.data;}
const colIndexes=this._getColumnsIndexes();const rowIndexes=this._getRowsIndexes();const columns=this._buildColumnsMissing(colIndexes);const rows=this._buildRowsMissing(rowIndexes);const values=this._buildValuesMissing(colIndexes,rowIndexes);return{columns,rows,values};}
_addRecursiveRow(index){const row=this.pivotData.getRowValues(index).slice();if(row.length<=1){return[index];}
row.pop();const parentRowIndex=this.pivotData.getRowIndex(row);return[index].concat(this._addRecursiveRow(parentRowIndex));}
_buildColumnsMissing(indexes){const columnsMap=[];for(let column of this.data.columns){const columnMap=[];for(let index in column){for(let i=0;i<column[index].span;i++){columnMap.push(index);}}
columnsMap.push(columnMap);}
for(let i=columnsMap[columnsMap.length-1].length;i>=0;i--){if(!indexes.includes(i)){for(let columnMap of columnsMap){columnMap.splice(i,1);}}}
const columns=[];for(let mapIndex in columnsMap){const column=[];let index=undefined;let span=1;for(let i=0;i<columnsMap[mapIndex].length;i++){if(index!==columnsMap[mapIndex][i]){if(index){column.push(Object.assign({},this.data.columns[mapIndex][index],{span}));}
index=columnsMap[mapIndex][i];span=1;}else{span++;}}
if(index){column.push(Object.assign({},this.data.columns[mapIndex][index],{span}));}
columns.push(column);}
return columns;}
_buildRowsMissing(indexes){return indexes.map((index)=>this.data.rows[index]);}
_buildValuesMissing(colIndexes,rowIndexes){const values=colIndexes.map(()=>[]);for(let row of rowIndexes){for(let col in colIndexes){values[col].push(this.data.values[colIndexes[col]][row]);}}
return values;}
_getColumnsIndexes(){const indexes=new Set();for(let i=0;i<this.data.columns.length;i++){const exploded=[];for(let y=0;y<this.data.columns[i].length;y++){for(let x=0;x<this.data.columns[i][y].span;x++){exploded.push(this.data.columns[i][y]);}}
for(let y=0;y<exploded.length;y++){if(exploded[y].isMissing){indexes.add(y);}}}
for(let i=0;i<this.data.columns[this.data.columns.length-1].length;i++){const values=this.data.values[i];if(values.find((x)=>x.isMissing)){indexes.add(i);}}
return Array.from(indexes).sort((a,b)=>a-b);}
_getRowsIndexes(){const rowIndexes=new Set();for(let i=0;i<this.data.rows.length;i++){if(this.data.rows[i].isMissing){rowIndexes.add(i);}
for(let col of this.data.values){if(col[i].isMissing){this._addRecursiveRow(i).forEach((x)=>rowIndexes.add(x));}}}
return Array.from(rowIndexes).sort((a,b)=>a-b);}
_buildCell(args){const formula=`=PIVOT("${args.join('","')}")`;const measure=args[1];const measures=this.getters.getPivotMeasures(this.pivotId);const operator=measures.filter((m)=>m.field===measure)[0].operator;args.splice(0,2);const domain=args.map((x)=>x.toString());const value=this.pivotData.getMeasureValue(measure,operator,domain);return{value:this._formatValue(value),formula};}
_buildColHeaders(){const levels=this.pivotData.getColGroupByLevels();const headers=[];let length=this.pivotData.getTopHeaderCount()-
this.getters.getPivotMeasures(this.pivotId).length;if(length===0){length=this.pivotData.getTopHeaderCount();}
for(let i=0;i<length;i++){for(let level=0;level<=levels;level++){const pivotArgs=[];const values=this.pivotData.getColGroupHierarchy(i,level);for(const index in values){pivotArgs.push(this.pivotData.getColLevelIdentifier(index));pivotArgs.push(values[index]);}
const isMissing=!this.pivotData.isUsedHeader(pivotArgs);pivotArgs.unshift(this.pivotId);if(headers[level]){headers[level].push({args:pivotArgs,isMissing});}else{headers[level]=[{args:pivotArgs,isMissing}];}}}
for(let i=length;i<this.pivotData.getTopHeaderCount();i++){let isMissing=!this.pivotData.isUsedHeader([]);headers[headers.length-2].push({args:[this.pivotId],isMissing});const args=["measure",this.pivotData.getColGroupHierarchy(i,1)[0]];isMissing=!this.pivotData.isUsedHeader(args);headers[headers.length-1].push({args:[this.pivotId,...args],isMissing});}
return headers.map((row)=>{const reducedRow=row.reduce((acc,curr)=>{const val=curr.args.join('","');if(acc[val]===undefined){acc[val]={count:0,position:Object.keys(acc).length,isMissing:curr.isMissing,};}
acc[val].count++;return acc;},{});return Object.entries(reducedRow).map(([val,info])=>{const style=row===headers[headers.length-1]&&!info.isMissing&&"color: #756f6f;";return{formula:`=PIVOT.HEADER("${val}")`,value:this._getLabel(val),span:info.count,position:info.position,isMissing:info.isMissing,style,};}).sort((a,b)=>(a.position>b.position?1:-1));});}
_buildRowHeaders(){const rowCount=this.pivotData.getRowCount();const headers=[];for(let index=0;index<rowCount;index++){const pivotArgs=[];const current=this.pivotData.getRowValues(index);for(let i in current){pivotArgs.push(this.getters.getPivotRowGroupBys(this.pivotId)[i]);pivotArgs.push(current[i]);}
const isMissing=!this.pivotData.isUsedHeader(pivotArgs);pivotArgs.unshift(this.pivotId);headers.push({args:pivotArgs,isMissing});}
return headers.map(({args,isMissing})=>{const argsString=args.join('","');const style=this._getStyle(args);return{args,formula:`=PIVOT.HEADER("${argsString}")`,value:this._getLabel(argsString),style,isMissing,};});}
_buildValues(){const length=this.pivotData.getTopHeaderCount()-
this.getters.getPivotMeasures(this.pivotId).length;const rowGroupBys=this.getters.getPivotRowGroupBys(this.pivotId);const values=[];for(let i=0;i<length;i++){const colElement=[...this.pivotData.getColumnValues(i),this.pivotData.getMeasureName(i),];const colValues=[];for(let rowElement of this.pivotData.getRows()){const pivotArgs=[];for(let index in rowElement){pivotArgs.push(rowGroupBys[index]);pivotArgs.push(rowElement[index]);}
for(let index in colElement){const field=this.pivotData.getColLevelIdentifier(index);if(field==="measure"){pivotArgs.unshift(colElement[index]);}else{pivotArgs.push(this.pivotData.getColLevelIdentifier(index));pivotArgs.push(colElement[index]);}}
const isMissing=!this.pivotData.isUsedValue(pivotArgs);pivotArgs.unshift(this.pivotId);colValues.push({args:this._buildCell(pivotArgs),isMissing});}
values.push(colValues);}
for(let i=length;i<this.pivotData.getTopHeaderCount();i++){const colElement=[...this.pivotData.getColumnValues(i),this.pivotData.getMeasureName(i),];const colValues=[];for(let rowElement of this.pivotData.getRows()){const pivotArgs=[];for(let index in rowElement){pivotArgs.push(rowGroupBys[index]);pivotArgs.push(rowElement[index]);}
pivotArgs.unshift(colElement[0]);const isMissing=!this.pivotData.isUsedValue(pivotArgs);pivotArgs.unshift(this.pivotId);colValues.push({args:this._buildCell(pivotArgs),isMissing});}
values.push(colValues);}
return values;}
_formatValue(value){if(!value){return"";}
return formatDecimal(value,2);}
_getLabel(args){let domain=args.split('","');domain.shift();const len=domain.length;if(len===0){return _t("Total");}
const field=domain[len-2];const value=domain[len-1];return this.getters.getFormattedHeader(this.pivotId,field,value);}
_getStyle(args){const length=args.length-3;if(!length){return"";}
return`padding-left: ${length * 10}px`;}}
PivotDialog.template="documents_spreadsheet.PivotDialog";PivotDialog.components={PivotDialogTable};return PivotDialog;});;

/* /documents_spreadsheet/static/src/js/components/spreadsheet_pivot_dialog_table.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.PivotDialogTable",function(require){"use strict";class PivotDialogTable extends owl.Component{_onCellClicked(formula){this.trigger('cell-selected',{formula});}}
PivotDialogTable.template="documents_spreadsheet.PivotDialogTable";return PivotDialogTable;});;

/* /documents_spreadsheet/static/src/js/components/spreadsheet_template_dialog.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.TemplateDialog",function(require){"use strict";const Dialog=require("web.OwlDialog");const SearchBar=require("web.SearchBar");const Pager=require("web.Pager");const ActionModel=require("web.ActionModel");const{UNTITLED_SPREADSHEET_NAME}=require("@documents_spreadsheet/constants");const{getDataFromTemplate}=require("documents_spreadsheet.pivot_utils");const{DropPrevious}=require("web.concurrency");const{useState,useSubEnv}=owl.hooks;class TemplateDialog extends owl.Component{constructor(){super(...arguments);this.dialogTitle=this.env._t("New Spreadsheet");this.limit=9;this.state=useState({isOpen:true,templates:[],templatesCount:0,selectedTemplateId:null,currentMinimum:1,offset:0,isCreating:false,});const searchModelConfig={context:this.props.context,domain:[],env:owl.Component.env,};const archs={search:this.props.searchView.arch};const{ControlPanel:controlPanelInfo}=ActionModel.extractArchInfo(archs);const extensions={ControlPanel:{archNodes:controlPanelInfo.children,fields:this.props.searchView.fields,},};this.model=new ActionModel(extensions,searchModelConfig);this.model.on("search",this,this._fetchTemplates);useSubEnv({searchModel:this.model,});this.dp=new DropPrevious();}
async willStart(){await this._fetchTemplates({domain:[],context:this.props.context,});}
async _fetchTemplates(searchQuery,offset=0){const{domain,context,orderedBy}=searchQuery;const{length,records}=await this.dp.add(this.env.services.rpc({route:"/web/dataset/search_read",model:"spreadsheet.template",fields:["name"],domain,context,offset,limit:this.limit,orderBy:orderedBy,}));this.state.templates=records;this.state.templatesCount=length;}
async _createSpreadsheet(){if(!this._hasSelection())return;this.state.isCreating=true;const templateId=this.state.selectedTemplateId;const data=templateId!==null?await getDataFromTemplate(this.env.services.rpc,templateId):{};const name=templateId!==null?this.state.templates.find((template)=>template.id===templateId).name:UNTITLED_SPREADSHEET_NAME;const spreadsheetId=await this.env.services.rpc({model:"documents.document",method:"create",args:[{name,mimetype:"application/o-spreadsheet",folder_id:this.props.folderId,handler:"spreadsheet",raw:JSON.stringify(data),},],context:this.props.context,});this.env.services.notification.notify({type:"info",message:this.env._t("New sheet saved in Documents"),sticky:false,});this.trigger("spreadsheet-created",{spreadsheetId});}
_selectTemplate(templateId){this.state.selectedTemplateId=templateId;}
_isSelected(templateId){return this.state.selectedTemplateId===templateId;}
_hasSelection(){return(this.state.templates.find((template)=>template.id===this.state.selectedTemplateId)||this.state.selectedTemplateId===null);}
_onPagerChanged(ev){ev.stopPropagation();const{currentMinimum}=ev.detail;this.state.currentMinimum=currentMinimum;return this._fetchTemplates(this.model.get("query"),this.state.currentMinimum-1);}
_buttonDisabled(){return this.state.isCreating||!this._hasSelection();}}
TemplateDialog.components={Dialog,SearchBar,Pager};TemplateDialog.template="documents_spreadsheet.TemplateDialog";return TemplateDialog;});;

/* /documents_spreadsheet/static/src/js/documents_inspector.js defined in bundle 'web.assets_backend' */
odoo.define("spreadsheet.DocumentsInspector",function(require){"use strict";const DocumentsInspector=require("documents.DocumentsInspector");const core=require('web.core');const _t=core._t;DocumentsInspector.include({events:_.extend({"click .o_document_spreadsheet":"_onOpenSpreadSheet",},DocumentsInspector.prototype.events),init:function(parent,params){this._super(...arguments);for(const record of this.records){this.recordsData[record.id].isSheet=record.data.handler==="spreadsheet";}},_computeClasses:function(record){let classes=this._super(...arguments);if(this.recordsData[record.id].isSheet){classes=classes.replace("o_documents_preview_mimetype","o_documents_preview_image");}
return classes;},_onOpenSpreadSheet:function(ev){ev.preventDefault();ev.stopPropagation();const activeId=$(ev.currentTarget).data("id");if(activeId){this.do_action({type:"ir.actions.client",tag:"action_open_spreadsheet",params:{spreadsheet_id:activeId,},});}},_onDownload:function(){if(this.records.some(record=>record.data.handler==='spreadsheet')){if(this.records.length===1){this.do_action({type:"ir.actions.client",tag:"action_open_spreadsheet",params:{spreadsheet_id:this.records[0].data.id,download:true,},});}
else{this.displayNotification({type:"danger",message:_t("Spreadsheets mass download not yet supported.\n Download spreadsheets individually instead."),sticky:false,});this.trigger_up('download',{resIds:this.records.filter(record=>record.data.handler!=='spreadsheet').map(record=>record.res_id),});}}
else{this._super(...arguments);}}});});;

/* /documents_spreadsheet/static/src/js/documents_kanban_controller.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.KanbanController",function(require){"use strict";const DocumentsKanbanController=require("documents.DocumentsKanbanController");const DocumentsControllerMixin=require("documents.controllerMixin");const DocumentsSpreadsheetControllerMixin=require("documents_spreadsheet.DocumentsControllerMixin");const SpreadsheetKanbanController=DocumentsKanbanController.extend(DocumentsSpreadsheetControllerMixin,{events:Object.assign({},DocumentsKanbanController.prototype.events,DocumentsSpreadsheetControllerMixin.events,DocumentsControllerMixin.events),custom_events:Object.assign({},DocumentsKanbanController.prototype.custom_events,DocumentsSpreadsheetControllerMixin.custom_events,DocumentsControllerMixin.custom_events),updateButtons(){this._super(...arguments);DocumentsControllerMixin.updateButtons.apply(this,arguments);DocumentsSpreadsheetControllerMixin.updateButtons.apply(this,arguments);},});return SpreadsheetKanbanController;});;

/* /documents_spreadsheet/static/src/js/documents_kanban_record.js defined in bundle 'web.assets_backend' */
odoo.define("spreadsheet.DocumentsKanbanRecord",function(require){"use strict";const DocumentsKanbanRecord=require("documents.DocumentsKanbanRecord");DocumentsKanbanRecord.include({events:_.extend({"click .o_document_spreadsheet":"_onOpenSheet",},DocumentsKanbanRecord.prototype.events),_onOpenSheet(ev){ev.preventDefault();ev.stopPropagation();if(this.state.data.handler==="spreadsheet"){const activeId=this.state.data.id;if(activeId){this.do_action({type:"ir.actions.client",tag:"action_open_spreadsheet",params:{spreadsheet_id:activeId,},});}}},});});;

/* /documents_spreadsheet/static/src/js/documents_list_controller.js defined in bundle 'web.assets_backend' */
odoo.define("spreadsheet.DocumentsListController",function(require){"use strict";const DocumentsListController=require("documents.DocumentsListController");const DocumentsControllerMixin=require("documents.controllerMixin");const DocumentsSpreadsheetControllerMixin=require("documents_spreadsheet.DocumentsControllerMixin");const SpreadsheetListController=DocumentsListController.extend(DocumentsSpreadsheetControllerMixin,{events:Object.assign({},DocumentsListController.prototype.events,DocumentsSpreadsheetControllerMixin.events,DocumentsControllerMixin.events),custom_events:Object.assign({},DocumentsListController.prototype.custom_events,DocumentsSpreadsheetControllerMixin.custom_events,DocumentsControllerMixin.custom_events),updateButtons(){this._super(...arguments);DocumentsControllerMixin.updateButtons.apply(this,arguments);DocumentsSpreadsheetControllerMixin.updateButtons.apply(this,arguments);},});return SpreadsheetListController;});;

/* /documents_spreadsheet/static/src/js/documents_spreadsheet_controller_mixin.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.DocumentsControllerMixin",function(require){"use strict";const TemplateDialog=require("documents_spreadsheet.TemplateDialog");const{ComponentWrapper}=require("web.OwlCompatibility");const DocumentsSpreadsheetControllerMixin={events:{"click .o_documents_kanban_spreadsheet":"_onNewSpreadSheet",},custom_events:{spreadsheet_created:"_onSpreadsheetCreated",dialog_closed:"_destroyDialog",},updateButtons(){const selectedFolderId=this.searchModel.get("selectedFolderId");this.$buttons[0].querySelector(".o_documents_kanban_spreadsheet").disabled=!selectedFolderId;},_destroyDialog(){if(this.templateDialog){this.templateDialog.destroy();}
this.templateDialog=undefined;},_onNewSpreadSheet:async function(ev){ev.preventDefault();ev.stopPropagation();const context=this.model.get(this.handle).getContext();const searchView=await this.loadFieldView("spreadsheet.template",context,false,"search");this.templateDialog=new ComponentWrapper(this,TemplateDialog,{searchView,folderId:this.searchModel.get("selectedFolderId"),context,});await this.templateDialog.mount(this.el);},_onSpreadsheetCreated(ev){this.do_action({type:"ir.actions.client",tag:"action_open_spreadsheet",params:{spreadsheet_id:ev.data.spreadsheetId,},});},};return DocumentsSpreadsheetControllerMixin;});;

/* /documents_spreadsheet/static/src/js/list_controller.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/list_controller',async function(require){'use strict';let __exports={};const ListController=require("web.ListController");const SpreadsheetSelectorDialog=require("documents_spreadsheet.SpreadsheetSelectorDialog");const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_extended")[Symbol.for("default")];const{_t}=require("web.core");const{createEmptySpreadsheet}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/helpers");const{MAXIMUM_CELLS_TO_INSERT}=require("@documents_spreadsheet/js/o_spreadsheet/constants");const uuidGenerator=new spreadsheet.helpers.UuidGenerator();ListController.include({async _insertListSpreadsheet(){const spreadsheets=await this._rpc({model:"documents.document",method:"get_spreadsheets_to_display",args:[],});const model=this.model.get(this.handle);const threshold=Math.min(model.count,model.limit);const columns=this._getColumnsForSpreadsheet();const maxThreshold=Math.floor(MAXIMUM_CELLS_TO_INSERT/columns.length);const params={spreadsheets,title:_t("Select a spreadsheet to insert your list"),threshold,maxThreshold,};const dialog=new SpreadsheetSelectorDialog(this,params).open();dialog.on("confirm",this,this._insertInSpreadsheet);},_getColumnsForSpreadsheet(){const fields=this.model.get(this.handle).fields;return this.renderer.columns.filter((col)=>col.tag==="field").filter((col)=>col.attrs.widget!=="handle").filter((col)=>fields[col.attrs.name].type!=="binary").map((col)=>col.attrs.name);},_getListForSpreadsheet(){const data=this.model.get(this.handle);const columns=this._getColumnsForSpreadsheet();return{model:data.model,domain:data.domain,orderBy:data.orderedBy,context:data.context,columns,};},_getCallbackListInsertion(list,linesNumber,isNewSpreadsheet){return(model)=>{if(!isNewSpreadsheet){const sheetId=uuidGenerator.uuidv4();const sheetIdFrom=model.getters.getActiveSheetId();model.dispatch("CREATE_SHEET",{sheetId,position:model.getters.getVisibleSheets().length,});model.dispatch("ACTIVATE_SHEET",{sheetIdFrom,sheetIdTo:sheetId});}
list.id=model.getters.getNextListId();const fields=this.model.get(this.handle).fields;const types=list.columns.reduce((acc,current)=>{acc[current]=fields[current].type;return acc;},{});model.dispatch("BUILD_ODOO_LIST",{sheetId:model.getters.getActiveSheetId(),anchor:[0,0],list,types,linesNumber,});};},async _insertInSpreadsheet({id:spreadsheet,threshold}){let documentId;let notificationMessage;const list=this._getListForSpreadsheet();if(!spreadsheet){documentId=await createEmptySpreadsheet(this._rpc.bind(this));notificationMessage=_t("New spreadsheet created in Documents");}else{documentId=spreadsheet.id;notificationMessage=notificationMessage=_.str.sprintf(_t("New sheet inserted in '%s'"),spreadsheet.name);}
this.displayNotification({type:"info",message:notificationMessage,sticky:false,});this.do_action({type:"ir.actions.client",tag:"action_open_spreadsheet",params:{active_id:documentId,initCallback:this._getCallbackListInsertion(list,threshold,!spreadsheet),},});},on_attach_callback(){this._super(...arguments);if(this.searchModel){this.searchModel.on("insert-list-spreadsheet",this,this._insertListSpreadsheet);}},on_detach_callback(){this._super(...arguments);if(this.searchModel){this.searchModel.off("insert-list-spreadsheet",this);}},});return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/constants.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/constants',async function(require){'use strict';let __exports={};const DEFAULT_LINES_NUMBER=__exports.DEFAULT_LINES_NUMBER=20;const MAXIMUM_CELLS_TO_INSERT=__exports.MAXIMUM_CELLS_TO_INSERT=20000;const formats=__exports.formats={day:{in:"DD MMM YYYY",out:"DD/MM/YYYY",display:"DD MMM YYYY",interval:"d"},week:{in:"[W]W YYYY",out:"WW/YYYY",display:"[W]W YYYY",interval:"w"},month:{in:"MMMM YYYY",out:"MM/YYYY",display:"MMMM YYYY",interval:"M"},quarter:{in:"Q YYYY",out:"Q/YYYY",display:"[Q]Q YYYY",interval:"Q"},year:{in:"YYYY",out:"YYYY",display:"YYYY",interval:"y"},};const HEADER_STYLE=__exports.HEADER_STYLE={fillColor:"#f2f2f2"};const TOP_LEVEL_STYLE=__exports.TOP_LEVEL_STYLE={bold:true,fillColor:"#f2f2f2"};const MEASURE_STYLE=__exports.MEASURE_STYLE={fillColor:"#f2f2f2",textColor:"#756f6f"};return __exports;});odoo.define(`ds.Constants`,async function(require){return require('@documents_spreadsheet/js/o_spreadsheet/constants');});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/helpers/basic_data_source.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/helpers/basic_data_source',async function(require){'use strict';let __exports={};const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{legacyRPC}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/helpers");const{DataSource}=spreadsheet;const BasicDataSource=__exports.BasicDataSource=class BasicDataSource extends DataSource{constructor(params){super();if(params.rpc&&params.rpc.constructor.name==="ORM"){this.rpc=legacyRPC(params.rpc);}else{this.rpc=params.rpc;}
if(!this.rpc){throw new Error("rpc cannot be undefined");}
this.modelTechnicalName=params.model;this.modelDisplayName=params.modelDisplayName;this.fields=params.fields;}
async _fetchMetadata(){let fieldGetRPC=false;let modelNameRPC=false;if(!this.fields){fieldGetRPC=this.rpc({model:this.modelTechnicalName,method:"fields_get",});}
if(!this.modelDisplayName){modelNameRPC=this.rpc({model:"ir.model",method:"search_read",fields:["name"],domain:[["model","=",this.modelTechnicalName]],});}
if(fieldGetRPC){this.fields=await fieldGetRPC;}
if(modelNameRPC){const result=await modelNameRPC;this.modelDisplayName=result[0]&&result[0].name;}
const metadata={fields:this.fields,modelDisplayName:this.modelDisplayName,};this.fields=undefined;this.modelDisplayName=undefined;return metadata;}
getFieldName(technicalFieldName){const field=this.getField(technicalFieldName);return field?field.string:technicalFieldName;}
getFields(){return(this.metadata&&this.metadata.fields)||{};}
getField(fieldName){return this.metadata&&this.metadata.fields[fieldName];}
getModelName(){return this.metadata&&this.metadata.modelDisplayName;}}
return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/helpers/cached_rpc.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/helpers/cached_rpc',async function(require){'use strict';let __exports={};const CachedRPC=__exports[Symbol.for("default")]=class CachedRPC{constructor(rpc){this.rpc=rpc;this.cache={};this.nameGets={};this.setTimeoutPromise=undefined;}
async delayedRPC(params,options){if(params.method==="fields_get"){const key=JSON.stringify(params);if(!(key in this.cache)){this.cache[key]=this.rpc(params,options);}
return this.cache[key];}
if(params.method==="name_get"){const id=params.args[0];const model=params.model;if(!(model in this.nameGets)){this.nameGets[model]={toFetch:[],};}
if(this.nameGets[model][id]){return this.nameGets[model][id];}
this.nameGets[model].toFetch.push(id);await this._executeNameGetRPCAfterTimeout();return this.nameGets[model][id];}
return this.rpc(params,options);}
async _executeNameGetRPCAfterTimeout(){if(this.setTimeoutPromise){return this.setTimeoutPromise;}
this.setTimeoutPromise=new Promise((resolve,reject)=>{setTimeout(async()=>{try{const promises={};for(const[model,params]of Object.entries(this.nameGets)){if(params.toFetch.length){promises[model]=this.rpc({model,args:[Array.from(new Set(params.toFetch))],method:"name_get",}).then((result)=>{for(const r of result){this.nameGets[model][r[0]]=r[1];}});}
this.nameGets[model].toFetch=[];}
await Promise.all(Object.values(promises));resolve();}catch(e){reject(e);}finally{this.setTimeoutPromise=undefined;}});});return this.setTimeoutPromise;}}
return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/helpers/helpers.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/helpers/helpers',async function(require){'use strict';let __exports={};const{UNTITLED_SPREADSHEET_NAME}=require("@documents_spreadsheet/constants");const CommandResult=require("@documents_spreadsheet/js/o_spreadsheet/plugins/cancelled_reason")[Symbol.for("default")];__exports.intersect=intersect;function intersect(a,b){return a.filter((x)=>b.includes(x));}
__exports.createEmptySpreadsheet=createEmptySpreadsheet;async function createEmptySpreadsheet(rpc){let callRPC;if(rpc&&rpc.constructor.name==="ORM"){callRPC=legacyRPC(rpc);}else{callRPC=rpc;}
if(!callRPC){throw new Error("rpc cannot be undefined");}
return callRPC({model:"documents.document",method:"create",args:[{name:UNTITLED_SPREADSHEET_NAME,mimetype:"application/o-spreadsheet",handler:"spreadsheet",raw:"{}",},],});}
__exports.getMaxObjectId=getMaxObjectId;function getMaxObjectId(o){const keys=Object.keys(o);if(!keys.length){return 0;}
const nums=keys.map((id)=>parseInt(id,10));const max=Math.max(...nums);return max;}
__exports.checkFiltersTypeValueCombination=checkFiltersTypeValueCombination;function checkFiltersTypeValueCombination(type,value){if(value!==undefined){switch(type){case"text":if(typeof value!=="string"){return CommandResult.InvalidValueTypeCombination;}
break;case"date":if(typeof value!=="object"||Array.isArray(value)){return CommandResult.InvalidValueTypeCombination;}
break;case"relation":if(!Array.isArray(value)){return CommandResult.InvalidValueTypeCombination;}
break;}}
return CommandResult.Success;}
__exports.legacyRPC=legacyRPC;function legacyRPC(orm){return(params)=>{params={...params};const model=params.model;delete params.model;const method=params.method;delete params.method;if(params.groupBy){params.groupby=params.groupBy;delete params.groupBy;}
if(params.orderBy){params.order=params.orderBy.map((order)=>order.name+(order.asc!==false?" ASC":" DESC")).join(", ");delete params.orderBy;}
const{args,...kwargs}=params;return orm.call(model,method,args||[],kwargs);};}
return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/helpers/list_data_source.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/helpers/list_data_source',async function(require){'use strict';let __exports={};const{BasicDataSource}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/basic_data_source");const{_t}=require("web.core");const ListDataSource=__exports[Symbol.for("default")]=class ListDataSource extends BasicDataSource{constructor(params){super(params);this.labels={};this.limit=params.limit||0;this.definition=params.definition;this.setTimeoutPromise=undefined;this.computedDomain=this.definition.domain;}
async _fetch(){const data=await this.rpc({model:this.definition.model,method:"search_read",context:this.definition.context,domain:this.computedDomain,fields:this.definition.columns.filter(f=>this.getField(f)),orderBy:this.definition.orderBy,limit:this.limit,});const proms=[];for(const column of this.definition.columns){const field=this.getField(column);if(!field){continue;}
if(["one2many","many2many"].includes(field.type)){let ids=[];for(const record of data){ids=ids.concat(record[column]);}
ids=Array.from(new Set(ids));for(const id of ids){proms.push(this._fetchLabel(field,id));}}}
await Promise.all(proms);return data;}
getComputedDomain(){return this.computedDomain;}
setComputedDomain(computedDomain){this.computedDomain=computedDomain;}
_fetchAfterTimeout(){if(!this.setTimeoutPromise){this.setTimeoutPromise=new Promise((resolve)=>{setTimeout(async()=>{await this.get({forceFetch:true});this.setTimeoutPromise=undefined;resolve();});});}}
_addLabel(model,id,label){if(!(model in this.labels)){this.labels[model]={};}
this.labels[model][id]=label;}
_getLabel(model,id){return(this.labels[model]&&this.labels[model][id])||undefined;}
async _fetchLabel(field,id){const model=field.relation
let label;try{const rpc=await this.rpc({model,method:"name_get",args:[parseInt(id,10)],});label=rpc;}catch(e){label=e;}
this._addLabel(model,id,label);}
_getX2Many(field,id){const model=field.relation;const label=this._getLabel(model,id);if(label===undefined){this._fetchLabel(field,id).then(()=>this.trigger("data-loaded"));return undefined;}
if(label instanceof Error){throw label;}
return label;}
getRecordField(position,fieldName){if(position>=this.limit){this.limit=position+1;this._fetchAfterTimeout();return undefined;}
if(!this.data){this._fetchAfterTimeout();return undefined;}
const record=this.data[position];if(!record){return"";}
const field=this.getField(fieldName);if(!field){throw new Error(_.str.sprintf(_t("The field %s does not exist or you do not have access to that field"),fieldName));}
if(field.type==="many2one"){return record[fieldName].length===2?record[fieldName][1]:"";}
if(field.type==="one2many"||field.type==="many2many"){const labels=record[fieldName].map((id)=>this._getX2Many(field,id));return labels.join(", ");}
if(field.type==="selection"){const key=record[fieldName];const value=field.selection.find((array)=>array[0]===key);return value?value[1]:"";}
if(field.type==="boolean"){return record[fieldName]?"TRUE":"FALSE";}
return record[fieldName]||"";}}
return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/helpers/odoo_functions_helpers.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/helpers/odoo_functions_helpers',async function(require){'use strict';let __exports={};const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{parse}=spreadsheet;__exports.getFirstPivotFunction=getFirstPivotFunction;function getFirstPivotFunction(formula){return _getOdooFunctions(formula).find((fn)=>fn.isPivot);}
__exports.getFirstListFunction=getFirstListFunction;function getFirstListFunction(formula){return _getOdooFunctions(formula).find((fn)=>fn.isList);}
__exports.getNumberOfPivotFormulas=getNumberOfPivotFormulas;function getNumberOfPivotFormulas(formula){return _getOdooFunctions(formula).filter((fn)=>fn.isPivot).length;}
__exports.getNumberOfListFormulas=getNumberOfListFormulas;function getNumberOfListFormulas(formula){return _getOdooFunctions(formula).filter((fn)=>fn.isList).length;}
function _getOdooFunctions(formula){let ast;try{ast=parse(formula);}catch(_){return[];}
return _getOdooFunctionsFromAST(ast);}
function _getOdooFunctionsFromAST(ast){switch(ast.type){case"UNARY_OPERATION":return _getOdooFunctionsFromAST(ast.right);case"BIN_OPERATION":{return _getOdooFunctionsFromAST(ast.left).concat(_getOdooFunctionsFromAST(ast.right));}
case"FUNCALL":{const functionName=ast.value;if(["PIVOT","PIVOT.HEADER","PIVOT.POSITION"].includes(functionName)){return[{functionName,args:ast.args,isPivot:true}];}else if(["LIST","LIST.HEADER"].includes(functionName)){return[{functionName,args:ast.args,isList:true}];}else{return ast.args.map((arg)=>_getOdooFunctionsFromAST(arg)).flat();}}
default:return[];}}
return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/helpers/pivot_cache.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_cache',async function(require){'use strict';let __exports={};const{_t}=require("web.core");const Domain=require("web.Domain");const pyUtils=require("web.py_utils");const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{toString}=spreadsheet.helpers;const functionRegistry=spreadsheet.registries.functionRegistry;function chunkBy2(arr){return Array.from({length:arr.length/2},()=>arr.splice(0,2));}
function groupDomainElements(pivotFormulaDomainArgs){return chunkBy2(pivotFormulaDomainArgs).map((chunk)=>chunk.join(","));}
const PivotCache=__exports[Symbol.for("default")]=class PivotCache{constructor(data){this._cols=data.cols;this._colStructure=data.colStructure;this._orderedMeasureIds=data.orderedMeasureIds;this._fieldValues={};for(let fieldName of Object.keys(this._orderedMeasureIds)){this._fieldValues[fieldName]=this._orderedMeasureIds[fieldName].map(([fieldValue])=>fieldValue);}
this._labels=data.labels;this._rows=data.rows;this._values=data.values;this._cacheKeys=[...data.values.keys()];this._usedValueDomains=new Set();this._usedHeaderDomains=new Set();this._formulaToDomain=data.formulaToDomain;}
getRows(){return this._rows;}
getRowCount(){return this._rows.length;}
getColLevelIdentifier(level){return this._colStructure[level];}
getFieldValues(fieldName){if(!(fieldName in this._fieldValues)){throw new Error(`Cannot find any pivot values for field "${fieldName}"`);}
return this._fieldValues[fieldName];}
getGroupLabel(groupBy,groupValue){return this._labels[groupBy]&&this._labels[groupBy][groupValue];}
isGroupLabelLoaded(groupBy,groupValue){return groupValue in this._labels[groupBy];}
getMeasureName(columnIndex){const columnValues=this._cols[columnIndex];return columnValues[columnValues.length-1].slice().pop();}
getColumnValues(columnIndex){const columnValues=this._cols[columnIndex];const values=columnValues[columnValues.length-1].slice();values.pop();return values;}
getColGroupHierarchy(topGroupIndex,subgroupIndex){return this._cols[topGroupIndex][subgroupIndex];}
getRowValues(rowIndex){return this._rows[rowIndex];}
getColGroupByLevels(){return this._cols[0].length-1;}
getTopHeaderCount(){return this._cols.length;}
getTopGroupIndex(groupValues){return this._cols.findIndex((topGroup)=>{const index=topGroup.findIndex((values)=>JSON.stringify(values)===JSON.stringify(groupValues));return index!==-1;});}
getRowIndex(groupValues){const stringifiedValues=JSON.stringify(groupValues);return this._rows.findIndex((values)=>JSON.stringify(values)===stringifiedValues);}
getSubgroupLevel(groupValues){return groupValues.length-1;}
isUsedValue(pivotArgs){return this._usedValueDomains.has(pivotArgs.join());}
isUsedHeader(pivotArgs){return this._usedHeaderDomains.has(pivotArgs.join());}
markAsValueUsed(domain,measure){const toTag=domain.slice();toTag.unshift(measure);this._usedValueDomains.add(toTag.join());}
markAsHeaderUsed(domain){this._usedHeaderDomains.add(domain.join());}
getMeasureValue(measureName,operator,domain){const measureIds=this._computeMeasureIds(domain);return this._aggregateMeasure(measureIds,measureName,operator);}
addLabel(field,fieldValue,label){this._labels[field]={...this._labels[field],[fieldValue]:label};}
getDomainFromFormula(args){const parsedFormulaDomain=groupDomainElements(args.slice(2));const formulaDomains=Object.keys(this._formulaToDomain).filter((cellDomain)=>{const parsedCellDomain=groupDomainElements(cellDomain.split(","));return parsedFormulaDomain.every((v)=>parsedCellDomain.includes(v));});const domains=formulaDomains.map((formulaDomain)=>Domain.prototype.arrayToString(this._formulaToDomain[formulaDomain]));return pyUtils.assembleDomains(domains,"OR");}
_computeMeasureIds(domain){let returnValue=this._cacheKeys;let i=0;while(i<domain.length&&returnValue.length){const field=toString(domain[i]);if(!(field in this._orderedMeasureIds)){return[];}
const value=toString(domain[i+1]);if(!this._fieldValues[field].includes(value)){return[];}
const[,measureIds]=field in this._orderedMeasureIds&&this._orderedMeasureIds[field].find(([fieldValue])=>fieldValue===value);returnValue=measureIds.filter((x)=>returnValue.includes(x));i+=2;}
return returnValue;}
_aggregateMeasure(measureIds,measureName,operator){const functions=functionRegistry.mapping;if(measureIds.length===0){return"";}
if(measureIds.length===1){return this._values[measureIds[0]][measureName]||"";}
switch(operator){case"array_agg":throw Error(_.str.sprintf(_t("Not implemented: %s"),operator));case"count":return functions.COUNT(...measureIds.map((id)=>this._values[id][measureName]||0));case"count_distinct":return functions.COUNTUNIQUE(...measureIds.map((id)=>measureIds[id][measureName]||0));case"bool_and":return functions.AND(...measureIds.map((id)=>this._values[id][measureName]||0));case"bool_or":return functions.OR(...measureIds.map((id)=>this._values[id][measureName]||0));case"max":return functions.MAX(...measureIds.map((id)=>this._values[id][measureName]||0));case"min":return functions.MIN(...measureIds.map((id)=>this._values[id][measureName]||0));case"avg":return functions["AVERAGE.WEIGHTED"](...measureIds.map((id)=>[this._values[id][measureName]||0,this._values[id]["count"],]).flat());case"sum":return functions.SUM(...measureIds.map((id)=>this._values[id][measureName]||0));default:console.warn(_.str.sprintf(_t("Unknown operator: %s"),operator));return"";}}}
return __exports;});odoo.define(`documents_spreadsheet.PivotCache`,async function(require){return require('@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_cache')[Symbol.for("default")];});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/helpers/pivot_data_source.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_data_source',async function(require){'use strict';let __exports={};const{_t}=require("web.core");const Domain=require("web.Domain");const pyUtils=require("web.py_utils");const{BasicDataSource}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/basic_data_source");const PivotCache=require("@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_cache")[Symbol.for("default")];const{formats}=require("@documents_spreadsheet/js/o_spreadsheet/constants");const{intersect}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/helpers");const PivotDataSource=__exports[Symbol.for("default")]=class PivotDataSource extends BasicDataSource{constructor(params){super(params);this.definition=params.definition;this.computedDomain=this.definition.domain;}
async _fetch(params={}){const result=await this.rpc({model:this.definition.model,method:"read_group",context:this.definition.context,domain:params.initialDomain?this.definition.domain:this.computedDomain,fields:this.definition.measures.map((elt)=>elt.field==="__count"?elt.field:elt.field+":"+elt.operator),groupBy:this.definition.rowGroupBys.concat(this.definition.colGroupBys),lazy:false,});return this._createCache(result);}
getComputedDomain(){return this.computedDomain;}
setComputedDomain(computedDomain){this.computedDomain=computedDomain;}
async _fetchLabel(field,value){const model=field.relation;let label;try{const rpc=await this.rpc({model,method:"name_get",args:[parseInt(value,10)],});label=rpc;}catch(e){label=new Error(_.str.sprintf(_t("Unable to fetch the label of %s of model %s"),value,model));}
if(this.data){this.data.addLabel(field.name,value,label);}}
async _createCache(readGroups){const formulaToDomain={};const groupBys={};const labels={};const values=[];const fieldNames=this.definition.rowGroupBys.concat(this.definition.colGroupBys);for(let fieldName of fieldNames){labels[fieldName]={};}
for(let readGroup of readGroups){const value={};for(let measure of this.definition.measures){const field=measure.field;value[field]=readGroup[field];}
value["count"]=readGroup["__count"];const formulaDomain=[];const index=values.push(value)-1;for(let fieldName of fieldNames){const{label,id}=this._formatValue(fieldName,readGroup[fieldName]);labels[fieldName][id]=label;let groupBy=groupBys[fieldName]||{};let vals=groupBy[id]||[];vals.push(index);groupBy[id]=vals;groupBys[fieldName]=groupBy;formulaDomain.push(`${fieldName},${id}`);}
formulaToDomain[formulaDomain.join(",")]=readGroup["__domain"];}
const orderedValues=await this._getOrderedValues(this.definition,groupBys);const orderedMeasureIds={};for(const fieldName of fieldNames){orderedMeasureIds[fieldName]=orderedValues[fieldName]?orderedValues[fieldName].map((value)=>[value,groupBys[fieldName][value]||[]]):[];}
const measures=this.definition.measures.map((m)=>m.field);const rows=this._createRows(this.definition.rowGroupBys,orderedMeasureIds);const cols=this._createCols(this.definition.colGroupBys,orderedMeasureIds,measures);const colStructure=this.definition.colGroupBys.slice();colStructure.push("measure");return new PivotCache({cols,colStructure,orderedMeasureIds,labels,rows,values,formulaToDomain,});}
_formatValue(fieldDesc,value){const[fieldName,group]=fieldDesc.split(":");const field=this.metadata.fields[fieldName];let id;let label;if(value instanceof Array){id=value[0];label=value[1];}else{id=value;label=value;}
if(field&&field.type==="selection"){const selection=field.selection.find((x)=>x[0]===id);label=selection&&selection[1];}
if(field&&["date","datetime"].includes(field.type)&&group&&value){const fIn=formats[group]["in"];const fOut=formats[group]["out"];const date=moment(value,fIn);id=date.isValid()?date.format(fOut):false;label=id;}
return{label,id};}
async _getOrderedValues({model,context,domain},groupBys){return Object.fromEntries(await Promise.all(Object.entries(groupBys).map(async([groupBy,measures])=>{const[fieldName,aggregationFunction]=groupBy.split(":");const field=this.metadata.fields[fieldName];let values=Object.keys(measures);const hasUndefined=values.includes("false");values=["date","datetime"].includes(field.type)?this._orderDateValues(values.filter((value)=>value!=="false"),aggregationFunction):await this._orderValues(values,fieldName,field,model,domain,context);if(hasUndefined&&field.type!=="boolean"){values.push("false");}
return[groupBy,values];})));}
_orderDateValues(values,aggregationFunction){return aggregationFunction==="quarter"?values.sort():values.map((value)=>moment(value,formats[aggregationFunction].out)).sort((a,b)=>a-b).map((value)=>value.format(formats[aggregationFunction].out));}
async _orderValues(values,fieldName,field,model,baseDomain,context){const requestField=field.relation?"id":fieldName;values=["boolean","many2one","many2many","integer","float"].includes(field.type)?values.map((value)=>JSON.parse(value)):values;const domainString=pyUtils.assembleDomains([field.relation?"[]":Domain.prototype.arrayToString(baseDomain),Domain.prototype.arrayToString([[requestField,"in",values]]),],"AND");const domain=pyUtils.eval("domain",domainString,{});const records=await this.rpc({model:field.relation?field.relation:model,domain,context:Object.assign({},context,{active_test:false}),method:"search_read",fields:[requestField],orderBy:field.relation?false:[{name:fieldName,asc:true}],});return[...new Set(records.map((record)=>record[requestField].toString()))];}
_createCols(groupBys,values,measures){const cols=[];if(groupBys.length!==0){const shouldFilterChildValues=this._shouldFilterChildValues(groupBys);this._fillColumns(cols,[],[],groupBys,measures,values,false,shouldFilterChildValues);}
for(let field of measures){cols.push([[],[field]]);}
return cols;}
_createRows(groupBys,values){const rows=[];const shouldFilterChildValues=this._shouldFilterChildValues(groupBys);this._fillRows(rows,[],groupBys,values,false,shouldFilterChildValues);rows.push([]);return rows;}
_fillColumns(cols,currentRow,currentCol,groupBys,measures,values,currentIds,shouldFilterChildValues){const field=groupBys[0];if(!field){for(let measure of measures){const row=currentRow.slice();const col=currentCol.slice();row.push(measure);col.push(row);cols.push(col);}
return;}
for(let[id,vals]of values[field]||[]){let ids=currentIds?intersect(currentIds,vals):vals;const newValues=shouldFilterChildValues[field]?this._filterValues(values,ids):values;const row=currentRow.slice();const col=currentCol.slice();row.push(id);col.push(row);this._fillColumns(cols,row,col,groupBys.slice(1),measures,newValues,ids,shouldFilterChildValues);}}
_fillRows(rows,currentRow,groupBys,values,currentIds,shouldFilterChildValues){if(groupBys.length===0){return;}
const fieldName=groupBys[0];for(let[id,vals]of values[fieldName]||[]){let ids=currentIds?intersect(currentIds,vals):vals;const newValues=shouldFilterChildValues[fieldName]?this._filterValues(values,ids):values;const row=currentRow.slice();row.push(id);rows.push(row);this._fillRows(rows,row,groupBys.slice(1),newValues,ids,shouldFilterChildValues);}}
_shouldFilterChildValues(groupBys){let joiningOn=false;const shouldFilterChildValues={};for(const i in groupBys){const fieldDesc=groupBys[i];const[fieldName]=fieldDesc.split(":");const field=this.getField(fieldName);const type=field?field.type:undefined;const nextId=parseInt(i,10)+1;const fieldDescNext=nextId<groupBys.length?groupBys[nextId]:undefined;const fieldNameNext=fieldDescNext?fieldDescNext.split(":")[0]:undefined;const nextField=this.getField(fieldNameNext);const typeNext=nextField?nextField.type:undefined;if(["date","datetime"].includes(type)){joiningOn=fieldName;}
if(["date","datetime"].includes(typeNext)&&joiningOn===fieldNameNext){joiningOn=false;}
shouldFilterChildValues[fieldDesc]=!joiningOn;}
return shouldFilterChildValues;}
_filterValues(values,ids){let filteredValues={};for(const[key,value]of Object.entries(values)){const filteredLabels=[];value.forEach((labelValuesPair)=>{const a=labelValuesPair[1].length?intersect(labelValuesPair[1],ids):[];if(a.length){filteredLabels.push([labelValuesPair[0],a]);}});if(filteredLabels.length){filteredValues[key]=filteredLabels;}}
return filteredValues;}}
return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/helpers/pivot_helpers.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_helpers',async function(require){'use strict';let __exports={};const{_t}=require("web.core");const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{formats}=require("@documents_spreadsheet/js/o_spreadsheet/constants");const{Model}=spreadsheet;const pivotFormulaRegex=__exports.pivotFormulaRegex=/^=.*PIVOT/;const PERIODS=__exports.PERIODS={day:_t("Day"),week:_t("Week"),month:_t("Month"),quarter:_t("Quarter"),year:_t("Year"),};__exports.formatDate=formatDate;function formatDate(field,value){const interval=field.split(":")[1];const output=formats[interval].display;const input=formats[interval].out;const date=moment(value,input);return date.isValid()?date.format(output):_t("(Undefined)");}
__exports.sanitizePivot=sanitizePivot;function sanitizePivot(pivotModel){let measures=_sanitizeFields(pivotModel.metaData.activeMeasures,pivotModel.metaData.measures);measures=pivotModel.metaData.activeMeasures.map((measure)=>{const fieldName=measure.split(":")[0];const fieldDesc=pivotModel.metaData.measures[fieldName];const operator=(fieldDesc.group_operator&&fieldDesc.group_operator.toLowerCase())||(fieldDesc.type==="many2one"?"count_distinct":"sum");return{field:measure,operator,};});const rowGroupBys=_sanitizeFields(pivotModel.metaData.fullRowGroupBys,pivotModel.metaData.fields);const colGroupBys=_sanitizeFields(pivotModel.metaData.fullColGroupBys,pivotModel.metaData.fields);return{model:pivotModel.metaData.resModel,rowGroupBys,colGroupBys,measures,domain:pivotModel.searchParams.domain,context:pivotModel.searchParams.context,};}
__exports.getDataFromTemplate=getDataFromTemplate;async function getDataFromTemplate(rpc,templateId){let[{data}]=await rpc({method:"read",model:"spreadsheet.template",args:[templateId,["data"]],});data=base64ToJson(data);const model=new Model(data,{mode:"headless",evalContext:{env:{delayedRPC:rpc,services:{rpc},},},});await model.waitForIdle();model.dispatch("CONVERT_PIVOT_FROM_TEMPLATE");return model.exportData();}
function _sanitizeFields(fields,allFields){return fields.map((field)=>{let[fieldName,group]=field.split(":");const fieldDesc=allFields[fieldName];if(["date","datetime"].includes(fieldDesc.type)){if(!group){group="month";}
return`${fieldName}:${group}`;}
return fieldName;});}
function utf8ToBase64(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function toSolidBytes(match,p1){return String.fromCharCode("0x"+p1);}));}
function base64ToUtf8(str){return decodeURIComponent(atob(str).split("").map((c)=>"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)).join(""));}
__exports.jsonToBase64=jsonToBase64;function jsonToBase64(json){return utf8ToBase64(JSON.stringify(json));}
__exports.base64ToJson=base64ToJson;function base64ToJson(string){return JSON.parse(base64ToUtf8(string));}
return __exports;});odoo.define(`documents_spreadsheet.pivot_utils`,async function(require){return require('@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_helpers');});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/o_spreadsheet.js defined in bundle 'web.assets_backend' */
(function(exports,owl){'use strict';function _interopNamespace(e){if(e&&e.__esModule)return e;var n=Object.create(null);if(e){Object.keys(e).forEach(function(k){if(k!=='default'){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:true,get:function(){return e[k];}});}});}
n["default"]=e;return Object.freeze(n);}
var owl__namespace=_interopNamespace(owl);let _translate=(s)=>s;function sprintf(s,...values){if(values.length===1&&typeof values[0]==="object"){const valuesDict=values[0];s=s.replace(/\%\(?([^\)]+)\)s/g,(match,value)=>valuesDict[value]);}
else if(values.length>0){s=s.replace(/\%s/g,()=>values.shift());}
return s;}
function setTranslationMethod(tfn){_translate=tfn;}
const _t=function(s,...values){return sprintf(_translate(s),...values);};const _lt=function(s,...values){return{toString:function(){return sprintf(_translate(s),...values);},};};const BACKGROUND_GRAY_COLOR="#f5f5f5";const BACKGROUND_HEADER_COLOR="#F8F9FA";const BACKGROUND_HEADER_SELECTED_COLOR="#E8EAED";const BACKGROUND_HEADER_ACTIVE_COLOR="#595959";const TEXT_HEADER_COLOR="#666666";const SELECTION_BORDER_COLOR="#3266ca";const HEADER_BORDER_COLOR="#C0C0C0";const CELL_BORDER_COLOR="#E2E3E3";const BACKGROUND_CHART_COLOR="#FFFFFF";const MENU_ITEM_DISABLED_COLOR="#CACACA";const MIN_ROW_HEIGHT=10;const MIN_COL_WIDTH=5;const HEADER_HEIGHT=26;const HEADER_WIDTH=48;const TOPBAR_HEIGHT=63;const BOTTOMBAR_HEIGHT=36;const DEFAULT_CELL_WIDTH=96;const DEFAULT_CELL_HEIGHT=23;const SCROLLBAR_WIDTH$1=15;const PADDING_AUTORESIZE=3;const AUTOFILL_EDGE_LENGTH=8;const ICON_EDGE_LENGTH=18;const UNHIDE_ICON_EDGE_LENGTH=14;const MIN_CF_ICON_MARGIN=4;const MIN_CELL_TEXT_MARGIN=4;const CF_ICON_EDGE_LENGTH=15;const LINK_TOOLTIP_HEIGHT=43;const LINK_TOOLTIP_WIDTH=220;const MENU_WIDTH=200;const MENU_ITEM_HEIGHT=24;const MENU_SEPARATOR_BORDER_WIDTH=1;const MENU_SEPARATOR_PADDING=5;const MENU_SEPARATOR_HEIGHT=MENU_SEPARATOR_BORDER_WIDTH+2*MENU_SEPARATOR_PADDING;const FIGURE_BORDER_SIZE=1;const DEFAULT_FONT_WEIGHT="400";const DEFAULT_FONT_SIZE=10;const HEADER_FONT_SIZE=11;const DEFAULT_FONT="'Roboto', arial";const DEFAULT_BORDER_DESC=["thin","#000"];const LINK_COLOR="#00f";const DATETIME_FORMAT=/[ymd:]/;const INCORRECT_RANGE_STRING="#REF";const MAX_HISTORY_STEPS=99;const DEFAULT_REVISION_ID="START_REVISION";const MAX_CHAR_LABEL=20;const DEBOUNCE_TIME=200;const MESSAGE_VERSION=1;const LOADING="Loading...";const DEFAULT_ERROR_MESSAGE=_lt("Invalid expression");const FORBIDDEN_IN_EXCEL_REGEX=/'|\*|\?|\/|\\|\[|\]/;const NULL_FORMAT=undefined;const FORMULA_REF_IDENTIFIER="|";const CURRENT_MILLENIAL=2000;const CURRENT_YEAR=new Date().getFullYear();const INITIAL_1900_DAY$1=new Date(1899,11,30);const INITIAL_JS_DAY=new Date(0);const DATE_JS_1900_OFFSET=INITIAL_JS_DAY-INITIAL_1900_DAY$1;const mdyDateRegexp=/^\d{1,2}(\/|-|\s)\d{1,2}((\/|-|\s)\d{1,4})?$/;const ymdDateRegexp=/^\d{3,4}(\/|-|\s)\d{1,2}(\/|-|\s)\d{1,2}$/;const timeRegexp=/((\d+(:\d+)?(:\d+)?\s*(AM|PM))|(\d+:\d+(:\d+)?))$/;function parseDateTime(str){str=str.trim();let time;const timeMatch=str.match(timeRegexp);if(timeMatch){time=parseTime(timeMatch[0]);if(time===null){return null;}
str=str.replace(timeMatch[0],"").trim();}
let date;const mdyDateMatch=str.match(mdyDateRegexp);const ymdDateMatch=str.match(ymdDateRegexp);if(mdyDateMatch||ymdDateMatch){let dateMatch;if(mdyDateMatch){dateMatch=mdyDateMatch[0];date=parseDate(dateMatch,"mdy");}
else{dateMatch=ymdDateMatch[0];date=parseDate(dateMatch,"ymd");}
if(date===null){return null;}
str=str.replace(dateMatch,"").trim();}
if(str!==""||!(date||time)){return null;}
if(date&&time){return{value:date.value+time.value,format:date.format+" "+(time.format==="hhhh:mm:ss"?"hh:mm:ss":time.format),jsDate:new Date(date.jsDate.getFullYear()+time.jsDate.getFullYear()-1899,date.jsDate.getMonth()+time.jsDate.getMonth()-11,date.jsDate.getDate()+time.jsDate.getDate()-30,date.jsDate.getHours()+time.jsDate.getHours(),date.jsDate.getMinutes()+time.jsDate.getMinutes(),date.jsDate.getSeconds()+time.jsDate.getSeconds()),};}
return date||time;}
function parseDate(str,dateFormat){const isMDY=dateFormat==="mdy";const isYMD=dateFormat==="ymd";if(isMDY||isYMD){const parts=str.split(/\/|-|\s/);const monthIndex=isMDY?0:1;const dayIndex=isMDY?1:2;const yearIndex=isMDY?2:0;const month=Number(parts[monthIndex]);const day=Number(parts[dayIndex]);const leadingZero=(parts[monthIndex].length===2&&month<10)||(parts[dayIndex].length===2&&day<10);const year=parts[yearIndex]?inferYear(parts[yearIndex]):CURRENT_YEAR;const jsDate=new Date(year,month-1,day);const sep=str.match(/\/|-|\s/)[0];if(jsDate.getMonth()!==month-1||jsDate.getDate()!==day){return null;}
const delta=jsDate-INITIAL_1900_DAY$1;let format=leadingZero?`mm${sep}dd`:`m${sep}d`;if(parts[yearIndex]){format=isMDY?format+sep+"yyyy":"yyyy"+sep+format;}
return{value:Math.round(delta/86400000),format:format,jsDate,};}
return null;}
function inferYear(str){const nbr=Number(str);switch(str.length){case 1:return CURRENT_MILLENIAL+nbr;case 2:const offset=CURRENT_MILLENIAL+nbr>CURRENT_YEAR+10?-100:0;const base=CURRENT_MILLENIAL+offset;return base+nbr;case 3:case 4:return nbr;}
return 0;}
function parseTime(str){str=str.trim();if(timeRegexp.test(str)){const isAM=/AM/i.test(str);const isPM=/PM/i.test(str);const strTime=isAM||isPM?str.substring(0,str.length-2).trim():str;const parts=strTime.split(/:/);const isMinutes=parts.length>=2;const isSeconds=parts.length===3;let hours=Number(parts[0]);let minutes=isMinutes?Number(parts[1]):0;let seconds=isSeconds?Number(parts[2]):0;let format=isSeconds?"hh:mm:ss":"hh:mm";if(isAM||isPM){format+=" a";}
else if(!isMinutes){return null;}
if(hours>=12&&isAM){hours-=12;}
else if(hours<12&&isPM){hours+=12;}
minutes+=Math.floor(seconds/60);seconds%=60;hours+=Math.floor(minutes/60);minutes%=60;if(hours>=24){format="hhhh:mm:ss";}
const jsDate=new Date(1899,11,30,hours,minutes,seconds);return{value:hours/24+minutes/1440+seconds/86400,format:format,jsDate:jsDate,};}
return null;}
function numberToJsDate(value){const truncValue=Math.trunc(value);let date=new Date(truncValue*86400*1000-DATE_JS_1900_OFFSET);let time=value-truncValue;time=time<0?1+time:time;const hours=Math.round(time*24);const minutes=Math.round((time-hours/24)*24*60);const seconds=Math.round((time-hours/24-minutes/24/60)*24*60*60);date.setHours(hours);date.setMinutes(minutes);date.setSeconds(seconds);return date;}
function formatDateTime(internalDate){const dateTimeFormat=internalDate.format;const jsDate=internalDate.jsDate||numberToJsDate(internalDate.value);const indexH=dateTimeFormat.indexOf("h");let strDate="";let strTime="";if(indexH>0){strDate=formatJSDate(jsDate,dateTimeFormat.substring(0,indexH-1));strTime=formatJSTime(jsDate,dateTimeFormat.substring(indexH));}
else if(indexH===0){strTime=formatJSTime(jsDate,dateTimeFormat);}
else if(indexH<0){strDate=formatJSDate(jsDate,dateTimeFormat);}
return strDate+(strDate&&strTime?" ":"")+strTime;}
function formatJSDate(jsDate,format){const sep=format.match(/\/|-|\s/)[0];const parts=format.split(sep);return parts.map((p)=>{switch(p){case"d":return jsDate.getDate();case"dd":return jsDate.getDate().toString().padStart(2,"0");case"m":return jsDate.getMonth()+1;case"mm":return String(jsDate.getMonth()+1).padStart(2,"0");case"yyyy":return jsDate.getFullYear();default:throw new Error(`invalid format: ${format}`);}}).join(sep);}
function formatJSTime(jsDate,format){let parts=format.split(/:|\s/);const dateHours=jsDate.getHours();const isMeridian=parts[parts.length-1]==="a";let hours=dateHours;let meridian="";if(isMeridian){hours=hours===0?12:hours>12?hours-12:hours;meridian=dateHours>=12?" PM":" AM";parts.pop();}
return(parts.map((p)=>{switch(p){case"hhhh":const helapsedHours=Math.floor((jsDate.getTime()-INITIAL_1900_DAY$1)/(60*60*1000));return helapsedHours.toString();case"hh":return hours.toString().padStart(2,"0");case"mm":return jsDate.getMinutes().toString().padStart(2,"0");case"ss":return jsDate.getSeconds().toString().padStart(2,"0");default:throw new Error(`invalid format: ${format}`);}}).join(":")+meridian);}
const formulaNumberRegexp=/^-?\d+(\.?\d*(e\d+)?)?(\s*%)?|^-?\.\d+(\s*%)?/;const numberRegexp=/^-?\d+(,\d+)*(\.?\d*(e\d+)?)?(\s*%)?$|^-?\.\d+(\s*%)?$/;function isNumber(value){return numberRegexp.test(value.trim());}
const commaRegexp=/,/g;function parseNumber(str){let n=Number(str.replace(commaRegexp,""));if(isNaN(n)&&str.includes("%")){n=Number(str.split("%")[0]);if(!isNaN(n)){return n/100;}}
return n;}
const decimalStandardRepresentation=new Intl.NumberFormat("en-US",{useGrouping:false,maximumFractionDigits:10,});function formatStandardNumber(n){if(Number.isInteger(n)){return n.toString();}
return decimalStandardRepresentation.format(n);}
let decimalRepresentations=[];const maximumDecimalPlaces=20;function formatDecimal(n,decimals,sep=""){if(n<0){return"-"+formatDecimal(-n,decimals);}
const maxDecimals=decimals>=maximumDecimalPlaces?maximumDecimalPlaces:decimals;let formatter=decimalRepresentations[maxDecimals];if(!formatter){formatter=new Intl.NumberFormat("en-US",{minimumFractionDigits:maxDecimals,maximumFractionDigits:maxDecimals,useGrouping:false,});decimalRepresentations[maxDecimals]=formatter;}
let result=formatter.format(n);if(sep){let p=result.indexOf(".");result=result.replace(/\d(?=(?:\d{3})+(?:\.|$))/g,(m,i)=>p<0||i<p?`${m}${sep}`:m);}
return result;}
function formatNumber(value,format){const parts=format.split(";");const l=parts.length;if(value<0){if(l>1){return _formatValue(-value,parts[1]);}
else{return"-"+_formatValue(-value,parts[0]);}}
const index=l===3&&value===0?2:0;return _formatValue(value,parts[index]);}
function _formatValue(value,format){const parts=format.split(".");const decimals=parts.length===1?0:parts[1].match(/0/g).length;const separator=parts[0].includes(",")?",":"";const isPercent=format.includes("%");if(isPercent){value=value*100;}
const rawNumber=formatDecimal(value,decimals,separator);if(isPercent){return rawNumber+"%";}
return rawNumber;}
function assert(condition,message){if(!condition()){throw new Error(message);}}
const expectNumberValueError=(value)=>_lt("The function [[FUNCTION_NAME]] expects a number value, but '%s' is a string, and cannot be coerced to a number.",value);function toNumber(value){switch(typeof value){case"number":return value;case"boolean":return value?1:0;case"string":if(isNumber(value)||value===""){return parseNumber(value);}
const internalDate=parseDateTime(value);if(internalDate){return internalDate.value;}
throw new Error(expectNumberValueError(value));default:return 0;}}
function strictToNumber(value){if(value===""){throw new Error(expectNumberValueError(value));}
return toNumber(value);}
function toString(value){switch(typeof value){case"string":return value;case"number":return value.toString();case"boolean":return value?"TRUE":"FALSE";default:return"";}}
const expectBooleanValueError=(value)=>_lt("The function [[FUNCTION_NAME]] expects a boolean value, but '%s' is a text, and cannot be coerced to a number.",value);function toBoolean(value){switch(typeof value){case"boolean":return value;case"string":if(value){let uppercaseVal=value.toUpperCase();if(uppercaseVal==="TRUE"){return true;}
if(uppercaseVal==="FALSE"){return false;}
throw new Error(expectBooleanValueError(value));}
else{return false;}
case"number":return value?true:false;default:return false;}}
function strictToBoolean(value){if(value===""){throw new Error(expectBooleanValueError(value));}
return toBoolean(value);}
function toJsDate(value){return numberToJsDate(toNumber(value));}
function visitArgs(args,cellCb,dataCb){for(let arg of args){if(Array.isArray(arg)){const lenRow=arg.length;const lenCol=arg[0].length;for(let y=0;y<lenCol;y++){for(let x=0;x<lenRow;x++){cellCb(arg[x][y]);}}}
else{dataCb(arg);}}}
function visitAny(args,cb){visitArgs(args,cb,cb);}
function visitNumbers(args,cb){visitArgs(args,(cellValue)=>{if(typeof cellValue==="number"){cb(cellValue);}},(argValue)=>{cb(strictToNumber(argValue));});}
function reduceArgs(args,cellCb,dataCb,initialValue){let val=initialValue;for(let arg of args){if(Array.isArray(arg)){const lenRow=arg.length;const lenCol=arg[0].length;for(let y=0;y<lenCol;y++){for(let x=0;x<lenRow;x++){val=cellCb(val,arg[x][y]);}}}
else{val=dataCb(val,arg);}}
return val;}
function reduceAny(args,cb,initialValue){return reduceArgs(args,cb,cb,initialValue);}
function reduceNumbers(args,cb,initialValue){return reduceArgs(args,(acc,ArgValue)=>{if(typeof ArgValue==="number"){return cb(acc,ArgValue);}
return acc;},(acc,argValue)=>{return cb(acc,strictToNumber(argValue));},initialValue);}
function reduceNumbersTextAs0(args,cb,initialValue){return reduceArgs(args,(acc,ArgValue)=>{if(ArgValue!==undefined&&ArgValue!==null){if(typeof ArgValue==="number"){return cb(acc,ArgValue);}
else if(typeof ArgValue==="boolean"){return cb(acc,toNumber(ArgValue));}
else{return cb(acc,0);}}
return acc;},(acc,argValue)=>{return cb(acc,toNumber(argValue));},initialValue);}
function conditionalVisitArgs(args,cellCb,dataCb){for(let arg of args){if(Array.isArray(arg)){const lenRow=arg.length;const lenCol=arg[0].length;for(let y=0;y<lenCol;y++){for(let x=0;x<lenRow;x++){if(!cellCb(arg[x][y]))
return;}}}
else{if(!dataCb(arg))
return;}}}
function conditionalVisitBoolean(args,cb){return conditionalVisitArgs(args,(ArgValue)=>{if(typeof ArgValue==="boolean"){return cb(ArgValue);}
if(typeof ArgValue==="number"){return cb(ArgValue?true:false);}
return true;},(argValue)=>{if(argValue!==undefined&&argValue!==null){return cb(strictToBoolean(argValue));}
return true;});}
function getPredicate(descr,isQuery){let operator;let operand;let subString=descr.substring(0,2);if(subString==="<="||subString===">="||subString==="<>"){operator=subString;operand=descr.substring(2);}
else{subString=descr.substring(0,1);if(subString==="<"||subString===">"||subString==="="){operator=subString;operand=descr.substring(1);}
else{operator="=";operand=descr;}}
if(isNumber(operand)){operand=toNumber(operand);}
else if(operand==="TRUE"||operand==="FALSE"){operand=toBoolean(operand);}
const result={operator,operand};if(typeof operand==="string"){if(isQuery){operand+="*";}
result.regexp=operandToRegExp(operand);}
return result;}
function operandToRegExp(operand){let exp="";let predecessor="";for(let char of operand){if(char==="?"&&predecessor!=="~"){exp+=".";}
else if(char==="*"&&predecessor!=="~"){exp+=".*";}
else{if(char==="*"||char==="?"){exp=exp.slice(0,-1);}
if(["^",".","[","]","$","(",")","*","+","?","|","{","}","\\"].includes(char)){exp+="\\";}
exp+=char;}
predecessor=char;}
return new RegExp("^"+exp+"$","i");}
function evaluatePredicate(value,criterion){const{operator,operand}=criterion;if(value===undefined||operand===undefined){return false;}
if(typeof operand==="number"&&operator==="="){return toString(value)===toString(operand);}
if(operator==="<>"||operator==="="){let result;if(typeof value===typeof operand){if(typeof value==="string"&&criterion.regexp){result=criterion.regexp.test(value);}
else{result=value===operand;}}
else{result=false;}
return operator==="="?result:!result;}
if(typeof value===typeof operand){switch(operator){case"<":return value<operand;case">":return value>operand;case"<=":return value<=operand;case">=":return value>=operand;}}
return false;}
function visitMatchingRanges(args,cb,isQuery=false){const countArg=args.length;if(countArg%2===1){throw new Error(_lt(`Function [[FUNCTION_NAME]] expects criteria_range and criterion to be in pairs.`));}
const dimRow=args[0].length;const dimCol=args[0][0].length;let predicates=[];for(let i=0;i<countArg-1;i+=2){const criteriaRange=args[i];if(!Array.isArray(criteriaRange)||criteriaRange.length!==dimRow||criteriaRange[0].length!==dimCol){throw new Error(_lt(`Function [[FUNCTION_NAME]] expects criteria_range to have the same dimension`));}
const description=toString(args[i+1]);predicates.push(getPredicate(description,isQuery));}
for(let i=0;i<dimRow;i++){for(let j=0;j<dimCol;j++){let validatedPredicates=true;for(let k=0;k<countArg-1;k+=2){const criteriaValue=args[k][i][j];const criterion=predicates[k/2];validatedPredicates=evaluatePredicate(criteriaValue,criterion);if(!validatedPredicates){break;}}
if(validatedPredicates){cb(i,j);}}}}
function dichotomicPredecessorSearch(range,target){if(target===undefined){return-1;}
const targetType=typeof target;let valMin=undefined;let valMinIndex=undefined;let indexLeft=0;let indexRight=range.length-1;if(typeof range[indexLeft]===targetType&&target<range[indexLeft]){return-1;}
if(typeof range[indexRight]===targetType&&range[indexRight]<=target){return indexRight;}
let indexMedian;let currentIndex;let currentVal;let currentType;while(indexRight-indexLeft>=0){indexMedian=Math.ceil((indexLeft+indexRight)/2);currentIndex=indexMedian;currentVal=range[currentIndex];currentType=typeof currentVal;while(indexLeft<=currentIndex&&targetType!==currentType){currentIndex--;currentVal=range[currentIndex];currentType=typeof currentVal;}
if(currentType===targetType&&currentVal<=target){if(valMin===undefined||valMin<currentVal||(valMin===currentVal&&valMinIndex<currentIndex)){valMin=currentVal;valMinIndex=currentIndex;}}
if(currentType===targetType&&currentVal>target){indexRight=currentIndex-1;}
else{indexLeft=indexMedian+1;}}
return valMinIndex!==undefined?valMinIndex:-1;}
function dichotomicSuccessorSearch(range,target){const targetType=typeof target;let valMax;let valMaxIndex=undefined;let indexLeft=0;let indexRight=range.length-1;if(typeof range[indexLeft]===targetType&&target>range[indexLeft]){return-1;}
if(typeof range[indexRight]===targetType&&range[indexRight]>target){return indexRight;}
let indexMedian;let currentIndex;let currentVal;let currentType;while(indexRight-indexLeft>=0){indexMedian=Math.ceil((indexLeft+indexRight)/2);currentIndex=indexMedian;currentVal=range[currentIndex];currentType=typeof currentVal;while(indexLeft<=currentIndex&&targetType!==currentType){currentIndex--;currentVal=range[currentIndex];currentType=typeof currentVal;}
if(currentType===targetType&&currentVal>=target){if(valMax===undefined||valMax>currentVal||(valMax===currentVal&&valMaxIndex>currentIndex)){valMax=currentVal;valMaxIndex=currentIndex;}}
if(currentType===targetType&&currentVal<=target){indexRight=currentIndex-1;}
else{indexLeft=indexMedian+1;}}
return valMaxIndex!==undefined?valMaxIndex:-1;}
class Registry{constructor(){this.content={};}
add(key,value){this.content[key]=value;return this;}
get(key){const content=this.content[key];if(!content){if(!(key in this.content)){throw new Error(`Cannot find ${key} in this registry!`);}}
return content;}
getAll(){return Object.values(this.content);}
remove(key){delete this.content[key];}}
const ARG_REGEXP=/(.*?)\((.*?)\)(.*)/;const ARG_TYPES=["ANY","BOOLEAN","DATE","NUMBER","STRING","RANGE","RANGE<BOOLEAN>","RANGE<DATE>","RANGE<NUMBER>","RANGE<STRING>","META",];function args(strings){let lines=strings.split("\n");const result=[];for(let l of lines){l=l.trim();if(l){result.push(makeArg(l));}}
return result;}
function makeArg(str){let parts=str.match(ARG_REGEXP);let name=parts[1].trim();let types=[];let isOptional=false;let isRepeating=false;let isLazy=false;let defaultValue;for(let param of parts[2].split(",")){const key=param.trim().toUpperCase();let type=ARG_TYPES.find((t)=>key===t);if(type){types.push(type);}
else if(key==="RANGE<ANY>"){types.push("RANGE");}
else if(key==="OPTIONAL"){isOptional=true;}
else if(key==="REPEATING"){isRepeating=true;}
else if(key==="LAZY"){isLazy=true;}
else if(key.startsWith("DEFAULT=")){defaultValue=param.trim().slice(8);}}
let description=parts[3].trim();const result={name,description,type:types,};if(isOptional){result.optional=true;}
if(isRepeating){result.repeating=true;}
if(isLazy){result.lazy=true;}
if(defaultValue!==undefined){result.default=true;result.defaultValue=defaultValue;}
return result;}
function addMetaInfoFromArg(addDescr){let countArg=0;let minArg=0;let repeatingArg=0;for(let arg of addDescr.args){countArg++;if(!arg.optional&&!arg.repeating&&!arg.default){minArg++;}
if(arg.repeating){repeatingArg++;}}
const descr=addDescr;descr.minArgRequired=minArg;descr.maxArgPossible=repeatingArg?Infinity:countArg;descr.nbrArgRepeating=repeatingArg;descr.getArgToFocus=argTargeting(countArg,repeatingArg);return descr;}
function argTargeting(countArg,repeatingArg){if(!repeatingArg){return(argPosition)=>argPosition;}
if(repeatingArg===1){return(argPosition)=>Math.min(argPosition,countArg);}
const argBeforeRepeat=countArg-repeatingArg;return(argPosition)=>{if(argPosition<=argBeforeRepeat){return argPosition;}
const argAfterRepeat=(argPosition-argBeforeRepeat)%repeatingArg||repeatingArg;return argBeforeRepeat+argAfterRepeat;};}
function validateArguments(args){let previousArgRepeating=false;let previousArgOptional=false;let previousArgDefault=false;for(let current of args){if(current.type.includes("META")&&current.type.length>1){throw new Error(_lt("Function ${name} has an argument that has been declared with more than one type whose type 'META'. The 'META' type can only be declared alone."));}
if(previousArgRepeating&&!current.repeating){throw new Error(_lt("Function ${name} has no-repeatable arguments declared after repeatable ones. All repeatable arguments must be declared last."));}
const previousIsOptional=previousArgOptional||previousArgRepeating||previousArgDefault;const currentIsntOptional=!(current.optional||current.repeating||current.default);if(previousIsOptional&&currentIsntOptional){throw new Error(_lt("Function ${name} has at mandatory arguments declared after optional ones. All optional arguments must be after all mandatory arguments."));}
previousArgRepeating=current.repeating;previousArgOptional=current.optional;previousArgDefault=current.default;}}
var CellValueType;(function(CellValueType){CellValueType["boolean"]="boolean";CellValueType["number"]="number";CellValueType["text"]="text";CellValueType["empty"]="empty";CellValueType["error"]="error";})(CellValueType||(CellValueType={}));function isSheetDependent(cmd){return"sheetId"in cmd;}
function isGridDependent(cmd){return"dimension"in cmd;}
function isTargetDependent(cmd){return"target"in cmd;}
function isZoneDependent(cmd){return"zone"in cmd;}
function isPositionDependent(cmd){return"col"in cmd&&"row"in cmd;}
const invalidateEvaluationCommands=new Set(["RENAME_SHEET","DELETE_SHEET","CREATE_SHEET","ADD_COLUMNS_ROWS","REMOVE_COLUMNS_ROWS","DELETE_CELL","INSERT_CELL","UNDO","REDO",]);const readonlyAllowedCommands=new Set(["START","ACTIVATE_SHEET","COPY","START_SELECTION","SET_SELECTION","ALTER_SELECTION","START_SELECTION_EXPANSION","PREPARE_SELECTION_EXPANSION","STOP_SELECTION","RESIZE_VIEWPORT","SET_VIEWPORT_OFFSET","SELECT_ALL","SELECT_CELL","SELECT_COLUMN","SELECT_ROW","SELECT_FIGURE","MOVE_POSITION","SELECT_SEARCH_NEXT_MATCH","SELECT_SEARCH_PREVIOUS_MATCH","REFRESH_SEARCH","UPDATE_SEARCH","CLEAR_SEARCH","EVALUATE_CELLS","SET_CURRENT_CONTENT","SET_FORMULA_VISIBILITY",]);const coreTypes=new Set(["UPDATE_CELL","UPDATE_CELL_POSITION","CLEAR_CELL","DELETE_CONTENT","ADD_COLUMNS_ROWS","REMOVE_COLUMNS_ROWS","RESIZE_COLUMNS_ROWS","HIDE_COLUMNS_ROWS","UNHIDE_COLUMNS_ROWS","SET_GRID_LINES_VISIBILITY","ADD_MERGE","REMOVE_MERGE","CREATE_SHEET","DELETE_SHEET","DUPLICATE_SHEET","MOVE_SHEET","RENAME_SHEET","ADD_CONDITIONAL_FORMAT","REMOVE_CONDITIONAL_FORMAT","CREATE_FIGURE","DELETE_FIGURE","UPDATE_FIGURE","SET_FORMATTING","CLEAR_FORMATTING","SET_BORDER","SET_DECIMAL","CREATE_CHART","UPDATE_CHART","SORT_CELLS",]);function isCoreCommand(cmd){return coreTypes.has(cmd.type);}
function canExecuteInReadonly(cmd){return readonlyAllowedCommands.has(cmd.type);}
class DispatchResult{constructor(results=[]){if(!Array.isArray(results)){results=[results];}
results=[...new Set(results)];this.reasons=results.filter((result)=>result!==0);}
static get Success(){return new DispatchResult();}
get isSuccessful(){return this.reasons.length===0;}
isCancelledBecause(reason){return this.reasons.includes(reason);}}
exports.CommandResult=void 0;(function(CommandResult){CommandResult[CommandResult["Success"]=0]="Success";CommandResult[CommandResult["CancelledForUnknownReason"]=1]="CancelledForUnknownReason";CommandResult[CommandResult["WillRemoveExistingMerge"]=2]="WillRemoveExistingMerge";CommandResult[CommandResult["MergeIsDestructive"]=3]="MergeIsDestructive";CommandResult[CommandResult["CellIsMerged"]=4]="CellIsMerged";CommandResult[CommandResult["EmptyUndoStack"]=5]="EmptyUndoStack";CommandResult[CommandResult["EmptyRedoStack"]=6]="EmptyRedoStack";CommandResult[CommandResult["NotEnoughElements"]=7]="NotEnoughElements";CommandResult[CommandResult["NotEnoughSheets"]=8]="NotEnoughSheets";CommandResult[CommandResult["MissingSheetName"]=9]="MissingSheetName";CommandResult[CommandResult["DuplicatedSheetName"]=10]="DuplicatedSheetName";CommandResult[CommandResult["ForbiddenCharactersInSheetName"]=11]="ForbiddenCharactersInSheetName";CommandResult[CommandResult["WrongSheetMove"]=12]="WrongSheetMove";CommandResult[CommandResult["WrongSheetPosition"]=13]="WrongSheetPosition";CommandResult[CommandResult["InvalidAnchorZone"]=14]="InvalidAnchorZone";CommandResult[CommandResult["SelectionOutOfBound"]=15]="SelectionOutOfBound";CommandResult[CommandResult["TargetOutOfSheet"]=16]="TargetOutOfSheet";CommandResult[CommandResult["WrongPasteSelection"]=17]="WrongPasteSelection";CommandResult[CommandResult["EmptyClipboard"]=18]="EmptyClipboard";CommandResult[CommandResult["EmptyRange"]=19]="EmptyRange";CommandResult[CommandResult["InvalidRange"]=20]="InvalidRange";CommandResult[CommandResult["InvalidSheetId"]=21]="InvalidSheetId";CommandResult[CommandResult["InputAlreadyFocused"]=22]="InputAlreadyFocused";CommandResult[CommandResult["MaximumRangesReached"]=23]="MaximumRangesReached";CommandResult[CommandResult["InvalidChartDefinition"]=24]="InvalidChartDefinition";CommandResult[CommandResult["EmptyDataSet"]=25]="EmptyDataSet";CommandResult[CommandResult["InvalidDataSet"]=26]="InvalidDataSet";CommandResult[CommandResult["InvalidLabelRange"]=27]="InvalidLabelRange";CommandResult[CommandResult["InvalidAutofillSelection"]=28]="InvalidAutofillSelection";CommandResult[CommandResult["WrongComposerSelection"]=29]="WrongComposerSelection";CommandResult[CommandResult["MinBiggerThanMax"]=30]="MinBiggerThanMax";CommandResult[CommandResult["LowerBiggerThanUpper"]=31]="LowerBiggerThanUpper";CommandResult[CommandResult["MidBiggerThanMax"]=32]="MidBiggerThanMax";CommandResult[CommandResult["MinBiggerThanMid"]=33]="MinBiggerThanMid";CommandResult[CommandResult["FirstArgMissing"]=34]="FirstArgMissing";CommandResult[CommandResult["SecondArgMissing"]=35]="SecondArgMissing";CommandResult[CommandResult["MinNaN"]=36]="MinNaN";CommandResult[CommandResult["MidNaN"]=37]="MidNaN";CommandResult[CommandResult["MaxNaN"]=38]="MaxNaN";CommandResult[CommandResult["ValueUpperInflectionNaN"]=39]="ValueUpperInflectionNaN";CommandResult[CommandResult["ValueLowerInflectionNaN"]=40]="ValueLowerInflectionNaN";CommandResult[CommandResult["MinInvalidFormula"]=41]="MinInvalidFormula";CommandResult[CommandResult["MidInvalidFormula"]=42]="MidInvalidFormula";CommandResult[CommandResult["MaxInvalidFormula"]=43]="MaxInvalidFormula";CommandResult[CommandResult["ValueUpperInvalidFormula"]=44]="ValueUpperInvalidFormula";CommandResult[CommandResult["ValueLowerInvalidFormula"]=45]="ValueLowerInvalidFormula";CommandResult[CommandResult["InvalidSortZone"]=46]="InvalidSortZone";CommandResult[CommandResult["WaitingSessionConfirmation"]=47]="WaitingSessionConfirmation";CommandResult[CommandResult["MergeOverlap"]=48]="MergeOverlap";CommandResult[CommandResult["TooManyHiddenElements"]=49]="TooManyHiddenElements";CommandResult[CommandResult["Readonly"]=50]="Readonly";CommandResult[CommandResult["InvalidOffset"]=51]="InvalidOffset";CommandResult[CommandResult["InvalidViewportSize"]=52]="InvalidViewportSize";CommandResult[CommandResult["FigureDoesNotExist"]=53]="FigureDoesNotExist";})(exports.CommandResult||(exports.CommandResult={}));var ReturnFormatType;(function(ReturnFormatType){ReturnFormatType["FormatFromArgument"]="FormatFromArgument";})(ReturnFormatType||(ReturnFormatType={}));var DIRECTION;(function(DIRECTION){DIRECTION[DIRECTION["UP"]=0]="UP";DIRECTION[DIRECTION["DOWN"]=1]="DOWN";DIRECTION[DIRECTION["LEFT"]=2]="LEFT";DIRECTION[DIRECTION["RIGHT"]=3]="RIGHT";})(DIRECTION||(DIRECTION={}));var LAYERS;(function(LAYERS){LAYERS[LAYERS["Background"]=0]="Background";LAYERS[LAYERS["Highlights"]=1]="Highlights";LAYERS[LAYERS["Clipboard"]=2]="Clipboard";LAYERS[LAYERS["Search"]=3]="Search";LAYERS[LAYERS["Chart"]=4]="Chart";LAYERS[LAYERS["Selection"]=5]="Selection";LAYERS[LAYERS["Autofill"]=6]="Autofill";LAYERS[LAYERS["Headers"]=7]="Headers";})(LAYERS||(LAYERS={}));const DEFAULT_FACTOR=1;const DEFAULT_MODE=0;const DEFAULT_PLACES=0;const DEFAULT_SIGNIFICANCE=1;const ABS={description:_lt("Absolute value of a number."),args:args(`
    value (number) ${_lt("The number of which to return the absolute value.")}
  `),returns:["NUMBER"],compute:function(value){return Math.abs(toNumber(value));},isExported:true,};const ACOS={description:_lt("Inverse cosine of a value, in radians."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse cosine. Must be between -1 and 1, inclusive.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);assert(()=>Math.abs(_value)<=1,_lt("The value (%s) must be between -1 and 1 inclusive.",_value.toString()));return Math.acos(_value);},isExported:true,};const ACOSH={description:_lt("Inverse hyperbolic cosine of a number."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse hyperbolic cosine. Must be greater than or equal to 1.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);assert(()=>_value>=1,_lt("The value (%s) must be greater than or equal to 1.",_value.toString()));return Math.acosh(_value);},isExported:true,};const ACOT={description:_lt("Inverse cotangent of a value."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse cotangent.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);const sign=Math.sign(_value)||1;return(sign*Math.PI)/2-Math.atan(_value);},isExported:true,};const ACOTH={description:_lt("Inverse hyperbolic cotangent of a value."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse hyperbolic cotangent. Must not be between -1 and 1, inclusive.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);assert(()=>Math.abs(_value)>1,_lt("The value (%s) cannot be between -1 and 1 inclusive.",_value.toString()));return Math.log((_value+1)/(_value-1))/2;},isExported:true,};const ASIN={description:_lt("Inverse sine of a value, in radians."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse sine. Must be between -1 and 1, inclusive.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);assert(()=>Math.abs(_value)<=1,_lt("The value (%s) must be between -1 and 1 inclusive.",_value.toString()));return Math.asin(_value);},isExported:true,};const ASINH={description:_lt("Inverse hyperbolic sine of a number."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse hyperbolic sine.")}
  `),returns:["NUMBER"],compute:function(value){return Math.asinh(toNumber(value));},isExported:true,};const ATAN={description:_lt("Inverse tangent of a value, in radians."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse tangent.")}
  `),returns:["NUMBER"],compute:function(value){return Math.atan(toNumber(value));},isExported:true,};const ATAN2={description:_lt("Angle from the X axis to a point (x,y), in radians."),args:args(`
    x (number) ${_lt("The x coordinate of the endpoint of the line segment for which to calculate the angle from the x-axis.")}
    y (number) ${_lt("The y coordinate of the endpoint of the line segment for which to calculate the angle from the x-axis.")}
  `),returns:["NUMBER"],compute:function(x,y){const _x=toNumber(x);const _y=toNumber(y);assert(()=>_x!==0||_y!==0,_lt(`Function [[FUNCTION_NAME]] caused a divide by zero error.`));return Math.atan2(_y,_x);},isExported:true,};const ATANH={description:_lt("Inverse hyperbolic tangent of a number."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse hyperbolic tangent. Must be between -1 and 1, exclusive.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);assert(()=>Math.abs(_value)<1,_lt("The value (%s) must be between -1 and 1 exclusive.",_value.toString()));return Math.atanh(_value);},isExported:true,};const CEILING={description:_lt(`Rounds number up to nearest multiple of factor.`),args:args(`
    value (number) ${_lt("The value to round up to the nearest integer multiple of factor.")}
    factor (number, default=${DEFAULT_FACTOR}) ${_lt("The number to whose multiples value will be rounded.")}
  `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(value,factor=DEFAULT_FACTOR){const _value=toNumber(value);const _factor=toNumber(factor);assert(()=>_factor>=0||_value<=0,_lt("The factor (%s) must be positive when the value (%s) is positive.",_factor.toString(),_value.toString()));return _factor?Math.ceil(_value/_factor)*_factor:0;},isExported:true,};const CEILING_MATH={description:_lt(`Rounds number up to nearest multiple of factor.`),args:args(`
    number (number) ${_lt("The value to round up to the nearest integer multiple of significance.")}
    significance (number, default=${DEFAULT_SIGNIFICANCE}) ${_lt("The number to whose multiples number will be rounded. The sign of significance will be ignored.")}
    mode (number, default=${DEFAULT_MODE}) ${_lt("If number is negative, specifies the rounding direction. If 0 or blank, it is rounded towards zero. Otherwise, it is rounded away from zero.")}
  `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(number,significance=DEFAULT_SIGNIFICANCE,mode=DEFAULT_MODE){let _significance=toNumber(significance);if(_significance===0){return 0;}
const _number=toNumber(number);_significance=Math.abs(_significance);if(_number>=0){return Math.ceil(_number/_significance)*_significance;}
const _mode=toNumber(mode);if(_mode===0){return-Math.floor(Math.abs(_number)/_significance)*_significance;}
return-Math.ceil(Math.abs(_number)/_significance)*_significance;},isExported:true,};const CEILING_PRECISE={description:_lt(`Rounds number up to nearest multiple of factor.`),args:args(`
    number (number) ${_lt("The value to round up to the nearest integer multiple of significance.")}
    significance (number, default=${DEFAULT_SIGNIFICANCE}) ${_lt("The number to whose multiples number will be rounded.")}
  `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(number,significance){return CEILING_MATH.compute(number,significance,0);},isExported:true,};const COS={description:_lt("Cosine of an angle provided in radians."),args:args(`
    angle (number) ${_lt("The angle to find the cosine of, in radians.")}
  `),returns:["NUMBER"],compute:function(angle){return Math.cos(toNumber(angle));},isExported:true,};const COSH={description:_lt("Hyperbolic cosine of any real number."),args:args(`
    value (number) ${_lt("Any real value to calculate the hyperbolic cosine of.")}
  `),returns:["NUMBER"],compute:function(value){return Math.cosh(toNumber(value));},isExported:true,};const COT={description:_lt("Cotangent of an angle provided in radians."),args:args(`
    angle (number) ${_lt("The angle to find the cotangent of, in radians.")}
  `),returns:["NUMBER"],compute:function(angle){const _angle=toNumber(angle);assert(()=>_angle!==0,_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));return 1/Math.tan(_angle);},isExported:true,};const COTH={description:_lt("Hyperbolic cotangent of any real number."),args:args(`
    value (number) ${_lt("Any real value to calculate the hyperbolic cotangent of.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);assert(()=>_value!==0,_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));return 1/Math.tanh(_value);},isExported:true,};const COUNTBLANK={description:_lt("Number of empty values."),args:args(`
    value1 (any, range) ${_lt("The first value or range in which to count the number of blanks.")}
    value2 (any, range, repeating) ${_lt("Additional values or ranges in which to count the number of blanks.")}
  `),returns:["NUMBER"],compute:function(...argsValues){return reduceAny(argsValues,(acc,a)=>(a===null||a===undefined||a===""?acc+1:acc),0);},isExported:true,};const COUNTIF={description:_lt("A conditional count across a range."),args:args(`
    range (range) ${_lt("The range that is tested against criterion.")}
    criterion (string) ${_lt("The pattern or test to apply to range.")}
  `),returns:["NUMBER"],compute:function(...argsValues){let count=0;visitMatchingRanges(argsValues,(i,j)=>{count+=1;});return count;},isExported:true,};const COUNTIFS={description:_lt("Count values depending on multiple criteria."),args:args(`
    criteria_range (range) ${_lt("The range to check against criterion1.")}
    criterion (string) ${_lt("The pattern or test to apply to criteria_range1.")}
    additional_values (any, range, optional, repeating) ${_lt("Additional ranges over which to evaluate the additional criteria. The filtered set will be the intersection of the sets produced by each criterion-range pair.")}
    criterion2 (string, repeating) ${_lt("Additional criteria to check.")}
  `),returns:["NUMBER"],compute:function(...argsValues){let count=0;visitMatchingRanges(argsValues,(i,j)=>{count+=1;});return count;},isExported:true,};function isDefined$1(value){switch(value){case undefined:return false;case"":return false;case null:return false;default:return true;}}
const COUNTUNIQUE={description:_lt("Counts number of unique values in a range."),args:args(`
    value1 (any, range) ${_lt("The first value or range to consider for uniqueness.")}
    value2 (any, range, repeating) ${_lt("Additional values or ranges to consider for uniqueness.")}
  `),returns:["NUMBER"],compute:function(...argsValues){return reduceAny(argsValues,(acc,a)=>(isDefined$1(a)?acc.add(a):acc),new Set()).size;},};const COUNTUNIQUEIFS={description:_lt("Counts number of unique values in a range, filtered by a set of criteria."),args:args(`
    range (range) ${_lt("The range of cells from which the number of unique values will be counted.")}
    criteria_range1 (range) ${_lt("The range of cells over which to evaluate criterion1.")}
    criterion1 (string) ${_lt("The pattern or test to apply to criteria_range1, such that each cell that evaluates to TRUE will be included in the filtered set.")}
    additional_values (any, range, optional, repeating) ${_lt("Additional ranges over which to evaluate the additional criteria. The filtered set will be the intersection of the sets produced by each criterion-range pair.")}
    criterion2 (string, repeating) ${_lt("The pattern or test to apply to criteria_range2.")}
  `),returns:["NUMBER"],compute:function(range,...argsValues){let uniqueValues=new Set();visitMatchingRanges(argsValues,(i,j)=>{const value=range[i][j];if(isDefined$1(value)){uniqueValues.add(value);}});return uniqueValues.size;},};const CSC={description:_lt("Cosecant of an angle provided in radians."),args:args(`
    angle (number) ${_lt("The angle to find the cosecant of, in radians.")}
  `),returns:["NUMBER"],compute:function(angle){const _angle=toNumber(angle);assert(()=>_angle!==0,_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));return 1/Math.sin(_angle);},isExported:true,};const CSCH={description:_lt("Hyperbolic cosecant of any real number."),args:args(`
    value (number) ${_lt("Any real value to calculate the hyperbolic cosecant of.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);assert(()=>_value!==0,_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));return 1/Math.sinh(_value);},isExported:true,};const DECIMAL={description:_lt("Converts from another base to decimal."),args:args(`
    value (string) ${_lt("The number to convert.")},
    base (number) ${_lt("The base to convert the value from.")},
  `),returns:["NUMBER"],compute:function(value,base){let _base=toNumber(base);_base=Math.floor(_base);assert(()=>2<=_base&&_base<=36,_lt("The base (%s) must be between 2 and 36 inclusive.",_base.toString()));const _value=toString(value);if(_value===""){return 0;}
assert(()=>!!_value.match(/^-?[a-z0-9]+$/i),_lt("The value (%s) must be a valid base %s representation.",_value,_base.toString()));const deci=parseInt(_value,_base);assert(()=>!isNaN(deci),_lt("The value (%s) must be a valid base %s representation.",_value,_base.toString()));return deci;},isExported:true,};const DEGREES={description:_lt(`Converts an angle value in radians to degrees.`),args:args(`
    angle (number)  ${_lt("The angle to convert from radians to degrees.")}
  `),returns:["NUMBER"],compute:function(angle){return(toNumber(angle)*180)/Math.PI;},isExported:true,};const EXP={description:_lt(`Euler's number, e (~2.718) raised to a power.`),args:args(`
    value (number) ${_lt("The exponent to raise e.")}
  `),returns:["NUMBER"],compute:function(value){return Math.exp(toNumber(value));},isExported:true,};const FLOOR={description:_lt(`Rounds number down to nearest multiple of factor.`),args:args(`
    value (number) ${_lt("The value to round down to the nearest integer multiple of factor.")}
    factor (number, default=${DEFAULT_FACTOR}) ${_lt("The number to whose multiples value will be rounded.")}
  `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(value,factor=DEFAULT_FACTOR){const _value=toNumber(value);const _factor=toNumber(factor);assert(()=>_factor>=0||_value<=0,_lt("The factor (%s) must be positive when the value (%s) is positive.",_factor.toString(),_value.toString()));return _factor?Math.floor(_value/_factor)*_factor:0;},isExported:true,};const FLOOR_MATH={description:_lt(`Rounds number down to nearest multiple of factor.`),args:args(`
    number (number) ${_lt("The value to round down to the nearest integer multiple of significance.")}
    significance (number, default=${DEFAULT_SIGNIFICANCE}) ${_lt("The number to whose multiples number will be rounded. The sign of significance will be ignored.")}
    mode (number, default=${DEFAULT_MODE}) ${_lt("If number is negative, specifies the rounding direction. If 0 or blank, it is rounded away from zero. Otherwise, it is rounded towards zero.")}
  `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(number,significance=DEFAULT_SIGNIFICANCE,mode=DEFAULT_MODE){let _significance=toNumber(significance);if(_significance===0){return 0;}
const _number=toNumber(number);_significance=Math.abs(_significance);if(_number>=0){return Math.floor(_number/_significance)*_significance;}
const _mode=toNumber(mode);if(_mode===0){return-Math.ceil(Math.abs(_number)/_significance)*_significance;}
return-Math.floor(Math.abs(_number)/_significance)*_significance;},isExported:true,};const FLOOR_PRECISE={description:_lt(`Rounds number down to nearest multiple of factor.`),args:args(`
    number (number) ${_lt("The value to round down to the nearest integer multiple of significance.")}
    significance (number, default=${DEFAULT_SIGNIFICANCE}) ${_lt("The number to whose multiples number will be rounded.")}
  `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(number,significance=DEFAULT_SIGNIFICANCE){return FLOOR_MATH.compute(number,significance,0);},isExported:true,};const ISEVEN={description:_lt(`Whether the provided value is even.`),args:args(`
    value (number) ${_lt("The value to be verified as even.")}
  `),returns:["BOOLEAN"],compute:function(value){const _value=strictToNumber(value);return Math.floor(Math.abs(_value))&1?false:true;},isExported:true,};const ISO_CEILING={description:_lt(`Rounds number up to nearest multiple of factor.`),args:args(`
      number (number) ${_lt("The value to round up to the nearest integer multiple of significance.")}
      significance (number, default=${DEFAULT_SIGNIFICANCE}) ${_lt("The number to whose multiples number will be rounded.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(number,significance=DEFAULT_SIGNIFICANCE){return CEILING_MATH.compute(number,significance,0);},isExported:true,};const ISODD={description:_lt(`Whether the provided value is even.`),args:args(`
    value (number) ${_lt("The value to be verified as even.")}
  `),returns:["BOOLEAN"],compute:function(value){const _value=strictToNumber(value);return Math.floor(Math.abs(_value))&1?true:false;},isExported:true,};const LN={description:_lt(`The logarithm of a number, base e (euler's number).`),args:args(`
    value (number) ${_lt("The value for which to calculate the logarithm, base e.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);assert(()=>_value>0,_lt("The value (%s) must be strictly positive.",_value.toString()));return Math.log(_value);},isExported:true,};const MOD={description:_lt(`Modulo (remainder) operator.`),args:args(`
      dividend (number) ${_lt("The number to be divided to find the remainder.")}
      divisor (number) ${_lt("The number to divide by.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(dividend,divisor){const _divisor=toNumber(divisor);assert(()=>_divisor!==0,_lt("The divisor must be different from 0."));const _dividend=toNumber(dividend);const modulus=_dividend%_divisor;if((modulus>0&&_divisor<0)||(modulus<0&&_divisor>0)){return modulus+_divisor;}
return modulus;},isExported:true,};const ODD={description:_lt(`Rounds a number up to the nearest odd integer.`),args:args(`
      value (number) ${_lt("The value to round to the next greatest odd number.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(value){const _value=toNumber(value);let temp=Math.ceil(Math.abs(_value));temp=temp&1?temp:temp+1;return _value<0?-temp:temp;},isExported:true,};const PI={description:_lt(`The number pi.`),args:[],returns:["NUMBER"],compute:function(){return Math.PI;},isExported:true,};const POWER={description:_lt(`A number raised to a power.`),args:args(`
      base (number) ${_lt("The number to raise to the exponent power.")}
      exponent (number) ${_lt("The exponent to raise base to.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(base,exponent){const _base=toNumber(base);const _exponent=toNumber(exponent);assert(()=>_base>=0||Number.isInteger(_exponent),_lt("The exponent (%s) must be an integer when the base is negative.",_exponent.toString()));return Math.pow(_base,_exponent);},isExported:true,};const PRODUCT={description:_lt("Result of multiplying a series of numbers together."),args:args(`
      factor1 (number, range<number>) ${_lt("The first number or range to calculate for the product.")}
      factor2 (number, range<number>, repeating) ${_lt("More numbers or ranges to calculate for the product.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(...factors){let count=0;let acc=1;for(let n of factors){if(Array.isArray(n)){for(let i of n){for(let j of i){if(typeof j==="number"){acc*=j;count+=1;}}}}
else if(n!==null&&n!==undefined){acc*=strictToNumber(n);count+=1;}}
if(count===0){return 0;}
return acc;},isExported:true,};const RAND={description:_lt("A random number between 0 inclusive and 1 exclusive."),args:[],returns:["NUMBER"],compute:function(){return Math.random();},isExported:true,};const RANDBETWEEN={description:_lt("Random integer between two values, inclusive."),args:args(`
      low (number) ${_lt("The low end of the random range.")}
      high (number) ${_lt("The high end of the random range.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(low,high){let _low=toNumber(low);if(!Number.isInteger(_low)){_low=Math.ceil(_low);}
let _high=toNumber(high);if(!Number.isInteger(_high)){_high=Math.floor(_high);}
assert(()=>_low<=_high,_lt("The high (%s) must be greater than or equal to the low (%s).",_high.toString(),_low.toString()));return _low+Math.ceil((_high-_low+1)*Math.random())-1;},isExported:true,};const ROUND={description:_lt("Rounds a number according to standard rules."),args:args(`
      value (number) ${_lt("The value to round to places number of places.")}
      places (number, default=${DEFAULT_PLACES}) ${_lt("The number of decimal places to which to round.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(value,places=DEFAULT_PLACES){const _value=toNumber(value);let _places=toNumber(places);const absValue=Math.abs(_value);let tempResult;if(_places===0){tempResult=Math.round(absValue);}
else{if(!Number.isInteger(_places)){_places=Math.trunc(_places);}
tempResult=Math.round(absValue*Math.pow(10,_places))/Math.pow(10,_places);}
return _value>=0?tempResult:-tempResult;},isExported:true,};const ROUNDDOWN={description:_lt(`Rounds down a number.`),args:args(`
      value (number) ${_lt("The value to round to places number of places, always rounding down.")}
      places (number, default=${DEFAULT_PLACES}) ${_lt("The number of decimal places to which to round.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(value,places=DEFAULT_PLACES){const _value=toNumber(value);let _places=toNumber(places);const absValue=Math.abs(_value);let tempResult;if(_places===0){tempResult=Math.floor(absValue);}
else{if(!Number.isInteger(_places)){_places=Math.trunc(_places);}
tempResult=Math.floor(absValue*Math.pow(10,_places))/Math.pow(10,_places);}
return _value>=0?tempResult:-tempResult;},isExported:true,};const ROUNDUP={description:_lt(`Rounds up a number.`),args:args(`
      value (number) ${_lt("The value to round to places number of places, always rounding up.")}
      places (number, default=${DEFAULT_PLACES}) ${_lt("The number of decimal places to which to round.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(value,places=DEFAULT_PLACES){const _value=toNumber(value);let _places=toNumber(places);const absValue=Math.abs(_value);let tempResult;if(_places===0){tempResult=Math.ceil(absValue);}
else{if(!Number.isInteger(_places)){_places=Math.trunc(_places);}
tempResult=Math.ceil(absValue*Math.pow(10,_places))/Math.pow(10,_places);}
return _value>=0?tempResult:-tempResult;},isExported:true,};const SEC={description:_lt("Secant of an angle provided in radians."),args:args(`
    angle (number) ${_lt("The angle to find the secant of, in radians.")}
  `),returns:["NUMBER"],compute:function(angle){return 1/Math.cos(toNumber(angle));},isExported:true,};const SECH={description:_lt("Hyperbolic secant of any real number."),args:args(`
    value (number) ${_lt("Any real value to calculate the hyperbolic secant of.")}
  `),returns:["NUMBER"],compute:function(value){return 1/Math.cosh(toNumber(value));},isExported:true,};const SIN={description:_lt("Sine of an angle provided in radians."),args:args(`
      angle (number) ${_lt("The angle to find the sine of, in radians.")}
    `),returns:["NUMBER"],compute:function(angle){return Math.sin(toNumber(angle));},isExported:true,};const SINH={description:_lt("Hyperbolic sine of any real number."),args:args(`
    value (number) ${_lt("Any real value to calculate the hyperbolic sine of.")}
  `),returns:["NUMBER"],compute:function(value){return Math.sinh(toNumber(value));},isExported:true,};const SQRT={description:_lt("Positive square root of a positive number."),args:args(`
      value (number) ${_lt("The number for which to calculate the positive square root.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(value){const _value=toNumber(value);assert(()=>_value>=0,_lt("The value (%s) must be positive or null.",_value.toString()));return Math.sqrt(_value);},isExported:true,};const SUM={description:_lt("Sum of a series of numbers and/or cells."),args:args(`
      value1 (number, range<number>) ${_lt("The first number or range to add together.")}
      value2 (number, range<number>, repeating) ${_lt("Additional numbers or ranges to add to value1.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(...values){return reduceNumbers(values,(acc,a)=>acc+a,0);},isExported:true,};const SUMIF={description:_lt("A conditional sum across a range."),args:args(`
      criteria_range (range) ${_lt("The range which is tested against criterion.")}
      criterion (string) ${_lt("The pattern or test to apply to range.")}
      sum_range (range, optional, default=criteria_range) ${_lt("The range to be summed, if different from range.")}
    `),returns:["NUMBER"],compute:function(criteriaRange,criterion,sumRange=undefined){if(sumRange===undefined){sumRange=criteriaRange;}
let sum=0;visitMatchingRanges([criteriaRange,criterion],(i,j)=>{const value=sumRange[i][j];if(typeof value==="number"){sum+=value;}});return sum;},isExported:true,};const SUMIFS={description:_lt("Sums a range depending on multiple criteria."),args:args(`
      sum_range (range) ${_lt("The range to sum.")}
      criteria_range1 (range) ${_lt("The range to check against criterion1.")}
      criterion1 (string) ${_lt("The pattern or test to apply to criteria_range1.")}
      additional_values (any, range, optional, repeating) ${_lt("Additional criteria to check.")}
    `),returns:["NUMBER"],compute:function(sumRange,...criters){let sum=0;visitMatchingRanges(criters,(i,j)=>{const value=sumRange[i][j];if(typeof value==="number"){sum+=value;}});return sum;},isExported:true,};const TAN={description:_lt("Tangent of an angle provided in radians."),args:args(`
    angle (number) ${_lt("The angle to find the tangent of, in radians.")}
  `),returns:["NUMBER"],compute:function(angle){return Math.tan(toNumber(angle));},isExported:true,};const TANH={description:_lt("Hyperbolic tangent of any real number."),args:args(`
    value (number) ${_lt("Any real value to calculate the hyperbolic tangent of.")}
  `),returns:["NUMBER"],compute:function(value){return Math.tanh(toNumber(value));},isExported:true,};const TRUNC={description:_lt("Truncates a number."),args:args(`
      value (number) ${_lt("The value to be truncated.")}
      places (number, default=${DEFAULT_PLACES}) ${_lt("The number of significant digits to the right of the decimal point to retain.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(value,places=DEFAULT_PLACES){const _value=toNumber(value);let _places=toNumber(places);if(_places===0){return Math.trunc(_value);}
if(!Number.isInteger(_places)){_places=Math.trunc(_places);}
return Math.trunc(_value*Math.pow(10,_places))/Math.pow(10,_places);},isExported:true,};var math=Object.freeze({__proto__:null,ABS:ABS,ACOS:ACOS,ACOSH:ACOSH,ACOT:ACOT,ACOTH:ACOTH,ASIN:ASIN,ASINH:ASINH,ATAN:ATAN,ATAN2:ATAN2,ATANH:ATANH,CEILING:CEILING,CEILING_MATH:CEILING_MATH,CEILING_PRECISE:CEILING_PRECISE,COS:COS,COSH:COSH,COT:COT,COTH:COTH,COUNTBLANK:COUNTBLANK,COUNTIF:COUNTIF,COUNTIFS:COUNTIFS,COUNTUNIQUE:COUNTUNIQUE,COUNTUNIQUEIFS:COUNTUNIQUEIFS,CSC:CSC,CSCH:CSCH,DECIMAL:DECIMAL,DEGREES:DEGREES,EXP:EXP,FLOOR:FLOOR,FLOOR_MATH:FLOOR_MATH,FLOOR_PRECISE:FLOOR_PRECISE,ISEVEN:ISEVEN,ISO_CEILING:ISO_CEILING,ISODD:ISODD,LN:LN,MOD:MOD,ODD:ODD,PI:PI,POWER:POWER,PRODUCT:PRODUCT,RAND:RAND,RANDBETWEEN:RANDBETWEEN,ROUND:ROUND,ROUNDDOWN:ROUNDDOWN,ROUNDUP:ROUNDUP,SEC:SEC,SECH:SECH,SIN:SIN,SINH:SINH,SQRT:SQRT,SUM:SUM,SUMIF:SUMIF,SUMIFS:SUMIFS,TAN:TAN,TANH:TANH,TRUNC:TRUNC});const colors$1=["#eb6d00","#0074d9","#ad8e00","#169ed4","#b10dc9","#00a82d","#00a3a3","#f012be","#3d9970","#111111","#62A300","#ff4136","#949494","#85144b","#001f3f",];function colorNumberString(color){return color.toString(16).padStart(6,"0");}
let colorIndex=0;function getNextColor(){colorIndex=++colorIndex%colors$1.length;return colors$1[colorIndex];}
function toHex6(color){if(color.includes("rgb")){return rgbToHex6(color);}
color=color.replace("#","").toUpperCase();if(color.length===3){color=color.split("").reduce((acc,h)=>acc+h+h,"");}
return color;}
function rgbToHex6(color){return color.slice(4,-1).split(",").map((valueString)=>parseInt(valueString,10).toString(16).padStart(2,"0")).join("").toUpperCase();}
const cellReference=new RegExp(/\$?([A-Z]{1,3})\$?([0-9]{1,7})/,"i");const rangeReference=new RegExp(/^\s*(.*!)?\$?[A-Z]{1,3}\$?[0-9]{1,7}\s*(\s*:\s*\$?[A-Z]{1,3}\$?[0-9]{1,7}\s*)?$/,"i");function numberToLetters(n){if(n<26){return String.fromCharCode(65+n);}
else{return numberToLetters(Math.floor(n/26)-1)+numberToLetters(n%26);}}
function lettersToNumber(letters){let result=0;const l=letters.length;for(let i=0;i<l;i++){let n=letters.charCodeAt(i)-65+(i<l-1?1:0);result+=n*26**(l-i-1);}
return result;}
function toCartesian(xc){xc=xc.toUpperCase().trim();const[m,letters,numbers]=xc.match(cellReference);if(m!==xc){throw new Error(`Invalid cell description: ${xc}`);}
const col=lettersToNumber(letters);const row=parseInt(numbers,10)-1;return[col,row];}
function toXC(col,row,rangePart={colFixed:false,rowFixed:false}){return((rangePart.colFixed?"$":"")+
numberToLetters(col)+
(rangePart.rowFixed?"$":"")+
String(row+1));}
const MAX_DELAY=140;const MIN_DELAY=20;const ACCELERATION=0.035;function scrollDelay(value){return MIN_DELAY+(MAX_DELAY-MIN_DELAY)*Math.exp(-ACCELERATION*(value-1));}
const fontSizes=[{pt:7.5,px:10},{pt:8,px:11},{pt:9,px:12},{pt:10,px:13},{pt:10.5,px:14},{pt:11,px:15},{pt:12,px:16},{pt:14,px:18.7},{pt:15,px:20},{pt:16,px:21.3},{pt:18,px:24},{pt:22,px:29.3},{pt:24,px:32},{pt:26,px:34.7},{pt:36,px:48},];const fontSizeMap={};for(let font of fontSizes){fontSizeMap[font.pt]=font.px;}
function stringify(obj){return JSON.stringify(obj,Object.keys(obj).sort());}
function deepCopy(obj){const result=Array.isArray(obj)?[]:{};switch(typeof obj){case"object":{if(obj===null){return obj;}
else if(!(isPlainObject(obj)||obj instanceof Array)){throw new Error("Unsupported type: only objects and arrays are supported");}
for(const key in obj){result[key]=deepCopy(obj[key]);}
return result;}
case"number":case"string":case"boolean":case"function":case"undefined":return obj;default:throw new Error(`Unsupported type: ${typeof obj}`);}}
function isPlainObject(obj){return typeof obj==="object"&&(obj===null||obj===void 0?void 0:obj.constructor)===Object;}
function getUnquotedSheetName(sheetName){if(sheetName.startsWith("'")){sheetName=sheetName.slice(1,-1).replace(/''/g,"'");}
return sheetName;}
function getComposerSheetName(sheetName){var _a;if(((_a=sheetName.match(/\w/g))===null||_a===void 0?void 0:_a.length)!==sheetName.length){sheetName=`'${sheetName}'`;}
return sheetName;}
function clip(val,min,max){return val<min?min:val>max?max:val;}
function computeTextWidth(context,text,style){const italic=style.italic?"italic ":"";const weight=style.bold?"bold":DEFAULT_FONT_WEIGHT;const sizeInPt=style.fontSize||DEFAULT_FONT_SIZE;const size=fontSizeMap[sizeInPt];context.font=`${italic}${weight} ${size}px ${DEFAULT_FONT}`;return context.measureText(text).width;}
function computeIconWidth(context,style){const sizeInPt=style.fontSize||DEFAULT_FONT_SIZE;const size=fontSizeMap[sizeInPt];return size+2*MIN_CF_ICON_MARGIN;}
function range(start,end,step=1){if(end<=start&&step>0){return[];}
if(step===0){throw new Error("range() step must not be zero");}
const length=Math.ceil(Math.abs((end-start)/step));const array=Array(length);for(let i=0;i<length;i++){array[i]=start+i*step;}
return array;}
function groupConsecutive(numbers){return numbers.reduce((groups,currentRow,index,rows)=>{if(Math.abs(currentRow-rows[index-1])===1){const lastGroup=groups[groups.length-1];lastGroup.push(currentRow);}
else{groups.push([currentRow]);}
return groups;},[]);}
function*linkNext(generator,nextGenerator){nextGenerator.next();for(const item of generator){const nextItem=nextGenerator.next();yield{...item,next:nextItem.done?undefined:nextItem.value,};}}
function isBoolean(str){const upperCased=str.toUpperCase();return upperCased==="TRUE"||upperCased==="FALSE";}
function isDateTime(str){return parseDateTime(str)!==null;}
const MARKDOWN_LINK_REGEX=/^\[([^\[]+)\]\((.+)\)$/;const WEB_LINK_REGEX=/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,4}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)$/;function isMarkdownLink(str){return MARKDOWN_LINK_REGEX.test(str);}
function isWebLink(str){return WEB_LINK_REGEX.test(str);}
function markdownLink(label,url){return`[${label}](${url})`;}
function parseMarkdownLink(str){const matches=str.match(MARKDOWN_LINK_REGEX)||[];const label=matches[1];const url=matches[2];if(!label||!url){throw new Error(`Could not parse markdown link ${str}.`);}
return{label,url,};}
const O_SPREADSHEET_LINK_PREFIX="o-spreadsheet://";function isMarkdownSheetLink(str){if(!isMarkdownLink(str)){return false;}
const{url}=parseMarkdownLink(str);return url.startsWith(O_SPREADSHEET_LINK_PREFIX);}
function buildSheetLink(sheetId){return`${O_SPREADSHEET_LINK_PREFIX}${sheetId}`;}
function parseSheetLink(sheetLink){if(sheetLink.startsWith(O_SPREADSHEET_LINK_PREFIX)){return sheetLink.substr(O_SPREADSHEET_LINK_PREFIX.length);}
throw new Error(`${sheetLink} is not a valid sheet link`);}
function isDefined(argument){return argument!==undefined;}
const DEBUG={};function toZoneWithoutBoundaryChanges(xc){xc=xc.split("!").pop();const ranges=xc.replace(/\$/g,"").split(":");let top,bottom,left,right;let c=toCartesian(ranges[0].trim());left=right=c[0];top=bottom=c[1];if(ranges.length===2){let d=toCartesian(ranges[1].trim());right=d[0];bottom=d[1];}
return{top,bottom,left,right};}
function toZone(xc){let{top,bottom,left,right}=toZoneWithoutBoundaryChanges(xc);if(right<left){[right,left]=[left,right];}
if(bottom<top){[bottom,top]=[top,bottom];}
return{top,bottom,left,right};}
function isZoneValid(zone){if(isNaN(zone.bottom)||isNaN(zone.top)||isNaN(zone.left)||isNaN(zone.right)){return false;}
return zone.bottom>=zone.top&&zone.right>=zone.left;}
function zoneToXc(zone){const{top,bottom,left,right}=zone;const isOneCell=top===bottom&&left===right;return isOneCell?toXC(left,top):`${toXC(left, top)}:${toXC(right, bottom)}`;}
function expandZoneOnInsertion(zone,start,base,position,quantity){const dimension=start==="left"?"columns":"rows";const baseElement=position==="before"?base-1:base;const end=start==="left"?"right":"bottom";const shouldIncludeEnd=position==="before"?zone[end]>baseElement:zone[end]>=baseElement;if(zone[start]<=baseElement&&shouldIncludeEnd){return createAdaptedZone(zone,dimension,"RESIZE",quantity);}
if(baseElement<zone[start]){return createAdaptedZone(zone,dimension,"MOVE",quantity);}
return{...zone};}
function updateSelectionOnInsertion(selection,start,base,position,quantity){const dimension=start==="left"?"columns":"rows";const baseElement=position==="before"?base-1:base;const end=start==="left"?"right":"bottom";if(selection[start]<=baseElement&&selection[end]>baseElement){return createAdaptedZone(selection,dimension,"RESIZE",quantity);}
if(baseElement<selection[start]){return createAdaptedZone(selection,dimension,"MOVE",quantity);}
return{...selection};}
function updateSelectionOnDeletion(zone,start,elements){const end=start==="left"?"right":"bottom";let newStart=zone[start];let newEnd=zone[end];for(let removedElement of elements.sort((a,b)=>b-a)){if(zone[start]>removedElement){newStart--;newEnd--;}
if(zone[start]<removedElement&&zone[end]>=removedElement){newEnd--;}}
return{...zone,[start]:newStart,[end]:newEnd};}
function reduceZoneOnDeletion(zone,start,elements){const end=start==="left"?"right":"bottom";let newStart=zone[start];let newEnd=zone[end];for(let removedElement of elements.sort((a,b)=>b-a)){if(zone[start]>removedElement){newStart--;newEnd--;}
if(zone[start]<=removedElement&&zone[end]>=removedElement){newEnd--;}}
if(newStart>newEnd){return undefined;}
return{...zone,[start]:newStart,[end]:newEnd};}
function union(z1,z2){return{top:Math.min(z1.top,z2.top),left:Math.min(z1.left,z2.left),bottom:Math.max(z1.bottom,z2.bottom),right:Math.max(z1.right,z2.right),};}
function isEqual(z1,z2){return(z1.left===z2.left&&z1.right===z2.right&&z1.top===z2.top&&z1.bottom===z2.bottom);}
function overlap(z1,z2){if(z1.bottom<z2.top||z2.bottom<z1.top){return false;}
if(z1.right<z2.left||z2.right<z1.left){return false;}
return true;}
function isInside(col,row,zone){const{left,right,top,bottom}=zone;return col>=left&&col<=right&&row>=top&&row<=bottom;}
function isZoneInside(smallZone,biggerZone){return isEqual(union(biggerZone,smallZone),biggerZone);}
function recomputeZones(zones,toRemoveZones){const zonesPerColumn={};for(let z of zones){if(z){const zone=toZone(z);for(let col=zone.left;col<=zone.right;col++){if(zonesPerColumn[col]===undefined){zonesPerColumn[col]=[];}
zonesPerColumn[col].push({top:zone.top,bottom:zone.bottom,remove:false,});}}}
for(let z of toRemoveZones){const zone=toZone(z);for(let col=zone.left;col<=zone.right;col++){if(zonesPerColumn[col]===undefined){zonesPerColumn[col]=[];}
zonesPerColumn[col].push({top:zone.top,bottom:zone.bottom,remove:true,});}}
const OptimizedZonePerColumn=[];for(let[col,zones]of Object.entries(zonesPerColumn)){OptimizedZonePerColumn.push({col:parseInt(col),ranges:optimiseColumn(zones),});}
const result=mergeColumns(OptimizedZonePerColumn);return result.map(zoneToXc);}
function optimiseColumn(zones){const toKeep=new Set();const toRemove=new Set();for(let zone of zones){for(let x=zone.top;x<=zone.bottom;x++){zone.remove?toRemove.add(x):toKeep.add(x);}}
const finalElements=[...toKeep].filter((x)=>!toRemove.has(x)).sort((a,b)=>{return a-b;});const newZones=[];let currentZone;for(let x of finalElements){if(!currentZone){currentZone={top:x,bottom:x};}
else if(x===currentZone.bottom+1){currentZone.bottom=x;}
else{newZones.push({top:currentZone.top,bottom:currentZone.bottom});currentZone={top:x,bottom:x};}}
if(currentZone){newZones.push({top:currentZone.top,bottom:currentZone.bottom});}
return newZones;}
function mergeColumns(zonePerCol){const orderedZones=zonePerCol.sort((a,b)=>{return a.col-b.col;});const finalZones=[];let inProgressZones=[];let currentCol=0;for(let index=0;index<=orderedZones.length-1;index++){let newInProgress=[];if(currentCol+1===orderedZones[index].col){for(let z1 of orderedZones[index].ranges){let merged=false;for(let z2 of inProgressZones){if(z1.top==z2.top&&z1.bottom==z2.bottom){newInProgress.push(z2);merged=true;}}
if(!merged){newInProgress.push({top:z1.top,bottom:z1.bottom,startCol:orderedZones[index].col});}}}
else{newInProgress=orderedZones[index].ranges.map((zone)=>{return{top:zone.top,bottom:zone.bottom,startCol:orderedZones[index].col,};});}
const difference=inProgressZones.filter((x)=>!newInProgress.includes(x));for(let x of difference){finalZones.push({top:x.top,bottom:x.bottom,left:x.startCol,right:currentCol});}
currentCol=orderedZones[index].col;inProgressZones=newInProgress;}
for(let x of inProgressZones){finalZones.push({top:x.top,bottom:x.bottom,left:x.startCol,right:currentCol});}
return finalZones;}
function mapCellsInZone(zone,sheet,callback,emptyCellValue=undefined,stepX=1,stepY=1){var _a;const{top,bottom,left,right}=zone;const result=new Array(Math.floor((right-left+1)/stepX));for(let c=left;c<=right;c+=stepX){let col=new Array(Math.floor((bottom-top+1)/stepY));result[c-left]=col;for(let r=top;r<=bottom;r+=stepY){let cell=(_a=sheet.rows[r])===null||_a===void 0?void 0:_a.cells[c];col[(r-top)/stepY]=cell?callback(cell):emptyCellValue;}}
return result;}
function zoneToDimension(zone){return{height:zone.bottom-zone.top+1,width:zone.right-zone.left+1,};}
function isOneDimensional(zone){const{width,height}=zoneToDimension(zone);return width===1||height===1;}
function positions(zone){const positions=[];const[left,right]=[zone.right,zone.left].sort((a,b)=>a-b);const[top,bottom]=[zone.top,zone.bottom].sort((a,b)=>a-b);for(const col of range(left,right+1)){for(const row of range(top,bottom+1)){positions.push([col,row]);}}
return positions;}
function createAdaptedZone(zone,dimension,operation,by){const start=dimension==="columns"?"left":"top";const end=dimension==="columns"?"right":"bottom";const newZone={...zone};if(operation==="MOVE"){newZone[start]+=by;}
newZone[end]+=by;return newZone;}
function uniqueZones(zones){return zones.reverse().filter((zone,index,self)=>index===self.findIndex((z)=>z.top===zone.top&&z.bottom===zone.bottom&&z.left===zone.left&&z.right===zone.right)).reverse();}
function findCellInNewZone(oldZone,currentZone,viewport){let col,row;const{left:oldLeft,right:oldRight,top:oldTop,bottom:oldBottom}=oldZone;const{left,right,top,bottom}=currentZone;if(left!=oldLeft){col=left;}
else if(right!=oldRight){col=right;}
else{col=viewport.left;}
if(top!=oldTop){row=top;}
else if(bottom!=oldBottom){row=bottom;}
else{row=viewport.top;}
return[col,row];}
function organizeZone(zone){return{top:Math.min(zone.top,zone.bottom),bottom:Math.max(zone.top,zone.bottom),left:Math.min(zone.left,zone.right),right:Math.max(zone.left,zone.right),};}
function updateRemoveColumns(range,columns){let{left,right,top,bottom}=toZone(range);columns=columns.slice().sort((a,b)=>b-a);for(let column of columns){if(left>column){left-=1;}
if(left>=column||right>=column){right-=1;}}
if(left>right){return null;}
return toXC(left,top)+":"+toXC(right,bottom);}
function updateRemoveRows(range,rows){let{left,right,top,bottom}=toZone(range);rows=rows.slice().sort((a,b)=>b-a);for(let row of rows){if(top>row){top-=1;}
if(top>=row||bottom>=row){bottom-=1;}}
if(top>bottom){return null;}
return toXC(left,top)+":"+toXC(right,bottom);}
function updateAddColumns(range,column,step){let{left,right,top,bottom}=toZone(range);if(left>=column){left+=step;}
if(left>=column||right>=column){right+=step;}
if(left>right){return null;}
return toXC(left,top)+":"+toXC(right,bottom);}
function updateAddRows(range,row,step){let{left,right,top,bottom}=toZone(range);if(top>=row){top+=step;}
if(top>=row||bottom>=row){bottom+=step;}
if(top>bottom){return null;}
return toXC(left,top)+":"+toXC(right,bottom);}
function createDefaultCols(colNumber){const cols=[];let current=0;for(let i=0;i<colNumber;i++){const size=DEFAULT_CELL_WIDTH;const col={start:current,end:current+size,size:size,name:numberToLetters(i),};cols.push(col);current=col.end;}
return cols;}
function createDefaultRows(rowNumber){const rows=[];let current=0;for(let i=0;i<rowNumber;i++){const size=DEFAULT_CELL_HEIGHT;const row={start:current,end:current+size,size:size,name:String(i+1),cells:{},};rows.push(row);current=row.end;}
return rows;}
function createCols(savedCols,colNumber){var _a;const cols=[];let current=0;for(let i=0;i<colNumber;i++){const size=savedCols[i]?savedCols[i].size||DEFAULT_CELL_WIDTH:DEFAULT_CELL_WIDTH;const hidden=((_a=savedCols[i])===null||_a===void 0?void 0:_a.isHidden)||false;const end=hidden?current:current+size;const col={start:current,end:end,size:size,name:numberToLetters(i),};if(hidden){col.isHidden=hidden;}
cols.push(col);current=col.end;}
return cols;}
function createRows(savedRows,rowNumber){var _a;const rows=[];let current=0;for(let i=0;i<rowNumber;i++){const size=savedRows[i]?savedRows[i].size||DEFAULT_CELL_HEIGHT:DEFAULT_CELL_HEIGHT;const hidden=((_a=savedRows[i])===null||_a===void 0?void 0:_a.isHidden)||false;const end=hidden?current:current+size;const row={start:current,end:end,size:size,name:String(i+1),cells:{},};if(hidden){row.isHidden=hidden;}
rows.push(row);current=row.end;}
return rows;}
function exportCols(cols,exportDefaults=false){const exportedCols={};for(let i in cols){const col=cols[i];if(col.size!==DEFAULT_CELL_WIDTH||exportDefaults){exportedCols[i]={size:col.size};}
if(col.isHidden){exportedCols[i]=exportedCols[i]||{};exportedCols[i]["isHidden"]=col.isHidden;}}
return exportedCols;}
function exportRows(rows,exportDefaults=false){const exportedRows={};for(let i in rows){const row=rows[i];if(row.size!==DEFAULT_CELL_HEIGHT||exportDefaults){exportedRows[i]={size:row.size};}
if(row.isHidden){exportedRows[i]=exportedRows[i]||{};exportedRows[i]["isHidden"]=row.isHidden;}}
return exportedRows;}
class UuidGenerator{constructor(){this.isFastIdStrategy=false;this.fastIdStart=0;}
setIsFastStrategy(isFast){this.isFastIdStrategy=isFast;}
uuidv4(){if(this.isFastIdStrategy){this.fastIdStart++;return String(this.fastIdStart);}
else if(window.crypto&&window.crypto.getRandomValues){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(c)=>(c^(crypto.getRandomValues(new Uint8Array(1))[0]&(15>>(c/4)))).toString(16));}
else{return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(Math.random()*16)|0,v=c=="x"?r:(r&0x3)|0x8;return v.toString(16);});}}}
function getNextVisibleCellCoords(sheet,col,row){return[findVisibleHeader(sheet,"cols",range(col,sheet.cols.length)),findVisibleHeader(sheet,"rows",range(row,sheet.rows.length)),];}
function findVisibleHeader(sheet,dimension,indexes){const headers=sheet[dimension];return indexes.find((index)=>!headers[index].isHidden);}
function findLastVisibleColRow(sheet,dimension){let lastIndex=sheet[dimension].length-1;while(lastIndex>=0&&sheet[dimension][lastIndex].isHidden===true){lastIndex--;}
return sheet[dimension][lastIndex];}
function covariance(dataY,dataX,isSample){let flatDataY=[];let flatDataX=[];let lenY=0;let lenX=0;visitAny([dataY],(y)=>{flatDataY.push(y);lenY+=1;});visitAny([dataX],(x)=>{flatDataX.push(x);lenX+=1;});assert(()=>lenY===lenX,_lt("[[FUNCTION_NAME]] has mismatched argument count %s vs %s.",lenY.toString(),lenX.toString()));let count=0;let sumY=0;let sumX=0;for(let i=0;i<lenY;i++){const valueY=flatDataY[i];const valueX=flatDataX[i];if(typeof valueY==="number"&&typeof valueX==="number"){count+=1;sumY+=valueY;sumX+=valueX;}}
assert(()=>count!==0&&(!isSample||count!==1),_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));const averageY=sumY/count;const averageX=sumX/count;let acc=0;for(let i=0;i<lenY;i++){const valueY=flatDataY[i];const valueX=flatDataX[i];if(typeof valueY==="number"&&typeof valueX==="number"){acc+=(valueY-averageY)*(valueX-averageX);}}
return acc/(count-(isSample?1:0));}
function variance(args,isSample,textAs0){let count=0;let sum=0;const reduceFunction=textAs0?reduceNumbersTextAs0:reduceNumbers;sum=reduceFunction(args,(acc,a)=>{count+=1;return acc+a;},0);assert(()=>count!==0&&(!isSample||count!==1),_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));const average=sum/count;return(reduceFunction(args,(acc,a)=>acc+Math.pow(a-average,2),0)/(count-(isSample?1:0)));}
function centile(data,percent,isInclusive){const _percent=toNumber(percent);assert(()=>(isInclusive?0<=_percent&&_percent<=1:0<_percent&&_percent<1),_lt(`Function [[FUNCTION_NAME]] parameter 2 value is out of range.`));let sortedArray=[];let index;let count=0;visitAny(data,(d)=>{if(typeof d==="number"){index=dichotomicPredecessorSearch(sortedArray,d);sortedArray.splice(index+1,0,d);count++;}});assert(()=>count!==0,_lt(`[[FUNCTION_NAME]] has no valid input data.`));let percentIndex=(count+(isInclusive?-1:1))*_percent;if(!isInclusive){assert(()=>1<=percentIndex&&percentIndex<=count,_lt(`Function [[FUNCTION_NAME]] parameter 2 value is out of range.`));percentIndex--;}
if(Number.isInteger(percentIndex)){return sortedArray[percentIndex];}
const indexSup=Math.ceil(percentIndex);const indexLow=Math.floor(percentIndex);return(sortedArray[indexSup]*(percentIndex-indexLow)+
sortedArray[indexLow]*(indexSup-percentIndex));}
const AVEDEV={description:_lt("Average magnitude of deviations from mean."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
    value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to include in the sample.")}
  `),returns:["NUMBER"],compute:function(...values){let count=0;const sum=reduceNumbers(values,(acc,a)=>{count+=1;return acc+a;},0);assert(()=>count!==0,_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));const average=sum/count;return reduceNumbers(values,(acc,a)=>acc+Math.abs(average-a),0)/count;},isExported:true,};const AVERAGE={description:_lt(`Numerical average value in a dataset, ignoring text.`),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range to consider when calculating the average value.")}
      value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to consider when calculating the average value.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(...values){let count=0;const sum=reduceNumbers(values,(acc,a)=>{count+=1;return acc+a;},0);assert(()=>count!==0,_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));return sum/count;},isExported:true,};const rangeError=_lt(`[[FUNCTION_NAME]] has mismatched range sizes.`);const negativeWeightError=_lt(`[[FUNCTION_NAME]] expects the weight to be positive or equal to 0.`);const AVERAGE_WEIGHTED={description:_lt(`Weighted average.`),args:args(`
      values (number, range<number>) ${_lt("Values to average.")}
      weights (number, range<number>) ${_lt("Weights for each corresponding value.")}
      additional_values (number, range<number>, repeating) ${_lt("Additional values to average.")}
      additional_weights (number, range<number>, repeating) ${_lt("Additional weights.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(...values){let sum=0;let count=0;let value;let weight;assert(()=>values.length%2===0,_lt(`Wrong number of Argument[]. Expected an even number of Argument[].`));for(let n=0;n<values.length-1;n+=2){value=values[n];weight=values[n+1];if(Array.isArray(value)){assert(()=>Array.isArray(weight),rangeError);let dimColValue=value.length;let dimLinValue=value[0].length;assert(()=>dimColValue===weight.length&&dimLinValue===weight[0].length,rangeError);for(let i=0;i<dimColValue;i++){for(let j=0;j<dimLinValue;j++){let subValue=value[i][j];let subWeight=weight[i][j];let subValueIsNumber=typeof subValue==="number";let subWeightIsNumber=typeof subWeight==="number";assert(()=>subValueIsNumber===subWeightIsNumber,_lt(`[[FUNCTION_NAME]] expects number values.`));if(subWeightIsNumber){assert(()=>subWeight>=0,negativeWeightError);sum+=subValue*subWeight;count+=subWeight;}}}}
else{weight=toNumber(weight);value=toNumber(value);assert(()=>weight>=0,negativeWeightError);sum+=value*weight;count+=weight;}}
assert(()=>count!==0,_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));return sum/count;},};const AVERAGEA={description:_lt(`Numerical average value in a dataset.`),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range to consider when calculating the average value.")}
      value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to consider when calculating the average value.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(...values){let count=0;const sum=reduceNumbersTextAs0(values,(acc,a)=>{count+=1;return acc+a;},0);assert(()=>count!==0,_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));return sum/count;},isExported:true,};const AVERAGEIF={description:_lt(`Average of values depending on criteria.`),args:args(`
      criteria_range (range) ${_lt("The range to check against criterion.")}
      criterion (string) ${_lt("The pattern or test to apply to criteria_range.")}
      average_range (range, optional, default=criteria_range) ${_lt("The range to average. If not included, criteria_range is used for the average instead.")}
    `),returns:["NUMBER"],compute:function(criteriaRange,criterion,averageRange=undefined){if(averageRange===undefined||averageRange===null){averageRange=criteriaRange;}
let count=0;let sum=0;visitMatchingRanges([criteriaRange,criterion],(i,j)=>{const value=(averageRange||criteriaRange)[i][j];if(typeof value==="number"){count+=1;sum+=value;}});assert(()=>count!==0,_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));return sum/count;},isExported:true,};const AVERAGEIFS={description:_lt(`Average of values depending on multiple criteria.`),args:args(`
      average_range (range) ${_lt("The range to average.")}
      criteria_range1 (range) ${_lt("The range to check against criterion1.")}
      criterion1 (string) ${_lt("The pattern or test to apply to criteria_range1.")}
      additional_values (any, range, optional, repeating) ${_lt("Additional criteria_range and criterion to check.")}
    `),returns:["NUMBER"],compute:function(averageRange,...values){let count=0;let sum=0;visitMatchingRanges(values,(i,j)=>{const value=averageRange[i][j];if(typeof value==="number"){count+=1;sum+=value;}});assert(()=>count!==0,_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));return sum/count;},isExported:true,};const COUNT={description:_lt(`The number of numeric values in dataset.`),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range to consider when counting.")}
    value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to consider when counting.")}
  `),returns:["NUMBER"],compute:function(...values){let count=0;for(let n of values){if(Array.isArray(n)){for(let i of n){for(let j of i){if(typeof j==="number"){count+=1;}}}}
else if(typeof n!=="string"||isNumber(n)||parseDateTime(n)){count+=1;}}
return count;},isExported:true,};const COUNTA={description:_lt(`The number of values in a dataset.`),args:args(`
    value1 (any, range) ${_lt("The first value or range to consider when counting.")}
    value2 (any, range, repeating) ${_lt("Additional values or ranges to consider when counting.")}
  `),returns:["NUMBER"],compute:function(...values){return reduceAny(values,(acc,a)=>(a!==undefined&&a!==null?acc+1:acc),0);},isExported:true,};const COVAR={description:_lt(`The covariance of a dataset.`),args:args(`
    data_y (any, range) ${_lt("The range representing the array or matrix of dependent data.")}
    data_x (any, range) ${_lt("The range representing the array or matrix of independent data.")}
  `),returns:["NUMBER"],compute:function(dataY,dataX){return covariance(dataY,dataX,false);},isExported:true,};const COVARIANCE_P={description:_lt(`The covariance of a dataset.`),args:args(`
    data_y (any, range) ${_lt("The range representing the array or matrix of dependent data.")}
    data_x (any, range) ${_lt("The range representing the array or matrix of independent data.")}
  `),returns:["NUMBER"],compute:function(dataY,dataX){return covariance(dataY,dataX,false);},isExported:true,};const COVARIANCE_S={description:_lt(`The sample covariance of a dataset.`),args:args(`
    data_y (any, range) ${_lt("The range representing the array or matrix of dependent data.")}
    data_x (any, range) ${_lt("The range representing the array or matrix of independent data.")}
  `),returns:["NUMBER"],compute:function(dataY,dataX){return covariance(dataY,dataX,true);},isExported:true,};const LARGE={description:_lt("Nth largest element from a data set."),args:args(`
      data (any, range) ${_lt("Array or range containing the dataset to consider.")}
      n (number) ${_lt("The rank from largest to smallest of the element to return.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(data,n){const _n=Math.trunc(toNumber(n));let largests=[];let index;let count=0;visitAny([data],(d)=>{if(typeof d==="number"){index=dichotomicPredecessorSearch(largests,d);largests.splice(index+1,0,d);count++;if(count>_n){largests.shift();count--;}}});const result=largests.shift();assert(()=>result!==undefined,_lt(`[[FUNCTION_NAME]] has no valid input data.`));assert(()=>count>=_n,_lt("Function [[FUNCTION_NAME]] parameter 2 value (%s) is out of range.",_n.toString()));return result;},isExported:true,};const MAX={description:_lt("Maximum value in a numeric dataset."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range to consider when calculating the maximum value.")}
      value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to consider when calculating the maximum value.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(...values){const result=reduceNumbers(values,(acc,a)=>(acc<a?a:acc),-Infinity);return result===-Infinity?0:result;},isExported:true,};const MAXA={description:_lt("Maximum numeric value in a dataset."),args:args(`
      value1 (any, range) ${_lt("The first value or range to consider when calculating the maximum value.")}
      value2 (any, range, optional, repeating) ${_lt("Additional values or ranges to consider when calculating the maximum value.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(...values){const maxa=reduceNumbersTextAs0(values,(acc,a)=>{return Math.max(a,acc);},-Infinity);return maxa===-Infinity?0:maxa;},isExported:true,};const MAXIFS={description:_lt("Returns the maximum value in a range of cells, filtered by a set of criteria."),args:args(`
      range (range) ${_lt("The range of cells from which the maximum will be determined.")}
      criteria_range1 (range) ${_lt("The range of cells over which to evaluate criterion1.")}
      criterion1 (string) ${_lt("The pattern or test to apply to criteria_range1, such that each cell that evaluates to TRUE will be included in the filtered set.")}
      additional_values (any, range, optional, repeating) ${_lt("Additional ranges over which to evaluate the additional criteria. The filtered set will be the intersection of the sets produced by each criterion-range pair.")}
      criterion2 (string, repeating) ${_lt("The pattern or test to apply to criteria_range2.")}
    `),returns:["NUMBER"],compute:function(range,...args){let result=-Infinity;visitMatchingRanges(args,(i,j)=>{const value=range[i][j];if(typeof value==="number"){result=result<value?value:result;}});return result===-Infinity?0:result;},isExported:true,};const MEDIAN={description:_lt("Median value in a numeric dataset."),args:args(`
      value1 (any, range) ${_lt("The first value or range to consider when calculating the median value.")}
      value2 (any, range, repeating) ${_lt("Additional values or ranges to consider when calculating the median value.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(...values){let data=[];visitNumbers(values,(arg)=>{data.push(arg);});return centile(data,0.5,true);},isExported:true,};const MIN={description:_lt("Minimum value in a numeric dataset."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range to consider when calculating the minimum value.")}
      value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to consider when calculating the minimum value.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(...values){const result=reduceNumbers(values,(acc,a)=>(a<acc?a:acc),Infinity);return result===Infinity?0:result;},isExported:true,};const MINA={description:_lt("Minimum numeric value in a dataset."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range to consider when calculating the minimum value.")}
      value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to consider when calculating the minimum value.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(...values){const mina=reduceNumbersTextAs0(values,(acc,a)=>{return Math.min(a,acc);},Infinity);return mina===Infinity?0:mina;},isExported:true,};const MINIFS={description:_lt("Returns the minimum value in a range of cells, filtered by a set of criteria."),args:args(`
      range (range) ${_lt("The range of cells from which the minimum will be determined.")}
      criteria_range1 (range) ${_lt("The range of cells over which to evaluate criterion1.")}
      criterion1 (string) ${_lt("The pattern or test to apply to criteria_range1, such that each cell that evaluates to TRUE will be included in the filtered set.")}
      additional_values (any, range, optional, repeating) ${_lt("Additional ranges over which to evaluate the additional criteria. The filtered set will be the intersection of the sets produced by each criterion-range pair.")}
      criterion2 (string, repeating) ${_lt("The pattern or test to apply to criteria_range2.")}
    `),returns:["NUMBER"],compute:function(range,...args){let result=Infinity;visitMatchingRanges(args,(i,j)=>{const value=range[i][j];if(typeof value==="number"){result=result>value?value:result;}});return result===Infinity?0:result;},isExported:true,};const PERCENTILE={description:_lt("Value at a given percentile of a dataset."),args:args(`
      data (any, range) ${_lt("The array or range containing the dataset to consider.")}
      percentile (number) ${_lt("The percentile whose value within data will be calculated and returned.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(data,percentile){return PERCENTILE_INC.compute(data,percentile);},isExported:true,};const PERCENTILE_EXC={description:_lt("Value at a given percentile of a dataset exclusive of 0 and 1."),args:args(`
      data (any, range) ${_lt("The array or range containing the dataset to consider.")}
      percentile (number) ${_lt("The percentile, exclusive of 0 and 1, whose value within 'data' will be calculated and returned.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(data,percentile){return centile([data],percentile,false);},isExported:true,};const PERCENTILE_INC={description:_lt("Value at a given percentile of a dataset."),args:args(`
      data (any, range) ${_lt("The array or range containing the dataset to consider.")}
      percentile (number) ${_lt("The percentile whose value within data will be calculated and returned.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(data,percentile){return centile([data],percentile,true);},isExported:true,};const QUARTILE={description:_lt("Value nearest to a specific quartile of a dataset."),args:args(`
      data (any, range) ${_lt("The array or range containing the dataset to consider.")}
      quartile_number (number) ${_lt("Which quartile value to return.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(data,quartileNumber){return QUARTILE_INC.compute(data,quartileNumber);},isExported:true,};const QUARTILE_EXC={description:_lt("Value nearest to a specific quartile of a dataset exclusive of 0 and 4."),args:args(`
      data (any, range) ${_lt("The array or range containing the dataset to consider.")}
      quartile_number (number) ${_lt("Which quartile value, exclusive of 0 and 4, to return.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(data,quartileNumber){const _quartileNumber=Math.trunc(toNumber(quartileNumber));return centile([data],0.25*_quartileNumber,false);},isExported:true,};const QUARTILE_INC={description:_lt("Value nearest to a specific quartile of a dataset."),args:args(`
      data (any, range) ${_lt("The array or range containing the dataset to consider.")}
      quartile_number (number) ${_lt("Which quartile value to return.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(data,quartileNumber){const _quartileNumber=Math.trunc(toNumber(quartileNumber));return centile([data],0.25*_quartileNumber,true);},isExported:true,};const SMALL={description:_lt("Nth smallest element in a data set."),args:args(`
      data (any, range) ${_lt("The array or range containing the dataset to consider.")}
      n (number) ${_lt("The rank from smallest to largest of the element to return.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(data,n){const _n=Math.trunc(toNumber(n));let largests=[];let index;let count=0;visitAny([data],(d)=>{if(typeof d==="number"){index=dichotomicPredecessorSearch(largests,d);largests.splice(index+1,0,d);count++;if(count>_n){largests.pop();count--;}}});const result=largests.pop();assert(()=>result!==undefined,_lt(`[[FUNCTION_NAME]] has no valid input data.`));assert(()=>count>=_n,_lt("Function [[FUNCTION_NAME]] parameter 2 value (%s) is out of range.",_n.toString()));return result;},isExported:true,};const STDEV={description:_lt("Standard deviation."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
      value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to include in the sample.")}
    `),returns:["NUMBER"],compute:function(...values){return Math.sqrt(VAR.compute(...values));},isExported:true,};const STDEV_P={description:_lt("Standard deviation of entire population."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range of the population.")}
      value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to include in the population.")}
    `),returns:["NUMBER"],compute:function(...values){return Math.sqrt(VAR_P.compute(...values));},isExported:true,};const STDEV_S={description:_lt("Standard deviation."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
      value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to include in the sample.")}
    `),returns:["NUMBER"],compute:function(...values){return Math.sqrt(VAR_S.compute(...values));},isExported:true,};const STDEVA={description:_lt("Standard deviation of sample (text as 0)."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
    value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to include in the sample.")}
  `),returns:["NUMBER"],compute:function(...values){return Math.sqrt(VARA.compute(...values));},isExported:true,};const STDEVP={description:_lt("Standard deviation of entire population."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the population.")}
    value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to include in the population.")}
  `),returns:["NUMBER"],compute:function(...values){return Math.sqrt(VARP.compute(...values));},isExported:true,};const STDEVPA={description:_lt("Standard deviation of entire population (text as 0)."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the population.")}
    value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to include in the population.")}
  `),returns:["NUMBER"],compute:function(...values){return Math.sqrt(VARPA.compute(...values));},isExported:true,};const VAR={description:_lt("Variance."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
      value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to include in the sample.")}
    `),returns:["NUMBER"],compute:function(...values){return variance(values,true,false);},isExported:true,};const VAR_P={description:_lt("Variance of entire population."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range of the population.")}
      value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to include in the population.")}
    `),returns:["NUMBER"],compute:function(...values){return variance(values,false,false);},isExported:true,};const VAR_S={description:_lt("Variance."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
      value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to include in the sample.")}
    `),returns:["NUMBER"],compute:function(...values){return variance(values,true,false);},isExported:true,};const VARA={description:_lt("Variance of sample (text as 0)."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
    value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to include in the sample.")}
  `),returns:["NUMBER"],compute:function(...values){return variance(values,true,true);},isExported:true,};const VARP={description:_lt("Variance of entire population."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the population.")}
    value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to include in the population.")}
  `),returns:["NUMBER"],compute:function(...values){return variance(values,false,false);},isExported:true,};const VARPA={description:_lt("Variance of entire population (text as 0)."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the population.")}
    value2 (number, range<number>, repeating) ${_lt("Additional values or ranges to include in the population.")}
  `),returns:["NUMBER"],compute:function(...values){return variance(values,false,true);},isExported:true,};var statistical=Object.freeze({__proto__:null,AVEDEV:AVEDEV,AVERAGE:AVERAGE,AVERAGE_WEIGHTED:AVERAGE_WEIGHTED,AVERAGEA:AVERAGEA,AVERAGEIF:AVERAGEIF,AVERAGEIFS:AVERAGEIFS,COUNT:COUNT,COUNTA:COUNTA,COVAR:COVAR,COVARIANCE_P:COVARIANCE_P,COVARIANCE_S:COVARIANCE_S,LARGE:LARGE,MAX:MAX,MAXA:MAXA,MAXIFS:MAXIFS,MEDIAN:MEDIAN,MIN:MIN,MINA:MINA,MINIFS:MINIFS,PERCENTILE:PERCENTILE,PERCENTILE_EXC:PERCENTILE_EXC,PERCENTILE_INC:PERCENTILE_INC,QUARTILE:QUARTILE,QUARTILE_EXC:QUARTILE_EXC,QUARTILE_INC:QUARTILE_INC,SMALL:SMALL,STDEV:STDEV,STDEV_P:STDEV_P,STDEV_S:STDEV_S,STDEVA:STDEVA,STDEVP:STDEVP,STDEVPA:STDEVPA,VAR:VAR,VAR_P:VAR_P,VAR_S:VAR_S,VARA:VARA,VARP:VARP,VARPA:VARPA});function getMatchingCells(database,field,criteria){var _a;const indexColNameDB=new Map();const dimRowDB=database.length;for(let indexCol=dimRowDB-1;indexCol>=0;indexCol--){indexColNameDB.set(toString(database[indexCol][0]).toUpperCase(),indexCol);}
if(typeof field!=="number"&&typeof field!=="string"){throw new Error(_lt("The field must be a number or a string"));}
let index;if(typeof field==="number"){index=Math.trunc(field)-1;if(index<0||dimRowDB-1<index){throw new Error(_lt("The field (%s) must be one of %s or must be a number between 1 and %s inclusive.",field.toString(),dimRowDB.toString()));}}
else{const colName=toString(field).toUpperCase();index=(_a=indexColNameDB.get(colName))!==null&&_a!==void 0?_a:-1;if(index===-1){throw new Error(_lt("The field (%s) must be one of %s.",toString(field),[...indexColNameDB.keys()].toString()));}}
const dimColCriteria=criteria[0].length;if(dimColCriteria<2){throw new Error(_lt("The criteria range contains %s row, it must be at least 2 rows.",dimColCriteria.toString()));}
let matchingRows=new Set();const dimColDB=database[0].length;for(let indexRow=1;indexRow<dimColCriteria;indexRow++){let args=[];let existColNameDB=true;for(let indexCol=0;indexCol<criteria.length;indexCol++){const currentName=toString(criteria[indexCol][0]).toUpperCase();const indexColDB=indexColNameDB.get(currentName);const criter=criteria[indexCol][indexRow];if(criter!==undefined){if(indexColDB!==undefined){args.push([database[indexColDB].slice(1,dimColDB)]);args.push(criter);}
else{existColNameDB=false;break;}}}
if(existColNameDB){if(args.length>0){visitMatchingRanges(args,(i,j)=>{matchingRows.add(j);},true);}
else{matchingRows=new Set(Array(dimColDB-1).keys());break;}}}
const fieldCol=database[index];const matchingCells=[...matchingRows].map((x)=>fieldCol[x+1]);return matchingCells;}
const databaseArgs=args(`
  database (range) ${_lt("The array or range containing the data to consider, structured in such a way that the first row contains the labels for each column's values.")}
  field (any) ${_lt("Indicates which column in database contains the values to be extracted and operated on.")}
  criteria (range) ${_lt("An array or range containing zero or more criteria to filter the database values by before operating.")}
`);const DAVERAGE={description:_lt("Average of a set of values from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return AVERAGE.compute([cells]);},isExported:true,};const DCOUNT={description:_lt("Counts values from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return COUNT.compute([cells]);},isExported:true,};const DCOUNTA={description:_lt("Counts values and text from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return COUNTA.compute([cells]);},isExported:true,};const DGET={description:_lt("Single value from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);assert(()=>cells.length===1,_lt("More than one match found in DGET evaluation."));return cells[0];},isExported:true,};const DMAX={description:_lt("Maximum of values from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return MAX.compute([cells]);},isExported:true,};const DMIN={description:_lt("Minimum of values from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return MIN.compute([cells]);},isExported:true,};const DPRODUCT={description:_lt("Product of values from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return PRODUCT.compute([cells]);},isExported:true,};const DSTDEV={description:_lt("Standard deviation of population sample from table."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return STDEV.compute([cells]);},isExported:true,};const DSTDEVP={description:_lt("Standard deviation of entire population from table."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return STDEVP.compute([cells]);},isExported:true,};const DSUM={description:_lt("Sum of values from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return SUM.compute([cells]);},isExported:true,};const DVAR={description:_lt("Variance of population sample from table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return VAR.compute([cells]);},isExported:true,};const DVARP={description:_lt("Variance of a population from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return VARP.compute([cells]);},isExported:true,};var database=Object.freeze({__proto__:null,DAVERAGE:DAVERAGE,DCOUNT:DCOUNT,DCOUNTA:DCOUNTA,DGET:DGET,DMAX:DMAX,DMIN:DMIN,DPRODUCT:DPRODUCT,DSTDEV:DSTDEV,DSTDEVP:DSTDEVP,DSUM:DSUM,DVAR:DVAR,DVARP:DVARP});const INITIAL_1900_DAY=new Date(1899,11,30);const DEFAULT_TYPE=1;const DEFAULT_WEEKEND=1;function isLeapYear(year){const _year=Math.trunc(year);return(_year%4===0&&_year%100!=0)||_year%400==0;}
const DATE={description:_lt("Converts year/month/day into a date."),args:args(`
    year (number) ${_lt("The year component of the date.")}")}
    month (number) ${_lt("The month component of the date.")}")}
    day (number) ${_lt("The day component of the date.")}")}
    `),returns:["DATE"],returnFormat:{specificFormat:"m/d/yyyy"},compute:function(year,month,day){let _year=Math.trunc(toNumber(year));const _month=Math.trunc(toNumber(month));const _day=Math.trunc(toNumber(day));assert(()=>0<=_year&&_year<=9999,_lt("The year (%s) must be between 0 and 9999 inclusive.",_year.toString()));if(_year<1900){_year+=1900;}
const jsDate=new Date(_year,_month-1,_day);const delta=jsDate.getTime()-INITIAL_1900_DAY.getTime();assert(()=>delta>=0,_lt(`The function [[FUNCTION_NAME]] result must be greater than or equal 01/01/1900.`));return Math.round(delta/86400000);},isExported:true,};const DATEVALUE={description:_lt("Converts a date string to a date value."),args:args(`
      date_string (string) ${_lt("The string representing the date.")}
    `),returns:["NUMBER"],compute:function(dateString){const _dateString=toString(dateString);const internalDate=parseDateTime(_dateString);assert(()=>internalDate!==null,_lt("The date_string (%s) cannot be parsed to date/time.",_dateString.toString()));return Math.trunc(internalDate.value);},isExported:true,};const DAY={description:_lt("Day of the month that a specific date falls on."),args:args(`
      date (string) ${_lt("The date from which to extract the day.")}
    `),returns:["NUMBER"],compute:function(date){return toJsDate(date).getDate();},isExported:true,};const DAYS={description:_lt("Number of days between two dates."),args:args(`
      end_date (date) ${_lt("The end of the date range.")}
      start_date (date) ${_lt("The start of the date range.")}
    `),returns:["NUMBER"],compute:function(endDate,startDate){const _endDate=toJsDate(endDate);const _startDate=toJsDate(startDate);const dateDif=_endDate.getTime()-_startDate.getTime();return Math.round(dateDif/86400000);},isExported:true,};const EDATE={description:_lt("Date a number of months before/after another date."),args:args(`
    start_date (date) ${_lt("The date from which to calculate the result.")}
    months (number) ${_lt("The number of months before (negative) or after (positive) 'start_date' to calculate.")}
    `),returns:["DATE"],returnFormat:{specificFormat:"m/d/yyyy"},compute:function(startDate,months){const _startDate=toJsDate(startDate);const _months=Math.trunc(toNumber(months));const yStart=_startDate.getFullYear();const mStart=_startDate.getMonth();const dStart=_startDate.getDate();const jsDate=new Date(yStart,mStart+_months,dStart);const delta=jsDate.getTime()-INITIAL_1900_DAY.getTime();return Math.round(delta/86400000);},isExported:true,};const EOMONTH={description:_lt("Last day of a month before or after a date."),args:args(`
    start_date (date) ${_lt("The date from which to calculate the result.")}
    months (number) ${_lt("The number of months before (negative) or after (positive) 'start_date' to consider.")}
    `),returns:["DATE"],returnFormat:{specificFormat:"m/d/yyyy"},compute:function(startDate,months){const _startDate=toJsDate(startDate);const _months=Math.trunc(toNumber(months));const yStart=_startDate.getFullYear();const mStart=_startDate.getMonth();const jsDate=new Date(yStart,mStart+_months+1,0);const delta=jsDate.getTime()-INITIAL_1900_DAY.getTime();return Math.round(delta/86400000);},isExported:true,};const HOUR={description:_lt("Hour component of a specific time."),args:args(`
    time (date) ${_lt("The time from which to calculate the hour component.")}
    `),returns:["NUMBER"],compute:function(date){return toJsDate(date).getHours();},isExported:true,};const ISOWEEKNUM={description:_lt("ISO week number of the year."),args:args(`
    date (date) ${_lt("The date for which to determine the ISO week number. Must be a reference to a cell containing a date, a function returning a date type, or a number.")}
    `),returns:["NUMBER"],compute:function(date){const _date=toJsDate(date);const y=_date.getFullYear();let firstThursday=1;while(new Date(y,0,firstThursday).getDay()!==4){firstThursday+=1;}
const firstDayOfFirstWeek=new Date(y,0,firstThursday-3);let lastThursday=31;while(new Date(y,11,lastThursday).getDay()!==4){lastThursday-=1;}
const lastDayOfLastWeek=new Date(y,11,lastThursday+3);let offsetYear;if(firstDayOfFirstWeek.getTime()<=_date.getTime()){if(_date.getTime()<=lastDayOfLastWeek.getTime()){offsetYear=0;}
else{offsetYear=1;}}
else{offsetYear=-1;}
let firstDay;switch(offsetYear){case 0:firstDay=firstDayOfFirstWeek;break;case 1:firstDay=new Date(y,11,lastThursday+3+1);break;case-1:let firstThursdayPreviousYear=1;while(new Date(y-1,0,firstThursdayPreviousYear).getDay()!==4){firstThursdayPreviousYear+=1;}
firstDay=new Date(y-1,0,firstThursdayPreviousYear-3);break;}
const dif=(_date.getTime()-firstDay.getTime())/86400000;return Math.floor(dif/7)+1;},isExported:true,};const MINUTE={description:_lt("Minute component of a specific time."),args:args(`
      time (date) ${_lt("The time from which to calculate the minute component.")}
    `),returns:["NUMBER"],compute:function(date){return toJsDate(date).getMinutes();},isExported:true,};const MONTH={description:_lt("Month of the year a specific date falls in"),args:args(`
      date (date) ${_lt("The date from which to extract the month.")}
    `),returns:["NUMBER"],compute:function(date){return toJsDate(date).getMonth()+1;},isExported:true,};const NETWORKDAYS={description:_lt("Net working days between two provided days."),args:args(`
      start_date (date) ${_lt("The start date of the period from which to calculate the number of net working days.")}
      end_date (date) ${_lt("The end date of the period from which to calculate the number of net working days.")}
      holidays (date, range<date>, optional) ${_lt("A range or array constant containing the date serial numbers to consider holidays.")}
    `),returns:["NUMBER"],compute:function(startDate,endDate,holidays=undefined){return NETWORKDAYS_INTL.compute(startDate,endDate,1,holidays);},isExported:true,};function weekendToDayNumber(weekend){if(typeof weekend==="string"){assert(()=>{if(weekend.length!==7){return false;}
for(let day of weekend){if(day!=="0"&&day!=="1"){return false;}}
return true;},_lt('When weekend is a string (%s) it must be composed of "0" or "1".',weekend));let result=[];for(let i=0;i<7;i++){if(weekend[i]==="1"){result.push((i+1)%7);}}
return result;}
if(typeof weekend==="number"){assert(()=>(1<=weekend&&weekend<=7)||(11<=weekend&&weekend<=17),_lt("The weekend (%s) must be a string or a number in the range 1-7 or 11-17.",weekend.toString()));if(weekend<=7){return[weekend-2===-1?6:weekend-2,weekend-1];}
return[weekend-11];}
throw Error(_lt("The weekend (%s) must be a number or a string.",weekend.toString()));}
const NETWORKDAYS_INTL={description:_lt("Net working days between two dates (specifying weekends)."),args:args(`
      start_date (date) ${_lt("The start date of the period from which to calculate the number of net working days.")}
      end_date (date) ${_lt("The end date of the period from which to calculate the number of net working days.")}
      weekend (any, default=${DEFAULT_WEEKEND}) ${_lt("A number or string representing which days of the week are considered weekends.")}
      holidays (date, range<date>, optional) ${_lt("A range or array constant containing the dates to consider as holidays.")}
    `),returns:["NUMBER"],compute:function(startDate,endDate,weekend=DEFAULT_WEEKEND,holidays=undefined){const _startDate=toJsDate(startDate);const _endDate=toJsDate(endDate);const daysWeekend=weekendToDayNumber(weekend);let timesHoliday=new Set();if(holidays!==undefined){visitAny([holidays],(h)=>{const holiday=toJsDate(h);timesHoliday.add(holiday.getTime());});}
const invertDate=_startDate.getTime()>_endDate.getTime();const stopDate=new Date((invertDate?_startDate:_endDate).getTime());let stepDate=new Date((invertDate?_endDate:_startDate).getTime());const timeStopDate=stopDate.getTime();let timeStepDate=stepDate.getTime();let netWorkingDay=0;while(timeStepDate<=timeStopDate){if(!daysWeekend.includes(stepDate.getDay())&&!timesHoliday.has(timeStepDate)){netWorkingDay+=1;}
stepDate.setDate(stepDate.getDate()+1);timeStepDate=stepDate.getTime();}
return invertDate?-netWorkingDay:netWorkingDay;},isExported:true,};const NOW={description:_lt("Current date and time as a date value."),args:[],returns:["DATE"],returnFormat:{specificFormat:"m/d/yyyy hh:mm:ss"},compute:function(){let today=new Date();today.setMilliseconds(0);const delta=today.getTime()-INITIAL_1900_DAY.getTime();const time=today.getHours()/24+today.getMinutes()/1440+today.getSeconds()/86400;return Math.floor(delta/86400000)+time;},isExported:true,};const SECOND={description:_lt("Minute component of a specific time."),args:args(`
      time (date) ${_lt("The time from which to calculate the second component.")}
    `),returns:["NUMBER"],compute:function(date){return toJsDate(date).getSeconds();},isExported:true,};const TIME={description:_lt("Converts hour/minute/second into a time."),args:args(`
    hour (number) ${_lt("The hour component of the time.")}
    minute (number) ${_lt("The minute component of the time.")}
    second (number) ${_lt("The second component of the time.")}
    `),returns:["DATE"],returnFormat:{specificFormat:"hh:mm:ss a"},compute:function(hour,minute,second){let _hour=Math.trunc(toNumber(hour));let _minute=Math.trunc(toNumber(minute));let _second=Math.trunc(toNumber(second));_minute+=Math.floor(_second/60);_second=(_second%60)+(_second<0?60:0);_hour+=Math.floor(_minute/60);_minute=(_minute%60)+(_minute<0?60:0);_hour%=24;assert(()=>_hour>=0,_lt(`The function [[FUNCTION_NAME]] result cannot be negative`));return _hour/24+_minute/(24*60)+_second/(24*60*60);},isExported:true,};const TIMEVALUE={description:_lt("Converts a time string into its serial number representation."),args:args(`
      time_string (string) ${_lt("The string that holds the time representation.")}
    `),returns:["NUMBER"],compute:function(timeString){const _timeString=toString(timeString);const internalDate=parseDateTime(_timeString);assert(()=>internalDate!==null,_lt("The time_string (%s) cannot be parsed to date/time.",_timeString));const result=internalDate.value-Math.trunc(internalDate.value);return result<0?1+result:result;},isExported:true,};const TODAY={description:_lt("Current date as a date value."),args:[],returns:["DATE"],returnFormat:{specificFormat:"m/d/yyyy"},compute:function(){const today=new Date();const jsDate=new Date(today.getFullYear(),today.getMonth(),today.getDate());const delta=jsDate.getTime()-INITIAL_1900_DAY.getTime();return Math.round(delta/86400000);},isExported:true,};const WEEKDAY={description:_lt("Day of the week of the date provided (as number)."),args:args(`
    date (date) ${_lt("The date for which to determine the day of the week. Must be a reference to a cell containing a date, a function returning a date type, or a number.")}
    type (number, default=${DEFAULT_TYPE}) ${_lt("A number indicating which numbering system to use to represent weekdays. By default, counts starting with Sunday = 1.")}
  `),returns:["NUMBER"],compute:function(date,type=DEFAULT_TYPE){const _date=toJsDate(date);const _type=Math.round(toNumber(type));const m=_date.getDay();assert(()=>[1,2,3].includes(_type),_lt("The type (%s) must be 1, 2 or 3.",_type.toString()));if(_type===1)
return m+1;if(_type===2)
return m===0?7:m;return m===0?6:m-1;},isExported:true,};const WEEKNUM={description:_lt("Week number of the year."),args:args(`
    date (date) ${_lt("The date for which to determine the week number. Must be a reference to a cell containing a date, a function returning a date type, or a number.")}
    type (number, default=${DEFAULT_TYPE}) ${_lt("A number representing the day that a week starts on. Sunday = 1.")}
    `),returns:["NUMBER"],compute:function(date,type=DEFAULT_TYPE){const _date=toJsDate(date);const _type=Math.round(toNumber(type));assert(()=>_type===1||_type===2||(11<=_type&&_type<=17)||_type===21,_lt("The type (%s) is out of range.",_type.toString()));if(_type===21){return ISOWEEKNUM.compute(date);}
let startDayOfWeek;if(_type===1||_type===2){startDayOfWeek=_type-1;}
else{startDayOfWeek=_type-10===7?0:_type-10;}
const y=_date.getFullYear();let dayStart=1;let startDayOfFirstWeek=new Date(y,0,dayStart);while(startDayOfFirstWeek.getDay()!==startDayOfWeek){dayStart+=1;startDayOfFirstWeek=new Date(y,0,dayStart);}
const dif=(_date.getTime()-startDayOfFirstWeek.getTime())/86400000;if(dif<0){return 1;}
return Math.floor(dif/7)+(dayStart===1?1:2);},isExported:true,};const WORKDAY={description:_lt("Number of working days from start date."),args:args(`
      start_date (date) ${_lt("The date from which to begin counting.")}
      num_days (number) ${_lt("The number of working days to advance from start_date. If negative, counts backwards.")}
      holidays (date, range<date>, optional) ${_lt("A range or array constant containing the dates to consider holidays.")}
      `),returns:["NUMBER"],returnFormat:{specificFormat:"m/d/yyyy"},compute:function(startDate,numDays,holidays=undefined){return WORKDAY_INTL.compute(startDate,numDays,1,holidays);},isExported:true,};const WORKDAY_INTL={description:_lt("Net working days between two dates (specifying weekends)."),args:args(`
      start_date (date) ${_lt("The date from which to begin counting.")}
      num_days (number) ${_lt("The number of working days to advance from start_date. If negative, counts backwards.")}
      weekend (any, default=${DEFAULT_WEEKEND}) ${_lt("A number or string representing which days of the week are considered weekends.")}
      holidays (date, range<date>, optional) ${_lt("A range or array constant containing the dates to consider holidays.")}
    `),returns:["DATE"],returnFormat:{specificFormat:"m/d/yyyy"},compute:function(startDate,numDays,weekend=DEFAULT_WEEKEND,holidays=undefined){let _startDate=toJsDate(startDate);let _numDays=Math.trunc(toNumber(numDays));if(typeof weekend==="string"){assert(()=>weekend!=="1111111",_lt("The weekend (%s) must be different from '1111111'.",weekend));}
const daysWeekend=weekendToDayNumber(weekend);let timesHoliday=new Set();if(holidays!==undefined){visitAny([holidays],(h)=>{const holiday=toJsDate(h);timesHoliday.add(holiday.getTime());});}
let stepDate=new Date(_startDate.getTime());let timeStepDate=stepDate.getTime();const unitDay=Math.sign(_numDays);let stepDay=Math.abs(_numDays);while(stepDay>0){stepDate.setDate(stepDate.getDate()+unitDay);timeStepDate=stepDate.getTime();if(!daysWeekend.includes(stepDate.getDay())&&!timesHoliday.has(timeStepDate)){stepDay-=1;}}
const delta=timeStepDate-INITIAL_1900_DAY.getTime();return Math.round(delta/86400000);},isExported:true,};const YEAR={description:_lt("Year specified by a given date."),args:args(`
    date (date) ${_lt("The date from which to extract the year.")}
    `),returns:["NUMBER"],compute:function(date){return toJsDate(date).getFullYear();},isExported:true,};const DEFAULT_DAY_COUNT_CONVENTION$1=0;const YEARFRAC={description:_lt("Exact number of years between two dates."),args:args(`
    start_date (date) ${_lt("The start date to consider in the calculation. Must be a reference to a cell containing a date, a function returning a date type, or a number.")}
    end_date (date) ${_lt("The end date to consider in the calculation. Must be a reference to a cell containing a date, a function returning a date type, or a number.")}
    day_count_convention (number, default=${DEFAULT_DAY_COUNT_CONVENTION$1}) ${_lt("An indicator of what day count method to use.")}
    `),returns:["NUMBER"],compute:function(startDate,endDate,dayCountConvention=DEFAULT_DAY_COUNT_CONVENTION$1){let _startDate=Math.trunc(toNumber(startDate));let _endDate=Math.trunc(toNumber(endDate));const _dayCountConvention=Math.trunc(toNumber(dayCountConvention));assert(()=>_startDate>=0,_lt("The start_date (%s) must be positive or null.",_startDate.toString()));assert(()=>_endDate>=0,_lt("The end_date (%s) must be positive or null.",_endDate.toString()));assert(()=>0<=_dayCountConvention&&_dayCountConvention<=4,_lt("The day_count_convention (%s) must be between 0 and 4 inclusive.",_dayCountConvention.toString()));if(_startDate===_endDate){return 0;}
if(_startDate>_endDate){const stack=_endDate;_endDate=_startDate;_startDate=stack;}
const jsStartDate=toJsDate(_startDate);const jsEndDate=toJsDate(_endDate);let dayStart=jsStartDate.getDate();let dayEnd=jsEndDate.getDate();const monthStart=jsStartDate.getMonth();const monthEnd=jsEndDate.getMonth();const yearStart=jsStartDate.getFullYear();const yearEnd=jsEndDate.getFullYear();let yearsStart=0;let yearsEnd=0;switch(_dayCountConvention){case 0:if(dayStart===31)
dayStart=30;if(dayStart===30&&dayEnd===31)
dayEnd=30;if(monthStart===1&&dayStart===(isLeapYear(yearStart)?29:28)){dayStart=30;if(monthEnd===1&&dayEnd===(isLeapYear(yearEnd)?29:28)){dayEnd=30;}}
yearsStart=yearStart+(monthStart*30+dayStart)/360;yearsEnd=yearEnd+(monthEnd*30+dayEnd)/360;break;case 1:let daysInYear=365;const isSameYear=yearStart===yearEnd;const isOneDeltaYear=yearStart+1===yearEnd;const isMonthEndBigger=monthStart<monthEnd;const isSameMonth=monthStart===monthEnd;const isDayEndBigger=dayStart<dayEnd;if((!isSameYear&&!isOneDeltaYear)||(!isSameYear&&isMonthEndBigger)||(!isSameYear&&isSameMonth&&isDayEndBigger)){let countYears=0;let countDaysInYears=0;for(let y=yearStart;y<=yearEnd;y++){countYears++;countDaysInYears+=isLeapYear(y)?366:365;}
daysInYear=countDaysInYears/countYears;}
else if(!isSameYear){if(isLeapYear(yearStart)&&monthStart<2){daysInYear=366;}
if(isLeapYear(yearEnd)&&(monthEnd>1||(monthEnd===1&&dayEnd===29))){daysInYear=366;}}
else{if(isLeapYear(yearStart)){daysInYear=366;}}
yearsStart=_startDate/daysInYear;yearsEnd=_endDate/daysInYear;break;case 2:yearsStart=_startDate/360;yearsEnd=_endDate/360;break;case 3:yearsStart=_startDate/365;yearsEnd=_endDate/365;break;case 4:if(dayStart===31)
dayStart=30;if(dayEnd===31)
dayEnd=30;yearsStart=yearStart+(monthStart*30+dayStart)/360;yearsEnd=yearEnd+(monthEnd*30+dayEnd)/360;break;}
return yearsEnd-yearsStart;},};var date=Object.freeze({__proto__:null,DATE:DATE,DATEVALUE:DATEVALUE,DAY:DAY,DAYS:DAYS,EDATE:EDATE,EOMONTH:EOMONTH,HOUR:HOUR,ISOWEEKNUM:ISOWEEKNUM,MINUTE:MINUTE,MONTH:MONTH,NETWORKDAYS:NETWORKDAYS,NETWORKDAYS_INTL:NETWORKDAYS_INTL,NOW:NOW,SECOND:SECOND,TIME:TIME,TIMEVALUE:TIMEVALUE,TODAY:TODAY,WEEKDAY:WEEKDAY,WEEKNUM:WEEKNUM,WORKDAY:WORKDAY,WORKDAY_INTL:WORKDAY_INTL,YEAR:YEAR,YEARFRAC:YEARFRAC});const DEFAULT_DAY_COUNT_CONVENTION=0;const DEFAULT_END_OR_BEGINNING=0;function newtonMethod(func,derivFunc,startValue,interMax,epsMax=1e-10){let x=startValue;let newX;let xDelta;let y;let yEqual0=false;let count=0;do{y=func(x);newX=x-y/derivFunc(x);xDelta=Math.abs(newX-x);x=newX;yEqual0=xDelta<epsMax||Math.abs(y)<epsMax;assert(()=>count<interMax,_lt(`Function [[FUNCTION_NAME]] didn't find any result`));count++;}while(!yEqual0);return x;}
const DB={description:_lt("Depreciation via declining balance method."),args:args(`
        cost (number) ${_lt("The initial cost of the asset.")}
        salvage (number) ${_lt("The value of the asset at the end of depreciation.")}
        life (number) ${_lt("The number of periods over which the asset is depreciated.")}
        period (number) ${_lt("The single period within life for which to calculate depreciation.")}
        month (number, optional) ${_lt("The number of months in the first year of depreciation.")}
    `),returns:["NUMBER"],returnFormat:{specificFormat:"#,##0.00"},compute:function(cost,salvage,life,period,...args){const _cost=toNumber(cost);const _salvage=toNumber(salvage);const _life=toNumber(life);const _period=Math.trunc(toNumber(period));const _month=args.length?Math.trunc(toNumber(args[0])):12;const lifeLimit=_life+(_month===12?0:1);assert(()=>_cost>0,_lt("The cost (%s) must be strictly positive.",_cost.toString()));assert(()=>_salvage>=0,_lt("The salvage (%s) must be positive or null.",_salvage.toString()));assert(()=>_life>0,_lt("The life (%s) must be strictly positive.",_life.toString()));assert(()=>_period>0,_lt("The period (%s) must be strictly positive.",_period.toString()));assert(()=>1<=_month&&_month<=12,_lt("The month (%s) must be between 1 and 12 inclusive.",_month.toString()));assert(()=>_period<=lifeLimit,_lt("The period (%s) must be less than or equal to %s.",_period.toString(),lifeLimit.toString()));const monthPart=_month/12;let rate=1-Math.pow(_salvage/_cost,1/_life);rate=Math.round(rate*1000)/1000;let before=_cost;let after=_cost*(1-rate*monthPart);for(let i=1;i<_period;i++){before=after;after=before*(1-rate);if(i===_life){after=before*(1-rate*(1-monthPart));}}
return before-after;},};const DURATION={description:_lt("Number of periods for an investment to reach a value."),args:args(`
        settlement (date) ${_lt("The settlement date of the security, the date after issuance when the security is delivered to the buyer.")}
        maturity (date) ${_lt("The maturity or end date of the security, when it can be redeemed at face, or par value.")}
        rate (number) ${_lt("The annualized rate of interest.")}
        yield (number) ${_lt("The expected annual yield of the security.")}
        frequency (number) ${_lt("The number of interest or coupon payments per year (1, 2, or 4).")}
        day_count_convention (number, default=${DEFAULT_DAY_COUNT_CONVENTION} ) ${_lt("An indicator of what day count method to use.")}
    `),returns:["NUMBER"],compute:function(settlement,maturity,rate,securityYield,frequency,dayCountConvention=DEFAULT_DAY_COUNT_CONVENTION){dayCountConvention=dayCountConvention||0;const start=Math.trunc(toNumber(settlement));const end=Math.trunc(toNumber(maturity));const _rate=toNumber(rate);const _yield=toNumber(securityYield);const _frequency=Math.trunc(toNumber(frequency));const _dayCountConvention=Math.trunc(toNumber(dayCountConvention));assert(()=>start<end,_lt("The maturity (%s) must be strictly greater than the settlement (%s).",end.toString(),start.toString()));assert(()=>_rate>=0,_lt("The rate (%s) must be positive or null.",_rate.toString()));assert(()=>_yield>=0,_lt("The yield (%s) must be positive or null.",_yield.toString()));assert(()=>[1,2,4].includes(_frequency),_lt("The frequency (%s) must be one of %s",_frequency.toString(),[1,2,4].toString()));assert(()=>0<=_dayCountConvention&&_dayCountConvention<=4,_lt("The day_count_convention (%s) must be between 0 and 4 inclusive.",_dayCountConvention.toString()));const years=YEARFRAC.compute(start,end,_dayCountConvention);const timeFirstYear=years-Math.trunc(years)||1/_frequency;const nbrCoupons=Math.ceil(years*_frequency);const cashFlowFromCoupon=_rate/_frequency;const yieldPerPeriod=_yield/_frequency;let count=0;let sum=0;for(let i=1;i<=nbrCoupons;i++){const cashFlowPerPeriod=cashFlowFromCoupon+(i===nbrCoupons?1:0);const presentValuePerPeriod=cashFlowPerPeriod/(1+yieldPerPeriod)**i;sum+=(timeFirstYear+(i-1)/_frequency)*presentValuePerPeriod;count+=presentValuePerPeriod;}
return count===0?0:sum/count;},};const DEFAULT_PRESENT_VALUE=0;const FV={description:_lt("Future value of an annuity investment."),args:args(`
  rate (number) ${_lt("The interest rate.")}
  number_of_periods (number) ${_lt("The number of payments to be made.")}
  payment_amount (number) ${_lt("The amount per period to be paid.")}
  present_value (number, default=${DEFAULT_PRESENT_VALUE}) ${_lt("The current value of the annuity.")}
  end_or_beginning (number, default=${DEFAULT_END_OR_BEGINNING}) ${_lt("Whether payments are due at the end (0) or beginning (1) of each period.")}
  `),returns:["NUMBER"],returnFormat:{specificFormat:"#,##0.00"},compute:function(rate,numberOfPeriods,paymentAmount,presentValue=DEFAULT_PRESENT_VALUE,endOrBeginning=DEFAULT_END_OR_BEGINNING){presentValue=presentValue||0;endOrBeginning=endOrBeginning||0;const r=toNumber(rate);const n=toNumber(numberOfPeriods);const p=toNumber(paymentAmount);const pv=toNumber(presentValue);const type=toBoolean(endOrBeginning)?1:0;return r?-pv*(1+r)**n-(p*(1+r*type)*((1+r)**n-1))/r:-(pv+p*n);},};const DEFAULT_RATE_GUESS=0.1;const IRR={description:_lt("Internal rate of return given periodic cashflows."),args:args(`
  cashflow_amounts (number, range<number>) ${_lt("An array or range containing the income or payments associated with the investment.")}
  rate_guess (number, default=${DEFAULT_RATE_GUESS}) ${_lt("An estimate for what the internal rate of return will be.")}
  `),returns:["NUMBER"],returnFormat:{specificFormat:"0%"},compute:function(cashFlowAmounts,rateGuess=DEFAULT_RATE_GUESS){const _rateGuess=toNumber(rateGuess);assert(()=>_rateGuess>-1,_lt("The rate_guess (%s) must be strictly greater than -1.",_rateGuess.toString()));let positive=false;let negative=false;let amounts=[];visitNumbers([cashFlowAmounts],(amount)=>{if(amount>0)
positive=true;if(amount<0)
negative=true;amounts.push(amount);});assert(()=>positive&&negative,_lt("The cashflow_amounts must include negative and positive values."));const firstAmount=amounts.shift();function npvNumerator(rate,startValue,values){const nbrValue=values.length;let i=0;return values.reduce((acc,v)=>{i++;return acc+v*rate**(nbrValue-i);},startValue*rate**nbrValue);}
function npvNumeratorDeriv(rate,startValue,values){const nbrValue=values.length;let i=0;return values.reduce((acc,v)=>{i++;return acc+v*(nbrValue-i)*rate**(nbrValue-i-1);},startValue*nbrValue*rate**(nbrValue-1));}
function func(x){return npvNumerator(x,firstAmount,amounts);}
function derivFunc(x){return npvNumeratorDeriv(x,firstAmount,amounts);}
return newtonMethod(func,derivFunc,_rateGuess+1,20,1e-5)-1;},};const MDURATION={description:_lt("Modified Macaulay duration."),args:args(`
        settlement (date) ${_lt("The settlement date of the security, the date after issuance when the security is delivered to the buyer.")}
        maturity (date) ${_lt("The maturity or end date of the security, when it can be redeemed at face, or par value.")}
        rate (number) ${_lt("The annualized rate of interest.")}
        yield (number) ${_lt("The expected annual yield of the security.")}
        frequency (number) ${_lt("The number of interest or coupon payments per year (1, 2, or 4).")}
        day_count_convention (number, default=${DEFAULT_DAY_COUNT_CONVENTION} ) ${_lt("An indicator of what day count method to use.")}
    `),returns:["NUMBER"],compute:function(settlement,maturity,rate,securityYield,frequency,dayCountConvention=DEFAULT_DAY_COUNT_CONVENTION){const duration=DURATION.compute(settlement,maturity,rate,securityYield,frequency,dayCountConvention);const y=toNumber(securityYield);const k=Math.trunc(toNumber(frequency));return duration/(1+y/k);},};function npvResult(r,startValue,values){let i=0;return reduceNumbers(values,(acc,v)=>{i++;return acc+v/(1+r)**i;},startValue);}
const NPV={description:_lt("The net present value of an investment based on a series of periodic cash flows and a discount rate."),args:args(`
  discount (number) ${_lt("The discount rate of the investment over one period.")}
  cashflow1 (number, range<number>) ${_lt("The first future cash flow.")}
  cashflow2 (number, range<number>, repeating) ${_lt("Additional future cash flows.")}
  `),returns:["NUMBER"],returnFormat:{specificFormat:"#,##0.00"},compute:function(discount,...values){const _discount=toNumber(discount);assert(()=>_discount!==-1,_lt("The discount (%s) must be different from -1.",_discount.toString()));return npvResult(_discount,0,values);},};const PDURATION={description:_lt("Computes the number of periods needed for an investment to reach a value."),args:args(`
  rate (number) ${_lt("The rate at which the investment grows each period.")}
  present_value (number) ${_lt("The investment's current value.")}
  future_value (number) ${_lt("The investment's desired future value.")}
  `),returns:["NUMBER"],compute:function(rate,presentValue,futureValue){const _rate=toNumber(rate);const _presentValue=toNumber(presentValue);const _futureValue=toNumber(futureValue);assert(()=>_rate>0,_lt("The rate (%s) must be strictly positive.",_rate.toString()));assert(()=>_presentValue>0,_lt("The present_value (%s) must be strictly positive.",_presentValue.toString()));assert(()=>_futureValue>0,_lt("The future_value (%s) must be strictly positive.",_futureValue.toString()));return(Math.log(_futureValue)-Math.log(_presentValue))/Math.log(1+_rate);},};const DEFAULT_FUTURE_VALUE=0;const PV={description:_lt("Present value of an annuity investment."),args:args(`
  rate (number) ${_lt("The interest rate.")}
  number_of_periods (number) ${_lt("The number of payments to be made.")}
  payment_amount (number) ${_lt("The amount per period to be paid.")}
  future_value (number, default=${DEFAULT_FUTURE_VALUE}) ${_lt("The future value remaining after the final payment has been made.")}
  end_or_beginning (number, default=${DEFAULT_END_OR_BEGINNING}) ${_lt("Whether payments are due at the end (0) or beginning (1) of each period.")}
  `),returns:["NUMBER"],returnFormat:{specificFormat:"#,##0.00"},compute:function(rate,numberOfPeriods,paymentAmount,futureValue=DEFAULT_FUTURE_VALUE,endOrBeginning=DEFAULT_END_OR_BEGINNING){futureValue=futureValue||0;endOrBeginning=endOrBeginning||0;const r=toNumber(rate);const n=toNumber(numberOfPeriods);const p=toNumber(paymentAmount);const fv=toNumber(futureValue);const type=toBoolean(endOrBeginning)?1:0;return r?-((p*(1+r*type)*((1+r)**n-1))/r+fv)/(1+r)**n:-(fv+p*n);},};const PRICE={description:_lt("Price of a security paying periodic interest."),args:args(`
      settlement (date) ${_lt("The settlement date of the security, the date after issuance when the security is delivered to the buyer.")}
      maturity (date) ${_lt("The maturity or end date of the security, when it can be redeemed at face, or par value.")}
      rate (number) ${_lt("The annualized rate of interest.")}
      yield (number) ${_lt("The expected annual yield of the security.")}
      redemption (number) ${_lt("The redemption amount per 100 face value, or par.")}
      frequency (number) ${_lt("The number of interest or coupon payments per year (1, 2, or 4).")}
      day_count_convention (number, default=${DEFAULT_DAY_COUNT_CONVENTION} ) ${_lt("An indicator of what day count method to use.")}
    `),returns:["NUMBER"],compute:function(settlement,maturity,rate,securityYield,redemption,frequency,dayCountConvention=DEFAULT_DAY_COUNT_CONVENTION){dayCountConvention=dayCountConvention||0;const _settlement=Math.trunc(toNumber(settlement));const _maturity=Math.trunc(toNumber(maturity));const _rate=toNumber(rate);const _yield=toNumber(securityYield);const _redemption=toNumber(redemption);const _frequency=Math.trunc(toNumber(frequency));const _dayCountConvention=Math.trunc(toNumber(dayCountConvention));assert(()=>_maturity>_settlement,_lt("The maturity (%s) must be strictly greater than the settlement (%s).",_maturity.toString(),_settlement.toString()));assert(()=>_rate>=0,_lt("The rate (%s) must be positive or null.",_rate.toString()));assert(()=>_yield>=0,_lt("The yield (%s) must be positive or null.",_yield.toString()));assert(()=>_redemption>0,_lt("The redemption (%s) must be strictly positive.",_redemption.toString()));assert(()=>[1,2,4].includes(_frequency),_lt("The frequency (%s) must be one of %s.",_frequency.toString(),[1,2,4].toString()));assert(()=>0<=_dayCountConvention&&_dayCountConvention<=4,_lt("The day_count_convention (%s) must be between 0 and 4 inclusive.",_dayCountConvention.toString()));const years=YEARFRAC.compute(_settlement,_maturity,_dayCountConvention);const nbrRealCoupons=years*_frequency;const nbrFullCoupons=Math.ceil(nbrRealCoupons);const timeFirstCoupon=nbrRealCoupons-Math.floor(nbrRealCoupons)||1;const yieldFactorPerPeriod=1+_yield/_frequency;const cashFlowFromCoupon=(100*_rate)/_frequency;if(nbrFullCoupons===1){return((cashFlowFromCoupon+_redemption)/((timeFirstCoupon*_yield)/_frequency+1)-
cashFlowFromCoupon*(1-timeFirstCoupon));}
let cashFlowsPresentValue=0;for(let i=1;i<=nbrFullCoupons;i++){cashFlowsPresentValue+=cashFlowFromCoupon/yieldFactorPerPeriod**(i-1+timeFirstCoupon);}
const redemptionPresentValue=_redemption/yieldFactorPerPeriod**(nbrFullCoupons-1+timeFirstCoupon);return(redemptionPresentValue+cashFlowsPresentValue-cashFlowFromCoupon*(1-timeFirstCoupon));},};const YIELD={description:_lt("Annual yield of a security paying periodic interest."),args:args(`
        settlement (date) ${_lt("The settlement date of the security, the date after issuance when the security is delivered to the buyer.")}
        maturity (date) ${_lt("The maturity or end date of the security, when it can be redeemed at face, or par value.")}
        rate (number) ${_lt("The annualized rate of interest.")}
        price (number) ${_lt("The price at which the security is bought per 100 face value.")}
        redemption (number) ${_lt("The redemption amount per 100 face value, or par.")}
        frequency (number) ${_lt("The number of interest or coupon payments per year (1, 2, or 4).")}
        day_count_convention (number, default=${DEFAULT_DAY_COUNT_CONVENTION} ) ${_lt("An indicator of what day count method to use.")}
    `),returns:["NUMBER"],compute:function(settlement,maturity,rate,price,redemption,frequency,dayCountConvention=DEFAULT_DAY_COUNT_CONVENTION){dayCountConvention=dayCountConvention||0;const _settlement=Math.trunc(toNumber(settlement));const _maturity=Math.trunc(toNumber(maturity));const _rate=toNumber(rate);const _price=toNumber(price);const _redemption=toNumber(redemption);const _frequency=Math.trunc(toNumber(frequency));const _dayCountConvention=Math.trunc(toNumber(dayCountConvention));assert(()=>_maturity>_settlement,_lt("The maturity (%s) must be strictly greater than the settlement (%s).",_maturity.toString(),_settlement.toString()));assert(()=>_rate>=0,_lt("The rate (%s) must be positive or null.",_rate.toString()));assert(()=>_price>0,_lt("The price (%s) must be strictly positive.",_price.toString()));assert(()=>_redemption>0,_lt("The redemption (%s) must be strictly positive.",_redemption.toString()));assert(()=>[1,2,4].includes(_frequency),_lt("The frequency (%s) must be one of %s.",_frequency.toString(),[1,2,4].toString()));assert(()=>0<=_dayCountConvention&&_dayCountConvention<=4,_lt("The day_count_convention (%s) must between 0 and 4 inclusive.",_dayCountConvention.toString()));const years=YEARFRAC.compute(_settlement,_maturity,_dayCountConvention);const nbrRealCoupons=years*_frequency;const nbrFullCoupons=Math.ceil(nbrRealCoupons);const timeFirstCoupon=nbrRealCoupons-Math.floor(nbrRealCoupons)||1;const cashFlowFromCoupon=(100*_rate)/_frequency;if(nbrFullCoupons===1){const subPart=_price+cashFlowFromCoupon*(1-timeFirstCoupon);return(((_redemption+cashFlowFromCoupon-subPart)*_frequency*(1/timeFirstCoupon))/subPart);}
function priceNumerator(price,timeFirstCoupon,nbrFullCoupons,yieldFactorPerPeriod,cashFlowFromCoupon,redemption){let result=redemption-
(price+cashFlowFromCoupon*(1-timeFirstCoupon))*yieldFactorPerPeriod**(nbrFullCoupons-1+timeFirstCoupon);for(let i=1;i<=nbrFullCoupons;i++){result+=cashFlowFromCoupon*yieldFactorPerPeriod**(i-1);}
return result;}
function priceNumeratorDeriv(price,timeFirstCoupon,nbrFullCoupons,yieldFactorPerPeriod,cashFlowFromCoupon){let result=-(price+cashFlowFromCoupon*(1-timeFirstCoupon))*(nbrFullCoupons-1+timeFirstCoupon)*yieldFactorPerPeriod**(nbrFullCoupons-2+timeFirstCoupon);for(let i=1;i<=nbrFullCoupons;i++){result+=cashFlowFromCoupon*(i-1)*yieldFactorPerPeriod**(i-2);}
return result;}
function func(x){return priceNumerator(_price,timeFirstCoupon,nbrFullCoupons,x,cashFlowFromCoupon,_redemption);}
function derivFunc(x){return priceNumeratorDeriv(_price,timeFirstCoupon,nbrFullCoupons,x,cashFlowFromCoupon);}
const initYield=_rate+1;const initYieldFactorPerPeriod=1+initYield/_frequency;const methodResult=newtonMethod(func,derivFunc,initYieldFactorPerPeriod,100,1e-5);return(methodResult-1)*_frequency;},};const YIELDMAT={description:_lt("Annual yield of a security paying interest at maturity."),args:args(`
        settlement (date) ${_lt("The settlement date of the security, the date after issuance when the security is delivered to the buyer.")}
        maturity (date) ${_lt("The maturity or end date of the security, when it can be redeemed at face, or par value.")}
        issue (date) ${_lt("The date the security was initially issued.")}
        rate (number) ${_lt("The annualized rate of interest.")}
        price (number) ${_lt("The price at which the security is bought.")}
        day_count_convention (number, default=${DEFAULT_DAY_COUNT_CONVENTION} ) ${_lt("An indicator of what day count method to use.")}
    `),returns:["NUMBER"],compute:function(settlement,maturity,issue,rate,price,dayCountConvention=DEFAULT_DAY_COUNT_CONVENTION){dayCountConvention=dayCountConvention||0;const _settlement=Math.trunc(toNumber(settlement));const _maturity=Math.trunc(toNumber(maturity));const _issue=Math.trunc(toNumber(issue));const _rate=toNumber(rate);const _price=toNumber(price);const _dayCountConvention=Math.trunc(toNumber(dayCountConvention));assert(()=>_settlement>=_issue,_lt("The settlement (%s) must be greater than or equal to the issue (%s).",_settlement.toString(),_issue.toString()));assert(()=>_maturity>_settlement,_lt("The maturity (%s) must be strictly greater than the settlement (%s).",_maturity.toString(),_settlement.toString()));assert(()=>_rate>=0,_lt("The rate (%s) must be positive or null.",_rate.toString()));assert(()=>_price>0,_lt("The price (%s) must be strictly positive.",_price.toString()));assert(()=>0<=_dayCountConvention&&_dayCountConvention<=4,_lt("The day_count_convention (%s) must be between 0 and 4 inclusive.",_dayCountConvention.toString()));const issueToMaturity=YEARFRAC.compute(_issue,_maturity,_dayCountConvention);const issueToSettlement=YEARFRAC.compute(_issue,_settlement,_dayCountConvention);const settlementToMaturity=YEARFRAC.compute(_settlement,_maturity,_dayCountConvention);const numerator=(100*(1+_rate*issueToMaturity))/(_price+100*_rate*issueToSettlement)-1;return numerator/settlementToMaturity;},};var financial=Object.freeze({__proto__:null,DB:DB,DURATION:DURATION,FV:FV,IRR:IRR,MDURATION:MDURATION,NPV:NPV,PDURATION:PDURATION,PV:PV,PRICE:PRICE,YIELD:YIELD,YIELDMAT:YIELDMAT});const ISERROR={description:_lt("Whether a value is an error."),args:args(`value (any, lazy) ${_lt("The value to be verified as an error type.")}`),returns:["BOOLEAN"],compute:function(value){try{value();return false;}
catch(e){return true;}},isExported:true,};const ISLOGICAL={description:_lt("Whether a value is `true` or `false`."),args:args(`value (any) ${_lt("The value to be verified as a logical TRUE or FALSE.")}`),returns:["BOOLEAN"],compute:function(value){return typeof value==="boolean";},isExported:true,};const ISNONTEXT={description:_lt("Whether a value is non-textual."),args:args(`value (any) ${_lt("The value to be checked.")}`),returns:["BOOLEAN"],compute:function(value){return typeof value!=="string";},isExported:true,};const ISNUMBER={description:_lt("Whether a value is a number."),args:args(`value (any) ${_lt("The value to be verified as a number.")}`),returns:["BOOLEAN"],compute:function(value){return typeof value==="number";},isExported:true,};const ISTEXT={description:_lt("Whether a value is text."),args:args(`value (any) ${_lt("The value to be verified as text.")}`),returns:["BOOLEAN"],compute:function(value){return typeof value==="string";},isExported:true,};var info=Object.freeze({__proto__:null,ISERROR:ISERROR,ISLOGICAL:ISLOGICAL,ISNONTEXT:ISNONTEXT,ISNUMBER:ISNUMBER,ISTEXT:ISTEXT});const AND={description:_lt("Logical `and` operator."),args:args(`
      logical_expression1 (boolean, range<boolean>) ${_lt("An expression or reference to a cell containing an expression that represents some logical value, i.e. TRUE or FALSE, or an expression that can be coerced to a logical value.")}
      logical_expression1 (boolean, range<boolean>, repeating) ${_lt("More expressions that represent logical values.")}
    `),returns:["BOOLEAN"],compute:function(...logicalExpressions){let foundBoolean=false;let acc=true;conditionalVisitBoolean(logicalExpressions,(arg)=>{foundBoolean=true;acc=acc&&arg;return acc;});assert(()=>foundBoolean,_lt(`[[FUNCTION_NAME]] has no valid input data.`));return acc;},isExported:true,};const IF={description:_lt("Returns value depending on logical expression."),args:args(`
      logical_expression (boolean) ${_lt("An expression or reference to a cell containing an expression that represents some logical value, i.e. TRUE or FALSE.")}
      value_if_true (any, lazy) ${_lt("The value the function returns if logical_expression is TRUE.")}
      value_if_false (any, lazy, default=FALSE) ${_lt("The value the function returns if logical_expression is FALSE.")}
    `),returns:["ANY"],compute:function(logicalExpression,valueIfTrue,valueIfFalse=()=>false){const result=toBoolean(logicalExpression)?valueIfTrue():valueIfFalse();return result===null||result===undefined?"":result;},isExported:true,};const IFERROR={description:_lt("Value if it is not an error, otherwise 2nd argument."),args:args(`
    value (any, lazy) ${_lt("The value to return if value itself is not an error.")}
    value_if_error (any, lazy, default=${_lt("An empty value")}) ${_lt("The value the function returns if value is an error.")}
  `),returns:["ANY"],compute:function(value,valueIfError=()=>""){let result;try{result=value();}
catch(e){result=valueIfError();}
return result===null||result===undefined?"":result;},isExported:true,};const IFS={description:_lt("Returns a value depending on multiple logical expressions."),args:args(`
      condition1 (boolean, lazy) ${_lt("The first condition to be evaluated. This can be a boolean, a number, an array, or a reference to any of those.")}
      value1 (any, lazy) ${_lt("The returned value if condition1 is TRUE.")}
      condition2 (boolean, lazy, repeating) ${_lt("Additional conditions to be evaluated if the previous ones are FALSE.")}
      value2 (any, lazy, repeating) ${_lt("Additional values to be returned if their corresponding conditions are TRUE.")}
  `),returns:["ANY"],compute:function(...values){assert(()=>values.length%2===0,_lt(`Wrong number of arguments. Expected an even number of arguments.`));for(let n=0;n<values.length-1;n+=2){if(toBoolean(values[n]())){return values[n+1]();}}
throw new Error(_lt(`No match.`));},isExported:true,};const NOT={description:_lt("Returns opposite of provided logical value."),args:args(`logical_expression (boolean) ${_lt("An expression or reference to a cell holding an expression that represents some logical value.")}
    `),returns:["BOOLEAN"],compute:function(logicalExpression){return!toBoolean(logicalExpression);},isExported:true,};const OR={description:_lt("Logical `or` operator."),args:args(`
      logical_expression1 (boolean, range<boolean>) ${_lt("An expression or reference to a cell containing an expression that represents some logical value, i.e. TRUE or FALSE, or an expression that can be coerced to a logical value.")}
      logical_expression2 (boolean, range<boolean>, repeating) ${_lt("More expressions that evaluate to logical values.")}
    `),returns:["BOOLEAN"],compute:function(...logicalExpressions){let foundBoolean=false;let acc=false;conditionalVisitBoolean(logicalExpressions,(arg)=>{foundBoolean=true;acc=acc||arg;return!acc;});assert(()=>foundBoolean,_lt(`[[FUNCTION_NAME]] has no valid input data.`));return acc;},isExported:true,};const XOR={description:_lt("Logical `xor` operator."),args:args(`
      logical_expression1 (boolean, range<boolean>) ${_lt("An expression or reference to a cell containing an expression that represents some logical value, i.e. TRUE or FALSE, or an expression that can be coerced to a logical value.")}
      logical_expression2 (boolean, range<boolean>, repeating) ${_lt("More expressions that evaluate to logical values.")}
    `),returns:["BOOLEAN"],compute:function(...logicalExpressions){let foundBoolean=false;let acc=false;conditionalVisitBoolean(logicalExpressions,(arg)=>{foundBoolean=true;acc=acc?!arg:arg;return true;});assert(()=>foundBoolean,_lt(`[[FUNCTION_NAME]] has no valid input data.`));return acc;},isExported:true,};var logical=Object.freeze({__proto__:null,AND:AND,IF:IF,IFERROR:IFERROR,IFS:IFS,NOT:NOT,OR:OR,XOR:XOR});const DEFAULT_IS_SORTED=true;function linearSearch(range,target){for(let i=0;i<range.length;i++){if(range[i]===target){return i;}}
return-1;}
const COLUMN={description:_lt("Column number of a specified cell."),args:args(`cell_reference (meta, default=${_lt("The cell in which the formula is entered")}) ${_lt("The cell whose column number will be returned. Column A corresponds to 1.")}
    `),returns:["NUMBER"],compute:function(cellReference){cellReference=cellReference||this.__originCellXC;assert(()=>!!cellReference,"In this context, the function [[FUNCTION_NAME]] needs to have a cell or range in parameter.");const zone=toZone(cellReference);return zone.left+1;},isExported:true,};const COLUMNS={description:_lt("Number of columns in a specified array or range."),args:args(`range (meta) ${_lt("The range whose column count will be returned.")}`),returns:["NUMBER"],compute:function(range){const zone=toZone(range);return zone.right-zone.left+1;},isExported:true,};const HLOOKUP={description:_lt(`Horizontal lookup`),args:args(`
      search_key (any) ${_lt("The value to search for. For example, 42, 'Cats', or I24.")}
      range (range) ${_lt("The range to consider for the search. The first row in the range is searched for the key specified in search_key.")}
      index (number) ${_lt("The row index of the value to be returned, where the first row in range is numbered 1.")}
      is_sorted (boolean, default=${DEFAULT_IS_SORTED}) ${_lt("Indicates whether the row to be searched (the first row of the specified range) is sorted, in which case the closest match for search_key will be returned.")}
  `),returns:["ANY"],compute:function(searchKey,range,index,isSorted=DEFAULT_IS_SORTED){const _index=Math.trunc(toNumber(index));assert(()=>1<=_index&&_index<=range[0].length,_lt("[[FUNCTION_NAME]] evaluates to an out of bounds range."));const _isSorted=toBoolean(isSorted);const firstRow=range.map((col)=>col[0]);let colIndex;if(_isSorted){colIndex=dichotomicPredecessorSearch(firstRow,searchKey);}
else{colIndex=linearSearch(firstRow,searchKey);}
assert(()=>colIndex>-1,_lt("Did not find value '%s' in [[FUNCTION_NAME]] evaluation.",toString(searchKey)));return range[colIndex][_index-1];},isExported:true,};const LOOKUP={description:_lt(`Look up a value.`),args:args(`
      search_key (any) ${_lt("The value to search for. For example, 42, 'Cats', or I24.")}
      search_array (range) ${_lt("One method of using this function is to provide a single sorted row or column search_array to look through for the search_key with a second argument result_range. The other way is to combine these two arguments into one search_array where the first row or column is searched and a value is returned from the last row or column in the array. If search_key is not found, a non-exact match may be returned.")}
      result_range (range, optional) ${_lt("The range from which to return a result. The value returned corresponds to the location where search_key is found in search_range. This range must be only a single row or column and should not be used if using the search_result_array method.")}
  `),returns:["ANY"],compute:function(searchKey,searchArray,resultRange){let nbCol=searchArray.length;let nbRow=searchArray[0].length;const verticalSearch=nbRow>=nbCol;const searchRange=verticalSearch?searchArray[0]:searchArray.map((c)=>c[0]);const index=dichotomicPredecessorSearch(searchRange,searchKey);assert(()=>index>=0,_lt("Did not find value '%s' in [[FUNCTION_NAME]] evaluation.",toString(searchKey)));if(resultRange===undefined){return verticalSearch?searchArray[nbCol-1][index]:searchArray[index][nbRow-1];}
nbCol=resultRange.length;nbRow=resultRange[0].length;assert(()=>nbCol===1||nbRow===1,_lt("The result_range must be a single row or a single column."));if(nbCol>1){assert(()=>index<=nbCol-1,_lt("[[FUNCTION_NAME]] evaluates to an out of range row value %s.",(index+1).toString()));return resultRange[index][0];}
assert(()=>index<=nbRow-1,_lt("[[FUNCTION_NAME]] evaluates to an out of range column value %s.",(index+1).toString()));return resultRange[0][index];},isExported:true,};const DEFAULT_SEARCH_TYPE=1;const MATCH={description:_lt(`Position of item in range that matches value.`),args:args(`
      search_key (any) ${_lt("The value to search for. For example, 42, 'Cats', or I24.")}
      range (any, range) ${_lt("The one-dimensional array to be searched.")}
      search_type (number, default=${DEFAULT_SEARCH_TYPE}) ${_lt("The search method. 1 (default) finds the largest value less than or equal to search_key when range is sorted in ascending order. 0 finds the exact value when range is unsorted. -1 finds the smallest value greater than or equal to search_key when range is sorted in descending order.")}
  `),returns:["NUMBER"],compute:function(searchKey,range,searchType=DEFAULT_SEARCH_TYPE){let _searchType=toNumber(searchType);const nbCol=range.length;const nbRow=range[0].length;assert(()=>nbCol===1||nbRow===1,_lt("The range must be a single row or a single column."));let index=-1;const _range=range.flat();_searchType=Math.sign(_searchType);switch(_searchType){case 1:index=dichotomicPredecessorSearch(_range,searchKey);break;case 0:index=linearSearch(_range,searchKey);break;case-1:index=dichotomicSuccessorSearch(_range,searchKey);break;}
assert(()=>index>=0,_lt("Did not find value '%s' in [[FUNCTION_NAME]] evaluation.",toString(searchKey)));return index+1;},isExported:true,};const ROW={description:_lt("Row number of a specified cell."),args:args(`cell_reference (meta, default=${_lt("The cell in which the formula is entered by default")}) ${_lt("The cell whose row number will be returned.")}`),returns:["NUMBER"],compute:function(cellReference){cellReference=cellReference||this.__originCellXC;assert(()=>!!cellReference,"In this context, the function [[FUNCTION_NAME]] needs to have a cell or range in parameter.");const zone=toZone(cellReference);return zone.top+1;},isExported:true,};const ROWS={description:_lt("Number of rows in a specified array or range."),args:args(`range (meta) ${_lt("The range whose row count will be returned.")}`),returns:["NUMBER"],compute:function(range){const zone=toZone(range);return zone.bottom-zone.top+1;},isExported:true,};const VLOOKUP={description:_lt(`Vertical lookup.`),args:args(`
      search_key (any) ${_lt("The value to search for. For example, 42, 'Cats', or I24.")}
      range (any, range) ${_lt("The range to consider for the search. The first column in the range is searched for the key specified in search_key.")}
      index (number) ${_lt("The column index of the value to be returned, where the first column in range is numbered 1.")}
      is_sorted (boolean, default=${DEFAULT_IS_SORTED}) ${_lt("Indicates whether the column to be searched (the first column of the specified range) is sorted, in which case the closest match for search_key will be returned.")}
  `),returns:["ANY"],compute:function(searchKey,range,index,isSorted=DEFAULT_IS_SORTED){const _index=Math.trunc(toNumber(index));assert(()=>1<=_index&&_index<=range.length,_lt("[[FUNCTION_NAME]] evaluates to an out of bounds range."));const _isSorted=toBoolean(isSorted);const firstCol=range[0];let rowIndex;if(_isSorted){rowIndex=dichotomicPredecessorSearch(firstCol,searchKey);}
else{rowIndex=linearSearch(firstCol,searchKey);}
assert(()=>rowIndex>-1,_lt("Did not find value '%s' in [[FUNCTION_NAME]] evaluation.",toString(searchKey)));return range[_index-1][rowIndex];},isExported:true,};var lookup=Object.freeze({__proto__:null,COLUMN:COLUMN,COLUMNS:COLUMNS,HLOOKUP:HLOOKUP,LOOKUP:LOOKUP,MATCH:MATCH,ROW:ROW,ROWS:ROWS,VLOOKUP:VLOOKUP});const ADD={description:_lt(`Sum of two numbers.`),args:args(`
      value1 (number) ${_lt("The first addend.")}
      value2 (number) ${_lt("The second addend.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(value1,value2){return toNumber(value1)+toNumber(value2);},};const CONCAT={description:_lt(`Concatenation of two values.`),args:args(`
      value1 (string) ${_lt("The value to which value2 will be appended.")}
      value2 (string) ${_lt("The value to append to value1.")}
    `),returns:["STRING"],compute:function(value1,value2){return toString(value1)+toString(value2);},isExported:true,};const DIVIDE={description:_lt(`One number divided by another.`),args:args(`
      dividend (number) ${_lt("The number to be divided.")}
      divisor (number) ${_lt("The number to divide by.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(dividend,divisor){const _divisor=toNumber(divisor);assert(()=>_divisor!==0,_lt("The divisor must be different from zero."));return toNumber(dividend)/_divisor;},};function isEmpty(value){return value===null||value===undefined;}
const getNeutral={number:0,string:"",boolean:false};const EQ={description:_lt(`Equal.`),args:args(`
      value1 (any) ${_lt("The first value.")}
      value2 (any) ${_lt("The value to test against value1 for equality.")}
    `),returns:["BOOLEAN"],compute:function(value1,value2){value1=isEmpty(value1)?getNeutral[typeof value2]:value1;value2=isEmpty(value2)?getNeutral[typeof value1]:value2;if(typeof value1==="string"){value1=value1.toUpperCase();}
if(typeof value2==="string"){value2=value2.toUpperCase();}
return value1===value2;},};function applyRelationalOperator(value1,value2,cb){value1=isEmpty(value1)?getNeutral[typeof value2]:value1;value2=isEmpty(value2)?getNeutral[typeof value1]:value2;if(typeof value1!=="number"){value1=toString(value1).toUpperCase();}
if(typeof value2!=="number"){value2=toString(value2).toUpperCase();}
const tV1=typeof value1;const tV2=typeof value2;if(tV1==="string"&&tV2==="number"){return true;}
if(tV2==="string"&&tV1==="number"){return false;}
return cb(value1,value2);}
const GT={description:_lt(`Strictly greater than.`),args:args(`
      value1 (any) ${_lt("The value to test as being greater than value2.")}
      value2 (any) ${_lt("The second value.")}
    `),returns:["BOOLEAN"],compute:function(value1,value2){return applyRelationalOperator(value1,value2,(v1,v2)=>{return v1>v2;});},};const GTE={description:_lt(`Greater than or equal to.`),args:args(`
      value1 (any) ${_lt("The value to test as being greater than or equal to value2.")}
      value2 (any) ${_lt("The second value.")}
    `),returns:["BOOLEAN"],compute:function(value1,value2){return applyRelationalOperator(value1,value2,(v1,v2)=>{return v1>=v2;});},};const LT={description:_lt(`Less than.`),args:args(`
      value1 (any) ${_lt("The value to test as being less than value2.")}
      value2 (any) ${_lt("The second value.")}
    `),returns:["BOOLEAN"],compute:function(value1,value2){return!GTE.compute(value1,value2);},};const LTE={description:_lt(`Less than or equal to.`),args:args(`
      value1 (any) ${_lt("The value to test as being less than or equal to value2.")}
      value2 (any) ${_lt("The second value.")}
    `),returns:["BOOLEAN"],compute:function(value1,value2){return!GT.compute(value1,value2);},};const MINUS={description:_lt(`Difference of two numbers.`),args:args(`
      value1 (number) ${_lt("The minuend, or number to be subtracted from.")}
      value2 (number) ${_lt("The subtrahend, or number to subtract from value1.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(value1,value2){return toNumber(value1)-toNumber(value2);},};const MULTIPLY={description:_lt(`Product of two numbers`),args:args(`
      factor1 (number) ${_lt("The first multiplicand.")}
      factor2 (number) ${_lt("The second multiplicand.")}
    `),returns:["NUMBER"],returnFormat:ReturnFormatType.FormatFromArgument,compute:function(factor1,factor2){return toNumber(factor1)*toNumber(factor2);},};const NE={description:_lt(`Not equal.`),args:args(`
      value1 (any) ${_lt("The first value.")}
      value2 (any) ${_lt("The value to test against value1 for inequality.")}
    `),returns:["BOOLEAN"],compute:function(value1,value2){return!EQ.compute(value1,value2);},};const POW={description:_lt(`A number raised to a power.`),args:args(`
      base (number) ${_lt("The number to raise to the exponent power.")}
      exponent (number) ${_lt("The exponent to raise base to.")}
    `),returns:["BOOLEAN"],compute:function(base,exponent){return POWER.compute(base,exponent);},};const UMINUS={description:_lt(`A number with the sign reversed.`),args:args(`
      value (number) ${_lt("The number to have its sign reversed. Equivalently, the number to multiply by -1.")}
    `),returnFormat:ReturnFormatType.FormatFromArgument,returns:["NUMBER"],compute:function(value){return-toNumber(value);},};const UNARY_PERCENT={description:_lt(`Value interpreted as a percentage.`),args:args(`
      percentage (number) ${_lt("The value to interpret as a percentage.")}
    `),returns:["NUMBER"],compute:function(percentage){return toNumber(percentage)/100;},};const UPLUS={description:_lt(`A specified number, unchanged.`),args:args(`
      value (any) ${_lt("The number to return.")}
    `),returnFormat:ReturnFormatType.FormatFromArgument,returns:["ANY"],compute:function(value){return value;},};var operators=Object.freeze({__proto__:null,ADD:ADD,CONCAT:CONCAT,DIVIDE:DIVIDE,EQ:EQ,GT:GT,GTE:GTE,LT:LT,LTE:LTE,MINUS:MINUS,MULTIPLY:MULTIPLY,NE:NE,POW:POW,UMINUS:UMINUS,UNARY_PERCENT:UNARY_PERCENT,UPLUS:UPLUS});const DEFAULT_STARTING_AT=1;const CHAR={description:_lt("Gets character associated with number."),args:args(`
      table_number (number) ${_lt("The number of the character to look up from the current Unicode table in decimal format.")}
  `),returns:["STRING"],compute:function(tableNumber){const _tableNumber=Math.trunc(toNumber(tableNumber));assert(()=>_tableNumber>=1,_lt("The table_number (%s) is out of range.",_tableNumber.toString()));return String.fromCharCode(_tableNumber);},isExported:true,};const CONCATENATE={description:_lt("Appends strings to one another."),args:args(`
      string1 (string, range<string>) ${_lt("The initial string.")}
      string2 (string, range<string>, repeating) ${_lt("More strings to append in sequence.")}
  `),returns:["STRING"],compute:function(...values){return reduceAny(values,(acc,a)=>acc+toString(a),"");},isExported:true,};const EXACT={description:_lt("Tests whether two strings are identical."),args:args(`
      string1 (string) ${_lt("The first string to compare.")}
      string2 (string) ${_lt("The second string to compare.")}
  `),returns:["BOOLEAN"],compute:function(string1,string2){return toString(string1)===toString(string2);},isExported:true,};const FIND={description:_lt("First position of string found in text, case-sensitive."),args:args(`
      search_for (string) ${_lt("The string to look for within text_to_search.")}
      text_to_search (string) ${_lt("The text to search for the first occurrence of search_for.")}
      starting_at (number, default=${DEFAULT_STARTING_AT}) ${_lt("The character within text_to_search at which to start the search.")}
  `),returns:["NUMBER"],compute:function(searchFor,textToSearch,startingAt=DEFAULT_STARTING_AT){const _searchFor=toString(searchFor);const _textToSearch=toString(textToSearch);const _startingAt=toNumber(startingAt);assert(()=>_textToSearch!=="",_lt(`The text_to_search must be non-empty.`));assert(()=>_startingAt>=1,_lt("The starting_at (%s) must be greater than or equal to 1.",_startingAt.toString()));const result=_textToSearch.indexOf(_searchFor,_startingAt-1);assert(()=>result>=0,_lt("In [[FUNCTION_NAME]] evaluation, cannot find '%s' within '%s'.",_searchFor.toString(),_textToSearch));return result+1;},isExported:true,};const JOIN={description:_lt("Concatenates elements of arrays with delimiter."),args:args(`
      delimiter (string) ${_lt("The character or string to place between each concatenated value.")}
      value_or_array1 (string, range<string>) ${_lt("The value or values to be appended using delimiter.")}
      value_or_array2 (string, range<string>, repeating) ${_lt("More values to be appended using delimiter.")}
  `),returns:["STRING"],compute:function(delimiter,...valuesOrArrays){const _delimiter=toString(delimiter);return reduceAny(valuesOrArrays,(acc,a)=>(acc?acc+_delimiter:"")+toString(a),"");},};const LEFT={description:_lt("Substring from beginning of specified string."),args:args(`
      text (string) ${_lt("The string from which the left portion will be returned.")}
      number_of_characters (number, optional) ${_lt("The number of characters to return from the left side of string.")}
  `),returns:["STRING"],compute:function(text,...args){const _numberOfCharacters=args.length?toNumber(args[0]):1;assert(()=>_numberOfCharacters>=0,_lt("The number_of_characters (%s) must be positive or null.",_numberOfCharacters.toString()));return toString(text).substring(0,_numberOfCharacters);},isExported:true,};const LEN={description:_lt("Length of a string."),args:args(`
      text (string) ${_lt("The string whose length will be returned.")}
  `),returns:["NUMBER"],compute:function(text){return toString(text).length;},isExported:true,};const LOWER={description:_lt("Converts a specified string to lowercase."),args:args(`
      text (string) ${_lt("The string to convert to lowercase.")}
  `),returns:["STRING"],compute:function(text){return toString(text).toLowerCase();},isExported:true,};const REPLACE={description:_lt("Replaces part of a text string with different text."),args:args(`
      text (string) ${_lt("The text, a part of which will be replaced.")}
      position (number) ${_lt("The position where the replacement will begin (starting from 1).")}
      length (number) ${_lt("The number of characters in the text to be replaced.")}
      new_text (string) ${_lt("The text which will be inserted into the original text.")}
  `),returns:["STRING"],compute:function(text,position,length,newText){const _position=toNumber(position);assert(()=>_position>=1,_lt("The position (%s) must be greater than or equal to 1.",_position.toString()));const _text=toString(text);const _length=toNumber(length);const _newText=toString(newText);return _text.substring(0,_position-1)+_newText+_text.substring(_position-1+_length);},isExported:true,};const RIGHT={description:_lt("A substring from the end of a specified string."),args:args(`
      text (string) ${_lt("The string from which the right portion will be returned.")}
      number_of_characters (number, optional) ${_lt("The number of characters to return from the right side of string.")}
  `),returns:["STRING"],compute:function(text,...args){const _numberOfCharacters=args.length?toNumber(args[0]):1;assert(()=>_numberOfCharacters>=0,_lt("The number_of_characters (%s) must be positive or null.",_numberOfCharacters.toString()));const _text=toString(text);const stringLength=_text.length;return _text.substring(stringLength-_numberOfCharacters,stringLength);},isExported:true,};const SEARCH={description:_lt("First position of string found in text, ignoring case."),args:args(`
      search_for (string) ${_lt("The string to look for within text_to_search.")}
      text_to_search (string) ${_lt("The text to search for the first occurrence of search_for.")}
      starting_at (number, default=${DEFAULT_STARTING_AT}) ${_lt("The character within text_to_search at which to start the search.")}
  `),returns:["NUMBER"],compute:function(searchFor,textToSearch,startingAt=DEFAULT_STARTING_AT){const _searchFor=toString(searchFor).toLowerCase();const _textToSearch=toString(textToSearch).toLowerCase();const _startingAt=toNumber(startingAt);assert(()=>_textToSearch!=="",_lt(`The text_to_search must be non-empty.`));assert(()=>_startingAt>=1,_lt("The starting_at (%s) must be greater than or equal to 1.",_startingAt.toString()));const result=_textToSearch.indexOf(_searchFor,_startingAt-1);assert(()=>result>=0,_lt("In [[FUNCTION_NAME]] evaluation, cannot find '%s' within '%s'.",_searchFor,_textToSearch));return result+1;},isExported:true,};const SUBSTITUTE={description:_lt("Replaces existing text with new text in a string."),args:args(`
      text_to_search (string) ${_lt("The text within which to search and replace.")}
      search_for (string) ${_lt("The string to search for within text_to_search.")}
      replace_with (string) ${_lt("The string that will replace search_for.")}
      occurrence_number (number, optional) ${_lt("The instance of search_for within text_to_search to replace with replace_with. By default, all occurrences of search_for are replaced; however, if occurrence_number is specified, only the indicated instance of search_for is replaced.")}
  `),returns:["NUMBER"],compute:function(textToSearch,searchFor,replaceWith,occurrenceNumber=undefined){const _occurrenceNumber=toNumber(occurrenceNumber);assert(()=>_occurrenceNumber>=0,_lt("The occurrenceNumber (%s) must be positive or null.",_occurrenceNumber.toString()));const _textToSearch=toString(textToSearch);const _searchFor=toString(searchFor);if(_searchFor===""){return _textToSearch;}
const _replaceWith=toString(replaceWith);const reg=new RegExp(_searchFor,"g");if(_occurrenceNumber===0){return _textToSearch.replace(reg,_replaceWith);}
let n=0;return _textToSearch.replace(reg,(text)=>(++n===_occurrenceNumber?_replaceWith:text));},isExported:true,};const TEXTJOIN={description:_lt("Combines text from multiple strings and/or arrays."),args:args(`
      delimiter (string) ${_lt(" A string, possible empty, or a reference to a valid string. If empty, the text will be simply concatenated.")}
      ignore_empty (boolean) ${_lt("A boolean; if TRUE, empty cells selected in the text arguments won't be included in the result.")}
      text1 (string, range<string>) ${_lt("Any text item. This could be a string, or an array of strings in a range.")}
      text2 (string, range<string>, repeating) ${_lt("Additional text item(s).")}
  `),returns:["STRING"],compute:function(delimiter,ignoreEmpty,...textsOrArrays){const _delimiter=toString(delimiter);const _ignoreEmpty=toBoolean(ignoreEmpty);let n=0;return reduceAny(textsOrArrays,(acc,a)=>!(_ignoreEmpty&&toString(a)==="")?(n++?acc+_delimiter:"")+toString(a):acc,"");},isExported:true,};const TRIM={description:_lt("Removes space characters."),args:args(`
      text (string) ${_lt("The text or reference to a cell containing text to be trimmed.")}
  `),returns:["STRING"],compute:function(text){return toString(text).trim();},isExported:true,};const UPPER={description:_lt("Converts a specified string to uppercase."),args:args(`
      text (string) ${_lt("The string to convert to uppercase.")}
  `),returns:["STRING"],compute:function(text){return toString(text).toUpperCase();},isExported:true,};var text=Object.freeze({__proto__:null,CHAR:CHAR,CONCATENATE:CONCATENATE,EXACT:EXACT,FIND:FIND,JOIN:JOIN,LEFT:LEFT,LEN:LEN,LOWER:LOWER,REPLACE:REPLACE,RIGHT:RIGHT,SEARCH:SEARCH,SUBSTITUTE:SUBSTITUTE,TEXTJOIN:TEXTJOIN,TRIM:TRIM,UPPER:UPPER});const functions$4={database,date,financial,info,lookup,logical,math,operators,statistical,text,};class FunctionRegistry extends Registry{constructor(){super(...arguments);this.mapping={};}
add(name,addDescr){name=name.toUpperCase().replace("_",".");const descr=addMetaInfoFromArg(addDescr);validateArguments(descr.args);this.mapping[name]=descr.compute;super.add(name,descr);return this;}}
const functionRegistry=new FunctionRegistry();for(let category in functions$4){const fns=functions$4[category];for(let name in fns){const addDescr=fns[name];addDescr.category=category;functionRegistry.add(name,{isExported:false,...addDescr});}}
const dependencyIdentifierRegex=/^[S|N]?\d+/;const functions$3=functionRegistry.content;const OPERATORS="+,-,*,/,:,=,<>,>=,>,<=,<,%,^,&".split(",");function tokenize(str){const chars=str.split("");const result=[];let tokenCount=0;while(chars.length){tokenCount++;if(tokenCount>100){throw new Error(_lt("This formula has over 100 parts. It can't be processed properly, consider splitting it into multiple cells"));}
let token=tokenizeSpace(chars)||tokenizeMisc(chars)||tokenizeOperator(chars)||tokenizeString(chars)||tokenizeDebugger(chars)||tokenizeNormalizedReferences(chars)||tokenizeInvalidRange(chars)||tokenizeNumber(chars)||tokenizeSymbol(chars);if(!token){token={type:"UNKNOWN",value:chars.shift()};}
result.push(token);}
return result;}
function tokenizeNormalizedReferences(chars){if(chars[0]===FORMULA_REF_IDENTIFIER){chars.shift();const match=chars.join("").match(dependencyIdentifierRegex);if(match){chars.splice(0,match[0].length);}
else{return null;}
if(chars[0]===FORMULA_REF_IDENTIFIER){chars.shift();}
const value=match[0];switch(value[0]){case"S":return{type:"NORMALIZED_STRING",value:value.substring(1)};case"N":return{type:"NORMALIZED_NUMBER",value:value.substring(1)};default:return{type:"REFERENCE",value};}}
return null;}
function tokenizeDebugger(chars){if(chars[0]==="?"){chars.shift();return{type:"DEBUGGER",value:"?"};}
return null;}
const misc={",":"COMMA","(":"LEFT_PAREN",")":"RIGHT_PAREN",};function tokenizeMisc(chars){if(chars[0]in misc){const value=chars.shift();const type=misc[value];return{type,value};}
return null;}
function startsWith(chars,op){for(let i=0;i<op.length;i++){if(op[i]!==chars[i]){return false;}}
return true;}
function tokenizeOperator(chars){for(let op of OPERATORS){if(startsWith(chars,op)){chars.splice(0,op.length);return{type:"OPERATOR",value:op};}}
return null;}
function tokenizeNumber(chars){const match=chars.join("").match(formulaNumberRegexp);if(match){chars.splice(0,match[0].length);return{type:"NUMBER",value:match[0]};}
return null;}
function tokenizeString(chars){if(chars[0]==='"'){const startChar=chars.shift();const letters=[startChar];while(chars[0]&&(chars[0]!==startChar||letters[letters.length-1]==="\\")){letters.push(chars.shift());}
if(chars[0]==='"'){letters.push(chars.shift());}
return{type:"STRING",value:letters.join(""),};}
return null;}
const separatorRegexp=/\w|\.|!|\$/;function tokenizeSymbol(chars){const result=[];if(chars[0]==="'"){let lastChar=chars.shift();result.push(lastChar);while(chars[0]){lastChar=chars.shift();result.push(lastChar);if(lastChar==="'"){if(chars[0]&&chars[0]==="'"){lastChar=chars.shift();result.push(lastChar);}
else{break;}}}
if(lastChar!=="'"){return{type:"UNKNOWN",value:result.join(""),};}}
while(chars[0]&&chars[0].match(separatorRegexp)){result.push(chars.shift());}
if(result.length){const value=result.join("");const isFunction=value.toUpperCase()in functions$3;const type=isFunction?"FUNCTION":"SYMBOL";return{type,value};}
return null;}
const whiteSpaceRegexp=/\s/;function tokenizeSpace(chars){let length=0;while(chars[0]&&chars[0].match(whiteSpaceRegexp)){length++;chars.shift();}
if(length){return{type:"SPACE",value:" ".repeat(length)};}
return null;}
function tokenizeInvalidRange(chars){if(startsWith(chars,INCORRECT_RANGE_STRING)){chars.splice(0,INCORRECT_RANGE_STRING.length);return{type:"INVALID_REFERENCE",value:INCORRECT_RANGE_STRING};}
return null;}
const UNARY_OPERATORS=["-","+"];const ASSOCIATIVE_OPERATORS=["*","+","&"];const OP_PRIORITY={"^":30,"*":20,"/":20,"+":15,"-":15,"&":13,">":10,"<>":10,">=":10,"<":10,"<=":10,"=":10,};const FUNCTION_BP=6;function bindingPower(token){switch(token.type){case"NUMBER":case"SYMBOL":return 0;case"COMMA":return 3;case"LEFT_PAREN":return 5;case"RIGHT_PAREN":return 5;case"OPERATOR":return OP_PRIORITY[token.value]||15;}
throw new Error(_lt("Unknown token: %s",token.value));}
function parsePrefix(current,tokens){switch(current.type){case"DEBUGGER":const next=parseExpression(tokens,1000);next.debug=true;return next;case"NUMBER":return{type:"NUMBER",value:parseNumber(current.value)};case"NORMALIZED_NUMBER":return{type:"NORMALIZED_NUMBER",value:parseInt(current.value,10)};case"STRING":return{type:"STRING",value:current.value};case"NORMALIZED_STRING":return{type:"NORMALIZED_STRING",value:parseInt(current.value,10)};case"FUNCTION":if(tokens.shift().type!=="LEFT_PAREN"){throw new Error(_lt("Wrong function call"));}
else{const args=[];if(tokens[0].type!=="RIGHT_PAREN"){if(tokens[0].type==="COMMA"){args.push({type:"UNKNOWN",value:""});}
else{args.push(parseExpression(tokens,FUNCTION_BP));}
while(tokens[0].type==="COMMA"){tokens.shift();if(tokens[0].type==="RIGHT_PAREN"){args.push({type:"UNKNOWN",value:""});break;}
if(tokens[0].type==="COMMA"){args.push({type:"UNKNOWN",value:""});}
else{args.push(parseExpression(tokens,FUNCTION_BP));}}}
if(tokens.shift().type!=="RIGHT_PAREN"){throw new Error(_lt("Wrong function call"));}
return{type:"FUNCALL",value:current.value,args};}
case"REFERENCE":return{type:"NORMALIZED_REFERENCE",value:parseInt(current.value,10),};case"INVALID_REFERENCE":throw new Error(_lt("Invalid reference"));case"SYMBOL":if(cellReference.test(current.value)){return{type:"REFERENCE",value:current.value,};}
else{if(["TRUE","FALSE"].includes(current.value.toUpperCase())){return{type:"BOOLEAN",value:current.value.toUpperCase()==="TRUE"};}
else{if(current.value){throw new Error(_lt("Invalid formula"));}
return{type:"STRING",value:current.value};}}
case"LEFT_PAREN":const result=parseExpression(tokens,5);if(!tokens.length||tokens[0].type!=="RIGHT_PAREN"){throw new Error(_lt("Unmatched left parenthesis"));}
tokens.shift();return result;default:if(current.type==="OPERATOR"&&UNARY_OPERATORS.includes(current.value)){return{type:"UNARY_OPERATION",value:current.value,right:parseExpression(tokens,OP_PRIORITY[current.value]),};}
throw new Error(_lt("Unexpected token: %s",current.value));}}
function parseInfix(left,current,tokens){if(current.type==="OPERATOR"){const bp=bindingPower(current);const right=parseExpression(tokens,bp);return{type:"BIN_OPERATION",value:current.value,left,right,};}
throw new Error(DEFAULT_ERROR_MESSAGE);}
function parseExpression(tokens,bp){const token=tokens.shift();if(!token){throw new Error(DEFAULT_ERROR_MESSAGE);}
let expr=parsePrefix(token,tokens);while(tokens[0]&&bindingPower(tokens[0])>bp){expr=parseInfix(expr,tokens.shift(),tokens);}
return expr;}
function parse(str){const tokens=tokenize(str).filter((x)=>x.type!=="SPACE");if(tokens[0].type==="OPERATOR"&&tokens[0].value==="="){tokens.splice(0,1);}
const result=parseExpression(tokens,0);if(tokens.length){throw new Error(DEFAULT_ERROR_MESSAGE);}
return result;}
function convertAstNodes(ast,type,fn){if(type===ast.type){ast=fn(ast);}
switch(ast.type){case"FUNCALL":return{...ast,args:ast.args.map((child)=>convertAstNodes(child,type,fn)),};case"UNARY_OPERATION":return{...ast,right:convertAstNodes(ast.right,type,fn),};case"BIN_OPERATION":return{...ast,right:convertAstNodes(ast.right,type,fn),left:convertAstNodes(ast.left,type,fn),};default:return ast;}}
function astToFormula(ast,dependencies={references:[],numbers:[],strings:[]}){switch(ast.type){case"FUNCALL":const args=ast.args.map((arg)=>astToFormula(arg,dependencies));return`${ast.value}(${args.join(",")})`;case"NUMBER":return ast.value.toString();case"NORMALIZED_STRING":return`"${dependencies.strings[ast.value]}"`;case"NORMALIZED_NUMBER":return dependencies.numbers[ast.value].toString();case"NORMALIZED_REFERENCE":return dependencies.references[ast.value].toString();case"REFERENCE":case"STRING":return ast.value;case"BOOLEAN":return ast.value?"TRUE":"FALSE";case"UNARY_OPERATION":return ast.value+rightOperandToFormula(ast,dependencies);case"BIN_OPERATION":return(leftOperandToFormula(ast,dependencies)+
ast.value+
rightOperandToFormula(ast,dependencies));default:return ast.value;}}
function leftOperandToFormula(binaryOperationAST,dependencies){const mainOperator=binaryOperationAST.value;const leftOperation=binaryOperationAST.left;const leftOperator=leftOperation.value;const needParenthesis=leftOperation.type==="BIN_OPERATION"&&OP_PRIORITY[leftOperator]<OP_PRIORITY[mainOperator];return needParenthesis?`(${astToFormula(leftOperation, dependencies)})`:astToFormula(leftOperation,dependencies);}
function rightOperandToFormula(binaryOperationAST,dependencies){const mainOperator=binaryOperationAST.value;const rightOperation=binaryOperationAST.right;const rightPriority=OP_PRIORITY[rightOperation.value];const mainPriority=OP_PRIORITY[mainOperator];let needParenthesis=false;if(rightOperation.type!=="BIN_OPERATION"){needParenthesis=false;}
else if(rightPriority<mainPriority){needParenthesis=true;}
else if(rightPriority===mainPriority&&!ASSOCIATIVE_OPERATORS.includes(mainOperator)){needParenthesis=true;}
return needParenthesis?`(${astToFormula(rightOperation, dependencies)})`:astToFormula(rightOperation,dependencies);}
const functions$2=functionRegistry.content;const OPERATOR_MAP={"=":"EQ","+":"ADD","-":"MINUS","*":"MULTIPLY","/":"DIVIDE",">=":"GTE","<>":"NE",">":"GT","<=":"LTE","<":"LT","^":"POWER","&":"CONCATENATE",};const UNARY_OPERATOR_MAP={"-":"UMINUS","+":"UPLUS",};function splitCodeLines(codeBlocks){return codeBlocks.map((code)=>code.split("\n")).flat().filter((line)=>line.trim()!=="");}
const functionCache={};function compile(formula){if(!functionCache[formula.text]){const ast=parse(formula.text);let nextId=1;if(ast.type==="BIN_OPERATION"&&ast.value===":"){throw new Error(_lt("Invalid formula"));}
if(ast.type==="UNKNOWN"){throw new Error(_lt("Invalid formula"));}
const compiledAST=compileAST(ast);const code=splitCodeLines([`// ${formula.text}`,compiledAST.code,`return ${compiledAST.id};`,]).join("\n");let baseFunction=new Function("deps","sheetId","ref","range","ctx",code);functionCache[formula.text]=baseFunction;functionCache[formula.text].dependenciesFormat=formatAST(ast);function compileFunctionArgs(ast){const functionDefinition=functions$2[ast.value.toUpperCase()];const currentFunctionArguments=ast.args;const nbrArg=currentFunctionArguments.length;if(nbrArg<functionDefinition.minArgRequired){throw new Error(_lt("Invalid number of arguments for the %s function. Expected %s minimum, but got %s instead.",ast.value.toUpperCase(),functionDefinition.minArgRequired.toString(),nbrArg.toString()));}
if(nbrArg>functionDefinition.maxArgPossible){throw new Error(_lt("Invalid number of arguments for the %s function. Expected %s maximum, but got %s instead.",ast.value.toUpperCase(),functionDefinition.maxArgPossible.toString(),nbrArg.toString()));}
const repeatingArg=functionDefinition.nbrArgRepeating;if(repeatingArg>1){const argBeforeRepeat=functionDefinition.args.length-repeatingArg;const nbrRepeatingArg=nbrArg-argBeforeRepeat;if(nbrRepeatingArg%repeatingArg!==0){throw new Error(_lt("Invalid number of arguments for the %s function. Expected all arguments after position %s to be supplied by groups of %s arguments",ast.value.toUpperCase(),argBeforeRepeat.toString(),repeatingArg.toString()));}}
let listArgs=[];for(let i=0;i<nbrArg;i++){const argPosition=functionDefinition.getArgToFocus(i+1)-1;if(0<=argPosition&&argPosition<functionDefinition.args.length){const currentArg=currentFunctionArguments[i];const argDefinition=functionDefinition.args[argPosition];const argTypes=argDefinition.type||[];const isMeta=argTypes.includes("META");const isLazy=argDefinition.lazy;const hasRange=argTypes.some((t)=>t==="RANGE"||t==="RANGE<BOOLEAN>"||t==="RANGE<DATE>"||t==="RANGE<NUMBER>"||t==="RANGE<STRING>");const isRangeOnly=argTypes.every((t)=>t==="RANGE"||t==="RANGE<BOOLEAN>"||t==="RANGE<DATE>"||t==="RANGE<NUMBER>"||t==="RANGE<STRING>");if(isRangeOnly){if(currentArg.type!=="NORMALIZED_REFERENCE"){throw new Error(_lt("Function %s expects the parameter %s to be reference to a cell or range, not a %s.",ast.value.toUpperCase(),(i+1).toString(),currentArg.type.toLowerCase().replace("normalized_","")));}}
const compiledAST=compileAST(currentArg,isLazy,isMeta,hasRange,{functionName:ast.value.toUpperCase(),paramIndex:i+1,});listArgs.push(compiledAST);}}
return listArgs;}
function compileAST(ast,isLazy=false,isMeta=false,hasRange=false,referenceVerification={}){const codeBlocks=[];let id,fnName,statement;if(ast.type!=="NORMALIZED_REFERENCE"&&!(ast.type==="BIN_OPERATION"&&ast.value===":")){if(isMeta){throw new Error(_lt(`Argument must be a reference to a cell or range.`));}}
if(ast.debug){codeBlocks.push("debugger;");}
switch(ast.type){case"BOOLEAN":case"NUMBER":case"STRING":if(!isLazy){return{id:ast.value,code:""};}
id=nextId++;statement=`${ast.value}`;break;case"NORMALIZED_NUMBER":id=nextId++;statement=`deps.numbers[${ast.value}]`;break;case"NORMALIZED_STRING":id=nextId++;statement=`deps.strings[${ast.value}]`;break;case"REFERENCE":throw new Error(`Only normalized references can be compiled: ${ast.value}`);case"NORMALIZED_REFERENCE":const referenceIndex=formula.dependencies.references[ast.value];if(!referenceIndex){id=nextId++;statement=`null`;break;}
id=nextId++;if(hasRange){statement=`range(${ast.value}, deps.references, sheetId)`;}
else{statement=`ref(${ast.value}, deps.references, sheetId, ${isMeta ? "true" : "false"}, "${referenceVerification.functionName || OPERATOR_MAP["="]}",  ${referenceVerification.paramIndex})`;}
break;case"FUNCALL":id=nextId++;const args=compileFunctionArgs(ast);codeBlocks.push(splitCodeLines(args.map((arg)=>arg.code)).join("\n"));fnName=ast.value.toUpperCase();codeBlocks.push(`ctx.__lastFnCalled = '${fnName}';`);statement=`ctx['${fnName}'](${args.map((arg) => arg.id)})`;break;case"UNARY_OPERATION":{id=nextId++;fnName=UNARY_OPERATOR_MAP[ast.value];const right=compileAST(ast.right,false,false,false,{functionName:fnName,});codeBlocks.push(right.code);codeBlocks.push(`ctx.__lastFnCalled = '${fnName}';`);statement=`ctx['${fnName}']( ${right.id})`;break;}
case"BIN_OPERATION":{id=nextId++;fnName=OPERATOR_MAP[ast.value];const left=compileAST(ast.left,false,false,false,{functionName:fnName,});const right=compileAST(ast.right,false,false,false,{functionName:fnName,});codeBlocks.push(left.code);codeBlocks.push(right.code);codeBlocks.push(`ctx.__lastFnCalled = '${fnName}';`);statement=`ctx['${fnName}'](${left.id}, ${right.id})`;break;}
case"UNKNOWN":if(!isLazy){return{id:"undefined",code:""};}
id=nextId++;statement=`undefined`;break;}
if(isLazy){const lazyFunction=`const _${id} = () => {\n`+`\t${splitCodeLines(codeBlocks).join("\n\t")}\n`+`\treturn ${statement};\n`+"}";return{id:`_${id}`,code:lazyFunction};}
else{codeBlocks.push(`let _${id} = ${statement};`);return{id:`_${id}`,code:splitCodeLines(codeBlocks).join("\n")};}}
function formatAST(ast){let fnDef;switch(ast.type){case"NORMALIZED_REFERENCE":const referenceIndex=formula.dependencies.references[ast.value];if(referenceIndex){return[ast.value];}
break;case"FUNCALL":fnDef=functions$2[ast.value.toUpperCase()];if(fnDef.returnFormat){if(fnDef.returnFormat==="FormatFromArgument"){if(ast.args.length>0){const argPosition=0;const argType=fnDef.args[argPosition].type;if(!argType.includes("META")){return formatAST(ast.args[argPosition]);}}}
else{return[fnDef.returnFormat.specificFormat];}}
break;case"UNARY_OPERATION":return formatAST(ast.right);case"BIN_OPERATION":fnDef=functions$2[OPERATOR_MAP[ast.value]];if(fnDef.returnFormat){if(fnDef.returnFormat==="FormatFromArgument"){const left=formatAST(ast.left);if(typeof left[left.length-1]==="string"){return left;}
const right=formatAST(ast.right);return left.concat(right);}
else{return[fnDef.returnFormat.specificFormat];}}
break;}
return[];}}
return functionCache[formula.text];}
function mergeSymbolsIntoRanges(result,removeSpace=false){let operator=undefined;let refStart=undefined;let refEnd=undefined;let startIncludingSpaces=undefined;const reset=()=>{startIncludingSpaces=undefined;refStart=undefined;operator=undefined;refEnd=undefined;};for(let i=0;i<result.length;i++){const token=result[i];if(startIncludingSpaces){if(refStart){if(token.type==="SPACE"){continue;}
else if(token.type==="OPERATOR"&&token.value===":"){operator=i;}
else if(operator&&token.type==="SYMBOL"){refEnd=i;}
else{if(startIncludingSpaces&&refStart&&operator&&refEnd){const newToken={type:"SYMBOL",value:result.slice(startIncludingSpaces,i).filter((x)=>!removeSpace||x.type!=="SPACE").map((x)=>x.value).join(""),};result.splice(startIncludingSpaces,i-startIncludingSpaces,newToken);i=startIncludingSpaces+1;reset();}
else{if(token.type==="SYMBOL"){startIncludingSpaces=i;refStart=i;operator=undefined;}
else{reset();}}}}
else{if(token.type==="SYMBOL"){refStart=i;operator=refEnd=undefined;}
else{reset();}}}
else{if(["SPACE","SYMBOL"].includes(token.type)){startIncludingSpaces=i;refStart=token.type==="SYMBOL"?i:undefined;operator=refEnd=undefined;}
else{reset();}}}
const i=result.length-1;if(startIncludingSpaces&&refStart&&operator&&refEnd){const newToken={type:"SYMBOL",value:result.slice(startIncludingSpaces,i+1).filter((x)=>!removeSpace||x.type!=="SPACE").map((x)=>x.value).join(""),};result.splice(startIncludingSpaces,i-startIncludingSpaces+1,newToken);}
return result;}
function rangeTokenize(formula){const tokens=tokenize(formula);return mergeSymbolsIntoRanges(tokens,true);}
function enrichTokens(tokens){let current=0;return tokens.map((x)=>{const len=x.value.toString().length;const token=Object.assign({},x,{start:current,end:current+len,length:len,});current=token.end;return token;});}
function mapParenthesis(tokens){let maxParen=1;const stack=[];return tokens.map((token)=>{if(token.type==="LEFT_PAREN"){stack.push(maxParen);token.parenIndex=maxParen;maxParen++;}
else if(token.type==="RIGHT_PAREN"){token.parenIndex=stack.pop();}
return token;});}
function mapParentFunction(tokens){let stack=[];let functionStarted="";const res=tokens.map((token,i)=>{if(!["SPACE","LEFT_PAREN"].includes(token.type)){functionStarted="";}
switch(token.type){case"FUNCTION":functionStarted=token.value;break;case"LEFT_PAREN":stack.push({parent:functionStarted,argPosition:0});functionStarted="";break;case"RIGHT_PAREN":stack.pop();break;case"COMMA":if(stack.length){stack[stack.length-1].argPosition++;}
break;}
if(stack.length){const functionContext=stack[stack.length-1];if(functionContext.parent){token.functionContext=Object.assign({},functionContext);}}
return token;});return res;}
function composerTokenize(formula){const tokens=tokenize(formula);return mapParentFunction(mapParenthesis(enrichTokens(mergeSymbolsIntoRanges(tokens))));}
function normalize(formula){const tokens=rangeTokenize(formula);let dependencies={numbers:[],strings:[],references:[],};let noRefFormula="".concat(...tokens.map((token)=>{if(token.type==="SYMBOL"&&cellReference.test(token.value)){const value=token.value.trim();if(!dependencies.references.includes(value)){dependencies.references.push(value);}
const index=dependencies.references.indexOf(value).toString();return formatIndex(index);}
else if("STRING"===token.type){const value=token.value.slice(1).slice(0,token.value.length-2);if(!dependencies.strings.includes(value)){dependencies.strings.push(value);}
const index=dependencies.strings.indexOf(value);return formatIndex(`${token.type[0]}${index}`);}
else if(token.type==="NUMBER"){const value=parseNumber(token.value);if(!dependencies.numbers.includes(value)){dependencies.numbers.push(value);}
const index=dependencies.numbers.indexOf(value);return formatIndex(`${token.type[0]}${index}`);}
else{return token.value;}}));return{text:noRefFormula,dependencies};}
function formatIndex(index){return`${FORMULA_REF_IDENTIFIER}${index}${FORMULA_REF_IDENTIFIER}`;}
const cellRegistry=new Registry();function formatValue(value,format){switch(typeof value){case"string":return value;case"boolean":return value?"TRUE":"FALSE";case"number":if(format===null||format===void 0?void 0:format.match(DATETIME_FORMAT)){return formatDateTime({value,format:format});}
return format?formatNumber(value,format):formatStandardNumber(value);case"object":return"0";}}
function parsePrimitiveContent(content){if(content===""){return"";}
else if(isNumber(content)){return parseNumber(content);}
else if(isBoolean(content)){return content.toUpperCase()==="TRUE"?true:false;}
else if(isDateTime(content)){return parseDateTime(content).value;}
else{return content;}}
function computeFormulaFormat(sheets,compiledFormula,dependencies){var _a;const dependenciesFormat=compiledFormula.dependenciesFormat;for(let dependencyFormat of dependenciesFormat){switch(typeof dependencyFormat){case"string":return dependencyFormat;case"number":const ref=dependencies[dependencyFormat];const s=sheets[ref.sheetId];if(s){const cellRef=(_a=s.rows[ref.zone.top])===null||_a===void 0?void 0:_a.cells[ref.zone.left];if(cellRef&&cellRef.format){return cellRef.format;}}
break;}}
return NULL_FORMAT;}
class AbstractCell{constructor(id,evaluated,properties){this.id=id;this.evaluated=evaluated;this.style=properties.style;this.format=properties.format;}
isFormula(){return false;}
isLink(){return false;}
isEmpty(){return false;}
get formattedValue(){return formatValue(this.evaluated.value,this.format);}
get composerContent(){return this.content;}
get defaultAlign(){switch(this.evaluated.type){case CellValueType.number:return"right";case CellValueType.boolean:case CellValueType.error:return"center";case CellValueType.text:case CellValueType.empty:return"left";}}
get isAutoSummable(){var _a;switch(this.evaluated.type){case CellValueType.empty:case CellValueType.text:return true;case CellValueType.number:return!((_a=this.format)===null||_a===void 0?void 0:_a.match(DATETIME_FORMAT));case CellValueType.error:case CellValueType.boolean:return false;}}
withDisplayProperties(properties){return Object.create(this,{style:{value:properties.style,},format:{value:properties.format,},});}}
class EmptyCell extends AbstractCell{constructor(id,properties={}){super(id,{value:"",type:CellValueType.empty},properties);this.content="";}
isEmpty(){return true;}}
class NumberCell extends AbstractCell{constructor(id,value,properties={}){super(id,{value:value,type:CellValueType.number},properties);this.content=formatStandardNumber(this.evaluated.value);}}
class BooleanCell extends AbstractCell{constructor(id,value,properties={}){super(id,{value:value,type:CellValueType.boolean},properties);this.content=this.evaluated.value?"TRUE":"FALSE";}}
class TextCell extends AbstractCell{constructor(id,value,properties={}){super(id,{value:value,type:CellValueType.text},properties);this.content=this.evaluated.value;}}
class DateTimeCell extends NumberCell{constructor(id,value,properties){super(id,value,properties);this.format=properties.format;}
get composerContent(){return formatDateTime({value:this.evaluated.value,format:this.format});}}
class LinkCell extends AbstractCell{constructor(id,content,properties={}){var _a;const link=parseMarkdownLink(content);properties={...properties,style:{...properties.style,textColor:((_a=properties.style)===null||_a===void 0?void 0:_a.textColor)||LINK_COLOR,underline:true,},};super(id,{value:link.label,type:CellValueType.text},properties);this.link=link;this.content=content;}
isLink(){return true;}
get composerContent(){return this.link.label;}}
class WebLinkCell extends LinkCell{constructor(id,content,properties={}){super(id,content,properties);this.link.url=this.withHttp(this.link.url);this.link.isExternal=true;this.content=markdownLink(this.link.label,this.link.url);this.urlRepresentation=this.link.url;this.isUrlEditable=true;}
action(env){window.open(this.link.url,"_blank");}
withHttp(url){return!/^https?:\/\//i.test(url)?`https://${url}`:url;}}
class SheetLinkCell extends LinkCell{constructor(id,content,properties={},sheetName){super(id,content,properties);this.sheetName=sheetName;this.sheetId=parseSheetLink(this.link.url);this.isUrlEditable=false;}
action(env){env.dispatch("ACTIVATE_SHEET",{sheetIdFrom:env.getters.getActiveSheetId(),sheetIdTo:this.sheetId,});}
get urlRepresentation(){return this.sheetName(this.sheetId)||_lt("Invalid sheet");}}
class FormulaCell extends AbstractCell{constructor(buildFormulaString,id,normalizedText,compiledFormula,dependencies,properties){super(id,{value:LOADING,type:CellValueType.text},properties);this.buildFormulaString=buildFormulaString;this.normalizedText=normalizedText;this.compiledFormula=compiledFormula;this.dependencies=dependencies;}
get content(){return this.buildFormulaString(this.normalizedText,this.dependencies);}
isFormula(){return true;}
startEvaluation(){this.evaluated={value:LOADING,type:CellValueType.text};}
assignValue(value){switch(typeof value){case"number":this.evaluated={value,type:CellValueType.number,};break;case"boolean":this.evaluated={value,type:CellValueType.boolean,};break;case"string":this.evaluated={value,type:CellValueType.text,};break;case"object":this.evaluated={value,type:CellValueType.empty,};break;case"undefined":this.evaluated={value,type:CellValueType.empty,};break;}}
assignError(value,errorMessage){this.evaluated={value,error:errorMessage,type:CellValueType.error,};}}
class BadExpressionCell extends AbstractCell{constructor(id,content,error,properties){super(id,{value:"#BAD_EXPR",type:CellValueType.error,error},properties);this.content=content;}}
cellRegistry.add("Formula",{sequence:10,match:(content)=>content.startsWith("="),createCell:(id,content,properties,sheetId,getters)=>{const formula=normalize(content);const normalizedText=formula.text;const compiledFormula=compile(formula);const ranges=formula.dependencies.references.map((xc)=>getters.getRangeFromSheetXC(sheetId,xc));const format=properties.format||computeFormulaFormat(getters.getEvaluationSheets(),compiledFormula,ranges);return new FormulaCell((normalizedText,dependencies)=>getters.buildFormulaContent(sheetId,normalizedText,dependencies),id,normalizedText,compiledFormula,{...formula.dependencies,references:ranges},{...properties,format,});},}).add("Empty",{sequence:20,match:(content)=>content==="",createCell:(id,content,properties)=>new EmptyCell(id,properties),}).add("Number",{sequence:30,match:(content)=>isNumber(content),createCell:(id,content,properties)=>{if(!properties.format&&content.includes("%")){properties.format=content.includes(".")?"0.00%":"0%";}
return new NumberCell(id,parseNumber(content),properties);},}).add("Boolean",{sequence:40,match:(content)=>isBoolean(content),createCell:(id,content,properties)=>{return new BooleanCell(id,content.toUpperCase()==="TRUE"?true:false,properties);},}).add("DateTime",{sequence:50,match:(content)=>isDateTime(content),createCell:(id,content,properties)=>{const internalDate=parseDateTime(content);const format=properties.format||internalDate.format;return new DateTimeCell(id,internalDate.value,{...properties,format});},}).add("MarkdownSheetLink",{sequence:60,match:(content)=>isMarkdownSheetLink(content),createCell:(id,content,properties,sheetId,getters)=>{return new SheetLinkCell(id,content,properties,(sheetId)=>getters.tryGetSheetName(sheetId));},}).add("MarkdownLink",{sequence:70,match:(content)=>isMarkdownLink(content),createCell:(id,content,properties)=>{return new WebLinkCell(id,content,properties);},}).add("WebLink",{sequence:80,match:(content)=>isWebLink(content),createCell:(id,content,properties)=>{return new WebLinkCell(id,markdownLink(content,content),properties);},});function cellFactory(getters){const builders=cellRegistry.getAll().sort((a,b)=>a.sequence-b.sequence);return function createCell(id,content,properties,sheetId){const builder=builders.find((factory)=>factory.match(content));if(!builder){return new TextCell(id,content,properties);}
try{return builder.createCell(id,content,properties,sheetId,getters);}
catch(error){return new BadExpressionCell(id,content,error.message||DEFAULT_ERROR_MESSAGE,properties);}};}
class BasePlugin{constructor(stateObserver,dispatch,config){this.history=Object.assign(Object.create(stateObserver),{update:stateObserver.addChange.bind(stateObserver,this),selectCell:()=>{},});this.dispatch=dispatch;this.currentMode=config.mode;}
allowDispatch(command){return 0;}
beforeHandle(command){}
handle(command){}
finalize(){}
batchValidations(...validations){return(toValidate)=>validations.map((validation)=>validation.call(this,toValidate)).flat();}
chainValidations(...validations){return(toValidate)=>{for(const validation of validations){let results=validation.call(this,toValidate);if(!Array.isArray(results)){results=[results];}
const cancelledReasons=results.filter((result)=>result!==0);if(cancelledReasons.length){return cancelledReasons;}}
return 0;};}
checkValidations(command,...validations){return this.batchValidations(...validations)(command);}}
BasePlugin.getters=[];BasePlugin.modes=["headless","normal"];class CorePlugin extends BasePlugin{constructor(getters,stateObserver,range,dispatch,config,uuidGenerator){super(stateObserver,dispatch,config);this.dispatch=dispatch;this.range=range;range.addRangeProvider(this.adaptRanges.bind(this));this.getters=getters;this.uuidGenerator=uuidGenerator;}
import(data){}
export(data){}
exportForExcel(data){}
adaptRanges(applyChange,sheetId){}}
class BordersPlugin extends CorePlugin{constructor(){super(...arguments);this.borders={};}
handle(cmd){switch(cmd.type){case"ADD_MERGE":if(!cmd.interactive){for(const zone of cmd.target){this.addBordersToMerge(cmd.sheetId,zone);}}
break;case"DUPLICATE_SHEET":const borders=this.borders[cmd.sheetId];if(borders){const bordersCopy=borders.slice().map((col)=>col===null||col===void 0?void 0:col.slice().map((border)=>({...border})));this.history.update("borders",cmd.sheetIdTo,bordersCopy);}
break;case"DELETE_SHEET":const allBorders={...this.borders};delete allBorders[cmd.sheetId];this.history.update("borders",allBorders);break;case"SET_BORDER":this.setBorder(cmd.sheetId,cmd.col,cmd.row,cmd.border);break;case"SET_FORMATTING":if(cmd.border){const sheet=this.getters.getSheet(cmd.sheetId);const target=cmd.target.map((zone)=>this.getters.expandZone(cmd.sheetId,zone));this.setBorders(sheet,target,cmd.border);}
break;case"CLEAR_FORMATTING":this.clearBorders(cmd.sheetId,cmd.target);break;case"REMOVE_COLUMNS_ROWS":for(let el of cmd.elements){if(cmd.dimension==="COL"){this.shiftBordersHorizontally(cmd.sheetId,el+1,-1);}
else{this.shiftBordersVertically(cmd.sheetId,el+1,-1);}}
break;case"ADD_COLUMNS_ROWS":if(cmd.dimension==="COL"){this.handleAddColumns(cmd);}
else{this.handleAddRows(cmd);}
break;}}
handleAddColumns(cmd){const sheet=this.getters.getSheet(cmd.sheetId);let colLeftOfInsertion;let colRightOfInsertion;if(cmd.position==="before"){this.shiftBordersHorizontally(cmd.sheetId,cmd.base,cmd.quantity,{moveFirstLeftBorder:true,});colLeftOfInsertion=cmd.base-1;colRightOfInsertion=cmd.base+cmd.quantity;}
else{this.shiftBordersHorizontally(cmd.sheetId,cmd.base+1,cmd.quantity,{moveFirstLeftBorder:false,});colLeftOfInsertion=cmd.base;colRightOfInsertion=cmd.base+cmd.quantity+1;}
this.ensureColumnBorderContinuity(sheet,colLeftOfInsertion,colRightOfInsertion);}
handleAddRows(cmd){const sheet=this.getters.getSheet(cmd.sheetId);let rowAboveInsertion;let rowBelowInsertion;if(cmd.position==="before"){this.shiftBordersVertically(sheet.id,cmd.base,cmd.quantity,{moveFirstTopBorder:true});rowAboveInsertion=cmd.base-1;rowBelowInsertion=cmd.base+cmd.quantity;}
else{this.shiftBordersVertically(sheet.id,cmd.base+1,cmd.quantity,{moveFirstTopBorder:false,});rowAboveInsertion=cmd.base;rowBelowInsertion=cmd.base+cmd.quantity+1;}
this.ensureRowBorderContinuity(sheet,rowAboveInsertion,rowBelowInsertion);}
getCellBorder(sheetId,col,row){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m;const border={top:(_c=(_b=(_a=this.borders[sheetId])===null||_a===void 0?void 0:_a[col])===null||_b===void 0?void 0:_b[row])===null||_c===void 0?void 0:_c.horizontal,bottom:(_f=(_e=(_d=this.borders[sheetId])===null||_d===void 0?void 0:_d[col])===null||_e===void 0?void 0:_e[row+1])===null||_f===void 0?void 0:_f.horizontal,left:(_j=(_h=(_g=this.borders[sheetId])===null||_g===void 0?void 0:_g[col])===null||_h===void 0?void 0:_h[row])===null||_j===void 0?void 0:_j.vertical,right:(_m=(_l=(_k=this.borders[sheetId])===null||_k===void 0?void 0:_k[col+1])===null||_l===void 0?void 0:_l[row])===null||_m===void 0?void 0:_m.vertical,};if(!border.bottom&&!border.left&&!border.right&&!border.top){return null;}
return border;}
ensureColumnBorderContinuity(sheet,leftColumn,rightColumn){const targetCols=range(leftColumn+1,rightColumn);for(let row=0;row<sheet.rows.length;row++){const leftBorder=this.getCellBorder(sheet.id,leftColumn,row);const rightBorder=this.getCellBorder(sheet.id,rightColumn,row);if(leftBorder&&rightBorder){const commonSides=this.getCommonSides(leftBorder,rightBorder);for(let col of targetCols){this.addBorder(sheet.id,col,row,commonSides);}}}}
ensureRowBorderContinuity(sheet,topRow,bottomRow){const targetRows=range(topRow+1,bottomRow);for(let col=0;col<sheet.cols.length;col++){const aboveBorder=this.getCellBorder(sheet.id,col,topRow);const belowBorder=this.getCellBorder(sheet.id,col,bottomRow);if(aboveBorder&&belowBorder){const commonSides=this.getCommonSides(aboveBorder,belowBorder);for(let row of targetRows){this.addBorder(sheet.id,col,row,commonSides);}}}}
getCommonSides(border1,border2){const commonBorder={};for(let side of["top","bottom","left","right"]){if(border1[side]&&border1[side]===border2[side]){commonBorder[side]=border1[side];}}
return commonBorder;}
getColumnsWithBorders(sheetId){const sheetBorders=this.borders[sheetId];if(!sheetBorders)
return[];return Object.keys(sheetBorders).map((index)=>parseInt(index,10));}
getRowsRange(sheetId){const sheetBorders=this.borders[sheetId];if(!sheetBorders)
return[];const sheet=this.getters.getSheet(sheetId);return range(0,sheet.rows.length+1);}
shiftBordersHorizontally(sheetId,start,delta,{moveFirstLeftBorder}={}){const borders=this.borders[sheetId];if(!borders)
return;if(delta<0){this.moveBordersOfColumn(sheetId,start,delta,"vertical",{destructive:false,});}
this.getColumnsWithBorders(sheetId).filter((col)=>col>=start).sort((a,b)=>(delta<0?a-b:b-a)).forEach((col)=>{if((col===start&&moveFirstLeftBorder)||col!==start){this.moveBordersOfColumn(sheetId,col,delta,"vertical");}
this.moveBordersOfColumn(sheetId,col,delta,"horizontal");});}
shiftBordersVertically(sheetId,start,delta,{moveFirstTopBorder}={}){const borders=this.borders[sheetId];if(!borders)
return;if(delta<0){this.moveBordersOfRow(sheetId,start,delta,"horizontal",{destructive:false,});}
this.getRowsRange(sheetId).filter((row)=>row>=start).sort((a,b)=>(delta<0?a-b:b-a)).forEach((row)=>{if((row===start&&moveFirstTopBorder)||row!==start){this.moveBordersOfRow(sheetId,row,delta,"horizontal");}
this.moveBordersOfRow(sheetId,row,delta,"vertical");});}
moveBordersOfRow(sheetId,row,delta,borderDirection,{destructive}={destructive:true}){const borders=this.borders[sheetId];if(!borders)
return;this.getColumnsWithBorders(sheetId).forEach((col)=>{var _a,_b,_c,_d;const targetBorder=(_b=(_a=borders[col])===null||_a===void 0?void 0:_a[row+delta])===null||_b===void 0?void 0:_b[borderDirection];const movedBorder=(_d=(_c=borders[col])===null||_c===void 0?void 0:_c[row])===null||_d===void 0?void 0:_d[borderDirection];this.history.update("borders",sheetId,col,row+delta,borderDirection,destructive?movedBorder:movedBorder||targetBorder);this.history.update("borders",sheetId,col,row,borderDirection,undefined);});}
moveBordersOfColumn(sheetId,col,delta,borderDirection,{destructive}={destructive:true}){const borders=this.borders[sheetId];if(!borders)
return;this.getRowsRange(sheetId).forEach((row)=>{var _a,_b,_c,_d;const targetBorder=(_b=(_a=borders[col+delta])===null||_a===void 0?void 0:_a[row])===null||_b===void 0?void 0:_b[borderDirection];const movedBorder=(_d=(_c=borders[col])===null||_c===void 0?void 0:_c[row])===null||_d===void 0?void 0:_d[borderDirection];this.history.update("borders",sheetId,col+delta,row,borderDirection,destructive?movedBorder:movedBorder||targetBorder);this.history.update("borders",sheetId,col,row,borderDirection,undefined);});}
setBorder(sheetId,col,row,border){this.history.update("borders",sheetId,col,row,{vertical:border===null||border===void 0?void 0:border.left,horizontal:border===null||border===void 0?void 0:border.top,});this.history.update("borders",sheetId,col+1,row,"vertical",border===null||border===void 0?void 0:border.right);this.history.update("borders",sheetId,col,row+1,"horizontal",border===null||border===void 0?void 0:border.bottom);}
clearBorders(sheetId,zones){for(let zone of zones){for(let row=zone.top;row<=zone.bottom;row++){this.history.update("borders",sheetId,zone.right+1,row,"vertical",undefined);for(let col=zone.left;col<=zone.right;col++){this.history.update("borders",sheetId,col,row,undefined);}}
for(let col=zone.left;col<=zone.right;col++){this.history.update("borders",sheetId,col,zone.bottom+1,"horizontal",undefined);}}}
addBorder(sheetId,col,row,border){this.setBorder(sheetId,col,row,{...this.getCellBorder(sheetId,col,row),...border,});}
setBorders(sheet,zones,command){const sheetId=sheet.id;if(command==="clear"){return this.clearBorders(sheetId,zones);}
for(let zone of zones){if(command==="h"||command==="hv"||command==="all"){for(let row=zone.top+1;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){this.addBorder(sheetId,col,row,{top:DEFAULT_BORDER_DESC});}}}
if(command==="v"||command==="hv"||command==="all"){for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left+1;col<=zone.right;col++){this.addBorder(sheetId,col,row,{left:DEFAULT_BORDER_DESC});}}}
if(command==="left"||command==="all"||command==="external"){for(let row=zone.top;row<=zone.bottom;row++){this.addBorder(sheetId,zone.left,row,{left:DEFAULT_BORDER_DESC});}}
if(command==="right"||command==="all"||command==="external"){for(let row=zone.top;row<=zone.bottom;row++){this.addBorder(sheetId,zone.right+1,row,{left:DEFAULT_BORDER_DESC});}}
if(command==="top"||command==="all"||command==="external"){for(let col=zone.left;col<=zone.right;col++){this.addBorder(sheetId,col,zone.top,{top:DEFAULT_BORDER_DESC});}}
if(command==="bottom"||command==="all"||command==="external"){for(let col=zone.left;col<=zone.right;col++){this.addBorder(sheetId,col,zone.bottom+1,{top:DEFAULT_BORDER_DESC});}}}}
addBordersToMerge(sheetId,zone){const sheet=this.getters.getSheet(sheetId);const{left,right,top,bottom}=zone;const bordersTopLeft=this.getCellBorder(sheet.id,left,top);const bordersBottomRight=this.getCellBorder(sheet.id,right,bottom);this.clearBorders(sheetId,[zone]);if(bordersTopLeft===null||bordersTopLeft===void 0?void 0:bordersTopLeft.top){this.setBorders(sheet,[{...zone,bottom:top}],"top");}
if(bordersTopLeft===null||bordersTopLeft===void 0?void 0:bordersTopLeft.left){this.setBorders(sheet,[{...zone,right:left}],"left");}
if((bordersBottomRight===null||bordersBottomRight===void 0?void 0:bordersBottomRight.bottom)||(bordersTopLeft===null||bordersTopLeft===void 0?void 0:bordersTopLeft.bottom)){this.setBorders(sheet,[{...zone,top:bottom}],"bottom");}
if((bordersBottomRight===null||bordersBottomRight===void 0?void 0:bordersBottomRight.right)||(bordersTopLeft===null||bordersTopLeft===void 0?void 0:bordersTopLeft.right)){this.setBorders(sheet,[{...zone,left:right}],"right");}}
import(data){if(data.borders){for(let sheet of data.sheets){for(let[xc,cell]of Object.entries(sheet.cells)){if(cell===null||cell===void 0?void 0:cell.border){const border=data.borders[cell.border];const[col,row]=toCartesian(xc);this.setBorder(sheet.id,col,row,border);}}}}
for(let sheetData of data.sheets){if(sheetData.merges){for(let merge of sheetData.merges){this.addBordersToMerge(sheetData.id,toZone(merge));}}}}
export(data){let borderId=0;const borders={};function getBorderId(border){for(let[key,value]of Object.entries(borders)){if(stringify(value)===stringify(border)){return parseInt(key,10);}}
borders[++borderId]=border;return borderId;}
for(let sheet of data.sheets){for(let col=0;col<sheet.colNumber;col++){for(let row=0;row<sheet.rowNumber;row++){const border=this.getCellBorder(sheet.id,col,row);if(border){const xc=toXC(col,row);const cell=sheet.cells[xc];const borderId=getBorderId(border);if(cell){cell.border=borderId;}
else{sheet.cells[xc]={border:borderId};}}}}}
data.borders=borders;}
exportForExcel(data){this.export(data);}}
BordersPlugin.getters=["getCellBorder"];const nbspRegexp=new RegExp(String.fromCharCode(160),"g");class CellPlugin extends CorePlugin{constructor(){super(...arguments);this.cells={};this.createCell=cellFactory(this.getters);}
adaptRanges(applyChange,sheetId){for(const sheet of Object.keys(this.cells)){for(const cell of Object.values(this.cells[sheet]||{})){if(cell.isFormula()){for(const range of cell.dependencies.references){if(!sheetId||range.sheetId===sheetId){const change=applyChange(range);if(change.changeType!=="NONE"){this.history.update("cells",sheet,cell.id,"dependencies","references",cell.dependencies.references.indexOf(range),change.range);}}}}}}}
allowDispatch(cmd){switch(cmd.type){case"UPDATE_CELL":return this.checkCellOutOfSheet(cmd.sheetId,cmd.col,cmd.row);default:return 0;}}
handle(cmd){switch(cmd.type){case"SET_FORMATTING":if("style"in cmd){this.setStyle(cmd.sheetId,cmd.target,cmd.style);}
if("format"in cmd&&cmd.format!==undefined){this.setFormatter(cmd.sheetId,cmd.target,cmd.format);}
break;case"SET_DECIMAL":this.setDecimal(cmd.sheetId,cmd.target,cmd.step);break;case"CLEAR_FORMATTING":this.clearStyles(cmd.sheetId,cmd.target);break;case"ADD_COLUMNS_ROWS":if(cmd.dimension==="COL"){this.handleAddColumnsRows(cmd,this.copyColumnStyle.bind(this));}
else{this.handleAddColumnsRows(cmd,this.copyRowStyle.bind(this));}
break;case"UPDATE_CELL":this.updateCell(this.getters.getSheet(cmd.sheetId),cmd.col,cmd.row,cmd);break;case"CLEAR_CELL":this.dispatch("UPDATE_CELL",{sheetId:cmd.sheetId,col:cmd.col,row:cmd.row,content:"",style:null,format:"",});break;}}
setFormatter(sheetId,zones,format){for(let zone of zones){for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){this.dispatch("UPDATE_CELL",{sheetId,col,row,format,});}}}}
setDecimal(sheetId,zones,step){const numberFormat=this.searchNumberFormat(sheetId,zones);if(numberFormat!==undefined){const newFormat=this.changeDecimalFormat(numberFormat,step);this.setFormatter(sheetId,zones,newFormat);}}
searchNumberFormat(sheetId,zones){var _a;for(let zone of zones){for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){const cell=this.getters.getCell(sheetId,col,row);if((cell===null||cell===void 0?void 0:cell.evaluated.type)===CellValueType.number&&!((_a=cell.format)===null||_a===void 0?void 0:_a.match(DATETIME_FORMAT))){return cell.format||this.setDefaultNumberFormat(cell.evaluated.value);}}}}
return undefined;}
setDefaultNumberFormat(cellValue){const strValue=cellValue.toString();const parts=strValue.split(".");if(parts.length===1){return"0";}
return"0."+Array(parts[1].length+1).join("0");}
changeDecimalFormat(format,step){const sign=Math.sign(step);const subFormats=format.split(";");let newSubFormats=[];for(let subFormat of subFormats){const decimalPointPosition=subFormat.indexOf(".");const exponentPosition=subFormat.toUpperCase().indexOf("E");let newSubFormat;const subPart=exponentPosition>-1?subFormat.slice(0,exponentPosition):subFormat;const zerosAfterDecimal=decimalPointPosition>-1?subPart.slice(decimalPointPosition).match(/0/g).length:0;const lastZeroPosition=subPart.lastIndexOf("0");if(lastZeroPosition>-1){if(sign>0){if(zerosAfterDecimal<maximumDecimalPlaces){newSubFormat=subFormat.slice(0,lastZeroPosition+1)+
(zerosAfterDecimal===0?".0":"0")+
subFormat.slice(lastZeroPosition+1);}
else{newSubFormat=subFormat;}}
else{if(zerosAfterDecimal>0){newSubFormat=subFormat.slice(0,lastZeroPosition)+subFormat.slice(lastZeroPosition+1);if(zerosAfterDecimal===1){newSubFormat=newSubFormat.slice(0,decimalPointPosition)+
newSubFormat.slice(decimalPointPosition+1);}}
else{newSubFormat=subFormat;}}}
else{newSubFormat=subFormat;}
newSubFormats.push(newSubFormat);}
return newSubFormats.join(";");}
clearStyles(sheetId,zones){for(let zone of zones){for(let col=zone.left;col<=zone.right;col++){for(let row=zone.top;row<=zone.bottom;row++){this.dispatch("UPDATE_CELL",{sheetId,col,row,style:null,});}}}}
handleAddColumnsRows(cmd,fn){const sheet=this.getters.getSheet(cmd.sheetId);let insertedElements;let styleReference;if(cmd.position==="before"){insertedElements=range(cmd.base,cmd.base+cmd.quantity);styleReference=cmd.base+cmd.quantity;}
else{insertedElements=range(cmd.base+1,cmd.base+cmd.quantity+1);styleReference=cmd.base;}
fn(sheet,styleReference,insertedElements);}
import(data){for(let sheet of data.sheets){const imported_sheet=this.getters.getSheet(sheet.id);for(let xc in sheet.cells){const cellData=sheet.cells[xc];const[col,row]=toCartesian(xc);if((cellData===null||cellData===void 0?void 0:cellData.content)||(cellData===null||cellData===void 0?void 0:cellData.format)||(cellData===null||cellData===void 0?void 0:cellData.style)){const cell=this.importCell(imported_sheet,cellData,data.styles);this.history.update("cells",sheet.id,cell.id,cell);this.dispatch("UPDATE_CELL_POSITION",{cell,cellId:cell.id,col,row,sheetId:sheet.id,});}}}}
export(data){let styleId=0;const styles={};function getStyleId(style){for(let[key,value]of Object.entries(styles)){if(stringify(value)===stringify(style)){return parseInt(key,10);}}
styles[++styleId]=style;return styleId;}
for(let _sheet of data.sheets){const cells={};const positions=Object.keys(this.cells[_sheet.id]||{}).map((cellId)=>this.getters.getCellPosition(cellId)).sort((a,b)=>(a.col===b.col?a.row-b.row:a.col-b.col));for(const{col,row}of positions){const cell=this.getters.getCell(_sheet.id,col,row);const xc=toXC(col,row);cells[xc]={style:cell.style&&getStyleId(cell.style),format:cell.format,content:cell.content,};}
_sheet.cells=cells;}
data.styles=styles;}
importCell(sheet,cellData,normalizedStyles){const style=(cellData.style&&normalizedStyles[cellData.style])||undefined;const cellId=this.uuidGenerator.uuidv4();const properties={format:cellData===null||cellData===void 0?void 0:cellData.format,style};return this.createCell(cellId,(cellData===null||cellData===void 0?void 0:cellData.content)||"",properties,sheet.id);}
exportForExcel(data){this.export(data);for(let sheet of data.sheets){for(const xc in sheet.cells){const[col,row]=toCartesian(xc);const cell=this.getters.getCell(sheet.id,col,row);const exportedCellData=sheet.cells[xc];exportedCellData.value=cell.evaluated.value;exportedCellData.isFormula=cell.isFormula();}}}
getCells(sheetId){return this.cells[sheetId]||{};}
getCellById(cellId){for(const sheet of Object.values(this.cells)){if(sheet[cellId]){return sheet[cellId];}}
return undefined;}
buildFormulaContent(sheetId,formula,dependencies){let newContent=formula;for(let[index,range]of Object.entries(dependencies.references)){const xc=this.getters.getRangeString(range,sheetId);const stringPosition=`\\${FORMULA_REF_IDENTIFIER}${index}\\${FORMULA_REF_IDENTIFIER}`;newContent=newContent.replace(new RegExp(stringPosition,"g"),xc);}
for(let[index,d]of Object.entries(dependencies.strings)){const stringPosition=`\\${FORMULA_REF_IDENTIFIER}S${index}\\${FORMULA_REF_IDENTIFIER}`;newContent=newContent.replace(new RegExp(stringPosition,"g"),`"${d}"`);}
for(let[index,d]of Object.entries(dependencies.numbers)){const stringPosition=`\\${FORMULA_REF_IDENTIFIER}N${index}\\${FORMULA_REF_IDENTIFIER}`;newContent=newContent.replace(new RegExp(stringPosition,"g"),d.toString());}
return newContent;}
getFormulaCellContent(sheetId,cell){return this.buildFormulaContent(sheetId,cell.normalizedText,cell.dependencies);}
getCellStyle(cell){return cell.style||{};}
zoneToXC(sheetId,zone,fixedParts=[{colFixed:false,rowFixed:false}]){zone=this.getters.expandZone(sheetId,zone);const topLeft=toXC(zone.left,zone.top,fixedParts[0]);const botRight=toXC(zone.right,zone.bottom,fixedParts.length>1?fixedParts[1]:fixedParts[0]);const cellTopLeft=this.getters.getMainCell(sheetId,zone.left,zone.top);const cellBotRight=this.getters.getMainCell(sheetId,zone.right,zone.bottom);const sameCell=cellTopLeft[0]==cellBotRight[0]&&cellTopLeft[1]==cellBotRight[1];if(topLeft!=botRight&&!sameCell){return topLeft+":"+botRight;}
return topLeft;}
setStyle(sheetId,target,style){for(let zone of target){for(let col=zone.left;col<=zone.right;col++){for(let row=zone.top;row<=zone.bottom;row++){const cell=this.getters.getCell(sheetId,col,row);this.dispatch("UPDATE_CELL",{sheetId,col,row,style:style?{...cell===null||cell===void 0?void 0:cell.style,...style}:undefined,});}}}}
copyColumnStyle(sheet,refColumn,targetCols){for(let row=0;row<sheet.rows.length;row++){const format=this.getFormat(sheet.id,refColumn,row);if(format.style||format.format){for(let col of targetCols){this.dispatch("UPDATE_CELL",{sheetId:sheet.id,col,row,...format});}}}}
copyRowStyle(sheet,refRow,targetRows){for(let col=0;col<sheet.cols.length;col++){const format=this.getFormat(sheet.id,col,refRow);if(format.style||format.format){for(let row of targetRows){this.dispatch("UPDATE_CELL",{sheetId:sheet.id,col,row,...format});}}}}
getFormat(sheetId,col,row){const format={};const[mainCol,mainRow]=this.getters.getMainCell(sheetId,col,row);const cell=this.getters.getCell(sheetId,mainCol,mainRow);if(cell){if(cell.style){format["style"]=cell.style;}
if(cell.format){format["format"]=cell.format;}}
return format;}
updateCell(sheet,col,row,after){const before=sheet.rows[row].cells[col];const hasContent="content"in after||"formula"in after;const afterContent=after.content?after.content.replace(nbspRegexp,""):"";let style;if(after.style!==undefined){style=after.style||undefined;}
else{style=before?before.style:undefined;}
let format=("format"in after?after.format:before&&before.format)||NULL_FORMAT;if(((hasContent&&!afterContent&&!after.formula)||(!hasContent&&(!before||before.isEmpty())))&&!style&&!format){if(before){this.history.update("cells",sheet.id,before.id,undefined);this.dispatch("UPDATE_CELL_POSITION",{cellId:before.id,col,row,sheetId:sheet.id,cell:undefined,});}
return;}
const cellId=(before===null||before===void 0?void 0:before.id)||this.uuidGenerator.uuidv4();const didContentChange=hasContent;let cell;const properties={format,style};if(before&&!didContentChange){cell=before.withDisplayProperties(properties);}
else{cell=this.createCell(cellId,afterContent,properties,sheet.id);}
this.history.update("cells",sheet.id,cell.id,cell);this.dispatch("UPDATE_CELL_POSITION",{cell,cellId:cell.id,col,row,sheetId:sheet.id});}
checkCellOutOfSheet(sheetId,col,row){const sheet=this.getters.tryGetSheet(sheetId);if(!sheet)
return 21;const sheetZone={top:0,left:0,bottom:sheet.rows.length-1,right:sheet.cols.length-1,};return isInside(col,row,sheetZone)?0:16;}}
CellPlugin.getters=["zoneToXC","getCells","getFormulaCellContent","getCellStyle","buildFormulaContent","getCellById",];class ChartPlugin extends CorePlugin{constructor(){super(...arguments);this.chartFigures={};this.nextId=1;}
adaptRanges(applyChange){for(let[chartId,chart]of Object.entries(this.chartFigures)){if(chart){this.adaptDataSetRanges(chart,chartId,applyChange);this.adaptLabelRanges(chart,chartId,applyChange);}}}
adaptDataSetRanges(chart,chartId,applyChange){for(let ds of chart.dataSets){if(ds.labelCell){const labelCellChange=applyChange(ds.labelCell);switch(labelCellChange.changeType){case"REMOVE":this.history.update("chartFigures",chartId,"dataSets",chart.dataSets.indexOf(ds),"labelCell",undefined);break;case"RESIZE":case"MOVE":case"CHANGE":this.history.update("chartFigures",chartId,"dataSets",chart.dataSets.indexOf(ds),"labelCell",labelCellChange.range);}}
const dataRangeChange=applyChange(ds.dataRange);switch(dataRangeChange.changeType){case"REMOVE":const newDataSets=chart.dataSets.filter((dataset)=>dataset!==ds);this.history.update("chartFigures",chartId,"dataSets",newDataSets);break;case"RESIZE":case"MOVE":case"CHANGE":if(this.getters.getRangeString(dataRangeChange.range,dataRangeChange.range.sheetId)!==INCORRECT_RANGE_STRING){this.history.update("chartFigures",chartId,"dataSets",chart.dataSets.indexOf(ds),"dataRange",dataRangeChange.range);}
else{const newDataSets=chart.dataSets.filter((dataset)=>dataset!==ds);this.history.update("chartFigures",chartId,"dataSets",newDataSets);}
break;}}}
adaptLabelRanges(chart,chartId,applyChange){if(chart.labelRange){const labelRangeChange=applyChange(chart.labelRange);switch(labelRangeChange.changeType){case"REMOVE":this.history.update("chartFigures",chartId,"labelRange",undefined);break;case"RESIZE":case"MOVE":case"CHANGE":this.history.update("chartFigures",chartId,"labelRange",labelRangeChange.range);break;}}}
allowDispatch(cmd){const success=0;switch(cmd.type){case"UPDATE_CHART":case"CREATE_CHART":return this.checkValidations(cmd,this.chainValidations(this.checkEmptyDataset,this.checkDataset),this.checkLabelRange);default:return success;}}
handle(cmd){var _a,_b;switch(cmd.type){case"CREATE_CHART":const x=cmd.position?cmd.position.x:0;const y=cmd.position?cmd.position.y:0;this.addChartFigure(cmd.sheetId,this.createChartDefinition(cmd.definition,cmd.sheetId),{id:cmd.id,x,y,height:335,width:536,tag:"chart",});break;case"UPDATE_CHART":{this.updateChartDefinition(cmd.id,cmd.definition);break;}
case"DUPLICATE_SHEET":{const sheetFiguresFrom=this.getters.getFigures(cmd.sheetId);for(const fig of sheetFiguresFrom){if(fig.tag==="chart"){const id=this.nextId.toString();this.history.update("nextId",this.nextId+1);const chartDefinition={...deepCopy(this.chartFigures[fig.id]),id};chartDefinition.sheetId=cmd.sheetIdTo;chartDefinition.dataSets.forEach((dataset)=>{var _a;if(dataset.dataRange.sheetId===cmd.sheetId){dataset.dataRange.sheetId=cmd.sheetIdTo;}
if(((_a=dataset.labelCell)===null||_a===void 0?void 0:_a.sheetId)===cmd.sheetId){dataset.labelCell.sheetId=cmd.sheetIdTo;}});if(((_a=chartDefinition.labelRange)===null||_a===void 0?void 0:_a.sheetId)===cmd.sheetId){chartDefinition.labelRange.sheetId=cmd.sheetIdTo;}
const figure={id:id,x:fig.x,y:fig.y,height:fig.height,width:fig.width,tag:"chart",};this.addChartFigure(cmd.sheetIdTo,chartDefinition,figure);}}
break;}
case"DELETE_FIGURE":this.history.update("chartFigures",cmd.id,undefined);break;case"DELETE_SHEET":for(let id of Object.keys(this.chartFigures)){if(((_b=this.chartFigures[id])===null||_b===void 0?void 0:_b.sheetId)===cmd.sheetId){this.history.update("chartFigures",id,undefined);}}
break;}}
getChartDefinition(figureId){return this.chartFigures[figureId];}
getChartsIdBySheet(sheetId){return Object.entries(this.chartFigures).filter((chart)=>{return chart[1].sheetId===sheetId;}).map((chart)=>chart[0]);}
getChartDefinitionUI(sheetId,figureId){const data=this.chartFigures[figureId];const dataSets=data.dataSets.map((ds)=>(ds?this.getters.getRangeString(ds.dataRange,sheetId):"")).filter((ds)=>{return ds!=="";});return{title:data&&data.title?data.title:"",dataSets,labelRange:data.labelRange?this.getters.getRangeString(data.labelRange,sheetId):undefined,type:data?data.type:"bar",dataSetsHaveTitle:data&&dataSets.length!==0?Boolean(data.dataSets[0].labelCell):false,background:data.background,verticalAxisPosition:data.verticalAxisPosition,legendPosition:data.legendPosition,stackedBar:data.stackedBar,};}
getChartDefinitionExcel(sheetId,figureId){const data=this.chartFigures[figureId];const dataSets=data.dataSets.map((ds)=>this.toExcelDataset(ds)).filter((ds)=>ds.range!=="");return{...this.getChartDefinitionUI("forceSheetReference",figureId),backgroundColor:data.background,dataSets,};}
toExcelDataset(ds){var _a;const labelZone=(_a=ds.labelCell)===null||_a===void 0?void 0:_a.zone;let dataZone=ds.dataRange.zone;if(labelZone){const{height,width}=zoneToDimension(dataZone);if(height===1){dataZone={...dataZone,left:dataZone.left+1};}
else if(width===1){dataZone={...dataZone,top:dataZone.top+1};}}
const dataRange={...ds.dataRange,zone:dataZone,};return{label:ds.labelCell?this.getters.getRangeString(ds.labelCell,"forceSheetReference"):undefined,range:this.getters.getRangeString(dataRange,"forceSheetReference"),};}
import(data){for(let sheet of data.sheets){if(sheet.figures){for(let figure of sheet.figures){if(figure.tag==="chart"){const figureData={...figure.data,};this.chartFigures[figure.id]=this.createChartDefinition(figureData,sheet.id);delete figure.data;}}}}}
export(data){if(data.sheets){for(let sheet of data.sheets){const sheetFigures=this.getters.getFigures(sheet.id);const figures=sheetFigures;for(let figure of figures){if(figure&&figure.tag==="chart"){figure.data=this.getChartDefinitionUI(sheet.id,figure.id);}}
sheet.figures=figures;}}}
exportForExcel(data){for(let sheet of data.sheets){const sheetFigures=this.getters.getFigures(sheet.id);const figures=sheetFigures;for(let figure of figures){if(figure&&figure.tag==="chart"){figure.data=this.getChartDefinitionExcel(sheet.id,figure.id);}}
sheet.charts=figures;}}
createChartDefinition(definition,sheetId){return{...definition,dataSets:this.createDataSets(definition.dataSets,sheetId,definition.dataSetsHaveTitle),labelRange:definition.labelRange?this.getters.getRangeFromSheetXC(sheetId,definition.labelRange):undefined,sheetId,};}
updateChartDefinition(id,definition){const chart=this.chartFigures[id];if(!chart){return;}
if(definition.title!==undefined){this.history.update("chartFigures",id,"title",definition.title);}
if(definition.type){this.history.update("chartFigures",id,"type",definition.type);}
if(definition.dataSets){const dataSetsHaveTitle=!!definition.dataSetsHaveTitle;const dataSets=this.createDataSets(definition.dataSets,chart.sheetId,dataSetsHaveTitle);this.history.update("chartFigures",id,"dataSets",dataSets);}
if(definition.labelRange!==undefined){const labelRange=definition.labelRange?this.getters.getRangeFromSheetXC(chart.sheetId,definition.labelRange):undefined;this.history.update("chartFigures",id,"labelRange",labelRange);}
if(definition.background){this.history.update("chartFigures",id,"background",definition.background);}
if(definition.verticalAxisPosition){this.history.update("chartFigures",id,"verticalAxisPosition",definition.verticalAxisPosition);}
if(definition.legendPosition){this.history.update("chartFigures",id,"legendPosition",definition.legendPosition);}
if(definition.stackedBar!==undefined){this.history.update("chartFigures",id,"stackedBar",definition.stackedBar);}}
createDataSets(dataSetsString,sheetId,dataSetsHaveTitle){const dataSets=[];for(const sheetXC of dataSetsString){const dataRange=this.getters.getRangeFromSheetXC(sheetId,sheetXC);const{zone,sheetId:dataSetSheetId,invalidSheetName}=dataRange;if(invalidSheetName){continue;}
if(zone.left!==zone.right&&zone.top!==zone.bottom){for(let column=zone.left;column<=zone.right;column++){const columnZone={left:column,right:column,top:zone.top,bottom:zone.bottom,};dataSets.push(this.createDataSet(dataSetSheetId,columnZone,dataSetsHaveTitle?{top:columnZone.top,bottom:columnZone.top,left:columnZone.left,right:columnZone.left,}:undefined));}}
else if(zone.left===zone.right&&zone.top===zone.bottom){if(!dataSetsHaveTitle){dataSets.push(this.createDataSet(dataSetSheetId,zone,undefined));}}
else{dataSets.push(this.createDataSet(dataSetSheetId,zone,dataSetsHaveTitle?{top:zone.top,bottom:zone.top,left:zone.left,right:zone.left,}:undefined));}}
return dataSets;}
addChartFigure(sheetId,data,figure){this.dispatch("CREATE_FIGURE",{sheetId,figure,});this.history.update("chartFigures",figure.id,data);}
createDataSet(sheetId,fullZone,titleZone){if(fullZone.left!==fullZone.right&&fullZone.top!==fullZone.bottom){throw new Error(`Zone should be a single column or row: ${zoneToXc(fullZone)}`);}
if(titleZone){const dataXC=zoneToXc(fullZone);const labelCellXC=zoneToXc(titleZone);return{labelCell:this.getters.getRangeFromSheetXC(sheetId,labelCellXC),dataRange:this.getters.getRangeFromSheetXC(sheetId,dataXC),};}
else{return{labelCell:undefined,dataRange:this.getters.getRangeFromSheetXC(sheetId,zoneToXc(fullZone)),};}}
checkEmptyDataset(cmd){return cmd.definition.dataSets&&cmd.definition.dataSets.length===0?25:0;}
checkDataset(cmd){if(!cmd.definition.dataSets){return 0;}
const invalidRanges=cmd.definition.dataSets.find((range)=>!rangeReference.test(range))!==undefined;return invalidRanges?26:0;}
checkLabelRange(cmd){if(!cmd.definition.labelRange){return 0;}
const invalidLabels=!rangeReference.test(cmd.definition.labelRange||"");return invalidLabels?27:0;}}
ChartPlugin.getters=["getChartDefinition","getChartDefinitionUI","getChartsIdBySheet"];function stringToNumber(value){return value===""?NaN:Number(value);}
class ConditionalFormatPlugin extends CorePlugin{constructor(){super(...arguments);this.cfRules={};}
loopThroughRangesOfSheet(sheetId,applyChange){for(const rule of this.cfRules[sheetId]){for(const range of rule.ranges){const change=applyChange(range);switch(change.changeType){case"REMOVE":let copy=rule.ranges.slice();copy.splice(rule.ranges.indexOf(range),1);if(copy.length>=1){this.history.update("cfRules",sheetId,this.cfRules[sheetId].indexOf(rule),"ranges",copy);}
else{this.removeConditionalFormatting(rule.id,sheetId);}
break;case"RESIZE":case"MOVE":case"CHANGE":this.history.update("cfRules",sheetId,this.cfRules[sheetId].indexOf(rule),"ranges",rule.ranges.indexOf(range),change.range);break;}}}}
adaptRanges(applyChange,sheetId){if(sheetId){this.loopThroughRangesOfSheet(sheetId,applyChange);}
else{for(const sheetId of Object.keys(this.cfRules)){this.loopThroughRangesOfSheet(sheetId,applyChange);}}}
allowDispatch(cmd){if(cmd.type==="ADD_CONDITIONAL_FORMAT"){return this.checkValidations(cmd,this.checkCFRule,this.checkEmptyRange);}
return 0;}
handle(cmd){switch(cmd.type){case"CREATE_SHEET":this.cfRules[cmd.sheetId]=[];break;case"DUPLICATE_SHEET":this.history.update("cfRules",cmd.sheetIdTo,[]);for(const cf of this.getConditionalFormats(cmd.sheetId)){this.addConditionalFormatting(cf,cmd.sheetIdTo);}
break;case"DELETE_SHEET":const cfRules=Object.assign({},this.cfRules);delete cfRules[cmd.sheetId];this.history.update("cfRules",cfRules);break;case"ADD_CONDITIONAL_FORMAT":const cf={...cmd.cf,ranges:cmd.target.map(zoneToXc),};this.addConditionalFormatting(cf,cmd.sheetId);break;case"REMOVE_CONDITIONAL_FORMAT":this.removeConditionalFormatting(cmd.id,cmd.sheetId);break;}}
import(data){for(let sheet of data.sheets){this.cfRules[sheet.id]=sheet.conditionalFormats.map((rule)=>this.mapToConditionalFormatInternal(sheet.id,rule));}}
export(data){if(data.sheets){for(let sheet of data.sheets){if(this.cfRules[sheet.id]){sheet.conditionalFormats=this.cfRules[sheet.id].map((rule)=>this.mapToConditionalFormat(sheet.id,rule));}}}}
exportForExcel(data){this.export(data);}
getConditionalFormats(sheetId){return this.cfRules[sheetId].map((cf)=>this.mapToConditionalFormat(sheetId,cf))||[];}
getRulesSelection(sheetId,selection){const ruleIds=new Set();selection.forEach((zone)=>{const zoneRuleId=this.getRulesByZone(sheetId,zone);zoneRuleId.forEach((ruleId)=>{ruleIds.add(ruleId);});});return Array.from(ruleIds);}
getRulesByZone(sheetId,zone){const ruleIds=new Set();for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){const cellRules=this.getRulesByCell(sheetId,col,row);cellRules.forEach((rule)=>{ruleIds.add(rule.id);});}}
return ruleIds;}
getRulesByCell(sheetId,cellCol,cellRow){const rules=[];for(let cf of this.cfRules[sheetId]){for(let range of cf.ranges){if(isInside(cellCol,cellRow,range.zone)){rules.push(cf);}}}
return new Set(rules.map((rule)=>{return this.mapToConditionalFormat(sheetId,rule);}));}
mapToConditionalFormat(sheetId,cf){return{...cf,ranges:cf.ranges.map((range)=>{return this.getters.getRangeString(range,sheetId);}),};}
mapToConditionalFormatInternal(sheet,cf){const conditionalFormat={...cf,ranges:cf.ranges.map((range)=>{return this.getters.getRangeFromSheetXC(sheet,range);}),};return conditionalFormat;}
addConditionalFormatting(cf,sheet){const currentCF=this.cfRules[sheet].slice();const replaceIndex=currentCF.findIndex((c)=>c.id===cf.id);const newCF=this.mapToConditionalFormatInternal(sheet,cf);if(replaceIndex>-1){currentCF.splice(replaceIndex,1,newCF);}
else{currentCF.push(newCF);}
this.history.update("cfRules",sheet,currentCF);}
checkEmptyRange(cmd){return cmd.target.length?0:19;}
checkCFRule(cmd){const rule=cmd.cf.rule;switch(rule.type){case"CellIsRule":return this.checkValidations(rule,this.checkOperatorArgsNumber(2,["Between","NotBetween"]),this.checkOperatorArgsNumber(1,["BeginsWith","ContainsText","EndsWith","GreaterThan","GreaterThanOrEqual","LessThan","LessThanOrEqual","NotContains",]),this.checkOperatorArgsNumber(0,["IsEmpty","IsNotEmpty"]));case"ColorScaleRule":{return this.checkValidations(rule,this.chainValidations(this.checkThresholds(this.checkFormulaCompilation)),this.chainValidations(this.checkThresholds(this.checkNaN),this.batchValidations(this.checkMinBiggerThanMax,this.checkMinBiggerThanMid,this.checkMidBiggerThanMax)));}
case"IconSetRule":{return this.checkValidations(rule,this.chainValidations(this.checkInflectionPoints(this.checkNaN),this.checkLowerBiggerThanUpper),this.chainValidations(this.checkInflectionPoints(this.checkFormulaCompilation)));}}
return 0;}
checkOperatorArgsNumber(expectedNumber,operators){if(expectedNumber>2){throw new Error("Checking more than 2 arguments is currently not supported. Add the appropriate CommandResult if you want to.");}
return(rule)=>{if(operators.includes(rule.operator)){const errors=[];const isEmpty=(value)=>value===undefined||value==="";if(expectedNumber>=1&&isEmpty(rule.values[0])){errors.push(34);}
if(expectedNumber>=2&&isEmpty(rule.values[1])){errors.push(35);}
return errors.length?errors:0;}
return 0;};}
checkNaN(threshold,thresholdName){if(["number","percentage","percentile"].includes(threshold.type)&&(threshold.value===""||isNaN(threshold.value))){switch(thresholdName){case"min":return 36;case"max":return 38;case"mid":return 37;case"upperInflectionPoint":return 39;case"lowerInflectionPoint":return 40;}}
return 0;}
checkFormulaCompilation(threshold,thresholdName){if(threshold.type!=="formula")
return 0;try{compile(normalize(threshold.value||""));}
catch(error){switch(thresholdName){case"min":return 41;case"max":return 43;case"mid":return 42;case"upperInflectionPoint":return 44;case"lowerInflectionPoint":return 45;}}
return 0;}
checkThresholds(check){return this.batchValidations((rule)=>check(rule.minimum,"min"),(rule)=>check(rule.maximum,"max"),(rule)=>(rule.midpoint?check(rule.midpoint,"mid"):0));}
checkInflectionPoints(check){return this.batchValidations((rule)=>check(rule.lowerInflectionPoint,"lowerInflectionPoint"),(rule)=>check(rule.upperInflectionPoint,"upperInflectionPoint"));}
checkLowerBiggerThanUpper(rule){const minValue=rule.lowerInflectionPoint.value;const maxValue=rule.upperInflectionPoint.value;if(["number","percentage","percentile"].includes(rule.lowerInflectionPoint.type)&&rule.lowerInflectionPoint.type===rule.upperInflectionPoint.type&&Number(minValue)>Number(maxValue)){return 31;}
return 0;}
checkMinBiggerThanMax(rule){const minValue=rule.minimum.value;const maxValue=rule.maximum.value;if(["number","percentage","percentile"].includes(rule.minimum.type)&&rule.minimum.type===rule.maximum.type&&stringToNumber(minValue)>=stringToNumber(maxValue)){return 30;}
return 0;}
checkMidBiggerThanMax(rule){var _a;const midValue=(_a=rule.midpoint)===null||_a===void 0?void 0:_a.value;const maxValue=rule.maximum.value;if(rule.midpoint&&["number","percentage","percentile"].includes(rule.midpoint.type)&&rule.midpoint.type===rule.maximum.type&&stringToNumber(midValue)>=stringToNumber(maxValue)){return 32;}
return 0;}
checkMinBiggerThanMid(rule){var _a;const minValue=rule.minimum.value;const midValue=(_a=rule.midpoint)===null||_a===void 0?void 0:_a.value;if(rule.midpoint&&["number","percentage","percentile"].includes(rule.midpoint.type)&&rule.minimum.type===rule.midpoint.type&&stringToNumber(minValue)>=stringToNumber(midValue)){return 33;}
return 0;}
removeConditionalFormatting(id,sheet){const cfIndex=this.cfRules[sheet].findIndex((s)=>s.id===id);if(cfIndex!==-1){const currentCF=this.cfRules[sheet].slice();currentCF.splice(cfIndex,1);this.history.update("cfRules",sheet,currentCF);}}}
ConditionalFormatPlugin.getters=["getConditionalFormats","getRulesSelection","getRulesByCell"];class FigurePlugin extends CorePlugin{constructor(){super(...arguments);this.figures={};}
allowDispatch(cmd){switch(cmd.type){case"UPDATE_FIGURE":case"DELETE_FIGURE":return this.checkFigureExists(cmd.sheetId,cmd.id);default:return 0;}}
handle(cmd){switch(cmd.type){case"CREATE_SHEET":this.figures[cmd.sheetId]={};break;case"DELETE_SHEET":this.deleteSheet(cmd.sheetId);break;case"CREATE_FIGURE":this.addFigure(cmd.figure,cmd.sheetId);break;case"UPDATE_FIGURE":const{type,sheetId,...update}=cmd;const figure=update;this.updateFigure(sheetId,figure);break;case"DELETE_FIGURE":this.removeFigure(cmd.id,cmd.sheetId);break;}}
updateFigure(sheetId,figure){if(!("id"in figure)){return;}
for(const[key,value]of Object.entries(figure)){switch(key){case"x":case"y":if(value!==undefined){this.history.update("figures",sheetId,figure.id,key,Math.max(value,0));}
break;case"width":case"height":if(value!==undefined){this.history.update("figures",sheetId,figure.id,key,value);}
break;}}}
addFigure(figure,sheetId){this.history.update("figures",sheetId,figure.id,figure);}
deleteSheet(sheetId){this.history.update("figures",sheetId,undefined);}
removeFigure(id,sheetId){this.history.update("figures",sheetId,id,undefined);}
checkFigureExists(sheetId,figureId){var _a;if(((_a=this.figures[sheetId])===null||_a===void 0?void 0:_a[figureId])===undefined){return 53;}
return 0;}
getFigures(sheetId){return Object.values(this.figures[sheetId]||{}).filter(isDefined);}
getFigure(sheetId,figureId){var _a;return(_a=this.figures[sheetId])===null||_a===void 0?void 0:_a[figureId];}
import(data){for(let sheet of data.sheets){const figures={};sheet.figures.forEach((figure)=>{figures[figure.id]=figure;});this.figures[sheet.id]=figures;}}
export(data){for(const sheet of data.sheets){for(const figure of this.getFigures(sheet.id)){const data=undefined;sheet.figures.push({...figure,data});}}}
exportForExcel(data){this.export(data);}}
FigurePlugin.getters=["getFigures","getFigure"];class MergePlugin extends CorePlugin{constructor(){super(...arguments);this.nextId=1;this.pending=null;this.merges={};this.mergeCellMap={};}
allowDispatch(cmd){const force="force"in cmd?!!cmd.force:false;switch(cmd.type){case"ADD_MERGE":if(force){return 0;}
return this.checkValidations(cmd,this.checkDestructiveMerge,this.checkOverlap);case"UPDATE_CELL":return this.checkMergedContentUpdate(cmd);default:return 0;}}
beforeHandle(cmd){switch(cmd.type){case"REMOVE_COLUMNS_ROWS":if(cmd.dimension==="COL"){this.exportAndRemoveMerges(cmd.sheetId,(range)=>updateRemoveColumns(range,cmd.elements),true);}
else{this.exportAndRemoveMerges(cmd.sheetId,(range)=>updateRemoveRows(range,cmd.elements),false);}
break;case"ADD_COLUMNS_ROWS":const base=cmd.position==="before"?cmd.base:cmd.base+1;if(cmd.dimension==="COL"){this.exportAndRemoveMerges(cmd.sheetId,(range)=>updateAddColumns(range,base,cmd.quantity),true);}
else{this.exportAndRemoveMerges(cmd.sheetId,(range)=>updateAddRows(range,base,cmd.quantity),false);}}}
handle(cmd){switch(cmd.type){case"CREATE_SHEET":this.history.update("merges",cmd.sheetId,{});this.history.update("mergeCellMap",cmd.sheetId,{});break;case"DELETE_SHEET":this.history.update("merges",cmd.sheetId,{});this.history.update("mergeCellMap",cmd.sheetId,{});break;case"DUPLICATE_SHEET":this.history.update("merges",cmd.sheetIdTo,Object.assign({},this.merges[cmd.sheetId]));this.history.update("mergeCellMap",cmd.sheetIdTo,Object.assign({},this.mergeCellMap[cmd.sheetId]));break;case"ADD_MERGE":if(!cmd.interactive){for(const zone of cmd.target){this.addMerge(this.getters.getSheet(cmd.sheetId),zone);}}
break;case"REMOVE_MERGE":for(const zone of cmd.target){this.removeMerge(cmd.sheetId,zone);}
break;case"ADD_COLUMNS_ROWS":case"REMOVE_COLUMNS_ROWS":if(this.pending){this.importMerges(this.pending.sheet,this.pending.merges);this.pending=null;}
break;}}
getMerges(sheetId){return Object.values(this.merges[sheetId]||{}).filter(isDefined);}
getMerge(sheetId,col,row){var _a;const sheetMap=this.mergeCellMap[sheetId];const mergeId=sheetMap?col in sheetMap&&((_a=sheetMap[col])===null||_a===void 0?void 0:_a[row]):undefined;return mergeId?this.getMergeById(sheetId,mergeId):undefined;}
doesIntersectMerge(sheetId,zone){const{left,right,top,bottom}=zone;for(let row=top;row<=bottom;row++){for(let col=left;col<=right;col++){if(this.getMerge(sheetId,col,row)){return true;}}}
return false;}
doesColumnsHaveCommonMerges(sheetId,colA,colB){const sheet=this.getters.getSheet(sheetId);for(let row=0;row<sheet.rows.length;row++){if(this.isInSameMerge(sheet.id,colA,row,colB,row)){return true;}}
return false;}
doesRowsHaveCommonMerges(sheetId,rowA,rowB){const sheet=this.getters.getSheet(sheetId);for(let col=0;col<=sheet.cols.length;col++){if(this.isInSameMerge(sheet.id,col,rowA,col,rowB)){return true;}}
return false;}
expandZone(sheetId,zone){let{left,right,top,bottom}=zone;let result={left,right,top,bottom};for(let id in this.merges[sheetId]){const merge=this.getMergeById(sheetId,parseInt(id));if(merge&&overlap(merge,result)){result=union(merge,result);}}
return isEqual(result,zone)?result:this.expandZone(sheetId,result);}
isInSameMerge(sheetId,colA,rowA,colB,rowB){if(!this.isInMerge(sheetId,colA,rowA)||!this.isInMerge(sheetId,colB,rowB)){return false;}
return this.getMerge(sheetId,colA,rowA)===this.getMerge(sheetId,colB,rowB);}
isInMerge(sheetId,col,row){var _a;const sheetMap=this.mergeCellMap[sheetId];return sheetMap?col in sheetMap&&Boolean((_a=sheetMap[col])===null||_a===void 0?void 0:_a[row]):false;}
getMainCell(sheetId,col,row){if(!this.isInMerge(sheetId,col,row)){return[col,row];}
const mergeTopLeftPos=this.getMerge(sheetId,col,row).topLeft;return[mergeTopLeftPos.col,mergeTopLeftPos.row];}
getBottomLeftCell(sheetId,col,row){if(!this.isInMerge(sheetId,col,row)){return[col,row];}
const{bottom,left}=this.getMerge(sheetId,col,row);return[left,bottom];}
isMergeHidden(sheetId,merge){const hiddenColsGroups=this.getters.getHiddenColsGroups(sheetId);const hiddenRowsGroups=this.getters.getHiddenRowsGroups(sheetId);for(let group of hiddenColsGroups){if(merge.left>=group[0]&&merge.right<=group[group.length-1]){return true;}}
for(let group of hiddenRowsGroups){if(merge.top>=group[0]&&merge.bottom<=group[group.length-1]){return true;}}
return false;}
isSingleCellOrMerge(sheetId,zone){const merge=this.getMerge(sheetId,zone.left,zone.top);if(merge){return isEqual(zone,merge);}
const{width,height}=zoneToDimension(zone);return width===1&&height===1;}
isMergeDestructive(sheet,zone){let{left,right,top,bottom}=zone;right=clip(right,0,sheet.cols.length-1);bottom=clip(bottom,0,sheet.rows.length-1);for(let row=top;row<=bottom;row++){const actualRow=this.getters.getRow(sheet.id,row);for(let col=left;col<=right;col++){if(col!==left||row!==top){const cell=actualRow.cells[col];if(cell&&!cell.isEmpty()){return true;}}}}
return false;}
getMergeById(sheetId,mergeId){const merges=this.merges[sheetId];return merges!==undefined?merges[mergeId]:undefined;}
checkDestructiveMerge({sheetId,target}){const sheet=this.getters.tryGetSheet(sheetId);if(!sheet)
return 0;const isDestructive=target.some((zone)=>this.isMergeDestructive(sheet,zone));return isDestructive?3:0;}
checkOverlap({target}){for(const zone of target){for(const zone2 of target){if(zone!==zone2&&overlap(zone,zone2)){return 48;}}}
return 0;}
checkMergedContentUpdate(cmd){const{col,row,sheetId,content}=cmd;if(content===undefined){return 0;}
const[mainCol,mainRow]=this.getMainCell(sheetId,col,row);if(mainCol===col&&mainRow===row){return 0;}
return 4;}
addMerge(sheet,zone){let{left,right,top,bottom}=zone;right=clip(right,0,sheet.cols.length-1);bottom=clip(bottom,0,sheet.rows.length-1);const tl=toXC(left,top);const br=toXC(right,bottom);if(tl===br){return;}
const topLeft=this.getters.getCell(sheet.id,left,top);let id=this.nextId++;this.history.update("merges",sheet.id,id,{id,left,top,right,bottom,topLeft:{col:left,row:top},});let previousMerges=new Set();for(let row=top;row<=bottom;row++){for(let col=left;col<=right;col++){if(col!==left||row!==top){this.dispatch("UPDATE_CELL",{sheetId:sheet.id,col,row,style:topLeft?topLeft.style:undefined,content:undefined,});}
const merge=this.getMerge(sheet.id,col,row);if(merge){previousMerges.add(merge.id);}
this.history.update("mergeCellMap",sheet.id,col,row,id);}}
for(let mergeId of previousMerges){const{top,bottom,left,right}=this.getMergeById(sheet.id,mergeId);for(let r=top;r<=bottom;r++){for(let c=left;c<=right;c++){const merge=this.getMerge(sheet.id,c,r);if(!merge||merge.id!==id){this.history.update("mergeCellMap",sheet.id,c,r,undefined);this.dispatch("CLEAR_CELL",{sheetId:sheet.id,col:c,row:r,});}}}
this.history.update("merges",sheet.id,mergeId,undefined);}}
removeMerge(sheetId,zone){const{left,top,bottom,right}=zone;const merge=this.getMerge(sheetId,left,top);if(merge===undefined||!isEqual(zone,merge)){throw new Error(_lt("Invalid merge zone"));}
this.history.update("merges",sheetId,merge.id,undefined);for(let r=top;r<=bottom;r++){for(let c=left;c<=right;c++){this.history.update("mergeCellMap",sheetId,c,r,undefined);}}}
removeAllMerges(sheetId){for(let id in this.merges[sheetId]){this.history.update("merges",sheetId,parseInt(id),undefined);}
for(let colNumber in this.mergeCellMap[sheetId]){this.history.update("mergeCellMap",sheetId,parseInt(colNumber),undefined);}}
exportAndRemoveMerges(sheetId,updater,isCol){const merges=this.merges[sheetId];if(!merges)
return;const mergeXcs=exportMerges(merges);const updatedMerges=[];for(let m of mergeXcs){const update=updater(m);if(update){const[tl,br]=update.split(":");if(tl!==br){updatedMerges.push(update);}}}
this.removeAllMerges(sheetId);this.pending={sheet:sheetId,merges:updatedMerges};}
import(data){const sheets=data.sheets||[];for(let sheetData of sheets){this.history.update("merges",sheetData.id,{});this.history.update("mergeCellMap",sheetData.id,{});if(sheetData.merges){this.importMerges(sheetData.id,sheetData.merges);}}}
importMerges(sheetId,merges){const sheet=this.getters.getSheet(sheetId);for(let merge of merges){this.addMerge(sheet,toZone(merge));}}
export(data){for(let sheetData of data.sheets){const merges=this.merges[sheetData.id];if(merges){sheetData.merges.push(...exportMerges(merges));}}}
exportForExcel(data){this.export(data);}}
MergePlugin.getters=["isInMerge","isInSameMerge","isMergeHidden","getMainCell","getBottomLeftCell","expandZone","doesIntersectMerge","doesColumnsHaveCommonMerges","doesRowsHaveCommonMerges","getMerges","getMerge","isSingleCellOrMerge",];function exportMerges(merges){return Object.values(merges).filter(isDefined).map((merge)=>toXC(merge.left,merge.top)+":"+toXC(merge.right,merge.bottom));}
class SheetPlugin extends CorePlugin{constructor(){super(...arguments);this.sheetIds={};this.visibleSheets=[];this.sheets={};this.cellPosition={};}
allowDispatch(cmd){const genericChecks=this.chainValidations(this.checkSheetExists,this.checkZones)(cmd);if(genericChecks!==0){return genericChecks;}
switch(cmd.type){case"CREATE_SHEET":{const{visibleSheets}=this;if(cmd.position>visibleSheets.length||cmd.position<0){return 13;}
return 0;}
case"MOVE_SHEET":const currentIndex=this.visibleSheets.findIndex((id)=>id===cmd.sheetId);return(cmd.direction==="left"&&currentIndex===0)||(cmd.direction==="right"&&currentIndex===this.visibleSheets.length-1)?12:0;case"RENAME_SHEET":return this.isRenameAllowed(cmd);case"DELETE_SHEET":return this.visibleSheets.length>1?0:8;case"REMOVE_COLUMNS_ROWS":const sheet=this.getSheet(cmd.sheetId);const length=cmd.dimension==="COL"?sheet.cols.length:sheet.rows.length;return length>cmd.elements.length?0:7;case"HIDE_COLUMNS_ROWS":{const sheet=this.sheets[cmd.sheetId];const hiddenGroup=cmd.dimension==="COL"?sheet.hiddenColsGroups:sheet.hiddenRowsGroups;const elements=cmd.dimension==="COL"?sheet.cols:sheet.rows;return(hiddenGroup||[]).flat().concat(cmd.elements).length<elements.length?0:49;}
default:return 0;}}
handle(cmd){switch(cmd.type){case"SET_GRID_LINES_VISIBILITY":this.setGridLinesVisibility(cmd.sheetId,cmd.areGridLinesVisible);break;case"DELETE_CONTENT":this.clearZones(cmd.sheetId,cmd.target);break;case"CREATE_SHEET":const sheet=this.createSheet(cmd.sheetId,this.generateSheetName(),cmd.cols||26,cmd.rows||100,cmd.position);this.history.update("sheetIds",sheet.name,sheet.id);break;case"RESIZE_COLUMNS_ROWS":const dimension=cmd.dimension==="COL"?"cols":"rows";for(let elt of cmd.elements){this.setHeaderSize(this.getSheet(cmd.sheetId),dimension,elt,cmd.size);}
break;case"MOVE_SHEET":this.moveSheet(cmd.sheetId,cmd.direction);break;case"RENAME_SHEET":if(!cmd.interactive){this.renameSheet(this.sheets[cmd.sheetId],cmd.name);}
break;case"DUPLICATE_SHEET":this.duplicateSheet(cmd.sheetId,cmd.sheetIdTo);break;case"DELETE_SHEET":this.deleteSheet(this.sheets[cmd.sheetId]);break;case"REMOVE_COLUMNS_ROWS":if(cmd.dimension==="COL"){this.removeColumns(this.sheets[cmd.sheetId],cmd.elements);}
else{this.removeRows(this.sheets[cmd.sheetId],cmd.elements);}
break;case"ADD_COLUMNS_ROWS":if(cmd.dimension==="COL"){this.addColumns(this.sheets[cmd.sheetId],cmd.base,cmd.position,cmd.quantity);}
else{this.addRows(this.sheets[cmd.sheetId],cmd.base,cmd.position,cmd.quantity);}
break;case"HIDE_COLUMNS_ROWS":{if(cmd.dimension==="COL"){this.setElementsVisibility(this.sheets[cmd.sheetId],cmd.elements,"cols","hide");}
else{this.setElementsVisibility(this.sheets[cmd.sheetId],cmd.elements,"rows","hide");}
break;}
case"UNHIDE_COLUMNS_ROWS":{if(cmd.dimension==="COL"){this.setElementsVisibility(this.sheets[cmd.sheetId],cmd.elements,"cols","show");}
else{this.setElementsVisibility(this.sheets[cmd.sheetId],cmd.elements,"rows","show");}
break;}
case"UPDATE_CELL_POSITION":this.updateCellPosition(cmd);break;}}
import(data){for(let sheet of data.sheets){this.sheetIds[sheet.name]=sheet.id;}
for(let sheetData of data.sheets){const name=sheetData.name||_t("Sheet")+(Object.keys(this.sheets).length+1);const sheet={id:sheetData.id,name:name,cols:createCols(sheetData.cols||{},sheetData.colNumber),rows:createRows(sheetData.rows||{},sheetData.rowNumber),hiddenColsGroups:[],hiddenRowsGroups:[],areGridLinesVisible:sheetData.areGridLinesVisible===undefined?true:sheetData.areGridLinesVisible,};this.visibleSheets.push(sheet.id);this.sheets[sheet.id]=sheet;this.updateHiddenElementsGroups(sheet.id,"cols");this.updateHiddenElementsGroups(sheet.id,"rows");}}
exportSheets(data,exportDefaultSizes=false){data.sheets=this.visibleSheets.filter(isDefined).map((id)=>{const sheet=this.sheets[id];return{id:sheet.id,name:sheet.name,colNumber:sheet.cols.length,rowNumber:sheet.rows.length,rows:exportRows(sheet.rows,exportDefaultSizes),cols:exportCols(sheet.cols,exportDefaultSizes),merges:[],cells:{},conditionalFormats:[],figures:[],areGridLinesVisible:sheet.areGridLinesVisible===undefined?true:sheet.areGridLinesVisible,};});}
export(data){this.exportSheets(data);}
exportForExcel(data){this.exportSheets(data,true);}
getGridLinesVisibility(sheetId){return this.getSheet(sheetId).areGridLinesVisible;}
tryGetSheet(sheetId){return this.sheets[sheetId];}
getSheet(sheetId){const sheet=this.sheets[sheetId];if(!sheet){throw new Error(`Sheet ${sheetId} not found.`);}
return sheet;}
getSheetName(sheetId){return this.getSheet(sheetId).name;}
tryGetSheetName(sheetId){var _a;return(_a=this.tryGetSheet(sheetId))===null||_a===void 0?void 0:_a.name;}
getSheetIdByName(name){if(name){const unquotedName=getUnquotedSheetName(name);for(const key in this.sheetIds){if(key.toUpperCase()===unquotedName.toUpperCase()){return this.sheetIds[key];}}}
return undefined;}
getSheets(){const{visibleSheets,sheets}=this;return visibleSheets.map((id)=>sheets[id]).filter(isDefined);}
getVisibleSheets(){return this.visibleSheets;}
getEvaluationSheets(){return this.sheets;}
getCol(sheetId,index){var _a;return(_a=this.sheets[sheetId])===null||_a===void 0?void 0:_a.cols[index];}
getRow(sheetId,index){var _a;return(_a=this.sheets[sheetId])===null||_a===void 0?void 0:_a.rows[index];}
getCell(sheetId,col,row){const sheet=this.tryGetSheet(sheetId);return(sheet&&sheet.rows[row]&&sheet.rows[row].cells[col])||undefined;}
getColCells(sheetId,col){return this.getSheet(sheetId).rows.reduce((acc,cur)=>{const cell=cur.cells[col];return cell!==undefined?acc.concat(cell):acc;},[]);}
getColsZone(sheetId,start,end){return{top:0,bottom:this.getSheet(sheetId).rows.length-1,left:start,right:end,};}
getRowsZone(sheetId,start,end){return{top:start,bottom:end,left:0,right:this.getSheet(sheetId).cols.length-1,};}
getCellPosition(cellId){const cell=this.cellPosition[cellId];if(!cell){throw new Error(`asking for a cell position that doesn't exist, cell id: ${cellId}`);}
return cell;}
getHiddenColsGroups(sheetId){var _a;return((_a=this.sheets[sheetId])===null||_a===void 0?void 0:_a.hiddenColsGroups)||[];}
getHiddenRowsGroups(sheetId){var _a;return((_a=this.sheets[sheetId])===null||_a===void 0?void 0:_a.hiddenRowsGroups)||[];}
getNumberCols(sheetId){return this.getSheet(sheetId).cols.length;}
getNumberRows(sheetId){return this.getSheet(sheetId).rows.length;}
isEmpty(sheetId,zone){const sheet=this.getSheet(sheetId);return mapCellsInZone(zone,sheet,(cell)=>cell,undefined).flat().every((cell)=>!cell||cell.isEmpty());}
setHeaderSize(sheet,dimension,index,size){let start,end;const elements=sheet[dimension];const base=elements[index];const delta=size-base.size;this.history.update("sheets",sheet.id,dimension,index,"size",size);if(!base.isHidden)
this.history.update("sheets",sheet.id,dimension,index,"end",base.end+delta);start=base.end;for(let i=index+1;i<elements.length;i++){const element=elements[i];end=element.isHidden?start:start+element.size;this.history.update("sheets",sheet.id,dimension,i,"start",start);this.history.update("sheets",sheet.id,dimension,i,"end",end);start=end;}}
updateCellPosition(cmd){if(cmd.cell){const position=this.cellPosition[cmd.cellId];if(position){this.history.update("sheets",cmd.sheetId,"rows",position.row,"cells",position.col,undefined);}
this.history.update("cellPosition",cmd.cell.id,{row:cmd.row,col:cmd.col,sheetId:cmd.sheetId,});this.history.update("sheets",cmd.sheetId,"rows",cmd.row,"cells",cmd.col,cmd.cell);}
else{this.history.update("cellPosition",cmd.cellId,undefined);this.history.update("sheets",cmd.sheetId,"rows",cmd.row,"cells",cmd.col,undefined);}}
setGridLinesVisibility(sheetId,areGridLinesVisible){this.history.update("sheets",sheetId,"areGridLinesVisible",areGridLinesVisible);}
clearZones(sheetId,zones){for(let zone of zones){for(let col=zone.left;col<=zone.right;col++){for(let row=zone.top;row<=zone.bottom;row++){const cell=this.sheets[sheetId].rows[row].cells[col];if(cell){this.dispatch("UPDATE_CELL",{sheetId:sheetId,content:"",col,row,});}}}}}
generateSheetName(){let i=1;const names=this.getSheets().map((s)=>s.name);const baseName=_lt("Sheet");let name=`${baseName}${i}`;while(names.includes(name)){name=`${baseName}${i}`;i++;}
return name;}
createSheet(id,name,colNumber,rowNumber,position){const sheet={id,name,cols:createDefaultCols(colNumber),rows:createDefaultRows(rowNumber),hiddenColsGroups:[],hiddenRowsGroups:[],areGridLinesVisible:true,};const visibleSheets=this.visibleSheets.slice();visibleSheets.splice(position,0,sheet.id);const sheets=this.sheets;this.history.update("visibleSheets",visibleSheets);this.history.update("sheets",Object.assign({},sheets,{[sheet.id]:sheet}));return sheet;}
moveSheet(sheetId,direction){const visibleSheets=this.visibleSheets.slice();const currentIndex=visibleSheets.findIndex((id)=>id===sheetId);const sheet=visibleSheets.splice(currentIndex,1);visibleSheets.splice(currentIndex+(direction==="left"?-1:1),0,sheet[0]);this.history.update("visibleSheets",visibleSheets);}
checkSheetName(cmd){const{visibleSheets,sheets}=this;const name=cmd.name&&cmd.name.trim().toLowerCase();if(visibleSheets.find((id)=>{var _a;return((_a=sheets[id])===null||_a===void 0?void 0:_a.name.toLowerCase())===name;})){return 10;}
if(FORBIDDEN_IN_EXCEL_REGEX.test(name)){return 11;}
return 0;}
isRenameAllowed(cmd){if(cmd.interactive){return 0;}
const name=cmd.name&&cmd.name.trim().toLowerCase();if(!name){return 9;}
return this.checkSheetName(cmd);}
renameSheet(sheet,name){const oldName=sheet.name;this.history.update("sheets",sheet.id,"name",name.trim());const sheetIds=Object.assign({},this.sheetIds);sheetIds[name]=sheet.id;delete sheetIds[oldName];this.history.update("sheetIds",sheetIds);}
duplicateSheet(fromId,toId){const sheet=this.getSheet(fromId);const toName=this.getDuplicateSheetName(sheet.name);const newSheet=JSON.parse(JSON.stringify(sheet));newSheet.id=toId;newSheet.name=toName;for(let col=0;col<=newSheet.cols.length;col++){for(let row=0;row<=newSheet.rows.length;row++){if(newSheet.rows[row]){newSheet.rows[row].cells[col]=undefined;}}}
const visibleSheets=this.visibleSheets.slice();const currentIndex=visibleSheets.findIndex((id)=>id===fromId);visibleSheets.splice(currentIndex+1,0,newSheet.id);this.history.update("visibleSheets",visibleSheets);this.history.update("sheets",Object.assign({},this.sheets,{[newSheet.id]:newSheet}));for(const cell of Object.values(this.getters.getCells(fromId))){const{col,row}=this.getCellPosition(cell.id);this.dispatch("UPDATE_CELL",{sheetId:newSheet.id,col,row,content:cell.content,format:cell.format,style:cell.style,});}
const sheetIds=Object.assign({},this.sheetIds);sheetIds[newSheet.name]=newSheet.id;this.history.update("sheetIds",sheetIds);}
getDuplicateSheetName(sheetName){let i=1;const names=this.getters.getSheets().map((s)=>s.name);const baseName=_lt("Copy of %s",sheetName);let name=baseName.toString();while(names.includes(name)){name=`${baseName} (${i})`;i++;}
return name;}
deleteSheet(sheet){const name=sheet.name;const sheets=Object.assign({},this.sheets);delete sheets[sheet.id];this.history.update("sheets",sheets);const visibleSheets=this.visibleSheets.slice();const currentIndex=visibleSheets.findIndex((id)=>id===sheet.id);visibleSheets.splice(currentIndex,1);this.history.update("visibleSheets",visibleSheets);const sheetIds=Object.assign({},this.sheetIds);delete sheetIds[name];this.history.update("sheetIds",sheetIds);}
removeColumns(sheet,columns){columns.sort((a,b)=>b-a);for(let column of columns){this.moveCellOnColumnsDeletion(sheet,column);}
this.updateColumnsStructureOnDeletion(sheet,columns);}
removeRows(sheet,rows){rows.sort((a,b)=>b-a);for(let group of groupConsecutive(rows)){this.moveCellOnRowsDeletion(sheet,group[group.length-1],group[0]);group.map((row)=>this.updateRowsStructureOnDeletion(row,sheet));}}
addColumns(sheet,column,position,quantity){this.moveCellsOnAddition(sheet,position==="before"?column:column+1,quantity,"columns");this.updateColumnsStructureOnAddition(sheet,column,quantity);}
addRows(sheet,row,position,quantity){this.addEmptyRows(sheet,quantity);this.moveCellsOnAddition(sheet,position==="before"?row:row+1,quantity,"rows");this.updateRowsStructureOnAddition(sheet,row,quantity);}
moveCellOnColumnsDeletion(sheet,deletedColumn){for(let[index,row]of Object.entries(sheet.rows)){const rowIndex=parseInt(index,10);for(let i in row.cells){const colIndex=parseInt(i,10);const cell=row.cells[i];if(cell){if(colIndex===deletedColumn){this.dispatch("CLEAR_CELL",{sheetId:sheet.id,col:colIndex,row:rowIndex,});}
if(colIndex>deletedColumn){this.dispatch("UPDATE_CELL_POSITION",{sheetId:sheet.id,cellId:cell.id,cell:cell,col:colIndex-1,row:rowIndex,});}}}}}
moveCellsOnAddition(sheet,addedElement,quantity,dimension){const commands=[];for(const[index,row]of Object.entries(sheet.rows)){const rowIndex=parseInt(index,10);if(dimension!=="rows"||rowIndex>=addedElement){for(let i in row.cells){const colIndex=parseInt(i,10);const cell=row.cells[i];if(cell){if(dimension==="rows"||colIndex>=addedElement){commands.push({type:"UPDATE_CELL_POSITION",sheetId:sheet.id,cellId:cell.id,cell:cell,col:colIndex+(dimension==="columns"?quantity:0),row:rowIndex+(dimension==="rows"?quantity:0),});}}}}}
for(let cmd of commands.reverse()){this.dispatch(cmd.type,cmd);}}
moveCellOnRowsDeletion(sheet,deleteFromRow,deleteToRow){const numberRows=deleteToRow-deleteFromRow+1;for(let[index,row]of Object.entries(sheet.rows)){const rowIndex=parseInt(index,10);if(rowIndex>=deleteFromRow&&rowIndex<=deleteToRow){for(let i in row.cells){const colIndex=parseInt(i,10);const cell=row.cells[i];if(cell){this.dispatch("CLEAR_CELL",{sheetId:sheet.id,col:colIndex,row:rowIndex,});}}}
if(rowIndex>deleteToRow){for(let i in row.cells){const colIndex=parseInt(i,10);const cell=row.cells[i];if(cell){this.dispatch("UPDATE_CELL_POSITION",{sheetId:sheet.id,cellId:cell.id,cell:cell,col:colIndex,row:rowIndex-numberRows,});}}}}}
updateColumnsStructureOnDeletion(sheet,deletedColumns){const cols=[];let start=0;let colSizeIndex=0;for(let index in sheet.cols){if(deletedColumns.includes(parseInt(index,10))){continue;}
const{size,isHidden}=sheet.cols[index];const end=isHidden?start:start+size;cols.push({name:numberToLetters(colSizeIndex),size,start,end,isHidden,});start=end;colSizeIndex++;}
this.history.update("sheets",sheet.id,"cols",cols);this.updateHiddenElementsGroups(sheet.id,"cols");}
updateColumnsStructureOnAddition(sheet,addedColumn,columnsToAdd){const cols=[];let start=0;let colIndex=0;for(let i in sheet.cols){if(parseInt(i,10)===addedColumn){const{size}=sheet.cols[colIndex];for(let a=0;a<columnsToAdd;a++){cols.push({name:numberToLetters(colIndex),size,start,end:start+size,});start+=size;colIndex++;}}
const{size,isHidden}=sheet.cols[i];const end=isHidden?start:start+size;cols.push({name:numberToLetters(colIndex),size,start,end,isHidden,});start=end;colIndex++;}
this.history.update("sheets",sheet.id,"cols",cols);this.updateHiddenElementsGroups(sheet.id,"cols");}
updateRowsStructureOnDeletion(index,sheet){const rows=[];let start=0;let rowIndex=0;const cellsQueue=sheet.rows.map((row)=>row.cells);for(let i in sheet.rows){const row=sheet.rows[i];const{size,isHidden}=row;const end=isHidden?start:start+size;if(parseInt(i,10)===index){continue;}
rowIndex++;rows.push({start,end,size,cells:cellsQueue.shift(),name:String(rowIndex),isHidden,});start=end;}
this.history.update("sheets",sheet.id,"rows",rows);this.updateHiddenElementsGroups(sheet.id,"rows");}
updateRowsStructureOnAddition(sheet,addedRow,rowsToAdd){const rows=[];let start=0;let rowIndex=0;let sizeIndex=0;const cellsQueue=sheet.rows.map((row)=>row.cells);for(let i in sheet.rows){const{size,isHidden}=sheet.rows[sizeIndex];const end=isHidden?start:start+size;if(parseInt(i,10)<addedRow||parseInt(i,10)>=addedRow+rowsToAdd){sizeIndex++;}
rowIndex++;rows.push({start,end,size,cells:cellsQueue.shift(),name:String(rowIndex),isHidden,});start=end;}
this.history.update("sheets",sheet.id,"rows",rows);this.updateHiddenElementsGroups(sheet.id,"rows");}
addEmptyRows(sheet,quantity){const lastEnd=sheet.rows[sheet.rows.length-1].end;const rows=sheet.rows.slice();for(let i=0;i<quantity;i++){rows.push({start:lastEnd,end:lastEnd,size:0,name:(rows.length+1).toString(),cells:{},});}
this.history.update("sheets",sheet.id,"rows",rows);}
setElementsVisibility(sheet,elements,direction,visibility){let start=0;const hide=visibility==="hide";for(let index=0;index<sheet[direction].length;index++){const{size,isHidden}=sheet[direction][index];const newIsHidden=elements.includes(index)?hide:isHidden||false;const end=newIsHidden?start:start+size;this.history.update("sheets",sheet.id,direction,index,"start",start);this.history.update("sheets",sheet.id,direction,index,"end",end);this.history.update("sheets",sheet.id,direction,index,"isHidden",newIsHidden);start=end;}
this.updateHiddenElementsGroups(sheet.id,direction);}
updateHiddenElementsGroups(sheetId,dimension){var _a;const elements=((_a=this.sheets[sheetId])===null||_a===void 0?void 0:_a[dimension])||[];const elementsRef=dimension==="cols"?"hiddenColsGroups":"hiddenRowsGroups";const hiddenEltsGroups=elements.reduce((acc,currentElt,index)=>{if(!currentElt.isHidden){return acc;}
const currentGroup=acc[acc.length-1];if(!currentGroup||currentGroup[currentGroup.length-1]!=index-1){acc.push([]);}
acc[acc.length-1].push(index);return acc;},[]);this.history.update("sheets",sheetId,elementsRef,hiddenEltsGroups);}
checkSheetExists(cmd){if(cmd.type!=="CREATE_SHEET"&&"sheetId"in cmd&&this.sheets[cmd.sheetId]===undefined){return 21;}
return 0;}
checkZones(cmd){const zones=[];if("zone"in cmd){zones.push(cmd.zone);}
if("target"in cmd&&Array.isArray(cmd.target)){zones.push(...cmd.target);}
if(!zones.every(isZoneValid)){return 20;}
else if(zones.length&&"sheetId"in cmd){const sheet=this.getSheet(cmd.sheetId);const sheetZone={top:0,left:0,bottom:sheet.rows.length-1,right:sheet.cols.length-1,};return zones.every((zone)=>isZoneInside(zone,sheetZone))?0:16;}
return 0;}}
SheetPlugin.getters=["getSheetName","tryGetSheetName","getSheet","tryGetSheet","getSheetIdByName","getSheets","getVisibleSheets","getEvaluationSheets","getCol","getRow","getCell","getCellPosition","getColCells","getColsZone","getRowsZone","getNumberCols","getNumberRows","getHiddenColsGroups","getHiddenRowsGroups","getGridLinesVisibility","isEmpty",];class SortPlugin extends CorePlugin{allowDispatch(cmd){switch(cmd.type){case"SORT_CELLS":if(!isInside(cmd.col,cmd.row,cmd.zone)){throw new Error(_lt("The anchor must be part of the provided zone"));}
return this.checkValidations(cmd,this.checkMerge,this.checkMergeSizes);}
return 0;}
handle(cmd){switch(cmd.type){case"SORT_CELLS":if(cmd.interactive){break;}
this.sortZone(cmd.sheetId,cmd,cmd.zone,cmd.sortDirection);break;}}
checkMerge({sheetId,zone}){if(!this.getters.doesIntersectMerge(sheetId,zone)){return 0;}
for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){if(!this.getters.isInMerge(sheetId,col,row)){return 46;}}}
return 0;}
checkMergeSizes({sheetId,zone}){if(!this.getters.doesIntersectMerge(sheetId,zone)){return 0;}
const merges=this.getters.getMerges(sheetId).filter((merge)=>overlap(merge,zone));const mergeDimension=zoneToDimension(merges[0]);let[widthFirst,heightFirst]=[mergeDimension.width,mergeDimension.height];if(!merges.every((merge)=>{let[widthCurrent,heightCurrent]=[merge.right-merge.left+1,merge.bottom-merge.top+1,];return widthCurrent===widthFirst&&heightCurrent===heightFirst;})){return 46;}
return 0;}
expand(sheet,z){const{left,right,top,bottom}=this.getters.expandZone(sheet.id,z);return{left:Math.max(0,left),right:Math.min(sheet.cols.length-1,right),top:Math.max(0,top),bottom:Math.min(sheet.rows.length-1,bottom),};}
checkExpandedValues(sheet,z){const expandedZone=this.expand(sheet,z);const sheetId=sheet.id;let line=[];let cell;if(this.getters.doesIntersectMerge(sheetId,expandedZone)){const{left,right,top,bottom}=expandedZone;for(let c=left;c<=right;c++){for(let r=top;r<=bottom;r++){const[mainCellCol,mainCellRow]=this.getters.getMainCell(sheetId,c,r);cell=this.getters.getCell(sheetId,mainCellCol,mainCellRow);line.push((cell===null||cell===void 0?void 0:cell.formattedValue)||"");}}}
else{const values=mapCellsInZone(expandedZone,sheet,(cell)=>cell.formattedValue,"");line=values.flat();}
return line.some((item)=>item!=="");}
getContiguousZone(sheetId,zone){let{top,bottom,left,right}=zone;let canExpand;const sheet=this.getters.getSheet(sheetId);let stop=false;while(!stop){stop=true;if(top>0){canExpand=this.checkExpandedValues(sheet,{left:left-1,right:right+1,top:top-1,bottom:top-1,});if(canExpand){stop=false;top--;}}
if(left>0){canExpand=this.checkExpandedValues(sheet,{left:left-1,right:left-1,top:top-1,bottom:bottom+1,});if(canExpand){stop=false;left--;}}
if(right<sheet.cols.length-1){canExpand=this.checkExpandedValues(sheet,{left:right+1,right:right+1,top:top-1,bottom:bottom+1,});if(canExpand){stop=false;right++;}}
if(bottom<sheet.rows.length-1){canExpand=this.checkExpandedValues(sheet,{left:left-1,right:right+1,top:bottom+1,bottom:bottom+1,});if(canExpand){stop=false;bottom++;}}}
return{left,right,top,bottom};}
hasHeader(sheet,zone,deltaX,deltaY){const{left,right,top,bottom}=zone;if(bottom-top+1===1)
return false;let cells=mapCellsInZone({left,right,top:top,bottom:top+2*deltaY-1},sheet,(cell)=>cell.evaluated.type,CellValueType.empty,deltaX,deltaY);const topLeft=cells[0][0];if(topLeft===CellValueType.empty){cells=cells.slice(1);}
if(cells.some((item)=>item[0]===CellValueType.empty)){return false;}
else if(cells.some((item)=>item[1]!==CellValueType.empty&&item[0]!==item[1])){return true;}
else{return false;}}
sortCellsList(list,sortDirection){const cellsIndex=list.map((val,index)=>({index,val}));const sortingCellsIndexes=cellsIndex.filter((x)=>!(x.val==undefined||x.val.evaluated.value===""));const emptyCellsIndexes=cellsIndex.filter((x)=>x.val==undefined||x.val.evaluated.value==="");const inverse=sortDirection==="descending"?-1:1;const sortTypes=[CellValueType.number,CellValueType.error,CellValueType.text,CellValueType.boolean,];const convertCell=(cell)=>{let type=cell.evaluated.type;return{type:type,value:cell.evaluated.value};};const sortingTypeValueMapIndexes=sortingCellsIndexes.map((item)=>{return{index:item.index,val:convertCell(item.val),};});const sortedIndex=sortingTypeValueMapIndexes.sort((left,right)=>{let typeOrder=sortTypes.indexOf(left.val.type)-sortTypes.indexOf(right.val.type);if(typeOrder===0){if(left.val.type===CellValueType.text||left.val.type===CellValueType.error){typeOrder=left.val.value.localeCompare(right.val.value);}
else
typeOrder=left.val.value-right.val.value;}
return inverse*typeOrder;});return sortedIndex.concat(emptyCellsIndexes);}
sortZone(sheetId,anchor,zone,sortDirection){let stepX=1,stepY=1,sortingCol=anchor.col;let sortZone=Object.assign({},zone);if(this.getters.doesIntersectMerge(sheetId,sortZone)){const{col,row}=anchor;const merge=this.getters.getMerge(sheetId,col,row);stepX=merge.right-merge.left+1;stepY=merge.bottom-merge.top+1;sortingCol=merge.topLeft.col;}
const sheet=this.getters.getSheet(sheetId);const hasHeader=this.hasHeader(sheet,sortZone,stepX,stepY);if(hasHeader){sortZone.top+=stepY;}
const cells=mapCellsInZone(sortZone,sheet,(cell)=>cell,undefined,stepX,stepY);const sortingCells=cells[sortingCol-sortZone.left];const sortedIndexOfSortTypeCells=this.sortCellsList(sortingCells,sortDirection);const sortedIndex=sortedIndexOfSortTypeCells.map((x)=>x.index);const[width,height]=[cells.length,cells[0].length];for(let c=0;c<width;c++){for(let r=0;r<height;r++){let cell=cells[c][sortedIndex[r]];let newCol=sortZone.left+c*stepX;let newRow=sortZone.top+r*stepY;let newCellValues={sheetId:sheetId,col:newCol,row:newRow,content:"",value:"",};if(cell){let content=cell.content;if(cell.isFormula()){const position=this.getters.getCellPosition(cell.id);const offsetY=newRow-position.row;const ranges=this.getters.createAdaptedRanges(cell.dependencies.references,0,offsetY,sheetId);content=this.getters.buildFormulaContent(sheetId,cell.normalizedText,{...cell.dependencies,references:ranges,});}
newCellValues.style=cell.style;newCellValues.content=content;newCellValues.format=cell.format;newCellValues.value=cell.evaluated.value;}
this.dispatch("UPDATE_CELL",newCellValues);}}}}
SortPlugin.getters=["getContiguousZone"];const autofillModifiersRegistry=new Registry();autofillModifiersRegistry.add("INCREMENT_MODIFIER",{apply:(rule,data)=>{var _a;rule.current+=rule.increment;const content=rule.current.toString();const tooltipValue=formatValue(rule.current,(_a=data.cell)===null||_a===void 0?void 0:_a.format);return{cellData:{border:data.border,style:data.cell&&data.cell.style,format:data.cell&&data.cell.format,content,},tooltip:content?{props:{content:tooltipValue}}:undefined,};},}).add("COPY_MODIFIER",{apply:(rule,data,getters)=>{var _a,_b;const content=((_a=data.cell)===null||_a===void 0?void 0:_a.content)||"";return{cellData:{border:data.border,style:data.cell&&data.cell.style,format:data.cell&&data.cell.format,content,},tooltip:content?{props:{content:(_b=data.cell)===null||_b===void 0?void 0:_b.formattedValue}}:undefined,};},}).add("FORMULA_MODIFIER",{apply:(rule,data,getters,direction)=>{rule.current+=rule.increment;let x=0;let y=0;switch(direction){case 0:x=0;y=-rule.current;break;case 1:x=0;y=rule.current;break;case 2:x=-rule.current;y=0;break;case 3:x=rule.current;y=0;break;}
if(!data.cell||!data.cell.isFormula()){return{cellData:{}};}
const sheetId=data.sheetId;const ranges=getters.createAdaptedRanges(data.cell.dependencies.references,x,y,sheetId);const content=getters.buildFormulaContent(sheetId,data.cell.normalizedText,{...data.cell.dependencies,references:ranges,});return{cellData:{border:data.border,style:data.cell.style,format:data.cell.format,content,},tooltip:content?{props:{content}}:undefined,};},});const autofillRulesRegistry=new Registry();function getGroup(cell,cells){let group=[];let found=false;for(let x of cells){if(x===cell){found=true;}
if((x===null||x===void 0?void 0:x.evaluated.type)===CellValueType.number){group.push(x.evaluated.value);}
else{if(found){return group;}
group=[];}}
return group;}
function getAverageIncrement(group){const averages=[];let last=group[0];for(let i=1;i<group.length;i++){const current=group[i];averages.push(current-last);last=current;}
return averages.reduce((a,b)=>a+b,0)/averages.length;}
autofillRulesRegistry.add("simple_value_copy",{condition:(cell,cells)=>{var _a;return cells.length===1&&!cell.isFormula()&&!((_a=cell.format)===null||_a===void 0?void 0:_a.match(DATETIME_FORMAT));},generateRule:()=>{return{type:"COPY_MODIFIER"};},sequence:10,}).add("copy_text",{condition:(cell)=>!cell.isFormula()&&cell.evaluated.type===CellValueType.text,generateRule:()=>{return{type:"COPY_MODIFIER"};},sequence:20,}).add("update_formula",{condition:(cell)=>cell.isFormula(),generateRule:(_,cells)=>{return{type:"FORMULA_MODIFIER",increment:cells.length,current:0};},sequence:30,}).add("increment_number",{condition:(cell)=>cell.evaluated.type===CellValueType.number,generateRule:(cell,cells)=>{const group=getGroup(cell,cells);let increment=1;if(group.length==2){increment=(group[1]-group[0])*2;}
else if(group.length>2){increment=getAverageIncrement(group)*group.length;}
return{type:"INCREMENT_MODIFIER",increment,current:cell.evaluated.type===CellValueType.number?cell.evaluated.value:0,};},sequence:40,});const figureRegistry=new Registry();const inverseCommandRegistry=new Registry().add("ADD_COLUMNS_ROWS",inverseAddColumnsRows).add("REMOVE_COLUMNS_ROWS",inverseRemoveColumnsRows).add("ADD_MERGE",inverseAddMerge).add("REMOVE_MERGE",inverseRemoveMerge).add("CREATE_SHEET",inverseCreateSheet).add("DELETE_SHEET",inverseDeleteSheet).add("DUPLICATE_SHEET",inverseDuplicateSheet).add("CREATE_FIGURE",inverseCreateFigure).add("CREATE_CHART",inverseCreateChart).add("HIDE_COLUMNS_ROWS",inverseHideColumnsRows).add("UNHIDE_COLUMNS_ROWS",inverseUnhideColumnsRows);for(const cmd of coreTypes.values()){try{inverseCommandRegistry.get(cmd);}
catch(_){inverseCommandRegistry.add(cmd,identity);}}
function identity(cmd){return[cmd];}
function inverseAddColumnsRows(cmd){const elements=[];let start=cmd.base;if(cmd.position==="after"){start++;}
for(let i=0;i<cmd.quantity;i++){elements.push(i+start);}
return[{type:"REMOVE_COLUMNS_ROWS",dimension:cmd.dimension,elements,sheetId:cmd.sheetId,},];}
function inverseAddMerge(cmd){return[{type:"REMOVE_MERGE",sheetId:cmd.sheetId,target:cmd.target}];}
function inverseRemoveMerge(cmd){return[{type:"ADD_MERGE",sheetId:cmd.sheetId,target:cmd.target}];}
function inverseCreateSheet(cmd){return[{type:"DELETE_SHEET",sheetId:cmd.sheetId}];}
function inverseDuplicateSheet(cmd){return[{type:"DELETE_SHEET",sheetId:cmd.sheetIdTo}];}
function inverseRemoveColumnsRows(cmd){const commands=[];const elements=[...cmd.elements].sort((a,b)=>a-b);for(let group of groupConsecutive(elements)){const column=group[0]===0?0:group[0]-1;const position=group[0]===0?"before":"after";commands.push({type:"ADD_COLUMNS_ROWS",dimension:cmd.dimension,quantity:group.length,base:column,sheetId:cmd.sheetId,position,});}
return commands;}
function inverseDeleteSheet(cmd){return[{type:"CREATE_SHEET",sheetId:cmd.sheetId,position:1}];}
function inverseCreateFigure(cmd){return[{type:"DELETE_FIGURE",id:cmd.figure.id,sheetId:cmd.sheetId}];}
function inverseCreateChart(cmd){return[{type:"DELETE_FIGURE",id:cmd.id,sheetId:cmd.sheetId}];}
function inverseHideColumnsRows(cmd){return[{type:"UNHIDE_COLUMNS_ROWS",sheetId:cmd.sheetId,dimension:cmd.dimension,elements:cmd.elements,},];}
function inverseUnhideColumnsRows(cmd){return[{type:"HIDE_COLUMNS_ROWS",sheetId:cmd.sheetId,dimension:cmd.dimension,elements:cmd.elements,},];}
const DEFAULT_MENU_ITEM=(key)=>({isVisible:()=>true,isEnabled:()=>true,isReadonlyAllowed:false,shortCut:"",action:false,children:[],separator:false,icon:false,id:key,});function createFullMenuItem(key,value){return Object.assign({},DEFAULT_MENU_ITEM(key),value);}
class MenuItemRegistry extends Registry{add(key,value){this.content[key]=createFullMenuItem(key,value);return this;}
addChild(key,path,value){const root=path.splice(0,1)[0];let node=this.content[root];if(!node){throw new Error(`Path ${root + ":" + path.join(":")} not found`);}
for(let p of path){if(typeof node.children==="function"){node=undefined;}
else{node=node.children.find((elt)=>elt.id===p);}
if(!node){throw new Error(`Path ${root + ":" + path.join(":")} not found`);}}
node.children.push(createFullMenuItem(key,value));return this;}
getChildren(node,env){if(typeof node.children==="function"){return node.children(env).sort((a,b)=>a.sequence-b.sequence);}
return node.children.sort((a,b)=>a.sequence-b.sequence);}
getName(node,env){if(typeof node.name==="function"){return node.name(env);}
return node.name;}
getShortCut(node){return node.shortCut?node.shortCut:"";}
getAll(){return super.getAll().sort((a,b)=>a.sequence-b.sequence);}}
function getColumnsNumber(env){const activeCols=env.getters.getActiveCols();if(activeCols.size){return activeCols.size;}
else{const zone=env.getters.getSelectedZones()[0];return zone.right-zone.left+1;}}
function getRowsNumber(env){const activeRows=env.getters.getActiveRows();if(activeRows.size){return activeRows.size;}
else{const zone=env.getters.getSelectedZones()[0];return zone.bottom-zone.top+1;}}
function setFormatter(env,format){env.dispatch("SET_FORMATTING",{sheetId:env.getters.getActiveSheetId(),target:env.getters.getSelectedZones(),format,});}
function setStyle(env,style){env.dispatch("SET_FORMATTING",{sheetId:env.getters.getActiveSheetId(),target:env.getters.getSelectedZones(),style,});}
const UNDO_ACTION=(env)=>env.dispatch("REQUEST_UNDO");const REDO_ACTION=(env)=>env.dispatch("REQUEST_REDO");const COPY_ACTION=async(env)=>{env.dispatch("COPY",{target:env.getters.getSelectedZones()});await env.clipboard.writeText(env.getters.getClipboardContent());};const CUT_ACTION=async(env)=>{env.dispatch("CUT",{target:env.getters.getSelectedZones()});await env.clipboard.writeText(env.getters.getClipboardContent());};const PASTE_ACTION=async(env)=>{const spreadsheetClipboard=env.getters.getClipboardContent();let osClipboard;try{osClipboard=await env.clipboard.readText();}
catch(e){console.warn("The OS clipboard could not be read.");console.error(e);}
const target=env.getters.getSelectedZones();if(osClipboard&&osClipboard!==spreadsheetClipboard){env.dispatch("PASTE_FROM_OS_CLIPBOARD",{target,text:osClipboard,});}
else{env.dispatch("PASTE",{target,interactive:true});}};const PASTE_VALUE_ACTION=(env)=>env.dispatch("PASTE",{target:env.getters.getSelectedZones(),pasteOption:"onlyValue"});const PASTE_FORMAT_ACTION=(env)=>env.dispatch("PASTE",{target:env.getters.getSelectedZones(),pasteOption:"onlyFormat"});const DELETE_CONTENT_ACTION=(env)=>env.dispatch("DELETE_CONTENT",{sheetId:env.getters.getActiveSheetId(),target:env.getters.getSelectedZones(),});const SET_FORMULA_VISIBILITY_ACTION=(env)=>env.dispatch("SET_FORMULA_VISIBILITY",{show:!env.getters.shouldShowFormulas()});const SET_GRID_LINES_VISIBILITY_ACTION=(env)=>{const sheetId=env.getters.getActiveSheetId();env.dispatch("SET_GRID_LINES_VISIBILITY",{sheetId,areGridLinesVisible:!env.getters.getGridLinesVisibility(sheetId),});};const DELETE_CONTENT_ROWS_NAME=(env)=>{let first;let last;const activesRows=env.getters.getActiveRows();if(activesRows.size!==0){first=Math.min(...activesRows);last=Math.max(...activesRows);}
else{const zone=env.getters.getSelectedZones()[0];first=zone.top;last=zone.bottom;}
if(first===last){return _lt("Clear row %s",(first+1).toString());}
return _lt("Clear rows %s - %s",(first+1).toString(),(last+1).toString());};const DELETE_CONTENT_ROWS_ACTION=(env)=>{const sheetId=env.getters.getActiveSheetId();const target=[...env.getters.getActiveRows()].map((index)=>env.getters.getRowsZone(sheetId,index,index));env.dispatch("DELETE_CONTENT",{target,sheetId:env.getters.getActiveSheetId(),});};const DELETE_CONTENT_COLUMNS_NAME=(env)=>{let first;let last;const activeCols=env.getters.getActiveCols();if(activeCols.size!==0){first=Math.min(...activeCols);last=Math.max(...activeCols);}
else{const zone=env.getters.getSelectedZones()[0];first=zone.left;last=zone.right;}
if(first===last){return _lt("Clear column %s",numberToLetters(first));}
return _lt("Clear columns %s - %s",numberToLetters(first),numberToLetters(last));};const DELETE_CONTENT_COLUMNS_ACTION=(env)=>{const sheetId=env.getters.getActiveSheetId();const target=[...env.getters.getActiveCols()].map((index)=>env.getters.getColsZone(sheetId,index,index));env.dispatch("DELETE_CONTENT",{target,sheetId:env.getters.getActiveSheetId(),});};const REMOVE_ROWS_NAME=(env)=>{let first;let last;const activesRows=env.getters.getActiveRows();if(activesRows.size!==0){first=Math.min(...activesRows);last=Math.max(...activesRows);}
else{const zone=env.getters.getSelectedZones()[0];first=zone.top;last=zone.bottom;}
if(first===last){return _lt("Delete row %s",(first+1).toString());}
return _lt("Delete rows %s - %s",(first+1).toString(),(last+1).toString());};const REMOVE_ROWS_ACTION=(env)=>{let rows=[...env.getters.getActiveRows()];if(!rows.length){const zone=env.getters.getSelectedZones()[0];for(let i=zone.top;i<=zone.bottom;i++){rows.push(i);}}
env.dispatch("REMOVE_COLUMNS_ROWS",{sheetId:env.getters.getActiveSheetId(),dimension:"ROW",elements:rows,});};const REMOVE_COLUMNS_NAME=(env)=>{let first;let last;const activeCols=env.getters.getActiveCols();if(activeCols.size!==0){first=Math.min(...activeCols);last=Math.max(...activeCols);}
else{const zone=env.getters.getSelectedZones()[0];first=zone.left;last=zone.right;}
if(first===last){return _lt("Delete column %s",numberToLetters(first));}
return _lt("Delete columns %s - %s",numberToLetters(first),numberToLetters(last));};const REMOVE_COLUMNS_ACTION=(env)=>{let columns=[...env.getters.getActiveCols()];if(!columns.length){const zone=env.getters.getSelectedZones()[0];for(let i=zone.left;i<=zone.right;i++){columns.push(i);}}
env.dispatch("REMOVE_COLUMNS_ROWS",{sheetId:env.getters.getActiveSheetId(),dimension:"COL",elements:columns,});};const INSERT_CELL_SHIFT_DOWN=(env)=>{const zone=env.getters.getSelectedZone();env.dispatch("INSERT_CELL",{shiftDimension:"ROW",zone,interactive:true});};const INSERT_CELL_SHIFT_RIGHT=(env)=>{const zone=env.getters.getSelectedZone();env.dispatch("INSERT_CELL",{shiftDimension:"COL",zone,interactive:true});};const DELETE_CELL_SHIFT_UP=(env)=>{const zone=env.getters.getSelectedZone();env.dispatch("DELETE_CELL",{shiftDimension:"ROW",zone,interactive:true});};const DELETE_CELL_SHIFT_LEFT=(env)=>{const zone=env.getters.getSelectedZone();env.dispatch("DELETE_CELL",{shiftDimension:"COL",zone,interactive:true});};const MENU_INSERT_ROWS_BEFORE_NAME=(env)=>{const number=getRowsNumber(env);if(number===1){return _lt("Row above");}
return _lt("%s Rows above",number.toString());};const ROW_INSERT_ROWS_BEFORE_NAME=(env)=>{const number=getRowsNumber(env);return number===1?_lt("Insert row above"):_lt("Insert %s rows above",number.toString());};const CELL_INSERT_ROWS_BEFORE_NAME=(env)=>{const number=getRowsNumber(env);if(number===1){return _lt("Insert row");}
return _lt("Insert %s rows",number.toString());};const INSERT_ROWS_BEFORE_ACTION=(env)=>{const activeRows=env.getters.getActiveRows();let row;let quantity;if(activeRows.size){row=Math.min(...activeRows);quantity=activeRows.size;}
else{const zone=env.getters.getSelectedZones()[0];row=zone.top;quantity=zone.bottom-zone.top+1;}
env.dispatch("ADD_COLUMNS_ROWS",{sheetId:env.getters.getActiveSheetId(),position:"before",base:row,quantity,dimension:"ROW",});};const MENU_INSERT_ROWS_AFTER_NAME=(env)=>{const number=getRowsNumber(env);if(number===1){return _lt("Row below");}
return _lt("%s Rows below",number.toString());};const ROW_INSERT_ROWS_AFTER_NAME=(env)=>{const number=getRowsNumber(env);return number===1?_lt("Insert row below"):_lt("Insert %s rows below",number.toString());};const INSERT_ROWS_AFTER_ACTION=(env)=>{const activeRows=env.getters.getActiveRows();let row;let quantity;if(activeRows.size){row=Math.max(...activeRows);quantity=activeRows.size;}
else{const zone=env.getters.getSelectedZones()[0];row=zone.bottom;quantity=zone.bottom-zone.top+1;}
env.dispatch("ADD_COLUMNS_ROWS",{sheetId:env.getters.getActiveSheetId(),position:"after",base:row,quantity,dimension:"ROW",});};const MENU_INSERT_COLUMNS_BEFORE_NAME=(env)=>{const number=getColumnsNumber(env);if(number===1){return _lt("Column left");}
return _lt("%s Columns left",number.toString());};const COLUMN_INSERT_COLUMNS_BEFORE_NAME=(env)=>{const number=getColumnsNumber(env);return number===1?_lt("Insert column left"):_lt("Insert %s columns left",number.toString());};const CELL_INSERT_COLUMNS_BEFORE_NAME=(env)=>{const number=getColumnsNumber(env);if(number===1){return _lt("Insert column");}
return _lt("Insert %s columns",number.toString());};const INSERT_COLUMNS_BEFORE_ACTION=(env)=>{const activeCols=env.getters.getActiveCols();let column;let quantity;if(activeCols.size){column=Math.min(...activeCols);quantity=activeCols.size;}
else{const zone=env.getters.getSelectedZones()[0];column=zone.left;quantity=zone.right-zone.left+1;}
env.dispatch("ADD_COLUMNS_ROWS",{sheetId:env.getters.getActiveSheetId(),position:"before",dimension:"COL",base:column,quantity,});};const MENU_INSERT_COLUMNS_AFTER_NAME=(env)=>{const number=getColumnsNumber(env);if(number===1){return _lt("Column right");}
return _lt("%s Columns right",number.toString());};const COLUMN_INSERT_COLUMNS_AFTER_NAME=(env)=>{const number=getColumnsNumber(env);return number===1?_lt("Insert column right"):_lt("Insert %s columns right",number.toString());};const INSERT_COLUMNS_AFTER_ACTION=(env)=>{const activeCols=env.getters.getActiveCols();let column;let quantity;if(activeCols.size){column=Math.max(...activeCols);quantity=activeCols.size;}
else{const zone=env.getters.getSelectedZones()[0];column=zone.right;quantity=zone.right-zone.left+1;}
env.dispatch("ADD_COLUMNS_ROWS",{sheetId:env.getters.getActiveSheetId(),position:"after",dimension:"COL",base:column,quantity,});};const HIDE_COLUMNS_NAME=(env)=>{const cols=env.getters.getElementsFromSelection("COL");let first=cols[0];let last=cols[cols.length-1];if(cols.length===1){return _lt("Hide column %s",numberToLetters(first).toString());}
else if(last-first+1===cols.length){return _lt("Hide columns %s - %s",numberToLetters(first).toString(),numberToLetters(last).toString());}
else{return _lt("Hide columns");}};const HIDE_COLUMNS_ACTION=(env)=>{const columns=env.getters.getElementsFromSelection("COL");env.dispatch("HIDE_COLUMNS_ROWS",{sheetId:env.getters.getActiveSheetId(),dimension:"COL",elements:columns,});};const UNHIDE_ALL_COLUMNS_ACTION=(env)=>{const sheet=env.getters.getActiveSheet();env.dispatch("UNHIDE_COLUMNS_ROWS",{sheetId:sheet.id,dimension:"COL",elements:Array.from(Array(sheet.cols.length).keys()),});};const UNHIDE_COLUMNS_ACTION=(env)=>{const columns=env.getters.getElementsFromSelection("COL");env.dispatch("UNHIDE_COLUMNS_ROWS",{sheetId:env.getters.getActiveSheetId(),dimension:"COL",elements:columns,});};const HIDE_ROWS_NAME=(env)=>{const rows=env.getters.getElementsFromSelection("ROW");let first=rows[0];let last=rows[rows.length-1];if(rows.length===1){return _lt("Hide row %s",(first+1).toString());}
else if(last-first+1===rows.length){return _lt("Hide rows %s - %s",(first+1).toString(),(last+1).toString());}
else{return _lt("Hide rows");}};const HIDE_ROWS_ACTION=(env)=>{const rows=env.getters.getElementsFromSelection("ROW");env.dispatch("HIDE_COLUMNS_ROWS",{sheetId:env.getters.getActiveSheetId(),dimension:"ROW",elements:rows,});};const UNHIDE_ALL_ROWS_ACTION=(env)=>{const sheet=env.getters.getActiveSheet();env.dispatch("UNHIDE_COLUMNS_ROWS",{sheetId:sheet.id,dimension:"ROW",elements:Array.from(Array(sheet.rows.length).keys()),});};const UNHIDE_ROWS_ACTION=(env)=>{const columns=env.getters.getElementsFromSelection("ROW");env.dispatch("UNHIDE_COLUMNS_ROWS",{sheetId:env.getters.getActiveSheetId(),dimension:"ROW",elements:columns,});};const CREATE_SHEET_ACTION=(env)=>{const activeSheetId=env.getters.getActiveSheetId();const position=env.getters.getVisibleSheets().findIndex((sheetId)=>sheetId===activeSheetId)+1;const sheetId=env.uuidGenerator.uuidv4();env.dispatch("CREATE_SHEET",{sheetId,position});env.dispatch("ACTIVATE_SHEET",{sheetIdFrom:activeSheetId,sheetIdTo:sheetId});};const CREATE_CHART=(env)=>{var _a,_b;const zone=env.getters.getSelectedZone();let dataSetZone=zone;const id=env.uuidGenerator.uuidv4();let labelRange;if(zone.left!==zone.right){labelRange=zoneToXc({...zone,right:zone.left,top:zone.top+1});dataSetZone={...zone,left:zone.left+1};}
const dataSets=[zoneToXc(dataSetZone)];const sheetId=env.getters.getActiveSheetId();const position={x:((_a=env.getters.getCol(sheetId,zone.right+1))===null||_a===void 0?void 0:_a.start)||0,y:((_b=env.getters.getRow(sheetId,zone.top))===null||_b===void 0?void 0:_b.start)||0,};let dataSetsHaveTitle=false;for(let x=dataSetZone.left;x<=dataSetZone.right;x++){const cell=env.getters.getCell(sheetId,x,zone.top);if(cell&&cell.evaluated.type!==CellValueType.number){dataSetsHaveTitle=true;}}
env.dispatch("CREATE_CHART",{sheetId,id,position,definition:{title:"",dataSets,labelRange,type:"bar",stackedBar:false,dataSetsHaveTitle,background:BACKGROUND_CHART_COLOR,verticalAxisPosition:"left",legendPosition:"top",},});const figure=env.getters.getFigure(sheetId,id);env.openSidePanel("ChartPanel",{figure});};const FORMAT_GENERAL_ACTION=(env)=>setFormatter(env,"");const FORMAT_NUMBER_ACTION=(env)=>setFormatter(env,"#,##0.00");const FORMAT_PERCENT_ACTION=(env)=>setFormatter(env,"0.00%");const FORMAT_DATE_ACTION=(env)=>setFormatter(env,"m/d/yyyy");const FORMAT_TIME_ACTION=(env)=>setFormatter(env,"hh:mm:ss a");const FORMAT_DATE_TIME_ACTION=(env)=>setFormatter(env,"m/d/yyyy hh:mm:ss");const FORMAT_DURATION_ACTION=(env)=>setFormatter(env,"hhhh:mm:ss");const FORMAT_BOLD_ACTION=(env)=>setStyle(env,{bold:!env.getters.getCurrentStyle().bold});const FORMAT_ITALIC_ACTION=(env)=>setStyle(env,{italic:!env.getters.getCurrentStyle().italic});const FORMAT_STRIKETHROUGH_ACTION=(env)=>setStyle(env,{strikethrough:!env.getters.getCurrentStyle().strikethrough});const FORMAT_UNDERLINE_ACTION=(env)=>setStyle(env,{underline:!env.getters.getCurrentStyle().underline});const OPEN_CF_SIDEPANEL_ACTION=(env)=>{env.openSidePanel("ConditionalFormatting",{selection:env.getters.getSelectedZones()});};const OPEN_FAR_SIDEPANEL_ACTION=(env)=>{env.openSidePanel("FindAndReplace",{});};const INSERT_LINK=(env)=>{env.openLinkEditor();};const SORT_CELLS_ASCENDING=(env)=>{const{anchor,zones}=env.getters.getSelection();env.dispatch("SORT_CELLS",{interactive:true,sheetId:env.getters.getActiveSheetId(),col:anchor[0],row:anchor[1],zone:zones[0],sortDirection:"ascending",});};const SORT_CELLS_DESCENDING=(env)=>{const{anchor,zones}=env.getters.getSelection();env.dispatch("SORT_CELLS",{interactive:true,sheetId:env.getters.getActiveSheetId(),col:anchor[0],row:anchor[1],zone:zones[0],sortDirection:"descending",});};const IS_ONLY_ONE_RANGE=(env)=>{return env.getters.getSelectedZones().length===1;};const cellMenuRegistry=new MenuItemRegistry();cellMenuRegistry.add("cut",{name:_lt("Cut"),shortCut:"Ctrl+X",sequence:10,action:CUT_ACTION,}).add("copy",{name:_lt("Copy"),shortCut:"Ctrl+C",sequence:20,isReadonlyAllowed:true,action:COPY_ACTION,}).add("paste",{name:_lt("Paste"),shortCut:"Ctrl+V",sequence:30,action:PASTE_ACTION,isVisible:IS_ONLY_ONE_RANGE,}).add("paste_special",{name:_lt("Paste special"),sequence:40,separator:true,isVisible:IS_ONLY_ONE_RANGE,}).addChild("paste_value_only",["paste_special"],{name:_lt("Paste values only"),sequence:10,action:PASTE_VALUE_ACTION,}).addChild("paste_format_only",["paste_special"],{name:_lt("Paste format only"),sequence:20,action:PASTE_FORMAT_ACTION,}).add("sort_range",{name:_lt("Sort range"),sequence:50,isVisible:IS_ONLY_ONE_RANGE,separator:true,}).addChild("sort_ascending",["sort_range"],{name:_lt("Ascending (A ⟶ Z)"),sequence:10,action:SORT_CELLS_ASCENDING,}).addChild("sort_descending",["sort_range"],{name:_lt("Descending (Z ⟶ A)"),sequence:20,action:SORT_CELLS_DESCENDING,}).add("add_row_before",{name:CELL_INSERT_ROWS_BEFORE_NAME,sequence:70,action:INSERT_ROWS_BEFORE_ACTION,isVisible:IS_ONLY_ONE_RANGE,}).add("add_column_before",{name:CELL_INSERT_COLUMNS_BEFORE_NAME,sequence:90,action:INSERT_COLUMNS_BEFORE_ACTION,isVisible:IS_ONLY_ONE_RANGE,}).add("insert_cell",{name:_lt("Insert cells"),sequence:100,isVisible:IS_ONLY_ONE_RANGE,separator:true,}).addChild("insert_cell_down",["insert_cell"],{name:_lt("Shift down"),sequence:10,action:INSERT_CELL_SHIFT_DOWN,}).addChild("insert_cell_right",["insert_cell"],{name:_lt("Shift right"),sequence:20,action:INSERT_CELL_SHIFT_RIGHT,}).add("delete_row",{name:REMOVE_ROWS_NAME,sequence:110,action:REMOVE_ROWS_ACTION,isVisible:IS_ONLY_ONE_RANGE,}).add("delete_column",{name:REMOVE_COLUMNS_NAME,sequence:120,action:REMOVE_COLUMNS_ACTION,isVisible:IS_ONLY_ONE_RANGE,}).add("delete_cell",{name:_lt("Delete cells"),sequence:130,isVisible:IS_ONLY_ONE_RANGE,}).addChild("delete_cell_up",["delete_cell"],{name:_lt("Shift up"),sequence:10,action:DELETE_CELL_SHIFT_UP,}).addChild("delete_cell_down",["delete_cell"],{name:_lt("Shift left"),sequence:20,action:DELETE_CELL_SHIFT_LEFT,}).add("clear_cell",{name:_lt("Clear cells"),sequence:140,action:DELETE_CONTENT_ACTION,isEnabled:(env)=>{const cell=env.getters.getActiveCell();return Boolean(cell);},separator:true,}).add("insert_link",{name:_lt("Insert link"),separator:true,sequence:150,action:INSERT_LINK,}).add("conditional_formatting",{name:_lt("Conditional formatting"),sequence:160,action:OPEN_CF_SIDEPANEL_ACTION,separator:true,});const colMenuRegistry=new MenuItemRegistry();colMenuRegistry.add("cut",{name:_lt("Cut"),shortCut:"Ctrl+X",sequence:10,action:CUT_ACTION,}).add("copy",{name:_lt("Copy"),shortCut:"Ctrl+C",sequence:20,isReadonlyAllowed:true,action:COPY_ACTION,}).add("paste",{name:_lt("Paste"),shortCut:"Ctrl+V",sequence:30,action:PASTE_ACTION,}).add("paste_special",{name:_lt("Paste special"),sequence:40,separator:true,}).addChild("paste_value_only",["paste_special"],{name:_lt("Paste value only"),sequence:10,action:PASTE_VALUE_ACTION,}).addChild("paste_format_only",["paste_special"],{name:_lt("Paste format only"),sequence:20,action:PASTE_FORMAT_ACTION,}).add("sort_columns",{name:(env)=>env.getters.getActiveCols().size>1?_lt("Sort columns"):_lt("Sort column"),sequence:50,isVisible:IS_ONLY_ONE_RANGE,separator:true,}).addChild("sort_ascending",["sort_columns"],{name:_lt("Ascending (A ⟶ Z)"),sequence:10,action:SORT_CELLS_ASCENDING,}).addChild("sort_descending",["sort_columns"],{name:_lt("Descending (Z ⟶ A)"),sequence:20,action:SORT_CELLS_DESCENDING,}).add("add_column_before",{name:COLUMN_INSERT_COLUMNS_BEFORE_NAME,sequence:70,action:INSERT_COLUMNS_BEFORE_ACTION,}).add("add_column_after",{name:COLUMN_INSERT_COLUMNS_AFTER_NAME,sequence:80,action:INSERT_COLUMNS_AFTER_ACTION,}).add("delete_column",{name:REMOVE_COLUMNS_NAME,sequence:90,action:REMOVE_COLUMNS_ACTION,}).add("clear_column",{name:DELETE_CONTENT_COLUMNS_NAME,sequence:100,action:DELETE_CONTENT_COLUMNS_ACTION,}).add("hide_columns",{name:HIDE_COLUMNS_NAME,sequence:85,action:HIDE_COLUMNS_ACTION,isVisible:(env)=>{const sheet=env.getters.getActiveSheet();const hiddenCols=env.getters.getHiddenColsGroups(sheet.id).flat();return(sheet.cols.length>hiddenCols.length+env.getters.getElementsFromSelection("COL").length);},separator:true,}).add("unhide_columns",{name:"Unhide columns",sequence:86,action:UNHIDE_COLUMNS_ACTION,isVisible:(env)=>{const hiddenCols=env.getters.getHiddenColsGroups(env.getters.getActiveSheetId()).flat();const currentCols=env.getters.getElementsFromSelection("COL");return currentCols.some((col)=>hiddenCols.includes(col));},separator:true,}).add("conditional_formatting",{name:_lt("Conditional formatting"),sequence:110,action:OPEN_CF_SIDEPANEL_ACTION,});const linkMenuRegistry=new MenuItemRegistry();linkMenuRegistry.add("sheet",{name:_lt("Link sheet"),sequence:10,children:(env)=>{const sheets=env.getters.getSheets();return sheets.map((sheet,i)=>createFullMenuItem(sheet.id,{name:sheet.name,sequence:i,action:()=>({link:{label:sheet.name,url:buildSheetLink(sheet.id)},urlRepresentation:sheet.name,isUrlEditable:false,}),}));},});const rowMenuRegistry=new MenuItemRegistry();rowMenuRegistry.add("cut",{name:_lt("Cut"),sequence:10,shortCut:"Ctrl+X",action:CUT_ACTION,}).add("copy",{name:_lt("Copy"),shortCut:"Ctrl+C",sequence:20,isReadonlyAllowed:true,action:COPY_ACTION,}).add("paste",{name:_lt("Paste"),shortCut:"Ctrl+V",sequence:30,action:PASTE_ACTION,}).add("paste_special",{name:_lt("Paste special"),sequence:40,separator:true,}).addChild("paste_value_only",["paste_special"],{name:_lt("Paste value only"),sequence:10,action:PASTE_VALUE_ACTION,}).addChild("paste_format_only",["paste_special"],{name:_lt("Paste format only"),sequence:20,action:PASTE_FORMAT_ACTION,}).add("add_row_before",{name:ROW_INSERT_ROWS_BEFORE_NAME,sequence:50,action:INSERT_ROWS_BEFORE_ACTION,}).add("add_row_after",{name:ROW_INSERT_ROWS_AFTER_NAME,sequence:60,action:INSERT_ROWS_AFTER_ACTION,}).add("delete_row",{name:REMOVE_ROWS_NAME,sequence:70,action:REMOVE_ROWS_ACTION,}).add("clear_row",{name:DELETE_CONTENT_ROWS_NAME,sequence:80,action:DELETE_CONTENT_ROWS_ACTION,}).add("hide_rows",{name:HIDE_ROWS_NAME,sequence:85,action:HIDE_ROWS_ACTION,isVisible:(env)=>{const sheet=env.getters.getActiveSheet();const hiddenRows=env.getters.getHiddenRowsGroups(sheet.id).flat();return(sheet.rows.length>hiddenRows.length+env.getters.getElementsFromSelection("ROW").length);},separator:true,}).add("unhide_rows",{name:"Unhide rows",sequence:86,action:UNHIDE_ROWS_ACTION,isVisible:(env)=>{const hiddenRows=env.getters.getHiddenRowsGroups(env.getters.getActiveSheetId()).flat();const currentRows=env.getters.getElementsFromSelection("ROW");return currentRows.some((col)=>hiddenRows.includes(col));},separator:true,}).add("conditional_formatting",{name:_lt("Conditional formatting"),sequence:90,action:OPEN_CF_SIDEPANEL_ACTION,});const sheetMenuRegistry=new MenuItemRegistry();sheetMenuRegistry.add("delete",{name:_lt("Delete"),sequence:10,isVisible:(env)=>{return env.getters.getSheets().length>1;},action:(env)=>env.dispatch("DELETE_SHEET_CONFIRMATION",{sheetId:env.getters.getActiveSheetId()}),}).add("duplicate",{name:_lt("Duplicate"),sequence:20,action:(env)=>{const sheetIdFrom=env.getters.getActiveSheetId();const sheetIdTo=env.uuidGenerator.uuidv4();env.dispatch("DUPLICATE_SHEET",{sheetId:sheetIdFrom,sheetIdTo,});env.dispatch("ACTIVATE_SHEET",{sheetIdFrom,sheetIdTo});},}).add("rename",{name:_lt("Rename"),sequence:30,action:(env)=>env.dispatch("RENAME_SHEET",{interactive:true,sheetId:env.getters.getActiveSheetId(),}),}).add("move_right",{name:_lt("Move right"),sequence:40,isVisible:(env)=>{const sheet=env.getters.getActiveSheetId();const sheets=env.getters.getSheets();return sheets.findIndex((s)=>s.id===sheet)!==sheets.length-1;},action:(env)=>env.dispatch("MOVE_SHEET",{sheetId:env.getters.getActiveSheetId(),direction:"right"}),}).add("move_left",{name:_lt("Move left"),sequence:50,isVisible:(env)=>{const sheet=env.getters.getActiveSheetId();return env.getters.getSheets().findIndex((s)=>s.id===sheet)!==0;},action:(env)=>env.dispatch("MOVE_SHEET",{sheetId:env.getters.getActiveSheetId(),direction:"left"}),});const topbarMenuRegistry=new MenuItemRegistry();topbarMenuRegistry.add("file",{name:_lt("File"),sequence:10}).add("edit",{name:_lt("Edit"),sequence:20}).add("view",{name:_lt("View"),sequence:30}).add("insert",{name:_lt("Insert"),sequence:40}).add("format",{name:_lt("Format"),sequence:50}).add("data",{name:_lt("Data"),sequence:60}).addChild("save",["file"],{name:_lt("Save"),shortCut:"Ctrl+S",sequence:10,action:()=>console.log("Not implemented"),}).addChild("undo",["edit"],{name:_lt("Undo"),shortCut:"Ctrl+Z",sequence:10,action:UNDO_ACTION,}).addChild("redo",["edit"],{name:_lt("Redo"),shortCut:"Ctrl+Y",sequence:20,action:REDO_ACTION,separator:true,}).addChild("copy",["edit"],{name:_lt("Copy"),shortCut:"Ctrl+C",sequence:30,isReadonlyAllowed:true,action:COPY_ACTION,}).addChild("cut",["edit"],{name:_lt("Cut"),shortCut:"Ctrl+X",sequence:40,action:CUT_ACTION,}).addChild("paste",["edit"],{name:_lt("Paste"),shortCut:"Ctrl+V",sequence:50,action:PASTE_ACTION,}).addChild("paste_special",["edit"],{name:_lt("Paste special"),sequence:60,separator:true,}).addChild("paste_special_value",["edit","paste_special"],{name:_lt("Paste value only"),sequence:10,action:PASTE_VALUE_ACTION,}).addChild("paste_special_format",["edit","paste_special"],{name:_lt("Paste format only"),sequence:20,action:PASTE_FORMAT_ACTION,}).addChild("sort_range",["edit"],{name:_lt("Sort range"),sequence:62,isVisible:IS_ONLY_ONE_RANGE,separator:true,}).addChild("sort_ascending",["edit","sort_range"],{name:_lt("Ascending (A ⟶ Z)"),sequence:10,action:SORT_CELLS_ASCENDING,}).addChild("sort_descending",["edit","sort_range"],{name:_lt("Descending (Z ⟶ A)"),sequence:20,action:SORT_CELLS_DESCENDING,}).addChild("find_and_replace",["edit"],{name:_lt("Find and replace"),shortCut:"Ctrl+H",sequence:65,isReadonlyAllowed:true,action:OPEN_FAR_SIDEPANEL_ACTION,separator:true,}).addChild("edit_delete_cell_values",["edit"],{name:_lt("Delete values"),sequence:70,action:DELETE_CONTENT_ACTION,}).addChild("edit_delete_row",["edit"],{name:REMOVE_ROWS_NAME,sequence:80,action:REMOVE_ROWS_ACTION,}).addChild("edit_delete_column",["edit"],{name:REMOVE_COLUMNS_NAME,sequence:90,action:REMOVE_COLUMNS_ACTION,}).addChild("edit_delete_cell_shift_up",["edit"],{name:_lt("Delete cell and shift up"),sequence:93,action:DELETE_CELL_SHIFT_UP,}).addChild("edit_delete_cell_shift_left",["edit"],{name:_lt("Delete cell and shift left"),sequence:97,action:DELETE_CELL_SHIFT_LEFT,}).addChild("edit_unhide_columns",["edit"],{name:_lt("Unhide all columns"),sequence:100,action:UNHIDE_ALL_COLUMNS_ACTION,isVisible:(env)=>env.getters.getHiddenColsGroups(env.getters.getActiveSheetId()).length>0,}).addChild("edit_unhide_rows",["edit"],{name:_lt("Unhide all rows"),sequence:100,action:UNHIDE_ALL_ROWS_ACTION,isVisible:(env)=>env.getters.getHiddenRowsGroups(env.getters.getActiveSheetId()).length>0,}).addChild("insert_row_before",["insert"],{name:MENU_INSERT_ROWS_BEFORE_NAME,sequence:10,action:INSERT_ROWS_BEFORE_ACTION,isVisible:(env)=>env.getters.getActiveCols().size===0,}).addChild("insert_row_after",["insert"],{name:MENU_INSERT_ROWS_AFTER_NAME,sequence:20,action:INSERT_ROWS_AFTER_ACTION,isVisible:(env)=>env.getters.getActiveCols().size===0,separator:true,}).addChild("insert_column_before",["insert"],{name:MENU_INSERT_COLUMNS_BEFORE_NAME,sequence:30,action:INSERT_COLUMNS_BEFORE_ACTION,isVisible:(env)=>env.getters.getActiveRows().size===0,}).addChild("insert_column_after",["insert"],{name:MENU_INSERT_COLUMNS_AFTER_NAME,sequence:40,action:INSERT_COLUMNS_AFTER_ACTION,isVisible:(env)=>env.getters.getActiveRows().size===0,separator:true,}).addChild("insert_insert_cell_shift_down",["insert"],{name:_lt("Insert cells and shift down"),sequence:43,action:INSERT_CELL_SHIFT_DOWN,}).addChild("insert_insert_cell_shift_right",["insert"],{name:_lt("Insert cells and shift right"),sequence:47,action:INSERT_CELL_SHIFT_RIGHT,separator:true,}).addChild("insert_chart",["insert"],{name:_lt("Chart"),sequence:50,action:CREATE_CHART,}).addChild("insert_link",["insert"],{name:_lt("Link"),separator:true,sequence:60,action:INSERT_LINK,}).addChild("insert_sheet",["insert"],{name:_lt("New sheet"),sequence:70,action:CREATE_SHEET_ACTION,separator:true,}).addChild("view_gridlines",["view"],{name:(env)=>env.getters.getGridLinesVisibility(env.getters.getActiveSheetId())?_lt("Hide gridlines"):_lt("Show gridlines"),action:SET_GRID_LINES_VISIBILITY_ACTION,sequence:5,separator:true,}).addChild("view_formulas",["view"],{name:(env)=>env.getters.shouldShowFormulas()?_lt("Hide formulas"):_lt("Show formulas"),action:SET_FORMULA_VISIBILITY_ACTION,isReadonlyAllowed:true,sequence:10,}).addChild("format_number",["format"],{name:_lt("Numbers"),sequence:10,separator:true,}).addChild("format_number_general",["format","format_number"],{name:_lt("General"),sequence:10,separator:true,action:FORMAT_GENERAL_ACTION,}).addChild("format_number_number",["format","format_number"],{name:_lt("Number (1,000.12)"),sequence:20,action:FORMAT_NUMBER_ACTION,}).addChild("format_number_percent",["format","format_number"],{name:_lt("Percent (10.12%)"),sequence:30,separator:true,action:FORMAT_PERCENT_ACTION,}).addChild("format_number_date",["format","format_number"],{name:_lt("Date (9/26/2008)"),sequence:40,action:FORMAT_DATE_ACTION,}).addChild("format_number_time",["format","format_number"],{name:_lt("Time (10:43:00 PM)"),sequence:50,action:FORMAT_TIME_ACTION,}).addChild("format_number_date_time",["format","format_number"],{name:_lt("Date time (9/26/2008 22:43:00)"),sequence:60,action:FORMAT_DATE_TIME_ACTION,}).addChild("format_number_duration",["format","format_number"],{name:_lt("Duration (27:51:38)"),sequence:70,separator:true,action:FORMAT_DURATION_ACTION,}).addChild("format_bold",["format"],{name:_lt("Bold"),sequence:20,shortCut:"Ctrl+B",action:FORMAT_BOLD_ACTION,}).addChild("format_italic",["format"],{name:_lt("Italic"),sequence:30,shortCut:"Ctrl+I",action:FORMAT_ITALIC_ACTION,}).addChild("format_underline",["format"],{name:_lt("Underline"),shortCut:"Ctrl+U",sequence:40,action:FORMAT_UNDERLINE_ACTION,}).addChild("format_strikethrough",["format"],{name:_lt("Strikethrough"),sequence:50,action:FORMAT_STRIKETHROUGH_ACTION,separator:true,}).addChild("format_font_size",["format"],{name:_lt("Font size"),sequence:60,separator:true,}).addChild("format_cf",["format"],{name:_lt("Conditional formatting"),sequence:70,action:OPEN_CF_SIDEPANEL_ACTION,separator:true,});for(let fs of fontSizes){topbarMenuRegistry.addChild(`format_font_size_${fs.pt}`,["format","format_font_size"],{name:fs.pt.toString(),sequence:fs.pt,action:(env)=>setStyle(env,{fontSize:fs.pt}),});}
class OTRegistry extends Registry{addTransformation(executed,toTransforms,fn){for(let toTransform of toTransforms){if(!this.content[toTransform]){this.content[toTransform]=new Map();}
this.content[toTransform].set(executed,fn);}
return this;}
getTransformation(toTransform,executed){return this.content[toTransform]&&this.content[toTransform].get(executed);}}
const otRegistry=new OTRegistry();const{Component:Component$r}=owl__namespace;const{css:css$s,xml:xml$u}=owl__namespace.tags;const COLORS=[["#000000","#434343","#666666","#999999","#b7b7b7","#cccccc","#d9d9d9","#efefef","#f3f3f3","#ffffff",],["#980000","#ff0000","#ff9900","#ffff00","#00ff00","#00ffff","#4a86e8","#0000ff","#9900ff","#ff00ff",],["#e6b8af","#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#c9daf8","#cfe2f3","#d9d2e9","#ead1dc",],["#dd7e6b","#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#a4c2f4","#9fc5e8","#b4a7d6","#d5a6bd",],["#cc4125","#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6d9eeb","#6fa8dc","#8e7cc3","#c27ba0",],["#a61c00","#cc0000","#e69138","#f1c232","#6aa84f","#45818e","#3c78d8","#3d85c6","#674ea7","#a64d79",],["#85200c","#990000","#b45f06","#bf9000","#38761d","#134f5c","#1155cc","#0b5394","#351c75","#741b47",],["#5b0f00","#660000","#783f04","#7f6000","#274e13","#0c343d","#1c4587","#073763","#20124d","#4c1130",],];const PICKER_VERTICAL_PADDING=6;const LINE_VERTICAL_PADDING=3;const LINE_HORIZONTAL_PADDING=6;const ITEM_HORIZONTAL_MARGIN=2;const ITEM_EDGE_LENGTH=18;const ITEM_BORDER_WIDTH=1;const ITEMS_PER_LINE=Math.max(...COLORS.map((line)=>line.length));const PICKER_WIDTH=ITEMS_PER_LINE*(ITEM_EDGE_LENGTH+ITEM_HORIZONTAL_MARGIN*2+2*ITEM_BORDER_WIDTH)+
2*LINE_HORIZONTAL_PADDING;class ColorPicker extends Component$r{constructor(){super(...arguments);this.COLORS=COLORS;}
onColorClick(ev){const color=ev.target.dataset.color;if(color){this.trigger("color-picked",{color});}}}
ColorPicker.template=xml$u`
  <div class="o-color-picker"
    t-att-class="props.dropdownDirection || 'right'"
    t-on-click="onColorClick">
    <div class="o-color-picker-line" t-foreach="COLORS" t-as="colors" t-key="colors">
      <t t-foreach="colors" t-as="color" t-key="color">
        <div class="o-color-picker-line-item" t-att-data-color="color" t-attf-style="background-color:{{color}};"></div>
      </t>
    </div>
  </div>`;ColorPicker.style=css$s`
    .o-color-picker {
      position: absolute;
      top: calc(100% + 5px);
      z-index: 10;
      box-shadow: 1px 2px 5px 2px rgba(51, 51, 51, 0.15);
      background-color: white;
      padding: ${PICKER_VERTICAL_PADDING}px 0px;

      .o-color-picker-line {
        display: flex;
        padding: ${LINE_VERTICAL_PADDING}px ${LINE_HORIZONTAL_PADDING}px;
        .o-color-picker-line-item {
          width: ${ITEM_EDGE_LENGTH}px;
          height: ${ITEM_EDGE_LENGTH}px;
          margin: 0px ${ITEM_HORIZONTAL_MARGIN}px;
          border-radius: 50px;
          border: ${ITEM_BORDER_WIDTH}px solid #c0c0c0;
          &:hover {
            cursor: pointer;
            background-color: rgba(0, 0, 0, 0.08);
            outline: 1px solid gray;
          }
        }
      }

      &.right {
        left: 0;
      }

      &.left {
        right: 0;
      }
      &.center {
        left: calc(50% - ${PICKER_WIDTH / 2}px);
      }
    }
  `;const UNDO_ICON=`<svg class="o-icon"><path fill="#000000" d="M11.5656391,4.43436088 L9,7 L16,7 L16,0 L13.0418424,2.95815758 C11.5936787,1.73635959 9.72260775,1 7.67955083,1 C4.22126258,1 1.25575599,3.10984908 0,6 L2,7 C2.93658775,4.60974406 5.12943697,3.08011229 7.67955083,3 C9.14881247,3.0528747 10.4994783,3.57862053 11.5656391,4.43436088 Z" transform="matrix(-1 0 0 1 17 5)"/></svg>`;const REDO_ICON=`<svg class="o-icon"><path fill="#000000" d="M11.5656391,4.43436088 L9,7 L16,7 L16,0 L13.0418424,2.95815758 C11.5936787,1.73635959 9.72260775,1 7.67955083,1 C4.22126258,1 1.25575599,3.10984908 0,6 L2,7 C2.93658775,4.60974406 5.12943697,3.08011229 7.67955083,3 C9.14881247,3.0528747 10.4994783,3.57862053 11.5656391,4.43436088 Z" transform="translate(1 5)"/></svg>`;const PAINT_FORMAT_ICON=`<svg class="o-icon"><path fill="#000000" d="M9,0 L1,0 C0.45,0 0,0.45 0,1 L0,4 C0,4.55 0.45,5 1,5 L9,5 C9.55,5 10,4.55 10,4 L10,3 L11,3 L11,6 L4,6 L4,14 L6,14 L6,8 L13,8 L13,2 L10,2 L10,1 C10,0.45 9.55,0 9,0 Z" transform="translate(3 2)"/></svg>`;const CLEAR_FORMAT_ICON=`<svg class="o-icon"><path fill="#000000" d="M0.27,1.55 L5.43,6.7 L3,12 L5.5,12 L7.14,8.42 L11.73,13 L13,11.73 L1.55,0.27 L0.27,1.55 L0.27,1.55 Z M3.82,0 L5.82,2 L7.58,2 L7.03,3.21 L8.74,4.92 L10.08,2 L14,2 L14,0 L3.82,0 L3.82,0 Z" transform="translate(2 3)"/></svg>`;const TRIANGLE_DOWN_ICON=`<svg class="o-icon"><polygon fill="#000000" points="0 0 4 4 8 0" transform="translate(5 7)"/></svg>`;const TRIANGLE_UP_ICON=`<svg class="o-icon"><polygon fill="#000000" points="4 0 0 4 8 4" transform="translate(5 7)"/></svg>`;const TRIANGLE_RIGHT_ICON=`<svg class="o-icon"><polygon fill="#000000" points="0 0 4 4 0 8" transform="translate(5 5)"/></svg>`;const TRIANGLE_LEFT_ICON=`<svg class="o-icon"><polygon fill="#000000" points="4 0 0 4 4 8" transform="translate(5 5)"/></svg>`;const BOLD_ICON=`<svg class="o-icon"><path fill="#000000" fill-rule="evenodd" d="M9,3.5 C9,1.57 7.43,0 5.5,0 L1.77635684e-15,0 L1.77635684e-15,12 L6.25,12 C8.04,12 9.5,10.54 9.5,8.75 C9.5,7.45 8.73,6.34 7.63,5.82 C8.46,5.24 9,4.38 9,3.5 Z M5,2 C5.82999992,2 6.5,2.67 6.5,3.5 C6.5,4.33 5.82999992,5 5,5 L3,5 L3,2 L5,2 Z M3,10 L3,7 L5.5,7 C6.32999992,7 7,7.67 7,8.5 C7,9.33 6.32999992,10 5.5,10 L3,10 Z" transform="translate(4 3)"/></svg>`;const ITALIC_ICON=`<svg class="o-icon"><polygon fill="#000000" fill-rule="evenodd" points="4 0 4 2 6.58 2 2.92 10 0 10 0 12 8 12 8 10 5.42 10 9.08 2 12 2 12 0" transform="translate(3 3)"/></svg>`;const UNDERLINE_ICON=`<svg class="o-icon"><path fill="#000000" d="M6,12 C8.76,12 11,9.76 11,7 L11,0 L9,0 L9,7 C9,8.75029916 7.49912807,10 6,10 C4.50087193,10 3,8.75837486 3,7 L3,0 L1,0 L1,7 C1,9.76 3.24,12 6,12 Z M0,13 L0,15 L12,15 L12,13 L0,13 Z" transform="translate(3 3)"/></svg>`;const STRIKE_ICON=`<svg class="o-icon"><path fill="#010101" fill-rule="evenodd" d="M2.8875,3.06 C2.8875,2.6025 2.985,2.18625 3.18375,1.8075 C3.3825,1.42875 3.66,1.10625 4.02,0.84 C4.38,0.57375 4.80375,0.3675 5.29875,0.22125 C5.79375,0.075 6.33375,0 6.92625,0 C7.53375,0 8.085,0.0825 8.58,0.25125 C9.075,0.42 9.49875,0.6525 9.85125,0.95625 C10.20375,1.25625 10.47375,1.6125 10.665,2.02875 C10.85625,2.44125 10.95,2.895 10.95,3.38625 L8.6925,3.38625 C8.6925,3.1575 8.655,2.94375 8.58375,2.74875 C8.5125,2.55 8.4,2.38125 8.25,2.2425 C8.1,2.10375 7.9125,1.99125 7.6875,1.91625 C7.4625,1.8375 7.19625,1.8 6.88875,1.8 C6.5925,1.8 6.3375,1.83375 6.11625,1.8975 C5.89875,1.96125 5.71875,2.05125 5.57625,2.1675 C5.43375,2.28375 5.325,2.41875 5.25375,2.5725 C5.1825,2.72625 5.145,2.895 5.145,3.0675 C5.145,3.4275 5.32875,3.73125 5.69625,3.975 C5.71780203,3.98908066 5.73942012,4.00311728 5.76118357,4.01733315 C6.02342923,4.18863185 6.5,4.5 7,5 L4,5 C4,5 3.21375,4.37625 3.17625,4.30875 C2.985,3.9525 2.8875,3.53625 2.8875,3.06 Z M14,6 L0,6 L0,8 L7.21875,8 C7.35375,8.0525 7.51875,8.105 7.63125,8.15375 C7.90875,8.2775 8.12625,8.40875 8.28375,8.53625 C8.44125,8.6675 8.54625,8.81 8.6025,8.96 C8.65875,9.11375 8.685,9.28625 8.685,9.47375 C8.685,9.65 8.65125,9.815 8.58375,9.965 C8.51625,10.11875 8.41125,10.25 8.2725,10.35875 C8.13375,10.4675 7.95375,10.55375 7.74,10.6175 C7.5225,10.68125 7.27125,10.71125 6.97875,10.71125 C6.6525,10.71125 6.35625,10.6775 6.09,10.61375 C5.82375,10.55 5.59875,10.445 5.41125,10.3025 C5.22375,10.16 5.0775,9.9725 4.9725,9.74375 C4.8675,9.515 4.78125,9.17 4.78125,9 L2.55,9 C2.55,9.2525 2.61,9.6875 2.72625,10.025 C2.8425,10.3625 3.0075,10.66625 3.21375,10.9325 C3.42,11.19875 3.6675,11.4275 3.94875,11.6225 C4.23,11.8175 4.53375,11.9825 4.86375,12.11 C5.19375,12.24125 5.535,12.33875 5.89875,12.39875 C6.25875,12.4625 6.6225,12.4925 6.9825,12.4925 C7.5825,12.4925 8.13,12.425 8.6175,12.28625 C9.105,12.1475 9.525,11.94875 9.87,11.69375 C10.215,11.435 10.48125,11.12 10.6725,10.74125 C10.86375,10.3625 10.95375,9.935 10.95375,9.455 C10.95375,9.005 10.875,8.6 10.72125,8.24375 C10.68375,8.1575 10.6425,8.075 10.59375,7.9925 L14,8 L14,6 Z" transform="translate(2 3)"/></svg>`;const TEXT_COLOR_ICON=`<svg class="o-icon"><path fill="#000000" d="M7,0 L5,0 L0.5,12 L2.5,12 L3.62,9 L8.37,9 L9.49,12 L11.49,12 L7,0 L7,0 Z M4.38,7 L6,2.67 L7.62,7 L4.38,7 L4.38,7 Z" transform="translate(3 1)"/></svg>`;const FILL_COLOR_ICON=`<svg class="o-icon"><path fill="#000000" d="M14.5,8.87 C14.5,8.87 13,10.49 13,11.49 C13,12.32 13.67,12.99 14.5,12.99 C15.33,12.99 16,12.32 16,11.49 C16,10.5 14.5,8.87 14.5,8.87 L14.5,8.87 Z M12.71,6.79 L5.91,0 L4.85,1.06 L6.44,2.65 L2.29,6.79 C1.9,7.18 1.9,7.81 2.29,8.2 L6.79,12.7 C6.99,12.9 7.24,13 7.5,13 C7.76,13 8.01,12.9 8.21,12.71 L12.71,8.21 C13.1,7.82 13.1,7.18 12.71,6.79 L12.71,6.79 Z M4.21,7 L7.5,3.71 L10.79,7 L4.21,7 L4.21,7 Z"/></svg>`;const MERGE_CELL_ICON=`<svg class="o-icon"><path fill="#000000" d="M3,6 L1,6 L1,2 L8,2 L8,4 L3,4 L3,6 Z M10,4 L10,2 L17,2 L17,6 L15,6 L15,4 L10,4 Z M10,14 L15,14 L15,12 L17,12 L17,16 L10,16 L10,14 Z M1,12 L3,12 L3,14 L8,14 L8,16 L1,16 L1,12 Z M1,8 L5,8 L5,6 L8,9 L5,12 L5,10 L1,10 L1,8 Z M10,9 L13,6 L13,8 L17,8 L17,10 L13,10 L13,12 L10,9 Z"/></svg>`;const ALIGN_LEFT_ICON=`<svg class="o-icon"><path fill="#000000" d="M0,14 L10,14 L10,12 L0,12 L0,14 Z M10,4 L0,4 L0,6 L10,6 L10,4 Z M0,0 L0,2 L14,2 L14,0 L0,0 Z M0,10 L14,10 L14,8 L0,8 L0,10 Z" transform="translate(2 2)"/></svg>`;const ALIGN_CENTER_ICON=`<svg class="o-icon"><path fill="#000000" d="M2,12 L2,14 L12,14 L12,12 L2,12 Z M2,4 L2,6 L12,6 L12,4 L2,4 Z M0,10 L14,10 L14,8 L0,8 L0,10 Z M0,0 L0,2 L14,2 L14,0 L0,0 Z" transform="translate(2 2)"/></svg>`;const ALIGN_RIGHT_ICON=`<svg class="o-icon"><path fill="#000000" d="M4,14 L14,14 L14,12 L4,12 L4,14 Z M0,10 L14,10 L14,8 L0,8 L0,10 Z M0,0 L0,2 L14,2 L14,0 L0,0 Z M4,6 L14,6 L14,4 L4,4 L4,6 Z" transform="translate(2 2)"/></svg>`;const ALIGN_MIDDLE_ICON=`<svg class="o-icon"><path fill="#000000" d="M9.5,3 L7,3 L7,0 L5,0 L5,3 L2.5,3 L6,6.5 L9.5,3 L9.5,3 Z M0,8 L0,10 L12,10 L12,8 L0,8 L0,8 Z M2.5,15 L5,15 L5,18 L7,18 L7,15 L9.5,15 L6,11.5 L2.5,15 L2.5,15 Z" transform="translate(3)"/></svg>`;const TEXT_WRAPPING_ICON=`<svg class="o-icon"><path fill="#000000" d="M14,0 L0,0 L0,2 L14,2 L14,0 Z M0,12 L4,12 L4,10 L0,10 L0,12 Z M11.5,5 L0,5 L0,7 L11.75,7 C12.58,7 13.25,7.67 13.25,8.5 C13.25,9.33 12.58,10 11.75,10 L9,10 L9,8 L6,11 L9,14 L9,12 L11.5,12 C13.43,12 15,10.43 15,8.5 C15,6.57 13.43,5 11.5,5 Z" transform="translate(2 3)"/></svg>`;const BORDERS_ICON=`<svg class="o-icon"><path fill="#000000" d="M0,0 L0,14 L14,14 L14,0 L0,0 L0,0 Z M6,12 L2,12 L2,8 L6,8 L6,12 L6,12 Z M6,6 L2,6 L2,2 L6,2 L6,6 L6,6 Z M12,12 L8,12 L8,8 L12,8 L12,12 L12,12 Z M12,6 L8,6 L8,2 L12,2 L12,6 L12,6 Z" transform="translate(2 2)"/></svg>`;const BORDER_HV=`<svg class="o-icon"><g fill="#000000"><path d="M0,14 L2,14 L2,12 L0,12 L0,14 L0,14 Z M2,3 L0,3 L0,5 L2,5 L2,3 L2,3 Z M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M11,0 L9,0 L9,2 L11,2 L11,0 L11,0 Z M2,0 L0,0 L0,2 L2,2 L2,0 L2,0 Z M5,0 L3,0 L3,2 L5,2 L5,0 L5,0 Z M0,11 L2,11 L2,9 L0,9 L0,11 L0,11 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z M12,0 L12,2 L14,2 L14,0 L12,0 L12,0 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M12,14 L14,14 L14,12 L12,12 L12,14 L12,14 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z" opacity=".54"/><polygon points="8 0 6 0 6 6 0 6 0 8 6 8 6 14 8 14 8 8 14 8 14 6 8 6"/></g></svg>`;const BORDER_H=`<svg class="o-icon"><g fill="#000000"><path d="M6,14 L8,14 L8,12 L6,12 L6,14 L6,14 Z M3,2 L5,2 L5,0 L3,0 L3,2 L3,2 Z M6,11 L8,11 L8,9 L6,9 L6,11 L6,11 Z M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M0,5 L2,5 L2,3 L0,3 L0,5 L0,5 Z M0,14 L2,14 L2,12 L0,12 L0,14 L0,14 Z M0,2 L2,2 L2,0 L0,0 L0,2 L0,2 Z M0,11 L2,11 L2,9 L0,9 L0,11 L0,11 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z M12,14 L14,14 L14,12 L12,12 L12,14 L12,14 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M12,0 L12,2 L14,2 L14,0 L12,0 L12,0 Z M6,2 L8,2 L8,0 L6,0 L6,2 L6,2 Z M9,2 L11,2 L11,0 L9,0 L9,2 L9,2 Z M6,5 L8,5 L8,3 L6,3 L6,5 L6,5 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z" opacity=".54"/><polygon points="0 8 14 8 14 6 0 6"/></g></svg>`;const BORDER_V=`<svg class="o-icon"><g fill="#000000"><path d="M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M0,5 L2,5 L2,3 L0,3 L0,5 L0,5 Z M0,2 L2,2 L2,0 L0,0 L0,2 L0,2 Z M3,8 L5,8 L5,6 L3,6 L3,8 L3,8 Z M3,2 L5,2 L5,0 L3,0 L3,2 L3,2 Z M0,14 L2,14 L2,12 L0,12 L0,14 L0,14 Z M0,8 L2,8 L2,6 L0,6 L0,8 L0,8 Z M0,11 L2,11 L2,9 L0,9 L0,11 L0,11 Z M12,0 L12,2 L14,2 L14,0 L12,0 L12,0 Z M12,8 L14,8 L14,6 L12,6 L12,8 L12,8 Z M12,14 L14,14 L14,12 L12,12 L12,14 L12,14 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z M9,8 L11,8 L11,6 L9,6 L9,8 L9,8 Z M9,2 L11,2 L11,0 L9,0 L9,2 L9,2 Z" opacity=".54"/><polygon points="6 14 8 14 8 0 6 0"/></g></svg>`;const BORDER_EXTERNAL=`<svg class="o-icon"><g fill="#000000"><path d="M8,3 L6,3 L6,5 L8,5 L8,3 L8,3 Z M11,6 L9,6 L9,8 L11,8 L11,6 L11,6 Z M8,6 L6,6 L6,8 L8,8 L8,6 L8,6 Z M8,9 L6,9 L6,11 L8,11 L8,9 L8,9 Z M5,6 L3,6 L3,8 L5,8 L5,6 L5,6 Z" opacity=".54"/><path d="M0,0 L14,0 L14,14 L0,14 L0,0 Z M12,12 L12,2 L2,2 L2,12 L12,12 Z"/></g></svg>`;const BORDER_LEFT=`<svg class="o-icon"><g fill="#000000"><path d="M6,8 L8,8 L8,6 L6,6 L6,8 L6,8 Z M6,5 L8,5 L8,3 L6,3 L6,5 L6,5 Z M6,11 L8,11 L8,9 L6,9 L6,11 L6,11 Z M6,14 L8,14 L8,12 L6,12 L6,14 L6,14 Z M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M3,2 L5,2 L5,0 L3,0 L3,2 L3,2 Z M3,8 L5,8 L5,6 L3,6 L3,8 L3,8 Z M12,14 L14,14 L14,12 L12,12 L12,14 L12,14 Z M12,8 L14,8 L14,6 L12,6 L12,8 L12,8 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M6,2 L8,2 L8,0 L6,0 L6,2 L6,2 Z M12,0 L12,2 L14,2 L14,0 L12,0 L12,0 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z M9,8 L11,8 L11,6 L9,6 L9,8 L9,8 Z M9,2 L11,2 L11,0 L9,0 L9,2 L9,2 Z" opacity=".54"/><polygon points="0 14 2 14 2 0 0 0"/></g></svg>`;const BORDER_TOP=`<svg class="o-icon"><g fill="#000000"><path d="M3,8 L5,8 L5,6 L3,6 L3,8 L3,8 Z M0,14 L2,14 L2,12 L0,12 L0,14 L0,14 Z M6,14 L8,14 L8,12 L6,12 L6,14 L6,14 Z M6,11 L8,11 L8,9 L6,9 L6,11 L6,11 Z M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M0,11 L2,11 L2,9 L0,9 L0,11 L0,11 Z M6,8 L8,8 L8,6 L6,6 L6,8 L6,8 Z M0,5 L2,5 L2,3 L0,3 L0,5 L0,5 Z M0,8 L2,8 L2,6 L0,6 L0,8 L0,8 Z M12,8 L14,8 L14,6 L12,6 L12,8 L12,8 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M6,5 L8,5 L8,3 L6,3 L6,5 L6,5 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z M9,8 L11,8 L11,6 L9,6 L9,8 L9,8 Z M12,14 L14,14 L14,12 L12,12 L12,14 L12,14 Z" opacity=".54"/><polygon points="0 0 0 2 14 2 14 0"/></g></svg>`;const BORDER_RIGHT=`<svg class="o-icon"><g fill="#000000"><path d="M0,2 L2,2 L2,0 L0,0 L0,2 L0,2 Z M3,2 L5,2 L5,0 L3,0 L3,2 L3,2 Z M3,8 L5,8 L5,6 L3,6 L3,8 L3,8 Z M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M0,5 L2,5 L2,3 L0,3 L0,5 L0,5 Z M0,8 L2,8 L2,6 L0,6 L0,8 L0,8 Z M0,14 L2,14 L2,12 L0,12 L0,14 L0,14 Z M0,11 L2,11 L2,9 L0,9 L0,11 L0,11 Z M9,8 L11,8 L11,6 L9,6 L9,8 L9,8 Z M6,14 L8,14 L8,12 L6,12 L6,14 L6,14 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z M6,2 L8,2 L8,0 L6,0 L6,2 L6,2 Z M9,2 L11,2 L11,0 L9,0 L9,2 L9,2 Z M6,11 L8,11 L8,9 L6,9 L6,11 L6,11 Z M6,5 L8,5 L8,3 L6,3 L6,5 L6,5 Z M6,8 L8,8 L8,6 L6,6 L6,8 L6,8 Z" opacity=".54"/><polygon points="12 0 12 14 14 14 14 0"/></g></svg>`;const BORDER_BOTTOM=`<svg class="o-icon"><g fill="#000000"><path d="M5,0 L3,0 L3,2 L5,2 L5,0 L5,0 Z M8,6 L6,6 L6,8 L8,8 L8,6 L8,6 Z M8,9 L6,9 L6,11 L8,11 L8,9 L8,9 Z M11,6 L9,6 L9,8 L11,8 L11,6 L11,6 Z M5,6 L3,6 L3,8 L5,8 L5,6 L5,6 Z M11,0 L9,0 L9,2 L11,2 L11,0 L11,0 Z M8,3 L6,3 L6,5 L8,5 L8,3 L8,3 Z M8,0 L6,0 L6,2 L8,2 L8,0 L8,0 Z M2,9 L0,9 L0,11 L2,11 L2,9 L2,9 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M12,8 L14,8 L14,6 L12,6 L12,8 L12,8 Z M12,0 L12,2 L14,2 L14,0 L12,0 L12,0 Z M2,0 L0,0 L0,2 L2,2 L2,0 L2,0 Z M2,3 L0,3 L0,5 L2,5 L2,3 L2,3 Z M2,6 L0,6 L0,8 L2,8 L2,6 L2,6 Z" opacity=".54"/><polygon points="0 14 14 14 14 12 0 12"/></g></svg>`;const BORDER_CLEAR=`<svg class="o-icon"><path fill="#000000" fill-rule="evenodd" d="M6,14 L8,14 L8,12 L6,12 L6,14 L6,14 Z M3,8 L5,8 L5,6 L3,6 L3,8 L3,8 Z M3,2 L5,2 L5,0 L3,0 L3,2 L3,2 Z M6,11 L8,11 L8,9 L6,9 L6,11 L6,11 Z M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M0,5 L2,5 L2,3 L0,3 L0,5 L0,5 Z M0,14 L2,14 L2,12 L0,12 L0,14 L0,14 Z M0,2 L2,2 L2,0 L0,0 L0,2 L0,2 Z M0,8 L2,8 L2,6 L0,6 L0,8 L0,8 Z M6,8 L8,8 L8,6 L6,6 L6,8 L6,8 Z M0,11 L2,11 L2,9 L0,9 L0,11 L0,11 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z M12,14 L14,14 L14,12 L12,12 L12,14 L12,14 Z M12,8 L14,8 L14,6 L12,6 L12,8 L12,8 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M12,0 L12,2 L14,2 L14,0 L12,0 L12,0 Z M6,2 L8,2 L8,0 L6,0 L6,2 L6,2 Z M9,2 L11,2 L11,0 L9,0 L9,2 L9,2 Z M6,5 L8,5 L8,3 L6,3 L6,5 L6,5 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z M9,8 L11,8 L11,6 L9,6 L9,8 L9,8 Z" transform="translate(2 2)" opacity=".54"/></svg>`;const PLUS=`<svg class="o-icon"><path fill="#000000" d="M8,0 L10,0 L10,8 L18,8 L18,10 L10,10 L10,18 L8,18 L8,10 L0,10 L0,8 L8,8"/></svg>`;const LIST=`<svg class="o-icon" viewBox="0 0 384 384"><rect x="0" y="277.333" width="384" height="42.667"/><rect x="0" y="170.667" width="384" height="42.667"/><rect x="0" y="64" width="384" height="42.667"/></svg>`;const EDIT=`<svg class="o-icon" viewBox="0 0 576 512"><path fill="currentColor" d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"></path></svg>`;const UNLINK=`<svg class="o-icon" viewBox="0 0 512 512"><path fill="currentColor" d="M304.083 405.907c4.686 4.686 4.686 12.284 0 16.971l-44.674 44.674c-59.263 59.262-155.693 59.266-214.961 0-59.264-59.265-59.264-155.696 0-214.96l44.675-44.675c4.686-4.686 12.284-4.686 16.971 0l39.598 39.598c4.686 4.686 4.686 12.284 0 16.971l-44.675 44.674c-28.072 28.073-28.072 73.75 0 101.823 28.072 28.072 73.75 28.073 101.824 0l44.674-44.674c4.686-4.686 12.284-4.686 16.971 0l39.597 39.598zm-56.568-260.216c4.686 4.686 12.284 4.686 16.971 0l44.674-44.674c28.072-28.075 73.75-28.073 101.824 0 28.072 28.073 28.072 73.75 0 101.823l-44.675 44.674c-4.686 4.686-4.686 12.284 0 16.971l39.598 39.598c4.686 4.686 12.284 4.686 16.971 0l44.675-44.675c59.265-59.265 59.265-155.695 0-214.96-59.266-59.264-155.695-59.264-214.961 0l-44.674 44.674c-4.686 4.686-4.686 12.284 0 16.971l39.597 39.598zm234.828 359.28l22.627-22.627c9.373-9.373 9.373-24.569 0-33.941L63.598 7.029c-9.373-9.373-24.569-9.373-33.941 0L7.029 29.657c-9.373 9.373-9.373 24.569 0 33.941l441.373 441.373c9.373 9.372 24.569 9.372 33.941 0z"></path></svg>`;const TRASH='<svg xmlns ="http://www.w3.org/2000/svg" class="o-cf-icon trash" viewBox = "0 0 448 512" > <path fill="currentColor" d = "M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z" > </path></svg >';const REFRESH='<svg xmlns="http://www.w3.org/2000/svg" class="o-cf-icon refresh" viewBox="0 0 512 512"><path fill="currentColor" d="M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"></path></svg>';const ARROW_DOWN='<svg xmlns="http://www.w3.org/2000/svg" class="o-cf-icon arrow-down" width="10" height="10" focusable="false" viewBox="0 0 448 512"><path fill="#DC6965" d="M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z"></path></svg>';const ARROW_UP='<svg xmlns="http://www.w3.org/2000/svg" class="o-cf-icon arrow-up" width="10" height="10" focusable="false" viewBox="0 0 448 512"><path fill="#00A04A" d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></svg>';const ARROW_RIGHT='<svg xmlns="http://www.w3.org/2000/svg" class="o-cf-icon arrow-right" width="10" height="10" focusable="false" viewBox="0 0 448 512"><path fill="#F0AD4E" d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg>';const SMILE='<svg xmlns="http://www.w3.org/2000/svg" class="o-cf-icon smile" width="10" height="10" focusable="false" viewBox="0 0 496 512"><path fill="#00A04A" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm4 72.6c-20.8 25-51.5 39.4-84 39.4s-63.2-14.3-84-39.4c-8.5-10.2-23.7-11.5-33.8-3.1-10.2 8.5-11.5 23.6-3.1 33.8 30 36 74.1 56.6 120.9 56.6s90.9-20.6 120.9-56.6c8.5-10.2 7.1-25.3-3.1-33.8-10.1-8.4-25.3-7.1-33.8 3.1z"></path></svg>';const MEH='<svg xmlns="http://www.w3.org/2000/svg" class="o-cf-icon meh" width="10" height="10" focusable="false" viewBox="0 0 496 512"><path fill="#F0AD4E" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160-64c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32zm8 144H160c-13.2 0-24 10.8-24 24s10.8 24 24 24h176c13.2 0 24-10.8 24-24s-10.8-24-24-24z"></path></svg>';const FROWN='<svg xmlns="http://www.w3.org/2000/svg" class="o-cf-icon frown" width="10" height="10" focusable="false" viewBox="0 0 496 512"><path fill="#DC6965" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160-64c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32zm-80 128c-40.2 0-78 17.7-103.8 48.6-8.5 10.2-7.1 25.3 3.1 33.8 10.2 8.4 25.3 7.1 33.8-3.1 16.6-19.9 41-31.4 66.9-31.4s50.3 11.4 66.9 31.4c8.1 9.7 23.1 11.9 33.8 3.1 10.2-8.5 11.5-23.6 3.1-33.8C326 321.7 288.2 304 248 304z"></path></svg>';const GREEN_DOT='<svg xmlns="http://www.w3.org/2000/svg" class="o-cf-icon green-dot" width="10" height="10" focusable="false" viewBox="0 0 512 512"><path fill="#00A04A" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg>';const YELLOW_DOT='<svg xmlns="http://www.w3.org/2000/svg" class="o-cf-icon yellow-dot" width="10" height="10" focusable="false" viewBox="0 0 512 512"><path fill="#F0AD4E" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg>';const RED_DOT='<svg xmlns="http://www.w3.org/2000/svg" class="o-cf-icon red-dot" width="10" height="10" focusable="false" viewBox="0 0 512 512"><path fill="#DC6965" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg>';function loadIconImage(svg){const image=new Image();image.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(svg);return image;}
const ICONS={arrowGood:{img:loadIconImage(ARROW_UP),svg:ARROW_UP,},arrowNeutral:{img:loadIconImage(ARROW_RIGHT),svg:ARROW_RIGHT,},arrowBad:{img:loadIconImage(ARROW_DOWN),svg:ARROW_DOWN,},smileyGood:{img:loadIconImage(SMILE),svg:SMILE,},smileyNeutral:{img:loadIconImage(MEH),svg:MEH,},smileyBad:{img:loadIconImage(FROWN),svg:FROWN,},dotGood:{img:loadIconImage(GREEN_DOT),svg:GREEN_DOT,},dotNeutral:{img:loadIconImage(YELLOW_DOT),svg:YELLOW_DOT,},dotBad:{img:loadIconImage(RED_DOT),svg:RED_DOT,},};const ICON_SETS={arrows:{good:"arrowGood",neutral:"arrowNeutral",bad:"arrowBad",},smiley:{good:"smileyGood",neutral:"smileyNeutral",bad:"smileyBad",},dots:{good:"dotGood",neutral:"dotNeutral",bad:"dotBad",},};const{Component:Component$q,useState:useState$l}=owl__namespace;const{xml:xml$t,css:css$r}=owl__namespace.tags;const uuidGenerator$1=new UuidGenerator();const TEMPLATE$q=xml$t`
  <div class="o-selection">
    <div t-foreach="ranges" t-as="range" t-key="range.id" class="o-selection-input">
      <input
        type="text"
        spellcheck="false"
        t-on-change="onInputChanged(range.id)"
        t-on-focus="focus(range.id)"
        t-att-value="range.xc"
        t-att-style="getColor(range)"
        t-att-class="{
          'o-focused' : range.isFocused,
          'o-required': props.required,
          'o-invalid': isInvalid || !range.isValidRange,
        }"
      />
      <button
        class="o-btn o-remove-selection"
        t-if="ranges.length > 1"
        t-on-click="removeInput(range.id)">✖</button>
    </div>

    <div class="o-selection-input">
    </div>

    <div class="o-selection-input">
      <button
        class="o-btn-action o-add-selection"
        t-if="canAddRange"
        t-on-click="addEmptyInput">Add range</button>
      <button
          class="o-btn-action o-selection-ok"
          t-if="hasFocus"
          t-on-click="disable">Confirm</button>
    </div>

  </div>`;const CSS$n=css$r`
  .o-selection {
    .o-selection-input {
      display: flex;
      flex-direction: row;

      input {
        padding: 4px 6px;
        border-radius: 4px;
        box-sizing: border-box;
        border: 1px solid #dadce0;
        flex-grow: 2;
      }
      input:focus {
        outline: none;
      }
      input.o-required,
      input.o-focused {
        border-width: 2px;
        padding: 3px 5px;
      }
      input.o-focused {
        border-color: ${SELECTION_BORDER_COLOR};
      }
      input.o-invalid {
        border-color: red;
      }
      button.o-btn {
        background: transparent;
        border: none;
        color: #333;
        cursor: pointer;
      }
      button.o-btn-action {
        margin: 8px 1px;
        border-radius: 4px;
        background: transparent;
        border: 1px solid #dadce0;
        color: #188038;
        font-weight: bold;
        font-size: 14px;
        height: 25px;
      }
    }
  }
`;class SelectionInput extends Component$q{constructor(){super(...arguments);this.id=uuidGenerator$1.uuidv4();this.previousRanges=this.props.ranges||[];this.getters=this.env.getters;this.dispatch=this.env.dispatch;this.originSheet=this.env.getters.getActiveSheetId();this.state=useState$l({isMissing:false,});}
get ranges(){const existingSelectionRange=this.getters.getSelectionInput(this.id);const ranges=existingSelectionRange.length?existingSelectionRange:this.props.ranges?this.props.ranges.map((xc,i)=>({xc,id:i.toString(),isFocused:false,})):[];return ranges.map((range)=>({...range,isValidRange:range.xc===""||this.getters.isRangeValid(range.xc),}));}
get hasFocus(){return this.ranges.filter((i)=>i.isFocused).length>0;}
get canAddRange(){return!this.props.hasSingleRange;}
get isInvalid(){return this.props.isInvalid||this.state.isMissing;}
mounted(){this.dispatch("ENABLE_NEW_SELECTION_INPUT",{id:this.id,initialRanges:this.props.ranges,hasSingleRange:this.props.hasSingleRange,});}
async willUnmount(){this.dispatch("DISABLE_SELECTION_INPUT",{id:this.id});}
async patched(){const value=this.getters.getSelectionInputValue(this.id);if(this.previousRanges.join()!==value.join()){this.triggerChange();}}
getColor(range){const color=range.color||"#000";return"color: "+color+";";}
triggerChange(){const ranges=this.getters.getSelectionInputValue(this.id);this.trigger("selection-changed",{ranges});this.previousRanges=ranges;}
focus(rangeId){this.state.isMissing=false;this.dispatch("STOP_EDITION",{cancel:true});this.dispatch("FOCUS_RANGE",{id:this.id,rangeId,});}
addEmptyInput(){this.dispatch("ADD_EMPTY_RANGE",{id:this.id});}
removeInput(rangeId){this.dispatch("REMOVE_RANGE",{id:this.id,rangeId});this.triggerChange();this.trigger("selection-confirmed");}
onInputChanged(rangeId,ev){const target=ev.target;this.dispatch("CHANGE_RANGE",{id:this.id,rangeId,value:target.value,});target.blur();this.triggerChange();}
disable(){this.dispatch("UNFOCUS_SELECTION_INPUT");const ranges=this.getters.getSelectionInputValue(this.id);if(this.props.required&&ranges.length===0){this.state.isMissing=true;}
const activeSheetId=this.getters.getActiveSheetId();if(this.originSheet!==activeSheetId){this.dispatch("ACTIVATE_SHEET",{sheetIdFrom:activeSheetId,sheetIdTo:this.originSheet,});}
this.trigger("selection-confirmed");}}
SelectionInput.template=TEMPLATE$q;SelectionInput.style=CSS$n;const conditionalFormattingTerms={CF_TITLE:_lt("Format rules"),IS_RULE:_lt("Format cells if..."),FORMATTING_STYLE:_lt("Formatting style"),BOLD:_lt("Bold"),ITALIC:_lt("Italic"),UNDERLINE:_lt("Underline"),STRIKE_THROUGH:_lt("Strikethrough"),TEXT_COLOR:_lt("Text Color"),FILL_COLOR:_lt("Fill Color"),CANCEL:_lt("Cancel"),SAVE:_lt("Save"),PREVIEW_TEXT:_lt("Preview text"),Errors:{[20]:_lt("The range is invalid"),[34]:_lt("The argument is missing. Please provide a value"),[35]:_lt("The second argument is missing. Please provide a value"),[36]:_lt("The minpoint must be a number"),[37]:_lt("The midpoint must be a number"),[38]:_lt("The maxpoint must be a number"),[39]:_lt("The first value must be a number"),[40]:_lt("The second value must be a number"),[30]:_lt("Minimum must be smaller then Maximum"),[33]:_lt("Minimum must be smaller then Midpoint"),[32]:_lt("Midpoint must be smaller then Maximum"),[31]:_lt("Lower inflection point must be smaller then upper inflection point"),[41]:_lt("Invalid Minpoint formula"),[43]:_lt("Invalid Maxpoint formula"),[42]:_lt("Invalid Midpoint formula"),[44]:_lt("Invalid upper inflection point formula"),[45]:_lt("Invalid lower inflection point formula"),[19]:_lt("A range needs to be defined"),unexpected:_lt("The rule is invalid for an unknown reason"),},SingleColor:_lt("Single color"),ColorScale:_lt("Color scale"),IconSet:_lt("Icon set"),newRule:_lt("Add another rule"),FixedNumber:_lt("Number"),Percentage:_lt("Percentage"),Percentile:_lt("Percentile"),Formula:_lt("Formula"),};const colorScale={CellValues:_lt("Cell values"),None:_lt("None"),Preview:_lt("Preview"),Minpoint:_lt("Minpoint"),MaxPoint:_lt("Maxpoint"),MidPoint:_lt("Midpoint"),};const iconSetRule={WhenValueIs:_lt("When value is"),Else:_lt("Else"),ReverseIcons:_lt("Reverse icons"),Icons:_lt("Icons"),Type:_lt("Type"),Value:_lt("Value"),};const cellIsOperators={IsEmpty:_lt("Is empty"),IsNotEmpty:_lt("Is not empty"),ContainsText:_lt("Contains"),NotContains:_lt("Does not contain"),BeginsWith:_lt("Starts with"),EndsWith:_lt("Ends with"),Equal:_lt("Is equal to"),NotEqual:_lt("Is not equal to"),GreaterThan:_lt("Is greater than"),GreaterThanOrEqual:_lt("Is greater than or equal to"),LessThan:_lt("Is less than"),LessThanOrEqual:_lt("Is less than or equal to"),Between:_lt("Is between"),NotBetween:_lt("Is not between"),};const chartTerms={ChartType:_lt("Chart type"),Line:_lt("Line"),Bar:_lt("Bar"),Pie:_lt("Pie"),StackedBar:_lt("Stacked barchart"),Title:_lt("Title"),Series:_lt("Series"),DataSeries:_lt("Data Series"),MyDataHasTitle:_lt("Data series include title"),DataCategories:_lt("Categories / Labels"),UpdateChart:_lt("Update chart"),CreateChart:_lt("Create chart"),TitlePlaceholder:_lt("New Chart"),BackgroundColor:_lt("Background color"),SelectColor:_lt("Select a color..."),VerticalAxisPosition:_lt("Vertical axis position"),LegendPosition:_lt("Legend position"),Left:_lt("Left"),Right:_lt("Right"),None:_lt("None"),Top:_lt("Top"),Bottom:_lt("Bottom"),Center:_lt("Center"),Linear:_lt("Linear"),Exponential:_lt("Exponential"),Logarithmic:_lt("Logarithmic"),Errors:{[25]:_lt("A dataset needs to be defined"),[26]:_lt("The dataset is invalid"),[27]:_lt("Labels are invalid"),unexpected:_lt("The chart definition is invalid for an unknown reason"),},};const FindAndReplaceTerms={Search:_lt("Search"),Replace:_lt("Replace"),Next:_lt("Next"),Previous:_lt("Previous"),MatchCase:_lt("Match case"),ExactMatch:_lt("Match entire cell content"),SearchFormulas:_lt("Search in formulas"),ReplaceAll:_lt("Replace all"),ReplaceFormulas:_lt("Also modify formulas"),};const LinkEditorTerms={Text:_lt("Text"),Link:_lt("Link"),Confirm:_lt("Confirm"),Cancel:_lt("Cancel"),Edit:_lt("Edit link"),Remove:_lt("Remove link"),};const GenericWords={And:_lt("and"),};const{Component:Component$p,useState:useState$k}=owl__namespace;const{xml:xml$s,css:css$q}=owl__namespace.tags;const CONFIGURATION_TEMPLATE=xml$s`
<div>
  <div class="o-section">
    <div class="o-section-title" t-esc="env._t('${chartTerms.ChartType}')"/>
    <select t-model="state.chart.type" class="o-input o-type-selector" t-on-change="updateSelect('type')">
      <option value="bar" t-esc="env._t('${chartTerms.Bar}')"/>
      <option value="line" t-esc="env._t('${chartTerms.Line}')"/>
      <option value="pie" t-esc="env._t('${chartTerms.Pie}')"/>
    </select>
    <t t-if="state.chart.type === 'bar'">
      <div class="o_checkbox">
        <input type="checkbox" name="stackedBar" t-model="state.chart.stackedBar" t-on-change="updateStacked"/>
        <t t-esc="env._t('${chartTerms.StackedBar}')"/>
      </div>
    </t>
  </div>
  <div class="o-section o-data-series">
    <div class="o-section-title" t-esc="env._t('${chartTerms.DataSeries}')"/>
    <SelectionInput t-key="getKey('dataSets')"
                    ranges="state.chart.dataSets"
                    isInvalid="isDatasetInvalid"
                    required="true"
                    t-on-selection-changed="onSeriesChanged"
                    t-on-selection-confirmed="updateDataSet" />
    <input type="checkbox" t-model="state.chart.dataSetsHaveTitle" t-on-change="updateDataSet"/><t t-esc="env._t('${chartTerms.MyDataHasTitle}')"/>
  </div>
  <div class="o-section o-data-labels">
    <div class="o-section-title" t-esc="env._t('${chartTerms.DataCategories}')"/>
    <SelectionInput t-key="getKey('label')"
                    ranges="[state.chart.labelRange || '']"
                    isInvalid="isLabelInvalid"
                    hasSingleRange="true"
                    t-on-selection-changed="onLabelRangeChanged"
                    t-on-selection-confirmed="updateLabelRange" />
  </div>
  <div class="o-section o-sidepanel-error" t-if="errorMessages">
    <div t-foreach="errorMessages" t-as="error">
      <t t-esc="error"/>
    </div>
  </div>
</div>
`;const DESIGN_TEMPLATE=xml$s`
<div>
  <div class="o-section o-chart-title">
    <div class="o-section-title" t-esc="env._t('${chartTerms.BackgroundColor}')"/>
    <div class="o-with-color-picker">
      <t t-esc="env._t('${chartTerms.SelectColor}')"/>
      <span t-attf-style="border-color:{{state.chart.background}}"
            t-on-click.stop="toggleColorPicker">${FILL_COLOR_ICON}</span>
      <ColorPicker t-if="state.fillColorTool" t-on-color-picked="setColor" t-key="backgroundColor"/>
    </div>
  </div>
  <div class="o-section o-chart-title">
    <div class="o-section-title" t-esc="env._t('${chartTerms.Title}')"/>
    <input type="text" t-model="state.chart.title" t-on-change="updateTitle" class="o-input" t-att-placeholder="env._t('${chartTerms.TitlePlaceholder}')"/>
  </div>
  <div class="o-section">
    <div class="o-section-title"><t t-esc="env._t('${chartTerms.VerticalAxisPosition}')"/></div>
    <select t-model="state.chart.verticalAxisPosition" class="o-input o-type-selector" t-on-change="updateSelect('verticalAxisPosition')">
      <option value="left" t-esc="env._t('${chartTerms.Left}')"/>
      <option value="right" t-esc="env._t('${chartTerms.Right}')"/>
    </select>
  </div>
  <div class="o-section">
    <div class="o-section-title"><t t-esc="env._t('${chartTerms.LegendPosition}')"/></div>
    <select t-model="state.chart.legendPosition" class="o-input o-type-selector" t-on-change="updateSelect('legendPosition')">
      <option value="top" t-esc="env._t('${chartTerms.Top}')"/>
      <option value="bottom" t-esc="env._t('${chartTerms.Bottom}')"/>
      <option value="left" t-esc="env._t('${chartTerms.Left}')"/>
      <option value="right" t-esc="env._t('${chartTerms.Right}')"/>
    </select>
  </div>
</div>
`;const TEMPLATE$p=xml$s`
  <div class="o-chart">
    <div class="o-panel">
      <div class="o-panel-element"
          t-att-class="state.panel !== 'configuration' ? 'inactive' : ''"
          t-on-click="activate('configuration')">
        <i class="fa fa-sliders"/>Configuration
      </div>
      <div class="o-panel-element"
          t-att-class="state.panel !== 'design' ? 'inactive' : ''"
          t-on-click="activate('design')">
        <i class="fa fa-paint-brush"/>Design
      </div>
    </div>

    <t t-if="state.panel === 'configuration'">
      <t t-call="${CONFIGURATION_TEMPLATE}"/>
    </t>
    <t t-else="">
      <t t-call="${DESIGN_TEMPLATE}"/>
    </t>
  </div>
`;const STYLE=css$q`
  .o-chart {
    .o-panel {
      display: flex;
      .o-panel-element {
        flex: 1 0 auto;
        padding: 8px 0px;
        text-align: center;
        cursor: pointer;
        border-right: 1px solid darkgray;
        &.inactive {
          background-color: ${BACKGROUND_HEADER_COLOR};
          border-bottom: 1px solid darkgray;
        }
        .fa {
          margin-right: 4px;
        }
      }
      .o-panel-element:last-child {
        border-right: none;
      }
    }

    .o-with-color-picker {
      position: relative;
    }
    .o-with-color-picker > span {
      border-bottom: 4px solid;
    }
  }
`;class ChartPanel extends Component$p{constructor(){super(...arguments);this.getters=this.env.getters;this.state=useState$k(this.initialState(this.props.figure));}
async willUpdateProps(nextProps){if(!this.getters.getChartDefinition(nextProps.figure.id)){this.trigger("close-side-panel");return;}
if(nextProps.figure.id!==this.props.figure.id){this.state.panel="configuration";this.state.fillColorTool=false;this.state.datasetDispatchResult=undefined;this.state.labelsDispatchResult=undefined;this.state.chart=this.env.getters.getChartDefinitionUI(this.env.getters.getActiveSheetId(),nextProps.figure.id);}}
get errorMessages(){var _a,_b;const cancelledReasons=[...(((_a=this.state.datasetDispatchResult)===null||_a===void 0?void 0:_a.reasons)||[]),...(((_b=this.state.labelsDispatchResult)===null||_b===void 0?void 0:_b.reasons)||[]),];return cancelledReasons.map((error)=>this.env._t(chartTerms.Errors[error]||chartTerms.Errors.unexpected));}
get isDatasetInvalid(){var _a,_b;return!!(((_a=this.state.datasetDispatchResult)===null||_a===void 0?void 0:_a.isCancelledBecause(25))||((_b=this.state.datasetDispatchResult)===null||_b===void 0?void 0:_b.isCancelledBecause(26)));}
get isLabelInvalid(){var _a;return!!((_a=this.state.labelsDispatchResult)===null||_a===void 0?void 0:_a.isCancelledBecause(27));}
onSeriesChanged(ev){this.state.chart.dataSets=ev.detail.ranges;}
updateDataSet(){this.state.datasetDispatchResult=this.updateChart({dataSets:this.state.chart.dataSets,dataSetsHaveTitle:this.state.chart.dataSetsHaveTitle,});}
updateStacked(){this.updateChart({stackedBar:this.state.chart.stackedBar});}
updateTitle(){this.updateChart({title:this.state.chart.title});}
updateSelect(attr,ev){this.state.chart[attr]=ev.target.value;this.updateChart({[attr]:ev.target.value});}
updateLabelRange(){this.state.labelsDispatchResult=this.updateChart({labelRange:this.state.chart.labelRange||null,});}
updateChart(definition){return this.env.dispatch("UPDATE_CHART",{id:this.props.figure.id,definition,});}
onLabelRangeChanged(ev){this.state.chart.labelRange=ev.detail.ranges[0];}
getKey(label){return label+this.props.figure.id;}
toggleColorPicker(){this.state.fillColorTool=!this.state.fillColorTool;}
setColor(ev){this.state.chart.background=ev.detail.color;this.state.fillColorTool=false;this.updateChart({background:this.state.chart.background});}
activate(panel){this.state.panel=panel;}
initialState(figure){return{chart:this.env.getters.getChartDefinitionUI(this.env.getters.getActiveSheetId(),figure.id),panel:"configuration",fillColorTool:false,};}}
ChartPanel.template=TEMPLATE$p;ChartPanel.style=STYLE;ChartPanel.components={SelectionInput,ColorPicker};function isChildEvent(parent,ev){return!!ev.target&&parent.contains(ev.target);}
function getTextDecoration({strikethrough,underline,}){if(!strikethrough&&!underline){return"none";}
return`${strikethrough ? "line-through" : ""} ${underline ? "underline" : ""}`;}
const{Component:Component$o,useState:useState$j,hooks:hooks$4}=owl__namespace;const{useExternalListener:useExternalListener$5}=hooks$4;const{xml:xml$r,css:css$p}=owl__namespace.tags;const PREVIEW_TEMPLATE$2=xml$r`
    <div class="o-cf-preview-line"
         t-attf-style="font-weight:{{currentStyle.bold ?'bold':'normal'}};
                       text-decoration:{{getTextDecoration(currentStyle)}};
                       font-style:{{currentStyle.italic?'italic':'normal'}};
                       color:{{currentStyle.textColor}};
                       border-radius: 4px;
                       background-color:{{currentStyle.fillColor}};"
         t-esc="previewText || env._t('${conditionalFormattingTerms.PREVIEW_TEXT}')" />
`;const TEMPLATE$o=xml$r`
<div>
    <div class="o-cf-title-text" t-esc="env._t('${conditionalFormattingTerms.IS_RULE}')"></div>
    <select t-model="state.condition.operator" class="o-input o-cell-is-operator">
        <t t-foreach="Object.keys(cellIsOperators)" t-as="op" t-key="op_index">
            <option t-att-value="op" t-esc="cellIsOperators[op]"/>
        </t>
    </select>
    <t t-if="state.condition.operator !== 'IsEmpty' and state.condition.operator !== 'IsNotEmpty'">
      <input type="text"
             placeholder="Value"
             t-model="state.condition.value1"
             t-att-class="{ 'o-invalid': isValue1Invalid }"
             class="o-input o-cell-is-value o-required"/>
      <t t-if="state.condition.operator === 'Between' || state.condition.operator === 'NotBetween'">
          <input type="text"
                 placeholder="and value"
                 t-model="state.condition.value2"
                 t-att-class="{ 'o-invalid': isValue2Invalid }"
                 class="o-input o-cell-is-value o-required"/>
      </t>
    </t>
    <div class="o-cf-title-text" t-esc="env._t('${conditionalFormattingTerms.FORMATTING_STYLE}')"></div>

    <t t-call="${PREVIEW_TEMPLATE$2}">
        <t t-set="currentStyle" t-value="state.style"/>
    </t>
    <div class="o-tools">
        <div class="o-tool" t-att-title="env._t('${conditionalFormattingTerms.BOLD}')" t-att-class="{active:state.style.bold}" t-on-click="toggleTool('bold')">
            ${BOLD_ICON}
        </div>
        <div class="o-tool" t-att-title="env._t('${conditionalFormattingTerms.ITALIC}')" t-att-class="{active:state.style.italic}" t-on-click="toggleTool('italic')">
            ${ITALIC_ICON}
        </div>
        <div class="o-tool" t-att-title="env._t('${conditionalFormattingTerms.UNDERLINE}')" t-att-class="{active:state.style.underline}"
             t-on-click="toggleTool('underline')">${UNDERLINE_ICON}
        </div>
        <div class="o-tool" t-att-title="env._t('${conditionalFormattingTerms.STRIKE_THROUGH}')" t-att-class="{active:state.style.strikethrough}"
             t-on-click="toggleTool('strikethrough')">${STRIKE_ICON}
        </div>
        <div class="o-tool o-dropdown o-with-color">
              <span t-att-title="env._t('${conditionalFormattingTerms.TEXT_COLOR}')" t-attf-style="border-color:{{state.style.textColor}}"
                    t-on-click.stop="toggleMenu('textColorTool')">
                    ${TEXT_COLOR_ICON}
              </span>
              <ColorPicker t-if="state.textColorTool" dropdownDirection="'center'" t-on-color-picked="setColor('textColor')" t-key="textColor"/>
        </div>
        <div class="o-divider"/>
        <div class="o-tool o-dropdown o-with-color">
          <span t-att-title="env._t('${conditionalFormattingTerms.FILL_COLOR}')" t-attf-style="border-color:{{state.style.fillColor}}"
                t-on-click.stop="toggleMenu('fillColorTool')">
                ${FILL_COLOR_ICON}
          </span>
          <ColorPicker t-if="state.fillColorTool" dropdownDirection="'center'" t-on-color-picked="setColor('fillColor')" t-key="fillColor"/>
        </div>
    </div>
</div>
`;const CSS$m=css$p`
  .o-cf-preview-line {
    border: 1px solid darkgrey;
    padding: 10px;
  }
  .o-cell-is-operator {
    margin-bottom: 5px;
    width: 96%;
  }
  .o-cell-is-value {
    margin-bottom: 5px;
    width: 96%;
  }
  .o-color-picker {
    pointer-events: all;
  }
`;class CellIsRuleEditor extends Component$o{constructor(){super(...arguments);this.cellIsOperators=cellIsOperators;this.getTextDecoration=getTextDecoration;this.state=useState$j({condition:{operator:this.props.rule&&this.props.rule.operator?this.props.rule.operator:"IsNotEmpty",value1:this.props.rule&&this.props.rule.values.length>0?this.props.rule.values[0]:"",value2:this.props.rule.values.length>1?this.props.rule.values[1]:"",},textColorTool:false,fillColorTool:false,style:{fillColor:this.props.rule.style.fillColor,textColor:this.props.rule.style.textColor,bold:this.props.rule.style.bold,italic:this.props.rule.style.italic,strikethrough:this.props.rule.style.strikethrough,underline:this.props.rule.style.underline,},});useExternalListener$5(window,"click",this.closeMenus);}
get isValue1Invalid(){var _a;return!!((_a=this.props.errors)===null||_a===void 0?void 0:_a.includes(34));}
get isValue2Invalid(){var _a;return!!((_a=this.props.errors)===null||_a===void 0?void 0:_a.includes(35));}
getRule(){const newStyle={};const style=this.state.style;if(style.bold!==undefined){newStyle.bold=style.bold;}
if(style.italic!==undefined){newStyle.italic=style.italic;}
if(style.strikethrough!==undefined){newStyle.strikethrough=style.strikethrough;}
if(style.underline!==undefined){newStyle.underline=style.underline;}
if(style.fillColor){newStyle.fillColor=style.fillColor;}
if(style.textColor){newStyle.textColor=style.textColor;}
return{type:"CellIsRule",operator:this.state.condition.operator,values:[this.state.condition.value1,this.state.condition.value2],style:newStyle,};}
toggleMenu(tool){const current=this.state[tool];this.closeMenus();this.state[tool]=!current;}
toggleTool(tool){this.state.style[tool]=!this.state.style[tool];this.closeMenus();}
setColor(target,ev){const color=ev.detail.color;this.state.style[target]=color;this.closeMenus();}
closeMenus(){this.state.textColorTool=false;this.state.fillColorTool=false;}
static getDefaultRule(){return{type:"CellIsRule",operator:"IsNotEmpty",values:[],style:{fillColor:"#b6d7a8"},};}}
CellIsRuleEditor.template=TEMPLATE$o;CellIsRuleEditor.style=CSS$m;CellIsRuleEditor.components={ColorPicker};CellIsRuleEditor.defaultProps={errors:[],};const{Component:Component$n,useState:useState$i,hooks:hooks$3}=owl__namespace;const{useExternalListener:useExternalListener$4}=hooks$3;const{xml:xml$q,css:css$o}=owl__namespace.tags;const PREVIEW_TEMPLATE$1=xml$q`
  <div class="o-cf-preview-gradient" t-attf-style="{{getPreviewGradient()}}">
    <t t-esc="env._t('${conditionalFormattingTerms.PREVIEW_TEXT}')"/>
  </div>
`;const THRESHOLD_TEMPLATE=xml$q`
  <div t-attf-class="o-threshold o-threshold-{{thresholdType}}">
      <select class="o-input" name="valueType" t-model="threshold.type" t-on-click="closeMenus">
        <option value="value" t-if="thresholdType!=='midpoint'">
          <t t-esc="env._t('${colorScale.CellValues}')"/>
        </option>
        <option value="none" t-if="thresholdType==='midpoint'">
          <t t-esc="env._t('${colorScale.None}')"/>
        </option>
        <option value="number">
          <t t-esc="env._t('${conditionalFormattingTerms.FixedNumber}')"/>
        </option>
        <option value="percentage">
          <t t-esc="env._t('${conditionalFormattingTerms.Percentage}')"/>
        </option>
        <option value="percentile">
          <t t-esc="env._t('${conditionalFormattingTerms.Percentile}')"/>
        </option>
        <option value="formula">
          <t t-esc="env._t('${conditionalFormattingTerms.Formula}')"/>
        </option>
      </select>
      <input type="text" class="o-input o-threshold-value o-required"
        t-model="stateColorScale[thresholdType].value"
        t-att-class="{ 'o-invalid': isValueInvalid(thresholdType) }"
        t-if="['number', 'percentage', 'percentile', 'formula'].includes(threshold.type)"
      />
      <input type="text" class="o-input o-threshold-value"
        t-else="" disabled="1"
      />
      <div class="o-tools">
        <div class="o-tool  o-dropdown o-with-color">
          <span title="Fill Color"  t-attf-style="border-color:#{{colorNumberString(threshold.color)}}"
                t-on-click.stop="toggleMenu(thresholdType+'ColorTool')">${FILL_COLOR_ICON}</span>
          <ColorPicker t-if="stateColorScale[thresholdType+'ColorTool']" dropdownDirection="'left'" t-on-color-picked="setColor(thresholdType)"/>
        </div>
      </div>
  </div>`;const TEMPLATE$n=xml$q`
  <div>
      <div class="o-cf-title-text">
        <t t-esc="env._t('${colorScale.Preview}')"/>
      </div>
      <t t-call="${PREVIEW_TEMPLATE$1}"/>
      <div class="o-cf-title-text">
        <t t-esc="env._t('${colorScale.Minpoint}')"/>
      </div>
      <t t-call="${THRESHOLD_TEMPLATE}">
          <t t-set="threshold" t-value="stateColorScale.minimum" ></t>
          <t t-set="thresholdType" t-value="'minimum'" ></t>
      </t>
      <div class="o-cf-title-text">
        <t t-esc="env._t('${colorScale.MidPoint}')"/>
      </div>
      <t t-call="${THRESHOLD_TEMPLATE}">
          <t t-set="threshold" t-value="stateColorScale.midpoint" ></t>
          <t t-set="thresholdType" t-value="'midpoint'" ></t>
      </t>
      <div class="o-cf-title-text">
        <t t-esc="env._t('${colorScale.MaxPoint}')"/>
      </div>
      <t t-call="${THRESHOLD_TEMPLATE}">
          <t t-set="threshold" t-value="stateColorScale.maximum" ></t>
          <t t-set="thresholdType" t-value="'maximum'" ></t>
      </t>
  </div>`;const CSS$l=css$o`
  .o-threshold {
    display: flex;
    flex-direction: horizontal;
    select {
      width: 100%;
    }
    .o-threshold-value {
      margin-left: 2%;
      width: 20%;
      min-width: 0px; // input overflows in Firefox otherwise
    }
    .o-threshold-value:disabled {
      background-color: #edebed;
    }
  }
  .o-cf-preview-gradient {
    border: 1px solid darkgrey;
    padding: 10px;
    border-radius: 4px;
  }
`;class ColorScaleRuleEditor extends Component$n{constructor(){super(...arguments);this.colorNumberString=colorNumberString;this.stateColorScale=useState$i({minimum:this.props.rule.minimum,maximum:this.props.rule.maximum,midpoint:this.props.rule.midpoint?this.props.rule.midpoint:{color:0xb6d7a8,type:"none"},maximumColorTool:false,minimumColorTool:false,midpointColorTool:false,});useExternalListener$4(window,"click",this.closeMenus);}
getRule(){const minimum={...this.stateColorScale.minimum};const midpoint={...this.stateColorScale.midpoint};const maximum={...this.stateColorScale.maximum};return{type:"ColorScaleRule",minimum,maximum,midpoint:midpoint.type==="none"?undefined:midpoint,};}
toggleMenu(tool){const current=this.stateColorScale[tool];this.closeMenus();this.stateColorScale[tool]=!current;}
setColor(target,ev){const color=ev.detail.color;this.stateColorScale[target].color=Number.parseInt(color.substr(1),16);this.closeMenus();}
getPreviewGradient(){const minColor=colorNumberString(this.stateColorScale.minimum.color);const midColor=colorNumberString(this.stateColorScale.midpoint.color);const maxColor=colorNumberString(this.stateColorScale.maximum.color);const baseString="background-image: linear-gradient(to right, #";return this.stateColorScale.midpoint.type==="none"?baseString+minColor+", #"+maxColor+")":baseString+minColor+", #"+midColor+", #"+maxColor+")";}
isValueInvalid(threshold){switch(threshold){case"minimum":return(this.props.errors.includes(41)||this.props.errors.includes(33)||this.props.errors.includes(30)||this.props.errors.includes(36));case"midpoint":return(this.props.errors.includes(42)||this.props.errors.includes(37)||this.props.errors.includes(32));case"maximum":return(this.props.errors.includes(43)||this.props.errors.includes(38));default:return false;}}
closeMenus(){this.stateColorScale.minimumColorTool=false;this.stateColorScale.midpointColorTool=false;this.stateColorScale.maximumColorTool=false;}
static getDefaultRule(){return{type:"ColorScaleRule",minimum:{type:"value",color:0xffffff},midpoint:undefined,maximum:{type:"value",color:0x6aa84f},};}}
ColorScaleRuleEditor.template=TEMPLATE$n;ColorScaleRuleEditor.style=CSS$l;ColorScaleRuleEditor.components={ColorPicker};ColorScaleRuleEditor.defaultProps={errors:[],};const{Component:Component$m}=owl__namespace;const{css:css$n,xml:xml$p}=owl__namespace.tags;class IconPicker extends Component$m{constructor(){super(...arguments);this.icons=ICONS;this.iconSets=ICON_SETS;}
onIconClick(icon){if(icon){this.trigger("icon-picked",{icon});}}}
IconPicker.template=xml$p`
  <div class="o-icon-picker" >
    <t t-foreach="iconSets" t-as="iconSet" t-key="iconset">
      <div class="o-cf-icon-line">
        <div class="o-icon-picker-item" t-on-click="onIconClick(iconSets[iconSet].good)">
          <t t-raw="icons[iconSets[iconSet].good].svg"/>
        </div>
        <div class="o-icon-picker-item" t-on-click="onIconClick(iconSets[iconSet].neutral)">
          <t t-raw="icons[iconSets[iconSet].neutral].svg"/>
        </div>
        <div class="o-icon-picker-item" t-on-click="onIconClick(iconSets[iconSet].bad)">
          <t t-raw="icons[iconSets[iconSet].bad].svg"/>
        </div>
      </div>
    </t>
  </div>`;IconPicker.style=css$n`
    .o-icon-picker {
      position: absolute;
      z-index: 10;
      box-shadow: 1px 2px 5px 2px rgba(51, 51, 51, 0.15);
      background-color: white;
      padding: 2px 1px;
    }
    .o-cf-icon-line {
      display: flex;
      padding: 3px 6px;
    }
    .o-icon-picker-item {
      margin: 0px 2px;
      &:hover {
        background-color: rgba(0, 0, 0, 0.08);
        outline: 1px solid gray;
      }
    }
  `;const{Component:Component$l,useState:useState$h,hooks:hooks$2}=owl__namespace;const{useExternalListener:useExternalListener$3}=hooks$2;const{xml:xml$o,css:css$m}=owl__namespace.tags;const ICON_SETS_TEMPLATE=xml$o`
  <div>
  <div class="o-cf-title-text">
    <t t-esc="env._t('${iconSetRule.Icons}')"/>
  </div>
    <div class="o-cf-iconsets">
      <div class="o-cf-iconset" t-foreach="['arrows', 'smiley', 'dots']" t-as="iconSet" t-on-click="setIconSet(iconSet)">
        <div class="o-cf-icon">
          <t t-raw="icons[iconSets[iconSet].good].svg"/>
        </div>
        <div class="o-cf-icon">
          <t t-raw="icons[iconSets[iconSet].neutral].svg"/>
        </div>
        <div class="o-cf-icon">
          <t t-raw="icons[iconSets[iconSet].bad].svg"/>
        </div>
      </div>
    </div>
  </div>
`;const INFLECTION_POINTS_TEMPLATE_ROW=xml$o`
  <tr>
    <td>
      <div t-on-click.stop="toggleMenu(icon+'IconTool')">
        <div class="o-cf-icon-button">
          <t t-raw="icons[iconValue].svg"/>
        </div>
      </div>
      <IconPicker t-if="stateIconSetCF[icon+'IconTool']" t-on-icon-picked="setIcon(icon)"/>
    </td>
    <td>
      <t t-esc="env._t('${iconSetRule.WhenValueIs}')"/>
    </td>
    <td>
      <select class="o-input" name="valueType" t-model="inflectionPointValue.operator">
        <option value="gt">
          <span>&#62;</span>
        </option>
        <option value="ge">
          <span>&#8805;</span>
        </option>
      </select>
    </td>
    <td>
      <input type="text" class="o-input"
        t-att-class="{ 'o-invalid': isInflectionPointInvalid(inflectionPoint) }"
        t-model="stateIconSetCF[inflectionPoint].value"
      />
    </td>
    <td>
      <select class="o-input" name="valueType" t-model="inflectionPointValue.type">
      <option value="number">
        <t t-esc="env._t('${conditionalFormattingTerms.FixedNumber}')"/>
      </option>
      <option value="percentage">
        <t t-esc="env._t('${conditionalFormattingTerms.Percentage}')"/>
      </option>
      <option value="percentile">
        <t t-esc="env._t('${conditionalFormattingTerms.Percentile}')"/>
      </option>
      <option value="formula">
        <t t-esc="env._t('${conditionalFormattingTerms.Formula}')"/>
      </option>
      </select>
    </td>
  </tr>
`;const INFLECTION_POINTS_TEMPLATE=xml$o`
  <div class="o-inflection">
    <table>
    <tr>
      <th class="o-cf-iconset-icons"></th>
      <th class="o-cf-iconset-text"></th>
      <th class="o-cf-iconset-operator"></th>
      <th class="o-cf-iconset-value">
      <t t-esc="env._t('${iconSetRule.Value}')"/>
      </th>
      <th class="o-cf-iconset-type">
      <t t-esc="env._t('${iconSetRule.Type}')"/>
      </th>
    </tr>
    <t t-call="${INFLECTION_POINTS_TEMPLATE_ROW}">
      <t t-set="iconValue" t-value="stateIconSetCF.upperIcon" ></t>
      <t t-set="icon" t-value="'upper'" ></t>
      <t t-set="inflectionPointValue" t-value="stateIconSetCF.upperInflectionPoint" ></t>
      <t t-set="inflectionPoint" t-value="'upperInflectionPoint'" ></t>
    </t>
    <t t-call="${INFLECTION_POINTS_TEMPLATE_ROW}">
      <t t-set="iconValue" t-value="stateIconSetCF.middleIcon" ></t>
      <t t-set="icon" t-value="'middle'" ></t>
      <t t-set="inflectionPointValue" t-value="stateIconSetCF.lowerInflectionPoint" ></t>
      <t t-set="inflectionPoint" t-value="'lowerInflectionPoint'" ></t>
    </t>
    <tr>
      <td>
        <div t-on-click.stop="toggleMenu('lowerIconTool')">
          <div class="o-cf-icon-button" >
            <t t-raw="icons[stateIconSetCF.lowerIcon].svg"/>
          </div>
        </div>
        <IconPicker t-if="stateIconSetCF['lowerIconTool']" t-on-icon-picked="setIcon('lower')"/>
      </td>
      <td><t t-esc="env._t('${iconSetRule.Else}')"/></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </table>
  </div>`;const TEMPLATE$m=xml$o`
  <div class="o-cf-iconset-rule">
      <t t-call="${ICON_SETS_TEMPLATE}"/>
      <t t-call="${INFLECTION_POINTS_TEMPLATE}"/>
      <div class="btn btn-link o_refresh_measures o-cf-iconset-reverse" t-on-click="reverseIcons">
        <div class="mr-1 d-inline-block">
          <t t-raw="reverseIcon"/>
        </div>
        <t t-esc="env._t('${iconSetRule.ReverseIcons}')"/>
      </div>
  </div>`;const CSS$k=css$m`
  .o-cf-iconset-rule {
    font-size: 12;
    .o-cf-iconsets {
      display: flex;
      justify-content: space-between;
      .o-cf-iconset {
        border: 1px solid #dadce0;
        border-radius: 4px;
        display: inline-flex;
        padding: 5px 8px;
        width: 25%;
        cursor: pointer;
        justify-content: space-between;
        .o-cf-icon {
          display: inline;
          margin-left: 1%;
          margin-right: 1%;
        }
        svg {
          vertical-align: baseline;
        }
      }
      .o-cf-iconset:hover {
        background-color: rgba(0, 0, 0, 0.08);
      }
    }
    .o-inflection {
      .o-cf-icon-button {
        display: inline-block;
        border: 1px solid #dadce0;
        border-radius: 4px;
        cursor: pointer;
        padding: 1px 2px;
      }
      .o-cf-icon-button:hover {
        background-color: rgba(0, 0, 0, 0.08);
      }
      table {
        table-layout: fixed;
        margin-top: 2%;
        display: table;
        text-align: left;
        font-size: 12px;
        line-height: 18px;
        width: 100%;
      }
      th.o-cf-iconset-icons {
        width: 8%;
      }
      th.o-cf-iconset-text {
        width: 28%;
      }
      th.o-cf-iconset-operator {
        width: 14%;
      }
      th.o-cf-iconset-type {
        width: 28%;
      }
      th.o-cf-iconset-value {
        width: 26%;
      }
      input,
      select {
        width: 100%;
        height: 100%;
        box-sizing: border-box;
      }
    }
    .o-cf-iconset-reverse {
      margin-bottom: 2%;
      margin-top: 2%;
      .o-cf-label {
        display: inline-block;
        vertical-align: bottom;
        margin-bottom: 2px;
      }
    }
  }
`;class IconSetRuleEditor extends Component$l{constructor(){super(...arguments);this.icons=ICONS;this.iconSets=ICON_SETS;this.reverseIcon=REFRESH;this.stateIconSetCF=useState$h({reversed:false,upperInflectionPoint:this.props.rule.upperInflectionPoint,lowerInflectionPoint:this.props.rule.lowerInflectionPoint,upperIcon:this.props.rule.icons.upper,middleIcon:this.props.rule.icons.middle,lowerIcon:this.props.rule.icons.lower,upperIconTool:false,middleIconTool:false,lowerIconTool:false,});useExternalListener$3(window,"click",this.closeMenus);}
isInflectionPointInvalid(inflectionPoint){switch(inflectionPoint){case"lowerInflectionPoint":return(this.props.errors.includes(40)||this.props.errors.includes(45)||this.props.errors.includes(31));case"upperInflectionPoint":return(this.props.errors.includes(39)||this.props.errors.includes(44)||this.props.errors.includes(31));default:return true;}}
toggleMenu(tool){const current=this.stateIconSetCF[tool];this.closeMenus();this.stateIconSetCF[tool]=!current;}
closeMenus(){this.stateIconSetCF.upperIconTool=false;this.stateIconSetCF.middleIconTool=false;this.stateIconSetCF.lowerIconTool=false;}
setIconSet(iconSet){this.stateIconSetCF.upperIcon=this.iconSets[iconSet].good;this.stateIconSetCF.middleIcon=this.iconSets[iconSet].neutral;this.stateIconSetCF.lowerIcon=this.iconSets[iconSet].bad;}
setIcon(target,ev){this.stateIconSetCF[target+"Icon"]=ev.detail.icon;}
getRule(){const upperInflectionPoint={...this.stateIconSetCF.upperInflectionPoint};const lowerInflectionPoint={...this.stateIconSetCF.lowerInflectionPoint};return{type:"IconSetRule",lowerInflectionPoint,upperInflectionPoint,icons:{upper:this.stateIconSetCF.upperIcon,middle:this.stateIconSetCF.middleIcon,lower:this.stateIconSetCF.lowerIcon,},};}
getIconsSelction(){return Object.keys(this.icons);}
reverseIcons(){const upperIcon=this.stateIconSetCF.upperIcon;this.stateIconSetCF.upperIcon=this.stateIconSetCF.lowerIcon;this.stateIconSetCF.lowerIcon=upperIcon;}
static getDefaultRule(){return{type:"IconSetRule",icons:{upper:"arrowGood",middle:"arrowNeutral",lower:"arrowBad",},upperInflectionPoint:{type:"percentage",value:"66",operator:"gt",},lowerInflectionPoint:{type:"percentage",value:"33",operator:"gt",},};}}
IconSetRuleEditor.template=TEMPLATE$m;IconSetRuleEditor.style=CSS$k;IconSetRuleEditor.components={IconPicker};const{Component:Component$k,useState:useState$g}=owl__namespace;const{xml:xml$n,css:css$l}=owl__namespace.tags;const{useRef:useRef$8}=owl__namespace.hooks;const PREVIEW_TEMPLATE=xml$n`
<div class="o-cf-preview">
  <t t-if="cf.rule.type==='IconSetRule'">
    <div class="o-cf-preview-icon">
      <t t-raw="icons[cf.rule.icons.upper].svg"/>
      <t t-raw="icons[cf.rule.icons.middle].svg"/>
      <t t-raw="icons[cf.rule.icons.lower].svg"/>
    </div>
  </t>
  <t t-else="">
    <div t-att-style="getStyle(cf.rule)" class="o-cf-preview-image">
      123
    </div>
  </t>
  <div class="o-cf-preview-description">
    <div class="o-cf-preview-ruletype">
      <div class="o-cf-preview-description-rule">
        <t t-esc="getDescription(cf)" />
      </div>
      <div class="o-cf-preview-description-values">
      <t t-if="cf.rule.values">
        <t t-esc="cf.rule.values[0]" />
        <t t-if="cf.rule.values[1]">
        <t t-esc="' ' + env._t('${GenericWords.And}')"/> <t t-esc="cf.rule.values[1]"/>
        </t>
      </t>
      </div>
    </div>
    <div class="o-cf-preview-range" t-esc="cf.ranges"/>
  </div>
  <div class="o-cf-delete">
    <div class="o-cf-delete-button" t-on-click.stop="deleteConditionalFormat(cf)" aria-label="Remove rule">
    <t t-raw="trashIcon"/>
    </div>
  </div>
</div>`;const TEMPLATE$l=xml$n`
  <div class="o-cf">
    <t t-if="state.mode === 'list'">
      <div class="o-cf-preview-list" >
        <div t-on-click="editConditionalFormat(cf)" t-foreach="conditionalFormats" t-as="cf" t-key="cf.id">
            <t t-call="${PREVIEW_TEMPLATE}"/>
        </div>
      </div>
      <div class="btn btn-link o-cf-add" t-on-click.prevent.stop="addConditionalFormat">
        <t t-esc="'+ ' + env._t('${conditionalFormattingTerms.newRule}')"/>
      </div>
    </t>
    <t t-if="state.mode === 'edit' || state.mode === 'add'" t-key="state.currentCF.id">
        <div class="o-cf-ruleEditor">
            <div class="o-section o-cf-range">
              <div class="o-section-title">Apply to range</div>
              <div class="o-selection-cf">
                <SelectionInput
                  ranges="state.currentCF.ranges"
                  class="o-range"
                  isInvalid="isRangeValid"
                  t-on-selection-changed="onRangesChanged"
                  required="true"/>
              </div>
              <div class="o-section-title" t-esc="env._t('${conditionalFormattingTerms.CF_TITLE}')"></div>
              <div class="o_field_radio o_horizontal o_field_widget o-cf-type-selector">
                <div class="custom-control custom-radio o_cf_radio_item" t-on-click="changeRuleType('CellIsRule')">
                  <input class="custom-control-input o_radio_input" t-attf-checked="{{state.currentCFType === 'CellIsRule'}}" type="radio" id="cellIsRule" name="ruleType" value="CellIsRule"/>
                  <label for="cellIsRule" class="custom-control-label o_form_label">
                    <t t-esc="env._t('${conditionalFormattingTerms.SingleColor}')"/>
                  </label>
                </div>
                <div class="custom-control custom-radio o_cf_radio_item" t-on-click="changeRuleType('ColorScaleRule')">
                  <input class="custom-control-input o_radio_input" t-attf-checked="{{state.currentCFType === 'ColorScaleRule'}}" type="radio" id="colorScaleRule" name="ruleType" value="ColorScaleRule"/>
                  <label for="colorScaleRule" class="custom-control-label o_form_label">
                  <t t-esc="env._t('${conditionalFormattingTerms.ColorScale}')"/>
                  </label>
                </div>

                <div class="custom-control custom-radio o_cf_radio_item" t-on-click="changeRuleType('IconSetRule')">
                  <input class="custom-control-input o_radio_input" t-attf-checked="{{state.currentCFType === 'IconSetRule'}}" type="radio" id="iconSetRule" name="ruleType" value="IconSetRule"/>
                  <label for="iconSetRule" class="custom-control-label o_form_label">
                  <t t-esc="env._t('${conditionalFormattingTerms.IconSet}')"/>
                  </label>
                </div>
              </div>
            </div>
            <div class="o-section o-cf-editor">
              <t t-component="editors[state.currentCFType]"
                 t-ref="editorRef"
                 errors="state.errors"
                 t-key="state.currentCF.id + state.currentCFType"
                 rule="state.rules[state.currentCFType]"/>
              <div class="o-sidePanelButtons">
                <button t-on-click="switchToList" class="o-sidePanelButton o-cf-cancel" t-esc="env._t('${conditionalFormattingTerms.CANCEL}')"></button>
                <button t-on-click="saveConditionalFormat" class="o-sidePanelButton o-cf-save" t-esc="env._t('${conditionalFormattingTerms.SAVE}')"></button>
              </div>
            </div>
            <div class="o-section">
              <div class="o-cf-error" t-foreach="state.errors || []" t-as="error">
                <t t-esc="errorMessage(error)"/>
              </div>
            </div>
        </div>
    </t>
  </div>`;const CSS$j=css$l`
  label {
    vertical-align: middle;
  }
  .o_cf_radio_item {
    margin-right: 10%;
  }
  .radio input:checked {
    color: #e9ecef;
    border-color: #00a09d;
    background-color: #00a09d;
  }
  .o-cf-editor {
    border-bottom: solid;
    border-color: lightgrey;
  }
  .o-cf {
    .o-cf-type-selector {
      *,
      ::after,
      ::before {
        box-sizing: border-box;
      }
      margin-top: 10px;
      display: flex;
    }
    .o-cf-title-text {
      color: gray;
      font-size: 12px;
      line-height: 14px;
      margin: 8px 0 4px 0;
    }
    .o-cf-title-text:first-child {
      margin-top: 0px;
    }
    .o-cf-preview {
      background-color: #fff;
      border-bottom: 1px solid #ccc;
      cursor: pointer;
      display: flex;
      height: 60px;
      padding: 10px;
      position: relative;
      &:hover {
        background-color: rgba(0, 0, 0, 0.08);
      }
      &:not(:hover) .o-cf-delete-button {
        display: none;
      }
      .o-cf-preview-image {
        border: 1px solid lightgrey;
        height: 50px;
        line-height: 50px;
        margin-right: 15px;
        position: absolute;
        text-align: center;
        width: 50px;
      }
      .o-cf-preview-icon {
        border: 1px solid lightgrey;
        position: absolute;
        height: 50px;
        line-height: 50px;
        margin-right: 15px;
        display: flex;
        justify-content: space-around;
        align-items: center;
      }
      .o-cf-preview-description {
        left: 65px;
        margin-bottom: auto;
        margin-right: 8px;
        margin-top: auto;
        position: relative;
        width: 142px;
        .o-cf-preview-description-rule {
          margin-bottom: 4px;
          overflow: hidden;
        }
        .o-cf-preview-description-values {
          overflow: hidden;
        }
        .o-cf-preview-range {
          text-overflow: ellipsis;
          font-size: 12px;
          overflow: hidden;
        }
      }
      .o-cf-delete {
        color: dimgrey;
        left: 90%;
        top: 39%;
        position: absolute;
      }
    }
    .o-cf-ruleEditor {
      font-size: 12px;
      line-height: 1.5;
      .o-selection-cf {
        margin-bottom: 3%;
      }
      .o-dropdown {
        position: relative;
        .o-dropdown-content {
          position: absolute;
          top: calc(100% + 5px);
          left: 0;
          z-index: 10;
          box-shadow: 1px 2px 5px 2px rgba(51, 51, 51, 0.15);
          background-color: #f6f6f6;

          .o-dropdown-item {
            padding: 7px 10px;
          }
          .o-dropdown-item:hover {
            background-color: rgba(0, 0, 0, 0.08);
          }
          .o-dropdown-line {
            display: flex;
            padding: 3px 6px;
            .o-line-item {
              width: 16px;
              height: 16px;
              margin: 1px 3px;
              &:hover {
                background-color: rgba(0, 0, 0, 0.08);
              }
            }
          }
        }
      }

      .o-tools {
        color: #333;
        font-size: 13px;
        cursor: default;
        display: flex;

        .o-tool {
          display: flex;
          align-items: center;
          margin: 2px;
          padding: 0 3px;
          border-radius: 2px;
        }

        .o-tool.active,
        .o-tool:not(.o-disabled):hover {
          background-color: rgba(0, 0, 0, 0.08);
        }

        .o-with-color > span {
          border-bottom: 4px solid;
          height: 16px;
          margin-top: 2px;
        }
        .o-with-color {
          .o-line-item:hover {
            outline: 1px solid gray;
          }
        }
        .o-border {
          .o-line-item {
            padding: 4px;
            margin: 1px;
          }
        }
      }
      .o-cell-content {
        font-size: 12px;
        font-weight: 500;
        padding: 0 12px;
        margin: 0;
        line-height: 35px;
      }
    }
    .o-cf-add {
      font-size: 14px;
      padding: 20px 24px 11px 24px;
      height: 44px;
      cursor: pointer;
      text-decoration: none;
    }
    .o-cf-add:hover {
      color: #003a39;
      text-decoration: none;
    }
    .o-cf-error {
      color: red;
      margin-top: 10px;
    }
  }
`;class ConditionalFormattingPanel extends Component$k{constructor(parent,props){super(parent,props);this.icons=ICONS;this.trashIcon=TRASH;this.cellIsOperators=cellIsOperators;this.editor=useRef$8("editorRef");this.getters=this.env.getters;this.state=useState$g({mode:"list",rules:{},errors:[],});this.editors={CellIsRule:CellIsRuleEditor,ColorScaleRule:ColorScaleRuleEditor,IconSetRule:IconSetRuleEditor,};this.activeSheetId=this.getters.getActiveSheetId();const rules=this.getters.getRulesSelection(this.activeSheetId,props.selection||[]);if(rules.length===1){const cf=this.conditionalFormats.find((c)=>c.id===rules[0]);if(cf){this.editConditionalFormat(cf);}}}
get conditionalFormats(){return this.getters.getConditionalFormats(this.getters.getActiveSheetId());}
get isRangeValid(){return this.state.errors.includes(19);}
errorMessage(error){return this.env._t(conditionalFormattingTerms.Errors[error]||conditionalFormattingTerms.Errors.unexpected);}
async willUpdateProps(nextProps){const newActiveSheetId=this.getters.getActiveSheetId();if(newActiveSheetId!==this.activeSheetId){this.activeSheetId=newActiveSheetId;this.switchToList();}
else if(nextProps.selection!==this.props.selection){const sheetId=this.getters.getActiveSheetId();const rules=this.getters.getRulesSelection(sheetId,nextProps.selection||[]);if(rules.length===1){const cf=this.conditionalFormats.find((c)=>c.id===rules[0]);if(cf){this.editConditionalFormat(cf);}}
else{this.switchToList();}}}
switchToList(){this.state.mode="list";this.state.currentCF=undefined;this.state.currentCFType=undefined;this.state.errors=[];this.state.rules={};}
getStyle(rule){if(rule.type==="CellIsRule"){const fontWeight=rule.style.bold?"bold":"normal";const fontDecoration=getTextDecoration(rule.style);const fontStyle=rule.style.italic?"italic":"normal";const color=rule.style.textColor||"none";const backgroundColor=rule.style.fillColor||"none";return`font-weight:${fontWeight};
               text-decoration:${fontDecoration};
               font-style:${fontStyle};
               color:${color};
               background-color:${backgroundColor};`;}
else if(rule.type==="ColorScaleRule"){const minColor=colorNumberString(rule.minimum.color);const midColor=rule.midpoint?colorNumberString(rule.midpoint.color):null;const maxColor=colorNumberString(rule.maximum.color);const baseString="background-image: linear-gradient(to right, #";return midColor?baseString+minColor+", #"+midColor+", #"+maxColor+")":baseString+minColor+", #"+maxColor+")";}
return"";}
getDescription(cf){switch(cf.rule.type){case"CellIsRule":return cellIsOperators[cf.rule.operator];case"ColorScaleRule":return this.env._t("Color scale");case"IconSetRule":return this.env._t("Icon Set");default:return"";}}
saveConditionalFormat(){if(this.state.currentCF){const invalidRanges=this.state.currentCF.ranges.some((xc)=>!xc.match(rangeReference));if(invalidRanges){this.state.errors=[20];return;}
const result=this.env.dispatch("ADD_CONDITIONAL_FORMAT",{cf:{rule:this.getEditorRule(),id:this.state.mode==="edit"?this.state.currentCF.id:this.env.uuidGenerator.uuidv4(),},target:this.state.currentCF.ranges.map(toZone),sheetId:this.getters.getActiveSheetId(),});if(!result.isSuccessful){this.state.errors=result.reasons;}
else{this.switchToList();}}}
getEditorRule(){return this.editor.comp.getRule();}
addConditionalFormat(){this.state.mode="add";this.state.currentCFType="CellIsRule";this.state.rules["CellIsRule"]=CellIsRuleEditor.getDefaultRule();this.state.currentCF={id:this.env.uuidGenerator.uuidv4(),ranges:this.getters.getSelectedZones().map((zone)=>this.getters.zoneToXC(this.getters.getActiveSheetId(),zone)),};}
deleteConditionalFormat(cf){this.env.dispatch("REMOVE_CONDITIONAL_FORMAT",{id:cf.id,sheetId:this.getters.getActiveSheetId(),});}
editConditionalFormat(cf){this.state.mode="edit";this.state.currentCF=cf;this.state.currentCFType=cf.rule.type==="CellIsRule"?"CellIsRule":cf.rule.type==="ColorScaleRule"?"ColorScaleRule":"IconSetRule";this.state.rules[cf.rule.type]=cf.rule;}
changeRuleType(ruleType){if(this.state.currentCFType===ruleType){return;}
if(this.state.currentCFType){this.state.rules[this.state.currentCFType]=this.getEditorRule();}
this.state.errors=[];this.state.currentCFType=ruleType;if(!(ruleType in this.state.rules)){switch(ruleType){case"CellIsRule":this.state.rules["CellIsRule"]=CellIsRuleEditor.getDefaultRule();break;case"ColorScaleRule":this.state.rules["ColorScaleRule"]=ColorScaleRuleEditor.getDefaultRule();break;case"IconSetRule":this.state.rules["IconSetRule"]=IconSetRuleEditor.getDefaultRule();break;}}}
onRangesChanged({detail}){if(this.state.currentCF){this.state.currentCF.ranges=detail.ranges;}}}
ConditionalFormattingPanel.template=TEMPLATE$l;ConditionalFormattingPanel.style=CSS$j;ConditionalFormattingPanel.components={CellIsRuleEditor,ColorScaleRuleEditor,IconSetRuleEditor,SelectionInput};const{Component:Component$j,useState:useState$f}=owl__namespace;const{xml:xml$m,css:css$k}=owl__namespace.tags;const TEMPLATE$k=xml$m`
<div class="o-find-and-replace" tabindex="0" t-on-focusin="onFocusSidePanel">
  <div class="o-section">
    <div class="o-section-title" t-esc="env._t('${FindAndReplaceTerms.Search}')"/>
    <div class="o-input-search-container">
      <input type="text" class="o-input o-input-with-count" t-on-input="onInput" t-on-keydown="onKeydownSearch"/>
      <div class="o-input-count" t-if="hasSearchResult">
        <t t-esc="env.getters.getCurrentSelectedMatchIndex()+1"/>
        /
        <t t-esc="env.getters.getSearchMatches().length"/>
      </div>
    </div>
    <div>
      <div class="o-far-item">
        <label class="o-far-checkbox">
          <input t-model="state.searchOptions.matchCase" t-on-change="updateSearch()" class="o-far-input" type="checkbox"/>
          <span class="o-far-label"><t t-esc="env._t('${FindAndReplaceTerms.MatchCase}')"/></span>
        </label>
      </div>
      <div class="o-far-item">
        <label class="o-far-checkbox">
          <input t-model="state.searchOptions.exactMatch" t-on-change="updateSearch()" class="o-far-input" type="checkbox"/>
          <span class="o-far-label"><t t-esc="env._t('${FindAndReplaceTerms.ExactMatch}')"/></span>
        </label>
      </div>
      <div class="o-far-item">
        <label class="o-far-checkbox">
          <input t-model="state.searchOptions.searchFormulas" t-on-change="searchFormulas" class="o-far-input" type="checkbox" />
          <span class="o-far-label"><t t-esc="env._t('${FindAndReplaceTerms.SearchFormulas}')"/></span>
        </label>
      </div>
    </div>
  </div>
  <div class="o-sidePanelButtons">
    <button t-att-disabled="!hasSearchResult"
            t-on-click="onSelectPreviousCell"
            class="o-sidePanelButton"
            t-esc="env._t('${FindAndReplaceTerms.Previous}')"/>
    <button t-att-disabled="!hasSearchResult"
            t-on-click="onSelectNextCell"
            class="o-sidePanelButton"
            t-esc="env._t('${FindAndReplaceTerms.Next}')"/>
  </div>
  <div class="o-section" t-if="!getters.isReadonly()">
    <div t-esc="env._t('${FindAndReplaceTerms.Replace}')" class="o-section-title"/>
    <div class="o-input-search-container">
      <input type="text" class="o-input o-input-without-count" t-model="state.replaceWith" t-on-keydown="onKeydownReplace"/>
    </div>

    <div class="o-far-item">
      <label class="o-far-checkbox">
        <input class="o-far-input" t-att-disabled="state.searchOptions.searchFormulas" type="checkbox"
        t-model="state.replaceOptions.modifyFormulas"/>
        <span class="o-far-label"><t t-esc="env._t('${FindAndReplaceTerms.ReplaceFormulas}')"/></span>
      </label>
    </div>
  </div>

  <div class="o-sidePanelButtons" t-if="!getters.isReadonly()">
    <button t-att-disabled="env.getters.getCurrentSelectedMatchIndex() === null" t-on-click="replace"
            class="o-sidePanelButton" t-esc="env._t('${FindAndReplaceTerms.Replace}')"/>
    <button t-att-disabled="env.getters.getCurrentSelectedMatchIndex() === null" t-on-click="replaceAll"
            class="o-sidePanelButton" t-esc="env._t('${FindAndReplaceTerms.ReplaceAll}')"/>
  </div>

</div>
`;const CSS$i=css$k`
  .o-find-and-replace {
    .o-far-item {
      display: block;
      .o-far-checkbox {
        display: inline-block;
        .o-far-input {
          vertical-align: middle;
        }
        .o-far-label {
          position: relative;
          top: 1.5px;
          padding-left: 4px;
        }
      }
    }
    outline: none;
    height: 100%;
    .o-input-search-container {
      display: flex;
      .o-input-with-count {
        flex-grow: 1;
        width: auto;
      }
      .o-input-without-count {
        width: 100%;
      }
      .o-input-count {
        width: fit-content;
        padding: 4 0 4 4;
      }
    }
  }
`;class FindAndReplacePanel extends Component$j{constructor(){super(...arguments);this.getters=this.env.getters;this.state=useState$f(this.initialState());}
get hasSearchResult(){return this.env.getters.getCurrentSelectedMatchIndex()!==null;}
mounted(){this.focusInput();}
async willUnmount(){this.env.dispatch("CLEAR_SEARCH");}
onInput(ev){this.state.toSearch=ev.target.value;this.debouncedUpdateSearch();}
onKeydownSearch(ev){if(ev.key==="Enter"){ev.preventDefault();this.onSelectNextCell();}}
onKeydownReplace(ev){if(ev.key==="Enter"){ev.preventDefault();this.replace();}}
onFocusSidePanel(){this.state.searchOptions.searchFormulas=this.getters.shouldShowFormulas();this.state.replaceOptions.modifyFormulas=this.state.searchOptions.searchFormulas?this.state.searchOptions.searchFormulas:this.state.replaceOptions.modifyFormulas;this.env.dispatch("REFRESH_SEARCH");}
searchFormulas(){this.env.dispatch("SET_FORMULA_VISIBILITY",{show:this.state.searchOptions.searchFormulas});this.state.replaceOptions.modifyFormulas=this.state.searchOptions.searchFormulas;this.updateSearch();}
onSelectPreviousCell(){this.env.dispatch("SELECT_SEARCH_PREVIOUS_MATCH");}
onSelectNextCell(){this.env.dispatch("SELECT_SEARCH_NEXT_MATCH");}
updateSearch(){if(this.state.toSearch){this.env.dispatch("UPDATE_SEARCH",{toSearch:this.state.toSearch,searchOptions:this.state.searchOptions,});}}
debouncedUpdateSearch(){clearTimeout(this.inDebounce);this.inDebounce=setTimeout(()=>this.updateSearch.call(this),400);}
replace(){this.env.dispatch("REPLACE_SEARCH",{replaceWith:this.state.replaceWith,replaceOptions:this.state.replaceOptions,});}
replaceAll(){this.env.dispatch("REPLACE_ALL_SEARCH",{replaceWith:this.state.replaceWith,replaceOptions:this.state.replaceOptions,});}
focusInput(){const input=this.el.querySelector(`input`);if(input){input.focus();}}
initialState(){return{toSearch:"",replaceWith:"",searchOptions:{matchCase:false,exactMatch:false,searchFormulas:false,},replaceOptions:{modifyFormulas:false,},};}}
FindAndReplacePanel.template=TEMPLATE$k;FindAndReplacePanel.style=CSS$i;const sidePanelRegistry=new Registry();sidePanelRegistry.add("ConditionalFormatting",{title:_lt("Conditional formatting"),Body:ConditionalFormattingPanel,});sidePanelRegistry.add("ChartPanel",{title:_lt("Chart"),Body:ChartPanel,});sidePanelRegistry.add("FindAndReplace",{title:_lt("Find and Replace"),Body:FindAndReplacePanel,});const topbarComponentRegistry=new Registry();class UIPlugin extends BasePlugin{constructor(getters,state,dispatch,config){super(state,dispatch,config);this.getters=getters;this.ui=config;}
drawGrid(ctx,layer){}}
UIPlugin.layers=[];class AutofillGenerator{constructor(cells,getters,direction){this.index=0;this.cells=cells;this.getters=getters;this.direction=direction;}
next(){const genCell=this.cells[this.index++%this.cells.length];const rule=genCell.rule;const{cellData,tooltip}=autofillModifiersRegistry.get(rule.type).apply(rule,genCell.data,this.getters,this.direction);return{cellData,tooltip,origin:{col:genCell.data.col,row:genCell.data.row,},};}}
class AutofillPlugin extends UIPlugin{constructor(){super(...arguments);this.lastCellSelected={};}
allowDispatch(cmd){switch(cmd.type){case"AUTOFILL_SELECT":const sheetId=this.getters.getActiveSheetId();this.lastCellSelected.col=cmd.col===-1?this.lastCellSelected.col:clip(cmd.col,0,this.getters.getSheet(sheetId).cols.length);this.lastCellSelected.row=cmd.row===-1?this.lastCellSelected.row:clip(cmd.row,0,this.getters.getSheet(sheetId).rows.length);if(this.lastCellSelected.col!==undefined&&this.lastCellSelected.row!==undefined){return 0;}
return 28;case"AUTOFILL_AUTO":const zone=this.getters.getSelectedZone();return zone.top===zone.bottom?0:1;}
return 0;}
handle(cmd){switch(cmd.type){case"AUTOFILL":this.autofill(true);break;case"AUTOFILL_SELECT":this.select(cmd.col,cmd.row);break;case"AUTOFILL_AUTO":this.autofillAuto();break;case"AUTOFILL_CELL":this.autoFillMerge(cmd.originCol,cmd.originRow,cmd.col,cmd.row);const sheetId=this.getters.getActiveSheetId();this.dispatch("UPDATE_CELL",{sheetId,col:cmd.col,row:cmd.row,style:cmd.style||null,content:cmd.content||"",format:cmd.format||"",});this.dispatch("SET_BORDER",{sheetId,col:cmd.col,row:cmd.row,border:cmd.border,});}}
getAutofillTooltip(){return this.tooltip;}
autofill(apply){if(!this.autofillZone||this.direction===undefined){this.tooltip=undefined;return;}
const source=this.getters.getSelectedZone();const target=this.autofillZone;switch(this.direction){case 1:for(let col=source.left;col<=source.right;col++){const xcs=[];for(let row=source.top;row<=source.bottom;row++){xcs.push(toXC(col,row));}
const generator=this.createGenerator(xcs);for(let row=target.top;row<=target.bottom;row++){this.computeNewCell(generator,col,row,apply);}}
break;case 0:for(let col=source.left;col<=source.right;col++){const xcs=[];for(let row=source.bottom;row>=source.top;row--){xcs.push(toXC(col,row));}
const generator=this.createGenerator(xcs);for(let row=target.bottom;row>=target.top;row--){this.computeNewCell(generator,col,row,apply);}}
break;case 2:for(let row=source.top;row<=source.bottom;row++){const xcs=[];for(let col=source.right;col>=source.left;col--){xcs.push(toXC(col,row));}
const generator=this.createGenerator(xcs);for(let col=target.right;col>=target.left;col--){this.computeNewCell(generator,col,row,apply);}}
break;case 3:for(let row=source.top;row<=source.bottom;row++){const xcs=[];for(let col=source.left;col<=source.right;col++){xcs.push(toXC(col,row));}
const generator=this.createGenerator(xcs);for(let col=target.left;col<=target.right;col++){this.computeNewCell(generator,col,row,apply);}}
break;}
if(apply){const zone=union(this.getters.getSelectedZone(),this.autofillZone);this.autofillZone=undefined;this.lastCellSelected={};this.direction=undefined;this.tooltip=undefined;this.dispatch("SET_SELECTION",{zones:[zone],anchor:[zone.left,zone.top],anchorZone:zone,});}}
select(col,row){const source=this.getters.getSelectedZone();if(isInside(col,row,source)){this.autofillZone=undefined;return;}
this.direction=this.getDirection(col,row);switch(this.direction){case 0:this.saveZone(row,source.top-1,source.left,source.right);break;case 1:this.saveZone(source.bottom+1,row,source.left,source.right);break;case 2:this.saveZone(source.top,source.bottom,col,source.left-1);break;case 3:this.saveZone(source.top,source.bottom,source.right+1,col);break;}
this.autofill(false);}
autofillAuto(){const zone=this.getters.getSelectedZone();const sheetId=this.getters.getActiveSheetId();let col=zone.left;let row=zone.bottom;if(col>0){let left=this.getters.getCell(sheetId,col-1,row);while(left&&!left.isEmpty()){row+=1;left=this.getters.getCell(sheetId,col-1,row);}}
if(row===zone.bottom){col=zone.right;if(col<=this.getters.getActiveSheet().cols.length){let right=this.getters.getCell(sheetId,col+1,row);while(right&&!right.isEmpty()){row+=1;right=this.getters.getCell(sheetId,col+1,row);}}}
if(row!==zone.bottom){this.select(zone.left,row-1);this.autofill(true);}}
computeNewCell(generator,col,row,apply){const{cellData,tooltip,origin}=generator.next();const{content,style,border,format}=cellData;this.tooltip=tooltip;if(apply){this.dispatch("AUTOFILL_CELL",{originCol:origin.col,originRow:origin.row,col,row,content,style,border,format,});}}
getRule(cell,cells){const rules=autofillRulesRegistry.getAll().sort((a,b)=>a.sequence-b.sequence);const rule=rules.find((rule)=>rule.condition(cell,cells));return rule&&rule.generateRule(cell,cells);}
createGenerator(source){const nextCells=[];const cellsData=[];const sheetId=this.getters.getActiveSheetId();for(let xc of source){const[col,row]=toCartesian(xc);const cell=this.getters.getCell(sheetId,col,row);cellsData.push({col,row,cell,sheetId,});}
const cells=cellsData.map((cellData)=>cellData.cell);for(let cellData of cellsData){let rule={type:"COPY_MODIFIER"};if(cellData&&cellData.cell){const newRule=this.getRule(cellData.cell,cells);rule=newRule||rule;}
const{sheetId,col,row}=cellData;const border=this.getters.getCellBorder(sheetId,col,row)||undefined;nextCells.push({data:{...cellData,border},rule,});}
return new AutofillGenerator(nextCells,this.getters,this.direction);}
saveZone(top,bottom,left,right){this.autofillZone={top,bottom,left,right};}
getDirection(col,row){const source=this.getters.getSelectedZone();const position={up:{number:source.top-row,value:0},down:{number:row-source.bottom,value:1},left:{number:source.left-col,value:2},right:{number:col-source.right,value:3},};if(Object.values(position).map((x)=>(x.number>0?1:0)).reduce((acc,value)=>acc+value)===1){return Object.values(position).find((x)=>(x.number>0?1:0)).value;}
const first=position.up.number>0?"up":"down";const second=position.left.number>0?"left":"right";return Math.abs(position[first].number)>=Math.abs(position[second].number)?position[first].value:position[second].value;}
autoFillMerge(originCol,originRow,col,row){const activeSheet=this.getters.getActiveSheet();if(this.getters.isInMerge(activeSheet.id,col,row)&&!this.getters.isInMerge(activeSheet.id,originCol,originRow)){const zone=this.getters.getMerge(activeSheet.id,col,row);if(zone){this.dispatch("REMOVE_MERGE",{sheetId:activeSheet.id,target:[zone],});}}
const originMerge=this.getters.getMerge(activeSheet.id,originCol,originRow);if((originMerge===null||originMerge===void 0?void 0:originMerge.topLeft.col)===originCol&&(originMerge===null||originMerge===void 0?void 0:originMerge.topLeft.row)===originRow){this.dispatch("ADD_MERGE",{sheetId:activeSheet.id,target:[{top:row,bottom:row+originMerge.bottom-originMerge.top,left:col,right:col+originMerge.right-originMerge.left,},],});}}
drawGrid(renderingContext){if(!this.autofillZone){return;}
const{viewport,ctx,thinLineWidth}=renderingContext;const[x,y,width,height]=this.getters.getRect(this.autofillZone,viewport);if(width>0&&height>0){ctx.strokeStyle="black";ctx.lineWidth=thinLineWidth;ctx.setLineDash([3]);ctx.strokeRect(x,y,width,height);ctx.setLineDash([]);}}}
AutofillPlugin.layers=[6];AutofillPlugin.getters=["getAutofillTooltip"];AutofillPlugin.modes=["normal"];class AutomaticSumPlugin extends UIPlugin{handle(cmd){switch(cmd.type){case"SUM_SELECTION":const sheetId=this.getters.getActiveSheetId();const{zones,anchor}=this.getters.getSelection();for(const zone of zones){const sums=this.getAutomaticSums(sheetId,zone,anchor);this.dispatchCellUpdates(sheetId,sums);}
break;}}
getAutomaticSums(sheetId,zone,anchor){return this.shouldFindData(sheetId,zone)?this.sumAdjacentData(sheetId,zone,anchor):this.sumData(sheetId,zone);}
sumData(sheetId,zone){const dimensions=this.dimensionsToSum(sheetId,zone);const sums=this.sumDimensions(sheetId,zone,dimensions).filter(({zone})=>!this.getters.isEmpty(sheetId,zone));if(dimensions.has("ROW")&&dimensions.has("COL")){sums.push(this.sumTotal(zone));}
return sums;}
sumAdjacentData(sheetId,zone,anchor){const[col,row]=isInside(anchor[0],anchor[1],zone)?anchor:[zone.left,zone.top];const dataZone=this.findAdjacentData(sheetId,col,row);if(!dataZone){return[];}
if(this.getters.isSingleCellOrMerge(sheetId,zone)||isOneDimensional(union(dataZone,zone))){return[{position:[col,row],zone:dataZone}];}
else{return this.sumDimensions(sheetId,union(dataZone,zone),this.transpose(this.dimensionsToSum(sheetId,zone)));}}
findAdjacentData(sheetId,col,row){const sheet=this.getters.getSheet(sheetId);const zone=this.findSuitableZoneToSum(sheet,...this.getters.getMainCell(sheetId,col,row));if(zone){return this.getters.expandZone(sheetId,zone);}
return undefined;}
findSuitableZoneToSum(sheet,col,row){const topCell=this.getters.getCell(sheet.id,col,row-1);const leftCell=this.getters.getCell(sheet.id,col-1,row);if(this.isNumber(leftCell)&&!this.isNumber(topCell)){return this.findHorizontalZone(sheet,col,row);}
const verticalZone=this.findVerticalZone(sheet,col,row);if(this.isZoneValid(verticalZone)){return verticalZone;}
const horizontalZone=this.findHorizontalZone(sheet,col,row);if(this.isZoneValid(horizontalZone)){return horizontalZone;}
return undefined;}
findVerticalZone(sheet,col,row){const zone={top:0,bottom:row-1,left:col,right:col,};const top=this.reduceZoneStart(sheet,zone,zone.bottom);return{...zone,top};}
findHorizontalZone(sheet,col,row){const zone={top:row,bottom:row,left:0,right:col-1,};const left=this.reduceZoneStart(sheet,zone,zone.right);return{...zone,left};}
reduceZoneStart(sheet,zone,end){const cells=mapCellsInZone(zone,sheet,(cell)=>cell,undefined).flat();const cellPositions=range(end,-1,-1);const invalidCells=cellPositions.filter((position)=>{var _a;return cells[position]&&!((_a=cells[position])===null||_a===void 0?void 0:_a.isAutoSummable);});const maxValidPosition=Math.max(...invalidCells);const numberSequences=groupConsecutive(cellPositions.filter((position)=>this.isNumber(cells[position])));const firstSequence=numberSequences[0]||[];if(Math.max(...firstSequence)<maxValidPosition){return Infinity;}
return Math.min(...firstSequence);}
shouldFindData(sheetId,zone){return this.getters.isEmpty(sheetId,zone)||this.getters.isSingleCellOrMerge(sheetId,zone);}
isNumber(cell){var _a;return(cell===null||cell===void 0?void 0:cell.evaluated.type)===CellValueType.number&&!((_a=cell.format)===null||_a===void 0?void 0:_a.match(DATETIME_FORMAT));}
isZoneValid(zone){return zone.bottom>=zone.top&&zone.right>=zone.left;}
lastColIsEmpty(sheetId,zone){return this.getters.isEmpty(sheetId,{...zone,left:zone.right});}
lastRowIsEmpty(sheetId,zone){return this.getters.isEmpty(sheetId,{...zone,top:zone.bottom});}
dimensionsToSum(sheetId,zone){const dimensions=new Set();if(isOneDimensional(zone)){dimensions.add(zoneToDimension(zone).width===1?"COL":"ROW");return dimensions;}
if(this.lastColIsEmpty(sheetId,zone)){dimensions.add("ROW");}
if(this.lastRowIsEmpty(sheetId,zone)){dimensions.add("COL");}
if(dimensions.size===0){dimensions.add("COL");}
return dimensions;}
sumDimensions(sheetId,zone,dimensions){return[...(dimensions.has("COL")?this.sumColumns(zone,sheetId):[]),...(dimensions.has("ROW")?this.sumRows(zone,sheetId):[]),];}
sumTotal(zone){const{bottom,right}=zone;return{position:[right,bottom],zone:{...zone,top:bottom,right:right-1}};}
sumColumns(zone,sheetId){const target=this.nextEmptyRow(sheetId,{...zone,bottom:zone.bottom-1});zone={...zone,bottom:Math.min(zone.bottom,target.bottom-1)};return positions(target).map((position)=>({position,zone:{...zone,right:position[0],left:position[0]},}));}
sumRows(zone,sheetId){const target=this.nextEmptyCol(sheetId,{...zone,right:zone.right-1});zone={...zone,right:Math.min(zone.right,target.right-1)};return positions(target).map((position)=>({position,zone:{...zone,top:position[1],bottom:position[1]},}));}
dispatchCellUpdates(sheetId,sums){for(const sum of sums){const[col,row]=sum.position;this.dispatch("UPDATE_CELL",{sheetId,col,row,content:`=SUM(${this.getters.zoneToXC(sheetId, sum.zone)})`,});}}
nextEmptyRow(sheetId,zone){let start=zone.bottom+1;const{left,right}=zone;while(!this.getters.isEmpty(sheetId,{bottom:start,top:start,left,right})){start++;}
return{...zone,top:start,bottom:start,};}
nextEmptyCol(sheetId,zone){let start=zone.right+1;const{top,bottom}=zone;while(!this.getters.isEmpty(sheetId,{left:start,right:start,top,bottom})){start++;}
return{...zone,left:start,right:start,};}
transpose(dimensions){return new Set([...dimensions.values()].map((dimension)=>(dimension==="COL"?"ROW":"COL")));}}
AutomaticSumPlugin.getters=["getAutomaticSums"];AutomaticSumPlugin.modes=["normal","headless"];class ClipboardPlugin extends UIPlugin{constructor(){super(...arguments);this.status="invisible";this._isPaintingFormat=false;}
allowDispatch(cmd){switch(cmd.type){case"PASTE":return this.isPasteAllowed(this.state,cmd.target,!!cmd.force);case"INSERT_CELL":{const{cut,paste}=this.getInsertCellsTargets(cmd.zone,cmd.shiftDimension);const state=this.getClipboardState(cut,"CUT");return this.isPasteAllowed(state,paste,false);}
case"DELETE_CELL":{const{cut,paste}=this.getDeleteCellsTargets(cmd.zone,cmd.shiftDimension);const state=this.getClipboardState(cut,"CUT");return this.isPasteAllowed(state,paste,false);}}
return 0;}
handle(cmd){switch(cmd.type){case"COPY":case"CUT":this.state=this.getClipboardState(cmd.target,cmd.type);this.status="visible";break;case"PASTE":if(!this.state){break;}
const pasteOption=cmd.pasteOption||(this._isPaintingFormat?"onlyFormat":undefined);this._isPaintingFormat=false;if(cmd.interactive){this.interactivePaste(this.state,cmd.target,cmd);}
else{const height=this.state.cells.length;const width=this.state.cells[0].length;this.paste(this.state,cmd.target,pasteOption);this.selectPastedZone(width,height,cmd.target);this.status="invisible";}
break;case"DELETE_CELL":{const{cut,paste}=this.getDeleteCellsTargets(cmd.zone,cmd.shiftDimension);const state=this.getClipboardState(cut,"CUT");if(cmd.interactive){this.interactivePaste(state,paste,cmd);}
else{this.paste(state,paste);}
break;}
case"INSERT_CELL":{const{cut,paste}=this.getInsertCellsTargets(cmd.zone,cmd.shiftDimension);const state=this.getClipboardState(cut,"CUT");if(cmd.interactive){this.interactivePaste(state,paste,cmd);}
else{this.paste(state,paste);}
break;}
case"PASTE_FROM_OS_CLIPBOARD":this.pasteFromClipboard(cmd.target,cmd.text);break;case"ACTIVATE_PAINT_FORMAT":this.state=this.getClipboardState(cmd.target,"COPY");this._isPaintingFormat=true;this.status="visible";break;default:if(isCoreCommand(cmd)){this.status="invisible";}}}
getClipboardContent(){if(!this.state||!this.state.cells.length){return"\t";}
return(this.state.cells.map((cells)=>{return cells.map((c)=>c.cell?this.getters.getCellText(c.cell,this.getters.shouldShowFormulas()):"").join("\t");}).join("\n")||"\t");}
isPaintingFormat(){return this._isPaintingFormat;}
getDeleteCellsTargets(zone,dimension){const sheet=this.getters.getActiveSheet();let cut;if(dimension==="COL"){cut={...zone,left:zone.right+1,right:sheet.cols.length-1,};}
else{cut={...zone,top:zone.bottom+1,bottom:sheet.rows.length-1,};}
return{cut:[cut],paste:[zone]};}
getInsertCellsTargets(zone,dimension){const sheet=this.getters.getActiveSheet();let cut;let paste;if(dimension==="COL"){cut={...zone,right:sheet.cols.length-1,};paste={...zone,left:zone.right+1,right:zone.right+1,};}
else{cut={...zone,bottom:sheet.rows.length-1,};paste={...zone,top:zone.bottom+1,bottom:sheet.rows.length-1};}
return{cut:[cut],paste:[paste]};}
removeMergeIfTopLeft(position){const{sheetId,col,row}=position;const[left,top]=this.getters.getMainCell(sheetId,col,row);if(top===row&&left===col){const merge=this.getters.getMerge(sheetId,col,row);if(merge){this.dispatch("REMOVE_MERGE",{sheetId,target:[merge]});}}}
pasteMergeIfExist(origin,target){let{sheetId,col,row}=origin;const[mainCellColOrigin,mainCellRowOrigin]=this.getters.getMainCell(sheetId,col,row);if(mainCellColOrigin===col&&mainCellRowOrigin===row){const merge=this.getters.getMerge(sheetId,col,row);if(!merge){return;}
({sheetId,col,row}=target);this.dispatch("ADD_MERGE",{sheetId,force:true,target:[{left:col,top:row,right:col+merge.right-merge.left,bottom:row+merge.bottom-merge.top,},],});}}
getPasteZones(target,cells){if(!cells.length||!cells[0].length){return target;}
const pasteZones=[];const height=cells.length;const width=cells[0].length;const selection=target[target.length-1];const col=selection.left;const row=selection.top;const repetitionCol=Math.max(1,Math.floor((selection.right+1-col)/width));const repetitionRow=Math.max(1,Math.floor((selection.bottom+1-row)/height));for(let x=1;x<=repetitionCol;x++){for(let y=1;y<=repetitionRow;y++){pasteZones.push({left:col,top:row,right:col-1+x*width,bottom:row-1+y*height,});}}
return pasteZones;}
getClipboardState(zones,operation){const tops=new Set(zones.map((z)=>z.top));const bottoms=new Set(zones.map((z)=>z.bottom));const areZonesCompatible=tops.size===1&&bottoms.size===1;let clippedZones=areZonesCompatible?zones:[zones[zones.length-1]];clippedZones=clippedZones.map((zone)=>({...zone}));const rows=[];const merges=[];const sheetId=this.getters.getActiveSheetId();const{top,bottom}=clippedZones[0];for(let row=top;row<=bottom;row++){const cells=[];rows.push(cells);for(let zone of clippedZones){for(let col=zone.left;col<=zone.right;col++){const cell=this.getters.getCell(sheetId,col,row);const border=this.getters.getCellBorder(sheetId,col,row)||undefined;cells.push({cell,border,position:{col,row,sheetId}});const merge=this.getters.getMerge(sheetId,col,row);if(merge&&merge.top===row&&merge.left===col){merges.push(merge);}}}}
return{cells:rows,operation,sheetId,zones:clippedZones,merges,};}
pasteFromClipboard(target,content){this.status="invisible";const values=content.replace(/\r/g,"").split("\n").map((vals)=>vals.split("\t"));const{left:activeCol,top:activeRow}=target[0];const width=Math.max.apply(Math,values.map((a)=>a.length));const height=values.length;const sheet=this.getters.getActiveSheet();this.addMissingDimensions(sheet,width,height,activeCol,activeRow);for(let i=0;i<values.length;i++){for(let j=0;j<values[i].length;j++){this.dispatch("UPDATE_CELL",{row:activeRow+i,col:activeCol+j,content:values[i][j],sheetId:sheet.id,});}}
const zone={left:activeCol,top:activeRow,right:activeCol+width-1,bottom:activeRow+height-1,};this.dispatch("SET_SELECTION",{anchor:[activeCol,activeRow],zones:[zone],anchorZone:zone,});}
isPasteAllowed(state,target,force){const sheetId=this.getters.getActiveSheetId();if(!state){return 18;}
if(target.length>1){if(state.cells.length>1||state.cells[0].length>1){return 17;}}
if(!force){for(let zone of this.getPasteZones(target,state.cells)){if(this.getters.doesIntersectMerge(sheetId,zone)){return 2;}}}
return 0;}
paste(state,target,options){if(state.operation==="CUT"){this.clearClippedZones(state);}
if(target.length>1){for(const zone of target){for(let col=zone.left;col<=zone.right;col++){for(let row=zone.top;row<=zone.bottom;row++){this.pasteZone(state,col,row,options);}}}}
else{const height=state.cells.length;const width=state.cells[0].length;const selection=target[0];const repX=Math.max(1,Math.floor((selection.right+1-selection.left)/width));const repY=Math.max(1,Math.floor((selection.bottom+1-selection.top)/height));for(let x=0;x<repX;x++){for(let y=0;y<repY;y++){this.pasteZone(state,selection.left+x*width,selection.top+y*height,options);}}}
if(state.operation==="CUT"){this.dispatch("REMOVE_MERGE",{sheetId:state.sheetId,target:state.merges});this.state=undefined;}}
selectPastedZone(width,height,target){const selection=target[0];const col=selection.left;const row=selection.top;const repX=Math.max(1,Math.floor((selection.right+1-selection.left)/width));const repY=Math.max(1,Math.floor((selection.bottom+1-selection.top)/height));if(height>1||width>1){const newSelection={left:col,top:row,right:col+repX*width-1,bottom:row+repY*height-1,};const[anchorCol,anchorRow]=this.getters.getSelection().anchor;const newCol=clip(anchorCol,col,col+repX*width-1);const newRow=clip(anchorRow,row,row+repY*height-1);this.dispatch("SET_SELECTION",{anchor:[newCol,newRow],zones:[newSelection],anchorZone:newSelection,});}}
clearClippedZones(state){for(const row of state.cells){for(const cell of row){if(cell.cell){this.dispatch("CLEAR_CELL",cell.position);}}}
this.dispatch("CLEAR_FORMATTING",{sheetId:state.sheetId,target:state.zones,});}
pasteZone(state,col,row,pasteOption){const height=state.cells.length;const width=state.cells[0].length;const shouldPasteCF=pasteOption!=="onlyValue"&&this.state&&this.state===state;const sheet=this.getters.getActiveSheet();this.addMissingDimensions(sheet,width,height,col,row);for(let r=0;r<height;r++){const rowCells=state.cells[r];for(let c=0;c<width;c++){const origin=rowCells[c];const position={col:col+c,row:row+r,sheetId:sheet.id};this.removeMergeIfTopLeft(position);this.pasteMergeIfExist(origin.position,position);this.pasteCell(origin,position,state.operation,state.zones,pasteOption);if(shouldPasteCF){this.dispatch("PASTE_CONDITIONAL_FORMAT",{origin:origin.position,target:position,operation:state.operation,});}}}}
addMissingDimensions(sheet,width,height,col,row){const{cols,rows,id:sheetId}=sheet;const missingRows=height+row-rows.length;if(missingRows>0){this.dispatch("ADD_COLUMNS_ROWS",{dimension:"ROW",base:rows.length-1,sheetId,quantity:missingRows,position:"after",});}
const missingCols=width+col-cols.length;if(missingCols>0){this.dispatch("ADD_COLUMNS_ROWS",{dimension:"COL",base:cols.length-1,sheetId,quantity:missingCols,position:"after",});}}
pasteCell(origin,target,operation,zones,pasteOption){const{sheetId,col,row}=target;const targetCell=this.getters.getCell(sheetId,col,row);if(pasteOption!=="onlyValue"){this.dispatch("SET_BORDER",{sheetId,col,row,border:origin.border});}
if(origin.cell){if(pasteOption==="onlyFormat"){this.dispatch("UPDATE_CELL",{...target,style:origin.cell.style,format:origin.cell.format,});return;}
if(pasteOption==="onlyValue"){const content=formatValue(origin.cell.evaluated.value);this.dispatch("UPDATE_CELL",{...target,content});return;}
let content=origin.cell.content;if(origin.cell.isFormula()){const offsetX=col-origin.position.col;const offsetY=row-origin.position.row;content=this.getUpdatedContent(sheetId,origin.cell,offsetX,offsetY,zones,operation);}
this.dispatch("UPDATE_CELL",{...target,content,style:origin.cell.style||null,format:origin.cell.format,});}
else if(targetCell){if(pasteOption==="onlyValue"){this.dispatch("UPDATE_CELL",{...target,content:""});}
else if(pasteOption==="onlyFormat"){this.dispatch("UPDATE_CELL",{...target,style:null,format:""});}
else{this.dispatch("CLEAR_CELL",target);}}}
getUpdatedContent(sheetId,cell,offsetX,offsetY,zones,operation){if(operation==="CUT"){const ranges=[];for(const range of cell.dependencies.references){if(this.isZoneOverlapClippedZone(zones,range.zone)){ranges.push(...this.getters.createAdaptedRanges([range],offsetX,offsetY,sheetId));}
else{ranges.push(range);}}
const dependencies={...cell.dependencies,references:ranges};return this.getters.buildFormulaContent(sheetId,cell.normalizedText,dependencies);}
const ranges=this.getters.createAdaptedRanges(cell.dependencies.references,offsetX,offsetY,sheetId);const dependencies={...cell.dependencies,references:ranges};return this.getters.buildFormulaContent(sheetId,cell.normalizedText,dependencies);}
isZoneOverlapClippedZone(zones,zone){return zones.some((clippedZone)=>overlap(zone,clippedZone));}
interactivePaste(state,target,cmd){const result=this.isPasteAllowed(state,target,false);if(result!==0){if(result===17){this.ui.notifyUser(_lt("This operation is not allowed with multiple selections."));}
if(result===2){this.ui.notifyUser(_lt("This operation is not possible due to a merge. Please remove the merges first than try again."));}}
else{this.dispatch(cmd.type,{...cmd,interactive:false});}}
drawGrid(renderingContext){const{viewport,ctx,thinLineWidth}=renderingContext;if(this.status!=="visible"||!this.state||!this.state.zones||!this.state.zones.length||this.state.sheetId!==this.getters.getActiveSheetId()){return;}
ctx.setLineDash([8,5]);ctx.strokeStyle=SELECTION_BORDER_COLOR;ctx.lineWidth=3.3*thinLineWidth;for(const zone of this.state.zones){const[x,y,width,height]=this.getters.getRect(zone,viewport);if(width>0&&height>0){ctx.strokeRect(x,y,width,height);}}}}
ClipboardPlugin.layers=[2];ClipboardPlugin.getters=["getClipboardContent","isPaintingFormat"];ClipboardPlugin.modes=["normal"];var SelectionMode;(function(SelectionMode){SelectionMode[SelectionMode["idle"]=0]="idle";SelectionMode[SelectionMode["selecting"]=1]="selecting";SelectionMode[SelectionMode["readyToExpand"]=2]="readyToExpand";SelectionMode[SelectionMode["expanding"]=3]="expanding";})(SelectionMode||(SelectionMode={}));class SelectionPlugin extends UIPlugin{constructor(getters,state,dispatch,config){super(getters,state,dispatch,config);this.selection={zones:[{top:0,left:0,bottom:0,right:0}],anchor:[0,0],anchorZone:{top:0,left:0,bottom:0,right:0},};this.selectedFigureId=null;this.activeCol=0;this.activeRow=0;this.mode=SelectionMode.idle;this.sheetsData={};this.activeSheet=null;this.moveClient=config.moveClient;}
allowDispatch(cmd){switch(cmd.type){case"SET_SELECTION":{if(cmd.zones.findIndex((z)=>isEqual(z,cmd.anchorZone))===-1){return 14;}
break;}
case"ALTER_SELECTION":if(cmd.delta){const{left,right,top,bottom}=this.getSelectedZone();const sheet=this.getters.getActiveSheet();const refCol=findVisibleHeader(sheet,"cols",range(left,right+1));const refRow=findVisibleHeader(sheet,"rows",range(top,bottom+1));if((cmd.delta[0]!==0&&refRow===undefined)||(cmd.delta[1]!==0&&refCol===undefined)){return 15;}}
break;case"MOVE_POSITION":{const{cols,rows}=this.getters.getActiveSheet();if((cmd.deltaX!==0&&rows[this.activeRow].isHidden)||(cmd.deltaY!==0&&cols[this.activeCol].isHidden)){return 15;}
const{col:targetCol,row:targetRow}=this.getNextAvailablePosition(cmd.deltaX,cmd.deltaY);const outOfBound=targetRow<0||targetRow>rows.length-1||targetCol<0||targetCol>cols.length-1;if(outOfBound){return 15;}
break;}
case"SELECT_COLUMN":{const{index}=cmd;if(index<0||index>=this.getters.getActiveSheet().cols.length){return 15;}
break;}
case"SELECT_ROW":{const{index}=cmd;if(index<0||index>=this.getters.getActiveSheet().rows.length){return 15;}
break;}
case"ACTIVATE_SHEET":try{this.getters.getSheet(cmd.sheetIdTo);break;}
catch(error){return 21;}
case"MOVE_COLUMNS_ROWS":const result=this.isMoveElementAllowed(cmd);if(result===2){this.ui.notifyUser(_lt("Merged cells are preventing this operation. Unmerge those cells and try again."));}
return result;}
return 0;}
handle(cmd){switch(cmd.type){case"CREATE_SHEET":case"DELETE_SHEET":case"CREATE_FIGURE":case"CREATE_CHART":case"UPDATE_FIGURE":case"EVALUATE_CELLS":case"DISABLE_SELECTION_INPUT":case"ENABLE_NEW_SELECTION_INPUT":case"RESIZE_VIEWPORT":break;case"DELETE_FIGURE":if(this.selectedFigureId===cmd.id){this.selectedFigureId=null;}
break;default:this.selectedFigureId=null;}
switch(cmd.type){case"START":const firstSheet=this.getters.getSheets()[0];const firstVisiblePosition=getNextVisibleCellCoords(firstSheet,0,0);this.activeCol=firstVisiblePosition[0];this.activeRow=firstVisiblePosition[1];this.dispatch("ACTIVATE_SHEET",{sheetIdTo:this.getters.getSheets()[0].id,sheetIdFrom:this.getters.getSheets()[0].id,});this.selectCell(...firstVisiblePosition);break;case"ACTIVATE_SHEET":this.setActiveSheet(cmd.sheetIdTo);this.sheetsData[cmd.sheetIdFrom]={selection:JSON.parse(JSON.stringify(this.selection)),activeCol:this.activeCol,activeRow:this.activeRow,};if(cmd.sheetIdTo in this.sheetsData){Object.assign(this,this.sheetsData[cmd.sheetIdTo]);}
else{this.selectCell(...getNextVisibleCellCoords(this.getters.getSheets()[0],0,0));}
break;case"SET_SELECTION":this.setSelection(cmd.anchor,cmd.zones,cmd.anchorZone,cmd.strict);break;case"START_SELECTION":this.mode=SelectionMode.selecting;break;case"PREPARE_SELECTION_EXPANSION":this.mode=SelectionMode.readyToExpand;break;case"START_SELECTION_EXPANSION":this.mode=SelectionMode.expanding;break;case"STOP_SELECTION":this.mode=SelectionMode.idle;break;case"MOVE_POSITION":this.movePosition(cmd.deltaX,cmd.deltaY);break;case"SELECT_CELL":this.selectCell(cmd.col,cmd.row);break;case"SELECT_COLUMN":this.selectColumn(cmd.index,cmd.createRange||false,cmd.updateRange||false);break;case"SELECT_ROW":this.selectRow(cmd.index,cmd.createRange||false,cmd.updateRange||false);break;case"SELECT_ALL":this.selectAll();break;case"ALTER_SELECTION":if(cmd.delta){this.moveSelection(cmd.delta[0],cmd.delta[1]);}
if(cmd.cell){this.addCellToSelection(...cmd.cell);}
break;case"UNDO":case"REDO":case"DELETE_SHEET":if(!this.getters.tryGetSheet(this.getActiveSheetId())){const currentSheets=this.getters.getVisibleSheets();this.activeSheet=this.getters.getSheet(currentSheets[0]);this.selectCell(0,0);}
this.ensureSelectionValidity();break;case"REMOVE_COLUMNS_ROWS":if(cmd.sheetId===this.getActiveSheetId()){if(cmd.dimension==="COL"){this.onColumnsRemoved(cmd);}
else{this.onRowsRemoved(cmd);}}
break;case"ADD_COLUMNS_ROWS":if(cmd.sheetId===this.getActiveSheetId()){this.onAddElements(cmd);}
break;case"MOVE_COLUMNS_ROWS":if(cmd.sheetId===this.getActiveSheetId()){this.onMoveElements(cmd);}
break;case"UPDATE_CHART":case"SELECT_FIGURE":this.selectedFigureId=cmd.id;break;case"ACTIVATE_NEXT_SHEET":this.activateNextSheet("right");break;case"ACTIVATE_PREVIOUS_SHEET":this.activateNextSheet("left");break;}}
getActiveSheet(){return this.activeSheet;}
getActiveSheetId(){return this.activeSheet.id;}
getActiveCell(){const sheetId=this.getters.getActiveSheetId();const[mainCol,mainRow]=this.getters.getMainCell(sheetId,this.activeCol,this.activeRow);return this.getters.getCell(sheetId,mainCol,mainRow);}
getActiveCols(){const activeCols=new Set();for(let zone of this.selection.zones){if(zone.top===0&&zone.bottom===this.getters.getActiveSheet().rows.length-1){for(let i=zone.left;i<=zone.right;i++){activeCols.add(i);}}}
return activeCols;}
getActiveRows(){const activeRows=new Set();for(let zone of this.selection.zones){if(zone.left===0&&zone.right===this.getters.getActiveSheet().cols.length-1){for(let i=zone.top;i<=zone.bottom;i++){activeRows.add(i);}}}
return activeRows;}
getCurrentStyle(){const cell=this.getters.getActiveCell();return cell?this.getters.getCellStyle(cell):{};}
getSelectedZones(){return this.selection.zones;}
getSelectedZone(){return this.selection.anchorZone;}
getSelection(){return this.selection;}
getSelectedFigureId(){return this.selectedFigureId;}
getPosition(){return[this.activeCol,this.activeRow];}
getSheetPosition(sheetId){if(sheetId===this.getters.getActiveSheetId()){return this.getPosition();}
else{const sheetData=this.sheetsData[sheetId];return sheetData?[sheetData.activeCol,sheetData.activeRow]:getNextVisibleCellCoords(this.getters.getSheet(sheetId),0,0);}}
getAggregate(){let aggregate=0;let n=0;for(let zone of this.selection.zones){for(let row=zone.top;row<=zone.bottom;row++){const r=this.getters.getRow(this.getters.getActiveSheetId(),row);if(r===undefined){continue;}
for(let col=zone.left;col<=zone.right;col++){const cell=r.cells[col];if((cell===null||cell===void 0?void 0:cell.evaluated.type)===CellValueType.number){n++;aggregate+=cell.evaluated.value;}}}}
return n<2?null:formatStandardNumber(aggregate);}
getSelectionMode(){return this.mode;}
isSelected(zone){return!!this.getters.getSelectedZones().find((z)=>isEqual(z,zone));}
getVisibleFigures(sheetId){const result=[];const figures=this.getters.getFigures(sheetId);const{offsetX,offsetY}=this.getters.getSnappedViewport(sheetId);const{width,height}=this.getters.getViewportDimension();for(let figure of figures){if(figure.x>=offsetX+width||figure.x+figure.width<=offsetX){continue;}
if(figure.y>=offsetY+height||figure.y+figure.height<=offsetY){continue;}
result.push(figure);}
return result;}
getElementsFromSelection(dimension){if(dimension==="COL"&&this.getters.getActiveCols().size===0){return[];}
if(dimension==="ROW"&&this.getters.getActiveRows().size===0){return[];}
const zones=this.getters.getSelectedZones();let elements=[];const start=dimension==="COL"?"left":"top";const end=dimension==="COL"?"right":"bottom";for(const zone of zones){const zoneRows=Array.from({length:zone[end]-zone[start]+1},(_,i)=>zone[start]+i);elements=elements.concat(zoneRows);}
return[...new Set(elements)].sort();}
selectColumn(index,createRange,updateRange){const bottom=this.getters.getActiveSheet().rows.length-1;let zone={left:index,right:index,top:0,bottom};const current=this.selection.zones;let newZones,anchor;const top=this.getters.getActiveSheet().rows.findIndex((row)=>!row.isHidden);if(updateRange){const[col,row]=this.selection.anchor;zone=union(zone,{left:col,right:col,top,bottom});newZones=this.updateSelectionZones(zone);anchor=[col,row];}
else{newZones=createRange?current.concat(zone):[zone];anchor=[index,top];}
this.dispatch("SET_SELECTION",{zones:newZones,anchor,strict:true,anchorZone:zone});}
selectRow(index,createRange,updateRange){const right=this.getters.getActiveSheet().cols.length-1;let zone={top:index,bottom:index,left:0,right};const current=this.selection.zones;let zones,anchor;const left=this.getters.getActiveSheet().cols.findIndex((col)=>!col.isHidden);if(updateRange){const[col,row]=this.selection.anchor;zone=union(zone,{left,right,top:row,bottom:row});zones=this.updateSelectionZones(zone);anchor=[col,row];}
else{zones=createRange?current.concat(zone):[zone];anchor=[left,index];}
this.dispatch("SET_SELECTION",{zones,anchor,strict:true,anchorZone:zone});}
selectAll(){const bottom=this.getters.getActiveSheet().rows.length-1;const right=this.getters.getActiveSheet().cols.length-1;const zone={left:0,top:0,bottom,right};this.dispatch("SET_SELECTION",{zones:[zone],anchor:[0,0],anchorZone:zone});}
selectCell(col,row){const sheet=this.getters.getActiveSheet();this.moveClient({sheetId:sheet.id,col,row});let zone=this.getters.expandZone(sheet.id,{left:col,right:col,top:row,bottom:row});if(this.mode===SelectionMode.expanding){this.selection.zones.push(zone);}
else{this.selection.zones=[zone];}
this.selection.zones=uniqueZones(this.selection.zones);this.selection.anchorZone=zone;this.selection.anchor=[col,row];this.activeCol=col;this.activeRow=row;}
setActiveSheet(id){const sheet=this.getters.getSheet(id);this.activeSheet=sheet;}
getNextAvailablePosition(deltaX,deltaY){return{col:this.getNextAvailableCol(deltaX,this.activeCol,this.activeRow),row:this.getNextAvailableRow(deltaY,this.activeCol,this.activeRow),};}
getNextAvailableCol(delta,colIndex,rowIndex){const{cols,id:sheetId}=this.getActiveSheet();const position={col:colIndex,row:rowIndex};const isInPositionMerge=(nextCol)=>this.getters.isInSameMerge(sheetId,colIndex,rowIndex,nextCol,rowIndex);return this.getNextAvailableHeader(delta,cols,colIndex,position,isInPositionMerge);}
getNextAvailableRow(delta,colIndex,rowIndex){const{rows,id:sheetId}=this.getActiveSheet();const position={col:colIndex,row:rowIndex};const isInPositionMerge=(nextRow)=>this.getters.isInSameMerge(sheetId,colIndex,rowIndex,colIndex,nextRow);return this.getNextAvailableHeader(delta,rows,rowIndex,position,isInPositionMerge);}
getNextAvailableHeader(delta,headers,startingHeaderIndex,position,isInPositionMerge){var _a,_b,_c;const sheetId=this.getters.getActiveSheetId();const{col,row}=position;if(delta===0){return startingHeaderIndex;}
let header=startingHeaderIndex+delta;if(this.getters.isInMerge(sheetId,col,row)){while(isInPositionMerge(header)){header+=delta;}
while((_a=headers[header])===null||_a===void 0?void 0:_a.isHidden){header+=delta;}}
else if((_b=headers[header])===null||_b===void 0?void 0:_b.isHidden){while((_c=headers[header])===null||_c===void 0?void 0:_c.isHidden){header+=delta;}}
const outOfBound=header<0||header>headers.length-1;if(outOfBound){if(headers[startingHeaderIndex].isHidden){return this.getNextAvailableHeader(-delta,headers,startingHeaderIndex,position,isInPositionMerge);}
else{return startingHeaderIndex;}}
return header;}
movePosition(deltaX,deltaY){const{col:targetCol,row:targetRow}=this.getNextAvailablePosition(deltaX,deltaY);this.selectCell(targetCol,targetRow);}
setSelection(anchor,zones,anchorZone,strict=false){this.selectCell(...anchor);const sheetId=this.getters.getActiveSheetId();let selection;zones=uniqueZones(zones);if(strict){selection={zones,anchorZone,anchor};}
else{selection={anchor,zones:zones.map((zone)=>this.getters.expandZone(sheetId,zone)),anchorZone:this.getters.expandZone(sheetId,anchorZone),};}
this.selection=this.clipSelection(sheetId,selection);}
getReferencePosition(){const sheet=this.getters.getActiveSheet();const selection=this.selection;const{left,right,top,bottom}=selection.anchorZone;const[anchorCol,anchorRow]=selection.anchor;return{col:sheet.cols[anchorCol].isHidden?findVisibleHeader(sheet,"cols",range(left,right+1))||anchorCol:anchorCol,row:sheet.rows[anchorRow].isHidden?findVisibleHeader(sheet,"rows",range(top,bottom+1))||anchorRow:anchorRow,};}
moveSelection(deltaX,deltaY){const selection=this.selection;let newZones=[];const[anchorCol,anchorRow]=selection.anchor;const{left,right,top,bottom}=selection.anchorZone;let result=selection.anchorZone;const activeSheet=this.getters.getActiveSheet();const expand=(z)=>{const{left,right,top,bottom}=this.getters.expandZone(activeSheet.id,z);return{left:Math.max(0,left),right:Math.min(activeSheet.cols.length-1,right),top:Math.max(0,top),bottom:Math.min(activeSheet.rows.length-1,bottom),};};const{col:refCol,row:refRow}=this.getReferencePosition();let n=0;while(result!==null){n++;if(deltaX<0){const newRight=this.getNextAvailableCol(deltaX,right-(n-1),refRow);result=refCol<=right-n?expand({top,left,bottom,right:newRight}):null;}
if(deltaX>0){const newLeft=this.getNextAvailableCol(deltaX,left+(n-1),refRow);result=left+n<=refCol?expand({top,left:newLeft,bottom,right}):null;}
if(deltaY<0){const newBottom=this.getNextAvailableRow(deltaY,refCol,bottom-(n-1));result=refRow<=bottom-n?expand({top,left,bottom:newBottom,right}):null;}
if(deltaY>0){const newTop=this.getNextAvailableRow(deltaY,refCol,top+(n-1));result=top+n<=refRow?expand({top:newTop,left,bottom,right}):null;}
result=result?organizeZone(result):result;if(result&&!isEqual(result,selection.anchorZone)){newZones=this.updateSelectionZones(result);this.dispatch("SET_SELECTION",{zones:newZones,anchor:[anchorCol,anchorRow],anchorZone:result,});return;}}
const currentZone={top:anchorRow,bottom:anchorRow,left:anchorCol,right:anchorCol};const zoneWithDelta=organizeZone({top:this.getNextAvailableRow(deltaY,refCol,top),left:this.getNextAvailableCol(deltaX,left,refRow),bottom:this.getNextAvailableRow(deltaY,refCol,bottom),right:this.getNextAvailableCol(deltaX,right,refRow),});result=expand(union(currentZone,zoneWithDelta));if(!isEqual(result,selection.anchorZone)){newZones=this.updateSelectionZones(result);this.dispatch("SET_SELECTION",{zones:newZones,anchor:[anchorCol,anchorRow],anchorZone:result,});}}
addCellToSelection(col,row){const selection=this.selection;const[anchorCol,anchorRow]=selection.anchor;const zone={left:Math.min(anchorCol,col),top:Math.min(anchorRow,row),right:Math.max(anchorCol,col),bottom:Math.max(anchorRow,row),};const newZones=this.updateSelectionZones(zone);this.dispatch("SET_SELECTION",{zones:newZones,anchor:[anchorCol,anchorRow],anchorZone:zone,});}
ensureSelectionValidity(){const{anchor,zones,anchorZone}=this.clipSelection(this.getActiveSheetId(),this.selection);this.setSelection(anchor,zones,anchorZone);const deletedSheetIds=Object.keys(this.sheetsData).filter((sheetId)=>!this.getters.tryGetSheet(sheetId));for(const sheetId of deletedSheetIds){delete this.sheetsData[sheetId];}
for(const sheetId in this.sheetsData){const{anchor,zones,anchorZone}=this.clipSelection(sheetId,this.sheetsData[sheetId].selection);this.sheetsData[sheetId]={selection:{anchor,zones,anchorZone},activeCol:anchor[0],activeRow:anchor[1],};}}
clipSelection(sheetId,selection){const sheet=this.getters.getSheet(sheetId);const cols=sheet.cols.length-1;const rows=sheet.rows.length-1;const zones=selection.zones.map((z)=>({left:clip(z.left,0,cols),right:clip(z.right,0,cols),top:clip(z.top,0,rows),bottom:clip(z.bottom,0,rows),}));const anchorCol=clip(selection.anchor[0],0,cols);const anchorRow=clip(selection.anchor[1],0,rows);const anchorZone={left:clip(selection.anchorZone.left,0,cols),right:clip(selection.anchorZone.right,0,cols),top:clip(selection.anchorZone.top,0,rows),bottom:clip(selection.anchorZone.bottom,0,rows),};return{anchor:[anchorCol,anchorRow],zones,anchorZone,};}
onColumnsRemoved(cmd){const zone=updateSelectionOnDeletion(this.getSelectedZone(),"left",cmd.elements);this.setSelection([zone.left,zone.top],[zone],zone,true);this.ensureSelectionValidity();}
onRowsRemoved(cmd){const zone=updateSelectionOnDeletion(this.getSelectedZone(),"top",cmd.elements);this.setSelection([zone.left,zone.top],[zone],zone,true);this.ensureSelectionValidity();}
onAddElements(cmd){const selection=this.getSelectedZone();const zone=updateSelectionOnInsertion(selection,cmd.dimension==="COL"?"left":"top",cmd.base,cmd.position,cmd.quantity);this.setSelection([zone.left,zone.top],[zone],zone,true);}
updateSelectionZones(newZone){let zones=[...this.selection.zones];const current=this.selection.anchorZone;const index=zones.findIndex((z)=>isEqual(z,current));if(index>=0){zones[index]=newZone;}
return zones;}
activateNextSheet(direction){const sheetIds=this.getters.getSheets().map((sheet)=>sheet.id);const oldSheetPosition=sheetIds.findIndex((id)=>id===this.activeSheet.id);const delta=direction==="left"?sheetIds.length-1:1;const newPosition=(oldSheetPosition+delta)%sheetIds.length;this.dispatch("ACTIVATE_SHEET",{sheetIdFrom:this.getActiveSheetId(),sheetIdTo:sheetIds[newPosition],});}
onMoveElements(cmd){const thickness=cmd.elements.length;this.dispatch("ADD_COLUMNS_ROWS",{dimension:cmd.dimension,sheetId:cmd.sheetId,base:cmd.base,quantity:thickness,position:"before",});const isCol=cmd.dimension==="COL";const start=cmd.elements[0];const end=cmd.elements[thickness-1];const isBasedbefore=cmd.base<start;const deltaCol=isBasedbefore&&isCol?thickness:0;const deltaRow=isBasedbefore&&!isCol?thickness:0;const sheet=this.getters.getSheet(cmd.sheetId);this.dispatch("CUT",{target:[{left:isCol?start+deltaCol:0,right:isCol?end+deltaCol:sheet.cols.length-1,top:!isCol?start+deltaRow:0,bottom:!isCol?end+deltaRow:sheet.rows.length-1,},],});this.dispatch("PASTE",{target:[{left:isCol?cmd.base:0,right:isCol?cmd.base+thickness-1:sheet.cols.length-1,top:!isCol?cmd.base:0,bottom:!isCol?cmd.base+thickness-1:sheet.rows.length-1,},],});this.dispatch("REMOVE_COLUMNS_ROWS",{dimension:cmd.dimension,sheetId:cmd.sheetId,elements:isBasedbefore?cmd.elements.map((el)=>el+thickness):cmd.elements,});}
isMoveElementAllowed(cmd){const isCol=cmd.dimension==="COL";const start=cmd.elements[0];const end=cmd.elements[cmd.elements.length-1];const id=cmd.sheetId;const doesElementsHaveCommonMerges=isCol?this.getters.doesColumnsHaveCommonMerges:this.getters.doesRowsHaveCommonMerges;if(doesElementsHaveCommonMerges(id,start-1,start)||doesElementsHaveCommonMerges(id,end,end+1)||doesElementsHaveCommonMerges(id,cmd.base-1,cmd.base)){return 2;}
return 0;}
drawGrid(renderingContext){if(this.getters.getEditionMode()!=="inactive"){return;}
const{viewport,ctx,thinLineWidth}=renderingContext;const zones=this.getSelectedZones();ctx.fillStyle="#f3f7fe";const onlyOneCell=zones.length===1&&zones[0].left===zones[0].right&&zones[0].top===zones[0].bottom;ctx.fillStyle=onlyOneCell?"#f3f7fe":"#e9f0ff";ctx.strokeStyle=SELECTION_BORDER_COLOR;ctx.lineWidth=1.5*thinLineWidth;ctx.globalCompositeOperation="multiply";for(const zone of zones){const[x,y,width,height]=this.getters.getRect(zone,viewport);ctx.fillRect(x,y,width,height);ctx.strokeRect(x,y,width,height);}
ctx.globalCompositeOperation="source-over";const activeSheet=this.getters.getActiveSheetId();const[col,row]=this.getPosition();ctx.strokeStyle=SELECTION_BORDER_COLOR;ctx.lineWidth=3*thinLineWidth;let zone;if(this.getters.isInMerge(activeSheet,col,row)){zone=this.getters.getMerge(activeSheet,col,row);}
else{zone={top:row,bottom:row,left:col,right:col,};}
const[x,y,width,height]=this.getters.getRect(zone,viewport);if(width>0&&height>0){ctx.strokeRect(x,y,width,height);}}}
SelectionPlugin.layers=[5];SelectionPlugin.modes=["normal"];SelectionPlugin.getters=["getActiveSheet","getActiveSheetId","getActiveCell","getActiveCols","getActiveRows","getCurrentStyle","getSelectedZones","getSelectedZone","getAggregate","getSelectedFigureId","getVisibleFigures","getSelection","getPosition","getSheetPosition","getSelectionMode","isSelected","getElementsFromSelection",];const CELL_DELETED_MESSAGE=_lt("The cell you are trying to edit has been deleted.");const SelectionIndicator="␣";class EditionPlugin extends UIPlugin{constructor(){super(...arguments);this.col=0;this.row=0;this.mode="inactive";this.sheet="";this.currentContent="";this.currentTokens=[];this.selectionStart=0;this.selectionEnd=0;this.selectionInitialStart=0;this.multiSelectionInitialStart=0;this.initialContent="";this.previousRef="";this.previousRange=undefined;this.colorIndexByRange={};}
allowDispatch(cmd){switch(cmd.type){case"CHANGE_COMPOSER_CURSOR_SELECTION":return this.validateSelection(this.currentContent.length,cmd.start,cmd.end);case"SET_CURRENT_CONTENT":if(cmd.selection){return this.validateSelection(cmd.content.length,cmd.selection.start,cmd.selection.end);}
else{return 0;}
case"START_EDITION":if(cmd.selection){const cell=this.getters.getActiveCell();const content=cmd.text||(cell===null||cell===void 0?void 0:cell.composerContent)||"";return this.validateSelection(content.length,cmd.selection.start,cmd.selection.end);}
else{return 0;}
default:return 0;}}
handle(cmd){switch(cmd.type){case"CHANGE_COMPOSER_CURSOR_SELECTION":this.selectionStart=cmd.start;this.selectionEnd=cmd.end;break;case"STOP_COMPOSER_RANGE_SELECTION":if(this.isSelectingForComposer()){this.mode="editing";}
break;case"START_EDITION":this.startEdition(cmd.text,cmd.selection);break;case"STOP_EDITION":if(cmd.cancel){this.cancelEdition();this.resetContent();}
else{this.stopEdition();}
break;case"SET_CURRENT_CONTENT":this.setContent(cmd.content,cmd.selection);break;case"REPLACE_COMPOSER_CURSOR_SELECTION":this.replaceSelection(cmd.text);break;case"SELECT_FIGURE":this.cancelEdition();this.resetContent();break;case"SELECT_CELL":case"SET_SELECTION":case"MOVE_POSITION":switch(this.mode){case"editing":this.dispatch("STOP_EDITION");break;case"waitingForRangeSelection":this.insertSelectedRange();break;case"rangeSelected":switch(cmd.type){case"MOVE_POSITION":this.replaceAllSelectedRanges();break;case"SELECT_CELL":if(this.getters.getSelectionMode()===SelectionMode.expanding){this.insertSelectedRange();}
else{this.replaceAllSelectedRanges();}
break;case"SET_SELECTION":if(!cmd.strict){this.replaceSelectedRange();}
else if(this.getters.getSelectionMode()===SelectionMode.expanding){this.insertSelectedRange();}
else{this.replaceAllSelectedRanges();}
break;}
break;}
break;case"ADD_COLUMNS_ROWS":this.onAddElements(cmd);break;case"REMOVE_COLUMNS_ROWS":if(cmd.dimension==="COL"){this.onColumnsRemoved(cmd);}
else{this.onRowsRemoved(cmd);}
break;case"START_CHANGE_HIGHLIGHT":this.dispatch("STOP_COMPOSER_RANGE_SELECTION");const previousRefToken=this.currentTokens.filter((token)=>token.type==="SYMBOL").find((token)=>{let value=token.value;const[xc,sheet]=value.split("!").reverse();const sheetName=sheet||this.getters.getSheetName(this.sheet);const activeSheetId=this.getters.getActiveSheetId();return(isEqual(this.getters.expandZone(activeSheetId,toZone(xc)),cmd.zone)&&this.getters.getSheetName(activeSheetId)===sheetName);});this.previousRef=previousRefToken.value;this.previousRange=this.getters.getRangeFromSheetXC(this.getters.getActiveSheetId(),this.previousRef);this.selectionInitialStart=previousRefToken.start;break;case"CHANGE_HIGHLIGHT":const newRef=this.getZoneReference(cmd.zone,this.previousRange.parts);this.selectionStart=this.selectionInitialStart;this.selectionEnd=this.selectionInitialStart+this.previousRef.length;this.replaceSelection(newRef);this.previousRef=newRef;this.selectionStart=this.currentContent.length;this.selectionEnd=this.currentContent.length;break;case"DELETE_SHEET":case"UNDO":case"REDO":const sheetIdExists=!!this.getters.tryGetSheet(this.sheet);if(!sheetIdExists&&this.mode!=="inactive"){this.cancelEdition();this.resetContent();this.ui.notifyUser(CELL_DELETED_MESSAGE);}
break;}}
getEditionMode(){return this.mode;}
getCurrentContent(){if(this.mode==="inactive"){const cell=this.getters.getActiveCell();return(cell===null||cell===void 0?void 0:cell.composerContent)||"";}
return this.currentContent;}
getEditionSheet(){return this.sheet;}
getComposerSelection(){return{start:this.selectionStart,end:this.selectionEnd,};}
isSelectingForComposer(){return(this.mode==="waitingForRangeSelection"||this.mode==="rangeSelected"||this.mode==="resettingPosition");}
getCurrentTokens(){return this.currentTokens;}
getTokenAtCursor(){const start=Math.min(this.selectionStart,this.selectionEnd);const end=Math.max(this.selectionStart,this.selectionEnd);if(start===end&&end===0){return undefined;}
else{return this.currentTokens.find((t)=>t.start<=start&&t.end>=end);}}
validateSelection(length,start,end){return start>=0&&start<=length&&end>=0&&end<=length?0:29;}
onColumnsRemoved(cmd){if(cmd.elements.includes(this.col)&&this.mode!=="inactive"){this.dispatch("STOP_EDITION",{cancel:true});this.ui.notifyUser(CELL_DELETED_MESSAGE);return;}
const{top,left}=updateSelectionOnDeletion({left:this.col,right:this.col,top:this.row,bottom:this.row},"left",cmd.elements);this.col=left;this.row=top;}
onRowsRemoved(cmd){if(cmd.elements.includes(this.row)&&this.mode!=="inactive"){this.dispatch("STOP_EDITION",{cancel:true});this.ui.notifyUser(CELL_DELETED_MESSAGE);return;}
const{top,left}=updateSelectionOnDeletion({left:this.col,right:this.col,top:this.row,bottom:this.row},"top",cmd.elements);this.col=left;this.row=top;}
onAddElements(cmd){const{top,left}=updateSelectionOnInsertion({left:this.col,right:this.col,top:this.row,bottom:this.row},cmd.dimension==="COL"?"left":"top",cmd.base,cmd.position,cmd.quantity);this.col=left;this.row=top;}
startComposerRangeSelection(){this.mode="resettingPosition";this.dispatch("SELECT_CELL",{col:this.col,row:this.row,});this.mode="waitingForRangeSelection";this.multiSelectionInitialStart=this.selectionStart;}
startEdition(str,selection){const cell=this.getters.getActiveCell();this.initialContent=(cell===null||cell===void 0?void 0:cell.composerContent)||"";this.mode="editing";const[col,row]=this.getters.getPosition();this.col=col;this.row=row;this.sheet=this.getters.getActiveSheetId();this.setContent(str||this.initialContent,selection);this.colorIndexByRange={};}
stopEdition(){if(this.mode!=="inactive"){this.cancelEdition();const sheetId=this.getters.getActiveSheetId();const mergeSheetId=this.getters.getSheets().find((sheet)=>sheet.id===this.sheet).id;const[col,row]=this.getters.getMainCell(mergeSheetId,this.col,this.row);let content=this.currentContent;const didChange=this.initialContent!==content;if(!didChange){return;}
if(content){const cell=this.getters.getCell(sheetId,col,row);if(content.startsWith("=")){const left=this.currentTokens.filter((t)=>t.type==="LEFT_PAREN").length;const right=this.currentTokens.filter((t)=>t.type==="RIGHT_PAREN").length;const missing=left-right;if(missing>0){content+=new Array(missing).fill(")").join("");}}
else if(cell===null||cell===void 0?void 0:cell.isLink()){content=markdownLink(content,cell.link.url);}
this.dispatch("UPDATE_CELL",{sheetId:this.sheet,col,row,content,});}
else{this.dispatch("UPDATE_CELL",{sheetId:this.sheet,content:"",col,row,});}
if(sheetId!==this.sheet){this.dispatch("ACTIVATE_SHEET",{sheetIdFrom:this.getters.getActiveSheetId(),sheetIdTo:this.sheet,});}
this.setContent("");}}
cancelEdition(){this.mode="inactive";}
resetContent(){this.setContent(this.initialContent||"");}
setContent(text,selection){const isNewCurrentContent=this.currentContent!==text;this.currentContent=text;if(selection){this.selectionStart=selection.start;this.selectionEnd=selection.end;}
else{this.selectionStart=this.selectionEnd=text.length;}
if(isNewCurrentContent||this.mode!=="inactive"){this.currentTokens=text.startsWith("=")?composerTokenize(text):[];}
if(this.canStartComposerRangeSelection()){this.startComposerRangeSelection();}}
insertSelectedRange(){const start=Math.min(this.selectionStart,this.selectionEnd);const ref=this.getZoneReference(this.getters.getSelectedZone());if(this.mode==="waitingForRangeSelection"){this.insertText(ref,start);this.selectionInitialStart=start;this.mode="rangeSelected";return;}
this.insertText(","+ref,start);this.selectionInitialStart=start+1;}
replaceSelectedRange(){const{end}=this.getters.getComposerSelection();this.dispatch("CHANGE_COMPOSER_CURSOR_SELECTION",{start:this.selectionInitialStart,end,});this.replaceSelection(this.getZoneReference(this.getters.getSelectedZone()));}
replaceAllSelectedRanges(){const{end}=this.getters.getComposerSelection();this.dispatch("CHANGE_COMPOSER_CURSOR_SELECTION",{start:this.multiSelectionInitialStart,end,});this.replaceSelection(this.getZoneReference(this.getters.getSelectedZone()));this.selectionInitialStart=this.multiSelectionInitialStart;}
getZoneReference(zone,fixedParts=[{colFixed:false,rowFixed:false}]){const sheetId=this.getters.getActiveSheetId();let selectedXc=this.getters.zoneToXC(sheetId,zone,fixedParts);if(this.getters.getEditionSheet()!==this.getters.getActiveSheetId()){const sheetName=getComposerSheetName(this.getters.getSheetName(this.getters.getActiveSheetId()));selectedXc=`${sheetName}!${selectedXc}`;}
return selectedXc;}
replaceSelection(text){const start=Math.min(this.selectionStart,this.selectionEnd);const end=Math.max(this.selectionStart,this.selectionEnd);this.replaceText(text,start,end);}
replaceText(text,start,end){this.currentContent=this.currentContent.slice(0,start)+
this.currentContent.slice(end,this.currentContent.length);this.insertText(text,start);}
insertText(text,start){const content=this.currentContent.slice(0,start)+text+this.currentContent.slice(start);const end=start+text.length;this.dispatch("SET_CURRENT_CONTENT",{content,selection:{start:end,end},});}
getComposerHighlights(){if(!this.currentContent.startsWith("=")||this.mode==="inactive"){return[];}
const ranges=[];const colorIndexByRange={};for(let token of this.currentTokens.filter((token)=>token.type==="SYMBOL")){let value=token.value;const[xc,sheet]=value.split("!").reverse();if(rangeReference.test(xc)){const refSanitized=(sheet?`${sheet}!`:`${this.getters.getSheetName(this.getters.getEditionSheet())}!`)+
xc.replace(/\$/g,"");ranges.push(refSanitized);const colorIndex=this.colorIndexByRange[refSanitized];if(colorIndex!==undefined){colorIndexByRange[refSanitized]=colorIndex;}}}
this.colorIndexByRange=colorIndexByRange;let colorIndexes=Object.values(colorIndexByRange);let nextColorIndex=0;return ranges.map((r)=>{if(this.colorIndexByRange[r]===undefined){while(colorIndexes.includes(nextColorIndex)){nextColorIndex++;}
colorIndexes.push(nextColorIndex);this.colorIndexByRange[r]=nextColorIndex;}
return[r,colors$1[this.colorIndexByRange[r]%colors$1.length]];});}
canStartComposerRangeSelection(){if(this.mode!=="editing"&&this.selectionStart===this.selectionEnd){return false;}
if(this.currentContent.startsWith("=")){const tokenAtCursor=this.getTokenAtCursor();if(tokenAtCursor){const tokenIdex=this.currentTokens.map((token)=>token.start).indexOf(tokenAtCursor.start);let count=tokenIdex;let currentToken=tokenAtCursor;while(!["COMMA","LEFT_PAREN","OPERATOR"].includes(currentToken.type)){if(currentToken.type!=="SPACE"||count<1){return false;}
count--;currentToken=this.currentTokens[count];}
count=tokenIdex+1;currentToken=this.currentTokens[count];while(currentToken&&!["COMMA","RIGHT_PAREN","OPERATOR"].includes(currentToken.type)){if(currentToken.type!=="SPACE"){return false;}
count++;currentToken=this.currentTokens[count];}
count++;currentToken=this.currentTokens[count];}
return true;}
return false;}}
EditionPlugin.getters=["getEditionMode","isSelectingForComposer","getCurrentContent","getEditionSheet","getComposerSelection","getCurrentTokens","getTokenAtCursor","getComposerHighlights",];EditionPlugin.modes=["normal"];const functionMap=functionRegistry.mapping;class EvaluationPlugin extends UIPlugin{constructor(getters,state,dispatch,config){super(getters,state,dispatch,config);this.isUpToDate=new Set();this.evalContext=config.evalContext;config.dataSources.on("data-loaded",this,()=>{this.dispatch("EVALUATE_CELLS",{sheetId:this.getters.getActiveSheetId()});});}
handle(cmd){if(invalidateEvaluationCommands.has(cmd.type)){this.isUpToDate.clear();}
switch(cmd.type){case"UPDATE_CELL":if("content"in cmd){this.isUpToDate.clear();}
break;case"EVALUATE_CELLS":this.evaluate(cmd.sheetId);this.isUpToDate.add(cmd.sheetId);break;case"EVALUATE_ALL_SHEETS":this.evaluateAllSheets();break;}}
finalize(){const sheetId=this.getters.getActiveSheetId();if(!this.isUpToDate.has(sheetId)){this.evaluate(sheetId);this.isUpToDate.add(sheetId);}}
evaluateFormula(formulaString,sheetId=this.getters.getActiveSheetId()){let formula=normalize(formulaString);const compiledFormula=compile(formula);const params=this.getFormulaParameters(()=>{});const ranges=[];for(let xc of formula.dependencies.references){ranges.push(this.getters.getRangeFromSheetXC(sheetId,xc));}
const dependencies={...formula.dependencies,references:ranges};return compiledFormula(dependencies,sheetId,...params);}
getRangeFormattedValues(range){const sheet=this.getters.tryGetSheet(range.sheetId);if(sheet===undefined)
return[[]];return mapCellsInZone(range.zone,sheet,(cell)=>this.getters.getCellText(cell,this.getters.shouldShowFormulas()),"");}
getRangeValues(range){const sheet=this.getters.tryGetSheet(range.sheetId);if(sheet===undefined)
return[[]];return mapCellsInZone(range.zone,sheet,(cell)=>cell.evaluated.value);}
evaluate(sheetId){const cells=this.getters.getCells(sheetId);const params=this.getFormulaParameters(computeValue);const visited={};for(let cell of Object.values(cells)){if(cell.isFormula()){cell.startEvaluation();}}
for(let cell of Object.values(cells)){computeValue(cell,sheetId);}
function handleError(e,cell){if(!(e instanceof Error)){e=new Error(e);}
if(cell.evaluated.type!==CellValueType.error){cell.assignValue("#ERROR");const __lastFnCalled=params[2].__lastFnCalled||"";cell.assignError("#ERROR",e.message.replace("[[FUNCTION_NAME]]",__lastFnCalled));}}
function computeValue(cell,sheetId){if(!cell.isFormula()){return;}
const position=params[2].getters.getCellPosition(cell.id);const xc=toXC(position.col,position.row);visited[sheetId]=visited[sheetId]||{};if(xc in visited[sheetId]){if(visited[sheetId][xc]===null){cell.assignError("#CYCLE",_lt("Circular reference"));}
return;}
visited[sheetId][xc]=null;try{params[2].__originCellXC=xc;cell.assignValue(cell.compiledFormula(cell.dependencies,sheetId,...params));if(Array.isArray(cell.evaluated.value)){throw new Error(_lt("This formula depends on invalid values"));}}
catch(e){handleError(e,cell);}
visited[sheetId][xc]=true;}}
getFormulaParameters(computeValue){const evalContext=Object.assign(Object.create(functionMap),this.evalContext,{getters:this.getters,});const sheets=this.getters.getEvaluationSheets();function readCell(range){var _a;let cell;const s=sheets[range.sheetId];if(s){cell=(_a=s.rows[range.zone.top])===null||_a===void 0?void 0:_a.cells[range.zone.left];}
else{throw new Error(_lt("Invalid sheet name"));}
if(!cell||cell.isEmpty()){return null;}
return getCellValue(cell,range.sheetId);}
function getCellValue(cell,sheetId){if(cell.isFormula()&&cell.evaluated.type===CellValueType.error){throw new Error(_lt("This formula depends on invalid values"));}
computeValue(cell,sheetId);if(cell.evaluated.type===CellValueType.error){throw new Error(_lt("This formula depends on invalid values"));}
return cell.evaluated.value;}
function _range(range){const sheet=sheets[range.sheetId];if(!isZoneValid(range.zone)){throw new Error(_lt("Invalid reference"));}
const sheetZone={top:0,bottom:sheet.rows.length-1,left:0,right:sheet.cols.length-1,};if(!overlap(range.zone,sheetZone)){return[[]];}
return mapCellsInZone(range.zone,sheet,(cell)=>getCellValue(cell,range.sheetId));}
function refFn(position,references,sheetId,isMeta,functionName,paramNumber){const range=references[position];if(isMeta){return evalContext.getters.getRangeString(range,sheetId);}
if(!isZoneValid(range.zone)){throw new Error(_lt("Invalid reference"));}
if(range.zone.bottom!==range.zone.top||range.zone.left!==range.zone.right){throw new Error(paramNumber?_lt("Function %s expects the parameter %s to be a single value or a single cell reference, not a range.",functionName.toString(),paramNumber.toString()):_lt("Function %s expects its parameters to be single values or single cell references, not ranges.",functionName.toString()));}
if(range.invalidSheetName){throw new Error(_lt("Invalid sheet name: %s",range.invalidSheetName));}
return readCell(range);}
function range(position,references,sheetId){return _range(references[position]);}
return[refFn,range,evalContext];}
evaluateAllSheets(){for(const sheetId of this.getters.getVisibleSheets()){this.evaluate(sheetId);this.isUpToDate.add(sheetId);}}}
EvaluationPlugin.getters=["evaluateFormula","getRangeFormattedValues","getRangeValues"];EvaluationPlugin.modes=["normal"];const GraphColors=["rgb(31,119,180)","rgb(255,127,14)","rgb(174,199,232)","rgb(255,187,120)","rgb(44,160,44)","rgb(152,223,138)","rgb(214,39,40)","rgb(255,152,150)","rgb(148,103,189)","rgb(197,176,213)","rgb(140,86,75)","rgb(196,156,148)","rgb(227,119,194)","rgb(247,182,210)","rgb(127,127,127)","rgb(199,199,199)","rgb(188,189,34)","rgb(219,219,141)","rgb(23,190,207)","rgb(158,218,229)",];class ChartColors{constructor(){this.graphColorIndex=0;}
next(){return GraphColors[this.graphColorIndex++%GraphColors.length];}}
class EvaluationChartPlugin extends UIPlugin{constructor(){super(...arguments);this.chartRuntime={};this.outOfDate=new Set();}
beforeHandle(cmd){switch(cmd.type){case"REMOVE_COLUMNS_ROWS":const sheet=this.getters.getSheet(cmd.sheetId);const length=cmd.dimension==="ROW"?sheet.cols.length:sheet.rows.length;const zones=cmd.elements.map((el)=>({top:cmd.dimension==="ROW"?el:0,bottom:cmd.dimension==="ROW"?el:length-1,left:cmd.dimension==="ROW"?0:el,right:cmd.dimension==="ROW"?length-1:el,}));for(const chartId of Object.keys(this.chartRuntime)){if(this.areZonesUsedInChart(cmd.sheetId,zones,chartId)){this.outOfDate.add(chartId);}}
break;}}
handle(cmd){switch(cmd.type){case"UPDATE_CHART":case"CREATE_CHART":const chartDefinition=this.getters.getChartDefinition(cmd.id);if(chartDefinition){this.chartRuntime[cmd.id]=this.mapDefinitionToRuntime(chartDefinition);}
break;case"DELETE_FIGURE":delete this.chartRuntime[cmd.id];break;case"REFRESH_CHART":this.evaluateUsedSheets([cmd.id]);this.outOfDate.add(cmd.id);break;case"ACTIVATE_SHEET":const chartsIds=this.getters.getChartsIdBySheet(cmd.sheetIdTo);this.evaluateUsedSheets(chartsIds);break;case"UPDATE_CELL":for(let chartId of Object.keys(this.chartRuntime)){if(this.isCellUsedInChart(cmd.sheetId,chartId,cmd.col,cmd.row)){this.outOfDate.add(chartId);}}
break;case"DELETE_SHEET":for(let chartId of Object.keys(this.chartRuntime)){if(!this.getters.getChartDefinition(chartId)){delete this.chartRuntime[chartId];}}
break;case"ADD_COLUMNS_ROWS":const sheet=this.getters.getSheet(cmd.sheetId);const numberOfElem=cmd.dimension==="ROW"?sheet.cols.length:sheet.rows.length;const offset=cmd.position==="before"?0:1;const zone={top:cmd.dimension==="ROW"?cmd.base+offset:0,bottom:cmd.dimension==="ROW"?cmd.base+cmd.quantity+offset:numberOfElem-1,left:cmd.dimension==="ROW"?0:cmd.base+offset,right:cmd.dimension==="ROW"?numberOfElem-1:cmd.base+cmd.quantity+offset,};for(const chartId of Object.keys(this.chartRuntime)){if(this.areZonesUsedInChart(cmd.sheetId,[zone],chartId)){this.outOfDate.add(chartId);}}
break;case"UNDO":case"REDO":for(let chartId of Object.keys(this.chartRuntime)){this.outOfDate.add(chartId);}
break;case"EVALUATE_CELLS":for(let id in this.chartRuntime){this.outOfDate.add(id);}
break;}}
getChartRuntime(figureId){if(this.outOfDate.has(figureId)||!(figureId in this.chartRuntime)){const chartDefinition=this.getters.getChartDefinition(figureId);if(chartDefinition===undefined)
return;this.chartRuntime[figureId]=this.mapDefinitionToRuntime(chartDefinition);this.outOfDate.delete(figureId);}
return this.chartRuntime[figureId];}
truncateLabel(label){if(!label){return"";}
if(label.length>MAX_CHAR_LABEL){return label.substring(0,MAX_CHAR_LABEL)+"…";}
return label;}
getDefaultConfiguration(definition,labels){const legend={};if(!definition.labelRange&&definition.dataSets.length===1){legend.display=false;}
else{legend.position=definition.legendPosition;}
const config={type:definition.type,options:{legend,responsive:true,maintainAspectRatio:false,layout:{padding:{left:20,right:20,top:definition.title?10:25,bottom:10},},elements:{line:{fill:false,},point:{hitRadius:15,},},animation:{duration:0,},hover:{animationDuration:10,},responsiveAnimationDuration:0,title:{display:!!definition.title,fontSize:22,fontStyle:"normal",text:definition.title,},},data:{labels:labels.map(this.truncateLabel),datasets:[],},};if(definition.type!=="pie"){config.options.scales={xAxes:[{ticks:{maxRotation:60,minRotation:15,padding:5,labelOffset:2,},},],yAxes:[{position:definition.verticalAxisPosition,ticks:{beginAtZero:true,},},],};if(definition.type==="bar"&&definition.stackedBar){config.options.scales.xAxes[0].stacked=true;config.options.scales.yAxes[0].stacked=true;}}
else{config.options.tooltips={callbacks:{title:function(tooltipItems,data){return data.datasets[tooltipItems[0].datasetIndex].label;},},};}
return config;}
areZonesUsedInChart(sheetId,zones,chartId){const chartDefinition=this.getters.getChartDefinition(chartId);if(!chartDefinition||sheetId!==(chartDefinition===null||chartDefinition===void 0?void 0:chartDefinition.sheetId)){return false;}
const ranges=[...chartDefinition.dataSets.map((ds)=>ds.dataRange),chartDefinition.labelRange,].filter(isDefined);for(let zone of zones){for(let range of ranges){if(range.sheetId===sheetId&&overlap(range.zone,zone)){return true;}}}
return false;}
isCellUsedInChart(sheetId,chartId,col,row){const chartDefinition=this.getters.getChartDefinition(chartId);if(chartDefinition===undefined){return false;}
const ranges=[...chartDefinition.dataSets.map((ds)=>ds.dataRange),chartDefinition.labelRange,].filter(isDefined);for(let range of ranges){if(range.sheetId===sheetId&&isInside(col,row,range.zone)){return true;}}
return false;}
getSheetIdsUsedInChart(chartDefinition){const sheetIds=new Set();for(let ds of chartDefinition.dataSets){sheetIds.add(ds.dataRange.sheetId);}
if(chartDefinition.labelRange){sheetIds.add(chartDefinition.labelRange.sheetId);}
return sheetIds;}
evaluateUsedSheets(chartsIds){const usedSheetsId=new Set();for(let chartId of chartsIds){const chartDefinition=this.getters.getChartDefinition(chartId);const sheetsIds=chartDefinition!==undefined?this.getSheetIdsUsedInChart(chartDefinition):[];sheetsIds.forEach((sheetId)=>{if(sheetId!==this.getters.getActiveSheetId()){usedSheetsId.add(sheetId);}});}
for(let sheetId of usedSheetsId){this.dispatch("EVALUATE_CELLS",{sheetId});}}
mapDefinitionToRuntime(definition){let labels=[];if(definition.labelRange){if(!definition.labelRange.invalidXc&&!definition.labelRange.invalidSheetName){labels=this.getters.getRangeFormattedValues(definition.labelRange).flat(1);}}
else if(definition.dataSets.length===1){for(let i=0;i<this.getData(definition.dataSets[0],definition.sheetId).length;i++){labels.push("");}}
else{if(definition.dataSets[0]){const ranges=this.getData(definition.dataSets[0],definition.sheetId);labels=range(0,ranges.length).map((r)=>r.toString());}}
const runtime=this.getDefaultConfiguration(definition,labels);const colors=new ChartColors();const pieColors=[];if(definition.type==="pie"){const maxLength=Math.max(...definition.dataSets.map((ds)=>this.getData(ds,definition.sheetId).length));for(let i=0;i<=maxLength;i++){pieColors.push(colors.next());}}
for(const[dsIndex,ds]of Object.entries(definition.dataSets)){let label;if(ds.labelCell){const labelRange=ds.labelCell;const cell=labelRange?this.getters.getCell(labelRange.sheetId,labelRange.zone.left,labelRange.zone.top):undefined;label=cell&&labelRange?this.truncateLabel(cell.formattedValue):(label=`${chartTerms.Series} ${parseInt(dsIndex) + 1}`);}
else{label=label=`${chartTerms.Series} ${parseInt(dsIndex) + 1}`;}
const color=definition.type!=="pie"?colors.next():"#FFFFFF";const dataset={label,data:ds.dataRange?this.getData(ds,definition.sheetId):[],lineTension:0,borderColor:color,backgroundColor:color,};if(definition.type==="pie"){dataset.backgroundColor=pieColors;}
runtime.data.datasets.push(dataset);}
return runtime;}
getData(ds,sheetId){if(ds.dataRange){const labelCellZone=ds.labelCell?[zoneToXc(ds.labelCell.zone)]:[];const dataXC=recomputeZones([zoneToXc(ds.dataRange.zone)],labelCellZone)[0];if(dataXC===undefined){return[];}
const dataRange=this.getters.getRangeFromSheetXC(ds.dataRange.sheetId,dataXC);return this.getters.getRangeValues(dataRange).flat(1);}
return[];}}
EvaluationChartPlugin.getters=["getChartRuntime"];EvaluationChartPlugin.modes=["normal"];class EvaluationConditionalFormatPlugin extends UIPlugin{constructor(){super(...arguments);this.isStale=true;this.computedStyles={};this.computedIcons={};this.rulePredicate={CellIsRule:(cell,rule)=>{if(cell&&cell.evaluated.type===CellValueType.error){return false;}
const values=rule.values.map(parsePrimitiveContent);switch(rule.operator){case"IsEmpty":return!isDefined(cell)||cell.evaluated.value.toString().trim()==="";case"IsNotEmpty":return isDefined(cell)&&cell.evaluated.value.toString().trim()!=="";case"BeginsWith":if(!cell&&values[0]===""){return false;}
return(isDefined(cell)&&(cell===null||cell===void 0?void 0:cell.evaluated.value.toString().startsWith(values[0].toString())));case"EndsWith":if(!cell&&values[0]===""){return false;}
return isDefined(cell)&&cell.evaluated.value.toString().endsWith(values[0].toString());case"Between":return(isDefined(cell)&&cell.evaluated.value>=values[0]&&cell.evaluated.value<=values[1]);case"NotBetween":return!(isDefined(cell)&&cell.evaluated.value>=values[0]&&cell.evaluated.value<=values[1]);case"ContainsText":return(isDefined(cell)&&cell.evaluated.value.toString().indexOf(values[0].toString())>-1);case"NotContains":return(!isDefined(cell)||!cell.evaluated.value||cell.evaluated.value.toString().indexOf(values[0].toString())==-1);case"GreaterThan":return isDefined(cell)&&cell.evaluated.value>values[0];case"GreaterThanOrEqual":return isDefined(cell)&&cell.evaluated.value>=values[0];case"LessThan":return isDefined(cell)&&cell.evaluated.value<values[0];case"LessThanOrEqual":return isDefined(cell)&&cell.evaluated.value<=values[0];case"NotEqual":if(!isDefined(cell)&&values[0]===""){return false;}
return isDefined(cell)&&cell.evaluated.value!==values[0];case"Equal":if(!cell&&values[0]===""){return true;}
return isDefined(cell)&&cell.evaluated.value===values[0];default:console.warn(_lt("Not implemented operator %s for kind of conditional formatting:  %s",rule.operator,rule.type));}
return false;},};}
handle(cmd){switch(cmd.type){case"ACTIVATE_SHEET":const activeSheet=cmd.sheetIdTo;this.computedStyles[activeSheet]=this.computedStyles[activeSheet]||{};this.computedIcons[activeSheet]=this.computedIcons[activeSheet]||{};this.isStale=true;break;case"AUTOFILL_CELL":const sheetId=this.getters.getActiveSheetId();const cfOrigin=this.getters.getRulesByCell(sheetId,cmd.originCol,cmd.originRow);for(const cf of cfOrigin){this.adaptRules(sheetId,cf,[toXC(cmd.col,cmd.row)],[]);}
break;case"PASTE_CONDITIONAL_FORMAT":this.pasteCf(cmd.origin,cmd.target,cmd.operation);break;case"DUPLICATE_SHEET":case"CREATE_SHEET":case"DELETE_SHEET":case"ADD_CONDITIONAL_FORMAT":case"REMOVE_CONDITIONAL_FORMAT":case"REMOVE_COLUMNS_ROWS":case"ADD_COLUMNS_ROWS":case"EVALUATE_CELLS":case"UPDATE_CELL":case"UNDO":case"REDO":case"DELETE_CELL":case"INSERT_CELL":this.isStale=true;break;}}
finalize(){if(this.isStale){this.computeStyles();this.isStale=false;}}
getConditionalStyle(col,row){var _a;const activeSheet=this.getters.getActiveSheetId();const styles=this.computedStyles[activeSheet];return styles&&((_a=styles[col])===null||_a===void 0?void 0:_a[row]);}
getConditionalIcon(col,row){var _a;const activeSheet=this.getters.getActiveSheetId();const icon=this.computedIcons[activeSheet];return icon&&((_a=icon[col])===null||_a===void 0?void 0:_a[row]);}
computeStyles(){var _a;const activeSheetId=this.getters.getActiveSheetId();this.computedStyles[activeSheetId]={};this.computedIcons[activeSheetId]={};const computedStyle=this.computedStyles[activeSheetId];for(let cf of this.getters.getConditionalFormats(activeSheetId)){try{switch(cf.rule.type){case"ColorScaleRule":for(let range of cf.ranges){this.applyColorScale(range,cf.rule);}
break;case"IconSetRule":for(let range of cf.ranges){this.applyIcon(range,cf.rule);}
break;default:for(let ref of cf.ranges){const zone=toZone(ref);for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){const pr=this.rulePredicate[cf.rule.type];let cell=this.getters.getCell(activeSheetId,col,row);if(pr&&pr(cell,cf.rule)){if(!computedStyle[col])
computedStyle[col]=[];computedStyle[col][row]=Object.assign(((_a=computedStyle[col])===null||_a===void 0?void 0:_a[row])||{},cf.rule.style);}}}}
break;}}
catch(_){}}}
parsePoint(range,threshold,functionName){switch(threshold.type){case"value":return this.getters.evaluateFormula(`=${functionName}(${range})`);case"number":return Number(threshold.value);case"percentage":const min=this.getters.evaluateFormula(`=min(${range})`);const max=this.getters.evaluateFormula(`=max(${range})`);const delta=max-min;return min+(delta*Number(threshold.value))/100;case"percentile":return this.getters.evaluateFormula(`=PERCENTILE(${range},${Number(threshold.value) / 100})`);case"formula":const value=threshold.value&&this.getters.evaluateFormula(threshold.value);return!(value instanceof Promise)?value:null;default:return null;}}
applyIcon(range,rule){const lowerInflectionPoint=this.parsePoint(range,rule.lowerInflectionPoint);const upperInflectionPoint=this.parsePoint(range,rule.upperInflectionPoint);if(lowerInflectionPoint===null||upperInflectionPoint===null||lowerInflectionPoint>upperInflectionPoint){return;}
const zone=toZone(range);const activeSheetId=this.getters.getActiveSheetId();const computedIcons=this.computedIcons[activeSheetId];const iconSet=[rule.icons.upper,rule.icons.middle,rule.icons.lower];for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){const cell=this.getters.getCell(activeSheetId,col,row);if((cell===null||cell===void 0?void 0:cell.evaluated.type)!==CellValueType.number){continue;}
const icon=this.computeIcon(cell.evaluated.value,upperInflectionPoint,rule.upperInflectionPoint.operator,lowerInflectionPoint,rule.lowerInflectionPoint.operator,iconSet);if(!computedIcons[col]){computedIcons[col]=[];}
computedIcons[col][row]=icon;}}}
computeIcon(value,upperInflectionPoint,upperOperator,lowerInflectionPoint,lowerOperator,icons){if((upperOperator==="ge"&&value>=upperInflectionPoint)||(upperOperator==="gt"&&value>upperInflectionPoint)){return icons[0];}
else if((lowerOperator==="ge"&&value>=lowerInflectionPoint)||(lowerOperator==="gt"&&value>lowerInflectionPoint)){return icons[1];}
return icons[2];}
applyColorScale(range,rule){var _a;const minValue=this.parsePoint(range,rule.minimum,"min");const midValue=rule.midpoint?this.parsePoint(range,rule.midpoint):null;const maxValue=this.parsePoint(range,rule.maximum,"max");if(minValue===null||maxValue===null||minValue>=maxValue||(midValue&&(minValue>=midValue||midValue>=maxValue))){return;}
const zone=toZone(range);const activeSheetId=this.getters.getActiveSheetId();const computedStyle=this.computedStyles[activeSheetId];const colorCellArgs=[];if(rule.midpoint&&midValue){colorCellArgs.push({minValue,minColor:rule.minimum.color,colorDiffUnit:this.computeColorDiffUnits(minValue,midValue,rule.minimum.color,rule.midpoint.color),});colorCellArgs.push({minValue:midValue,minColor:rule.midpoint.color,colorDiffUnit:this.computeColorDiffUnits(midValue,maxValue,rule.midpoint.color,rule.maximum.color),});}
else{colorCellArgs.push({minValue,minColor:rule.minimum.color,colorDiffUnit:this.computeColorDiffUnits(minValue,maxValue,rule.minimum.color,rule.maximum.color),});}
for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){const cell=this.getters.getCell(activeSheetId,col,row);if((cell===null||cell===void 0?void 0:cell.evaluated.type)===CellValueType.number){const value=clip(cell.evaluated.value,minValue,maxValue);let color;if(colorCellArgs.length===2&&midValue){color=value<=midValue?this.colorCell(value,colorCellArgs[0].minValue,colorCellArgs[0].minColor,colorCellArgs[0].colorDiffUnit):this.colorCell(value,colorCellArgs[1].minValue,colorCellArgs[1].minColor,colorCellArgs[1].colorDiffUnit);}
else{color=this.colorCell(value,colorCellArgs[0].minValue,colorCellArgs[0].minColor,colorCellArgs[0].colorDiffUnit);}
if(!computedStyle[col])
computedStyle[col]=[];computedStyle[col][row]=((_a=computedStyle[col])===null||_a===void 0?void 0:_a[row])||{};computedStyle[col][row].fillColor="#"+colorNumberString(color);}}}}
computeColorDiffUnits(minValue,maxValue,minColor,maxColor){const deltaValue=maxValue-minValue;const deltaColorR=((minColor>>16)%256)-((maxColor>>16)%256);const deltaColorG=((minColor>>8)%256)-((maxColor>>8)%256);const deltaColorB=(minColor%256)-(maxColor%256);const colorDiffUnitR=deltaColorR/deltaValue;const colorDiffUnitG=deltaColorG/deltaValue;const colorDiffUnitB=deltaColorB/deltaValue;return[colorDiffUnitR,colorDiffUnitG,colorDiffUnitB];}
colorCell(value,minValue,minColor,colorDiffUnit){const[colorDiffUnitR,colorDiffUnitG,colorDiffUnitB]=colorDiffUnit;const r=Math.round(((minColor>>16)%256)-colorDiffUnitR*(value-minValue));const g=Math.round(((minColor>>8)%256)-colorDiffUnitG*(value-minValue));const b=Math.round((minColor%256)-colorDiffUnitB*(value-minValue));return(r<<16)|(g<<8)|b;}
adaptRules(sheetId,cf,toAdd,toRemove){if(toAdd.length===0&&toRemove.length===0){return;}
const rules=this.getters.getConditionalFormats(sheetId);const replaceIndex=rules.findIndex((c)=>c.id===cf.id);let currentRanges=[];if(replaceIndex>-1){currentRanges=rules[replaceIndex].ranges;}
currentRanges=currentRanges.concat(toAdd);const newRange=recomputeZones(currentRanges,toRemove);this.dispatch("ADD_CONDITIONAL_FORMAT",{cf:{id:cf.id,rule:cf.rule,stopIfTrue:cf.stopIfTrue,},target:newRange.map(toZone),sheetId,});}
pasteCf(origin,target,operation){const xc=toXC(target.col,target.row);for(let rule of this.getters.getConditionalFormats(origin.sheetId)){for(let range of rule.ranges){if(isInside(origin.col,origin.row,toZone(range))){const cf=rule;const toRemoveRange=[];if(operation==="CUT"){toRemoveRange.push(toXC(origin.col,origin.row));}
if(origin.sheetId===target.sheetId){this.adaptRules(origin.sheetId,cf,[xc],toRemoveRange);}
else{this.adaptRules(target.sheetId,cf,[xc],[]);this.adaptRules(origin.sheetId,cf,[],toRemoveRange);}}}}}}
EvaluationConditionalFormatPlugin.getters=["getConditionalStyle","getConditionalIcon"];EvaluationConditionalFormatPlugin.modes=["normal"];const BORDER_COLOR="#8B008B";const BACKGROUND_COLOR="#8B008B33";var Direction;(function(Direction){Direction[Direction["previous"]=-1]="previous";Direction[Direction["current"]=0]="current";Direction[Direction["next"]=1]="next";})(Direction||(Direction={}));class FindAndReplacePlugin extends UIPlugin{constructor(){super(...arguments);this.searchMatches=[];this.selectedMatchIndex=null;this.currentSearchRegex=null;this.searchOptions={matchCase:false,exactMatch:false,searchFormulas:false,};this.replaceOptions={modifyFormulas:false,};this.toSearch="";}
handle(cmd){switch(cmd.type){case"UPDATE_SEARCH":this.updateSearch(cmd.toSearch,cmd.searchOptions);break;case"CLEAR_SEARCH":this.clearSearch();break;case"SELECT_SEARCH_PREVIOUS_MATCH":this.selectNextCell(Direction.previous);break;case"SELECT_SEARCH_NEXT_MATCH":this.selectNextCell(Direction.next);break;case"REPLACE_SEARCH":this.replace(cmd.replaceWith,cmd.replaceOptions);break;case"REPLACE_ALL_SEARCH":this.replaceAll(cmd.replaceWith,cmd.replaceOptions);break;case"UNDO":case"REDO":case"REMOVE_COLUMNS_ROWS":case"ADD_COLUMNS_ROWS":this.clearSearch();break;case"ACTIVATE_SHEET":case"REFRESH_SEARCH":this.refreshSearch();break;}}
getSearchMatches(){return this.searchMatches;}
getCurrentSelectedMatchIndex(){return this.selectedMatchIndex;}
updateSearch(toSearch,searchOptions){this.searchOptions=searchOptions;if(toSearch!==this.toSearch){this.selectedMatchIndex=0;}
this.toSearch=toSearch;this.updateRegex();this.refreshSearch();}
refreshSearch(){const matches=this.findMatches();this.searchMatches=matches;this.selectNextCell(Direction.current);}
updateRegex(){let searchValue=this.toSearch;const flags=!this.searchOptions.matchCase?"i":"";if(this.searchOptions.exactMatch){searchValue=`^${searchValue}$`;}
this.currentSearchRegex=RegExp(searchValue,flags);}
findMatches(){const activeSheetId=this.getters.getActiveSheetId();const cells=this.getters.getCells(activeSheetId);const matches=[];if(this.toSearch){for(const cell of Object.values(cells)){if(cell&&this.currentSearchRegex&&this.currentSearchRegex.test(this.searchOptions.searchFormulas?cell.isFormula()?cell.content:String(cell.evaluated.value):String(cell.evaluated.value))){const position=this.getters.getCellPosition(cell.id);const match={col:position.col,row:position.row,selected:false};matches.push(match);}}}
return matches.sort(this.sortByRowThenColumn);}
sortByRowThenColumn(a,b){if(a.row===b.row){return a.col-b.col;}
return a.row>b.row?1:-1;}
selectNextCell(indexChange){const matches=this.searchMatches;if(!matches.length){this.selectedMatchIndex=null;return;}
let nextIndex;if(this.selectedMatchIndex===null){nextIndex=0;}
else{nextIndex=this.selectedMatchIndex+indexChange;}
nextIndex=((nextIndex%matches.length)+matches.length)%matches.length;if(this.selectedMatchIndex!==nextIndex){this.selectedMatchIndex=nextIndex;this.dispatch("SELECT_CELL",{col:matches[nextIndex].col,row:matches[nextIndex].row});}
for(let index=0;index<this.searchMatches.length;index++){this.searchMatches[index].selected=index===this.selectedMatchIndex;}}
clearSearch(){this.toSearch="";this.searchMatches=[];this.selectedMatchIndex=null;this.currentSearchRegex=null;this.searchOptions={matchCase:false,exactMatch:false,searchFormulas:false,};this.replaceOptions={modifyFormulas:false,};}
replace(replaceWith,replaceOptions){this.replaceOptions=replaceOptions;if(this.selectedMatchIndex===null||!this.currentSearchRegex){return;}
const matches=this.searchMatches;const selectedMatch=matches[this.selectedMatchIndex];const sheetId=this.getters.getActiveSheetId();const cellToReplace=this.getters.getCell(sheetId,selectedMatch.col,selectedMatch.row);const toReplace=this.toReplace(cellToReplace,sheetId);if(!cellToReplace||!toReplace){this.selectNextCell(Direction.next);}
else{const replaceRegex=new RegExp(this.currentSearchRegex.source,this.currentSearchRegex.flags+"g");const newContent=toReplace.toString().replace(replaceRegex,replaceWith);this.dispatch("UPDATE_CELL",{sheetId:this.getters.getActiveSheetId(),col:selectedMatch.col,row:selectedMatch.row,content:newContent,});this.searchMatches.splice(this.selectedMatchIndex,1);this.selectNextCell(Direction.current);}}
replaceAll(replaceWith,replaceOptions){const matchCount=this.searchMatches.length;for(let i=0;i<matchCount;i++){this.replace(replaceWith,replaceOptions);}}
toReplace(cell,sheetId){if(cell){if(this.searchOptions.searchFormulas&&cell.isFormula()){return cell.content;}
else if(this.replaceOptions.modifyFormulas||!cell.isFormula()){return cell.evaluated.value.toString();}}
return null;}
drawGrid(renderingContext){const{ctx,viewport}=renderingContext;const sheetId=this.getters.getActiveSheetId();for(const match of this.searchMatches){const merge=this.getters.getMerge(sheetId,match.col,match.row);const left=merge?merge.left:match.col;const right=merge?merge.right:match.col;const top=merge?merge.top:match.row;const bottom=merge?merge.bottom:match.row;const[x,y,width,height]=this.getters.getRect({top,left,right,bottom},viewport);if(width>0&&height>0){ctx.fillStyle=BACKGROUND_COLOR;ctx.fillRect(x,y,width,height);if(match.selected){ctx.strokeStyle=BORDER_COLOR;ctx.strokeRect(x,y,width,height);}}}}}
FindAndReplacePlugin.layers=[3];FindAndReplacePlugin.getters=["getSearchMatches","getCurrentSelectedMatchIndex"];class HighlightPlugin extends UIPlugin{getHighlights(){return this.prepareHighlights(this.getters.getComposerHighlights().concat(this.getters.getSelectionInputHighlights()));}
prepareHighlights(ranges){if(ranges.length===0){return[];}
const activeSheetId=this.getters.getActiveSheetId();const preparedHighlights=[];for(let[r1c1,color]of ranges){const[xc,sheet]=r1c1.split("!").reverse();const sheetId=sheet?this.getters.getSheetIdByName(sheet):activeSheetId;if(sheetId){const zone=this.getters.expandZone(activeSheetId,toZone(xc));preparedHighlights.push({zone,color,sheet:sheetId});}}
return preparedHighlights.filter((x)=>x.zone.top>=0&&x.zone.left>=0&&x.zone.bottom<this.getters.getSheet(x.sheet).rows.length&&x.zone.right<this.getters.getSheet(x.sheet).cols.length);}
drawGrid(renderingContext){const{ctx,viewport,thinLineWidth}=renderingContext;const sheetId=this.getters.getActiveSheetId();const lineWidth=3*thinLineWidth;ctx.lineWidth=lineWidth;for(let h of this.getHighlights().filter((highlight,index)=>this.getHighlights().findIndex((h)=>isEqual(h.zone,highlight.zone)&&h.sheet===sheetId)===index)){const[x,y,width,height]=this.getters.getRect(h.zone,viewport);if(width>0&&height>0){ctx.strokeStyle=h.color;ctx.strokeRect(x+lineWidth/2,y+lineWidth/2,width-lineWidth,height-lineWidth);ctx.globalCompositeOperation="source-over";ctx.fillStyle=h.color+"20";ctx.fillRect(x+lineWidth,y+lineWidth,width-2*lineWidth,height-2*lineWidth);}}}}
HighlightPlugin.modes=["normal"];HighlightPlugin.layers=[1];HighlightPlugin.getters=["getHighlights"];class InteractiveSortPlugin extends UIPlugin{handle(cmd){switch(cmd.type){case"SORT_CELLS":if(cmd.interactive){this.interactiveSortSelection(cmd.sheetId,{col:cmd.col,row:cmd.row},cmd.zone,cmd.sortDirection);}
break;}}
interactiveSortSelection(sheetId,anchor,zone,sortDirection){let result=DispatchResult.Success;let multiColumns=zone.right>zone.left;if(this.getters.doesIntersectMerge(sheetId,zone)){multiColumns=false;let table;for(let r=zone.top;r<=zone.bottom;r++){table=[];for(let c=zone.left;c<=zone.right;c++){let merge=this.getters.getMerge(sheetId,c,r);if(merge&&!table.includes(merge.id.toString())){table.push(merge.id.toString());}}
if(table.length>=2){multiColumns=true;break;}}}
if(multiColumns){result=this.dispatch("SORT_CELLS",{...anchor,sheetId,zone,sortDirection});}
else{const contiguousZone=this.getters.getContiguousZone(sheetId,zone);if(isEqual(contiguousZone,zone)){result=this.dispatch("SORT_CELLS",{...anchor,sheetId,zone,sortDirection,});}
else{this.ui.askConfirmation(_lt("We found data next to your selection. Since this data was not selected, it will not be sorted. Do you want to extend your selection?"),()=>{zone=contiguousZone;result=this.dispatch("SORT_CELLS",{...anchor,sheetId,zone,sortDirection,});},()=>{result=this.dispatch("SORT_CELLS",{...anchor,sheetId,zone,sortDirection,});});}}
if(result.isCancelledBecause(46)){this.dispatch("SET_SELECTION",{anchor:[anchor.col,anchor.row],zones:[zone],anchorZone:zone,});this.ui.notifyUser(_lt("Cannot sort. To sort, select only cells or only merges that have the same size."));}}}
InteractiveSortPlugin.modes=["normal"];function computeAlign(cell,isShowingFormulas){if(cell.isFormula()&&isShowingFormulas){return"left";}
return cell.defaultAlign;}
function searchIndex(headers,offset){let left=0;let right=headers.length-1;while(left<=right){const index=Math.floor((left+right)/2);const header=headers[index];if(offset<header.start){right=index-1;}
else if(offset>header.end){left=index+1;}
else if(header.isHidden){left+=1;}
else{return index;}}
return-1;}
class RendererPlugin extends UIPlugin{constructor(){super(...arguments);this.boxes=[];}
getColIndex(x,left,sheet){if(x<HEADER_WIDTH){return-1;}
const cols=(sheet||this.getters.getActiveSheet()).cols;const adjustedX=x-HEADER_WIDTH+cols[left].start+1;return searchIndex(cols,adjustedX);}
getRowIndex(y,top,sheet){if(y<HEADER_HEIGHT){return-1;}
const rows=(sheet||this.getters.getActiveSheet()).rows;const adjustedY=y-HEADER_HEIGHT+rows[top].start+1;return searchIndex(rows,adjustedY);}
getRect(zone,viewport){const{left,top,right,bottom}=zone;let{offsetY,offsetX}=viewport;offsetX-=HEADER_WIDTH;offsetY-=HEADER_HEIGHT;const{cols,rows}=this.getters.getActiveSheet();const x=Math.max(cols[left].start-offsetX,HEADER_WIDTH);const width=cols[right].end-offsetX-x;const y=Math.max(rows[top].start-offsetY,HEADER_HEIGHT);const height=rows[bottom].end-offsetY-y;return[x,y,width,height];}
isVisibleInViewport(col,row,viewport){const{right,left,top,bottom}=viewport;return row<=bottom&&row>=top&&col>=left&&col<=right;}
getEdgeScrollCol(x){let canEdgeScroll=false;let direction=0;let delay=0;const{width}=this.getters.getViewportDimension();const{width:gridWidth}=this.getters.getGridDimension(this.getters.getActiveSheet());const{left,offsetX}=this.getters.getActiveSnappedViewport();if(x<HEADER_WIDTH&&left>0){canEdgeScroll=true;direction=-1;delay=scrollDelay(HEADER_WIDTH-x);}
else if(x>width&&offsetX<gridWidth-width){canEdgeScroll=true;direction=+1;delay=scrollDelay(x-width);}
return{canEdgeScroll,direction,delay};}
getEdgeScrollRow(y){let canEdgeScroll=false;let direction=0;let delay=0;const{height}=this.getters.getViewportDimension();const{height:gridHeight}=this.getters.getGridDimension(this.getters.getActiveSheet());const{top,offsetY}=this.getters.getActiveSnappedViewport();if(y<HEADER_HEIGHT&&top>0){canEdgeScroll=true;direction=-1;delay=scrollDelay(HEADER_HEIGHT-y);}
else if(y>height&&offsetY<gridHeight-height){canEdgeScroll=true;direction=+1;delay=scrollDelay(y-height);}
return{canEdgeScroll,direction,delay};}
drawGrid(renderingContext,layer){switch(layer){case 0:this.boxes=this.getGridBoxes(renderingContext);this.drawBackground(renderingContext);this.drawCellBackground(renderingContext);this.drawBorders(renderingContext);this.drawTexts(renderingContext);this.drawIcon(renderingContext);break;case 7:this.drawHeaders(renderingContext);break;}}
drawBackground(renderingContext){const{ctx,viewport,thinLineWidth}=renderingContext;let{offsetX,offsetY,top,left,bottom,right}=viewport;const{width,height}=this.getters.getViewportDimension();const{cols,rows,id:sheetId}=this.getters.getActiveSheet();ctx.fillStyle="white";ctx.fillRect(0,0,width,height);offsetX-=HEADER_WIDTH;offsetY-=HEADER_HEIGHT;if(!this.getters.getGridLinesVisibility(sheetId)){return;}
ctx.lineWidth=2*thinLineWidth;ctx.strokeStyle=CELL_BORDER_COLOR;ctx.beginPath();const lineHeight=Math.min(height,rows[bottom].end-offsetY);for(let i=left;i<=right;i++){if(cols[i].isHidden){continue;}
const x=cols[i].end-offsetX;ctx.moveTo(x,0);ctx.lineTo(x,lineHeight);}
const lineWidth=Math.min(width,cols[right].end-offsetX);for(let i=top;i<=bottom;i++){if(rows[i].isHidden){continue;}
const y=rows[i].end-offsetY;ctx.moveTo(0,y);ctx.lineTo(lineWidth,y);}
ctx.stroke();}
drawCellBackground(renderingContext){const{ctx,thinLineWidth}=renderingContext;ctx.lineWidth=0.3*thinLineWidth;const inset=0.1*thinLineWidth;ctx.strokeStyle="#111";const areGridLinesVisible=this.getters.getGridLinesVisibility(this.getters.getActiveSheetId());for(let box of this.boxes){let style=box.style;if(style&&style.fillColor&&style.fillColor!=="#ffffff"){ctx.fillStyle=style.fillColor;ctx.fillRect(box.x,box.y,box.width,box.height);if(areGridLinesVisible){ctx.strokeRect(box.x+inset,box.y+inset,box.width-2*inset,box.height-2*inset);}}
if(box.error){ctx.fillStyle="red";ctx.beginPath();ctx.moveTo(box.x+box.width-5,box.y);ctx.lineTo(box.x+box.width,box.y);ctx.lineTo(box.x+box.width,box.y+5);ctx.fill();}}}
drawBorders(renderingContext){const{ctx,thinLineWidth}=renderingContext;for(let box of this.boxes){let border=box.border;if(border){const{x,y,width,height}=box;if(border.left){drawBorder(border.left,x,y,x,y+height);}
if(border.top){drawBorder(border.top,x,y,x+width,y);}
if(border.right){drawBorder(border.right,x+width,y,x+width,y+height);}
if(border.bottom){drawBorder(border.bottom,x,y+height,x+width,y+height);}}}
function drawBorder([style,color],x1,y1,x2,y2){ctx.strokeStyle=color;ctx.lineWidth=(style==="thin"?2:3)*thinLineWidth;ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();}}
drawTexts(renderingContext){const{ctx,thinLineWidth}=renderingContext;ctx.textBaseline="middle";let currentFont;for(let box of this.boxes){if(box.text){const style=box.style||{};const align=box.align;const italic=style.italic?"italic ":"";const weight=style.bold?"bold":DEFAULT_FONT_WEIGHT;const sizeInPt=style.fontSize||DEFAULT_FONT_SIZE;const size=fontSizeMap[sizeInPt];const font=`${italic}${weight} ${size}px ${DEFAULT_FONT}`;if(font!==currentFont){currentFont=font;ctx.font=font;}
ctx.fillStyle=style.textColor||"#000";let x;let y=box.y+box.height/2+1;if(align==="left"){x=box.x+(box.image?box.image.size+2*MIN_CF_ICON_MARGIN:MIN_CELL_TEXT_MARGIN);}
else if(align==="right"){x=box.x+box.width-MIN_CELL_TEXT_MARGIN;}
else{x=box.x+box.width/2;}
ctx.textAlign=align;if(box.clipRect){ctx.save();ctx.beginPath();ctx.rect(...box.clipRect);ctx.clip();}
ctx.fillText(box.text,Math.round(x),Math.round(y));if(style.strikethrough||style.underline){if(align==="right"){x=x-box.textWidth;}
else if(align==="center"){x=x-box.textWidth/2;}
if(style.strikethrough){ctx.fillRect(x,y,box.textWidth,2.6*thinLineWidth);}
if(style.underline){y=box.y+box.height/2+1+size/2;ctx.fillRect(x,y,box.textWidth,1.3*thinLineWidth);}}
if(box.clipRect){ctx.restore();}}}}
async drawIcon(renderingContext){const{ctx}=renderingContext;for(let box of this.boxes){if(box.image){let x=box.x;let y=box.y;const icon=box.image.image;const size=box.image.size;const margin=(box.height-size)/2;if(box.image.clipIcon){ctx.save();ctx.beginPath();ctx.rect(...box.image.clipIcon);ctx.clip();}
ctx.drawImage(icon,x+MIN_CF_ICON_MARGIN,y+margin,size,size);if(box.image.clipIcon){ctx.restore();}}}}
drawHeaders(renderingContext){const{ctx,viewport,thinLineWidth}=renderingContext;let{offsetX,offsetY,left,top,right,bottom}=viewport;const{width,height}=this.getters.getViewportDimension();offsetX-=HEADER_WIDTH;offsetY-=HEADER_HEIGHT;const selection=this.getters.getSelectedZones();const{cols,rows}=this.getters.getActiveSheet();const activeCols=this.getters.getActiveCols();const activeRows=this.getters.getActiveRows();ctx.fillStyle=BACKGROUND_HEADER_COLOR;ctx.font=`400 ${HEADER_FONT_SIZE}px ${DEFAULT_FONT}`;ctx.textAlign="center";ctx.textBaseline="middle";ctx.lineWidth=thinLineWidth;ctx.strokeStyle="#333";ctx.fillRect(0,0,width,HEADER_HEIGHT);ctx.fillRect(0,0,HEADER_WIDTH,height);ctx.fillStyle=BACKGROUND_HEADER_SELECTED_COLOR;for(let zone of selection){const x1=Math.max(HEADER_WIDTH,cols[zone.left].start-offsetX);const x2=Math.max(HEADER_WIDTH,cols[zone.right].end-offsetX);const y1=Math.max(HEADER_HEIGHT,rows[zone.top].start-offsetY);const y2=Math.max(HEADER_HEIGHT,rows[zone.bottom].end-offsetY);ctx.fillStyle=activeCols.has(zone.left)?BACKGROUND_HEADER_ACTIVE_COLOR:BACKGROUND_HEADER_SELECTED_COLOR;ctx.fillRect(x1,0,x2-x1,HEADER_HEIGHT);ctx.fillStyle=activeRows.has(zone.top)?BACKGROUND_HEADER_ACTIVE_COLOR:BACKGROUND_HEADER_SELECTED_COLOR;ctx.fillRect(0,y1,HEADER_WIDTH,y2-y1);}
ctx.beginPath();ctx.moveTo(HEADER_WIDTH,0);ctx.lineTo(HEADER_WIDTH,height);ctx.moveTo(0,HEADER_HEIGHT);ctx.lineTo(width,HEADER_HEIGHT);ctx.strokeStyle=HEADER_BORDER_COLOR;ctx.stroke();ctx.beginPath();for(let i=left;i<=right;i++){const col=cols[i];if(col.isHidden){continue;}
ctx.fillStyle=activeCols.has(i)?"#fff":TEXT_HEADER_COLOR;ctx.fillText(col.name,(col.start+col.end)/2-offsetX,HEADER_HEIGHT/2);ctx.moveTo(col.end-offsetX,0);ctx.lineTo(col.end-offsetX,HEADER_HEIGHT);}
for(let i=top;i<=bottom;i++){const row=rows[i];if(row.isHidden){continue;}
ctx.fillStyle=activeRows.has(i)?"#fff":TEXT_HEADER_COLOR;ctx.fillText(row.name,HEADER_WIDTH/2,(row.start+row.end)/2-offsetY);ctx.moveTo(0,row.end-offsetY);ctx.lineTo(HEADER_WIDTH,row.end-offsetY);}
ctx.stroke();}
hasContent(col,row){const sheetId=this.getters.getActiveSheetId();const cell=this.getters.getCell(sheetId,col,row);return(cell&&!cell.isEmpty())||this.getters.isInMerge(sheetId,col,row);}
getGridBoxes(renderingContext){const{viewport}=renderingContext;let{right,left,top,bottom,offsetX,offsetY}=viewport;offsetX-=HEADER_WIDTH;offsetY-=HEADER_HEIGHT;const showFormula=this.getters.shouldShowFormulas();const result=[];const{cols,rows,id:sheetId}=this.getters.getActiveSheet();for(let rowNumber=top;rowNumber<=bottom;rowNumber++){const row=rows[rowNumber];if(row.isHidden){continue;}
for(let colNumber=left;colNumber<=right;colNumber++){const col=cols[colNumber];if(col.isHidden){continue;}
let cell=row.cells[colNumber];const border=this.getters.getCellBorder(sheetId,colNumber,rowNumber);const conditionalStyle=this.getters.getConditionalStyle(colNumber,rowNumber);const iconStyle=this.getters.getConditionalIcon(colNumber,rowNumber);if(!this.getters.isInMerge(sheetId,colNumber,rowNumber)){if(cell){const text=this.getters.getCellText(cell,showFormula);let style=this.getters.getCellStyle(cell);if(conditionalStyle){style=Object.assign({},style,conditionalStyle);}
let align=text?(style&&style.align)||computeAlign(cell,showFormula):undefined;let clipRect=null;let clipIcon=null;const textWidth=this.getters.getTextWidth(cell);const fontsize=style.fontSize||DEFAULT_FONT_SIZE;const iconWidth=fontSizeMap[fontsize];const iconBoxWidth=iconStyle?iconWidth+2*MIN_CF_ICON_MARGIN:0;const contentWidth=iconBoxWidth+textWidth;const isOverflowing=contentWidth>cols[colNumber].size||fontSizeMap[fontsize]>row.size;if(isOverflowing&&cell.evaluated.type===CellValueType.number){align=align!=="center"?"left":align;}
if(iconStyle){const colWidth=col.end-col.start;clipRect=[col.start-offsetX+iconBoxWidth,row.start-offsetY,Math.max(0,colWidth-iconBoxWidth),row.size,];clipIcon=[col.start-offsetX,row.start-offsetY,Math.min(iconBoxWidth,colWidth),row.size,];}
else{if(isOverflowing){let c;let width;switch(align){case"left":c=colNumber;while(c<right&&!this.hasContent(c+1,rowNumber)){c++;}
width=cols[c].end-col.start;if(width<textWidth||fontSizeMap[fontsize]>row.size){clipRect=[col.start-offsetX,row.start-offsetY,width,row.size];}
break;case"right":c=colNumber;while(c>left&&!this.hasContent(c-1,rowNumber)){c--;}
width=col.end-cols[c].start;if(width<textWidth||fontSizeMap[fontsize]>row.size){clipRect=[cols[c].start-offsetX,row.start-offsetY,width,row.size];}
break;case"center":let c1=colNumber;while(c1>left&&!this.hasContent(c1-1,rowNumber)){c1--;}
let c2=colNumber;while(c2<right&&!this.hasContent(c2+1,rowNumber)){c2++;}
const colLeft=Math.min(c1,colNumber);const colRight=Math.max(c2,colNumber);width=cols[colRight].end-cols[colLeft].start;if(width<textWidth||colLeft===colNumber||colRight===colNumber||fontSizeMap[fontsize]>row.size){clipRect=[cols[colLeft].start-offsetX,row.start-offsetY,width,row.size,];}
break;}}}
result.push({x:col.start-offsetX,y:row.start-offsetY,width:col.size,height:row.size,text,textWidth,border,style,align,clipRect,error:cell.evaluated.type===CellValueType.error?cell.evaluated.error:undefined,image:iconStyle?{type:"icon",size:iconWidth,clipIcon,image:ICONS[iconStyle].img,}:undefined,});}
else{result.push({x:col.start-offsetX,y:row.start-offsetY,width:col.size,height:row.size,text:"",textWidth:0,border,style:conditionalStyle?conditionalStyle:null,align:undefined,clipRect:null,error:undefined,});}}}}
const activeSheetId=this.getters.getActiveSheetId();for(let merge of this.getters.getMerges(activeSheetId)){if(this.getters.isMergeHidden(activeSheetId,merge)){continue;}
if(overlap(merge,viewport)){const refCell=this.getters.getCell(activeSheetId,merge.left,merge.top);const borderTopLeft=this.getters.getCellBorder(activeSheetId,merge.left,merge.top);const borderBottomRight=this.getters.getCellBorder(activeSheetId,merge.right,merge.bottom);const width=cols[merge.right].end-cols[merge.left].start;let text,textWidth,style,align,border;style=refCell?this.getters.getCellStyle(refCell):null;if(refCell||borderBottomRight||borderTopLeft){text=refCell?this.getters.getCellText(refCell,showFormula):"";textWidth=refCell?this.getters.getTextWidth(refCell):null;const conditionalStyle=this.getters.getConditionalStyle(merge.topLeft.col,merge.topLeft.row);if(conditionalStyle){style=Object.assign({},style,conditionalStyle);}
align=text?(style&&style.align)||computeAlign(refCell,showFormula):null;border={bottom:borderBottomRight?borderBottomRight.bottom:null,left:borderTopLeft?borderTopLeft.left:null,right:borderBottomRight?borderBottomRight.right:null,top:borderTopLeft?borderTopLeft.top:null,};}
style=style||{};if(!style.fillColor||style.fillColor==="#ffffff"){style=Object.create(style);style.fillColor="#fff";}
const x=cols[merge.left].start-offsetX;const y=rows[merge.top].start-offsetY;const height=rows[merge.bottom].end-rows[merge.top].start;const iconStyle=this.getters.getConditionalIcon(merge.left,merge.top);const fontsize=style.fontSize||DEFAULT_FONT_SIZE;const iconWidth=fontSizeMap[fontsize];const iconBoxWidth=iconStyle?2*MIN_CF_ICON_MARGIN+iconWidth:0;const contentWidth=iconBoxWidth+textWidth;align=text&&(refCell===null||refCell===void 0?void 0:refCell.evaluated.type)===CellValueType.number&&contentWidth>width&&align!=="center"?"left":align;const clipRect=iconStyle?[x+iconBoxWidth,y,Math.max(0,width-iconBoxWidth),height]:[x,y,width,height];const clipIcon=iconStyle?[x,y,Math.min(iconBoxWidth,width),height]:null;result.push({x:x,y:y,width,height,text,textWidth,border,style,align,clipRect,error:refCell&&refCell.evaluated.type===CellValueType.error?refCell.evaluated.error:undefined,image:iconStyle?{type:"icon",clipIcon,size:iconWidth,image:ICONS[iconStyle].img,}:undefined,});}}
return result;}}
RendererPlugin.layers=[0,7];RendererPlugin.getters=["getColIndex","getRowIndex","getRect","isVisibleInViewport","getEdgeScrollCol","getEdgeScrollRow",];RendererPlugin.modes=["normal"];const uuidGenerator=new UuidGenerator();class SelectionInputPlugin extends UIPlugin{constructor(){super(...arguments);this.inputs={};this.activeSheets={};this.inputHasSingleRange={};this.focusedInputId=null;this.focusedRange=null;this.willAddNewRange=false;}
allowDispatch(cmd){switch(cmd.type){case"FOCUS_RANGE":const index=this.getIndex(cmd.id,cmd.rangeId);if(this.focusedInputId===cmd.id&&this.focusedRange===index){return 22;}
break;case"ADD_EMPTY_RANGE":if(this.inputHasSingleRange[cmd.id]&&this.inputs[cmd.id].length===1){return 23;}
break;}
return 0;}
handle(cmd){switch(cmd.type){case"ENABLE_NEW_SELECTION_INPUT":this.initInput(cmd.id,cmd.initialRanges||[],cmd.hasSingleRange);break;case"DISABLE_SELECTION_INPUT":if(this.focusedInputId===cmd.id){this.unfocus();}
delete this.inputs[cmd.id];delete this.activeSheets[cmd.id];delete this.inputHasSingleRange[cmd.id];break;case"UNFOCUS_SELECTION_INPUT":this.unfocus();break;case"FOCUS_RANGE":this.focus(cmd.id,this.getIndex(cmd.id,cmd.rangeId));break;case"CHANGE_RANGE":{const index=this.getIndex(cmd.id,cmd.rangeId);if(index!==null){const id=cmd.id;if(this.focusedInputId!==id||this.focusedRange!==index){this.dispatch("FOCUS_RANGE",{id,rangeId:this.inputs[id][index].id});}
const values=cmd.value.split(",").map((reference)=>reference.trim());this.setRange(id,index,values);}
break;}
case"ADD_EMPTY_RANGE":this.insertNewRange(cmd.id,this.inputs[cmd.id].length,[""]);this.focusLast(cmd.id);break;case"REMOVE_RANGE":const index=this.getIndex(cmd.id,cmd.rangeId);if(index!==null){this.removeRange(cmd.id,index);}
break;case"SELECT_CELL":case"SET_SELECTION":if(!this.focusedInputId){break;}
const all=this.getSelectionInputValue(this.focusedInputId);const selectedZones=this.inputHasSingleRange[this.focusedInputId]?[this.getters.getSelectedZone()]:this.getters.getSelectedZones();const selectedXCs=selectedZones.map(zoneToXc).filter((zoneXc)=>!all.includes(zoneXc));const inputSheetId=this.activeSheets[this.focusedInputId];const sheetId=this.getters.getActiveSheetId();const sheetName=this.getters.getSheetName(sheetId);this.add(selectedXCs.map((xc)=>sheetId===inputSheetId?xc:`${getComposerSheetName(sheetName)}!${xc}`));break;case"PREPARE_SELECTION_EXPANSION":{const[id,index]=[this.focusedInputId,this.focusedRange];if(id!==null&&index!==null&&!this.inputHasSingleRange[id]){this.willAddNewRange=this.inputs[id][index].xc.trim()!=="";}
break;}}}
getSelectionInput(id){if(!this.inputs[id]){return[];}
return this.inputs[id].map((input,index)=>Object.assign({},input,{color:this.focusedInputId===id&&this.focusedRange!==null&&this.isRangeValid(input.xc)?input.color:null,isFocused:this.focusedInputId===id&&this.focusedRange===index,}));}
isRangeValid(xc){if(!xc){return false;}
const[rangeXc,sheetName]=xc.split("!").reverse();return(rangeXc.match(rangeReference)!==null&&(sheetName===undefined||this.getters.getSheetIdByName(sheetName)!==undefined));}
getSelectionInputValue(id){return this.cleanInputs(this.inputs[id].map((range)=>{return range.xc?range.xc:"";}));}
getSelectionInputHighlights(){if(!this.focusedInputId){return[];}
return this.inputs[this.focusedInputId].map((input)=>this.inputToHighlights(this.focusedInputId,input)).flat();}
initInput(id,initialRanges,inputHasSingleRange=false){this.inputs[id]=[];this.insertNewRange(id,0,initialRanges);this.activeSheets[id]=this.getters.getActiveSheetId();this.inputHasSingleRange[id]=inputHasSingleRange;if(this.inputs[id].length===0){this.dispatch("ADD_EMPTY_RANGE",{id});}}
focus(id,index){this.focusedInputId=id;this.focusedRange=index;}
focusLast(id){this.focus(id,this.inputs[id].length-1);}
unfocus(){this.focusedInputId=null;this.focusedRange=null;}
add(newRanges){if(this.focusedInputId===null||this.focusedRange===null||this.getters.isSelectingForComposer()||newRanges.length===0){return;}
const mode=this.getters.getSelectionMode();if(mode===SelectionMode.expanding&&this.willAddNewRange){const id=this.focusedInputId;this.insertNewRange(id,this.inputs[id].length,newRanges);this.focusLast(this.focusedInputId);this.willAddNewRange=false;}
else{this.setRange(this.focusedInputId,this.focusedRange,newRanges);}}
setContent(id,index,xc){this.inputs[id][index]={...this.inputs[id][index],id:uuidGenerator.uuidv4(),xc,};}
insertNewRange(id,index,values){this.inputs[id].splice(index,0,...values.map((xc,i)=>({xc,id:(this.inputs[id].length+i+1).toString(),color:getNextColor(),})));}
setRange(id,index,values){const[,...additionalValues]=values;this.setContent(id,index,values[0]);this.insertNewRange(id,index+1,additionalValues);if(additionalValues.length){this.focus(id,index+additionalValues.length);}}
removeRange(id,index){this.inputs[id].splice(index,1);if(this.focusedInputId===id&&this.focusedRange!==null){this.focusLast(id);}}
inputToHighlights(id,{xc,color}){const ranges=this.cleanInputs([xc]).filter((range)=>this.isRangeValid(range)).filter((reference)=>this.shouldBeHighlighted(this.activeSheets[id],reference));if(ranges.length===0)
return[];const[fromInput,...otherRanges]=ranges;const highlights=[[fromInput,color||getNextColor()]];for(const range of otherRanges){highlights.push([range,getNextColor()]);}
return highlights;}
cleanInputs(ranges){return ranges.map((xc)=>xc.split(",")).flat().map((xc)=>xc.trim()).filter((xc)=>xc!=="");}
shouldBeHighlighted(inputSheetId,reference){const sheetName=reference.split("!").reverse()[1];const sheetId=this.getters.getSheetIdByName(sheetName);const activeSheetId=this.getters.getActiveSheet().id;const valid=this.isRangeValid(reference);return(valid&&(sheetId===activeSheetId||(sheetId===undefined&&activeSheetId===inputSheetId)));}
getIndex(id,rangeId){const index=this.inputs[id].findIndex((range)=>range.id===rangeId);return index>=0?index:null;}}
SelectionInputPlugin.modes=["normal"];SelectionInputPlugin.layers=[1];SelectionInputPlugin.getters=["getSelectionInput","getSelectionInputValue","isRangeValid","getSelectionInputHighlights",];class EventBus{constructor(){this.bus=new owl__namespace.core.EventBus();}
on(type,owner,callback){this.bus.on(type,owner,callback);}
trigger(type,payload){this.bus.trigger(type,payload);}
off(eventType,owner){this.bus.off(eventType,owner);}
clear(){this.bus.clear();}}
class Revision{constructor(id,clientId,commands,changes){this._commands=[];this._changes=[];this.id=id;this.clientId=clientId;this._commands=[...commands];this._changes=changes?[...changes]:[];}
setChanges(changes){this._changes=changes;}
get commands(){return this._commands;}
get changes(){return this._changes;}}
class ClientDisconnectedError extends Error{}
class Session extends EventBus{constructor(revisions,transportService,serverRevisionId=DEFAULT_REVISION_ID){super();this.revisions=revisions;this.transportService=transportService;this.serverRevisionId=serverRevisionId;this.clients={};this.clientId="local";this.pendingMessages=[];this.waitingAck=false;this.processedRevisions=new Set();this.uuidGenerator=new UuidGenerator();this.debouncedMove=owl__namespace.utils.debounce(this._move.bind(this),DEBOUNCE_TIME);}
save(commands,changes){if(!commands.length||!changes.length)
return;const revision=new Revision(this.uuidGenerator.uuidv4(),this.clientId,commands,changes);this.revisions.append(revision.id,revision);this.trigger("new-local-state-update",{id:revision.id});this.sendUpdateMessage({type:"REMOTE_REVISION",version:MESSAGE_VERSION,serverRevisionId:this.serverRevisionId,nextRevisionId:revision.id,clientId:revision.clientId,commands:revision.commands,});}
undo(revisionId){this.sendUpdateMessage({type:"REVISION_UNDONE",version:MESSAGE_VERSION,serverRevisionId:this.serverRevisionId,nextRevisionId:this.uuidGenerator.uuidv4(),undoneRevisionId:revisionId,});}
redo(revisionId){this.sendUpdateMessage({type:"REVISION_REDONE",version:MESSAGE_VERSION,serverRevisionId:this.serverRevisionId,nextRevisionId:this.uuidGenerator.uuidv4(),redoneRevisionId:revisionId,});}
move(position){this.debouncedMove(position);}
join(client){if(client){this.clients[client.id]=client;this.clientId=client.id;}
else{this.clients["local"]={id:"local",name:"local"};this.clientId="local";}
this.transportService.onNewMessage(this.clientId,this.onMessageReceived.bind(this));}
loadInitialMessages(messages){this.on("unexpected-revision-id",this,({revisionId})=>{throw new Error(`The spreadsheet could not be loaded. Revision ${revisionId} is corrupted.`);});for(const message of messages){this.onMessageReceived(message);}
this.off("unexpected-revision-id",this);}
leave(){delete this.clients[this.clientId];this.transportService.leave(this.clientId);this.transportService.sendMessage({type:"CLIENT_LEFT",clientId:this.clientId,version:MESSAGE_VERSION,});}
snapshot(data){const snapshotId=this.uuidGenerator.uuidv4();this.transportService.sendMessage({type:"SNAPSHOT",nextRevisionId:snapshotId,serverRevisionId:this.serverRevisionId,data:{...data,revisionId:snapshotId},version:MESSAGE_VERSION,});}
getClient(){const client=this.clients[this.clientId];if(!client){throw new ClientDisconnectedError("The client left the session");}
return client;}
getConnectedClients(){return new Set(Object.values(this.clients).filter(isDefined));}
getRevisionId(){return this.serverRevisionId;}
isFullySynchronized(){return this.pendingMessages.length===0;}
_move(position){var _a;if(!this.clients[this.clientId])
return;const currentPosition=(_a=this.clients[this.clientId])===null||_a===void 0?void 0:_a.position;if((currentPosition===null||currentPosition===void 0?void 0:currentPosition.col)===position.col&&currentPosition.row===position.row&&currentPosition.sheetId===position.sheetId){return;}
const type=currentPosition?"CLIENT_MOVED":"CLIENT_JOINED";const client=this.getClient();this.clients[this.clientId]={...client,position};this.transportService.sendMessage({type,version:MESSAGE_VERSION,client:{...client,position},});}
onMessageReceived(message){if(this.isAlreadyProcessed(message))
return;switch(message.type){case"CLIENT_MOVED":this.onClientMoved(message);break;case"CLIENT_JOINED":this.onClientJoined(message);break;case"CLIENT_LEFT":this.onClientLeft(message);break;case"REVISION_REDONE":{this.waitingAck=false;this.revisions.redo(message.redoneRevisionId,message.nextRevisionId,message.serverRevisionId);this.trigger("revision-redone",{revisionId:message.redoneRevisionId,commands:this.revisions.get(message.redoneRevisionId).commands,});break;}
case"REVISION_UNDONE":this.waitingAck=false;this.revisions.undo(message.undoneRevisionId,message.nextRevisionId,message.serverRevisionId);this.trigger("revision-undone",{revisionId:message.undoneRevisionId,commands:this.revisions.get(message.undoneRevisionId).commands,});break;case"REMOTE_REVISION":this.waitingAck=false;if(message.serverRevisionId!==this.serverRevisionId){this.trigger("unexpected-revision-id",{revisionId:message.serverRevisionId});return;}
const{clientId,commands}=message;const revision=new Revision(message.nextRevisionId,clientId,commands);if(revision.clientId!==this.clientId){this.revisions.insert(revision.id,revision,message.serverRevisionId);this.trigger("remote-revision-received",{commands});}
break;case"SNAPSHOT_CREATED":{this.waitingAck=false;const revision=new Revision(message.nextRevisionId,"server",[]);this.revisions.insert(revision.id,revision,message.serverRevisionId);this.dropPendingHistoryMessages();this.trigger("snapshot");break;}}
this.acknowledge(message);this.trigger("collaborative-event-received");}
onClientMoved(message){if(message.client.id!==this.clientId){this.clients[message.client.id]=message.client;}}
onClientJoined(message){if(message.client.id!==this.clientId){this.clients[message.client.id]=message.client;const client=this.clients[this.clientId];if(client){const{position}=client;if(position){this.transportService.sendMessage({type:"CLIENT_MOVED",version:MESSAGE_VERSION,client:{...client,position},});}}}}
onClientLeft(message){if(message.clientId!==this.clientId){delete this.clients[message.clientId];}}
sendUpdateMessage(message){this.pendingMessages.push(message);if(this.waitingAck){return;}
this.waitingAck=true;this.sendPendingMessage();}
sendPendingMessage(){let message=this.pendingMessages[0];if(!message)
return;if(message.type==="REMOTE_REVISION"){const revision=this.revisions.get(message.nextRevisionId);if(revision.commands.length===0){this.revisions.drop(revision.id);const revisionIds=this.pendingMessages.filter((message)=>message.type==="REMOTE_REVISION").map((message)=>message.nextRevisionId);this.trigger("pending-revisions-dropped",{revisionIds});this.pendingMessages=[];return;}
message={...message,clientId:revision.clientId,commands:revision.commands,};}
this.transportService.sendMessage({...message,serverRevisionId:this.serverRevisionId,});}
acknowledge(message){switch(message.type){case"REMOTE_REVISION":case"REVISION_REDONE":case"REVISION_UNDONE":case"SNAPSHOT_CREATED":this.pendingMessages=this.pendingMessages.filter((msg)=>msg.nextRevisionId!==message.nextRevisionId);this.serverRevisionId=message.nextRevisionId;this.processedRevisions.add(message.nextRevisionId);this.sendPendingMessage();break;}}
isAlreadyProcessed(message){switch(message.type){case"REMOTE_REVISION":case"REVISION_REDONE":case"REVISION_UNDONE":return this.processedRevisions.has(message.nextRevisionId);default:return false;}}
dropPendingHistoryMessages(){this.pendingMessages=this.pendingMessages.filter(({type})=>type!=="REVISION_REDONE"&&type!=="REVISION_UNDONE");}}
function randomChoice(arr){return arr[Math.floor(Math.random()*arr.length)];}
const colors=["#ff851b","#0074d9","#7fdbff","#b10dc9","#39cccc","#f012be","#3d9970","#111111","#ff4136","#aaaaaa","#85144b","#001f3f",];class SelectionMultiUserPlugin extends UIPlugin{constructor(){super(...arguments);this.availableColors=new Set(colors);this.colors={};}
isPositionValid(position){const sheet=this.getters.getSheet(position.sheetId);return position.row<sheet.rows.length&&position.col<sheet.cols.length;}
chooseNewColor(){if(this.availableColors.size===0){this.availableColors=new Set(colors);}
const color=randomChoice([...this.availableColors.values()]);this.availableColors.delete(color);return color;}
getClientsToDisplay(){try{this.getters.getClient();}
catch(e){if(e instanceof ClientDisconnectedError){return[];}
else{throw e;}}
const sheetId=this.getters.getActiveSheetId();const clients=[];for(const client of this.getters.getConnectedClients()){if(client.id!==this.getters.getClient().id&&client.position&&client.position.sheetId===sheetId&&this.isPositionValid(client.position)){const position=client.position;if(!this.colors[client.id]){this.colors[client.id]=this.chooseNewColor();}
const color=this.colors[client.id];clients.push({...client,position,color});}}
return clients;}
drawGrid(renderingContext){const{viewport,ctx,thinLineWidth}=renderingContext;const activeSheetId=this.getters.getActiveSheetId();for(const client of this.getClientsToDisplay()){const{row,col}=client.position;const zone=this.getters.expandZone(activeSheetId,{top:row,bottom:row,left:col,right:col,});const[x,y,width,height]=this.getters.getRect(zone,viewport);if(width<=0||height<=0){continue;}
const color=client.color;const cellBackgroundColor=`${color}10`;ctx.fillStyle=cellBackgroundColor;ctx.lineWidth=4*thinLineWidth;ctx.strokeStyle=color;ctx.globalCompositeOperation="multiply";ctx.fillRect(x,y,width,height);ctx.globalCompositeOperation="source-over";ctx.strokeRect(x,y,width,height);ctx.font=`bold ${DEFAULT_FONT_SIZE + 1}px ${DEFAULT_FONT}`;}}}
SelectionMultiUserPlugin.getters=["getClientsToDisplay"];SelectionMultiUserPlugin.layers=[5];SelectionMultiUserPlugin.modes=["normal"];class UIOptionsPlugin extends UIPlugin{constructor(){super(...arguments);this.showFormulas=false;}
handle(cmd){switch(cmd.type){case"SET_FORMULA_VISIBILITY":this.showFormulas=cmd.show;break;}}
shouldShowFormulas(){return this.showFormulas;}}
UIOptionsPlugin.modes=["normal"];UIOptionsPlugin.getters=["shouldShowFormulas"];class SheetUIPlugin extends UIPlugin{constructor(){super(...arguments);this.ctx=document.createElement("canvas").getContext("2d");}
allowDispatch(cmd){switch(cmd.type){case"AUTORESIZE_ROWS":case"AUTORESIZE_COLUMNS":case"DELETE_SHEET_CONFIRMATION":try{this.getters.getSheet(cmd.sheetId);break;}
catch(error){return 21;}}
return 0;}
handle(cmd){switch(cmd.type){case"RENAME_SHEET":if(cmd.interactive){this.interactiveRenameSheet(cmd.sheetId,_lt("Rename Sheet"));}
break;case"DELETE_SHEET_CONFIRMATION":this.interactiveDeleteSheet(cmd.sheetId);break;case"ADD_MERGE":if(cmd.interactive){this.interactiveMerge(cmd.sheetId,cmd.target);}
break;case"AUTORESIZE_COLUMNS":for(let col of cmd.cols){const size=this.getColMaxWidth(cmd.sheetId,col);if(size!==0){this.dispatch("RESIZE_COLUMNS_ROWS",{elements:[col],dimension:"COL",size:size+2*PADDING_AUTORESIZE,sheetId:cmd.sheetId,});}}
break;case"AUTORESIZE_ROWS":for(let row of cmd.rows){const size=this.getRowMaxHeight(cmd.sheetId,row);if(size!==0){this.dispatch("RESIZE_COLUMNS_ROWS",{elements:[row],dimension:"ROW",size:size+2*PADDING_AUTORESIZE,sheetId:cmd.sheetId,});}}
break;}}
getCellWidth(cell){let width=this.getTextWidth(cell);const cellPosition=this.getters.getCellPosition(cell.id);const icon=this.getters.getConditionalIcon(cellPosition.col,cellPosition.row);if(icon){width+=computeIconWidth(this.ctx,this.getters.getCellStyle(cell));}
return width;}
getTextWidth(cell){const text=this.getters.getCellText(cell,this.getters.shouldShowFormulas());return computeTextWidth(this.ctx,text,this.getters.getCellStyle(cell));}
getCellHeight(cell){const style=this.getters.getCellStyle(cell);const sizeInPt=style.fontSize||DEFAULT_FONT_SIZE;return fontSizeMap[sizeInPt];}
getCellText(cell,showFormula=false){if(showFormula&&(cell.isFormula()||cell.evaluated.type===CellValueType.error)){return cell.content;}
else{return cell.formattedValue;}}
getColMaxWidth(sheetId,index){const cells=this.getters.getColCells(sheetId,index);const sizes=cells.map((cell)=>this.getCellWidth(cell));return Math.max(0,...sizes);}
getRowMaxHeight(sheetId,index){const sheet=this.getters.getSheet(sheetId);const cells=Object.values(sheet.rows[index].cells);const sizes=cells.map((cell)=>this.getCellHeight(cell));return Math.max(0,...sizes);}
interactiveRenameSheet(sheetId,title){const placeholder=this.getters.getSheetName(sheetId);this.ui.editText(title,placeholder,(name)=>{if(!name){return;}
const result=this.dispatch("RENAME_SHEET",{sheetId:sheetId,name});const sheetName=this.getters.getSheetName(sheetId);if(!result.isSuccessful&&sheetName!==name){this.interactiveRenameSheet(sheetId,_lt("Please enter a valid sheet name"));}});}
interactiveDeleteSheet(sheetId){this.ui.askConfirmation(_lt("Are you sure you want to delete this sheet ?"),()=>{this.dispatch("DELETE_SHEET",{sheetId:sheetId});});}
interactiveMerge(sheet,target){const result=this.dispatch("ADD_MERGE",{sheetId:sheet,target});if(!result.isSuccessful){if(result.isCancelledBecause(3)){this.ui.askConfirmation(_lt("Merging these cells will only preserve the top-leftmost value. Merge anyway?"),()=>{this.dispatch("ADD_MERGE",{sheetId:sheet,target,force:true});});}}}}
SheetUIPlugin.getters=["getCellWidth","getCellHeight","getTextWidth","getCellText"];class ViewportPlugin extends UIPlugin{constructor(){super(...arguments);this.viewports={};this.snappedViewports={};this.updateSnap=false;this.clientWidth=1000;this.clientHeight=1000;}
allowDispatch(cmd){switch(cmd.type){case"SET_VIEWPORT_OFFSET":return this.checkOffsetValidity(cmd.offsetX,cmd.offsetY);case"RESIZE_VIEWPORT":if(cmd.width<0||cmd.height<0){return 52;}
return 0;default:return 0;}}
handle(cmd){switch(cmd.type){case"UNDO":case"REDO":this.cleanViewports();this.resetViewports();break;case"RESIZE_VIEWPORT":this.cleanViewports();this.resizeViewport(cmd.height,cmd.width);break;case"SET_VIEWPORT_OFFSET":this.setViewportOffset(cmd.offsetX,cmd.offsetY);break;case"REMOVE_COLUMNS_ROWS":case"RESIZE_COLUMNS_ROWS":case"HIDE_COLUMNS_ROWS":if(cmd.dimension==="COL"){this.adjustViewportOffsetX(cmd.sheetId,this.getViewport(cmd.sheetId));}
else{this.adjustViewportOffsetY(cmd.sheetId,this.getViewport(cmd.sheetId));}
break;case"ADD_COLUMNS_ROWS":case"UNHIDE_COLUMNS_ROWS":if(cmd.dimension==="COL"){this.adjustViewportZoneX(cmd.sheetId,this.getViewport(cmd.sheetId));}
else{this.adjustViewportZoneY(cmd.sheetId,this.getViewport(cmd.sheetId));}
break;case"ACTIVATE_SHEET":this.refreshViewport(cmd.sheetIdTo);break;case"SELECT_CELL":case"MOVE_POSITION":this.refreshViewport(this.getters.getActiveSheetId());break;}}
finalize(){if(this.updateSnap){this.snapViewportToCell(this.getters.getActiveSheetId());this.updateSnap=false;}}
getViewportDimension(){return{width:this.clientWidth,height:this.clientHeight};}
getActiveViewport(){const sheetId=this.getters.getActiveSheetId();return this.getViewport(sheetId);}
getActiveSnappedViewport(){const sheetId=this.getters.getActiveSheetId();return this.getSnappedViewport(sheetId);}
getGridDimension(sheet){const lastCol=findLastVisibleColRow(sheet,"cols");const effectiveWidth=this.clientWidth-HEADER_WIDTH;const lastRow=findLastVisibleColRow(sheet,"rows");const effectiveHeight=this.clientHeight-HEADER_HEIGHT;const leftCol=sheet.cols.find((col)=>col.end>lastCol.end-effectiveWidth)||sheet.cols[sheet.cols.length-1];const topRow=sheet.rows.find((row)=>row.end>lastRow.end-effectiveHeight)||sheet.rows[sheet.rows.length-1];const width=lastCol.end+
Math.max(DEFAULT_CELL_WIDTH,Math.min(leftCol.size,effectiveWidth-lastCol.size));const height=lastRow.end+
Math.max(DEFAULT_CELL_HEIGHT+5,Math.min(topRow.size,effectiveHeight-lastRow.size));return{width,height};}
getMaximumViewportOffset(sheet){const{width,height}=this.getters.getGridDimension(sheet);return{maxOffsetX:Math.max(0,width-this.clientWidth+HEADER_WIDTH+1),maxOffsetY:Math.max(0,height-this.clientHeight+HEADER_HEIGHT+1),};}
checkOffsetValidity(offsetX,offsetY){const sheet=this.getters.getActiveSheet();const{maxOffsetX,maxOffsetY}=this.getMaximumViewportOffset(sheet);if(offsetX<0||offsetY<0||offsetY>maxOffsetY||offsetX>maxOffsetX){return 51;}
return 0;}
getSnappedViewport(sheetId){this.snapViewportToCell(sheetId);return this.snappedViewports[sheetId];}
getViewport(sheetId){if(!this.viewports[sheetId]){return this.generateViewportState(sheetId);}
return this.viewports[sheetId];}
cleanViewports(){const sheets=this.getters.getVisibleSheets();for(let sheetId of Object.keys(this.viewports)){if(!sheets.includes(sheetId)){delete this.viewports[sheetId];}}}
resetViewports(){for(let[sheetId,viewport]of Object.entries(this.viewports)){this.adjustViewportOffsetX(sheetId,viewport);this.adjustViewportOffsetY(sheetId,viewport);this.adjustViewportsPosition(sheetId);}}
adjustViewportOffsetX(sheetId,viewport){const{offsetX}=viewport;const{width:sheetWidth}=this.getGridDimension(this.getters.getSheet(sheetId));if(this.clientWidth-HEADER_WIDTH+offsetX>sheetWidth){const diff=this.clientWidth-HEADER_WIDTH+offsetX-sheetWidth;viewport.offsetX=Math.max(0,offsetX-diff);}
this.adjustViewportZoneX(sheetId,viewport);}
adjustViewportOffsetY(sheetId,viewport){const{offsetY}=viewport;const{height:sheetHeight}=this.getGridDimension(this.getters.getSheet(sheetId));if(this.clientHeight-HEADER_HEIGHT+offsetY>sheetHeight){const diff=this.clientHeight-HEADER_HEIGHT+offsetY-sheetHeight;viewport.offsetY=Math.max(0,offsetY-diff);}
this.adjustViewportZoneY(sheetId,viewport);}
resizeViewport(height,width){this.clientHeight=height;this.clientWidth=width;this.recomputeViewports();}
recomputeViewports(){for(let sheetId of Object.keys(this.viewports)){this.adjustViewportOffsetX(sheetId,this.viewports[sheetId]);this.adjustViewportOffsetY(sheetId,this.viewports[sheetId]);}}
setViewportOffset(offsetX,offsetY){const sheetId=this.getters.getActiveSheetId();this.getActiveViewport();this.viewports[sheetId].offsetX=offsetX;this.viewports[sheetId].offsetY=offsetY;this.adjustViewportZone(sheetId,this.viewports[sheetId]);}
generateViewportState(sheetId){this.viewports[sheetId]={left:0,right:0,top:0,bottom:0,offsetX:0,offsetY:0,};return this.viewports[sheetId];}
refreshViewport(sheetId){const viewport=this.getViewport(sheetId);this.adjustViewportZone(sheetId,viewport);this.adjustViewportsPosition(sheetId);}
adjustViewportZone(sheetId,viewport){this.adjustViewportZoneX(sheetId,viewport);this.adjustViewportZoneY(sheetId,viewport);}
adjustViewportZoneX(sheetId,viewport){const sheet=this.getters.getSheet(sheetId);const cols=sheet.cols;viewport.left=this.getters.getColIndex(viewport.offsetX+HEADER_WIDTH,0,sheet);const x=this.clientWidth+viewport.offsetX-HEADER_WIDTH;viewport.right=cols.length-1;for(let i=viewport.left;i<cols.length;i++){if(x<cols[i].end){viewport.right=i;break;}}
this.updateSnap=true;}
adjustViewportZoneY(sheetId,viewport){const sheet=this.getters.getSheet(sheetId);const rows=sheet.rows;viewport.top=this.getters.getRowIndex(viewport.offsetY+HEADER_HEIGHT,0,sheet);const y=this.clientHeight+viewport.offsetY-HEADER_HEIGHT;viewport.bottom=rows.length-1;for(let i=viewport.top;i<rows.length;i++){if(y<rows[i].end){viewport.bottom=i;break;}}
this.updateSnap=true;}
adjustViewportsPosition(sheetId,position){const sheet=this.getters.getSheet(sheetId);const{cols,rows}=sheet;const adjustedViewport=this.getSnappedViewport(sheetId);position=position||this.getters.getSheetPosition(sheetId);const[col,row]=getNextVisibleCellCoords(sheet,...this.getters.getMainCell(sheetId,position[0],position[1]));while(cols[col].end>adjustedViewport.offsetX+this.clientWidth-HEADER_WIDTH&&adjustedViewport.offsetX<cols[col].start){adjustedViewport.offsetX=cols[adjustedViewport.left].end;this.adjustViewportZoneX(sheetId,adjustedViewport);}
while(col<adjustedViewport.left){const step=cols.slice(0,adjustedViewport.left).reverse().findIndex((col)=>!col.isHidden);adjustedViewport.offsetX=cols[adjustedViewport.left-1-step].start;this.adjustViewportZoneX(sheetId,adjustedViewport);}
while(rows[row].end>adjustedViewport.offsetY+this.clientHeight-HEADER_HEIGHT&&adjustedViewport.offsetY<rows[row].start){adjustedViewport.offsetY=rows[adjustedViewport.top].end;this.adjustViewportZoneY(sheetId,adjustedViewport);}
while(row<adjustedViewport.top){const step=rows.slice(0,adjustedViewport.top).reverse().findIndex((row)=>!row.isHidden);adjustedViewport.offsetY=rows[adjustedViewport.top-1-step].start;this.adjustViewportZoneY(sheetId,adjustedViewport);}
const{top,left}=this.viewports[sheetId];if(top!==adjustedViewport.top||left!==adjustedViewport.left)
this.viewports[sheetId]=adjustedViewport;this.updateSnap=false;}
snapViewportToCell(sheetId){const{cols,rows}=this.getters.getSheet(sheetId);const viewport=this.getViewport(sheetId);const adjustedViewport=Object.assign({},viewport);this.adjustViewportOffsetX(sheetId,adjustedViewport);this.adjustViewportOffsetY(sheetId,adjustedViewport);adjustedViewport.offsetX=cols[adjustedViewport.left].start;adjustedViewport.offsetY=rows[adjustedViewport.top].start;this.adjustViewportZone(sheetId,adjustedViewport);this.snappedViewports[sheetId]=adjustedViewport;}}
ViewportPlugin.getters=["getActiveViewport","getSnappedViewport","getActiveSnappedViewport","getViewportDimension","getGridDimension","getMaximumViewportOffset",];ViewportPlugin.modes=["normal"];const corePluginRegistry=new Registry().add("sheet",SheetPlugin).add("cell",CellPlugin).add("merge",MergePlugin).add("borders",BordersPlugin).add("conditional formatting",ConditionalFormatPlugin).add("figures",FigurePlugin).add("sort",SortPlugin).add("chart",ChartPlugin);const uiPluginRegistry=new Registry().add("selection",SelectionPlugin).add("ui_sheet",SheetUIPlugin).add("ui_options",UIOptionsPlugin).add("evaluation",EvaluationPlugin).add("evaluation_cf",EvaluationConditionalFormatPlugin).add("evaluation_chart",EvaluationChartPlugin).add("clipboard",ClipboardPlugin).add("edition",EditionPlugin).add("highlight",HighlightPlugin).add("selectionInput",SelectionInputPlugin).add("viewport",ViewportPlugin).add("grid renderer",RendererPlugin).add("autofill",AutofillPlugin).add("find_and_replace",FindAndReplacePlugin).add("interactive_sort",InteractiveSortPlugin).add("automatic_sum",AutomaticSumPlugin).add("selection_multiuser",SelectionMultiUserPlugin);class LocalTransportService{constructor(){this.listeners=[];}
sendMessage(message){for(const{callback}of this.listeners){callback(message);}}
onNewMessage(id,callback){this.listeners.push({id,callback});}
leave(id){this.listeners=this.listeners.filter((listener)=>listener.id!==id);}}
class DataSourceRegistry extends owl__namespace.core.EventBus{constructor(){super(...arguments);this.registry=new Registry();}
add(key,value){this.registry.add(key,value);const debouncedLoaded=owl__namespace.utils.debounce(()=>this.trigger("data-loaded",{id:key}),0);value.on("data-loaded",this,()=>debouncedLoaded());value.loadMetadata();return this;}
get(key){return this.registry.get(key);}
getAll(){return this.registry.getAll();}
remove(key){const value=this.get(key);value.off("data-loaded",this);this.registry.remove(key);}
async waitForReady(){const proms=[];for(const source of this.getAll()){proms.push(source.get());}
return Promise.all(proms);}}
class DataSource extends owl__namespace.core.EventBus{async loadMetadata(){if(!this.metadataPromise){this.metadataPromise=this._fetchMetadata().then((metadata)=>{this.metadata=metadata;return metadata;});}
await this.metadataPromise;}
async get(params){if(params&&params.forceFetch){this.data=undefined;this.dataPromise=undefined;}
await this.loadMetadata();if(!this.dataPromise){this.dataPromise=this._fetch(params).then((data)=>{this.data=data;this.lastUpdate=Date.now();this.trigger("data-loaded");return data;});}
return this.dataPromise;}
getSync(){return this.data;}
getMetadataSync(){return this.metadata;}
getLastUpdate(){return this.lastUpdate;}}
function transformZone(zone,executed){if(executed.type==="REMOVE_COLUMNS_ROWS"){return reduceZoneOnDeletion(zone,executed.dimension==="COL"?"left":"top",executed.elements);}
if(executed.type==="ADD_COLUMNS_ROWS"){return expandZoneOnInsertion(zone,executed.dimension==="COL"?"left":"top",executed.base,executed.position,executed.quantity);}
return{...zone};}
otRegistry.addTransformation("ADD_COLUMNS_ROWS",["CREATE_CHART","UPDATE_CHART"],updateChartRangesTransformation);otRegistry.addTransformation("REMOVE_COLUMNS_ROWS",["CREATE_CHART","UPDATE_CHART"],updateChartRangesTransformation);otRegistry.addTransformation("DELETE_FIGURE",["UPDATE_FIGURE","UPDATE_CHART"],updateChartFigure);otRegistry.addTransformation("ADD_MERGE",["ADD_MERGE","REMOVE_MERGE"],mergeTransformation);otRegistry.addTransformation("ADD_MERGE",["SORT_CELLS"],sortMergedTransformation);otRegistry.addTransformation("REMOVE_MERGE",["SORT_CELLS"],sortUnMergedTransformation);function updateChartFigure(toTransform,executed){if(toTransform.id===executed.id){return undefined;}
return toTransform;}
function updateChartRangesTransformation(toTransform,executed){const definition=toTransform.definition;let labelZone;let dataSets;if(definition.labelRange){labelZone=transformZone(toZone(definition.labelRange),executed);}
if(definition.dataSets){dataSets=definition.dataSets.map(toZone).map((zone)=>transformZone(zone,executed)).filter(isDefined).map(zoneToXc);}
return{...toTransform,definition:{...definition,dataSets,labelRange:labelZone?zoneToXc(labelZone):undefined,},};}
function mergeTransformation(cmd,executed){const target=[];for(const zone1 of cmd.target){for(const zone2 of executed.target){if(!overlap(zone1,zone2)){target.push({...zone1});}}}
if(target.length){return{...cmd,target};}
return undefined;}
function sortMergedTransformation(cmd,executed){const overlappingZones=executed.target.filter((mergedZone)=>overlap(mergedZone,cmd.zone));if(overlappingZones.length){const removeMergeCommand={type:"REMOVE_MERGE",target:overlappingZones,sheetId:cmd.sheetId,};return[removeMergeCommand,cmd];}
return cmd;}
function sortUnMergedTransformation(cmd,executed){const overlappingZones=executed.target.filter((mergedZone)=>overlap(mergedZone,cmd.zone));if(overlappingZones.length){const addMergeCommand={type:"ADD_MERGE",target:overlappingZones,sheetId:cmd.sheetId,};return[addMergeCommand,cmd];}
return cmd;}
const transformations=[{match:isSheetDependent,fn:transformSheetId},{match:isTargetDependent,fn:transformTarget},{match:isZoneDependent,fn:transformZoneDependentCommand},{match:isPositionDependent,fn:transformPosition},{match:isGridDependent,fn:transformDimension},];function transform(toTransform,executed){const specificTransform=otRegistry.getTransformation(toTransform.type,executed.type);const result=genericTransform(toTransform,executed);switch(result){case"IGNORE_COMMAND":return undefined;case"TRANSFORMATION_NOT_NEEDED":return toTransform;default:if(result&&specificTransform){return specificTransform(result,executed);}
return result;}}
function transformAll(toTransform,executed){let transformedCommands=[...toTransform];for(const executedCommand of executed){transformedCommands=transformedCommands.map((cmd)=>transform(cmd,executedCommand)).filter(isDefined).flat();}
return transformedCommands;}
function genericTransform(cmd,executed){for(const{match,fn}of transformations){if(match(cmd)){const result=fn(cmd,executed);switch(result){case"IGNORE_COMMAND":case"TRANSFORMATION_NOT_NEEDED":return result;default:cmd=result;break;}}}
return cmd;}
function transformSheetId(cmd,executed){const deleteSheet=executed.type==="DELETE_SHEET"&&executed.sheetId;if(cmd.sheetId===deleteSheet){return"IGNORE_COMMAND";}
if("sheetId"in executed&&cmd.sheetId!==executed.sheetId){return"TRANSFORMATION_NOT_NEEDED";}
return cmd;}
function transformTarget(cmd,executed){const target=[];for(const zone of cmd.target){const newZone=transformZone(zone,executed);if(newZone){target.push(newZone);}}
if(!target.length){return"IGNORE_COMMAND";}
return{...cmd,target};}
function transformZoneDependentCommand(cmd,executed){const newZone=transformZone(cmd.zone,executed);if(newZone){return{...cmd,zone:newZone};}
return"IGNORE_COMMAND";}
function transformDimension(cmd,executed){if(executed.type==="ADD_COLUMNS_ROWS"||executed.type==="REMOVE_COLUMNS_ROWS"){const isUnique=cmd.type==="ADD_COLUMNS_ROWS";const field=isUnique?"base":"elements";let elements=isUnique?[cmd[field]]:cmd[field];if(executed.type==="REMOVE_COLUMNS_ROWS"){elements=elements.map((element)=>{if(executed.elements.includes(element)){return undefined;}
for(let removedElement of executed.elements){if(element>removedElement){element--;}}
return element;}).filter(isDefined);}
if(executed.type==="ADD_COLUMNS_ROWS"){const base=executed.position==="before"?executed.base-1:executed.base;elements=elements.map((el)=>(el>base?el+executed.quantity:el));}
if(elements.length){let result=elements;if(isUnique){result=elements[0];}
return{...cmd,[field]:result};}
return"IGNORE_COMMAND";}
return cmd;}
function transformPosition(cmd,executed){if(executed.type==="ADD_COLUMNS_ROWS"||executed.type==="REMOVE_COLUMNS_ROWS"){return transformPositionWithGrid(cmd,executed);}
if(executed.type==="ADD_MERGE"){return transformPositionWithMerge(cmd,executed);}
return cmd;}
function transformPositionWithGrid(cmd,executed){const field=executed.dimension==="COL"?"col":"row";let base=cmd[field];if(executed.type==="REMOVE_COLUMNS_ROWS"){const elements=[...executed.elements].sort((a,b)=>b-a);if(elements.includes(base)){return"IGNORE_COMMAND";}
for(let removedElement of elements){if(base>=removedElement){base--;}}}
if(executed.type==="ADD_COLUMNS_ROWS"){if(base>executed.base||(base===executed.base&&executed.position==="before")){base=base+executed.quantity;}}
return{...cmd,[field]:base};}
function transformPositionWithMerge(cmd,executed){for(const zone of executed.target){const sameTopLeft=cmd.col===zone.left&&cmd.row===zone.top;if(!sameTopLeft&&isInside(cmd.col,cmd.row,zone)){return"IGNORE_COMMAND";}}
return cmd;}
function inverseCommand(cmd){return inverseCommandRegistry.get(cmd.type)(cmd);}
function createEmptyStructure(node){if(typeof node==="string"){return{};}
else if(typeof node==="number"){return[];}
throw new Error(`Cannot create new node`);}
class Branch{constructor(buildTransformation,operations=[]){this.buildTransformation=buildTransformation;this.operations=operations;}
getOperations(){return this.operations;}
getOperation(operationId){const operation=this.operations.find((op)=>op.id===operationId);if(!operation){throw new Error(`Operation ${operationId} not found`);}
return operation;}
getLastOperationId(){var _a;return(_a=this.operations[this.operations.length-1])===null||_a===void 0?void 0:_a.id;}
getFirstOperationAmong(op1,op2){for(const operation of this.operations){if(operation.id===op1)
return op1;if(operation.id===op2)
return op2;}
throw new Error(`Operation ${op1} and ${op2} not found`);}
contains(operationId){return!!this.operations.find((operation)=>operation.id===operationId);}
prepend(operation){const transformation=this.buildTransformation.with(operation.data);this.operations=[operation,...this.operations.map((operation)=>operation.transformed(transformation)),];}
insert(newOperation,predecessorOpId){const transformation=this.buildTransformation.with(newOperation.data);const{before,operation,after}=this.locateOperation(predecessorOpId);this.operations=[...before,operation,newOperation,...after.map((operation)=>operation.transformed(transformation)),];}
append(operation){this.operations.push(operation);}
appendBranch(branch){this.operations=this.operations.concat(branch.operations);}
fork(operationId){const{after}=this.locateOperation(operationId);return new Branch(this.buildTransformation,after);}
transform(transformation){this.operations=this.operations.map((operation)=>operation.transformed(transformation));}
cutBefore(operationId){this.operations=this.locateOperation(operationId).before;}
cutAfter(operationId){const{before,operation}=this.locateOperation(operationId);this.operations=before.concat([operation]);}
locateOperation(operationId){const operationIndex=this.operations.findIndex((step)=>step.id===operationId);if(operationIndex===-1){throw new Error(`Operation ${operationId} not found`);}
return{before:this.operations.slice(0,operationIndex),operation:this.operations[operationIndex],after:this.operations.slice(operationIndex+1),};}}
class Operation{constructor(id,data){this.id=id;this.data=data;}
transformed(transformation){return new Operation(this.id,transformation(this.data));}}
class OperationSequence{constructor(operations){this.operations=operations;}
[Symbol.iterator](){return this.operations[Symbol.iterator]();}
stopWith(operationId){function*filter(execution,operationId){for(const step of execution){yield step;if(step.operation.id===operationId){return;}}}
return new OperationSequence(filter(this.operations,operationId));}
stopBefore(operationId){function*filter(execution,operationId){for(const step of execution){if(step.operation.id===operationId){return;}
yield step;}}
return new OperationSequence(filter(this.operations,operationId));}
startAfter(operationId){function*filter(execution,operationId){let skip=true;for(const step of execution){if(!skip){yield step;}
if(step.operation.id===operationId){skip=false;}}}
return new OperationSequence(filter(this.operations,operationId));}}
class Tree{constructor(buildTransformation,initialBranch){this.buildTransformation=buildTransformation;this.branchingOperationIds=new Map();this.branches=[initialBranch];}
getLastBranch(){return this.branches[this.branches.length-1];}
execution(branch){return new OperationSequence(linkNext(this._execution(branch),this._execution(branch)));}
revertedExecution(branch){return new OperationSequence(linkNext(this._revertedExecution(branch),this._revertedExecution(branch)));}
insertOperationLast(branch,operation){var _a;const insertAfter=branch.getLastOperationId()||((_a=this.previousBranch(branch))===null||_a===void 0?void 0:_a.getLastOperationId());branch.append(operation);if(insertAfter){this.insertPrevious(branch,operation,insertAfter);}}
insertOperationAfter(branch,operation,predecessorOpId){branch.insert(operation,predecessorOpId);this.updateNextWith(branch,operation,predecessorOpId);this.insertPrevious(branch,operation,predecessorOpId);}
undo(branch,operation){const transformation=this.buildTransformation.without(operation.data);const branchingId=this.branchingOperationIds.get(branch);this.branchingOperationIds.set(branch,operation.id);const nextBranch=branch.fork(operation.id);if(branchingId){this.branchingOperationIds.set(nextBranch,branchingId);}
this.insertBranchAfter(branch,nextBranch);this.transform(nextBranch,transformation);}
redo(branch){const removedBranch=this.nextBranch(branch);if(!removedBranch)
return;const nextBranch=this.nextBranch(removedBranch);this.removeBranchFromTree(removedBranch);const undoBranchingId=this.branchingOperationIds.get(removedBranch);if(undoBranchingId){this.branchingOperationIds.set(branch,undoBranchingId);}
else{this.branchingOperationIds.delete(branch);}
if(nextBranch){this.rebaseUp(nextBranch);}}
drop(operationId){for(const branch of this.branches){if(branch.contains(operationId)){branch.cutBefore(operationId);}}}
findOperation(branch,operationId){for(const operation of this.revertedExecution(branch)){if(operation.operation.id===operationId){return operation;}}
throw new Error(`Operation ${operationId} not found`);}
rebaseUp(branch){const{previousBranch,branchingOperation}=this.findPreviousBranchingOperation(branch);if(!previousBranch||!branchingOperation)
return;const rebaseTransformation=this.buildTransformation.without(branchingOperation.data);const newBranch=previousBranch.fork(branchingOperation.id);this.branchingOperationIds.set(newBranch,this.branchingOperationIds.get(branch));this.removeBranchFromTree(branch);this.insertBranchAfter(previousBranch,newBranch);newBranch.transform(rebaseTransformation);const nextBranch=this.nextBranch(newBranch);if(nextBranch){this.rebaseUp(nextBranch);}}
removeBranchFromTree(branch){const index=this.branches.findIndex((l)=>l===branch);this.branches.splice(index,1);}
insertBranchAfter(branch,toInsert){const index=this.branches.findIndex((l)=>l===branch);this.branches.splice(index+1,0,toInsert);}
updateNextWith(branch,operation,predecessorOpId){const branchingId=this.branchingOperationIds.get(branch);const nextBranch=this.nextBranch(branch);if(!branchingId||!nextBranch){return;}
if(branch.getFirstOperationAmong(predecessorOpId,branchingId)===branchingId){const transformedOperation=this.addToNextBranch(branch,nextBranch,branchingId,operation,predecessorOpId);this.updateNextWith(nextBranch,transformedOperation,predecessorOpId);}
else{const transformation=this.buildTransformation.with(operation.data);this.transform(nextBranch,transformation);}}
addToNextBranch(branch,nextBranch,branchingId,operation,predecessorOpId){let transformedOperation=operation;if(predecessorOpId===branchingId){transformedOperation=this.getTransformedOperation(branch,branchingId,operation);nextBranch.prepend(transformedOperation);}
else if(nextBranch.contains(predecessorOpId)){transformedOperation=this.getTransformedOperation(branch,branchingId,operation);nextBranch.insert(transformedOperation,predecessorOpId);}
else{nextBranch.append(operation);}
return transformedOperation;}
getTransformedOperation(branch,branchingId,operation){const branchingOperation=branch.getOperation(branchingId);const branchingTransformation=this.buildTransformation.without(branchingOperation.data);return operation.transformed(branchingTransformation);}
shouldExecute(branch,operation){return operation.id!==this.branchingOperationIds.get(branch);}
transform(branch,transformation){branch.transform(transformation);const nextBranch=this.nextBranch(branch);if(nextBranch){this.transform(nextBranch,transformation);}}
insertPrevious(branch,newOperation,insertAfter){const{previousBranch,branchingOperation}=this.findPreviousBranchingOperation(branch);if(!previousBranch||!branchingOperation)
return;const transformation=this.buildTransformation.with(branchingOperation.data);const branchTail=branch.fork(insertAfter);branchTail.transform(transformation);previousBranch.cutAfter(insertAfter);previousBranch.appendBranch(branchTail);const operationToInsert=newOperation.transformed(transformation);this.insertPrevious(previousBranch,operationToInsert,insertAfter);}
findPreviousBranchingOperation(branch){const previousBranch=this.previousBranch(branch);if(!previousBranch)
return{previousBranch:undefined,branchingOperation:undefined};const previousBranchingId=this.branchingOperationIds.get(previousBranch);if(!previousBranchingId)
return{previousBranch:undefined,branchingOperation:undefined};return{previousBranch,branchingOperation:previousBranch.getOperation(previousBranchingId),};}
nextBranch(branch){const index=this.branches.findIndex((l)=>l===branch);if(index===-1){return undefined;}
return this.branches[index+1];}
previousBranch(branch){const index=this.branches.findIndex((l)=>l===branch);if(index===-1){return undefined;}
return this.branches[index-1];}*_revertedExecution(branch){const branchingOperationId=this.branchingOperationIds.get(branch);let afterBranchingPoint=!!branchingOperationId;const operations=branch.getOperations();for(let i=operations.length-1;i>=0;i--){const operation=operations[i];if(operation.id===branchingOperationId){afterBranchingPoint=false;}
if(!afterBranchingPoint){yield{operation:operation,branch:branch,isCancelled:!this.shouldExecute(branch,operation),};}}
const previous=this.previousBranch(branch);yield*previous?this._revertedExecution(previous):[];}*_execution(branch){for(const operation of branch.getOperations()){yield{operation:operation,branch:branch,isCancelled:!this.shouldExecute(branch,operation),};if(operation.id===this.branchingOperationIds.get(branch)){const next=this.nextBranch(branch);yield*next?this._execution(next):[];return;}}
if(!this.branchingOperationIds.get(branch)){const next=this.nextBranch(branch);yield*next?this._execution(next):[];}}}
class SelectiveHistory{constructor(initialOperationId,applyOperation,revertOperation,buildEmpty,buildTransformation){this.applyOperation=applyOperation;this.revertOperation=revertOperation;this.buildEmpty=buildEmpty;this.buildTransformation=buildTransformation;this.HEAD_BRANCH=new Branch(this.buildTransformation);this.tree=new Tree(buildTransformation,this.HEAD_BRANCH);const initial=new Operation(initialOperationId,buildEmpty(initialOperationId));this.tree.insertOperationLast(this.HEAD_BRANCH,initial);this.HEAD_OPERATION=initial;}
get(operationId){return this.tree.findOperation(this.HEAD_BRANCH,operationId).operation.data;}
append(operationId,data){const operation=new Operation(operationId,data);const branch=this.tree.getLastBranch();this.tree.insertOperationLast(branch,operation);this.HEAD_BRANCH=branch;this.HEAD_OPERATION=operation;}
insert(operationId,data,insertAfter){const operation=new Operation(operationId,data);this.revertTo(insertAfter);this.tree.insertOperationAfter(this.HEAD_BRANCH,operation,insertAfter);this.fastForward();}
undo(operationId,undoId,insertAfter){const{branch,operation}=this.tree.findOperation(this.HEAD_BRANCH,operationId);this.revertBefore(operationId);this.tree.undo(branch,operation);this.fastForward();this.insert(undoId,this.buildEmpty(undoId),insertAfter);}
redo(operationId,redoId,insertAfter){const{branch}=this.tree.findOperation(this.HEAD_BRANCH,operationId);this.revertBefore(operationId);this.tree.redo(branch);this.fastForward();this.insert(redoId,this.buildEmpty(redoId),insertAfter);}
drop(operationId){this.revertBefore(operationId);this.tree.drop(operationId);}
revertBefore(operationId){const execution=this.tree.revertedExecution(this.HEAD_BRANCH).stopWith(operationId);this.revert(execution);}
revertTo(operationId){const execution=operationId?this.tree.revertedExecution(this.HEAD_BRANCH).stopBefore(operationId):this.tree.revertedExecution(this.HEAD_BRANCH);this.revert(execution);}
revert(execution){for(const{next,operation,isCancelled}of execution){if(!isCancelled){this.revertOperation(operation.data);}
if(next){this.HEAD_BRANCH=next.branch;this.HEAD_OPERATION=next.operation;}}}
fastForward(){const operations=this.HEAD_OPERATION?this.tree.execution(this.HEAD_BRANCH).startAfter(this.HEAD_OPERATION.id):this.tree.execution(this.HEAD_BRANCH);for(const{operation:operation,branch,isCancelled}of operations){if(!isCancelled){this.applyOperation(operation.data);}
this.HEAD_OPERATION=operation;this.HEAD_BRANCH=branch;}}}
function buildRevisionLog(initialRevisionId,recordChanges,dispatch){return new SelectiveHistory(initialRevisionId,(revision)=>{const commands=revision.commands.slice();const{changes}=recordChanges(()=>{for(const command of commands){dispatch(command);}});revision.setChanges(changes);},(revision)=>revertChanges([revision]),(id)=>new Revision(id,"empty",[],[]),{with:(revision)=>(toTransform)=>{return new Revision(toTransform.id,toTransform.clientId,transformAll(toTransform.commands,revision.commands));},without:(revision)=>(toTransform)=>{return new Revision(toTransform.id,toTransform.clientId,transformAll(toTransform.commands,revision.commands.map(inverseCommand).flat()));},});}
function revertChanges(revisions){for(const revision of revisions.slice().reverse()){for(let i=revision.changes.length-1;i>=0;i--){const change=revision.changes[i];applyChange(change,"before");}}}
function applyChange(change,target){let val=change.root;let key=change.path[change.path.length-1];for(let pathIndex=0;pathIndex<change.path.slice(0,-1).length;pathIndex++){const p=change.path[pathIndex];if(val[p]===undefined){const nextPath=change.path[pathIndex+1];val[p]=createEmptyStructure(nextPath);}
val=val[p];}
if(change[target]===undefined){delete val[key];}
else{val[key]=change[target];}}
class LocalHistory extends owl__namespace.core.EventBus{constructor(dispatch,session){super();this.dispatch=dispatch;this.session=session;this.undoStack=[];this.redoStack=[];this.isWaitingForUndoRedo=false;this.session.on("new-local-state-update",this,this.onNewLocalStateUpdate);this.session.on("revision-undone",this,({commands})=>this.selectiveUndo(commands));this.session.on("revision-redone",this,({commands})=>this.selectiveRedo(commands));this.session.on("pending-revisions-dropped",this,({revisionIds})=>this.drop(revisionIds));this.session.on("snapshot",this,()=>{this.undoStack=[];this.redoStack=[];this.isWaitingForUndoRedo=false;});}
allowDispatch(cmd){if(this.isWaitingForUndoRedo){return 47;}
switch(cmd.type){case"REQUEST_UNDO":if(!this.canUndo()){return 5;}
break;case"REQUEST_REDO":if(!this.canRedo()){return 6;}
break;}
return 0;}
beforeHandle(cmd){}
handle(cmd){switch(cmd.type){case"REQUEST_UNDO":case"REQUEST_REDO":this.requestHistoryChange(cmd.type==="REQUEST_UNDO"?"UNDO":"REDO");}}
finalize(){}
requestHistoryChange(type){const id=type==="UNDO"?this.undoStack.pop():this.redoStack.pop();if(!id){return;}
this.isWaitingForUndoRedo=true;if(type==="UNDO"){this.session.undo(id);this.redoStack.push(id);}
else{this.session.redo(id);this.undoStack.push(id);}}
canUndo(){return this.undoStack.length>0;}
canRedo(){return this.redoStack.length>0;}
drop(revisionIds){this.undoStack=this.undoStack.filter((id)=>!revisionIds.includes(id));this.redoStack=[];this.isWaitingForUndoRedo=false;}
onNewLocalStateUpdate({id}){this.undoStack.push(id);this.redoStack=[];if(this.undoStack.length>MAX_HISTORY_STEPS){this.undoStack.shift();}}
selectiveUndo(commands){this.dispatch("UNDO",{commands});this.isWaitingForUndoRedo=false;}
selectiveRedo(commands){this.dispatch("REDO",{commands});this.isWaitingForUndoRedo=false;}}
function normalizeV9(formula){const tokens=rangeTokenize(formula);let dependencies=[];let noRefFormula="".concat(...tokens.map((token)=>{if(token.type==="SYMBOL"&&cellReference.test(token.value)){const value=token.value.trim();if(!dependencies.includes(value)){dependencies.push(value);}
return`${FORMULA_REF_IDENTIFIER}${dependencies.indexOf(value)}${FORMULA_REF_IDENTIFIER}`;}
else{return token.value;}}));return{text:noRefFormula,dependencies};}
const CURRENT_VERSION=10;function load(data){if(!data){return createEmptyWorkbookData();}
data=JSON.parse(JSON.stringify(data));if("version"in data){if(data.version<CURRENT_VERSION){data=migrate(data);}}
data=Object.assign(createEmptyWorkbookData(),data,{version:CURRENT_VERSION});data.sheets=data.sheets.map((s,i)=>Object.assign(createEmptySheet(`Sheet${i + 1}`),s));if(data.sheets.length===0){data.sheets.push(createEmptySheet());}
return data;}
function migrate(data){const index=MIGRATIONS.findIndex((m)=>m.from===data.version);for(let i=index;i<MIGRATIONS.length;i++){data=MIGRATIONS[i].applyMigration(data);}
return data;}
const MIGRATIONS=[{description:"add the `activeSheet` field on data",from:1,to:2,applyMigration(data){if(data.sheets&&data.sheets[0]){data.activeSheet=data.sheets[0].name;}
return data;},},{description:"add an id field in each sheet",from:2,to:3,applyMigration(data){if(data.sheets&&data.sheets.length){for(let sheet of data.sheets){sheet.id=sheet.id||sheet.name;}}
return data;},},{description:"activeSheet is now an id, not the name of a sheet",from:3,to:4,applyMigration(data){if(data.sheets&&data.activeSheet){const activeSheet=data.sheets.find((s)=>s.name===data.activeSheet);data.activeSheet=activeSheet.id;}
return data;},},{description:"add figures object in each sheets",from:4,to:5,applyMigration(data){for(let sheet of data.sheets||[]){sheet.figures=sheet.figures||[];}
return data;},},{description:"normalize the content of the cell if it is a formula to avoid parsing all the formula that vary only by the cells they use",from:5,to:6,applyMigration(data){for(let sheet of data.sheets||[]){for(let xc in sheet.cells||[]){const cell=sheet.cells[xc];if(cell.content&&cell.content.startsWith("=")){cell.formula=normalizeV9(cell.content);}}}
return data;},},{description:"transform chart data structure",from:6,to:7,applyMigration(data){for(let sheet of data.sheets||[]){for(let f in sheet.figures||[]){const{dataSets,...newData}=sheet.figures[f].data;const newDataSets=[];for(let ds of dataSets){if(ds.labelCell){const dataRange=toZone(ds.dataRange);const newRange=ds.labelCell+":"+toXC(dataRange.right,dataRange.bottom);newDataSets.push(newRange);}
else{newDataSets.push(ds.dataRange);}}
newData.dataSetsHaveTitle=Boolean(dataSets[0].labelCell);newData.dataSets=newDataSets;sheet.figures[f].data=newData;}}
return data;},},{description:"remove single quotes in sheet names",from:7,to:8,applyMigration(data){var _a;const namesTaken=[];const globalForbiddenInExcel=new RegExp(FORBIDDEN_IN_EXCEL_REGEX,"g");for(let sheet of data.sheets||[]){if(!sheet.name){continue;}
const oldName=sheet.name;const escapedName=oldName.replace(globalForbiddenInExcel,"_");let i=1;let newName=escapedName;while(namesTaken.includes(newName)){newName=`${escapedName}${i}`;i++;}
sheet.name=newName;namesTaken.push(newName);const replaceName=(str)=>{if(str===undefined){return str;}
let newString=str.replace(oldName,newName);let currentString=str;while(currentString!==newString){currentString=newString;newString=currentString.replace(oldName,newName);}
return currentString;};for(let xc in sheet.cells){const cell=sheet.cells[xc];if(cell.formula){cell.formula.dependencies=cell.formula.dependencies.map(replaceName);}}
for(let figure of sheet.figures||[]){if(figure.type==="chart"){const dataSets=figure.data.dataSets.map(replaceName);const labelRange=replaceName(figure.data.labelRange);figure.data={...figure.data,dataSets,labelRange};}}
for(let cf of sheet.conditionalFormats||[]){cf.ranges=cf.ranges.map(replaceName);for(const thresholdName of["minimum","maximum","midpoint","upperInflectionPoint","lowerInflectionPoint",]){if(((_a=cf.rule[thresholdName])===null||_a===void 0?void 0:_a.type)==="formula"){cf.rule[thresholdName].value=replaceName(cf.rule[thresholdName].value);}}}}
return data;},},{description:"transform chart data structure with design attributes",from:8,to:9,applyMigration(data){for(const sheet of data.sheets||[]){for(const chart of sheet.figures||[]){chart.data.background=BACKGROUND_CHART_COLOR;chart.data.verticalAxisPosition="left";chart.data.legendPosition="top";chart.data.stackedBar=false;}}
return data;},},{description:"de-normalize formula to reduce exported json size (~30%)",from:9,to:10,applyMigration(data){for(let sheet of data.sheets||[]){for(let xc in sheet.cells||[]){const cell=sheet.cells[xc];if(cell.formula){let{text,dependencies}=cell.formula;for(let[index,d]of Object.entries(dependencies)){const stringPosition=`\\${FORMULA_REF_IDENTIFIER}${index}\\${FORMULA_REF_IDENTIFIER}`;text=text.replace(new RegExp(stringPosition,"g"),d);}
cell.content=text;delete cell.formula;}}}
return data;},},];function createEmptySheet(name=_t("Sheet")+1){return{id:name,name,colNumber:26,rowNumber:100,cells:{},cols:{},rows:{},merges:[],conditionalFormats:[],figures:[],};}
function createEmptyWorkbookData(){const data={version:CURRENT_VERSION,sheets:[createEmptySheet(_t("Sheet")+1)],entities:{},styles:{},borders:{},revisionId:DEFAULT_REVISION_ID,};return data;}
function createEmptyExcelSheet(name=_t("Sheet")+1){return{...createEmptySheet(name),charts:[],};}
function createEmptyExcelWorkbookData(){return{...createEmptyWorkbookData(),sheets:[createEmptyExcelSheet(_t("Sheet")+1)],};}
class RangeAdapter{constructor(getters){this.providers=[];this.getters=getters;}
allowDispatch(command){return 0;}
beforeHandle(command){}
handle(cmd){switch(cmd.type){case"REMOVE_COLUMNS_ROWS":{let start=cmd.dimension==="COL"?"left":"top";let end=cmd.dimension==="COL"?"right":"bottom";let dimension=cmd.dimension==="COL"?"columns":"rows";cmd.elements.sort((a,b)=>b-a);const groups=groupConsecutive(cmd.elements);this.executeOnAllRanges((range)=>{if(range.sheetId!==cmd.sheetId){return{changeType:"NONE"};}
let newRange=range;let changeType="NONE";for(let group of groups){const min=Math.min(...group);const max=Math.max(...group);if(range.zone[start]<=min&&min<=range.zone[end]){const toRemove=Math.min(range.zone[end],max)-min+1;changeType="RESIZE";newRange=this.createAdaptedRange(newRange,dimension,changeType,-toRemove);}
if(min<range.zone[start]){changeType="MOVE";newRange=this.createAdaptedRange(newRange,dimension,changeType,-(max-min+1));}}
if(changeType!=="NONE"){return{changeType,range:newRange};}
return{changeType:"NONE"};},cmd.sheetId);break;}
case"ADD_COLUMNS_ROWS":{let start=cmd.dimension==="COL"?"left":"top";let end=cmd.dimension==="COL"?"right":"bottom";let dimension=cmd.dimension==="COL"?"columns":"rows";this.executeOnAllRanges((range)=>{if(range.sheetId!==cmd.sheetId){return{changeType:"NONE"};}
if(cmd.position==="after"){if(range.zone[start]<=cmd.base&&cmd.base<range.zone[end]){return{changeType:"RESIZE",range:this.createAdaptedRange(range,dimension,"RESIZE",cmd.quantity),};}
if(cmd.base<range.zone[start]){return{changeType:"MOVE",range:this.createAdaptedRange(range,dimension,"MOVE",cmd.quantity),};}}
else{if(range.zone[start]<cmd.base&&cmd.base<=range.zone[end]){return{changeType:"RESIZE",range:this.createAdaptedRange(range,dimension,"RESIZE",cmd.quantity),};}
if(cmd.base<=range.zone[start]){return{changeType:"MOVE",range:this.createAdaptedRange(range,dimension,"MOVE",cmd.quantity),};}}
return{changeType:"NONE"};},cmd.sheetId);break;}
case"DELETE_SHEET":{this.executeOnAllRanges((range)=>{if(range.sheetId!==cmd.sheetId){return{changeType:"NONE"};}
range={...range,zone:{...range.zone},invalidSheetName:this.getters.getSheetName(cmd.sheetId),sheetId:"",};return{changeType:"REMOVE",range};},cmd.sheetId);break;}
case"RENAME_SHEET":{this.executeOnAllRanges((range)=>{if(range.sheetId===cmd.sheetId){return{changeType:"CHANGE",range};}
if(cmd.name&&range.invalidSheetName===cmd.name){const newRange={...range,zone:{...range.zone}};newRange.invalidSheetName=undefined;newRange.sheetId=cmd.sheetId;return{changeType:"CHANGE",range:newRange};}
return{changeType:"NONE"};});break;}}}
finalize(){}
verifyRangeRemoved(adaptRange){return(range)=>{const result=adaptRange(range);if(result.changeType!=="NONE"&&result.range&&(result.range.zone.right-result.range.zone.left<0||result.range.zone.bottom-result.range.zone.top<0)){return{range:result.range,changeType:"REMOVE"};}
return result;};}
createAdaptedRange(range,dimension,operation,by){return{...range,zone:createAdaptedZone(range.zone,dimension,operation,by),};}
executeOnAllRanges(adaptRange,sheetId){const func=this.verifyRangeRemoved(adaptRange);for(const provider of this.providers){provider(func,sheetId);}}
addRangeProvider(provider){this.providers.push(provider);}
orderZone(zone,parts){if(zone.right<zone.left){let right=zone.right;zone.right=zone.left;zone.left=right;let rightFixed=parts[1].colFixed;parts[1].colFixed=parts[0].colFixed;parts[0].colFixed=rightFixed;}
if(zone.bottom<zone.top){let bottom=zone.bottom;zone.bottom=zone.top;zone.top=bottom;let bottomFixed=parts[1].rowFixed;parts[1].rowFixed=parts[0].rowFixed;parts[0].rowFixed=bottomFixed;}}
createAdaptedRanges(ranges,offsetX,offsetY,sheetId){return ranges.map((range)=>{if(!isZoneValid(range.zone)){return range;}
range={...range,sheetId:range.prefixSheet?range.sheetId:sheetId,zone:{left:range.zone.left+(range.parts[0].colFixed?0:offsetX),right:range.zone.right+((range.parts[1]||range.parts[0]).colFixed?0:offsetX),top:range.zone.top+(range.parts[0].rowFixed?0:offsetY),bottom:range.zone.bottom+((range.parts[1]||range.parts[0]).rowFixed?0:offsetY),},};this.orderZone(range.zone,range.parts);return range;});}
getRangeFromSheetXC(defaultSheetId,sheetXC){let xc=sheetXC;let sheetName="";let sheetId;let invalidSheetName;let prefixSheet=false;if(!rangeReference.test(sheetXC)){return this.buildInvalidRange(sheetXC);}
if(sheetXC.includes("!")){[xc,sheetName]=sheetXC.split("!").reverse();if(sheetName){sheetId=this.getters.getSheetIdByName(sheetName);prefixSheet=true;if(!sheetId){invalidSheetName=sheetName;}}
else{invalidSheetName=sheetName;}}
const zone=toZoneWithoutBoundaryChanges(xc);let rangeParts=xc.split(":").map((p)=>{return{colFixed:p.startsWith("$"),rowFixed:p.includes("$",1),};});this.orderZone(zone,rangeParts);return{sheetId:sheetId||defaultSheetId,zone:zone,parts:rangeParts,invalidSheetName,prefixSheet,};}
getRangeString(range,forSheetId){if(!range){return INCORRECT_RANGE_STRING;}
if(range.invalidXc){return range.invalidXc;}
if(range.zone.bottom-range.zone.top<0||range.zone.right-range.zone.left<0){return INCORRECT_RANGE_STRING;}
if(range.zone.left<0||range.zone.top<0){return INCORRECT_RANGE_STRING;}
let prefixSheet=range.sheetId!==forSheetId||range.invalidSheetName||range.prefixSheet;let sheetName="";if(prefixSheet){if(range.invalidSheetName){sheetName=range.invalidSheetName;}
else{sheetName=getComposerSheetName(this.getters.getSheetName(range.sheetId));}}
if(prefixSheet&&!sheetName){return INCORRECT_RANGE_STRING;}
let ref=Array(9);ref[0]=range.parts&&range.parts[0].colFixed?"$":"";ref[1]=numberToLetters(range.zone.left);ref[2]=range.parts&&range.parts[0].rowFixed?"$":"";ref[3]=String(range.zone.top+1);if(range.parts&&range.parts.length===2){if(range.zone.top!==range.zone.bottom||range.zone.left!==range.zone.right||range.parts[0].rowFixed||range.parts[0].colFixed||range.parts[1].rowFixed||range.parts[1].colFixed){ref[4]=":";ref[5]=range.parts[1].colFixed?"$":"";ref[6]=numberToLetters(range.zone.right);ref[7]=range.parts[1].rowFixed?"$":"";ref[8]=String(range.zone.bottom+1);}}
return`${prefixSheet ? sheetName + "!" : ""}${ref.join("")}`;}
buildInvalidRange(invalidXc){return{parts:[],prefixSheet:false,zone:{left:-1,top:-1,right:-1,bottom:-1},sheetId:"",invalidXc,};}}
RangeAdapter.getters=["getRangeString","getRangeFromSheetXC","createAdaptedRanges"];class StateObserver{constructor(){this.changes=[];this.commands=[];}
recordChanges(callback){this.changes=[];this.commands=[];callback();return{changes:this.changes,commands:this.commands};}
addCommand(command){this.commands.push(command);}
addChange(...args){const val=args.pop();const[root,...path]=args;let value=root;let key=path[path.length-1];for(let pathIndex=0;pathIndex<=path.length-2;pathIndex++){const p=path[pathIndex];if(value[p]===undefined){const nextPath=path[pathIndex+1];value[p]=createEmptyStructure(nextPath);}
value=value[p];}
if(value[key]===val){return;}
this.changes.push({root,path,before:value[key],after:val,});if(val===undefined){delete value[key];}
else{value[key]=val;}}}
const XLSX_FORMAT_MAP={General:0,"0":1,"0.00":2,"#,#00":3,"#,##0.00":4,"0%":9,"0.00%":10,"0.00E+00":11,"# ?/?":12,"# ??/??":13,"mm-dd-yy":14,"d-mm-yy":15,"mm-yy":16,"mmm-yy":17,"h:mm AM/PM":18,"h:mm:ss AM/PM":19,"h:mm":20,"h:mm:ss":21,"m/d/yy h:mm":22,"#,##0 ;(#,##0)":37,"#,##0 ;[Red](#,##0)":38,"#,##0.00;(#,##0.00)":39,"#,##0.00;[Red](#,##0.00)":40,"mm:ss":45,"[h]:mm:ss":46,"mmss.0":47,"##0.0E+0":48,"@":49,"hh:mm:ss a":19,};const XLSX_ICONSET_MAP={arrow:"3Arrows",smiley:"3Symbols",dot:"3TrafficLights1",};const NAMESPACE={styleSheet:"http://schemas.openxmlformats.org/spreadsheetml/2006/main",sst:"http://schemas.openxmlformats.org/spreadsheetml/2006/main",Relationships:"http://schemas.openxmlformats.org/package/2006/relationships",Types:"http://schemas.openxmlformats.org/package/2006/content-types",worksheet:"http://schemas.openxmlformats.org/spreadsheetml/2006/main",workbook:"http://schemas.openxmlformats.org/spreadsheetml/2006/main",drawing:"http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing",};const DRAWING_NS_A="http://schemas.openxmlformats.org/drawingml/2006/main";const DRAWING_NS_C="http://schemas.openxmlformats.org/drawingml/2006/chart";const CONTENT_TYPES={workbook:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",sheet:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",sharedStrings:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",styles:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",drawing:"application/vnd.openxmlformats-officedocument.drawing+xml",chart:"application/vnd.openxmlformats-officedocument.drawingml.chart+xml",};const RELATIONSHIP_NSR="http://schemas.openxmlformats.org/officeDocument/2006/relationships";const HEIGHT_FACTOR=0.75;const WIDTH_FACTOR=0.1425;const FIRST_NUMFMT_ID=164;const FORCE_DEFAULT_ARGS_FUNCTIONS={FLOOR:[{type:"NUMBER",value:1}],CEILING:[{type:"NUMBER",value:1}],ROUND:[{type:"NUMBER",value:0}],ROUNDUP:[{type:"NUMBER",value:0}],ROUNDDOWN:[{type:"NUMBER",value:0}],};const NON_RETROCOMPATIBLE_FUNCTIONS=["ACOT","ACOTH","AGGREGATE","ARABIC","BASE","BETA.DIST","BETA.INV","BINOM.DIST","BINOM.DIST.RANGE","BINOM.INV","BITAND","BITLSHIFT","BITOR","BITRSHIFT","BITXOR","CEILING.MATH","CEILING.PRECISE","CHISQ.DIST","CHISQ.DIST.RT","CHISQ.INV","CHISQ.INV.RT","CHISQ.TEST","COMBINA","CONCAT","CONFIDENCE.NORM","CONFIDENCE.T","COT","COTH","COVARIANCE.P","COVARIANCE.S","CSC","CSCH","DAYS","DECIMAL","ERF.PRECISE","ERFC.PRECISE","EXPON.DIST","F.DIST","F.DIST.RT","F.INV","F.INV.RT","F.TEST","FILTERXML","FLOOR.MATH","FLOOR.PRECISE","FORECAST.ETS","FORECAST.ETS.CONFINT","FORECAST.ETS.SEASONALITY","FORECAST.ETS.STAT","FORECAST.LINEAR","FORMULATEXT","GAMMA","GAMMA.DIST","GAMMA.INV","GAMMALN.PRECISE","GAUSS","HYPGEOM.DIST","IFNA","IFS","IMCOSH","IMCOT","IMCSC","IMCSCH","IMSEC","IMSECH","IMSINH","IMTAN","ISFORMULA","ISOWEEKNUM","LOGNORM.DIST","LOGNORM.INV","MAXIFS","MINIFS","MODE.MULT","MODE.SNGL","MUNIT","NEGBINOM.DIST","NORM.DIST","NORM.INV","NORM.S.DIST","NORM.S.INV","NUMBERVALUE","PDURATION","PERCENTILE.EXC","PERCENTILE.INC","PERCENTRANK.EXC","PERCENTRANK.INC","PERMUTATIONA","PHI","POISSON.DIST","QUARTILE.EXC","QUARTILE.INC","QUERYSTRING","RANK.AVG","RANK.EQ","RRI","SEC","SECH","SHEET","SHEETS","SKEW.P","STDEV.P","STDEV.S","SWITCH","T.DIST","T.DIST.2T","T.DIST.RT","T.INV","T.INV.2T","T.TEST","TEXTJOIN","UNICHAR","UNICODE","VAR.P","VAR.S","WEBSERVICE","WEIBULL.DIST","XOR","Z.TEST",];function convertOperator(operator){return operator.charAt(0).toLowerCase()+operator.slice(1);}
function getCellType(value){switch(typeof value){case"boolean":return"b";case"string":return"str";case"number":return"n";}}
function convertHeight(height){return Math.round(HEIGHT_FACTOR*height*window.devicePixelRatio*100)/100;}
function convertWidth(width){return Math.round(WIDTH_FACTOR*width*100)/100;}
function extractStyle(cell,data){let style={};if(cell.style){style=data.styles[cell.style];}
let border={};if(cell.border){border=data.borders[cell.border];}
const styles={font:{size:(style===null||style===void 0?void 0:style.fontSize)||DEFAULT_FONT_SIZE,color:(style===null||style===void 0?void 0:style.textColor)?style.textColor:"000000",family:2,name:"Arial",},fill:(style===null||style===void 0?void 0:style.fillColor)?{fgColor:style.fillColor,}:{reservedAttribute:"none"},numFmt:cell.format,border:border||{},verticalAlignment:"center",horizontalAlignment:style===null||style===void 0?void 0:style.align,};styles.font["strike"]=!!(style===null||style===void 0?void 0:style.strikethrough)||undefined;styles.font["underline"]=!!(style===null||style===void 0?void 0:style.underline)||undefined;styles.font["bold"]=!!(style===null||style===void 0?void 0:style.bold)||undefined;styles.font["italic"]=!!(style===null||style===void 0?void 0:style.italic)||undefined;return styles;}
function normalizeStyle(construct,styles){const{id:fontId}=pushElement(styles["font"],construct.fonts);const{id:fillId}=pushElement(styles["fill"],construct.fills);const{id:borderId}=pushElement(styles["border"],construct.borders);const numFmtId=convertFormat(styles["numFmt"],construct.numFmts);const style={fontId,fillId,borderId,numFmtId,verticalAlignment:styles["verticalAlignment"],horizontalAlignment:styles["horizontalAlignment"],};const{id}=pushElement(style,construct.styles);return id;}
function convertFormat(format,numFmtStructure){if(!format){return 0;}
let formatId=XLSX_FORMAT_MAP[format];if(!formatId){const{id}=pushElement(format,numFmtStructure);formatId=id+FIRST_NUMFMT_ID;}
return formatId;}
function addRelsToFile(relsFiles,path,rel){let relsFile=relsFiles.find((file)=>file.path===path);let id;if(!relsFile){id="rId1";relsFiles.push({path,rels:[{...rel,id}]});}
else{id=`rId${(relsFile.rels.length + 1).toString()}`;relsFile.rels.push({...rel,id,});}
return id;}
function pushElement(property,propertyList){for(let[key,value]of Object.entries(propertyList)){if(JSON.stringify(value)===JSON.stringify(property)){return{id:parseInt(key,10),list:propertyList};}}
let elemId=propertyList.findIndex((elem)=>JSON.stringify(elem)===JSON.stringify(property));if(elemId===-1){propertyList.push(property);elemId=propertyList.length-1;}
return{id:elemId,list:propertyList,};}
const chartIds=[];function convertChartId(chartId){const xlsxId=chartIds.findIndex((id)=>id===chartId);if(xlsxId===-1){chartIds.push(chartId);return chartIds.length;}
return xlsxId+1;}
function convertDotValueToEMU(value){const DPI=96;return Math.round((value*914400)/DPI);}
class XMLString{constructor(xmlString){this.xmlString=xmlString;}
toString(){return this.xmlString;}}
function createXMLFile(doc,path,contentType){return{content:new XMLSerializer().serializeToString(doc),path,contentType,};}
function xmlEscape(str){return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");}
function formatAttributes(attrs){return new XMLString(attrs.map(([key,val])=>`${key}="${xmlEscape(val)}"`).join(" "));}
function parseXML(xmlString){const document=new DOMParser().parseFromString(xmlString.toString(),"text/xml");const parserError=document.querySelector("parsererror");if(parserError){const errorString=parserError.innerHTML;const lineNumber=parseInt(errorString.split(":")[0],10);const xmlStringArray=xmlString.toString().trim().split("\n");const xmlPreview=xmlStringArray.slice(Math.max(lineNumber-3,0),Math.min(lineNumber+2,xmlStringArray.length)).join("\n");throw new Error(`XML string could not be parsed: ${errorString}\n${xmlPreview}`);}
return document;}
function getDefaultXLSXStructure(){return{relsFiles:[],sharedStrings:[],styles:[{fontId:0,fillId:0,numFmtId:0,borderId:0,verticalAlignment:"center",},],fonts:[{size:DEFAULT_FONT_SIZE,family:2,color:"000000",name:"Calibri",},],fills:[{reservedAttribute:"none"},{reservedAttribute:"gray125"}],borders:[{}],numFmts:[],dxfs:[],};}
function createOverride(partName,contentType){return escapeXml`
    <Override ContentType="${contentType}" PartName="${partName}" />
  `;}
function joinXmlNodes(xmlNodes){return new XMLString(xmlNodes.join("\n"));}
function escapeXml(strings,...expressions){let str=[strings[0]];for(let i=0;i<expressions.length;i++){const value=expressions[i]instanceof XMLString?expressions[i]:xmlEscape(expressions[i]);str.push(value+strings[i+1]);}
return new XMLString(str.join(""));}
const catAxId=17781237;const valAxId=88853993;function createChart(chart){const namespaces=[["xmlns:r",RELATIONSHIP_NSR],["xmlns:a",DRAWING_NS_A],["xmlns:c",DRAWING_NS_C],];const chartShapeProperty=shapeProperty({backgroundColor:toHex6(chart.data.backgroundColor),line:{color:"000000"},});let title=escapeXml``;if(chart.data.title){title=escapeXml`
      <c:title>
        ${insertText(chart.data.title)}
        <c:overlay val="0" />
      </c:title>
    `;}
let plot=escapeXml``;switch(chart.data.type){case"bar":plot=addBarChart(chart.data);break;case"line":plot=addLineChart(chart.data);break;case"pie":plot=addDoughnutChart(chart.data,{holeSize:0});break;}
let position="t";switch(chart.data.legendPosition){case"bottom":position="b";break;case"left":position="l";break;case"right":position="r";break;case"top":position="t";break;}
const xml=escapeXml`
    <c:chartSpace ${formatAttributes(namespaces)}>
      <c:roundedCorners val="0" />
      <!-- <manualLayout/> to manually position the chart in the figure container -->
      ${chartShapeProperty}
      <c:chart>
        ${title}
        <c:autoTitleDeleted val="0" />
        <c:plotArea>
          <!-- how the chart element is placed on the chart -->
          <c:layout />
          ${plot}
          ${shapeProperty({ backgroundColor: toHex6(chart.data.backgroundColor) })}
        </c:plotArea>
        ${addLegend(position)}
      </c:chart>
    </c:chartSpace>
  `;return parseXML(xml);}
function shapeProperty(params){return escapeXml`
    <c:spPr>
      ${params.backgroundColor ? solidFill(params.backgroundColor) : ""}
      ${params.line ? lineAttributes(params.line) : ""}
    </c:spPr>
  `;}
function solidFill(color){return escapeXml`
    <a:solidFill>
      <a:srgbClr val="${color}"/>
    </a:solidFill>
  `;}
function lineAttributes(params){const attrs=[["cmpd","sng"]];if(params.width){attrs.push(["w",convertDotValueToEMU(params.width)]);}
const lineStyle=params.style?escapeXml`<a:prstDash val="${params.style}"/>`:"";return escapeXml`
    <a:ln ${formatAttributes(attrs)}>
      ${solidFill(params.color)}
      ${lineStyle}
    </a:ln>
  `;}
function insertText(text,fontsize=22){return escapeXml`
    <c:tx>
      <c:rich>
        <a:bodyPr />
        <a:lstStyle />
        <a:p>
          <a:pPr lvl="0">
            <a:defRPr b="0">
              ${solidFill("000000")}
              <a:latin typeface="+mn-lt"/>
            </a:defRPr>
          </a:pPr>
          <a:r> <!-- Runs -->
            <a:rPr sz="${fontsize * 100}"/>
            <a:t>${text}</a:t>
          </a:r>
        </a:p>
      </c:rich>
    </c:tx>
  `;}
function insertTextProperties(fontsize=12,bold=false,italic=false){const defPropertiesAttributes=[["b",bold?"1":"0"],["i",italic?"1":"0"],["sz",fontsize*100],];return escapeXml`
    <c:txPr>
      <a:bodyPr/>
      <a:lstStyle/>
      <a:p>
        <a:pPr lvl="0">
          <a:defRPr ${formatAttributes(defPropertiesAttributes)}>
            ${solidFill("000000")}
            <a:latin typeface="+mn-lt"/>
          </a:defRPr>
        </a:pPr>
      </a:p>
    </c:txPr>
  `;}
function addBarChart(chart){const colors=new ChartColors();const dataSetsNodes=[];for(const[dsIndex,dataset]of Object.entries(chart.dataSets)){const color=toHex6(colors.next());const dataShapeProperty=shapeProperty({backgroundColor:color,line:{color},});dataSetsNodes.push(escapeXml`
      <c:ser>
        <c:idx val="${dsIndex}"/>
        <c:order val="${dsIndex}"/>
        ${dataset.label ? escapeXml /*xml*/ `<c:tx>${stringRef(dataset.label)}</c:tx>` : ""}
        ${dataShapeProperty}
        ${chart.labelRange ? escapeXml /*xml*/ `<c:cat>${stringRef(chart.labelRange)}</c:cat>` : ""} <!-- x-coordinate values -->
        <c:val> <!-- x-coordinate values -->
          ${numberRef(dataset.range)}
        </c:val>
      </c:ser>
    `);}
const axisPos=chart.verticalAxisPosition==="left"?"l":"r";const grouping=chart.stackedBar?"stacked":"clustered";const overlap=chart.stackedBar?100:-20;return escapeXml`
    <c:barChart>
      <c:barDir val="col"/>
      <c:grouping val="${grouping}"/>
      <c:overlap val="${overlap}"/>
      <c:gapWidth val="70"/>
      <!-- each data marker in the series does not have a different color -->
      <c:varyColors val="0"/>
      ${joinXmlNodes(dataSetsNodes)}
      <c:axId val="${catAxId}" />
      <c:axId val="${valAxId}" />
    </c:barChart>
    ${addAx("b", "c:catAx", catAxId, valAxId)}
    ${addAx(axisPos, "c:valAx", valAxId, catAxId)}
  `;}
function addLineChart(chart){const colors=new ChartColors();const dataSetsNodes=[];for(const[dsIndex,dataset]of Object.entries(chart.dataSets)){const dataShapeProperty=shapeProperty({line:{width:2.5,style:"solid",color:toHex6(colors.next()),},});dataSetsNodes.push(escapeXml`
      <c:ser>
        <c:idx val="${dsIndex}"/>
        <c:order val="${dsIndex}"/>
        <c:smooth val="0"/>
        <c:marker>
          <c:symbol val="circle" />
          <c:size val="5"/>
        </c:marker>
        ${dataset.label ? escapeXml `<c:tx>${stringRef(dataset.label)}</c:tx>` : ""}
        ${dataShapeProperty}
        ${chart.labelRange ? escapeXml `<c:cat>${stringRef(chart.labelRange)}</c:cat>` : ""} <!-- x-coordinate values -->
        <c:val> <!-- x-coordinate values -->
          ${numberRef(dataset.range)}
        </c:val>
      </c:ser>
    `);}
const axisPos=chart.verticalAxisPosition==="left"?"l":"r";return escapeXml`
    <c:lineChart>
      <!-- each data marker in the series does not have a different color -->
      <c:varyColors val="0"/>
      ${joinXmlNodes(dataSetsNodes)}
      <c:axId val="${catAxId}" />
      <c:axId val="${valAxId}" />
    </c:lineChart>
    ${addAx("b", "c:catAx", catAxId, valAxId)}
    ${addAx(axisPos, "c:valAx", valAxId, catAxId)}
  `;}
function addDoughnutChart(chart,{holeSize}={holeSize:50}){const colors=new ChartColors();const maxLength=Math.max(...chart.dataSets.map((ds)=>{const zone=toZone(ds.range);const{height,width}=zoneToDimension(zone);return height*width;}));const doughnutColors=range(0,maxLength).map(()=>toHex6(colors.next()));const dataSetsNodes=[];for(const[dsIndex,dataset]of Object.entries(chart.dataSets).reverse()){const zone=toZone(dataset.range);const{height,width}=zoneToDimension(zone);const dataPoints=[];for(const index of range(0,height*width)){const pointShapeProperty=shapeProperty({backgroundColor:doughnutColors[index],line:{color:"FFFFFF",width:1.5},});dataPoints.push(escapeXml`
        <c:dPt>
          <c:idx val="${index}"/>
          ${pointShapeProperty}
        </c:dPt>
      `);}
dataSetsNodes.push(escapeXml`
      <c:ser>
        <c:idx val="${dsIndex}"/>
        <c:order val="${dsIndex}"/>
        ${dataset.label ? escapeXml `<c:tx>${stringRef(dataset.label)}</c:tx>` : ""}
        ${joinXmlNodes(dataPoints)}
        ${insertDataLabels({ showLeaderLines: true })}
        ${chart.labelRange ? escapeXml `<c:cat>${stringRef(chart.labelRange)}</c:cat>` : ""}
        <c:val>
          ${numberRef(dataset.range)}
        </c:val>
      </c:ser>
    `);}
return escapeXml`
    <c:doughnutChart>
      <c:varyColors val="1" />
      <c:holeSize val="${holeSize}" />
      ${insertDataLabels()}
      ${joinXmlNodes(dataSetsNodes)}
    </c:doughnutChart>
  `;}
function insertDataLabels({showLeaderLines}={showLeaderLines:false}){return escapeXml`
    <dLbls>
      <c:showLegendKey val="0"/>
      <c:showVal val="0"/>
      <c:showCatName val="0"/>
      <c:showSerName val="0"/>
      <c:showPercent val="0"/>
      <c:showBubbleSize val="0"/>
      <c:showLeaderLines val="${showLeaderLines ? "1" : "0"}"/>
    </dLbls>
  `;}
function addAx(position,axisName,axId,crossAxId){return escapeXml`
    <${axisName}>
      <c:axId val="${axId}"/>
      <c:crossAx val="${crossAxId}"/> <!-- reference to the other axe of the chart -->
      <c:delete val="0"/> <!-- by default, axis are not displayed -->
      <c:scaling>
        <c:orientation  val="minMax" />
      </c:scaling>
      <c:axPos val="${position}" />
      ${insertMajorGridLines()}
      <c:majorTickMark val="out" />
      <c:minorTickMark val="none" />
      <c:numFmt formatCode="General" sourceLinked="1" />
      <c:title>
        ${insertText("")}
      </c:title>
      ${insertTextProperties(10)}
    </${axisName}>
    <!-- <tickLblPos/> omitted -->
  `;}
function addLegend(position){return escapeXml`
    <c:legend>
      <c:legendPos val="${position}"/>
      <c:overlay val="0"/>
      ${insertTextProperties(10)}
    </c:legend>
  `;}
function insertMajorGridLines(color="B7B7B7"){return escapeXml`
    <c:majorGridlines>
      ${shapeProperty({ line: { color } })}
    </c:majorGridlines>
  `;}
function stringRef(reference){return escapeXml`
    <c:strRef>
      <c:f>${reference}</c:f>
    </c:strRef>
  `;}
function numberRef(reference){return escapeXml`
    <c:numRef>
      <c:f>${reference}</c:f>
      <c:numCache />
    </c:numRef>
  `;}
function addFormula(cell){const formula=cell.content;const functions=functionRegistry.content;const tokens=tokenize(formula);const attrs=[];let node=escapeXml``;const isExported=tokens.filter((tk)=>tk.type==="FUNCTION").every((tk)=>functions[tk.value.toUpperCase()].isExported);if(isExported){let cycle=escapeXml``;const XlsxFormula=adaptFormulaToExcel(formula);if(cell.value==="#CYCLE"){attrs.push(["t","str"]);cycle=escapeXml`<v>${cell.value}</v>`;}
node=escapeXml`
      <f>
        ${XlsxFormula}
      </f>
      ${cycle}
    `;return{attrs,node};}
else{const value=cell.value;if(value){const type=getCellType(value);attrs.push(["t",type]);node=escapeXml`<v>${value}</v>`;}
return{attrs,node};}}
function addContent(content,sharedStrings){let value=content;const attrs=[];if(["TRUE","FALSE"].includes(value.trim())){value=value==="TRUE"?"1":"0";attrs.push(["t","b"]);}
else if(!isNumber(value)){const{id}=pushElement(content,sharedStrings);value=id.toString();attrs.push(["t","s"]);}
return{attrs,node:escapeXml`<v>${value}</v>`};}
function adaptFormulaToExcel(formulaText){if(formulaText[0]==="="){formulaText=formulaText.slice(1);}
let ast;try{ast=parse(formulaText);}
catch(error){return formulaText;}
ast=convertAstNodes(ast,"STRING",convertDateFormat);ast=convertAstNodes(ast,"FUNCALL",(ast)=>{ast={...ast,value:ast.value.toUpperCase()};ast=prependNonRetrocompatibleFunction(ast);ast=addMissingRequiredArgs(ast);return ast;});return ast?astToFormula(ast):formulaText;}
function addMissingRequiredArgs(ast){const formulaName=ast.value.toUpperCase();const args=ast.args;const exportDefaultArgs=FORCE_DEFAULT_ARGS_FUNCTIONS[formulaName];if(exportDefaultArgs){const requiredArgs=functionRegistry.content[formulaName].args.filter((el)=>!el.optional);const diffArgs=requiredArgs.length-ast.args.length;if(diffArgs){for(let i=ast.args.length;i<requiredArgs.length;i++){const currentDefaultArg=exportDefaultArgs[i-diffArgs];args.push({type:currentDefaultArg.type,value:currentDefaultArg.value});}}}
return{...ast,args};}
function prependNonRetrocompatibleFunction(ast){const formulaName=ast.value.toUpperCase();return{...ast,value:NON_RETROCOMPATIBLE_FUNCTIONS.includes(formulaName)?`_xlfn.${formulaName}`:formulaName,};}
function convertDateFormat(ast){const value=ast.value.replace(new RegExp('"',"g"),"");const internalDate=parseDateTime(value);if(internalDate){let format=[];if(value.match(mdyDateRegexp)||value.match(ymdDateRegexp)){format.push("yyyy-mm-dd");}
if(value.match(timeRegexp)){format.push("hh:mm:ss");}
return{...ast,value:`"${formatDateTime({ value: internalDate.value, format: format.join(" ") })}"`,};}
else{return{...ast,value:ast.value.replace(/\\"/g,`""`)};}}
function addConditionalFormatting(dxfs,conditionalFormats){const cfNodes=[];for(const cf of conditionalFormats){switch(cf.rule.type){case"CellIsRule":cfNodes.push(addCellIsRule(cf,cf.rule,dxfs));break;case"ColorScaleRule":cfNodes.push(addColorScaleRule(cf,cf.rule));break;case"IconSetRule":cfNodes.push(addIconSetRule(cf,cf.rule));break;default:console.warn(`Conditional formatting ${cf.rule.type} not implemented`);break;}}
return cfNodes;}
function addCellIsRule(cf,rule,dxfs){const ruleAttributes=commonCfAttributes(cf);ruleAttributes.push(["type","cellIs"],["operator",convertOperator(rule.operator)]);const formulas=rule.values.map((value)=>escapeXml`<formula>${value}</formula>`);const dxf={};if(rule.style.textColor){dxf.font={color:rule.style.textColor};}
if(rule.style.fillColor){dxf.fill={fgColor:rule.style.fillColor};}
const{id}=pushElement(dxf,dxfs);ruleAttributes.push(["dxfId",id]);return escapeXml`
    <conditionalFormatting sqref="${cf.ranges.join(" ")}">
      <cfRule ${formatAttributes(ruleAttributes)}>
        ${joinXmlNodes(formulas)}
      </cfRule>
    </conditionalFormatting>
  `;}
function addColorScaleRule(cf,rule){const ruleAttributes=commonCfAttributes(cf);ruleAttributes.push(["type","colorScale"]);const conditionalFormats=[];for(const range of cf.ranges){const cfValueObject=[];const colors=[];let canExport=true;for(let position of["minimum","midpoint","maximum"]){const threshold=rule[position];if(!threshold){continue;}
if(threshold.type==="formula"){canExport=false;continue;}
cfValueObject.push(thresholdAttributes(threshold,position));colors.push([["rgb",colorNumberString(threshold.color)]]);}
if(!canExport){console.warn("Conditional formats with formula rules are not supported at the moment. The rule is therefore skipped.");continue;}
const cfValueObjectNodes=cfValueObject.map((attrs)=>escapeXml`<cfvo ${formatAttributes(attrs)}/>`);const cfColorNodes=colors.map((attrs)=>escapeXml`<color ${formatAttributes(attrs)}/>`);conditionalFormats.push(escapeXml`
      <conditionalFormatting sqref="${range}">
        <cfRule ${formatAttributes(ruleAttributes)}>
          <colorScale>
            ${joinXmlNodes(cfValueObjectNodes)}
            ${joinXmlNodes(cfColorNodes)}
          </colorScale>
        </cfRule>
      </conditionalFormatting>
    `);}
return joinXmlNodes(conditionalFormats);}
function addIconSetRule(cf,rule){const ruleAttributes=commonCfAttributes(cf);ruleAttributes.push(["type","iconSet"]);const conditionalFormats=[];for(const range of cf.ranges){const cfValueObject=[[["type","percent"],["val",0],],];let canExport=true;for(let position of["lowerInflectionPoint","upperInflectionPoint"]){if(rule[position].type==="formula"){canExport=false;continue;}
const threshold=rule[position];cfValueObject.push([...thresholdAttributes(threshold,position),["gte",threshold.operator==="ge"?"1":"0"],]);}
if(!canExport){console.warn("Conditional formats with formula rules are not supported at the moment. The rule is therefore skipped.");continue;}
const cfValueObjectNodes=cfValueObject.map((attrs)=>escapeXml`<cfvo ${formatAttributes(attrs)} />`);conditionalFormats.push(escapeXml`
      <conditionalFormatting sqref="${range}">
        <cfRule ${formatAttributes(ruleAttributes)}>
          <iconSet iconSet="${getIconSet(rule.icons)}">
            ${joinXmlNodes(cfValueObjectNodes)}
          </iconSet>
        </cfRule>
      </conditionalFormatting>
    `);}
return joinXmlNodes(conditionalFormats);}
function commonCfAttributes(cf){return[["priority",1],["stopIfTrue",cf.stopIfTrue?1:0],];}
function getIconSet(iconSet){return XLSX_ICONSET_MAP[Object.keys(XLSX_ICONSET_MAP).find((key)=>iconSet.upper.toLowerCase().startsWith(key))||"dots"];}
function thresholdAttributes(threshold,position){const type=getExcelThresholdType(threshold.type,position);const attrs=[["type",type]];if(type!=="min"&&type!=="max"){let val=threshold.value;if(type==="formula"){try{checkRelativeReferences(threshold.value);val=adaptFormulaToExcel(threshold.value);}
catch(error){val=threshold.value;}}
attrs.push(["val",val]);}
return attrs;}
function getExcelThresholdType(type,position){switch(type){case"value":return position==="minimum"?"min":"max";case"number":return"num";case"percentage":return"percent";default:return type;}}
function checkRelativeReferences(formula){const{dependencies}=normalize(formula);if(dependencies.references.length){console.warn("Relative references might not work in conditional format formula thresholds in Excel.");}}
function createDrawing(chartRelIds,sheet,figures){const namespaces=[["xmlns:xdr",NAMESPACE.drawing],["xmlns:r",RELATIONSHIP_NSR],["xmlns:a",DRAWING_NS_A],["xmlns:c",DRAWING_NS_C],];const figuresNodes=[];for(const[figureIndex,figure]of Object.entries(figures)){const{from,to}=convertFigureData(figure,sheet);const chartId=convertChartId(figure.id);const cNvPrAttrs=[["id",chartId],["name",`Chart ${chartId}`],["title","Chart"],];figuresNodes.push(escapeXml`
      <xdr:twoCellAnchor>
        <xdr:from>
          <xdr:col>${from.col}</xdr:col>
          <xdr:colOff>${from.colOff}</xdr:colOff>
          <xdr:row>${from.row}</xdr:row>
          <xdr:rowOff>${from.rowOff}</xdr:rowOff>
        </xdr:from>
        <xdr:to>
          <xdr:col>${to.col}</xdr:col>
          <xdr:colOff>${to.colOff}</xdr:colOff>
          <xdr:row>${to.row}</xdr:row>
          <xdr:rowOff>${to.rowOff}</xdr:rowOff>
        </xdr:to>
        <xdr:graphicFrame>
          <xdr:nvGraphicFramePr>
            <xdr:cNvPr ${formatAttributes(cNvPrAttrs)} />
            <xdr:cNvGraphicFramePr />
          </xdr:nvGraphicFramePr>
          <xdr:xfrm>
            <a:off x="0" y="0"/>
            <a:ext cx="0" cy="0"/>
          </xdr:xfrm>
          <a:graphic>
            <a:graphicData uri="${DRAWING_NS_C}">
              <c:chart r:id="${chartRelIds[figureIndex]}" />
            </a:graphicData>
          </a:graphic>
        </xdr:graphicFrame>
        <xdr:clientData fLocksWithSheet="0"/>
      </xdr:twoCellAnchor>
    `);}
const xml=escapeXml`
    <xdr:wsDr ${formatAttributes(namespaces)}>
      ${joinXmlNodes(figuresNodes)}
    </xdr:wsDr>
  `;return parseXML(xml);}
function convertFigureData(figure,sheet){const{x,y,height,width}=figure;const cols=Object.values(sheet.cols);const rows=Object.values(sheet.rows);const{index:colFrom,offset:offsetColFrom}=figureCoordinates(cols,x);const{index:colTo,offset:offsetColTo}=figureCoordinates(cols,x+width);const{index:rowFrom,offset:offsetRowFrom}=figureCoordinates(rows,y);const{index:rowTo,offset:offsetRowTo}=figureCoordinates(rows,y+height);return{from:{col:colFrom,colOff:offsetColFrom,row:rowFrom,rowOff:offsetRowFrom,},to:{col:colTo,colOff:offsetColTo,row:rowTo,rowOff:offsetRowTo,},};}
function figureCoordinates(headers,position){let currentPosition=0;for(const[headerIndex,header]of Object.entries(headers)){if(currentPosition<=position&&position<currentPosition+header.size){return{index:parseInt(headerIndex),offset:convertDotValueToEMU(position-currentPosition+FIGURE_BORDER_SIZE),};}
else{currentPosition+=header.size;}}
return{index:headers.length-1,offset:convertDotValueToEMU(position-currentPosition+FIGURE_BORDER_SIZE),};}
function addNumberFormats(numFmts){const numFmtNodes=[];for(let[index,numFmt]of Object.entries(numFmts)){const numFmtAttrs=[["numFmtId",parseInt(index)+FIRST_NUMFMT_ID],["formatCode",numFmt],];numFmtNodes.push(escapeXml`
      <numFmt ${formatAttributes(numFmtAttrs)}/>
    `);}
return escapeXml`
    <numFmts count="${numFmts.length}">
      ${joinXmlNodes(numFmtNodes)}
    </numFmts>
  `;}
function addFonts(fonts){const fontNodes=[];for(let font of Object.values(fonts)){fontNodes.push(escapeXml`
      <font>
        ${font.bold ? escapeXml /*xml*/ `<b/>` : ""}
        ${font.italic ? escapeXml /*xml*/ `<i/>` : ""}
        ${font.underline ? escapeXml /*xml*/ `<u/>` : ""}
        ${font.strike ? escapeXml /*xml*/ `<strike/>` : ""}
        <sz val="${font.size}" />
        <color rgb="${toHex6(font.color)}" />
        <name val="${font.name}" />
      </font>
    `);}
return escapeXml`
    <fonts count="${fonts.length}">
      ${joinXmlNodes(fontNodes)}
    </fonts>
  `;}
function addFills(fills){const fillNodes=[];for(let fill of Object.values(fills)){if(fill.reservedAttribute!==undefined){fillNodes.push(escapeXml`
        <fill>
          <patternFill patternType="${fill.reservedAttribute}" />
        </fill>
      `);}
else{fillNodes.push(escapeXml`
        <fill>
          <patternFill patternType="solid">
            <fgColor rgb="${toHex6(fill.fgColor)}" />
            <bgColor indexed="64" />
          </patternFill>
        </fill>
      `);}}
return escapeXml`
    <fills count="${fills.length}">
    ${joinXmlNodes(fillNodes)}
    </fills>
  `;}
function addBorders(borders){const borderNodes=[];for(let border of Object.values(borders)){borderNodes.push(escapeXml`
      <border>
        <left ${formatBorderAttribute(border["left"])} />
        <right ${formatBorderAttribute(border["right"])} />
        <top ${formatBorderAttribute(border["top"])} />
        <bottom ${formatBorderAttribute(border["bottom"])} />
        <diagonal ${formatBorderAttribute(border["diagonal"])} />
      </border>
    `);}
return escapeXml`
    <borders count="${borders.length}">
      ${joinXmlNodes(borderNodes)}
    </borders>
  `;}
function formatBorderAttribute(description){if(!description){return escapeXml``;}
return formatAttributes([["style",description[0]],["color",toHex6(description[1])],]);}
function addStyles(styles){const styleNodes=[];for(let style of styles){const attributes=[["numFmtId",style.numFmtId],["fillId",style.fillId],["fontId",style.fontId],["borderId",style.borderId],];const alignAttrs=[];if(style.verticalAlignment){alignAttrs.push(["vertical",style.verticalAlignment]);}
if(style.horizontalAlignment){alignAttrs.push(["horizontal",style.horizontalAlignment]);}
styleNodes.push(escapeXml`
      <xf ${formatAttributes(attributes)}>
        ${alignAttrs ? escapeXml /*xml*/ `<alignment ${formatAttributes(alignAttrs)}/>` : ""}
      </xf>
    `);}
return escapeXml`
    <cellXfs count="${styles.length}">
      ${joinXmlNodes(styleNodes)}
    </cellXfs>
  `;}
function addCellWiseConditionalFormatting(dxfs){var _a;const dxfNodes=[];for(const dxf of dxfs){let fontNode=escapeXml``;if((_a=dxf.font)===null||_a===void 0?void 0:_a.color){fontNode=escapeXml`
        <font rgb="${toHex6(dxf.font.color)}" />
      `;}
let fillNode=escapeXml``;if(dxf.fill){fillNode=escapeXml`
        <fill>
          <patternFill>
            <bgColor rgb="${toHex6(dxf.fill.fgColor)}" />
          </patternFill>
        </fill>
      `;}
dxfNodes.push(escapeXml`
      <dxf>
        ${fontNode}
        ${fillNode}
      </dxf>
    `);}
return escapeXml`
    <dxfs count="${dxfs.length}">
      ${joinXmlNodes(dxfNodes)}
    </dxfs>
  `;}
function addColumns(cols){if(!Object.values(cols).length){return escapeXml``;}
const colNodes=[];for(let[id,col]of Object.entries(cols)){const attributes=[["min",parseInt(id)+1],["max",parseInt(id)+1],["width",convertWidth(col.size||DEFAULT_CELL_WIDTH)],["customWidth",1],["hidden",col.isHidden?1:0],];colNodes.push(escapeXml`
      <col ${formatAttributes(attributes)}/>
    `);}
return escapeXml`
    <cols>
      ${joinXmlNodes(colNodes)}
    </cols>
  `;}
function addRows(construct,data,sheet){const rowNodes=[];for(let r=0;r<sheet.rowNumber;r++){const rowAttrs=[["r",r+1]];const row=sheet.rows[r]||{};rowAttrs.push(["ht",convertHeight(row.size||DEFAULT_CELL_HEIGHT)],["customHeight",1],["hidden",row.isHidden?1:0]);const cellNodes=[];for(let c=0;c<sheet.colNumber;c++){const xc=toXC(c,r);const cell=sheet.cells[xc];if(cell){const attributes=[["r",xc]];const id=normalizeStyle(construct,extractStyle(cell,data));attributes.push(["s",id]);let additionalAttrs=[];let cellNode=escapeXml``;if(cell.isFormula){({attrs:additionalAttrs,node:cellNode}=addFormula(cell));}
else if(cell.content&&isMarkdownLink(cell.content)){const{label}=parseMarkdownLink(cell.content);({attrs:additionalAttrs,node:cellNode}=addContent(label,construct.sharedStrings));}
else if(cell.content&&cell.content!==""){({attrs:additionalAttrs,node:cellNode}=addContent(cell.content,construct.sharedStrings));}
attributes.push(...additionalAttrs);cellNodes.push(escapeXml`
          <c ${formatAttributes(attributes)}>
            ${cellNode}
          </c>
        `);}}
if(cellNodes.length){rowNodes.push(escapeXml`
        <row ${formatAttributes(rowAttrs)}>
          ${joinXmlNodes(cellNodes)}
        </row>
      `);}}
return escapeXml`
    <sheetData>
      ${joinXmlNodes(rowNodes)}
    </sheetData>
  `;}
function addHyperlinks(construct,data,sheetIndex){var _a;const sheet=data.sheets[sheetIndex];const cells=sheet.cells;const linkNodes=[];for(const xc in cells){const content=(_a=cells[xc])===null||_a===void 0?void 0:_a.content;if(content&&isMarkdownLink(content)){const{label,url}=parseMarkdownLink(content);if(isMarkdownSheetLink(content)){const sheetId=parseSheetLink(url);const sheet=data.sheets.find((sheet)=>sheet.id===sheetId);linkNodes.push(escapeXml`
          <hyperlink display="${label}" location="${sheet.name}!A1" ref="${xc}"/>
        `);}
else{const linkRelId=addRelsToFile(construct.relsFiles,`xl/worksheets/_rels/sheet${sheetIndex}.xml.rels`,{target:url,type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",targetMode:"External",});linkNodes.push(escapeXml`
          <hyperlink r:id="${linkRelId}" ref="${xc}"/>
        `);}}}
if(!linkNodes.length){return escapeXml``;}
return escapeXml`
    <hyperlinks>
      ${joinXmlNodes(linkNodes)}
    </hyperlinks>
  `;}
function addMerges(merges){if(merges.length){const mergeNodes=merges.map((merge)=>escapeXml`<mergeCell ref="${merge}" />`);return escapeXml`
      <mergeCells count="${merges.length}">
        ${joinXmlNodes(mergeNodes)}
      </mergeCells>
    `;}
else
return escapeXml``;}
function getXLSX(data){const files=[];const construct=getDefaultXLSXStructure();files.push(createWorkbook(data,construct));files.push(...createWorksheets(data,construct));files.push(createStylesSheet(construct));files.push(createSharedStrings(construct.sharedStrings));files.push(...createRelsFiles(construct.relsFiles));files.push(createContentTypes(files));files.push(createRelRoot());return{name:`my_spreadsheet.xlsx`,files,};}
function createWorkbook(data,construct){const namespaces=[["xmlns",NAMESPACE["workbook"]],["xmlns:r",RELATIONSHIP_NSR],];const sheetNodes=[];for(const[index,sheet]of Object.entries(data.sheets)){const attributes=[["name",sheet.name],["sheetId",parseInt(index)+1],["r:id",`rId${parseInt(index) + 1}`],];sheetNodes.push(escapeXml`
      <sheet ${formatAttributes(attributes)} />
    `);addRelsToFile(construct.relsFiles,"xl/_rels/workbook.xml.rels",{type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet",target:`worksheets/sheet${index}.xml`,});}
const xml=escapeXml`
    <workbook ${formatAttributes(namespaces)}>
      <sheets>
        ${joinXmlNodes(sheetNodes)}
      </sheets>
    </workbook>
  `;return createXMLFile(parseXML(xml),"xl/workbook.xml","workbook");}
function createWorksheets(data,construct){const files=[];for(const[sheetIndex,sheet]of Object.entries(data.sheets)){const namespaces=[["xmlns",NAMESPACE["worksheet"]],["xmlns:r",RELATIONSHIP_NSR],];const sheetFormatAttributes=[["defaultRowHeight",convertHeight(DEFAULT_CELL_HEIGHT)],["defaultColWidth",convertWidth(DEFAULT_CELL_WIDTH)],];let drawingNode=escapeXml``;const charts=sheet.charts;if(charts.length){const chartRelIds=[];for(const chart of charts){const xlsxChartId=convertChartId(chart.id);const chartRelId=addRelsToFile(construct.relsFiles,`xl/drawings/_rels/drawing${sheetIndex}.xml.rels`,{target:`../charts/chart${xlsxChartId}.xml`,type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",});chartRelIds.push(chartRelId);files.push(createXMLFile(createChart(chart),`xl/charts/chart${xlsxChartId}.xml`,"chart"));}
const drawingRelId=addRelsToFile(construct.relsFiles,`xl/worksheets/_rels/sheet${sheetIndex}.xml.rels`,{target:`../drawings/drawing${sheetIndex}.xml`,type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",});files.push(createXMLFile(createDrawing(chartRelIds,sheet,charts),`xl/drawings/drawing${sheetIndex}.xml`,"drawing"));drawingNode=escapeXml`<drawing r:id="${drawingRelId}" />`;}
const sheetXml=escapeXml`
      <worksheet ${formatAttributes(namespaces)}>
        <sheetFormatPr ${formatAttributes(sheetFormatAttributes)} />
        ${addColumns(sheet.cols)}
        ${addRows(construct, data, sheet)}
        ${addMerges(sheet.merges)}
        ${joinXmlNodes(addConditionalFormatting(construct.dxfs, sheet.conditionalFormats))}
        ${addHyperlinks(construct, data, sheetIndex)}
        ${drawingNode}
      </worksheet>
    `;files.push(createXMLFile(parseXML(sheetXml),`xl/worksheets/sheet${sheetIndex}.xml`,"sheet"));}
addRelsToFile(construct.relsFiles,"xl/_rels/workbook.xml.rels",{type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",target:"sharedStrings.xml",});addRelsToFile(construct.relsFiles,"xl/_rels/workbook.xml.rels",{type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",target:"styles.xml",});return files;}
function createStylesSheet(construct){const namespaces=[["xmlns",NAMESPACE["styleSheet"]],["xmlns:r",RELATIONSHIP_NSR],];const styleXml=escapeXml`
    <styleSheet ${formatAttributes(namespaces)}>
      ${addNumberFormats(construct.numFmts)}
      ${addFonts(construct.fonts)}
      ${addFills(construct.fills)}
      ${addBorders(construct.borders)}
      ${addStyles(construct.styles)}
      ${addCellWiseConditionalFormatting(construct.dxfs)}
    </styleSheet>
  `;return createXMLFile(parseXML(styleXml),"xl/styles.xml","styles");}
function createSharedStrings(strings){const namespaces=[["xmlns",NAMESPACE["sst"]],["count",strings.length],["uniqueCount",strings.length],];const stringNodes=strings.map((string)=>escapeXml`<si><t>${string}</t></si>`);const xml=escapeXml`
    <sst ${formatAttributes(namespaces)}>
      ${joinXmlNodes(stringNodes)}
    </sst>
  `;return createXMLFile(parseXML(xml),"xl/sharedStrings.xml","sharedStrings");}
function createRelsFiles(relsFiles){const XMLRelsFiles=[];for(const relFile of relsFiles){const relationNodes=[];for(const rel of relFile.rels){const attributes=[["Id",rel.id],["Target",rel.target],["Type",rel.type],];if(rel.targetMode){attributes.push(["TargetMode",rel.targetMode]);}
relationNodes.push(escapeXml`
        <Relationship ${formatAttributes(attributes)} />
      `);}
const xml=escapeXml`
      <Relationships xmlns="${NAMESPACE["Relationships"]}">
        ${joinXmlNodes(relationNodes)}
      </Relationships>
    `;XMLRelsFiles.push(createXMLFile(parseXML(xml),relFile.path));}
return XMLRelsFiles;}
function createContentTypes(files){const overrideNodes=[];for(const file of files){if(file.contentType){overrideNodes.push(createOverride("/"+file.path,CONTENT_TYPES[file.contentType]));}}
const xml=escapeXml`
    <Types xmlns="${NAMESPACE["Types"]}">
      <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml" />
      <Default Extension="xml" ContentType="application/xml" />
      ${joinXmlNodes(overrideNodes)}
    </Types>
  `;return createXMLFile(parseXML(xml),"[Content_Types].xml");}
function createRelRoot(){const attributes=[["Id","rId1"],["Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument"],["Target","xl/workbook.xml"],];const xml=escapeXml`
    <Relationships xmlns="${NAMESPACE["Relationships"]}">
      <Relationship ${formatAttributes(attributes)} />
    </Relationships>
  `;return createXMLFile(parseXML(xml),"_rels/.rels");}
var Status;(function(Status){Status[Status["Ready"]=0]="Ready";Status[Status["Running"]=1]="Running";Status[Status["RunningCore"]=2]="RunningCore";Status[Status["Finalizing"]=3]="Finalizing";Status[Status["Interactive"]=4]="Interactive";})(Status||(Status={}));class Model extends owl__namespace.core.EventBus{constructor(data={},config={},stateUpdateMessages=[],uuidGenerator=new UuidGenerator()){super();this.corePlugins=[];this.uiPlugins=[];this.dataSources=new DataSourceRegistry();this.renderers=[];this.status=0;this.dispatch=(type,payload)=>{const command={type,...payload};let status=command.interactive?4:this.status;if(this.config.isReadonly&&!canExecuteInReadonly(command)){return new DispatchResult(50);}
switch(status){case 0:const result=this.checkDispatchAllowed(command);if(!result.isSuccessful){return result;}
this.status=1;const{changes,commands}=this.state.recordChanges(()=>{if(isCoreCommand(command)){this.state.addCommand(command);}
this.dispatchToHandlers(this.handlers,command);this.finalize();});this.session.save(commands,changes);this.status=0;if(this.config.mode!=="headless"){this.trigger("update");}
break;case 1:if(isCoreCommand(command)){const dispatchResult=this.checkDispatchAllowed(command);if(!dispatchResult.isSuccessful){return dispatchResult;}
this.state.addCommand(command);this.dispatchToHandlers(this.handlers,command);}
else{this.dispatchToHandlers(this.handlers,command);}
break;case 4:if(isCoreCommand(command)){this.state.addCommand(command);}
this.dispatchToHandlers(this.handlers,command);break;case 3:throw new Error(_lt("Cannot dispatch commands in the finalize state"));case 2:throw new Error("A UI plugin cannot dispatch while handling a core command");}
return DispatchResult.Success;};this.dispatchFromCorePlugin=(type,payload)=>{const command={type,...payload};const previousStatus=this.status;this.status=2;this.dispatchToHandlers(this.handlers,command);this.status=previousStatus;return DispatchResult.Success;};DEBUG.model=this;const workbookData=load(data);this.state=new StateObserver();this.uuidGenerator=uuidGenerator;this.config=this.setupConfig(config);this.session=this.setupSession(workbookData.revisionId);this.config.moveClient=this.session.move.bind(this.session);this.history=new LocalHistory(this.dispatchFromCorePlugin,this.session);this.getters={isReadonly:()=>this.config.isReadonly,canUndo:this.history.canUndo.bind(this.history),canRedo:this.history.canRedo.bind(this.history),getClient:this.session.getClient.bind(this.session),getConnectedClients:this.session.getConnectedClients.bind(this.session),isFullySynchronized:this.session.isFullySynchronized.bind(this.session),};this.range=new RangeAdapter(this.getters);this.getters.getRangeString=this.range.getRangeString.bind(this.range);this.getters.getRangeFromSheetXC=this.range.getRangeFromSheetXC.bind(this.range);this.getters.createAdaptedRanges=this.range.createAdaptedRanges.bind(this.range);this.uuidGenerator.setIsFastStrategy(true);for(let Plugin of corePluginRegistry.getAll()){this.setupCorePlugin(Plugin,workbookData);}
for(let Plugin of uiPluginRegistry.getAll()){this.setupUiPlugin(Plugin);}
this.uuidGenerator.setIsFastStrategy(false);this.dispatch("START");this.setupSessionEvents();this.session.loadInitialMessages(stateUpdateMessages);this.joinSession(config.client);if(config.snapshotRequested){this.session.snapshot(this.exportData());}}
get handlers(){return[this.range,...this.corePlugins,...this.uiPlugins,this.history];}
joinSession(client){this.session.join(client);}
leaveSession(){this.session.leave();}
destroy(){delete DEBUG.model;}
setupUiPlugin(Plugin){if(Plugin.modes.includes(this.config.mode)){const plugin=new Plugin(this.getters,this.state,this.dispatch,this.config);for(let name of Plugin.getters){if(!(name in plugin)){throw new Error(`Invalid getter name: ${name} for plugin ${plugin.constructor}`);}
this.getters[name]=plugin[name].bind(plugin);}
this.uiPlugins.push(plugin);const layers=Plugin.layers.map((l)=>[plugin,l]);this.renderers.push(...layers);this.renderers.sort((p1,p2)=>p1[1]-p2[1]);}}
setupCorePlugin(Plugin,data){if(Plugin.modes.includes(this.config.mode)){const plugin=new Plugin(this.getters,this.state,this.range,this.dispatchFromCorePlugin,this.config,this.uuidGenerator);plugin.import(data);for(let name of Plugin.getters){if(!(name in plugin)){throw new Error(`Invalid getter name: ${name} for plugin ${plugin.constructor}`);}
this.getters[name]=plugin[name].bind(plugin);}
this.corePlugins.push(plugin);}}
onRemoteRevisionReceived({commands}){for(let command of commands){this.dispatchToHandlers(this.uiPlugins,command);}
this.finalize();}
setupSession(revisionId){const session=new Session(buildRevisionLog(revisionId,this.state.recordChanges.bind(this.state),(command)=>this.dispatchToHandlers([this.range,...this.corePlugins],command)),this.config.transportService,revisionId);return session;}
setupSessionEvents(){this.session.on("remote-revision-received",this,this.onRemoteRevisionReceived);this.session.on("revision-redone",this,this.finalize);this.session.on("revision-undone",this,this.finalize);this.session.on("unexpected-revision-id",this,()=>this.trigger("unexpected-revision-id"));this.session.on("collaborative-event-received",this,()=>{this.trigger("update");});}
setupConfig(config){const client=config.client||{id:this.uuidGenerator.uuidv4(),name:_lt("Anonymous").toString(),};const transportService=config.transportService||new LocalTransportService();return{mode:config.mode||"normal",openSidePanel:config.openSidePanel||(()=>{}),notifyUser:config.notifyUser||(()=>{}),askConfirmation:config.askConfirmation||(()=>{}),editText:config.editText||(()=>{}),evalContext:config.evalContext||{},transportService,client,moveClient:()=>{},isHeadless:config.mode==="headless"||false,isReadonly:config.isReadonly||false,snapshotRequested:false,dataSources:this.dataSources,};}
checkDispatchAllowed(command){const results=this.handlers.map((handler)=>handler.allowDispatch(command));return new DispatchResult(results.flat());}
finalize(){this.status=3;for(const h of this.handlers){h.finalize();}
this.status=0;}
dispatchToHandlers(handlers,command){for(const handler of handlers){handler.beforeHandle(command);}
for(const handler of handlers){handler.handle(command);}}
drawGrid(context){context.viewport=this.getters.getActiveSnappedViewport();for(let[renderer,layer]of this.renderers){context.ctx.save();renderer.drawGrid(context,layer);context.ctx.restore();}}
exportData(){let data=createEmptyWorkbookData();for(let handler of this.handlers){if(handler instanceof CorePlugin){handler.export(data);}}
data.revisionId=this.session.getRevisionId()||DEFAULT_REVISION_ID;data=JSON.parse(JSON.stringify(data));return data;}
updateReadOnly(isReadonly){if(isReadonly){this.dispatch("STOP_EDITION",{cancel:true});}
this.config.isReadonly=isReadonly||false;}
waitForIdle(){return this.dataSources.waitForReady();}
async exportXLSX(){await this.waitForIdle();this.dispatch("EVALUATE_ALL_SHEETS");let data=createEmptyExcelWorkbookData();for(let handler of this.handlers){if(handler instanceof CorePlugin){handler.exportForExcel(data);}}
data=JSON.parse(JSON.stringify(data));return getXLSX(data);}}
const{useComponent,useState:useState$e,onPatched,useRef:useRef$7,onMounted:onMounted$1}=owl.hooks;function useSpreadsheetPosition(){const position=useState$e({x:0,y:0});let spreadsheetElement=document.querySelector(".o-spreadsheet");function updatePosition(){if(!spreadsheetElement){spreadsheetElement=document.querySelector(".o-spreadsheet");}
if(spreadsheetElement){const{top,left}=spreadsheetElement.getBoundingClientRect();position.x=left;position.y=top;}}
onMounted$1(updatePosition);onPatched(updatePosition);return position;}
function useAbsolutePosition(ref){const position=useState$e({x:0,y:0});const component=useComponent();const spreadsheet=useSpreadsheetPosition();function updateElPosition(){const el=(ref===null||ref===void 0?void 0:ref.el)||component.el;const{top,left}=el.getBoundingClientRect();const x=left-spreadsheet.x;const y=top-spreadsheet.y;if(x!==position.x||y!==position.y){position.x=x;position.y=y;}}
onMounted$1(updateElPosition);onPatched(updateElPosition);return position;}
const{Component:Component$i,tags:tags$3}=owl__namespace;const{Portal}=owl__namespace.misc;const{xml:xml$l}=tags$3;const TEMPLATE$j=xml$l`
  <Portal target="'.o-spreadsheet'">
    <div t-att-style="style">
      <t t-slot="default"/>
    </div>
  </Portal>
`;class Popover extends Component$i{constructor(){super(...arguments);this.getters=this.env.getters;}
get style(){const horizontalPosition=`left:${this.horizontalPosition()}`;const verticalPosition=`top:${this.verticalPosition()}`;const height=`max-height:${this.viewportDimension.height - BOTTOMBAR_HEIGHT - SCROLLBAR_WIDTH$1}`;return`
      position: absolute;
      z-index: 5;
      ${verticalPosition}px;
      ${horizontalPosition}px;
      ${height}px;
      width:${this.props.childWidth}px;
      overflow-y: auto;
      overflow-x: hidden;
      box-shadow: 1px 2px 5px 2px rgb(51 51 51 / 15%);
    `;}
get viewportDimension(){return this.getters.getViewportDimension();}
get shouldRenderRight(){const{x}=this.props.position;return x+this.props.childWidth<this.viewportDimension.width;}
get shouldRenderBottom(){const{y}=this.props.position;return y+this.props.childHeight<this.viewportDimension.height+TOPBAR_HEIGHT;}
horizontalPosition(){const{x}=this.props.position;if(this.shouldRenderRight){return x;}
return x-this.props.childWidth-this.props.flipHorizontalOffset;}
verticalPosition(){const{y}=this.props.position;if(this.shouldRenderBottom){return y;}
return Math.max(y-this.props.childHeight+this.props.flipVerticalOffset,this.props.marginTop);}}
Popover.template=TEMPLATE$j;Popover.components={Portal};Popover.defaultProps={flipHorizontalOffset:0,flipVerticalOffset:0,verticalOffset:0,marginTop:0,};const{xml:xml$k,css:css$j}=owl.tags;const{useExternalListener:useExternalListener$2,useRef:useRef$6}=owl.hooks;const TEMPLATE$i=xml$k`
    <Popover
      position="props.position"
      childWidth="${MENU_WIDTH}"
      childHeight="menuHeight"
      flipHorizontalOffset="popover.flipHorizontalOffset"
      flipVerticalOffset="popover.flipVerticalOffset"
      marginTop="popover.marginTop"
      >
      <div t-ref="menu" class="o-menu" t-on-scroll="onScroll" t-on-wheel.stop="" t-on-click.stop="">
        <t t-foreach="props.menuItems" t-as="menuItem" t-key="menuItem.id">
          <t t-set="isMenuRoot" t-value="isRoot(menuItem)"/>
          <t t-set="isMenuEnabled" t-value="isEnabled(menuItem)"/>
          <div
            t-att-title="getName(menuItem)"
            t-att-data-name="menuItem.id"
            t-on-click="onClickMenu(menuItem, menuItem_index)"
            t-on-mouseover="onMouseOver(menuItem, menuItem_index)"
            class="o-menu-item"
            t-att-class="{
              'o-menu-root': isMenuRoot,
              'disabled': !isMenuEnabled,
            }">
            <t t-esc="getName(menuItem)"/>
            <span class="o-menu-item-shortcut" t-esc="getShortCut(menuItem)"/>
            <t t-if="isMenuRoot">
              ${TRIANGLE_RIGHT_ICON}
            </t>
            <t t-elif="menuItem.icon">
              <i t-att-class="menuItem.icon" class="o-menu-item-icon"/>
            </t>
          </div>
          <div t-if="menuItem.separator and !menuItem_last" class="o-separator"/>
        </t>
      </div>
      <Menu t-if="subMenu.isOpen"
        position="subMenuPosition"
        menuItems="subMenu.menuItems"
        depth="props.depth + 1"
        t-ref="subMenuRef"
        t-on-close="subMenu.isOpen=false"/>
    </Popover>`;const CSS$h=css$j`
  .o-menu {
    background-color: white;
    padding: 8px 0px;
    .o-menu-item {
      display: flex;
      justify-content: space-between;
      box-sizing: border-box;
      height: ${MENU_ITEM_HEIGHT}px;
      padding: 4px 16px;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      cursor: pointer;
      user-select: none;

      &.o-menu-root {
        display: flex;
        justify-content: space-between;
      }
      .o-menu-item-icon {
        margin-top: auto;
        margin-bottom: auto;
      }
      .o-icon {
        width: 10px;
      }

      &:not(.disabled) {
        &:hover {
          background-color: #ebebeb;
        }
        .o-menu-item-shortcut {
          color: grey;
        }
      }
      &.disabled {
        color: ${MENU_ITEM_DISABLED_COLOR};
        cursor: not-allowed;
      }
    }

    .o-separator {
      border-bottom: ${MENU_SEPARATOR_BORDER_WIDTH}px solid #e0e2e4;
      margin-top: ${MENU_SEPARATOR_PADDING}px;
      margin-bottom: ${MENU_SEPARATOR_PADDING}px;
    }
  }
`;class Menu extends owl.Component{constructor(){super(...arguments);this.position=useAbsolutePosition(useRef$6("menu"));this.subMenuRef=useRef$6("subMenuRef");useExternalListener$2(window,"click",this.onClick);useExternalListener$2(window,"contextmenu",this.onContextMenu);this.subMenu=owl.useState({isOpen:false,position:null,scrollOffset:0,menuItems:[],});}
get subMenuPosition(){const position=Object.assign({},this.subMenu.position);position.y-=this.subMenu.scrollOffset||0;return position;}
get menuHeight(){return this.menuComponentHeight(this.props.menuItems);}
get subMenuHeight(){return this.menuComponentHeight(this.subMenu.menuItems);}
get popover(){const isRoot=this.props.depth===1;return{marginTop:HEADER_HEIGHT+6+TOPBAR_HEIGHT,flipHorizontalOffset:MENU_WIDTH*(this.props.depth-1),flipVerticalOffset:isRoot?0:MENU_ITEM_HEIGHT,};}
async activateMenu(menu){const result=await menu.action(this.env);this.close();this.trigger(`menu-clicked`,result);}
close(){this.subMenu.isOpen=false;this.trigger("close");}
subMenuVerticalPosition(position){const menusAbove=this.props.menuItems.slice(0,position);return this.menuComponentHeight(menusAbove)+this.position.y;}
onClick(ev){if(this.el&&isChildEvent(this.el,ev)){return;}
this.close();}
onContextMenu(ev){if(this.el&&isChildEvent(this.el,ev)){return;}
this.subMenu.isOpen=false;}
menuComponentHeight(menuItems){const separators=menuItems.filter((m)=>m.separator);const others=menuItems;return MENU_ITEM_HEIGHT*others.length+separators.length*MENU_SEPARATOR_HEIGHT;}
getName(menu){return cellMenuRegistry.getName(menu,this.env);}
getShortCut(menu){return cellMenuRegistry.getShortCut(menu);}
isRoot(menu){return!menu.action;}
isEnabled(menu){if(menu.isEnabled(this.env)){return this.env.getters.isReadonly()?menu.isReadonlyAllowed:true;}
return false;}
closeSubMenus(){if(this.subMenuRef.comp){this.subMenuRef.comp.closeSubMenus();}
this.subMenu.isOpen=false;}
onScroll(ev){this.subMenu.scrollOffset=ev.target.scrollTop;}
openSubMenu(menu,position){this.closeSubMenus();const y=this.subMenuVerticalPosition(position);this.subMenu.position={x:this.position.x+MENU_WIDTH,y:y-(this.subMenu.scrollOffset||0),};this.subMenu.menuItems=cellMenuRegistry.getChildren(menu,this.env);this.subMenu.isOpen=true;}
onClickMenu(menu,position){if(this.isEnabled(menu)){if(this.isRoot(menu)){this.openSubMenu(menu,position);}
else{this.activateMenu(menu);}}}
onMouseOver(menu,position){if(menu.isEnabled(this.env)){if(this.isRoot(menu)){this.openSubMenu(menu,position);}
else{this.subMenu.isOpen=false;}}}}
Menu.template=TEMPLATE$i;Menu.components={Menu,Popover};Menu.style=CSS$h;Menu.defaultProps={depth:1,};const{Component:Component$h}=owl__namespace;const{xml:xml$j,css:css$i}=owl__namespace.tags;const{useState:useState$d}=owl__namespace.hooks;const TEMPLATE$h=xml$j`
  <div class="o-spreadsheet-bottom-bar">
    <div class="o-sheet-item o-add-sheet" t-att-class="{'disabled': getters.isReadonly()}" t-on-click="addSheet">${PLUS}</div>
    <div class="o-sheet-item o-list-sheets" t-on-click="listSheets">${LIST}</div>
    <div class="o-all-sheets">
      <t t-foreach="getters.getSheets()" t-as="sheet" t-key="sheet.id">
        <div class="o-sheet-item o-sheet" t-on-click="activateSheet(sheet.id)"
             t-on-contextmenu.prevent="onContextMenu(sheet.id)"
             t-att-title="sheet.name"
             t-att-data-id="sheet.id"
             t-att-class="{active: sheet.id === getters.getActiveSheetId()}">
          <span class="o-sheet-name" t-esc="sheet.name" t-on-dblclick="onDblClick(sheet.id)"/>
          <span class="o-sheet-icon" t-on-click.stop="onIconClick(sheet.id)">${TRIANGLE_DOWN_ICON}</span>
        </div>
      </t>
    </div>
    <t t-set="aggregate" t-value="getters.getAggregate()"/>
    <div t-if="aggregate !== null" class="o-aggregate">Sum: <t t-esc="aggregate"/></div>
    <Menu t-if="menuState.isOpen"
          position="menuState.position"
          menuItems="menuState.menuItems"
          t-on-close="menuState.isOpen=false"/>
  </div>`;const CSS$g=css$i`
  .o-spreadsheet-bottom-bar {
    background-color: ${BACKGROUND_GRAY_COLOR};
    padding-left: ${HEADER_WIDTH}px;
    display: flex;
    align-items: center;
    font-size: 15px;
    border-top: 1px solid lightgrey;
    overflow: hidden;

    .o-add-sheet,
    .o-list-sheets {
      margin-right: 5px;
    }

    .o-add-sheet.disabled {
      cursor: not-allowed;
    }

    .o-sheet-item {
      display: flex;
      align-items: center;
      padding: 5px;
      cursor: pointer;
      &:hover {
        background-color: rgba(0, 0, 0, 0.08);
      }
    }

    .o-all-sheets {
      display: flex;
      align-items: center;
      max-width: 80%;
      overflow: hidden;
    }

    .o-sheet {
      color: #666;
      padding: 0 15px;
      padding-right: 10px;
      height: ${BOTTOMBAR_HEIGHT}px;
      line-height: ${BOTTOMBAR_HEIGHT}px;
      user-select: none;
      white-space: nowrap;
      border-left: 1px solid #c1c1c1;

      &:last-child {
        border-right: 1px solid #c1c1c1;
      }

      &.active {
        color: #484;
        background-color: white;
        box-shadow: 0 1px 3px 1px rgba(60, 64, 67, 0.15);
      }

      .o-sheet-icon {
        margin-left: 5px;

        &:hover {
          background-color: rgba(0, 0, 0, 0.08);
        }
      }
    }

    .o-aggregate {
      background-color: white;
      margin-left: auto;
      font-size: 14px;
      margin-right: 20px;
      padding: 4px 8px;
      color: #333;
      border-radius: 3px;
      box-shadow: 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    }
    .fade-enter-active {
      transition: opacity 0.5s;
    }

    .fade-enter {
      opacity: 0;
    }
  }
`;class BottomBar extends Component$h{constructor(){super(...arguments);this.getters=this.env.getters;this.menuState=useState$d({isOpen:false,position:null,menuItems:[]});}
mounted(){this.focusSheet();}
patched(){this.focusSheet();}
focusSheet(){const div=this.el.querySelector(`[data-id="${this.getters.getActiveSheetId()}"]`);if(div&&div.scrollIntoView){div.scrollIntoView();}}
addSheet(){const activeSheetId=this.env.getters.getActiveSheetId();const position=this.env.getters.getVisibleSheets().findIndex((sheetId)=>sheetId===activeSheetId)+1;const sheetId=this.env.uuidGenerator.uuidv4();this.env.dispatch("CREATE_SHEET",{sheetId,position});this.env.dispatch("ACTIVATE_SHEET",{sheetIdFrom:activeSheetId,sheetIdTo:sheetId});}
listSheets(ev){const registry=new MenuItemRegistry();const from=this.getters.getActiveSheetId();let i=0;for(let sheet of this.getters.getSheets()){registry.add(sheet.id,{name:sheet.name,sequence:i,isReadonlyAllowed:true,action:(env)=>env.dispatch("ACTIVATE_SHEET",{sheetIdFrom:from,sheetIdTo:sheet.id}),});i++;}
this.openContextMenu(ev.currentTarget,registry);}
activateSheet(name){this.env.dispatch("ACTIVATE_SHEET",{sheetIdFrom:this.getters.getActiveSheetId(),sheetIdTo:name,});}
onDblClick(sheetId){this.env.dispatch("RENAME_SHEET",{interactive:true,sheetId});}
openContextMenu(target,registry){const x=target.offsetLeft;const y=target.offsetTop;this.menuState.isOpen=true;this.menuState.menuItems=registry.getAll().filter((x)=>x.isVisible(this.env));this.menuState.position={x,y};}
onIconClick(sheet,ev){if(this.getters.getActiveSheetId()!==sheet){this.activateSheet(sheet);}
if(this.menuState.isOpen){this.menuState.isOpen=false;}
else{this.openContextMenu(ev.currentTarget.parentElement,sheetMenuRegistry);}}
onContextMenu(sheet,ev){if(this.getters.getActiveSheetId()!==sheet){this.activateSheet(sheet);}
this.openContextMenu(ev.currentTarget,sheetMenuRegistry);}}
BottomBar.template=TEMPLATE$h;BottomBar.style=CSS$g;BottomBar.components={Menu};function startDnd(onMouseMove,onMouseUp){const _onMouseUp=(ev)=>{onMouseUp(ev);window.removeEventListener("mouseup",_onMouseUp);window.removeEventListener("dragstart",_onDragStart);window.removeEventListener("mousemove",onMouseMove);window.removeEventListener("wheel",onMouseMove);};function _onDragStart(ev){ev.preventDefault();}
window.addEventListener("mouseup",_onMouseUp);window.addEventListener("dragstart",_onDragStart);window.addEventListener("mousemove",onMouseMove);window.addEventListener("wheel",onMouseMove);}
function dragAndDropBeyondTheViewport(element,env,cbMouseMove,cbMouseUp){const position=element.getBoundingClientRect();let timeOutId=null;let currentEv;const onMouseMove=(ev)=>{currentEv=ev;if(timeOutId){return;}
const offsetX=currentEv.clientX-position.left;const offsetY=currentEv.clientY-position.top;const edgeScrollInfoX=env.getters.getEdgeScrollCol(offsetX);const edgeScrollInfoY=env.getters.getEdgeScrollRow(offsetY);const{top,left,bottom,right}=env.getters.getActiveSnappedViewport();let colIndex;if(edgeScrollInfoX.canEdgeScroll){colIndex=edgeScrollInfoX.direction>0?right:left-1;}
else{colIndex=env.getters.getColIndex(offsetX,left);}
let rowIndex;if(edgeScrollInfoY.canEdgeScroll){rowIndex=edgeScrollInfoY.direction>0?bottom:top-1;}
else{rowIndex=env.getters.getRowIndex(offsetY,top);}
cbMouseMove(colIndex,rowIndex);if(edgeScrollInfoX.canEdgeScroll){const{left,offsetY}=env.getters.getActiveSnappedViewport();const{cols}=env.getters.getActiveSheet();const offsetX=cols[left+edgeScrollInfoX.direction].start;env.dispatch("SET_VIEWPORT_OFFSET",{offsetX,offsetY});timeOutId=setTimeout(()=>{timeOutId=null;onMouseMove(currentEv);},Math.round(edgeScrollInfoX.delay));}
if(edgeScrollInfoY.canEdgeScroll){const{top,offsetX}=env.getters.getActiveSnappedViewport();const{rows}=env.getters.getActiveSheet();const offsetY=rows[top+edgeScrollInfoY.direction].start;env.dispatch("SET_VIEWPORT_OFFSET",{offsetX,offsetY});timeOutId=setTimeout(()=>{timeOutId=null;onMouseMove(currentEv);},Math.round(edgeScrollInfoX.delay));}};const onMouseUp=()=>{clearTimeout(timeOutId);cbMouseUp();};startDnd(onMouseMove,onMouseUp);}
const{Component:Component$g}=owl__namespace;const{xml:xml$i,css:css$h}=owl__namespace.tags;const{useState:useState$c}=owl__namespace.hooks;const TEMPLATE$g=xml$i`
  <div class="o-autofill" t-on-mousedown="onMouseDown" t-att-style="style" t-on-dblclick="onDblClick">
    <div class="o-autofill-handler" t-att-style="styleHandler"/>
    <t t-set="tooltip" t-value="getTooltip()"/>
    <div t-if="tooltip" class="o-autofill-nextvalue" t-att-style="styleNextvalue">
      <t t-component="tooltip.component" t-props="tooltip.props"/>
    </div>
  </div>
`;const CSS$f=css$h`
  .o-autofill {
    height: 6px;
    width: 6px;
    border: 1px solid white;
    position: absolute;
    background-color: #1a73e8;

    .o-autofill-handler {
      position: absolute;
      height: ${AUTOFILL_EDGE_LENGTH}px;
      width: ${AUTOFILL_EDGE_LENGTH}px;

      &:hover {
        cursor: crosshair;
      }
    }

    .o-autofill-nextvalue {
      position: absolute;
      background-color: white;
      border: 1px solid black;
      padding: 5px;
      font-size: 12px;
      pointer-events: none;
      white-space: nowrap;
    }
  }
`;class Autofill extends Component$g{constructor(){super(...arguments);this.state=useState$c({position:{left:0,top:0},handler:false,});}
get style(){const{left,top}=this.props.position;return`top:${top}px;left:${left}px`;}
get styleHandler(){let position=this.state.handler?this.state.position:{left:0,top:0};return`top:${position.top}px;left:${position.left}px;`;}
get styleNextvalue(){let position=this.state.handler?this.state.position:{left:0,top:0};return`top:${position.top + 5}px;left:${position.left + 15}px;`;}
getTooltip(){const tooltip=this.env.getters.getAutofillTooltip();if(tooltip&&!tooltip.component){tooltip.component=TooltipComponent;}
return tooltip;}
onMouseDown(ev){this.state.handler=true;this.state.position={left:0,top:0};const{offsetY,offsetX}=this.env.getters.getActiveSnappedViewport();const start={left:ev.clientX+offsetX,top:ev.clientY+offsetY,};let lastCol;let lastRow;const onMouseUp=()=>{this.state.handler=false;this.env.dispatch("AUTOFILL");};const onMouseMove=(ev)=>{const parent=this.el.parentElement;const position=parent.getBoundingClientRect();const{top:viewportTop,left:viewportLeft,offsetY,offsetX,}=this.env.getters.getActiveSnappedViewport();this.state.position={left:ev.clientX-start.left+offsetX,top:ev.clientY-start.top+offsetY,};const col=this.env.getters.getColIndex(ev.clientX-position.left,viewportLeft);const row=this.env.getters.getRowIndex(ev.clientY-position.top,viewportTop);if(lastCol!==col||lastRow!==row){const activeSheet=this.env.getters.getActiveSheet();lastCol=col===-1?lastCol:clip(col,0,activeSheet.cols.length);lastRow=row===-1?lastRow:clip(row,0,activeSheet.rows.length);if(lastCol!==undefined&&lastRow!==undefined){this.env.dispatch("AUTOFILL_SELECT",{col:lastCol,row:lastRow});}}};startDnd(onMouseMove,onMouseUp);}
onDblClick(){this.env.dispatch("AUTOFILL_AUTO");}}
Autofill.template=TEMPLATE$g;Autofill.style=CSS$f;class TooltipComponent extends Component$g{}
TooltipComponent.template=xml$i`
    <div t-esc="props.content"/>
  `;const{Component:Component$f}=owl__namespace;const{css:css$g,xml:xml$h}=owl__namespace.tags;const TEMPLATE$f=xml$h`
  <div>
    <div
      class="o-client-tag"
      t-att-style="tagStyle"
      t-esc="props.name"
    />
  </div>
`;const CSS$e=css$g`
  .o-client-tag {
    position: absolute;
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
    font-size: ${DEFAULT_FONT_SIZE};
    color: white;
    opacity: 0;
    pointer-events: none;
  }
`;class ClientTag extends Component$f{get tagStyle(){const{col,row,color}=this.props;const viewport=this.env.getters.getActiveSnappedViewport();const{height}=this.env.getters.getViewportDimension();const[x,y,,]=this.env.getters.getRect({left:col,top:row,right:col,bottom:row},viewport);return`bottom: ${height - y + 15}px;left: ${x - 1}px;border: 1px solid ${color};background-color: ${color};${this.props.active ? "opacity:1 !important" : ""}`;}}
ClientTag.template=TEMPLATE$f;ClientTag.style=CSS$e;const{Component:Component$e,useState:useState$b}=owl__namespace;const{xml:xml$g,css:css$f}=owl__namespace.tags;const functions$1=functionRegistry.content;const providerRegistry=new Registry();providerRegistry.add("functions",()=>{return Object.keys(functions$1).map((key)=>{return{text:key,description:functions$1[key].description,};});});const TEMPLATE$e=xml$g`
  <div t-att-class="{'o-autocomplete-dropdown':state.values.length}"
       t-att-style="state.values.length > 0 ? props.borderStyle : null"
    >
    <t t-foreach="state.values" t-as="v" t-key="v.text">
        <div t-att-class="{'o-autocomplete-value-focus': state.selectedIndex === v_index}" t-on-click.stop.prevent="fillValue(v_index)">
             <div class="o-autocomplete-value" t-esc="v.text"/>
             <div class="o-autocomplete-description" t-esc="v.description" t-if="state.selectedIndex === v_index"/>
        </div>
    </t>
  </div>`;const CSS$d=css$f`
  .o-autocomplete-dropdown {
    pointer-events: auto;
    background-color: #fff;
    & > div:hover {
      background-color: #f2f2f2;
    }
    .o-autocomplete-value-focus {
      background-color: rgba(0, 0, 0, 0.08);
    }

    & > div {
      display: flex;
      flex-direction: column;
      padding: 1px 0 5px 5px;
      .o-autocomplete-description {
        padding: 0 0 0 5px;
        font-size: 11px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
    }
  }
`;class TextValueProvider extends Component$e{constructor(){super(...arguments);this.state=useState$b({values:[],selectedIndex:0,});}
mounted(){this.filter(this.props.search);}
willUpdateProps(nextProps){if(nextProps.search!==this.props.search){this.filter(nextProps.search);}
return super.willUpdateProps(nextProps);}
async filter(searchTerm){const provider=providerRegistry.get(this.props.provider);let values=provider();if(this.props.filter){values=this.props.filter(searchTerm,values);}
else{values=values.filter((t)=>t.text.toUpperCase().startsWith(searchTerm.toUpperCase())).sort((l,r)=>(l.text<r.text?-1:l.text>r.text?1:0));}
this.state.values=values.slice(0,10);this.state.selectedIndex=0;}
fillValue(index){this.state.selectedIndex=index;this.trigger("completed",{text:this.getValueToFill()});}
moveDown(){this.state.selectedIndex=(this.state.selectedIndex+1)%this.state.values.length;}
moveUp(){this.state.selectedIndex--;if(this.state.selectedIndex<0){this.state.selectedIndex=this.state.values.length-1;}}
getValueToFill(){if(this.state.values.length){return this.state.values[this.state.selectedIndex].text;}}}
TextValueProvider.template=TEMPLATE$e;TextValueProvider.style=CSS$d;class ContentEditableHelper{constructor(el){this.el=el;}
updateEl(el){this.el=el;}
selectRange(start,end){let selection=window.getSelection();this.removeSelection();let range=document.createRange();if(start==end&&start===0){range.setStart(this.el,0);range.setEnd(this.el,0);selection.addRange(range);}
else{if(start<0||end>this.el.textContent.length){console.warn(`wrong selection asked start ${start}, end ${end}, text content length ${this.el.textContent.length}`);if(start<0)
start=0;if(end>this.el.textContent.length)
end=this.el.textContent.length;}
let startNode=this.findChildAtCharacterIndex(start);let endNode=this.findChildAtCharacterIndex(end);range.setStart(startNode.node,startNode.offset);selection.addRange(range);selection.extend(endNode.node,endNode.offset);}}
findChildAtCharacterIndex(offset){let it=this.iterateChildren(this.el);let current,previous;let usedCharacters=offset;do{current=it.next();if(!current.done&&!current.value.hasChildNodes()){if(current.value.textContent&&current.value.textContent.length<usedCharacters){usedCharacters-=current.value.textContent.length;}
else{it.return(current.value);}
previous=current.value;}}while(!current.done);if(current.value){return{node:current.value,offset:usedCharacters};}
return{node:previous,offset:usedCharacters};}*iterateChildren(el){yield el;if(el.hasChildNodes()){for(let child of el.childNodes){yield*this.iterateChildren(child);}}}
setText(contents){if(contents.length===0){return;}
for(const content of contents){const span=document.createElement("span");span.innerText=content.value;if(content.color){span.style.color=content.color;}
if(content.class){span.classList.add(content.class);}
this.el.appendChild(span);}}
removeSelection(){let selection=window.getSelection();selection.removeAllRanges();}
removeAll(){if(this.el){while(this.el.firstChild){this.el.removeChild(this.el.firstChild);}}}
getCurrentSelection(){let{startElement,endElement,startSelectionOffset,endSelectionOffset}=this.getStartAndEndSelection();let startSizeBefore=this.findSizeBeforeElement(startElement);let endSizeBefore=this.findSizeBeforeElement(endElement);return{start:startSizeBefore+startSelectionOffset,end:endSizeBefore+endSelectionOffset,};}
findSizeBeforeElement(nodeToFind){let it=this.iterateChildren(this.el);let usedCharacters=0;let current=it.next();while(!current.done&&current.value!==nodeToFind){if(!current.value.hasChildNodes()){if(current.value.textContent){usedCharacters+=current.value.textContent.length;}}
current=it.next();}
return usedCharacters;}
getStartAndEndSelection(){const selection=document.getSelection();return{startElement:selection.anchorNode||this.el,startSelectionOffset:selection.anchorOffset,endElement:selection.focusNode||this.el,endSelectionOffset:selection.focusOffset,};}}
const formulaAssistantTerms={ABOUT:_lt("ABOUT"),OPTIONAL:_lt("optional"),BY_DEFAULT:_lt("by default"),REPEATABLE:_lt("repeatable"),};const{Component:Component$d}=owl__namespace;const{xml:xml$f,css:css$e}=owl__namespace.tags;const{useState:useState$a}=owl__namespace.hooks;const TEMPLATE$d=xml$f`
  <div class="o-formula-assistant-container"
       t-att-style="props.borderStyle"
       t-att-class="{
         'o-formula-assistant-event-none': assistantState.allowCellSelectionBehind,
         'o-formula-assistant-event-auto': !assistantState.allowCellSelectionBehind
         }">
    <t t-set="context" t-value="getContext()"/>
    <div class="o-formula-assistant" t-if="context.functionName" t-on-mousemove="onMouseMove"
         t-att-class="{'o-formula-assistant-transparency': assistantState.allowCellSelectionBehind}">

      <div class="o-formula-assistant-head">
        <span t-esc="context.functionName"/> (
        <t t-foreach="context.functionDescription.args" t-as="arg" t-key="arg.name" >
          <span t-if="arg_index > '0'" >, </span>
          <span t-att-class="{ 'o-formula-assistant-focus': context.argToFocus === arg_index }" >
            <span>
              <span t-if="arg.optional || arg.repeating || arg.default">[</span>
              <span t-esc="arg.name" />
              <span t-if="arg.repeating">, ...</span>
              <span t-if="arg.optional || arg.repeating || arg.default">]</span>
            </span>
          </span>
        </t> )
      </div>

      <div class="o-formula-assistant-core">
        <div class="o-formula-assistant-gray" t-esc="env._t('${formulaAssistantTerms.ABOUT}')"/>
        <div t-esc="context.functionDescription.description"/>
      </div>

      <t t-foreach="context.functionDescription.args" t-as="arg" t-key="arg.name">
        <div class="o-formula-assistant-arg"
            t-att-class="{
              'o-formula-assistant-gray': context.argToFocus >= '0',
              'o-formula-assistant-focus': context.argToFocus === arg_index,
            }" >
          <div>
            <span t-esc="arg.name" />
            <span t-if="arg.optional || arg.repeating || arg.default "> - [<t t-esc="env._t('${formulaAssistantTerms.OPTIONAL}')"/>] </span>
            <span t-if="arg.default">
              <t t-esc="arg.defaultValue" />
              <t t-esc="env._t(' ${formulaAssistantTerms.BY_DEFAULT}')"/>
            </span>
            <span t-if="arg.repeating" t-esc="env._t('${formulaAssistantTerms.REPEATABLE}')"/>
          </div>
          <div class="o-formula-assistant-arg-description" t-esc="arg.description"/>
        </div>
      </t>

    </div>
  </div>
`;const CSS$c=css$e`
  .o-formula-assistant {
    white-space: normal;
    background-color: #fff;
    .o-formula-assistant-head {
      background-color: #f2f2f2;
      padding: 10px;
    }
    .o-formula-assistant-core {
      padding: 0px 0px 10px 0px;
      margin: 10px;
      border-bottom: 1px solid gray;
    }
    .o-formula-assistant-arg {
      padding: 0px 10px 10px 10px;
      display: flex;
      flex-direction: column;
    }
    .o-formula-assistant-arg-description {
      font-size: 85%;
    }
    .o-formula-assistant-focus {
      div:first-child,
      span {
        color: purple;
        text-shadow: 0px 0px 1px purple;
      }
      div:last-child {
        color: black;
      }
    }
    .o-formula-assistant-gray {
      color: gray;
    }
  }
  .o-formula-assistant-container {
    user-select: none;
  }
  .o-formula-assistant-event-none {
    pointer-events: none;
  }
  .o-formula-assistant-event-auto {
    pointer-events: auto;
  }
  .o-formula-assistant-transparency {
    opacity: 0.3;
  }
`;class FunctionDescriptionProvider extends Component$d{constructor(){super(...arguments);this.assistantState=useState$a({allowCellSelectionBehind:false,});this.timeOutId=0;}
willUnmount(){if(this.timeOutId){clearTimeout(this.timeOutId);}}
getContext(){return this.props;}
onMouseMove(){this.assistantState.allowCellSelectionBehind=true;if(this.timeOutId){clearTimeout(this.timeOutId);}
this.timeOutId=setTimeout(()=>{this.assistantState.allowCellSelectionBehind=false;},2000);}}
FunctionDescriptionProvider.template=TEMPLATE$d;FunctionDescriptionProvider.style=CSS$c;const{Component:Component$c}=owl__namespace;const{useRef:useRef$5,useState:useState$9}=owl__namespace.hooks;const{xml:xml$e,css:css$d}=owl__namespace.tags;const functions=functionRegistry.content;const ASSISTANT_WIDTH=300;const FunctionColor="#4a4e4d";const OperatorColor="#3da4ab";const StringColor="#f6cd61";const SelectionIndicatorColor="darkgrey";const NumberColor="#02c39a";const MatchingParenColor="pink";const SelectionIndicatorClass="selector-flag";const tokenColor={OPERATOR:OperatorColor,NUMBER:NumberColor,STRING:StringColor,FUNCTION:FunctionColor,DEBUGGER:OperatorColor,LEFT_PAREN:FunctionColor,RIGHT_PAREN:FunctionColor,COMMA:FunctionColor,};const TEMPLATE$c=xml$e`
<div class="o-composer-container">
  <div
    t-att-class="{ 'o-composer': true, 'text-muted': getters.isReadonly(), 'unfocusable': getters.isReadonly() }"
    t-att-style="props.inputStyle"
    t-ref="o_composer"
    tabindex="1"
    t-att-contenteditable="getters.isReadonly() ? 'false' : 'true'"
    spellcheck="false"

    t-on-keydown="onKeydown"
    t-on-mousedown="onMousedown"
    t-on-input="onInput"
    t-on-keyup="onKeyup"
    t-on-click.stop="onClick"
    t-on-blur="onBlur"
  />

  <div t-if="props.focus !== 'inactive' and (autoCompleteState.showProvider or functionDescriptionState.showDescription)"
    class="o-composer-assistant" t-att-style="assistantStyle">
    <TextValueProvider
        t-if="autoCompleteState.showProvider"
        t-ref="o_autocomplete_provider"
        search="autoCompleteState.search"
        provider="autoCompleteState.provider"
        t-on-completed="onCompleted"
        borderStyle="borderStyle"
    />
    <FunctionDescriptionProvider
        t-if="functionDescriptionState.showDescription"
        t-ref="o_function_description_provider"
        functionName = "functionDescriptionState.functionName"
        functionDescription = "functionDescriptionState.functionDescription"
        argToFocus = "functionDescriptionState.argToFocus"
        borderStyle="borderStyle"
    />
  </div>
</div>
  `;const CSS$b=css$d`
  .o-composer-container {
    padding: 0;
    margin: 0;
    border: 0;
    z-index: 5;
    flex-grow: 1;
    max-height: inherit;
    .o-composer {
      caret-color: black;
      padding-left: 3px;
      padding-right: 3px;
      word-break: break-all;
      &:focus {
        outline: none;
      }
      &.unfocusable {
        pointer-events: none;
      }
      span {
        white-space: pre;
        &.${SelectionIndicatorClass}:after {
          content: "${SelectionIndicator}";
          color: ${SelectionIndicatorColor};
        }
      }
    }
    .o-composer-assistant {
      position: absolute;
      margin: 4px;
      pointer-events: none;
    }
  }

  /* Custom css to highlight topbar composer on focus */
  .o-topbar-toolbar .o-composer-container:focus-within {
    border: 1px solid ${SELECTION_BORDER_COLOR};
  }
`;class Composer extends Component$c{constructor(){super(...arguments);this.composerRef=useRef$5("o_composer");this.autoCompleteRef=useRef$5("o_autocomplete_provider");this.getters=this.env.getters;this.dispatch=this.env.dispatch;this.composerState=useState$9({positionStart:0,positionEnd:0,});this.autoCompleteState=useState$9({showProvider:false,provider:"functions",search:"",});this.functionDescriptionState=useState$9({showDescription:false,functionName:"",functionDescription:{},argToFocus:0,});this.isKeyStillDown=false;this.borderStyle=`box-shadow: 0 1px 4px 3px rgba(60, 64, 67, 0.15);`;this.shouldProcessInputEvents=false;this.tokens=[];this.keyMapping={ArrowUp:this.processArrowKeys,ArrowDown:this.processArrowKeys,ArrowLeft:this.processArrowKeys,ArrowRight:this.processArrowKeys,Enter:this.processEnterKey,Escape:this.processEscapeKey,F2:()=>console.warn("Not implemented"),F4:()=>console.warn("Not implemented"),Tab:(ev)=>this.processTabKey(ev),};this.contentHelper=new ContentEditableHelper(this.composerRef.el);}
get assistantStyle(){if(this.props.delimitation&&this.props.rect){const[cellX,cellY,,cellHeight]=this.props.rect;const remainingHeight=this.props.delimitation.height-(cellY+cellHeight);let assistantStyle="";if(cellY>remainingHeight){assistantStyle+=`
          top: -8px;
          transform: translate(0, -100%);
        `;}
if(cellX+ASSISTANT_WIDTH>this.props.delimitation.width){assistantStyle+=`right:0px;`;}
return(assistantStyle+=`width:${ASSISTANT_WIDTH}px;`);}
return`width:${ASSISTANT_WIDTH}px;`;}
mounted(){DEBUG.composer=this;const el=this.composerRef.el;this.contentHelper.updateEl(el);this.processContent();}
willUnmount(){delete DEBUG.composer;this.trigger("composer-unmounted");}
patched(){if(!this.isKeyStillDown){this.processContent();}}
processArrowKeys(ev){if(this.getters.isSelectingForComposer()){this.functionDescriptionState.showDescription=false;return;}
if(this.props.focus==="cellFocus"&&!this.autoCompleteState.showProvider){return;}
ev.stopPropagation();const autoCompleteComp=this.autoCompleteRef.comp;if(["ArrowUp","ArrowDown"].includes(ev.key)&&this.autoCompleteState.showProvider&&autoCompleteComp){ev.preventDefault();if(ev.key==="ArrowUp"){autoCompleteComp.moveUp();}
else{autoCompleteComp.moveDown();}}}
processTabKey(ev){ev.preventDefault();ev.stopPropagation();const autoCompleteComp=this.autoCompleteRef.comp;if(this.autoCompleteState.showProvider&&autoCompleteComp){const autoCompleteValue=autoCompleteComp.getValueToFill();if(autoCompleteValue){this.autoComplete(autoCompleteValue);return;}}
else{this.dispatch("STOP_COMPOSER_RANGE_SELECTION");}
const deltaX=ev.shiftKey?-1:1;this.dispatch("MOVE_POSITION",{deltaX,deltaY:0});}
processEnterKey(ev){ev.preventDefault();ev.stopPropagation();this.isKeyStillDown=false;const autoCompleteComp=this.autoCompleteRef.comp;if(this.autoCompleteState.showProvider&&autoCompleteComp){const autoCompleteValue=autoCompleteComp.getValueToFill();if(autoCompleteValue){this.autoComplete(autoCompleteValue);return;}}
this.dispatch("STOP_EDITION");this.dispatch("MOVE_POSITION",{deltaX:0,deltaY:ev.shiftKey?-1:1,});}
processEscapeKey(){this.dispatch("STOP_EDITION",{cancel:true});}
onKeydown(ev){let handler=this.keyMapping[ev.key];if(handler){handler.call(this,ev);}
else{ev.stopPropagation();}
const{start,end}=this.contentHelper.getCurrentSelection();if(!this.getters.isSelectingForComposer()){this.dispatch("CHANGE_COMPOSER_CURSOR_SELECTION",{start,end});this.isKeyStillDown=true;}}
onInput(){if(this.props.focus==="inactive"||!this.shouldProcessInputEvents){return;}
this.dispatch("STOP_COMPOSER_RANGE_SELECTION");const el=this.composerRef.el;this.dispatch("SET_CURRENT_CONTENT",{content:el.childNodes.length?el.textContent:"",selection:this.contentHelper.getCurrentSelection(),});}
onKeyup(ev){this.isKeyStillDown=false;if(this.props.focus==="inactive"||["Control","Shift","Tab","Enter"].includes(ev.key)){return;}
if(this.autoCompleteState.showProvider&&["ArrowUp","ArrowDown"].includes(ev.key)){return;}
if(this.getters.isSelectingForComposer()&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(ev.key)){return;}
ev.preventDefault();ev.stopPropagation();this.autoCompleteState.showProvider=false;if(ev.ctrlKey&&ev.key===" "){this.autoCompleteState.search="";this.autoCompleteState.showProvider=true;this.dispatch("STOP_COMPOSER_RANGE_SELECTION");return;}
const{start:oldStart,end:oldEnd}=this.getters.getComposerSelection();const{start,end}=this.contentHelper.getCurrentSelection();if(start!==oldStart||end!==oldEnd){this.dispatch("CHANGE_COMPOSER_CURSOR_SELECTION",this.contentHelper.getCurrentSelection());}
this.processTokenAtCursor();this.processContent();}
onMousedown(ev){if(ev.button>0){return;}
this.contentHelper.removeSelection();}
onClick(){if(this.getters.isReadonly()){return;}
const newSelection=this.contentHelper.getCurrentSelection();this.dispatch("STOP_COMPOSER_RANGE_SELECTION");if(this.props.focus==="inactive"){this.trigger("composer-content-focused",{selection:newSelection,});}
this.dispatch("CHANGE_COMPOSER_CURSOR_SELECTION",newSelection);this.processTokenAtCursor();}
onBlur(){this.isKeyStillDown=false;}
onCompleted(ev){this.autoComplete(ev.detail.text);}
processContent(){this.contentHelper.removeAll();this.shouldProcessInputEvents=false;if(this.props.focus!=="inactive"){this.contentHelper.selectRange(0,0);}
const content=this.getContent();if(content.length!==0){this.contentHelper.setText(content);const{start,end}=this.getters.getComposerSelection();if(this.props.focus!=="inactive"){this.contentHelper.selectRange(start,end);}}
this.shouldProcessInputEvents=true;}
getContent(){let content;let value=this.getters.getCurrentContent();if(value===""){content=[];}
else if(value.startsWith("=")&&this.getters.getEditionMode()!=="inactive"){content=this.getColoredTokens();}
else{content=[{value}];}
return content;}
getColoredTokens(){const tokens=this.getters.getCurrentTokens();const tokenAtCursor=this.getters.getTokenAtCursor();const result=[];const{end}=this.getters.getComposerSelection();for(let token of tokens){switch(token.type){case"OPERATOR":case"NUMBER":case"FUNCTION":case"COMMA":case"STRING":result.push({value:token.value,color:tokenColor[token.type]||"#000"});break;case"SYMBOL":let value=token.value;const[xc,sheet]=value.split("!").reverse();if(rangeReference.test(xc)){result.push({value:token.value,color:this.rangeColor(xc,sheet)||"#000"});}
else if(["TRUE","FALSE"].includes(value.toUpperCase())){result.push({value:token.value,color:NumberColor});}
else{result.push({value:token.value,color:"#000"});}
break;case"LEFT_PAREN":case"RIGHT_PAREN":if(tokenAtCursor&&["LEFT_PAREN","RIGHT_PAREN"].includes(tokenAtCursor.type)&&tokenAtCursor.parenIndex&&tokenAtCursor.parenIndex===token.parenIndex){result.push({value:token.value,color:MatchingParenColor});}
else{result.push({value:token.value,color:tokenColor[token.type]||"#000"});}
break;default:result.push({value:token.value,color:"#000"});break;}
if(this.getters.getEditionMode()==="waitingForRangeSelection"&&end===token.end){result[result.length-1].class=SelectionIndicatorClass;}}
return result;}
rangeColor(xc,sheetName){if(this.getters.getEditionMode()==="inactive"){return undefined;}
const highlights=this.getters.getHighlights();const refSheet=sheetName?this.getters.getSheetIdByName(sheetName):this.getters.getEditionSheet();const highlight=highlights.find((highlight)=>highlight.sheet===refSheet&&isEqual(this.getters.expandZone(refSheet,toZone(xc)),highlight.zone));return highlight&&highlight.color?highlight.color:undefined;}
processTokenAtCursor(){let content=this.getters.getCurrentContent();this.autoCompleteState.showProvider=false;this.functionDescriptionState.showDescription=false;if(content.startsWith("=")){const tokenAtCursor=this.getters.getTokenAtCursor();if(tokenAtCursor){const[xc]=tokenAtCursor.value.split("!").reverse();if(tokenAtCursor.type==="FUNCTION"||(tokenAtCursor.type==="SYMBOL"&&!rangeReference.test(xc))){this.autoCompleteState.search=tokenAtCursor.value;this.autoCompleteState.showProvider=true;}
else if(tokenAtCursor.functionContext&&tokenAtCursor.type!=="UNKNOWN"){const tokenContext=tokenAtCursor.functionContext;const parentFunction=tokenContext.parent.toUpperCase();const description=functions[parentFunction];const argPosition=tokenContext.argPosition;this.functionDescriptionState.functionName=parentFunction;this.functionDescriptionState.functionDescription=description;this.functionDescriptionState.argToFocus=description.getArgToFocus(argPosition+1)-1;this.functionDescriptionState.showDescription=true;}}}}
autoComplete(value){if(value){const tokenAtCursor=this.getters.getTokenAtCursor();if(tokenAtCursor){let start=tokenAtCursor.end;let end=tokenAtCursor.end;if(["SYMBOL","FUNCTION"].includes(tokenAtCursor.type)){start=tokenAtCursor.start;}
const tokens=this.getters.getCurrentTokens();if(this.autoCompleteState.provider&&tokens.length){value+="(";const currentTokenIndex=tokens.map((token)=>token.start).indexOf(tokenAtCursor.start);if(currentTokenIndex+1<tokens.length){const nextToken=tokens[currentTokenIndex+1];if(nextToken.type==="LEFT_PAREN"){end++;}}}
this.dispatch("CHANGE_COMPOSER_CURSOR_SELECTION",{start,end,});}
this.dispatch("REPLACE_COMPOSER_CURSOR_SELECTION",{text:value,});}
this.processTokenAtCursor();}}
Composer.template=TEMPLATE$c;Composer.style=CSS$b;Composer.components={TextValueProvider,FunctionDescriptionProvider};Composer.defaultProps={inputStyle:"",focus:"inactive",};const{Component:Component$b}=owl__namespace;const{useState:useState$8}=owl__namespace.hooks;const{xml:xml$d,css:css$c}=owl__namespace.tags;const SCROLLBAR_WIDTH=14;const SCROLLBAR_HIGHT=15;const TEMPLATE$b=xml$d`
  <div class="o-grid-composer" t-att-style="containerStyle">
    <Composer
      focus = "props.focus"
      inputStyle = "composerStyle"
      rect = "composerState.rect"
      delimitation = "composerState.delimitation"
      t-on-keydown = "onKeydown"
    />
  </div>
`;const COMPOSER_BORDER_WIDTH=3*0.4*window.devicePixelRatio||1;const CSS$a=css$c`
  .o-grid-composer {
    z-index: 5;
    box-sizing: border-box;
    position: absolute;
    border: ${COMPOSER_BORDER_WIDTH}px solid ${SELECTION_BORDER_COLOR};
  }
`;class GridComposer extends Component$b{constructor(){super(...arguments);this.getters=this.env.getters;this.composerState=useState$8({rect:null,delimitation:null,});const[col,row]=this.getters.getPosition();this.zone=this.getters.expandZone(this.getters.getActiveSheetId(),{left:col,right:col,top:row,bottom:row,});this.rect=this.getters.getRect(this.zone,this.getters.getActiveSnappedViewport());}
get containerStyle(){const isFormula=this.getters.getCurrentContent().startsWith("=");const style=this.getters.getCurrentStyle();const[left,top,width,height]=this.rect;const background=(!isFormula&&style.fillColor)||"#ffffff";const color=(!isFormula&&style.textColor)||"#000000";const fontSize=(!isFormula&&style.fontSize)||10;const fontWeight=!isFormula&&style.bold?"bold":500;const fontStyle=!isFormula&&style.italic?"italic":"normal";const textDecoration=!isFormula?getTextDecoration(style):"none";let textAlign="left";if(!isFormula){const cell=this.getters.getActiveCell();textAlign=style.align||(cell===null||cell===void 0?void 0:cell.defaultAlign)||"left";}
return`
      left: ${left - 1}px;
      top: ${top}px;
      min-width: ${width + 2}px;
      min-height: ${height + 1}px;

      background: ${background};
      color: ${color};

      font-size: ${fontSizeMap[fontSize]}px;
      font-weight: ${fontWeight};
      font-style: ${fontStyle};
      text-decoration: ${textDecoration};

      text-align: ${textAlign};
    `;}
get composerStyle(){return`
      line-height: ${DEFAULT_CELL_HEIGHT}px;
      max-height: inherit;
      overflow: hidden;
    `;}
mounted(){const el=this.el;const maxHeight=el.parentElement.clientHeight-this.rect[1]-SCROLLBAR_HIGHT;el.style.maxHeight=(maxHeight+"px");const maxWidth=el.parentElement.clientWidth-this.rect[0]-SCROLLBAR_WIDTH;el.style.maxWidth=(maxWidth+"px");this.composerState.rect=[this.rect[0],this.rect[1],el.clientWidth,el.clientHeight];this.composerState.delimitation={width:el.parentElement.clientWidth,height:el.parentElement.clientHeight,};}
onKeydown(ev){if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(ev.key)){ev.preventDefault();}}}
GridComposer.template=TEMPLATE$b;GridComposer.style=CSS$a;GridComposer.components={Composer};const{Component:Component$a,tags:tags$2}=owl__namespace;const{xml:xml$c,css:css$b}=tags$2;const TEMPLATE$a=xml$c`
    <div class="o-error-tooltip"> 
      <t t-esc="props.text"/>
    </div>
`;const CSS$9=css$b`
  .o-error-tooltip {
    font-size: 13px;
    background-color: white;
    border-left: 3px solid red;
    padding: 10px;
  }
`;class ErrorToolTip extends Component$a{}
ErrorToolTip.template=TEMPLATE$a;ErrorToolTip.style=CSS$9;const{useState:useState$7}=owl__namespace;const{xml:xml$b,css:css$a}=owl.tags;const{useRef:useRef$4}=owl.hooks;const TEMPLATE$9=xml$b`
<div class="o-chart-container">
  <div class="o-chart-menu" t-on-click="showMenu">${LIST}</div>
  <canvas t-att-style="canvasStyle" t-ref="graphContainer"/>
  <Menu t-if="menuState.isOpen"
    position="menuState.position"
    menuItems="menuState.menuItems"
    t-on-close="menuState.isOpen=false"/>
</div>`;const CSS$8=css$a`
  .o-chart-container {
    width: 100%;
    height: 100%;
    position: relative;

    .o-chart-menu {
      right: 0px;
      display: none;
      position: absolute;
      padding: 5px;
      cursor: pointer;
    }
  }
  .o-figure.active:focus {
    .o-chart-container {
      .o-chart-menu {
        display: flex;
      }
    }
  }
`;class ChartFigure extends owl.Component{constructor(){super(...arguments);this.menuState=useState$7({isOpen:false,position:null,menuItems:[]});this.canvas=useRef$4("graphContainer");this.state={background:BACKGROUND_CHART_COLOR};this.position=useAbsolutePosition();}
get canvasStyle(){return`background-color: ${this.state.background}`;}
mounted(){const figure=this.props.figure;const chartData=this.env.getters.getChartRuntime(figure.id);if(chartData){this.createChart(chartData);}}
patched(){var _a,_b,_c;const figure=this.props.figure;const chartData=this.env.getters.getChartRuntime(figure.id);if(chartData){if(chartData.type!==this.chart.config.type){this.chart&&this.chart.destroy();this.createChart(chartData);}
else if(chartData.data&&chartData.data.datasets){this.chart.data=chartData.data;if((_a=chartData.options)===null||_a===void 0?void 0:_a.title){this.chart.config.options.title=chartData.options.title;}}
else{this.chart.data.datasets=undefined;}
this.chart.config.options.legend=(_b=chartData.options)===null||_b===void 0?void 0:_b.legend;this.chart.config.options.scales=(_c=chartData.options)===null||_c===void 0?void 0:_c.scales;this.chart.update({duration:0});}
else{this.chart&&this.chart.destroy();}
const def=this.env.getters.getChartDefinition(figure.id);if(def){this.state.background=def.background;}}
createChart(chartData){const canvas=this.canvas.el;const ctx=canvas.getContext("2d");this.chart=new window.Chart(ctx,chartData);const def=this.env.getters.getChartDefinition(this.props.figure.id);if(def){this.state.background=def.background;}}
showMenu(ev){const registry=new MenuItemRegistry();registry.add("edit",{name:_lt("Edit"),sequence:1,action:()=>this.env.openSidePanel("ChartPanel",{figure:this.props.figure}),});registry.add("delete",{name:_lt("Delete"),sequence:10,action:()=>{this.env.dispatch("DELETE_FIGURE",{sheetId:this.env.getters.getActiveSheetId(),id:this.props.figure.id,});if(this.props.sidePanelIsOpen){this.env.toggleSidePanel("ChartPanel",{figure:this.props.figure});}
this.trigger("figure-deleted");},});registry.add("refresh",{name:_lt("Refresh"),sequence:11,action:()=>{this.env.dispatch("REFRESH_CHART",{id:this.props.figure.id,});},});this.openContextMenu(ev.currentTarget,registry);}
openContextMenu(target,registry){const x=target.offsetLeft;const y=target.offsetTop;this.menuState.isOpen=true;this.menuState.menuItems=registry.getAll().filter((x)=>x.isVisible(this.env));this.menuState.position={x:this.position.x+x-MENU_WIDTH,y:this.position.y+y,};}}
ChartFigure.template=TEMPLATE$9;ChartFigure.style=CSS$8;ChartFigure.components={Menu};const{xml:xml$a,css:css$9}=owl__namespace.tags;const{useState:useState$6}=owl__namespace;const TEMPLATE$8=xml$a`<div>
    <t t-foreach="getVisibleFigures()" t-as="info" t-key="info.id">
        <div class="o-figure-wrapper"
             t-att-style="getStyle(info)"
             t-on-mousedown="onMouseDown(info.figure)"
             >
            <div class="o-figure"
                 t-att-class="{active: info.isSelected, 'o-dragging': info.id === dnd.figureId}"
                 t-att-style="getDims(info)"
                 tabindex="0"
                 t-on-keydown.stop="onKeyDown(info.figure)">
                <t t-component="figureRegistry.get(info.figure.tag).Component"
                   t-key="info.id"
                   sidePanelIsOpen="props.sidePanelIsOpen"
                   figure="info.figure"/>
                <t t-if="info.isSelected">
                    <div class="o-anchor o-top" t-on-mousedown.stop="resize(info.figure, 0,-1)"/>
                    <div class="o-anchor o-topRight" t-on-mousedown.stop="resize(info.figure, 1,-1)"/>
                    <div class="o-anchor o-right" t-on-mousedown.stop="resize(info.figure, 1,0)"/>
                    <div class="o-anchor o-bottomRight" t-on-mousedown.stop="resize(info.figure, 1,1)"/>
                    <div class="o-anchor o-bottom" t-on-mousedown.stop="resize(info.figure, 0,1)"/>
                    <div class="o-anchor o-bottomLeft" t-on-mousedown.stop="resize(info.figure, -1,1)"/>
                    <div class="o-anchor o-left" t-on-mousedown.stop="resize(info.figure, -1,0)"/>
                    <div class="o-anchor o-topLeft" t-on-mousedown.stop="resize(info.figure, -1,-1)"/>
                </t>
            </div>
        </div>
    </t>
</div>
`;const ANCHOR_SIZE=8;const BORDER_WIDTH=1;const ACTIVE_BORDER_WIDTH=2;const MIN_FIG_SIZE=80;const CSS$7=css$9`
  .o-figure-wrapper {
    overflow: hidden;
  }

  .o-figure {
    border: 1px solid black;
    box-sizing: border-box;
    position: absolute;
    bottom: 3px;
    right: 3px;
    &:focus {
      outline: none;
    }
    &.active {
      border: ${ACTIVE_BORDER_WIDTH}px solid ${SELECTION_BORDER_COLOR};
      z-index: 1;
    }

    &.o-dragging {
      opacity: 0.9;
      cursor: grabbing;
    }

    .o-anchor {
      z-index: 1000;
      position: absolute;
      outline: ${BORDER_WIDTH}px solid white;
      width: ${ANCHOR_SIZE}px;
      height: ${ANCHOR_SIZE}px;
      background-color: #1a73e8;
      &.o-top {
        top: -${ANCHOR_SIZE / 2}px;
        right: calc(50% - 4px);
        cursor: n-resize;
      }
      &.o-topRight {
        top: -${ANCHOR_SIZE / 2}px;
        right: -${ANCHOR_SIZE / 2}px;
        cursor: ne-resize;
      }
      &.o-right {
        right: -${ANCHOR_SIZE / 2}px;
        top: calc(50% - 4px);
        cursor: e-resize;
      }
      &.o-bottomRight {
        bottom: -${ANCHOR_SIZE / 2}px;
        right: -${ANCHOR_SIZE / 2}px;
        cursor: se-resize;
      }
      &.o-bottom {
        bottom: -${ANCHOR_SIZE / 2}px;
        right: calc(50% - 4px);
        cursor: s-resize;
      }
      &.o-bottomLeft {
        bottom: -${ANCHOR_SIZE / 2}px;
        left: -${ANCHOR_SIZE / 2}px;
        cursor: sw-resize;
      }
      &.o-left {
        bottom: calc(50% - 4px);
        left: -${ANCHOR_SIZE / 2}px;
        cursor: w-resize;
      }
      &.o-topLeft {
        top: -${ANCHOR_SIZE / 2}px;
        left: -${ANCHOR_SIZE / 2}px;
        cursor: nw-resize;
      }
    }
  }
`;class FiguresContainer extends owl.Component{constructor(){super(...arguments);this.figureRegistry=figureRegistry;this.dnd=useState$6({figureId:"",x:0,y:0,width:0,height:0,});this.getters=this.env.getters;this.dispatch=this.env.dispatch;}
getVisibleFigures(){const selectedId=this.getters.getSelectedFigureId();return this.getters.getVisibleFigures(this.getters.getActiveSheetId()).map((f)=>({id:f.id,isSelected:f.id===selectedId,figure:f,}));}
getDims(info){const{figure,isSelected}=info;const borders=2*(isSelected?ACTIVE_BORDER_WIDTH:BORDER_WIDTH);const{width,height}=isSelected&&this.dnd.figureId?this.dnd:figure;return`width:${width + borders}px;height:${height + borders}px`;}
getStyle(info){const{figure,isSelected}=info;const{offsetX,offsetY}=this.getters.getActiveSnappedViewport();const target=figure.id===(isSelected&&this.dnd.figureId)?this.dnd:figure;const{width,height}=target;let x=target.x-offsetX+HEADER_WIDTH-1;let y=target.y-offsetY+HEADER_HEIGHT-1;const correctionX=Math.max(0,HEADER_WIDTH-x);x+=correctionX;const correctionY=Math.max(0,HEADER_HEIGHT-y);y+=correctionY;if(width<0||height<0){return`position:absolute;display:none;`;}
const offset=ANCHOR_SIZE+ACTIVE_BORDER_WIDTH+(isSelected?ACTIVE_BORDER_WIDTH:BORDER_WIDTH);return`position:absolute; top:${y + 1}px; left:${x + 1}px; width:${width - correctionX + offset}px; height:${height - correctionY + offset}px`;}
mounted(){this.render();}
resize(figure,dirX,dirY,ev){ev.stopPropagation();const initialX=ev.clientX;const initialY=ev.clientY;this.dnd.figureId=figure.id;this.dnd.x=figure.x;this.dnd.y=figure.y;this.dnd.width=figure.width;this.dnd.height=figure.height;const onMouseMove=(ev)=>{const deltaX=dirX*(ev.clientX-initialX);const deltaY=dirY*(ev.clientY-initialY);this.dnd.width=Math.max(figure.width+deltaX,MIN_FIG_SIZE);this.dnd.height=Math.max(figure.height+deltaY,MIN_FIG_SIZE);if(dirX<0){this.dnd.x=figure.x-deltaX;}
if(dirY<0){this.dnd.y=figure.y-deltaY;}};const onMouseUp=(ev)=>{this.dnd.figureId="";const update={x:this.dnd.x,y:this.dnd.y,};if(dirX){update.width=this.dnd.width;}
if(dirY){update.height=this.dnd.height;}
this.dispatch("UPDATE_FIGURE",{sheetId:this.getters.getActiveSheetId(),id:figure.id,...update,});};startDnd(onMouseMove,onMouseUp);}
onMouseDown(figure,ev){if(ev.button>0){return;}
this.dispatch("SELECT_FIGURE",{id:figure.id});if(this.props.sidePanelIsOpen){this.env.openSidePanel("ChartPanel",{figure});}
const initialX=ev.clientX;const initialY=ev.clientY;this.dnd.figureId=figure.id;this.dnd.x=figure.x;this.dnd.y=figure.y;this.dnd.width=figure.width;this.dnd.height=figure.height;const onMouseMove=(ev)=>{this.dnd.x=Math.max(figure.x-initialX+ev.clientX,0);this.dnd.y=Math.max(figure.y-initialY+ev.clientY,0);};const onMouseUp=(ev)=>{this.dnd.figureId="";this.dispatch("UPDATE_FIGURE",{sheetId:this.getters.getActiveSheetId(),id:figure.id,x:this.dnd.x,y:this.dnd.y,});};startDnd(onMouseMove,onMouseUp);}
onKeyDown(figure,ev){ev.preventDefault();switch(ev.key){case"Delete":this.dispatch("DELETE_FIGURE",{sheetId:this.getters.getActiveSheetId(),id:figure.id});this.trigger("figure-deleted");break;case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":const deltaMap={ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0],ArrowUp:[0,-1],};const delta=deltaMap[ev.key];this.dispatch("UPDATE_FIGURE",{sheetId:this.getters.getActiveSheetId(),id:figure.id,x:figure.x+delta[0],y:figure.y+delta[1],});}}}
FiguresContainer.template=TEMPLATE$8;FiguresContainer.style=CSS$7;FiguresContainer.components={};figureRegistry.add("chart",{Component:ChartFigure,SidePanelComponent:"ChartPanel"});const{Component:Component$9}=owl__namespace;const{xml:xml$9,css:css$8}=owl__namespace.tags;const TEMPLATE$7=xml$9`
    <div class="o-border"
        t-on-mousedown="onMouseDown"
        t-att-style="style"
        t-att-class="{
          'o-moving': props.isMoving,
          'o-border-n': props.orientation === 'n',
          'o-border-s': props.orientation === 's',
          'o-border-w': props.orientation === 'w',
          'o-border-e': props.orientation === 'e',
        }"
        >
    </div>
`;const CSS$6=css$8`
  .o-border {
    position: absolute;
    &:hover {
      cursor: grab;
    }
  }
  }
  .o-moving {
    cursor: grabbing;
  }
`;class Border extends Component$9{get style(){const isTop=["n","w","e"].includes(this.props.orientation);const isLeft=["n","w","s"].includes(this.props.orientation);const isHorizontal=["n","s"].includes(this.props.orientation);const isVertical=["w","e"].includes(this.props.orientation);const s=this.env.getters.getActiveSheet();const z=this.props.zone;const margin=2;const left=s.cols[z.left].start+margin;const right=s.cols[z.right].end-2*margin;const top=s.rows[z.top].start+margin;const bottom=s.rows[z.bottom].end-2*margin;const lineWidth=4;const leftValue=isLeft?left:right;const topValue=isTop?top:bottom;const widthValue=isHorizontal?right-left:lineWidth;const heightValue=isVertical?bottom-top:lineWidth;const{offsetX,offsetY}=this.env.getters.getActiveSnappedViewport();return`
        left:${leftValue + HEADER_WIDTH - offsetX}px;
        top:${topValue + HEADER_HEIGHT - offsetY}px;
        width:${widthValue}px;
        height:${heightValue}px;
    `;}
onMouseDown(ev){this.trigger("move-highlight",{clientX:ev.clientX,clientY:ev.clientY});}}
Border.template=TEMPLATE$7;Border.style=CSS$6;const{Component:Component$8}=owl__namespace;const{xml:xml$8,css:css$7}=owl__namespace.tags;const TEMPLATE$6=xml$8`
    <div class="o-corner"
        t-on-mousedown="onMouseDown"
        t-att-style="style"
        t-att-class="{
          'o-resizing': props.isResizing,
          'o-corner-nw': props.orientation === 'nw',
          'o-corner-ne': props.orientation === 'ne',
          'o-corner-sw': props.orientation === 'sw',
          'o-corner-se': props.orientation === 'se',
        }"
        >
    </div>
`;const CSS$5=css$7`
  .o-corner {
    position: absolute;
    height: 6px;
    width: 6px;
    border: 1px solid white;
  }
  .o-corner-nw,
  .o-corner-se {
    &:hover {
      cursor: nwse-resize;
    }
  }
  .o-corner-ne,
  .o-corner-sw {
    &:hover {
      cursor: nesw-resize;
    }
  }
  .o-resizing {
    cursor: grabbing;
  }
`;class Corner extends Component$8{constructor(){super(...arguments);this.isTop=this.props.orientation[0]==="n";this.isLeft=this.props.orientation[1]==="w";}
get style(){const{offsetX,offsetY}=this.env.getters.getActiveSnappedViewport();const s=this.env.getters.getActiveSheet();const z=this.props.zone;const leftValue=this.isLeft?s.cols[z.left].start:s.cols[z.right].end;const topValue=this.isTop?s.rows[z.top].start:s.rows[z.bottom].end;return`
      left:${leftValue + HEADER_WIDTH - offsetX - AUTOFILL_EDGE_LENGTH / 2}px;
      top:${topValue + HEADER_HEIGHT - offsetY - AUTOFILL_EDGE_LENGTH / 2}px;
      background-color:${this.props.color};
    `;}
onMouseDown(ev){this.trigger("resize-highlight",{isLeft:this.isLeft,isTop:this.isTop});}}
Corner.template=TEMPLATE$6;Corner.style=CSS$5;const{Component:Component$7}=owl__namespace;const{xml:xml$7}=owl__namespace.tags;const TEMPLATE$5=xml$7`
  <div class="o-highlight">
    <t t-foreach="['nw', 'ne', 'sw', 'se']" t-as="orientation" t-key="orientation">
      <Corner
        t-on-resize-highlight="onResizeHighlight"
        isResizing='highlightState.shiftingMode === "isResizing"'
        orientation="orientation"
        zone="props.zone"
        color="props.color"
      />
    </t>
    <t t-foreach="['n', 's', 'w', 'e']" t-as="orientation" t-key="orientation">
      <Border
        t-on-move-highlight="onMoveHighlight"
        isMoving='highlightState.shiftingMode === "isMoving"'
        orientation="orientation"
        zone="props.zone"
      />
    </t>
  </div>
`;class Highlight extends Component$7{constructor(){super(...arguments);this.highlightState=owl.useState({shiftingMode:"none",});}
onResizeHighlight(ev){this.highlightState.shiftingMode="isResizing";const z=this.props.zone;const pivotCol=ev.detail.isLeft?z.right:z.left;const pivotRow=ev.detail.isTop?z.bottom:z.top;let lastCol=ev.detail.isLeft?z.left:z.right;let lastRow=ev.detail.isTop?z.top:z.bottom;let currentZone=z;this.env.dispatch("START_CHANGE_HIGHLIGHT",{zone:currentZone});const mouseMove=(col,row)=>{if(lastCol!==col||lastRow!==row){const activeSheet=this.env.getters.getActiveSheet();lastCol=clip(col===-1?lastCol:col,0,activeSheet.cols.length-1);lastRow=clip(row===-1?lastRow:row,0,activeSheet.rows.length-1);let newZone={left:Math.min(pivotCol,lastCol),top:Math.min(pivotRow,lastRow),right:Math.max(pivotCol,lastCol),bottom:Math.max(pivotRow,lastRow),};newZone=this.env.getters.expandZone(activeSheet.id,newZone);if(!isEqual(newZone,currentZone)){this.env.dispatch("CHANGE_HIGHLIGHT",{zone:newZone});currentZone=newZone;}}};const mouseUp=()=>{this.highlightState.shiftingMode="none";this.env.dispatch("STOP_COMPOSER_RANGE_SELECTION");};dragAndDropBeyondTheViewport(this.el.parentElement,this.env,mouseMove,mouseUp);}
onMoveHighlight(ev){this.highlightState.shiftingMode="isMoving";const z=this.props.zone;const parent=this.el.parentElement;const position=parent.getBoundingClientRect();const activeSheet=this.env.getters.getActiveSheet();const{top:viewportTop,left:viewportLeft}=this.env.getters.getActiveSnappedViewport();const initCol=this.env.getters.getColIndex(ev.detail.clientX-position.left,viewportLeft);const initRow=this.env.getters.getRowIndex(ev.detail.clientY-position.top,viewportTop);const deltaColMin=-z.left;const deltaColMax=activeSheet.cols.length-z.right-1;const deltaRowMin=-z.top;const deltaRowMax=activeSheet.rows.length-z.bottom-1;let currentZone=z;this.env.dispatch("START_CHANGE_HIGHLIGHT",{zone:currentZone});let lastCol=initCol;let lastRow=initRow;const mouseMove=(col,row)=>{if(lastCol!==col||lastRow!==row){lastCol=col===-1?lastCol:col;lastRow=row===-1?lastRow:row;const deltaCol=clip(lastCol-initCol,deltaColMin,deltaColMax);const deltaRow=clip(lastRow-initRow,deltaRowMin,deltaRowMax);let newZone={left:z.left+deltaCol,top:z.top+deltaRow,right:z.right+deltaCol,bottom:z.bottom+deltaRow,};newZone=this.env.getters.expandZone(activeSheet.id,newZone);if(!isEqual(newZone,currentZone)){this.env.dispatch("CHANGE_HIGHLIGHT",{zone:newZone});currentZone=newZone;}}};const mouseUp=()=>{this.highlightState.shiftingMode="none";this.env.dispatch("STOP_COMPOSER_RANGE_SELECTION");};dragAndDropBeyondTheViewport(parent,this.env,mouseMove,mouseUp);}}
Highlight.template=TEMPLATE$5;Highlight.components={Corner,Border,};const{Component:Component$6,tags:tags$1}=owl__namespace;const{xml:xml$6,css:css$6}=tags$1;const TEMPLATE$4=xml$6`
  <div class="o-link-tool">
    <t t-set="link" t-value="cell.link"/>
    <a t-if="link.isExternal"
      class="o-link"
      t-att-href="link.url"
      target="_blank"
      t-on-click.prevent="openLink"
      t-att-title="link.url">
      <t t-esc="cell.urlRepresentation"/>
    </a>
    <a t-else=""
      class="o-link"
      t-on-click.prevent="openLink"
      t-att-title="cell.urlRepresentation">
      <t t-esc="cell.urlRepresentation"/>
    </a>
    <span class="o-link-icon o-unlink" t-on-click="unlink" title="${LinkEditorTerms.Remove}">${UNLINK}</span>
    <span class="o-link-icon o-edit-link" t-on-click="edit" title="${LinkEditorTerms.Edit}">${EDIT}</span>
  </div>
`;const CSS$4=css$6`
  .o-link-tool {
    font-size: 13px;
    background-color: white;
    box-shadow: 0 1px 4px 3px rgba(60, 64, 67, 0.15);
    padding: 12px;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    a.o-link {
      color: #007bff;
      flex-grow: 2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    a.o-link:hover {
      text-decoration: underline;
      color: #0056b3;
      cursor: pointer;
    }
  }
  .o-link-icon {
    float: right;
    padding-left: 4%;
    .o-icon {
      height: 16px;
    }
  }
  .o-link-icon.o-unlink .o-icon {
    padding-top: 1px;
    height: 14px;
  }
  .o-link-icon:hover {
    cursor: pointer;
    color: #000;
  }
`;class LinkDisplay extends Component$6{constructor(){super(...arguments);this.getters=this.env.getters;}
get cell(){const{col,row}=this.props.cellPosition;const sheetId=this.getters.getActiveSheetId();const cell=this.getters.getCell(sheetId,col,row);if(cell===null||cell===void 0?void 0:cell.isLink()){return cell;}
throw new Error(`LinkDisplay Component can only be used with link cells. ${toXC(col, row)} is not a link.`);}
openLink(){this.cell.action(this.env);}
edit(){this.env.openLinkEditor();}
unlink(){const sheetId=this.getters.getActiveSheetId();const[col,row]=this.getters.getPosition();const[mainCol,mainRow]=this.getters.getMainCell(sheetId,col,row);const style=this.cell.style;const textColor=(style===null||style===void 0?void 0:style.textColor)===LINK_COLOR?undefined:style===null||style===void 0?void 0:style.textColor;this.env.dispatch("UPDATE_CELL",{col:mainCol,row:mainRow,sheetId,content:this.cell.link.label,style:{...style,textColor,underline:undefined},});}}
LinkDisplay.template=TEMPLATE$4;LinkDisplay.components={Menu};LinkDisplay.style=CSS$4;const{Component:Component$5,tags,hooks:hooks$1,useState:useState$5}=owl__namespace;const{xml:xml$5,css:css$5}=tags;const{useRef:useRef$3}=hooks$1;const MENU_OFFSET_X=320;const MENU_OFFSET_Y=100;const PADDING=12;const TEMPLATE$3=xml$5`
    <div class="o-link-editor" t-on-click.stop="menu.isOpen=false" t-on-keydown.stop="onKeyDown">
      <div class="o-section">
        <div t-esc="env._t('${LinkEditorTerms.Text}')" class="o-section-title"/>
        <div class="d-flex">
          <input type="text" class="o-input flex-grow-1" t-model="state.link.label"></input>
        </div>

        <div t-esc="env._t('${LinkEditorTerms.Link}')" class="o-section-title mt-3"/>
        <div class="o-link-url">
          <t t-if="state.isUrlEditable">
            <input type="text" t-ref="urlInput" t-model="state.link.url"></input>
          </t>
          <t t-else="">
            <input type="text" t-att-value="state.urlRepresentation" disabled="1"></input>
          </t>
          <button t-if="state.link.url" t-on-click="removeLink" class="o-remove-url">✖</button>
          <button t-if="!state.link.url" t-on-click.stop="openMenu" class="o-special-link">${LIST}</button>
        </div>
      </div>
      <Menu
        t-if="menu.isOpen"
        position="menuPosition"
        menuItems="menuItems"
        t-on-menu-clicked="onSpecialLink"
        t-on-close.stop="menu.isOpen=false"/>
      <div class="o-buttons">
        <button t-on-click="cancel" class="o-button o-cancel" t-esc="env._t('${LinkEditorTerms.Cancel}')"></button>
        <button t-on-click="save" class="o-button o-save" t-esc="env._t('${LinkEditorTerms.Confirm}')" t-att-disabled="!state.link.url" ></button>
      </div>
    </div>`;const CSS$3=css$5`
  .o-link-editor {
    font-size: 13px;
    background-color: white;
    box-shadow: 0 1px 4px 3px rgba(60, 64, 67, 0.15);
    padding: ${PADDING}px;
    display: flex;
    flex-direction: column;
    border-radius: 4px;
    .o-section {
      .o-section-title {
        font-weight: bold;
        color: dimgrey;
        margin-bottom: 5px;
      }
    }
    .o-buttons {
      padding-left: 16px;
      padding-top: 16px;
      padding-bottom: 16px;
      text-align: right;
      .o-button {
        border: 1px solid lightgrey;
        padding: 0px 20px 0px 20px;
        border-radius: 4px;
        font-weight: 500;
        font-size: 14px;
        height: 30px;
        line-height: 16px;
        background: white;
        margin-right: 8px;
        &:hover:enabled {
          background-color: rgba(0, 0, 0, 0.08);
        }
      }
      .o-button:enabled {
        cursor: pointer;
      }
      .o-button:last-child {
        margin-right: 0px;
      }
    }
    input {
      box-sizing: border-box;
      width: 100%;
      border-radius: 4px;
      padding: 4px 23px 4px 10px;
      border: none;
      height: 24px;
      border: 1px solid lightgrey;
    }
    .o-link-url {
      position: relative;
      flex-grow: 1;
      button {
        position: absolute;
        right: 0px;
        top: 0px;
        border: none;
        height: 20px;
        width: 20px;
        background-color: #fff;
        margin: 2px 3px 1px 0px;
        padding: 0px 1px 0px 0px;
      }
      button:hover {
        cursor: pointer;
      }
    }
  }
`;class LinkEditor extends Component$5{constructor(){super(...arguments);this.menuItems=linkMenuRegistry.getAll();this.getters=this.env.getters;this.state=useState$5(this.defaultState);this.menu=useState$5({isOpen:false,});this.position=useAbsolutePosition();this.urlInput=useRef$3("urlInput");}
mounted(){var _a;(_a=this.urlInput.el)===null||_a===void 0?void 0:_a.focus();}
get defaultState(){const{col,row}=this.props.cellPosition;const sheetId=this.getters.getActiveSheetId();const cell=this.getters.getCell(sheetId,col,row);if(cell===null||cell===void 0?void 0:cell.isLink()){return{link:{url:cell.link.url,label:cell.formattedValue},urlRepresentation:cell.urlRepresentation,isUrlEditable:cell.isUrlEditable,};}
return{link:{url:"",label:(cell===null||cell===void 0?void 0:cell.formattedValue)||""},isUrlEditable:true,urlRepresentation:"",};}
get menuPosition(){return{x:this.position.x+MENU_OFFSET_X-PADDING-2,y:this.position.y+MENU_OFFSET_Y,};}
onSpecialLink(ev){const{detail}=ev;this.state.link.url=detail.link.url;this.state.link.label=detail.link.label;this.state.isUrlEditable=detail.isUrlEditable;this.state.urlRepresentation=detail.urlRepresentation;}
openMenu(){this.menu.isOpen=true;}
removeLink(){this.state.link.url="";this.state.urlRepresentation="";this.state.isUrlEditable=true;}
save(){const{col,row}=this.props.cellPosition;const label=this.state.link.label||this.state.link.url;this.env.dispatch("UPDATE_CELL",{col:col,row:row,sheetId:this.getters.getActiveSheetId(),content:markdownLink(label,this.state.link.url),});this.trigger("link-editor-closed");}
cancel(){this.trigger("link-editor-closed");}
onKeyDown(ev){switch(ev.key){case"Enter":if(this.state.link.url){this.save();}
break;case"Escape":this.cancel();break;}}}
LinkEditor.template=TEMPLATE$3;LinkEditor.components={Menu};LinkEditor.style=CSS$3;const{Component:Component$4}=owl__namespace;const{xml:xml$4,css:css$4}=owl__namespace.tags;const{useState:useState$4}=owl__namespace.hooks;class AbstractResizer extends Component$4{constructor(){super(...arguments);this.PADDING=0;this.MAX_SIZE_MARGIN=0;this.MIN_ELEMENT_SIZE=0;this.lastSelectedElementIndex=null;this.getters=this.env.getters;this.dispatch=this.env.dispatch;this.state=useState$4({resizerIsActive:false,isResizing:false,isMoving:false,isSelecting:false,waitingForMove:false,activeElement:0,draggerLinePosition:0,draggerShadowPosition:0,draggerShadowThickness:0,delta:0,base:0,});}
_computeHandleDisplay(ev){const position=this._getEvOffset(ev);const elementIndex=this._getElementIndex(position);if(elementIndex<0){return;}
const element=this._getElement(elementIndex);const offset=this._getStateOffset();if(position-(element.start-offset)<this.PADDING&&elementIndex!==this._getViewportOffset()){this.state.resizerIsActive=true;this.state.draggerLinePosition=element.start-offset-this._getHeaderSize();this.state.activeElement=this._getPreviousVisibleElement(elementIndex);}
else if(element.end-offset-position<this.PADDING){this.state.resizerIsActive=true;this.state.draggerLinePosition=element.end-offset-this._getHeaderSize();this.state.activeElement=elementIndex;}
else{this.state.resizerIsActive=false;}}
_computeGrabDisplay(ev){const index=this._getElementIndex(this._getEvOffset(ev));const activeElements=this._getActiveElements();const selectedZoneStart=this._getSelectedZoneStart();const selectedZoneEnd=this._getSelectedZoneEnd();if(activeElements.has(selectedZoneStart)){if(selectedZoneStart<=index&&index<=selectedZoneEnd){this.state.waitingForMove=true;return;}}
this.state.waitingForMove=false;}
onMouseMove(ev){if(this.state.isResizing||this.state.isMoving||this.state.isSelecting){return;}
this._computeHandleDisplay(ev);this._computeGrabDisplay(ev);}
onMouseLeave(){this.state.resizerIsActive=this.state.isResizing;this.state.waitingForMove=false;}
onDblClick(){this._fitElementSize(this.state.activeElement);this.state.isResizing=false;}
onMouseDown(ev){this.state.isResizing=true;this.state.delta=0;const initialPosition=this._getClientPosition(ev);const styleValue=this.state.draggerLinePosition;const size=this._getElement(this.state.activeElement).size;const minSize=styleValue-size+this.MIN_ELEMENT_SIZE;const maxSize=this._getMaxSize();const onMouseUp=(ev)=>{this.state.isResizing=false;if(this.state.delta!==0){this._updateSize();}};const onMouseMove=(ev)=>{this.state.delta=this._getClientPosition(ev)-initialPosition;this.state.draggerLinePosition=styleValue+this.state.delta;if(this.state.draggerLinePosition<minSize){this.state.draggerLinePosition=minSize;this.state.delta=this.MIN_ELEMENT_SIZE-size;}
if(this.state.draggerLinePosition>maxSize){this.state.draggerLinePosition=maxSize;this.state.delta=maxSize-styleValue;}};startDnd(onMouseMove,onMouseUp);}
select(ev){if(ev.button>0){return;}
const index=this._getElementIndex(this._getEvOffset(ev));if(index<0){return;}
if(this.state.waitingForMove===true){this.startMovement(ev);return;}
this.startSelection(ev,index);}
startMovement(ev){this.state.waitingForMove=false;this.state.isMoving=true;const startElement=this._getElement(this._getSelectedZoneStart());const endElement=this._getElement(this._getSelectedZoneEnd());const initialPosition=this._getClientPosition(ev);const defaultPosition=startElement.start-this._getStateOffset()-this._getHeaderSize();this.state.draggerLinePosition=defaultPosition;this.state.base=this._getSelectedZoneStart();this.state.draggerShadowPosition=defaultPosition;this.state.draggerShadowThickness=endElement.end-startElement.start;const mouseMoveMovement=(elementIndex,currentEv)=>{if(elementIndex>=0){const element=this._getElement(elementIndex);const offset=this._getStateOffset()+this._getHeaderSize();if(elementIndex<=this._getSelectedZoneStart()){this.state.draggerLinePosition=element.start-offset;this.state.base=elementIndex;}
else if(this._getSelectedZoneEnd()<elementIndex){this.state.draggerLinePosition=element.end-offset;this.state.base=elementIndex+1;}
else{this.state.draggerLinePosition=startElement.start-offset;this.state.base=this._getSelectedZoneStart();}
const delta=this._getClientPosition(currentEv)-initialPosition;this.state.draggerShadowPosition=Math.max(defaultPosition+delta,0);}};const mouseUpMovement=(finalEv)=>{this.state.isMoving=false;if(this.state.base!==this._getSelectedZoneStart()){this._moveElements();}
this._computeGrabDisplay(finalEv);};this.dragOverlayBeyondTheViewport(ev,mouseMoveMovement,mouseUpMovement);}
startSelection(ev,index){this.state.isSelecting=true;this.dispatch(ev.ctrlKey?"START_SELECTION_EXPANSION":"START_SELECTION");if(ev.shiftKey){this._increaseSelection(index);}
else{this._selectElement(index,ev.ctrlKey);}
this.lastSelectedElementIndex=index;const mouseMoveSelect=(elementIndex,currentEv)=>{if(elementIndex!==this.lastSelectedElementIndex&&elementIndex!==-1){this._increaseSelection(elementIndex);this.lastSelectedElementIndex=elementIndex;}};const mouseUpSelect=()=>{this.state.isSelecting=false;this.lastSelectedElementIndex=null;this.dispatch(ev.ctrlKey?"PREPARE_SELECTION_EXPANSION":"STOP_SELECTION");this._computeGrabDisplay(ev);};this.dragOverlayBeyondTheViewport(ev,mouseMoveSelect,mouseUpSelect);}
dragOverlayBeyondTheViewport(ev,cbMouseMove,cbMouseUp){let timeOutId=null;let currentEv;const initialPosition=this._getClientPosition(ev);const initialOffset=this._getEvOffset(ev);const onMouseMove=(ev)=>{currentEv=ev;if(timeOutId){return;}
const position=this._getClientPosition(currentEv)-initialPosition+initialOffset;const EdgeScrollInfo=this._getEdgeScroll(position);const{first,last}=this._getBoundaries();let elementIndex;if(EdgeScrollInfo.canEdgeScroll){elementIndex=EdgeScrollInfo.direction>0?last:first-1;}
else{elementIndex=this._getElementIndex(position);}
cbMouseMove(elementIndex,currentEv);if(EdgeScrollInfo.canEdgeScroll){this._adjustViewport(EdgeScrollInfo.direction);timeOutId=setTimeout(()=>{timeOutId=null;onMouseMove(currentEv);},Math.round(EdgeScrollInfo.delay));}};const onMouseUp=(finalEv)=>{clearTimeout(timeOutId);cbMouseUp(finalEv);};startDnd(onMouseMove,onMouseUp);}
onMouseUp(ev){this.lastSelectedElementIndex=null;}
onContextMenu(ev){ev.preventDefault();const index=this._getElementIndex(this._getEvOffset(ev));if(index<0)
return;if(!this._getActiveElements().has(index)){this._selectElement(index,false);}
const type=this._getType();const{x,y}=this._getXY(ev);this.trigger("open-contextmenu",{type,x,y});}}
class ColResizer extends AbstractResizer{constructor(){super(...arguments);this.PADDING=15;this.MAX_SIZE_MARGIN=90;this.MIN_ELEMENT_SIZE=MIN_COL_WIDTH;}
_getEvOffset(ev){return ev.offsetX+HEADER_WIDTH;}
_getStateOffset(){return this.getters.getActiveSnappedViewport().offsetX-HEADER_WIDTH;}
_getViewportOffset(){return this.getters.getActiveSnappedViewport().left;}
_getClientPosition(ev){return ev.clientX;}
_getElementIndex(index){return this.getters.getColIndex(index,this.getters.getActiveSnappedViewport().left);}
_getSelectedZoneStart(){return this.getters.getSelectedZone().left;}
_getSelectedZoneEnd(){return this.getters.getSelectedZone().right;}
_getEdgeScroll(position){return this.getters.getEdgeScrollCol(position);}
_getBoundaries(){const{left,right}=this.getters.getActiveSnappedViewport();return{first:left,last:right};}
_getElement(index){return this.getters.getCol(this.getters.getActiveSheetId(),index);}
_getBottomRightValue(element){return element.end;}
_getHeaderSize(){return HEADER_WIDTH;}
_getMaxSize(){return this.el.clientWidth;}
_updateSize(){const index=this.state.activeElement;const size=this.state.delta+this._getElement(index).size;const cols=this.getters.getActiveCols();this.dispatch("RESIZE_COLUMNS_ROWS",{dimension:"COL",sheetId:this.getters.getActiveSheetId(),elements:cols.has(index)?[...cols]:[index],size,});}
_moveElements(){const elements=[];const start=this._getSelectedZoneStart();const end=this._getSelectedZoneEnd();for(let colIndex=start;colIndex<=end;colIndex++){elements.push(colIndex);}
this.dispatch("MOVE_COLUMNS_ROWS",{sheetId:this.getters.getActiveSheetId(),dimension:"COL",base:this.state.base,elements,});}
_selectElement(index,ctrlKey){this.dispatch("SELECT_COLUMN",{index,createRange:ctrlKey});}
_increaseSelection(index){this.dispatch("SELECT_COLUMN",{index,updateRange:true});}
_adjustViewport(direction){const{left,offsetY}=this.getters.getActiveSnappedViewport();const{cols}=this.getters.getActiveSheet();const offsetX=cols[left+direction].start;this.dispatch("SET_VIEWPORT_OFFSET",{offsetX,offsetY});}
_fitElementSize(index){const cols=this.getters.getActiveCols();this.dispatch("AUTORESIZE_COLUMNS",{sheetId:this.getters.getActiveSheetId(),cols:cols.has(index)?[...cols]:[index],});}
_getType(){return"COL";}
_getActiveElements(){return this.getters.getActiveCols();}
_getXY(ev){return{x:ev.offsetX+HEADER_WIDTH,y:ev.offsetY,};}
_getPreviousVisibleElement(index){const cols=this.getters.getActiveSheet().cols.slice(0,index);const step=cols.reverse().findIndex((col)=>!col.isHidden);return index-1-step;}
unhide(hiddenElements){this.dispatch("UNHIDE_COLUMNS_ROWS",{sheetId:this.getters.getActiveSheetId(),elements:hiddenElements,dimension:"COL",});}
unhideStyleValue(hiddenIndex){const col=this.getters.getCol(this.getters.getActiveSheetId(),hiddenIndex);const offset=this._getStateOffset();return col.start-offset-this._getHeaderSize();}}
ColResizer.template=xml$4`
    <div class="o-col-resizer" t-on-mousemove.self="onMouseMove" t-on-mouseleave="onMouseLeave" t-on-mousedown.self.prevent="select"
      t-on-mouseup.self="onMouseUp" t-on-contextmenu.self="onContextMenu" t-att-class="{'o-grab': state.waitingForMove, 'o-dragging': state.isMoving, }">
      <div t-if="state.isMoving" class="dragging-col-line" t-attf-style="left:{{state.draggerLinePosition}}px;"/>
      <div t-if="state.isMoving" class="dragging-col-shadow" t-attf-style="left:{{state.draggerShadowPosition}}px; width:{{state.draggerShadowThickness}}px"/>
      <t t-if="state.resizerIsActive">
        <div class="o-handle" t-on-mousedown="onMouseDown" t-on-dblclick="onDblClick" t-on-contextmenu.prevent=""
        t-attf-style="left:{{state.draggerLinePosition - 2}}px;">
        <div class="dragging-resizer" t-if="state.isResizing"/>
        </div>
      </t>
      <t t-foreach="getters.getHiddenColsGroups(getters.getActiveSheetId())" t-as="hiddenItem" t-key="hiddenItem_index">
        <t t-if="!hiddenItem.includes(0)">
          <div class="o-unhide" t-att-data-index="hiddenItem_index" t-attf-style="left:{{unhideStyleValue(hiddenItem[0]) - 17}}px; margin-right:6px;" t-on-click="unhide(hiddenItem)">
          ${TRIANGLE_LEFT_ICON}
          </div>
        </t>
        <t t-if="!hiddenItem.includes(getters.getActiveSheet().cols.length-1)">
          <div class="o-unhide" t-att-data-index="hiddenItem_index" t-attf-style="left:{{unhideStyleValue(hiddenItem[0]) + 3}}px;" t-on-click="unhide(hiddenItem)">
          ${TRIANGLE_RIGHT_ICON}
          </div>
        </t>
      </t>
    </div>`;ColResizer.style=css$4`
    .o-col-resizer {
      position: absolute;
      top: 0;
      left: ${HEADER_WIDTH}px;
      right: 0;
      height: ${HEADER_HEIGHT}px;
      &.o-dragging {
        cursor: grabbing;
      }
      &.o-grab {
        cursor: grab;
      }
      .dragging-col-line {
        top: ${HEADER_HEIGHT}px;
        position: absolute;
        width: 2px;
        height: 10000px;
        background-color: black;
      }
      .dragging-col-shadow {
        top: ${HEADER_HEIGHT}px;
        position: absolute;
        height: 10000px;
        background-color: black;
        opacity: 0.1;
      }
      .o-handle {
        position: absolute;
        height: ${HEADER_HEIGHT}px;
        width: 4px;
        cursor: e-resize;
        background-color: ${SELECTION_BORDER_COLOR};
      }
      .dragging-resizer {
        top: ${HEADER_HEIGHT}px;
        position: absolute;
        margin-left: 2px;
        width: 1px;
        height: 10000px;
        background-color: ${SELECTION_BORDER_COLOR};
      }
      .o-unhide {
        width: ${UNHIDE_ICON_EDGE_LENGTH}px;
        height: ${UNHIDE_ICON_EDGE_LENGTH}px;
        position: absolute;
        overflow: hidden;
        border-radius: 2px;
        top: calc(${HEADER_HEIGHT}px / 2 - ${UNHIDE_ICON_EDGE_LENGTH}px / 2);
      }
      .o-unhide:hover {
        z-index: 1;
        background-color: lightgrey;
      }
      .o-unhide > svg {
        position: relative;
        top: calc(${UNHIDE_ICON_EDGE_LENGTH}px / 2 - ${ICON_EDGE_LENGTH}px / 2);
      }
    }
  `;class RowResizer extends AbstractResizer{constructor(){super(...arguments);this.PADDING=5;this.MAX_SIZE_MARGIN=60;this.MIN_ELEMENT_SIZE=MIN_ROW_HEIGHT;}
_getEvOffset(ev){return ev.offsetY+HEADER_HEIGHT;}
_getStateOffset(){return this.getters.getActiveSnappedViewport().offsetY-HEADER_HEIGHT;}
_getViewportOffset(){return this.getters.getActiveSnappedViewport().top;}
_getClientPosition(ev){return ev.clientY;}
_getElementIndex(index){return this.getters.getRowIndex(index,this.getters.getActiveSnappedViewport().top);}
_getSelectedZoneStart(){return this.getters.getSelectedZone().top;}
_getSelectedZoneEnd(){return this.getters.getSelectedZone().bottom;}
_getEdgeScroll(position){return this.getters.getEdgeScrollRow(position);}
_getBoundaries(){const{top,bottom}=this.getters.getActiveSnappedViewport();return{first:top,last:bottom};}
_getElement(index){return this.getters.getRow(this.getters.getActiveSheetId(),index);}
_getHeaderSize(){return HEADER_HEIGHT;}
_getMaxSize(){return this.el.clientHeight;}
_updateSize(){const index=this.state.activeElement;const size=this.state.delta+this._getElement(index).size;const rows=this.getters.getActiveRows();this.dispatch("RESIZE_COLUMNS_ROWS",{dimension:"ROW",sheetId:this.getters.getActiveSheetId(),elements:rows.has(index)?[...rows]:[index],size,});}
_moveElements(){const elements=[];const start=this._getSelectedZoneStart();const end=this._getSelectedZoneEnd();for(let rowIndex=start;rowIndex<=end;rowIndex++){elements.push(rowIndex);}
this.dispatch("MOVE_COLUMNS_ROWS",{sheetId:this.getters.getActiveSheetId(),dimension:"ROW",base:this.state.base,elements,});}
_selectElement(index,ctrlKey){this.dispatch("SELECT_ROW",{index,createRange:ctrlKey});}
_increaseSelection(index){this.dispatch("SELECT_ROW",{index,updateRange:true});}
_adjustViewport(direction){const{top,offsetX}=this.getters.getActiveSnappedViewport();const{rows}=this.getters.getActiveSheet();const offsetY=rows[top+direction].start;this.dispatch("SET_VIEWPORT_OFFSET",{offsetX,offsetY});}
_fitElementSize(index){const rows=this.getters.getActiveRows();this.dispatch("AUTORESIZE_ROWS",{sheetId:this.getters.getActiveSheetId(),rows:rows.has(index)?[...rows]:[index],});}
_getType(){return"ROW";}
_getActiveElements(){return this.getters.getActiveRows();}
_getXY(ev){return{x:ev.offsetX,y:ev.offsetY+HEADER_HEIGHT,};}
_getPreviousVisibleElement(index){const rows=this.getters.getActiveSheet().rows.slice(0,index);const step=rows.reverse().findIndex((row)=>!row.isHidden);return index-1-step;}
unhide(hiddenElements){this.dispatch("UNHIDE_COLUMNS_ROWS",{sheetId:this.getters.getActiveSheetId(),dimension:"ROW",elements:hiddenElements,});}
unhideStyleValue(hiddenIndex){const row=this.getters.getRow(this.getters.getActiveSheetId(),hiddenIndex);const offset=this._getStateOffset();return row.start-offset-this._getHeaderSize();}}
RowResizer.template=xml$4`
    <div class="o-row-resizer" t-on-mousemove.self="onMouseMove" t-on-mouseleave="onMouseLeave" t-on-mousedown.self.prevent="select"
    t-on-mouseup.self="onMouseUp" t-on-contextmenu.self="onContextMenu" t-att-class="{'o-grab': state.waitingForMove, 'o-dragging': state.isMoving}">
      <div t-if="state.isMoving" class="dragging-row-line" t-attf-style="top:{{state.draggerLinePosition}}px;"/>
      <div t-if="state.isMoving" class="dragging-row-shadow" t-attf-style="top:{{state.draggerShadowPosition}}px; height:{{state.draggerShadowThickness}}px;"/>
      <t t-if="state.resizerIsActive">
        <div class="o-handle" t-on-mousedown="onMouseDown" t-on-dblclick="onDblClick" t-on-contextmenu.prevent=""
          t-attf-style="top:{{state.draggerLinePosition - 2}}px;">
          <div class="dragging-resizer" t-if="state.isResizing"/>
        </div>
      </t>
      <t t-foreach="getters.getHiddenRowsGroups(getters.getActiveSheetId())" t-as="hiddenItem" t-key="hiddenItem_index">
        <t t-if="!hiddenItem.includes(0)">
          <div class="o-unhide" t-att-data-index="hiddenItem_index" t-attf-style="top:{{unhideStyleValue(hiddenItem[0]) - 17}}px;" t-on-click="unhide(hiddenItem)">
          ${TRIANGLE_UP_ICON}
          </div>
        </t>
        <t t-if="!hiddenItem.includes(getters.getActiveSheet().rows.length-1)">
         <div class="o-unhide" t-att-data-index="hiddenItem_index"  t-attf-style="top:{{unhideStyleValue(hiddenItem[0]) + 3}}px;" t-on-click="unhide(hiddenItem)">
         ${TRIANGLE_DOWN_ICON}
         </div>
        </t>
      </t>
    </div>`;RowResizer.style=css$4`
    .o-row-resizer {
      position: absolute;
      top: ${HEADER_HEIGHT}px;
      left: 0;
      right: 0;
      width: ${HEADER_WIDTH}px;
      height: 100%;
      &.o-dragging {
        cursor: grabbing;
      }
      &.o-grab {
        cursor: grab;
      }
      .dragging-row-line {
        left: ${HEADER_WIDTH}px;
        position: absolute;
        width: 10000px;
        height: 2px;
        background-color: black;
      }
      .dragging-row-shadow {
        left: ${HEADER_WIDTH}px;
        position: absolute;
        width: 10000px;
        background-color: black;
        opacity: 0.1;
      }
      .o-handle {
        position: absolute;
        height: 4px;
        width: ${HEADER_WIDTH}px;
        cursor: n-resize;
        background-color: ${SELECTION_BORDER_COLOR};
      }
      .dragging-resizer {
        left: ${HEADER_WIDTH}px;
        position: absolute;
        margin-top: 2px;
        width: 10000px;
        height: 1px;
        background-color: ${SELECTION_BORDER_COLOR};
      }
      .o-unhide {
        width: ${UNHIDE_ICON_EDGE_LENGTH}px;
        height: ${UNHIDE_ICON_EDGE_LENGTH}px;
        position: absolute;
        overflow: hidden;
        border-radius: 2px;
        left: calc(${HEADER_WIDTH}px - ${UNHIDE_ICON_EDGE_LENGTH}px - 2px);
      }
      .o-unhide > svg {
        position: relative;
        left: calc(${UNHIDE_ICON_EDGE_LENGTH}px / 2 - ${ICON_EDGE_LENGTH}px / 2);
        top: calc(${UNHIDE_ICON_EDGE_LENGTH}px / 2 - ${ICON_EDGE_LENGTH}px / 2);
      }
      .o-unhide:hover {
        z-index: 1;
        background-color: lightgrey;
      }
    }
  `;class Overlay extends Component$4{selectAll(){this.env.dispatch("SELECT_ALL");}}
Overlay.template=xml$4`
    <div class="o-overlay">
      <ColResizer />
      <RowResizer />
      <div class="all" t-on-mousedown.self="selectAll"/>
    </div>`;Overlay.style=css$4`
    .o-overlay {
      .all {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        width: ${HEADER_WIDTH}px;
        height: ${HEADER_HEIGHT}px;
      }
    }
  `;Overlay.components={ColResizer,RowResizer};class ScrollBar{constructor(el,direction){this.el=el;this.direction=direction;}
get scroll(){return this.direction==="horizontal"?this.el.scrollLeft:this.el.scrollTop;}
set scroll(value){if(this.direction==="horizontal"){this.el.scrollLeft=value;}
else{this.el.scrollTop=value;}}}
const{Component:Component$3,useState:useState$3}=owl__namespace;const{xml:xml$3,css:css$3}=owl__namespace.tags;const{useRef:useRef$2,onMounted,onWillUnmount}=owl__namespace.hooks;const registries$1={ROW:rowMenuRegistry,COL:colMenuRegistry,CELL:cellMenuRegistry,};const LINK_EDITOR_WIDTH=340;const LINK_EDITOR_HEIGHT=180;const ERROR_TOOLTIP_HEIGHT=80;const ERROR_TOOLTIP_WIDTH=180;const keyDownMappingIgnore=["CTRL+C","CTRL+V"];function useCellHovered(env,getViewPort){const hoveredPosition=useState$3({});const{browser,getters}=env;const{Date,setInterval,clearInterval}=browser;const canvasRef=useRef$2("canvas");let x=0;let y=0;let lastMoved=0;let interval;function getPosition(){const viewport=getViewPort();const col=getters.getColIndex(x,viewport.left);const row=getters.getRowIndex(y,viewport.top);return[col,row];}
function checkTiming(){const[col,row]=getPosition();const delta=Date.now()-lastMoved;if(col!==hoveredPosition.col||row!==hoveredPosition.row){hoveredPosition.col=undefined;hoveredPosition.row=undefined;}
if(400<delta&&delta<600){if(col<0||row<0){return;}
hoveredPosition.col=col;hoveredPosition.row=row;}}
function updateMousePosition(e){x=e.offsetX;y=e.offsetY;lastMoved=Date.now();}
onMounted(()=>{canvasRef.el.addEventListener("mousemove",updateMousePosition);interval=setInterval(checkTiming,200);});onWillUnmount(()=>{canvasRef.el.removeEventListener("mousemove",updateMousePosition);clearInterval(interval);});return hoveredPosition;}
function useTouchMove(handler,canMoveUp){const canvasRef=useRef$2("canvas");let x=null;let y=null;function onTouchStart(ev){if(ev.touches.length!==1)
return;x=ev.touches[0].clientX;y=ev.touches[0].clientY;}
function onTouchEnd(){x=null;y=null;}
function onTouchMove(ev){if(ev.touches.length!==1)
return;if(canMoveUp()){ev.preventDefault();ev.stopPropagation();}
const currentX=ev.touches[0].clientX;const currentY=ev.touches[0].clientY;handler(x-currentX,y-currentY);x=currentX;y=currentY;}
onMounted(()=>{canvasRef.el.addEventListener("touchstart",onTouchStart);canvasRef.el.addEventListener("touchend",onTouchEnd);canvasRef.el.addEventListener("touchmove",onTouchMove);});onWillUnmount(()=>{canvasRef.el.removeEventListener("touchstart",onTouchStart);canvasRef.el.removeEventListener("touchend",onTouchEnd);canvasRef.el.removeEventListener("touchmove",onTouchMove);});}
const TEMPLATE$2=xml$3`
  <div class="o-grid" t-on-click="focus" t-on-keydown="onKeydown" t-on-wheel="onMouseWheel">
    <t t-if="getters.getEditionMode() !== 'inactive'">
      <GridComposer
        t-on-composer-unmounted="focus"
        focus="props.focusComposer"
        />
    </t>
    <canvas t-ref="canvas"
      t-on-mousedown="onMouseDown"
      t-on-dblclick="onDoubleClick"
      tabindex="-1"
      t-on-contextmenu="onCanvasContextMenu"
       />
    <t t-foreach="getters.getClientsToDisplay()" t-as="client" t-key="getClientPositionKey(client)">
      <ClientTag name="client.name"
                 color="client.color"
                 col="client.position.col"
                 row="client.position.row"
                 active="isCellHovered(client.position.col, client.position.row)"
                 />
    </t>
    <Popover
      t-if="errorTooltip.isOpen"
      position="errorTooltip.position"
      childWidth="${ERROR_TOOLTIP_WIDTH}"
      childHeight="${ERROR_TOOLTIP_HEIGHT}">
      <ErrorToolTip text="errorTooltip.text"/>
    </Popover>
    <Popover
      t-if="shouldDisplayLink"
      position="popoverPosition.position"
      flipHorizontalOffset="-popoverPosition.cellWidth"
      flipVerticalOffset="-popoverPosition.cellHeight"
      childWidth="${LINK_TOOLTIP_WIDTH}"
      childHeight="${LINK_TOOLTIP_HEIGHT}">
      <LinkDisplay cellPosition="activeCellPosition"/>
    </Popover>
    <Popover
      t-if="props.linkEditorIsOpen"
      position="popoverPosition.position"
      flipHorizontalOffset="-popoverPosition.cellWidth"
      flipVerticalOffset="-popoverPosition.cellHeight"
      childWidth="${LINK_EDITOR_WIDTH}"
      childHeight="${LINK_EDITOR_HEIGHT}">
      <LinkEditor cellPosition="activeCellPosition"/>
    </Popover>
    <t t-if="getters.getEditionMode() === 'inactive'">
      <Autofill position="getAutofillPosition()"/>
    </t>
    <t t-if="getters.getEditionMode() !== 'inactive'">
      <t t-foreach="getters.getHighlights()" t-as="highlight">
        <t t-if="highlight.sheet === getters.getActiveSheetId()">
          <Highlight zone="highlight.zone" color="highlight.color"/>
        </t>
      </t>
    </t>
    <Overlay t-on-open-contextmenu="onOverlayContextMenu" />
    <Menu t-if="menuState.isOpen"
      menuItems="menuState.menuItems"
      position="menuState.position"
      t-on-close.stop="menuState.isOpen=false"/>
    <t t-set="gridSize" t-value="getters.getGridDimension(getters.getActiveSheet())"/>
    <FiguresContainer model="props.model" sidePanelIsOpen="props.sidePanelIsOpen" t-on-figure-deleted="focus" />
    <div class="o-scrollbar vertical" t-on-scroll="onScroll" t-ref="vscrollbar">
      <div t-attf-style="width:1px;height:{{gridSize.height}}px"/>
    </div>
    <div class="o-scrollbar horizontal" t-on-scroll="onScroll" t-ref="hscrollbar">
      <div t-attf-style="height:1px;width:{{gridSize.width}}px"/>
    </div>
  </div>`;const CSS$2=css$3`
  .o-grid {
    position: relative;
    overflow: hidden;
    background-color: ${BACKGROUND_GRAY_COLOR};

    > canvas {
      border-top: 1px solid #e2e3e3;
      border-bottom: 1px solid #e2e3e3;

      &:focus {
        outline: none;
      }
    }
    .o-scrollbar {
      position: absolute;
      overflow: auto;
      z-index: 2;
      &.vertical {
        right: 0;
        top: ${HEADER_HEIGHT}px;
        bottom: ${SCROLLBAR_WIDTH$1}px;
        width: ${SCROLLBAR_WIDTH$1}px;
        overflow-x: hidden;
      }
      &.horizontal {
        bottom: 0;
        height: ${SCROLLBAR_WIDTH$1}px;
        right: ${SCROLLBAR_WIDTH$1 + 1}px;
        left: ${HEADER_WIDTH}px;
        overflow-y: hidden;
      }
    }
  }
`;class Grid extends Component$3{constructor(){super(...arguments);this.menuState=useState$3({isOpen:false,position:null,menuItems:[],});this.vScrollbarRef=useRef$2("vscrollbar");this.hScrollbarRef=useRef$2("hscrollbar");this.canvas=useRef$2("canvas");this.getters=this.env.getters;this.dispatch=this.env.dispatch;this.currentSheet=this.getters.getActiveSheetId();this.clickedCol=0;this.clickedRow=0;this.hoveredCell=useCellHovered(this.env,()=>this.getters.getActiveSnappedViewport());this.keyDownMapping={ENTER:()=>{const cell=this.getters.getActiveCell();!cell||cell.isEmpty()?this.trigger("composer-cell-focused"):this.trigger("composer-content-focused");},TAB:()=>this.dispatch("MOVE_POSITION",{deltaX:1,deltaY:0}),"SHIFT+TAB":()=>this.dispatch("MOVE_POSITION",{deltaX:-1,deltaY:0}),F2:()=>{const cell=this.getters.getActiveCell();!cell||cell.isEmpty()?this.trigger("composer-cell-focused"):this.trigger("composer-content-focused");},DELETE:()=>{this.dispatch("DELETE_CONTENT",{sheetId:this.getters.getActiveSheetId(),target:this.getters.getSelectedZones(),});},"CTRL+A":()=>this.dispatch("SELECT_ALL"),"CTRL+S":()=>{this.trigger("save-requested");},"CTRL+Z":()=>this.dispatch("REQUEST_UNDO"),"CTRL+Y":()=>this.dispatch("REQUEST_REDO"),"CTRL+B":()=>this.dispatch("SET_FORMATTING",{sheetId:this.getters.getActiveSheetId(),target:this.getters.getSelectedZones(),style:{bold:!this.getters.getCurrentStyle().bold},}),"CTRL+I":()=>this.dispatch("SET_FORMATTING",{sheetId:this.getters.getActiveSheetId(),target:this.getters.getSelectedZones(),style:{italic:!this.getters.getCurrentStyle().italic},}),"CTRL+U":()=>this.dispatch("SET_FORMATTING",{sheetId:this.getters.getActiveSheetId(),target:this.getters.getSelectedZones(),style:{underline:!this.getters.getCurrentStyle().underline},}),"ALT+=":()=>{var _a;const sheetId=this.getters.getActiveSheetId();const mainSelectedZone=this.getters.getSelectedZone();const sums=this.getters.getAutomaticSums(sheetId,mainSelectedZone,this.getters.getPosition());if(this.getters.isSingleCellOrMerge(sheetId,mainSelectedZone)||(this.getters.isEmpty(sheetId,mainSelectedZone)&&sums.length<=1)){const zone=(_a=sums[0])===null||_a===void 0?void 0:_a.zone;const zoneXc=zone?this.getters.zoneToXC(sheetId,sums[0].zone):"";const formula=`=SUM(${zoneXc})`;this.trigger("composer-cell-focused",{content:formula,selection:{start:5,end:5+zoneXc.length},});}
else{this.dispatch("SUM_SELECTION");}},"CTRL+HOME":()=>{const sheet=this.getters.getActiveSheet();const[col,row]=getNextVisibleCellCoords(sheet,0,0);this.dispatch("SELECT_CELL",{col,row});},"CTRL+END":()=>{const sheet=this.getters.getActiveSheet();const col=findVisibleHeader(sheet,"cols",range(0,sheet.cols.length).reverse());const row=findVisibleHeader(sheet,"rows",range(0,sheet.rows.length).reverse());this.dispatch("SELECT_CELL",{col,row});},"SHIFT+ ":()=>{const{cols}=this.getters.getActiveSheet();const newZone={...this.getters.getSelectedZone(),left:0,right:cols.length-1};this.dispatch("SET_SELECTION",{anchor:this.getters.getPosition(),zones:[newZone],anchorZone:newZone,});},"CTRL+ ":()=>{const{rows}=this.getters.getActiveSheet();const newZone={...this.getters.getSelectedZone(),top:0,bottom:rows.length-1};this.dispatch("SET_SELECTION",{anchor:this.getters.getPosition(),zones:[newZone],anchorZone:newZone,});},"CTRL+SHIFT+ ":()=>{this.dispatch("SELECT_ALL");},"SHIFT+PAGEDOWN":()=>{this.dispatch("ACTIVATE_NEXT_SHEET");},"SHIFT+PAGEUP":()=>{this.dispatch("ACTIVATE_PREVIOUS_SHEET");},};this.vScrollbar=new ScrollBar(this.vScrollbarRef.el,"vertical");this.hScrollbar=new ScrollBar(this.hScrollbarRef.el,"horizontal");useTouchMove(this.moveCanvas.bind(this),()=>this.vScrollbar.scroll>0);}
get errorTooltip(){const{col,row}=this.hoveredCell;if(col===undefined||row===undefined){return{isOpen:false};}
const sheetId=this.getters.getActiveSheetId();const[mainCol,mainRow]=this.getters.getMainCell(sheetId,col,row);const cell=this.getters.getCell(sheetId,mainCol,mainRow);if(cell&&cell.evaluated.type===CellValueType.error){const viewport=this.getters.getActiveSnappedViewport();const[x,y,width]=this.getters.getRect({left:col,top:row,right:col,bottom:row},viewport);return{isOpen:true,position:{x:x+width,y:y+TOPBAR_HEIGHT},text:cell.evaluated.error,};}
return{isOpen:false};}
get activeCellPosition(){const[col,row]=this.getters.getMainCell(this.getters.getActiveSheetId(),...this.getters.getPosition());return{col,row};}
get shouldDisplayLink(){const sheetId=this.getters.getActiveSheetId();const{col,row}=this.activeCellPosition;const viewport=this.getters.getActiveSnappedViewport();const cell=this.getters.getCell(sheetId,col,row);return(this.getters.isVisibleInViewport(col,row,viewport)&&!!cell&&cell.isLink()&&!this.menuState.isOpen&&!this.props.linkEditorIsOpen&&!this.props.sidePanelIsOpen);}
get popoverPosition(){const[col,row]=this.getters.getBottomLeftCell(this.getters.getActiveSheetId(),...this.getters.getPosition());const viewport=this.getters.getActiveSnappedViewport();const[x,y,width,height]=this.getters.getRect({left:col,top:row,right:col,bottom:row},viewport);return{position:{x,y:y+height+TOPBAR_HEIGHT},cellWidth:width,cellHeight:height,};}
mounted(){this.vScrollbar.el=this.vScrollbarRef.el;this.hScrollbar.el=this.hScrollbarRef.el;this.focus();this.resizeGrid();this.drawGrid();}
patched(){this.resizeGrid();this.drawGrid();}
focus(){if(!this.getters.isSelectingForComposer()&&!this.getters.getSelectedFigureId()){this.canvas.el.focus();}}
resizeGrid(){const currentHeight=this.el.clientHeight-SCROLLBAR_WIDTH$1;const currentWidth=this.el.clientWidth-SCROLLBAR_WIDTH$1;const{height:viewportHeight,width:viewportWidth}=this.getters.getViewportDimension();if(currentHeight!=viewportHeight||currentWidth!==viewportWidth){this.dispatch("RESIZE_VIEWPORT",{height:currentHeight,width:currentWidth,});}}
onScroll(){const{offsetX,offsetY}=this.getters.getActiveViewport();if(offsetX!==this.hScrollbar.scroll||offsetY!==this.vScrollbar.scroll){const{maxOffsetX,maxOffsetY}=this.getters.getMaximumViewportOffset(this.getters.getActiveSheet());this.dispatch("SET_VIEWPORT_OFFSET",{offsetX:Math.min(this.hScrollbar.scroll,maxOffsetX),offsetY:Math.min(this.vScrollbar.scroll,maxOffsetY),});}}
checkSheetChanges(){const currentSheet=this.getters.getActiveSheetId();if(currentSheet!==this.currentSheet){this.focus();this.currentSheet=currentSheet;}}
getAutofillPosition(){const zone=this.getters.getSelectedZone();const sheet=this.getters.getActiveSheet();const{offsetX,offsetY}=this.getters.getActiveSnappedViewport();return{left:sheet.cols[zone.right].end-AUTOFILL_EDGE_LENGTH/2+HEADER_WIDTH-offsetX,top:sheet.rows[zone.bottom].end-AUTOFILL_EDGE_LENGTH/2+HEADER_HEIGHT-offsetY,};}
drawGrid(){const{offsetX,offsetY}=this.getters.getActiveViewport();this.hScrollbar.scroll=offsetX;this.vScrollbar.scroll=offsetY;this.checkSheetChanges();const canvas=this.canvas.el;const dpr=window.devicePixelRatio||1;const ctx=canvas.getContext("2d",{alpha:false});const thinLineWidth=0.4*dpr;const renderingContext={ctx,viewport:this.getters.getActiveViewport(),dpr,thinLineWidth,};const{width,height}=this.getters.getViewportDimension();canvas.style.width=`${width}px`;canvas.style.height=`${height}px`;canvas.width=width*dpr;canvas.height=height*dpr;canvas.setAttribute("style",`width:${width}px;height:${height}px;`);ctx.translate(-0.5,-0.5);ctx.scale(dpr,dpr);this.props.model.drawGrid(renderingContext);}
moveCanvas(deltaX,deltaY){this.vScrollbar.scroll=this.vScrollbar.scroll+deltaY;this.hScrollbar.scroll=this.hScrollbar.scroll+deltaX;this.dispatch("SET_VIEWPORT_OFFSET",{offsetX:this.hScrollbar.scroll,offsetY:this.vScrollbar.scroll,});}
getClientPositionKey(client){var _a,_b,_c;return`${client.id}-${(_a = client.position) === null || _a === void 0 ? void 0 : _a.sheetId}-${(_b = client.position) === null || _b === void 0 ? void 0 : _b.col}-${(_c = client.position) === null || _c === void 0 ? void 0 : _c.row}`;}
onMouseWheel(ev){if(ev.ctrlKey){return;}
function normalize(val){return val*(ev.deltaMode===0?1:DEFAULT_CELL_HEIGHT);}
const deltaX=ev.shiftKey?ev.deltaY:ev.deltaX;const deltaY=ev.shiftKey?ev.deltaX:ev.deltaY;this.moveCanvas(normalize(deltaX),normalize(deltaY));}
isCellHovered(col,row){return this.hoveredCell.col===col&&this.hoveredCell.row===row;}
getCoordinates(ev){const rect=this.el.getBoundingClientRect();const x=ev.pageX-rect.left;const y=ev.pageY-rect.top;return[x,y];}
getCartesianCoordinates(ev){const[x,y]=this.getCoordinates(ev);const{left,top}=this.getters.getActiveSnappedViewport();const colIndex=this.getters.getColIndex(x,left);const rowIndex=this.getters.getRowIndex(y,top);return[colIndex,rowIndex];}
onMouseDown(ev){if(ev.button>0){return;}
const[col,row]=this.getCartesianCoordinates(ev);if(col<0||row<0){return;}
this.clickedCol=col;this.clickedRow=row;const sheetId=this.getters.getActiveSheetId();const[mainCol,mainRow]=this.getters.getMainCell(sheetId,col,row);const cell=this.getters.getCell(sheetId,mainCol,mainRow);if(!(cell===null||cell===void 0?void 0:cell.isLink())){this.closeLinkEditor();}
this.dispatch(ev.ctrlKey?"START_SELECTION_EXPANSION":"START_SELECTION");if(ev.shiftKey){this.dispatch("ALTER_SELECTION",{cell:[col,row]});}
else{this.dispatch("SELECT_CELL",{col,row});this.checkSheetChanges();}
let prevCol=col;let prevRow=row;let isEdgeScrolling=false;let timeOutId=null;let timeoutDelay=0;let currentEv;const sheet=this.getters.getActiveSheet();const onMouseMove=(ev)=>{currentEv=ev;if(timeOutId){return;}
const[x,y]=this.getCoordinates(currentEv);isEdgeScrolling=false;timeoutDelay=0;const colEdgeScroll=this.getters.getEdgeScrollCol(x);const rowEdgeScroll=this.getters.getEdgeScrollRow(y);const{left,right,top,bottom}=this.getters.getActiveSnappedViewport();let col,row;if(colEdgeScroll.canEdgeScroll){col=colEdgeScroll.direction>0?right:left-1;}
else{col=this.getters.getColIndex(x,left);col=col===-1?prevCol:col;}
if(rowEdgeScroll.canEdgeScroll){row=rowEdgeScroll.direction>0?bottom:top-1;}
else{row=this.getters.getRowIndex(y,top);row=row===-1?prevRow:row;}
isEdgeScrolling=colEdgeScroll.canEdgeScroll||rowEdgeScroll.canEdgeScroll;timeoutDelay=Math.min(colEdgeScroll.canEdgeScroll?colEdgeScroll.delay:MAX_DELAY,rowEdgeScroll.canEdgeScroll?rowEdgeScroll.delay:MAX_DELAY);if(col!==prevCol||row!==prevRow){prevCol=col;prevRow=row;this.dispatch("ALTER_SELECTION",{cell:[col,row]});}
if(isEdgeScrolling){const offsetX=sheet.cols[left+colEdgeScroll.direction].start;const offsetY=sheet.rows[top+rowEdgeScroll.direction].start;this.dispatch("SET_VIEWPORT_OFFSET",{offsetX,offsetY});timeOutId=setTimeout(()=>{timeOutId=null;onMouseMove(currentEv);},Math.round(timeoutDelay));}};const onMouseUp=(ev)=>{clearTimeout(timeOutId);this.dispatch(ev.ctrlKey?"PREPARE_SELECTION_EXPANSION":"STOP_SELECTION");this.canvas.el.removeEventListener("mousemove",onMouseMove);if(this.getters.isPaintingFormat()){this.dispatch("PASTE",{target:this.getters.getSelectedZones(),});}};startDnd(onMouseMove,onMouseUp);}
onDoubleClick(ev){const[col,row]=this.getCartesianCoordinates(ev);if(this.clickedCol===col&&this.clickedRow===row){const cell=this.getters.getActiveCell();!cell||cell.isEmpty()?this.trigger("composer-cell-focused"):this.trigger("composer-content-focused");}}
closeLinkEditor(){this.trigger("link-editor-closed");}
processTabKey(ev){ev.preventDefault();const deltaX=ev.shiftKey?-1:1;this.dispatch("MOVE_POSITION",{deltaX,deltaY:0});}
processArrows(ev){ev.preventDefault();ev.stopPropagation();this.closeLinkEditor();const deltaMap={ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0],ArrowUp:[0,-1],};const delta=deltaMap[ev.key];if(ev.shiftKey){const oldZone=this.getters.getSelectedZone();this.dispatch("ALTER_SELECTION",{delta});const newZone=this.getters.getSelectedZone();const viewport=this.getters.getActiveSnappedViewport();const sheet=this.getters.getActiveSheet();const[col,row]=findCellInNewZone(oldZone,newZone,viewport);const{left,right,top,bottom,offsetX,offsetY}=viewport;const newOffsetX=col<left||col>right-1?sheet.cols[left+delta[0]].start:offsetX;const newOffsetY=row<top||row>bottom-1?sheet.rows[top+delta[1]].start:offsetY;if(newOffsetX!==offsetX||newOffsetY!==offsetY){this.dispatch("SET_VIEWPORT_OFFSET",{offsetX:newOffsetX,offsetY:newOffsetY});}}
else{this.dispatch("MOVE_POSITION",{deltaX:delta[0],deltaY:delta[1]});}
if(this.getters.isPaintingFormat()){this.dispatch("PASTE",{target:this.getters.getSelectedZones(),});}}
onKeydown(ev){if(ev.key.startsWith("Arrow")){this.processArrows(ev);return;}
let keyDownString="";if(ev.ctrlKey)
keyDownString+="CTRL+";if(ev.metaKey)
keyDownString+="CTRL+";if(ev.altKey)
keyDownString+="ALT+";if(ev.shiftKey)
keyDownString+="SHIFT+";keyDownString+=ev.key.toUpperCase();let handler=this.keyDownMapping[keyDownString];if(handler){ev.preventDefault();ev.stopPropagation();handler();return;}
if(!keyDownMappingIgnore.includes(keyDownString)){if(ev.key.length===1&&!ev.ctrlKey&&!ev.metaKey&&!ev.altKey){ev.preventDefault();ev.stopPropagation();this.trigger("composer-cell-focused",{content:ev.key});}}}
onCanvasContextMenu(ev){ev.preventDefault();const[col,row]=this.getCartesianCoordinates(ev);if(col<0||row<0){return;}
const zones=this.getters.getSelectedZones();const lastZone=zones[zones.length-1];let type="CELL";if(!isInside(col,row,lastZone)){this.dispatch("STOP_EDITION");this.dispatch("SELECT_CELL",{col,row});}
else{if(this.getters.getActiveCols().has(col)){type="COL";}
else if(this.getters.getActiveRows().has(row)){type="ROW";}}
this.toggleContextMenu(type,ev.offsetX,ev.offsetY);}
onOverlayContextMenu(ev){const type=ev.detail.type;const x=ev.detail.x;const y=ev.detail.y;this.toggleContextMenu(type,x,y);}
toggleContextMenu(type,x,y){this.closeLinkEditor();this.menuState.isOpen=true;this.menuState.position={x,y:y+TOPBAR_HEIGHT};this.menuState.menuItems=registries$1[type].getAll().filter((item)=>!item.isVisible||item.isVisible(this.env));}}
Grid.template=TEMPLATE$2;Grid.style=CSS$2;Grid.components={GridComposer,Overlay,Menu,Autofill,FiguresContainer,ClientTag,Highlight,ErrorToolTip,LinkDisplay,LinkEditor,Popover,};const{Component:Component$2}=owl__namespace;const{xml:xml$2,css:css$2}=owl__namespace.tags;const{useState:useState$2}=owl__namespace.hooks;const TEMPLATE$1=xml$2`
  <div class="o-sidePanel" >
    <div class="o-sidePanelHeader">
        <div class="o-sidePanelTitle" t-esc="getTitle()"/>
        <div class="o-sidePanelClose" t-on-click="trigger('close-side-panel')">×</div>
    </div>
    <div class="o-sidePanelBody">
      <t t-component="state.panel.Body" t-props="props.panelProps" t-key="'Body_' + props.component"/>
    </div>
    <div class="o-sidePanelFooter" t-if="state.panel.Footer">
      <t t-component="state.panel.Footer" t-props="props.panelProps" t-key="'Footer_' + props.component"/>
    </div>
  </div>`;const CSS$1=css$2`
  .o-sidePanel {
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
    background-color: white;
    border: 1px solid darkgray;
    .o-sidePanelHeader {
      padding: 6px;
      height: 30px;
      background-color: ${BACKGROUND_HEADER_COLOR};
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid darkgray;
      border-top: 1px solid darkgray;
      font-weight: bold;
      .o-sidePanelTitle {
        font-weight: bold;
        padding: 5px 10px;
        color: dimgrey;
      }
      .o-sidePanelClose {
        font-size: 1.5rem;
        padding: 5px 10px;
        cursor: pointer;
        &:hover {
          background-color: WhiteSmoke;
        }
      }
    }
    .o-sidePanelBody {
      overflow: auto;
      width: 100%;
      height: 100%;

      .o-section {
        padding: 16px;

        .o-section-title {
          font-weight: bold;
          color: dimgrey;
          margin-bottom: 5px;
        }
      }
    }

    .o-sidepanel-error {
      color: red;
      margin-top: 10px;
    }

    .o-sidePanelButtons {
      padding: 16px;
      text-align: right;
      .o-sidePanelButton {
        border: 1px solid lightgrey;
        padding: 0px 20px 0px 20px;
        border-radius: 4px;
        font-weight: 500;
        font-size: 14px;
        height: 30px;
        line-height: 16px;
        background: white;
        margin-right: 8px;
        &:hover:enabled {
          background-color: rgba(0, 0, 0, 0.08);
        }
      }
      .o-sidePanelButton:enabled {
        cursor: pointer;
      }
      .o-sidePanelButton:last-child {
        margin-right: 0px;
      }
    }
    .o-input {
      color: #666666;
      border-radius: 4px;
      min-width: 0px;
      padding: 4px 6px;
      box-sizing: border-box;
      line-height: 1;
      width: 100%;
      .o-type-selector {
        background-position: right 5px top 11px;
      }
    }
    input.o-required {
      border-color: #4c4c4c;
    }
    input.o-invalid {
      border-color: red;
    }
    select.o-input {
      background-color: white;
      text-align: left;
    }
  }
`;class SidePanel extends Component$2{constructor(){super(...arguments);this.state=useState$2({panel:sidePanelRegistry.get(this.props.component),});}
async willUpdateProps(nextProps){this.state.panel=sidePanelRegistry.get(nextProps.component);}
getTitle(){return typeof this.state.panel.title==="function"?this.state.panel.title(this.env):this.state.panel.title;}}
SidePanel.template=TEMPLATE$1;SidePanel.style=CSS$1;const{Component:Component$1,useState:useState$1,hooks}=owl__namespace;const{xml:xml$1,css:css$1}=owl__namespace.tags;const{useExternalListener:useExternalListener$1,useRef:useRef$1}=hooks;const FORMATS=[{name:"general",text:"General (no specific format)"},{name:"number",text:"Number (1,000.12)",value:"#,##0.00"},{name:"percent",text:"Percent (10.12%)",value:"0.00%"},{name:"date",text:"Date (9/26/2008)",value:"m/d/yyyy"},{name:"time",text:"Time (10:43:00 PM)",value:"hh:mm:ss a"},{name:"datetime",text:"Date time (9/26/2008 22:43:00)",value:"m/d/yyyy hh:mm:ss"},{name:"duration",text:"Duration (27:51:38)",value:"hhhh:mm:ss"},];class TopBar extends Component$1{constructor(){super(...arguments);this.formats=FORMATS;this.currentFormat="general";this.fontSizes=fontSizes;this.dispatch=this.env.dispatch;this.getters=this.env.getters;this.style={};this.state=useState$1({menuState:{isOpen:false,position:null,menuItems:[]},activeTool:"",});this.isSelectingMenu=false;this.openedEl=null;this.inMerge=false;this.cannotMerge=false;this.undoTool=false;this.redoTool=false;this.paintFormatTool=false;this.fillColor="white";this.textColor="black";this.menus=[];this.menuRef=useRef$1("menuRef");this.composerStyle=`
    line-height: 34px;
    padding-left: 8px;
    height: 34px;
    background-color: white;
  `;useExternalListener$1(window,"click",this.onClick);}
get topbarComponents(){return topbarComponentRegistry.getAll().filter((item)=>!item.isVisible||item.isVisible(this.env));}
async willStart(){this.updateCellState();}
async willUpdateProps(){this.updateCellState();}
onClick(ev){if(this.openedEl&&isChildEvent(this.openedEl,ev)){return;}
this.closeMenus();}
toogleStyle(style){setStyle(this.env,{[style]:!this.style[style]});}
toogleFormat(format){const formatter=FORMATS.find((f)=>f.name===format);const value=(formatter&&formatter.value)||"";setFormatter(this.env,value);}
toggleAlign(align){setStyle(this.env,{["align"]:align});}
onMenuMouseOver(menu,ev){if(this.isSelectingMenu){this.toggleContextMenu(menu,ev);}}
toggleDropdownTool(tool,ev){const isOpen=this.state.activeTool===tool;this.closeMenus();this.state.activeTool=isOpen?"":tool;this.openedEl=isOpen?null:ev.target;}
toggleContextMenu(menu,ev){this.closeMenus();const x=ev.target.offsetLeft;const y=ev.target.clientHeight+ev.target.offsetTop;this.state.menuState.isOpen=true;this.state.menuState.position={x,y};this.state.menuState.menuItems=topbarMenuRegistry.getChildren(menu,this.env).filter((item)=>!item.isVisible||item.isVisible(this.env));this.isSelectingMenu=true;this.openedEl=ev.target;}
closeMenus(){this.state.activeTool="";this.state.menuState.isOpen=false;this.isSelectingMenu=false;this.openedEl=null;if(this.menuRef.comp){this.menuRef.comp.closeSubMenus();}}
updateCellState(){this.style=this.getters.getCurrentStyle();this.fillColor=this.style.fillColor||"white";this.textColor=this.style.textColor||"black";const zones=this.getters.getSelectedZones();const{top,left,right,bottom}=zones[0];this.cannotMerge=zones.length>1||(top===bottom&&left===right);this.inMerge=false;if(!this.cannotMerge){const[col,row]=this.getters.getPosition();const zone=this.getters.expandZone(this.getters.getActiveSheetId(),{left:col,right:col,top:row,bottom:row,});this.inMerge=isEqual(zones[0],zone);}
this.undoTool=this.getters.canUndo();this.redoTool=this.getters.canRedo();this.paintFormatTool=this.getters.isPaintingFormat();const cell=this.getters.getActiveCell();if(cell&&cell.format){const format=this.formats.find((f)=>f.value===cell.format);this.currentFormat=format?format.name:"";}
else{this.currentFormat="general";}
this.menus=topbarMenuRegistry.getAll().filter((item)=>!item.isVisible||item.isVisible(this.env));}
getMenuName(menu){return topbarMenuRegistry.getName(menu,this.env);}
toggleMerge(){const zones=this.getters.getSelectedZones();const target=[zones[zones.length-1]];const sheet=this.getters.getActiveSheetId();if(this.inMerge){this.dispatch("REMOVE_MERGE",{sheetId:sheet,target});}
else{this.dispatch("ADD_MERGE",{sheetId:sheet,target,interactive:true});}}
setColor(target,ev){setStyle(this.env,{[target]:ev.detail.color});}
setBorder(command){this.dispatch("SET_FORMATTING",{sheetId:this.getters.getActiveSheetId(),target:this.getters.getSelectedZones(),border:command,});}
setFormat(ev){const format=ev.target.dataset.format;if(format){this.toogleFormat(format);}}
setDecimal(step){this.dispatch("SET_DECIMAL",{sheetId:this.getters.getActiveSheetId(),target:this.getters.getSelectedZones(),step:step,});}
paintFormat(){this.dispatch("ACTIVATE_PAINT_FORMAT",{target:this.getters.getSelectedZones(),});}
clearFormatting(){this.dispatch("CLEAR_FORMATTING",{sheetId:this.getters.getActiveSheetId(),target:this.getters.getSelectedZones(),});}
setSize(ev){const fontSize=parseFloat(ev.target.dataset.size);setStyle(this.env,{fontSize});}
doAction(action){action(this.env);this.closeMenus();}
undo(){this.dispatch("REQUEST_UNDO");}
redo(){this.dispatch("REQUEST_REDO");}}
TopBar.template=xml$1`
    <div class="o-spreadsheet-topbar">
      <div class="o-topbar-top">
        <!-- Menus -->
        <div class="o-topbar-topleft">
          <t t-foreach="menus" t-as="menu" t-key="menu_index">
            <div t-if="menu.children.length !== 0"
              class="o-topbar-menu"
              t-on-click="toggleContextMenu(menu)"
              t-on-mouseover="onMenuMouseOver(menu)"
              t-att-data-id="menu.id">
            <t t-esc="getMenuName(menu)"/>
          </div>
          </t>
          <Menu t-if="state.menuState.isOpen"
                position="state.menuState.position"
                menuItems="state.menuState.menuItems"
                t-ref="menuRef"
                t-on-close="state.menuState.isOpen=false"/>
        </div>
        <div class="o-topbar-topright">
          <div t-foreach="topbarComponents" t-as="comp" t-key="comp_index">
            <t t-component="comp.component"/>
          </div>
        </div>
      </div>
      <!-- Toolbar and Cell Content -->
      <div class="o-topbar-toolbar">
        <!-- Toolbar -->
        <div t-if="getters.isReadonly()" class="o-readonly-toolbar text-muted">
          <span>
            <i class="fa fa-eye" /> <t t-esc="env._t('Readonly Access')" />
          </span>
        </div>
        <div t-else="" class="o-toolbar-tools">
          <div class="o-tool" title="Undo" t-att-class="{'o-disabled': !undoTool}" t-on-click="undo" >${UNDO_ICON}</div>
          <div class="o-tool" t-att-class="{'o-disabled': !redoTool}" title="Redo"  t-on-click="redo">${REDO_ICON}</div>
          <div class="o-tool" title="Paint Format" t-att-class="{active:paintFormatTool}" t-on-click="paintFormat">${PAINT_FORMAT_ICON}</div>
          <div class="o-tool" title="Clear Format" t-on-click="clearFormatting()">${CLEAR_FORMAT_ICON}</div>
          <div class="o-divider"/>
          <div class="o-tool" title="Format as percent" t-on-click="toogleFormat('percent')">%</div>
          <div class="o-tool" title="Decrease decimal places" t-on-click="setDecimal(-1)">.0</div>
          <div class="o-tool" title="Increase decimal places" t-on-click="setDecimal(+1)">.00</div>
          <div class="o-tool o-dropdown" title="More formats" t-on-click="toggleDropdownTool('formatTool')">
            <div class="o-text-icon">123${TRIANGLE_DOWN_ICON}</div>
            <div class="o-dropdown-content o-text-options  o-format-tool "  t-if="state.activeTool === 'formatTool'" t-on-click="setFormat">
              <t t-foreach="formats" t-as="format" t-key="format.name">
                <div t-att-data-format="format.name" t-att-class="{active: currentFormat === format.name}"><t t-esc="format.text"/></div>
              </t>
            </div>
          </div>
          <div class="o-divider"/>
          <!-- <div class="o-tool" title="Font"><span>Roboto</span> ${TRIANGLE_DOWN_ICON}</div> -->
          <div class="o-tool o-dropdown" title="Font Size" t-on-click="toggleDropdownTool('fontSizeTool')">
            <div class="o-text-icon"><t t-esc="style.fontSize || ${DEFAULT_FONT_SIZE}"/> ${TRIANGLE_DOWN_ICON}</div>
            <div class="o-dropdown-content o-text-options "  t-if="state.activeTool === 'fontSizeTool'" t-on-click="setSize">
              <t t-foreach="fontSizes" t-as="font" t-key="font_index">
                <div t-esc="font.pt" t-att-data-size="font.pt"/>
              </t>
            </div>
          </div>
          <div class="o-divider"/>
          <div class="o-tool" title="Bold" t-att-class="{active:style.bold}" t-on-click="toogleStyle('bold')">${BOLD_ICON}</div>
          <div class="o-tool" title="Italic" t-att-class="{active:style.italic}" t-on-click="toogleStyle('italic')">${ITALIC_ICON}</div>
          <div class="o-tool" title="Strikethrough"  t-att-class="{active:style.strikethrough}" t-on-click="toogleStyle('strikethrough')">${STRIKE_ICON}</div>
          <div class="o-tool o-dropdown o-with-color">
            <span t-attf-style="border-color:{{textColor}}" title="Text Color" t-on-click="toggleDropdownTool('textColorTool')">${TEXT_COLOR_ICON}</span>
            <ColorPicker t-if="state.activeTool === 'textColorTool'" t-on-color-picked="setColor('textColor')" t-key="textColor"/>
          </div>
          <div class="o-divider"/>
          <div class="o-tool  o-dropdown o-with-color">
            <span t-attf-style="border-color:{{fillColor}}" title="Fill Color" t-on-click="toggleDropdownTool('fillColorTool')">${FILL_COLOR_ICON}</span>
            <ColorPicker t-if="state.activeTool === 'fillColorTool'" t-on-color-picked="setColor('fillColor')" t-key="fillColor"/>
          </div>
          <div class="o-tool o-dropdown">
            <span title="Borders" t-on-click="toggleDropdownTool('borderTool')">${BORDERS_ICON}</span>
            <div class="o-dropdown-content o-border" t-if="state.activeTool === 'borderTool'">
              <div class="o-dropdown-line">
                <span class="o-line-item" t-on-click="setBorder('all')">${BORDERS_ICON}</span>
                <span class="o-line-item" t-on-click="setBorder('hv')">${BORDER_HV}</span>
                <span class="o-line-item" t-on-click="setBorder('h')">${BORDER_H}</span>
                <span class="o-line-item" t-on-click="setBorder('v')">${BORDER_V}</span>
                <span class="o-line-item" t-on-click="setBorder('external')">${BORDER_EXTERNAL}</span>
              </div>
              <div class="o-dropdown-line">
                <span class="o-line-item" t-on-click="setBorder('left')">${BORDER_LEFT}</span>
                <span class="o-line-item" t-on-click="setBorder('top')">${BORDER_TOP}</span>
                <span class="o-line-item" t-on-click="setBorder('right')">${BORDER_RIGHT}</span>
                <span class="o-line-item" t-on-click="setBorder('bottom')">${BORDER_BOTTOM}</span>
                <span class="o-line-item" t-on-click="setBorder('clear')">${BORDER_CLEAR}</span>
              </div>
            </div>
          </div>
          <div class="o-tool" title="Merge Cells"  t-att-class="{active:inMerge, 'o-disabled': cannotMerge}" t-on-click="toggleMerge">${MERGE_CELL_ICON}</div>
          <div class="o-divider"/>
          <div class="o-tool o-dropdown" title="Horizontal align" t-on-click="toggleDropdownTool('alignTool')">
            <span>
              <t t-if="style.align === 'right'">${ALIGN_RIGHT_ICON}</t>
              <t t-elif="style.align === 'center'">${ALIGN_CENTER_ICON}</t>
              <t t-else="">${ALIGN_LEFT_ICON}</t>
              ${TRIANGLE_DOWN_ICON}
            </span>
            <div t-if="state.activeTool === 'alignTool'" class="o-dropdown-content">
              <div class="o-dropdown-item" t-on-click="toggleAlign('left')">${ALIGN_LEFT_ICON}</div>
              <div class="o-dropdown-item" t-on-click="toggleAlign('center')">${ALIGN_CENTER_ICON}</div>
              <div class="o-dropdown-item" t-on-click="toggleAlign('right')">${ALIGN_RIGHT_ICON}</div>
            </div>
          </div>
          <!-- <div class="o-tool" title="Vertical align"><span>${ALIGN_MIDDLE_ICON}</span> ${TRIANGLE_DOWN_ICON}</div> -->
          <!-- <div class="o-tool" title="Text Wrapping">${TEXT_WRAPPING_ICON}</div> -->
        </div>
        <Composer inputStyle="composerStyle" focus="props.focusComposer"/>

      </div>
    </div>`;TopBar.style=css$1`
    .o-spreadsheet-topbar {
      background-color: white;
      line-height: 1.2;
      display: flex;
      flex-direction: column;
      font-size: 13px;
      line-height: 1.2;
      user-select: none;

      .o-topbar-top {
        border-bottom: 1px solid #e0e2e4;
        display: flex;
        padding: 2px 10px;
        justify-content: space-between;

        /* Menus */
        .o-topbar-topleft {
          display: flex;
          .o-topbar-menu {
            padding: 4px 6px;
            margin: 0 2px;
            cursor: pointer;
          }

          .o-topbar-menu:hover {
            background-color: #f1f3f4;
            border-radius: 2px;
          }
        }

        .o-topbar-topright {
          display: flex;
          justify-content: flex-end;
        }
      }
      /* Toolbar + Cell Content */
      .o-topbar-toolbar {
        border-bottom: 1px solid #e0e2e4;
        display: flex;

        .o-readonly-toolbar {
          display: flex;
          align-items: center;
          background-color: ${BACKGROUND_HEADER_COLOR};
          padding-left: 18px;
          padding-right: 18px;
        }
        .o-composer-container {
          height: 34px;
          border: 1px solid #e0e2e4;
          margin-top: -1px;
          margin-bottom: -1px;
        }

        /* Toolbar */
        .o-toolbar-tools {
          display: flex;
          flex-shrink: 0;
          margin-left: 16px;
          color: #333;
          cursor: default;

          .o-tool {
            display: flex;
            align-items: center;
            margin: 2px;
            padding: 0 3px;
            border-radius: 2px;
            cursor: pointer;
            min-width: fit-content;
          }

          .o-tool.active,
          .o-tool:not(.o-disabled):hover {
            background-color: #f1f3f4;
          }

          .o-with-color > span {
            border-bottom: 4px solid;
            height: 16px;
            margin-top: 2px;
          }

          .o-with-color {
            .o-line-item:hover {
              outline: 1px solid gray;
            }
          }

          .o-border {
            .o-line-item {
              padding: 4px;
              margin: 1px;
            }
          }

          .o-divider {
            display: inline-block;
            border-right: 1px solid #e0e2e4;
            width: 0;
            margin: 0 6px;
          }

          .o-disabled {
            opacity: 0.6;
          }

          .o-dropdown {
            position: relative;

            .o-text-icon {
              height: 100%;
              line-height: 30px;
            }

            .o-text-options > div {
              line-height: 26px;
              padding: 3px 12px;
              &:hover {
                background-color: rgba(0, 0, 0, 0.08);
              }
            }

            .o-dropdown-content {
              position: absolute;
              top: calc(100% + 5px);
              left: 0;
              z-index: 10;
              box-shadow: 1px 2px 5px 2px rgba(51, 51, 51, 0.15);
              background-color: white;

              .o-dropdown-item {
                padding: 7px 10px;
              }

              .o-dropdown-item:hover {
                background-color: rgba(0, 0, 0, 0.08);
              }

              .o-dropdown-line {
                display: flex;
                padding: 3px 6px;

                .o-line-item {
                  width: 16px;
                  height: 16px;
                  margin: 1px 3px;

                  &:hover {
                    background-color: rgba(0, 0, 0, 0.08);
                  }
                }
              }

              &.o-format-tool {
                width: 180px;
                padding: 7px 0;
                > div {
                  padding-left: 25px;

                  &.active:before {
                    content: "✓";
                    font-weight: bold;
                    position: absolute;
                    left: 10px;
                  }
                }
              }
            }
          }
        }

        /* Cell Content */
        .o-toolbar-cell-content {
          font-size: 12px;
          font-weight: 500;
          padding: 0 12px;
          margin: 0;
          line-height: 34px;
          white-space: nowrap;
          user-select: text;
        }
      }
    }
  `;TopBar.components={ColorPicker,Menu,Composer};const{Component,useState}=owl__namespace;const{useRef,useExternalListener}=owl__namespace.hooks;const{xml,css}=owl__namespace.tags;const{useSubEnv}=owl__namespace.hooks;const TEMPLATE=xml`
  <div class="o-spreadsheet" t-on-save-requested="save" t-on-keydown="onKeydown">
  <TopBar
  t-on-click="focusGrid"
  t-on-composer-content-focused="onTopBarComposerFocused"
  focusComposer="focusTopBarComposer"
  class="o-two-columns"/>
    <Grid
      model="model"
      sidePanelIsOpen="sidePanel.isOpen"
      linkEditorIsOpen="linkEditor.isOpen"
      t-on-link-editor-closed="closeLinkEditor"
      t-ref="grid"
      focusComposer="focusGridComposer"
      t-on-composer-content-focused="onGridComposerContentFocused"
      t-on-composer-cell-focused="onGridComposerCellFocused"
      t-att-class="{'o-two-columns': !sidePanel.isOpen}"/>
    <SidePanel t-if="sidePanel.isOpen"
           t-on-close-side-panel="sidePanel.isOpen = false"
           component="sidePanel.component"
           panelProps="sidePanel.panelProps"/>
    <BottomBar t-on-click="focusGrid" class="o-two-columns"/>
  </div>`;const CSS=css`
  .o-spreadsheet {
    position: relative;
    display: grid;
    grid-template-rows: ${TOPBAR_HEIGHT}px auto ${BOTTOMBAR_HEIGHT + 1}px;
    grid-template-columns: auto 350px;
    * {
      font-family: "Roboto", "RobotoDraft", Helvetica, Arial, sans-serif;
    }
    &,
    *,
    *:before,
    *:after {
      box-sizing: content-box;
    }
  }

  .o-two-columns {
    grid-column: 1 / 3;
  }

  .o-icon {
    width: ${ICON_EDGE_LENGTH}px;
    height: ${ICON_EDGE_LENGTH}px;
    opacity: 0.6;
    vertical-align: middle;
  }

  .o-cf-icon {
    width: ${CF_ICON_EDGE_LENGTH}px;
    height: ${CF_ICON_EDGE_LENGTH}px;
    vertical-align: sub;
  }
`;const t=(s)=>s;class Spreadsheet extends Component{constructor(parent,props={}){super(parent,props);this.model=new Model(this.props.data,{notifyUser:(content)=>this.trigger("notify-user",{content}),askConfirmation:(content,confirm,cancel)=>this.trigger("ask-confirmation",{content,confirm,cancel}),editText:(title,placeholder,callback)=>this.trigger("edit-text",{title,placeholder,callback}),openSidePanel:(panel,panelProps={})=>this.openSidePanel(panel,panelProps),evalContext:{env:this.env},transportService:this.props.transportService,client:this.props.client,isReadonly:this.props.isReadonly,snapshotRequested:this.props.snapshotRequested,},this.props.stateUpdateMessages);this.grid=useRef("grid");this.sidePanel=useState({isOpen:false,panelProps:{}});this.linkEditor=useState({isOpen:false});this.composer=useState({topBarFocus:"inactive",gridFocusMode:"inactive",});this.clipBoardString="";this.keyDownMapping={"CTRL+H":()=>this.toggleSidePanel("FindAndReplace",{}),"CTRL+F":()=>this.toggleSidePanel("FindAndReplace",{}),};useSubEnv({openSidePanel:(panel,panelProps={})=>this.openSidePanel(panel,panelProps),toggleSidePanel:(panel,panelProps={})=>this.toggleSidePanel(panel,panelProps),dispatch:this.model.dispatch,getters:this.model.getters,uuidGenerator:this.model.uuidGenerator,_t:Spreadsheet._t,clipboard:navigator.clipboard,export:this.model.exportData.bind(this.model),waitForIdle:this.model.waitForIdle.bind(this.model),exportXLSX:this.model.exportXLSX.bind(this.model),openLinkEditor:()=>this.openLinkEditor(),});useExternalListener(window,"resize",this.render);useExternalListener(document.body,"cut",this.copy.bind(this,true));useExternalListener(document.body,"copy",this.copy.bind(this,false));useExternalListener(document.body,"paste",this.paste);useExternalListener(document.body,"keyup",this.onKeyup.bind(this));useExternalListener(window,"beforeunload",this.leaveCollaborativeSession.bind(this));this.activateFirstSheet();}
get focusTopBarComposer(){return this.model.getters.getEditionMode()==="inactive"?"inactive":this.composer.topBarFocus;}
get focusGridComposer(){return this.model.getters.getEditionMode()==="inactive"?"inactive":this.composer.gridFocusMode;}
mounted(){this.model.on("update",this,this.render);this.model.on("unexpected-revision-id",this,()=>this.trigger("unexpected-revision-id"));if(this.props.client){this.model.joinSession(this.props.client);}}
willUnmount(){this.leaveCollaborativeSession();}
async willUpdateProps(nextProps){if(this.props.isReadonly!==nextProps.isReadonly){this.model.updateReadOnly(nextProps.isReadonly);}}
leaveCollaborativeSession(){this.model.off("update",this);this.model.leaveSession();}
activateFirstSheet(){const sheetId=this.model.getters.getActiveSheetId();const[firstSheet]=this.model.getters.getSheets();if(firstSheet.id!==sheetId){this.model.dispatch("ACTIVATE_SHEET",{sheetIdFrom:sheetId,sheetIdTo:firstSheet.id});}}
destroy(){this.model.destroy();super.destroy();}
openSidePanel(panel,panelProps){this.sidePanel.component=panel;this.sidePanel.panelProps=panelProps;this.sidePanel.isOpen=true;}
openLinkEditor(){this.linkEditor.isOpen=true;}
closeLinkEditor(){this.linkEditor.isOpen=false;this.focusGrid();}
toggleSidePanel(panel,panelProps){if(this.sidePanel.isOpen&&panel===this.sidePanel.component){this.sidePanel.isOpen=false;this.focusGrid();}
else{this.openSidePanel(panel,panelProps);}}
focusGrid(){this.grid.comp.focus();}
copy(cut,ev){if(!this.grid.el.contains(document.activeElement)){return;}
if(this.model.getters.getEditionMode()!=="inactive"){return;}
const type=cut?"CUT":"COPY";const target=this.model.getters.getSelectedZones();this.model.dispatch(type,{target});const content=this.model.getters.getClipboardContent();this.clipBoardString=content;ev.clipboardData.setData("text/plain",content);ev.preventDefault();}
paste(ev){if(!this.grid.el.contains(document.activeElement)){return;}
const clipboardData=ev.clipboardData;if(clipboardData.types.indexOf("text/plain")>-1){const content=clipboardData.getData("text/plain");const target=this.model.getters.getSelectedZones();if(this.clipBoardString===content){this.model.dispatch("PASTE",{target,interactive:true});}
else{this.model.dispatch("PASTE_FROM_OS_CLIPBOARD",{target,text:content,});}}}
save(){this.trigger("save-content",{data:this.model.exportData(),});}
onKeyup(ev){if(ev.key==="Control"&&this.model.getters.getSelectionMode()!==SelectionMode.expanding){this.model.dispatch("STOP_SELECTION");}}
onKeydown(ev){if(ev.key==="Control"&&!ev.repeat){this.model.dispatch(this.model.getters.getSelectionMode()===SelectionMode.idle?"PREPARE_SELECTION_EXPANSION":"START_SELECTION_EXPANSION");}
let keyDownString="";if(ev.ctrlKey||ev.metaKey){keyDownString+="CTRL+";}
keyDownString+=ev.key.toUpperCase();let handler=this.keyDownMapping[keyDownString];if(handler){ev.preventDefault();ev.stopPropagation();handler();return;}}
onTopBarComposerFocused(ev){if(this.model.getters.isReadonly()){return;}
this.composer.topBarFocus="contentFocus";this.composer.gridFocusMode="inactive";this.setComposerContent(ev.detail||{});this.env.dispatch("UNFOCUS_SELECTION_INPUT");}
onGridComposerContentFocused(ev){if(this.model.getters.isReadonly()){return;}
this.composer.topBarFocus="inactive";this.composer.gridFocusMode="contentFocus";this.setComposerContent(ev.detail||{});this.env.dispatch("UNFOCUS_SELECTION_INPUT");}
onGridComposerCellFocused(ev){if(this.model.getters.isReadonly()){return;}
this.composer.topBarFocus="inactive";this.composer.gridFocusMode="cellFocus";this.setComposerContent(ev.detail||{});this.env.dispatch("UNFOCUS_SELECTION_INPUT");}
setComposerContent({content,selection,}){if(this.model.getters.getEditionMode()==="inactive"){this.model.dispatch("START_EDITION",{text:content,selection});}
else if(content){this.model.dispatch("SET_CURRENT_CONTENT",{content,selection});}}}
Spreadsheet.template=TEMPLATE;Spreadsheet.style=CSS;Spreadsheet.components={TopBar,Grid,BottomBar,SidePanel,LinkEditor};Spreadsheet._t=t;const __info__={};const SPREADSHEET_DIMENSIONS={MIN_ROW_HEIGHT,MIN_COL_WIDTH,HEADER_HEIGHT,HEADER_WIDTH,TOPBAR_HEIGHT,BOTTOMBAR_HEIGHT,DEFAULT_CELL_WIDTH,DEFAULT_CELL_HEIGHT,SCROLLBAR_WIDTH:SCROLLBAR_WIDTH$1,};const registries={autofillModifiersRegistry,autofillRulesRegistry,cellMenuRegistry,colMenuRegistry,linkMenuRegistry,functionRegistry,uiPluginRegistry,corePluginRegistry,rowMenuRegistry,sidePanelRegistry,sheetMenuRegistry,topbarMenuRegistry,topbarComponentRegistry,otRegistry,inverseCommandRegistry,cellRegistry,};const cellTypes={LinkCell,};const helpers={args,toBoolean,toNumber,toString,toXC,toZone,toCartesian,numberToLetters,createFullMenuItem,UuidGenerator,formatDecimal,computeTextWidth,isMarkdownLink,parseMarkdownLink,markdownLink,};exports.CorePlugin=CorePlugin;exports.DATETIME_FORMAT=DATETIME_FORMAT;exports.DataSource=DataSource;exports.DispatchResult=DispatchResult;exports.Model=Model;exports.Revision=Revision;exports.SPREADSHEET_DIMENSIONS=SPREADSHEET_DIMENSIONS;exports.Spreadsheet=Spreadsheet;exports.UIPlugin=UIPlugin;exports.__DEBUG__=DEBUG;exports.__info__=__info__;exports.astToFormula=astToFormula;exports.cellTypes=cellTypes;exports.convertAstNodes=convertAstNodes;exports.coreTypes=coreTypes;exports.functionCache=functionCache;exports.helpers=helpers;exports.invalidateEvaluationCommands=invalidateEvaluationCommands;exports.normalize=normalize;exports.parse=parse;exports.readonlyAllowedCommands=readonlyAllowedCommands;exports.registries=registries;exports.setTranslationMethod=setTranslationMethod;Object.defineProperty(exports,'__esModule',{value:true});exports.__info__.version='2.0.0';exports.__info__.date='2022-02-17T10:15:36.425Z';exports.__info__.hash='f05e1b2';})(this.o_spreadsheet=this.o_spreadsheet||{},owl);;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/o_spreadsheet_extended.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_extended',async function(require){'use strict';let __exports={};require("@documents_spreadsheet/js/o_spreadsheet/registries/autofill");require("@documents_spreadsheet/js/o_spreadsheet/registries/filter_component");require("@documents_spreadsheet/js/o_spreadsheet/registries/menu_item_registry");require("@documents_spreadsheet/js/o_spreadsheet/registries/pivot_functions");require("@documents_spreadsheet/js/o_spreadsheet/registries/list_functions");require("@documents_spreadsheet/js/collaborative/operational_transform");const{_t}=require("web.core");const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const PivotPlugin=require("@documents_spreadsheet/js/o_spreadsheet/plugins/core/pivot_plugin")[Symbol.for("default")];const ListPlugin=require("@documents_spreadsheet/js/o_spreadsheet/plugins/core/list_plugin")[Symbol.for("default")];const FiltersPlugin=require("@documents_spreadsheet/js/o_spreadsheet/plugins/core/filters_plugin")[Symbol.for("default")];const PivotStructurePlugin=require("@documents_spreadsheet/js/o_spreadsheet/plugins/ui/pivot_structure_plugin")[Symbol.for("default")];const PivotTemplatePlugin=require("documents_spreadsheet.PivotTemplatePlugin");const PivotAutofillPlugin=require("@documents_spreadsheet/js/o_spreadsheet/plugins/ui/pivot_autofill_plugin")[Symbol.for("default")];const ListStructurePlugin=require("@documents_spreadsheet/js/o_spreadsheet/plugins/ui/list_structure_plugin")[Symbol.for("default")];const IrMenuPlugin=require("@documents_spreadsheet/js/o_spreadsheet/plugins/ui/ir_ui_menu_plugin")[Symbol.for("default")];const PivotSidePanel=require("@documents_spreadsheet/side_panels/pivot/pivot_list_side_panel")[Symbol.for("default")];const ListingAllSidePanel=require("@documents_spreadsheet/side_panels/list/listing_all_side_panel")[Symbol.for("default")];const ListAutofillPlugin=require("@documents_spreadsheet/js/o_spreadsheet/plugins/ui/list_autofill_plugin")[Symbol.for("default")];const FiltersEvaluationPlugin=require("@documents_spreadsheet/js/o_spreadsheet/plugins/ui/filters_evaluation_plugin")[Symbol.for("default")];const{coreTypes,invalidateEvaluationCommands,readonlyAllowedCommands}=spreadsheet;const{corePluginRegistry,uiPluginRegistry,sidePanelRegistry}=spreadsheet.registries;corePluginRegistry.add("odooPivotPlugin",PivotPlugin);corePluginRegistry.add("odooListPlugin",ListPlugin);corePluginRegistry.add("odooFiltersPlugin",FiltersPlugin);uiPluginRegistry.add("odooPivotStructurePlugin",PivotStructurePlugin);uiPluginRegistry.add("odooListStructurePlugin",ListStructurePlugin);uiPluginRegistry.add("odooPivotAutofillPlugin",PivotAutofillPlugin);uiPluginRegistry.add("odooListAutofillPlugin",ListAutofillPlugin);uiPluginRegistry.add("odooPivotTemplatePlugin",PivotTemplatePlugin);uiPluginRegistry.add("odooFiltersEvaluationPlugin",FiltersEvaluationPlugin);uiPluginRegistry.add("odooIrMenuPlugin",IrMenuPlugin);coreTypes.add("ADD_PIVOT");coreTypes.add("ADD_PIVOT_FORMULA");coreTypes.add("ADD_GLOBAL_FILTER");coreTypes.add("EDIT_GLOBAL_FILTER");coreTypes.add("REMOVE_GLOBAL_FILTER");coreTypes.add("ADD_ODOO_LIST");coreTypes.add("ADD_ODOO_LIST_FORMULA");invalidateEvaluationCommands.add("ADD_GLOBAL_FILTER");invalidateEvaluationCommands.add("EDIT_GLOBAL_FILTER");invalidateEvaluationCommands.add("REMOVE_GLOBAL_FILTER");invalidateEvaluationCommands.add("SET_GLOBAL_FILTER_VALUE");readonlyAllowedCommands.add("SET_GLOBAL_FILTER_VALUE");readonlyAllowedCommands.add("ADD_PIVOT_DOMAIN");readonlyAllowedCommands.add("ADD_LIST_DOMAIN");sidePanelRegistry.add("PIVOT_PROPERTIES_PANEL",{title:()=>_t("Pivot properties"),Body:PivotSidePanel,});sidePanelRegistry.add("LIST_PROPERTIES_PANEL",{title:()=>_t("List properties"),Body:ListingAllSidePanel,});__exports[Symbol.for("default")]=spreadsheet;return __exports;});odoo.define(`documents_spreadsheet.spreadsheet_extended`,async function(require){return require('@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_extended')[Symbol.for("default")];});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/o_spreadsheet_loader.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader',async function(require){'use strict';let __exports={};const{_t}=require("@web/core/l10n/translation");window.o_spreadsheet.setTranslationMethod(_t);__exports[Symbol.for("default")]=window.o_spreadsheet;return __exports;});odoo.define(`documents_spreadsheet.spreadsheet`,async function(require){return require('@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader')[Symbol.for("default")];});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/plugins/cancelled_reason.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/plugins/cancelled_reason',async function(require){'use strict';let __exports={};__exports[Symbol.for("default")]={Success:0,FilterNotFound:1000,DuplicatedFilterLabel:1001,PivotCacheNotLoaded:1002,InvalidValueTypeCombination:1003,ListIdDuplicated:1004,};return __exports;});odoo.define(`documents_spreadsheet.CommandResult`,async function(require){return require('@documents_spreadsheet/js/o_spreadsheet/plugins/cancelled_reason')[Symbol.for("default")];});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/plugins/core/filters_plugin.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/plugins/core/filters_plugin',async function(require){'use strict';let __exports={};const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const CommandResult=require("@documents_spreadsheet/js/o_spreadsheet/plugins/cancelled_reason")[Symbol.for("default")];const{checkFiltersTypeValueCombination}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/helpers");const{UuidGenerator}=spreadsheet.helpers;const uuidGenerator=new UuidGenerator();const FiltersPlugin=__exports[Symbol.for("default")]=class FiltersPlugin extends spreadsheet.CorePlugin{constructor(){super(...arguments);this.globalFilters={};}
allowDispatch(cmd){switch(cmd.type){case"EDIT_GLOBAL_FILTER":if(!this.getGlobalFilter(cmd.id)){return CommandResult.FilterNotFound;}else if(this._isDuplicatedLabel(cmd.id,cmd.filter.label)){return CommandResult.DuplicatedFilterLabel;}
return checkFiltersTypeValueCombination(cmd.filter.type,cmd.filter.defaultValue);case"REMOVE_GLOBAL_FILTER":if(!this.getGlobalFilter(cmd.id)){return CommandResult.FilterNotFound;}
break;case"ADD_GLOBAL_FILTER":if(this._isDuplicatedLabel(cmd.id,cmd.filter.label)){return CommandResult.DuplicatedFilterLabel;}
return checkFiltersTypeValueCombination(cmd.filter.type,cmd.filter.defaultValue);}
return CommandResult.Success;}
handle(cmd){switch(cmd.type){case"ADD_GLOBAL_FILTER":this._addGlobalFilter(cmd.filter);break;case"EDIT_GLOBAL_FILTER":this._editGlobalFilter(cmd.id,cmd.filter);break;case"REMOVE_GLOBAL_FILTER":this._removeGlobalFilter(cmd.id);break;}}
getGlobalFilter(id){return this.globalFilters[id];}
getGlobalFilterFieldPivot(filterId,pivotId){return this.getGlobalFilter(filterId).pivotFields[pivotId];}
getGlobalFilterFieldList(filterId,listId){return this.getGlobalFilter(filterId).listFields[listId];}
getGlobalFilterLabel(label){return this.getGlobalFilters().find((filter)=>filter.label===label);}
getGlobalFilters(){return Object.values(this.globalFilters);}
getGlobalFilterDefaultValue(id){return this.getGlobalFilter(id).defaultValue;}
_addGlobalFilter(filter){const globalFilters={...this.globalFilters};globalFilters[filter.id]=filter;this.history.update("globalFilters",globalFilters);}
_removeGlobalFilter(id){const globalFilters={...this.globalFilters};delete globalFilters[id];this.history.update("globalFilters",globalFilters);}
_editGlobalFilter(id,newFilter){const currentLabel=this.getGlobalFilter(id).label;const globalFilters={...this.globalFilters};newFilter.id=id;globalFilters[id]=newFilter;this.history.update("globalFilters",globalFilters);const newLabel=this.getGlobalFilter(id).label;if(currentLabel!==newLabel){this._updateFilterLabelInFormulas(currentLabel,newLabel);}}
import(data){if(data.globalFilters){for(const globalFilter of data.globalFilters){globalFilter.pivotFields=globalFilter.fields;this.globalFilters[globalFilter.id]=globalFilter;if(!this.globalFilters[globalFilter.id].listFields){this.globalFilters[globalFilter.id].listFields={};}}}}
export(data){data.globalFilters=this.getGlobalFilters().map((filter)=>({...filter,fields:filter.pivotFields,}));}
exportForExcel(data){if(this.getGlobalFilters().length===0){return;}
if(!("getActiveSheetId"in this.getters)){return;}
const styles=Object.entries(data.styles);let titleStyleId=styles.findIndex((el)=>JSON.stringify(el[1])===JSON.stringify({bold:true}))+1;if(titleStyleId<=0){titleStyleId=styles.length+1;data.styles[styles.length+1]={bold:true};}
const cells={};cells["A1"]={content:"Filter",style:titleStyleId};cells["B1"]={content:"Value",style:titleStyleId};let row=2;for(const filter of this.getGlobalFilters()){const content=this.getters.getFilterDisplayValue(filter.label);cells[`A${row}`]={content:filter.label};cells[`B${row}`]={content};row++;}
data.sheets.push({id:uuidGenerator.uuidv4(),name:"Active Filters",cells,colNumber:2,rowNumber:this.getGlobalFilters().length+1,cols:{},rows:{},merges:[],figures:[],conditionalFormats:[],charts:[],});}
_updateFilterLabelInFormulas(currentLabel,newLabel){const sheets=this.getters.getSheets();for(let sheet of sheets){for(let cell of Object.values(this.getters.getCells(sheet.id))){if(cell.isFormula()){const newContent=cell.content.replace(new RegExp(`FILTER\\.VALUE\\(\\s*"${currentLabel}"\\s*\\)`,"g"),`FILTER.VALUE("${newLabel}")`);if(newContent!==cell.content){const{col,row}=this.getters.getCellPosition(cell.id);this.dispatch("UPDATE_CELL",{sheetId:sheet.id,content:newContent,col,row,});}}}}}
_isDuplicatedLabel(filterId,label){return(this.getGlobalFilters().findIndex((filter)=>(!filterId||filter.id!==filterId)&&filter.label===label)>-1);}}
FiltersPlugin.modes=["normal","headless"];FiltersPlugin.getters=["getGlobalFilter","getGlobalFilters","getGlobalFilterDefaultValue","getGlobalFilterLabel","getGlobalFilterFieldPivot","getGlobalFilterFieldList",];return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/plugins/core/list_plugin.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/plugins/core/list_plugin',async function(require){'use strict';let __exports={};const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const ListDataSource=require("@documents_spreadsheet/js/o_spreadsheet/helpers/list_data_source")[Symbol.for("default")];const CommandResult=require("@documents_spreadsheet/js/o_spreadsheet/plugins/cancelled_reason")[Symbol.for("default")];const{getFirstListFunction}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/odoo_functions_helpers");const{getMaxObjectId}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/helpers");const{astToFormula}=spreadsheet;const ListPlugin=__exports[Symbol.for("default")]=class ListPlugin extends spreadsheet.CorePlugin{constructor(getters,history,range,dispatch,config){super(getters,history,range,dispatch,config);this.lists={};this.dataSources=config.dataSources;this.rpc=config.evalContext.env?config.evalContext.env.delayedRPC:undefined;}
allowDispatch(cmd){switch(cmd.type){case"ADD_ODOO_LIST":if(this.lists[cmd.list.id]){return CommandResult.ListIdDuplicated;}
break;}
return CommandResult.Success;}
handle(cmd){switch(cmd.type){case"ADD_ODOO_LIST":{const lists={...this.lists};lists[cmd.list.id]=cmd.list;this.history.update("lists",lists);this._createListSource(cmd.list.id);break;}
case"ADD_ODOO_LIST_FORMULA":this.dispatch("UPDATE_CELL",{sheetId:cmd.sheetId,col:cmd.col,row:cmd.row,content:`=${cmd.formula}("${cmd.args
                        .map((arg) => arg.toString().replace(/"/g, '\\"'))
                        .join('","')}")`,});break;}}
getListColumns(listId){return this._getList(listId).columns;}
getListDomain(listId){return this._getList(listId).domain;}
getListIdFromPosition(sheetId,col,row){const cell=this.getters.getCell(sheetId,col,row);if(cell&&cell.isFormula()){const listFunction=getFirstListFunction(cell.normalizedText);if(listFunction){const dependencies={...cell.dependencies,references:cell.dependencies.references.map((range)=>this.getters.getRangeString(range,range.sheetId))}
const content=astToFormula(listFunction.args[0],dependencies);const formula=this.getters.buildFormulaContent(sheetId,content,cell.dependencies);return this.getters.evaluateFormula(formula).toString();}}
return undefined;}
getListIds(){return Object.keys(this.lists);}
getListModel(listId){return this._getList(listId).model;}
getListForRPC(listId){const list=this._getList(listId);return{columns:list.columns,context:list.context,domain:list.domain,model:list.model,orderBy:list.orderBy,};}
getListOrderBy(listId){return this._getList(listId).orderBy;}
getNextListId(){return(getMaxObjectId(this.lists)+1).toString();}
import(data){if(data.lists){this.lists=JSON.parse(JSON.stringify(data.lists));}
for(const listId in this.lists){this._createListSource(listId);}}
export(data){data.lists=JSON.parse(JSON.stringify(this.lists));}
_getList(listId){if(!(listId in this.lists)){throw new Error(`There is not list with the id "${listId}"`);}
return this.lists[listId];}
_createListSource(listId){const definition=this.getListForRPC(listId);this.dataSources.add(`LIST_${listId}`,new ListDataSource({rpc:this.rpc,definition,model:definition.model,}));}}
ListPlugin.modes=["normal","headless"];ListPlugin.getters=["getListColumns","getListDomain","getListIdFromPosition","getListIds","getListForRPC","getListModel","getListOrderBy","getNextListId",];return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/plugins/core/pivot_plugin.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/plugins/core/pivot_plugin',async function(require){'use strict';let __exports={};const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const PivotDataSource=require("@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_data_source")[Symbol.for("default")];const{getFirstPivotFunction}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/odoo_functions_helpers");const{getMaxObjectId}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/helpers");const{astToFormula}=spreadsheet;const PivotPlugin=__exports[Symbol.for("default")]=class PivotPlugin extends spreadsheet.CorePlugin{constructor(getters,history,range,dispatch,config){super(getters,history,range,dispatch,config);this.pivots={};this.dataSources=config.dataSources;this.rpc=config.evalContext.env?config.evalContext.env.delayedRPC:undefined;}
handle(cmd){switch(cmd.type){case"ADD_PIVOT":{const pivots={...this.pivots};pivots[cmd.pivot.id]=cmd.pivot;this.history.update("pivots",pivots);this._addPivotSource(cmd.pivot.id);break;}
case"ADD_PIVOT_FORMULA":this.dispatch("UPDATE_CELL",{sheetId:cmd.sheetId,col:cmd.col,row:cmd.row,content:`=${cmd.formula}("${cmd.args
                        .map((arg) => arg.toString().replace(/"/g, '\\"'))
                        .join('","')}")`,});break;}}
getNextPivotId(){return(getMaxObjectId(this.pivots)+1).toString();}
getPivotColGroupBys(pivotId){return this._getPivot(pivotId).colGroupBys;}
getPivotDomain(pivotId){return this._getPivot(pivotId).domain;}
getPivotForRPC(pivotId){const pivot=this._getPivot(pivotId);return{colGroupBys:pivot.colGroupBys,context:pivot.context,domain:pivot.domain,measures:pivot.measures,model:pivot.model,rowGroupBys:pivot.rowGroupBys,};}
getPivotIdFromPosition(sheetId,col,row){const cell=this.getters.getCell(sheetId,col,row);if(cell&&cell.isFormula()){const pivotFunction=getFirstPivotFunction(cell.normalizedText);if(pivotFunction){const dependencies={...cell.dependencies,references:cell.dependencies.references.map((range)=>this.getters.getRangeString(range,range.sheetId))}
const content=astToFormula(pivotFunction.args[0],dependencies);const formula=this.getters.buildFormulaContent(sheetId,content,cell.dependencies);return this.getters.evaluateFormula(formula).toString();}}
return undefined;}
getPivotIds(){return Object.keys(this.pivots);}
getPivotMeasures(pivotId){return this._getPivot(pivotId).measures;}
getPivotModel(pivotId){return this._getPivot(pivotId).model;}
getPivotRowGroupBys(pivotId){return this._getPivot(pivotId).rowGroupBys;}
isExistingPivot(pivotId){return pivotId in this.pivots;}
_getPivot(pivotId){return this.pivots[pivotId];}
_addPivotSource(pivotId){const definition=this.getPivotForRPC(pivotId);this.dataSources.add(`PIVOT_${pivotId}`,new PivotDataSource({rpc:this.rpc,definition,model:definition.model,}));}
import(data){if(data.pivots){this.pivots=JSON.parse(JSON.stringify(data.pivots));}
for(const pivotId in this.pivots){this._addPivotSource(pivotId);}}
export(data){data.pivots=JSON.parse(JSON.stringify(this.pivots));}}
PivotPlugin.modes=["normal","headless"];PivotPlugin.getters=["getNextPivotId","getPivotColGroupBys","getPivotDomain","getPivotForRPC","getPivotIdFromPosition","getPivotIds","getPivotModel","getPivotMeasures","getPivotRowGroupBys","isExistingPivot",];return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/plugins/ui/filters_evaluation_plugin.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/plugins/ui/filters_evaluation_plugin',async function(require){'use strict';let __exports={};const{_t}=require("web.core");const spreadsheet=require("documents_spreadsheet.spreadsheet");const Domain=require("web.Domain");const{constructDateDomain,constructDateRange,yearSelected}=require("web.searchUtils");const pyUtils=require("web.py_utils");const{getPeriodOptions}=require("web.searchUtils");const CommandResult=require("@documents_spreadsheet/js/o_spreadsheet/plugins/cancelled_reason")[Symbol.for("default")];const{checkFiltersTypeValueCombination}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/helpers");const MONTHS={january:{value:0,granularity:"month"},february:{value:1,granularity:"month"},march:{value:2,granularity:"month"},april:{value:3,granularity:"month"},may:{value:4,granularity:"month"},june:{value:5,granularity:"month"},july:{value:6,granularity:"month"},august:{value:7,granularity:"month"},september:{value:8,granularity:"month"},october:{value:9,granularity:"month"},november:{value:10,granularity:"month"},december:{value:11,granularity:"month"},};const THIS_YEAR=moment().year();const YEARS={this_year:{value:THIS_YEAR,granularity:"year"},last_year:{value:THIS_YEAR-1,granularity:"year"},antepenultimate_year:{value:THIS_YEAR-2,granularity:"year"},};const PERIOD_OPTIONS=Object.assign({},MONTHS,YEARS);const FiltersEvaluationPlugin=__exports[Symbol.for("default")]=class FiltersEvaluationPlugin extends spreadsheet.UIPlugin{constructor(getters,history,dispatch,config){super(getters,history,dispatch,config);this.orm=config.evalContext.env?config.evalContext.env.services.orm:undefined;this.recordsDisplayName={};this.values={};}
allowDispatch(cmd){switch(cmd.type){case"SET_GLOBAL_FILTER_VALUE":{const filter=this.getters.getGlobalFilter(cmd.id);if(!filter){return CommandResult.FilterNotFound;}
return checkFiltersTypeValueCombination(filter.type,cmd.value);}}
return CommandResult.Success;}
handle(cmd){switch(cmd.type){case"ADD_GLOBAL_FILTER":case"EDIT_GLOBAL_FILTER":this.recordsDisplayName[cmd.filter.id]=cmd.filter.defaultValueDisplayNames;break;case"SET_GLOBAL_FILTER_VALUE":this.recordsDisplayName[cmd.id]=cmd.displayNames;this._setGlobalFilterValue(cmd.id,cmd.value);break;case"REMOVE_GLOBAL_FILTER":delete this.recordsDisplayName[cmd.id];break;}
switch(cmd.type){case"START":case"ADD_GLOBAL_FILTER":case"EDIT_GLOBAL_FILTER":case"SET_GLOBAL_FILTER_VALUE":case"REMOVE_GLOBAL_FILTER":this._updateAllDomains();break;}}
getGlobalFilterValue(id){return id in this.values?this.values[id]:this.getters.getGlobalFilterDefaultValue(id);}
getActiveFilterCount(){return this.getters.getGlobalFilters().filter((filter)=>{const value=this.getGlobalFilterValue(filter.id);switch(filter.type){case"text":return value;case"date":return value&&(value.year||value.period);case"relation":return value&&value.length;}}).length;}
getFilterDisplayValue(filterName){const filter=this.getters.getGlobalFilterLabel(filterName);if(!filter){throw new Error(_.str.sprintf(_t(`Filter "%s" not found`),filterName));}
const value=this.getGlobalFilterValue(filter.id);switch(filter.type){case"text":return value||"";case"date":return getPeriodOptions(moment()).filter(({id})=>value&&[value.year,value.period].includes(id)).map((period)=>period.description).join(" ");case"relation":if(!value||!this.orm)return"";if(!this.recordsDisplayName[filter.id]){this.orm.call(filter.modelName,"name_get",[value]).then((result)=>{const names=result.map(([,name])=>name);this.recordsDisplayName[filter.id]=names;this.dispatch("EVALUATE_CELLS",{sheetId:this.getters.getActiveSheetId(),});});return"";}
return this.recordsDisplayName[filter.id].join(", ");}}
_setGlobalFilterValue(id,value){this.values[id]=value;}
_updateAllDomains(){for(const pivotId of this.getters.getPivotIds()){const domain=this._getComputedDomain((filterId)=>this.getters.getGlobalFilterFieldPivot(filterId,pivotId));this.dispatch("ADD_PIVOT_DOMAIN",{id:pivotId,domain,refresh:true});}
for(const listId of this.getters.getListIds()){const domain=this._getComputedDomain((filterId)=>this.getters.getGlobalFilterFieldList(filterId,listId));this.dispatch("ADD_LIST_DOMAIN",{id:listId,domain,refresh:true});}}
_getDateDomain(filter,fieldDesc){const value=this.getGlobalFilterValue(filter.id);const values=value&&Object.values(value).filter(Boolean);if(!values||values.length===0){return undefined;}
if(!yearSelected(values)){values.push("this_year");}
const field=fieldDesc.field;const type=fieldDesc.type;const dateFilterRange=filter.rangeType==="month"?constructDateRange({referenceMoment:moment(),fieldName:field,fieldType:type,granularity:"month",setParam:this._getSelectedOptions(values),}):constructDateDomain(moment(),field,type,values);return Domain.prototype.arrayToString(pyUtils.eval("domain",dateFilterRange.domain,{}));}
_getTextDomain(filter,fieldDesc){const value=this.getGlobalFilterValue(filter.id);if(!value){return undefined;}
const field=fieldDesc.field;return Domain.prototype.arrayToString([[field,"ilike",value]]);}
_getRelationDomain(filter,fieldDesc){const values=this.getGlobalFilterValue(filter.id);if(!values||values.length===0){return undefined;}
const field=fieldDesc.field;return Domain.prototype.arrayToString([[field,"in",values]]);}
_getComputedDomain(getFieldDesc){let domain="[]";for(let filter of this.getters.getGlobalFilters()){const fieldDesc=getFieldDesc(filter.id);if(!fieldDesc){continue;}
let domainToAdd=undefined;switch(filter.type){case"date":domainToAdd=this._getDateDomain(filter,fieldDesc);break;case"text":domainToAdd=this._getTextDomain(filter,fieldDesc);break;case"relation":domainToAdd=this._getRelationDomain(filter,fieldDesc);break;}
if(domainToAdd){domain=pyUtils.assembleDomains([domain,domainToAdd],"AND");}}
return domain;}
_getSelectedOptions(selectedOptionIds){const selectedOptions={year:[]};for(const optionId of selectedOptionIds){const option=PERIOD_OPTIONS[optionId];const granularity=option.granularity;selectedOptions[granularity]=option.value;}
return selectedOptions;}}
FiltersEvaluationPlugin.modes=["normal"];FiltersEvaluationPlugin.getters=["getFilterDisplayValue","getGlobalFilterValue","getActiveFilterCount",];return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/plugins/ui/ir_ui_menu_plugin.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/plugins/ui/ir_ui_menu_plugin',async function(require){'use strict';let __exports={};const{UIPlugin}=require("documents_spreadsheet.spreadsheet");const IrMenuPlugin=__exports[Symbol.for("default")]=class IrMenuPlugin extends UIPlugin{constructor(getters,history,dispatch,config){super(getters,history,dispatch,config);this.env=config.evalContext.env;}
getIrMenuNameById(menuId){return this.env.services.menu.getMenu(menuId).name;}
getIrMenuNameByXmlId(xmlId){return this._getIrMenuByXmlId(xmlId).name;}
getIrMenuIdByXmlId(xmlId){return this._getIrMenuByXmlId(xmlId).id;}
_getIrMenuByXmlId(xmlId){const menu=this.env.services.menu.getAll().find((menu)=>menu.xmlid===xmlId);if(!menu){throw new Error(`Menu ${xmlId} not found. You may not have the required access rights.`);}
return menu;}}
IrMenuPlugin.getters=["getIrMenuNameByXmlId","getIrMenuNameById","getIrMenuIdByXmlId"];return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/plugins/ui/list_autofill_plugin.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/plugins/ui/list_autofill_plugin',async function(require){'use strict';let __exports={};const{_t}=require("web.core");const spreadsheet=require("documents_spreadsheet.spreadsheet");const{getFirstListFunction,getNumberOfListFormulas,}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/odoo_functions_helpers");const{astToFormula}=spreadsheet;const ListAutofillPlugin=__exports[Symbol.for("default")]=class ListAutofillPlugin extends spreadsheet.UIPlugin{getNextListValue(formula,isColumn,increment){if(getNumberOfListFormulas(formula)!==1){return formula;}
const{functionName,args}=getFirstListFunction(formula);const evaluatedArgs=args.map(astToFormula).map((arg)=>this.getters.evaluateFormula(arg));const listId=evaluatedArgs[0];const columns=this.getters.getListColumns(listId);if(functionName==="LIST"){const position=parseInt(evaluatedArgs[1],10);const field=evaluatedArgs[2];if(isColumn){const index=columns.findIndex((col)=>col===field)+increment;if(index<0||index>=columns.length){return"";}
return this._getListFunction(listId,position,columns[index]);}else{const nextPosition=position+increment;if(nextPosition===0){return this._getListHeaderFunction(listId,field);}
if(nextPosition<0){return"";}
return this._getListFunction(listId,nextPosition,field);}}
if(functionName==="LIST.HEADER"){const field=evaluatedArgs[1];if(isColumn){const index=columns.findIndex((col)=>col===field)+increment;if(index<0||index>=columns.length){return"";}
return this._getListHeaderFunction(listId,columns[index]);}else{if(increment>0){return this._getListFunction(listId,increment,field);}
return"";}}
return formula;}
getTooltipListFormula(formula,isColumn){if(!formula){return[];}
const{functionName,args}=getFirstListFunction(formula);const evaluatedArgs=args.map(astToFormula).map((arg)=>this.getters.evaluateFormula(arg));if(isColumn||functionName==="LIST.HEADER"){const fieldName=functionName==="LIST"?evaluatedArgs[2]:evaluatedArgs[1];return this.getters.getListFieldName(evaluatedArgs[0],fieldName);}
return _t("Record #")+evaluatedArgs[1];}
_getListFunction(listId,position,field){return`=LIST("${listId}","${position}","${field}")`;}
_getListHeaderFunction(listId,field){return`=LIST.HEADER("${listId}","${field}")`;}}
ListAutofillPlugin.modes=["normal","headless"];ListAutofillPlugin.getters=["getNextListValue","getTooltipListFormula"];return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/plugins/ui/list_structure_plugin.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/plugins/ui/list_structure_plugin',async function(require){'use strict';let __exports={};const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const Domain=require("web.Domain");const pyUtils=require("web.py_utils");const ListDataSource=require("@documents_spreadsheet/js/o_spreadsheet/helpers/list_data_source")[Symbol.for("default")];const{TOP_LEVEL_STYLE}=require("@documents_spreadsheet/js/o_spreadsheet/constants");const ListStructurePlugin=__exports[Symbol.for("default")]=class ListStructurePlugin extends spreadsheet.UIPlugin{constructor(getters,history,dispatch,config){super(getters,history,dispatch,config);this.rpc=config.evalContext.env?config.evalContext.env.delayedRPC:undefined;this.dataSources=config.dataSources;this.selectedListId=undefined;}
handle(cmd){switch(cmd.type){case"START":this._refreshOdooLists();break;case"BUILD_ODOO_LIST":this._handleBuildList(cmd.sheetId,cmd.anchor,cmd.linesNumber,cmd.list,cmd.types);break;case"REBUILD_ODOO_LIST":{let types={};const dataSource=this._getDataSource(cmd.listId);if(dataSource.getMetadataSync()){types=this.getters.getListColumns(cmd.listId).reduce((acc,current)=>{const field=dataSource.getField(current);acc[current]=field.type;return acc;},{});}
this._buildList(cmd.sheetId,cmd.anchor,cmd.listId,cmd.linesNumber,types);break;}
case"SELECT_ODOO_LIST":this._selectList(cmd.listId);break;case"REFRESH_ODOO_LIST":this._refreshOdooList(cmd.listId);break;case"REFRESH_ALL_DATA_SOURCES":this._refreshOdooLists();break;case"ADD_LIST_DOMAIN":this._addDomain(cmd.id,cmd.domain,cmd.refresh);break;}}
_addDomain(listId,domain,refresh=true){domain=pyUtils.assembleDomains([Domain.prototype.arrayToString(this.getters.getListDomain(listId)),Domain.prototype.arrayToString(domain),],"AND");const computedDomain=pyUtils.eval("domain",domain,{});this._getDataSource(listId).setComputedDomain(computedDomain);if(refresh){this._refreshOdooList(listId);}}
_handleBuildList(sheetId,anchor,linesNumber,list,types){this.dispatch("ADD_ODOO_LIST",{list});this._buildList(sheetId,anchor,list.id,linesNumber,types);const cols=[];for(let col=anchor[0];col<anchor[0]+list.columns.length;col++){cols.push(col);}
this.dispatch("EVALUATE_CELLS",{sheetId:this.getters.getActiveSheetId()});const dataSource=this._getDataSource(list.id);dataSource.on("data-loaded",this,()=>{this.dispatch("AUTORESIZE_COLUMNS",{sheetId,cols,});dataSource.off("data-loaded",this);});}
_refreshOdooList(listId){this.dataSources.get(`LIST_${listId}`).get({forceFetch:true});}
_refreshOdooLists(){for(const listId of this.getters.getListIds()){this._refreshOdooList(listId);}}
_selectList(listId){this.selectedListId=listId;}
getListComputedDomain(listId){return this._getDataSource(listId).getComputedDomain();}
getListDisplayName(listId){const model=this.getListModelDisplayName(listId);return`(#${listId}) ${model}`;}
getListField(listId,fieldName){return this._getDataSource(listId).getField(fieldName);}
getListFieldName(listId,fieldName){return this._getDataSource(listId).getFieldName(fieldName)||fieldName;}
getListFields(listId){return this._getDataSource(listId).getFields();}
getListHeader(listId,fieldName){return this._getDataSource(listId).getFieldName(fieldName);}
getListLastUpdate(listId){return this._getDataSource(listId).getLastUpdate();}
getListModelDisplayName(listId){return this._getDataSource(listId).getModelName()||this.getters.getListModel(listId);}
getListValue(listId,position,fieldName){return this._getDataSource(listId).getRecordField(position,fieldName);}
getSelectedListId(){return this.selectedListId;}
_buildList(sheetId,anchor,listId,linesNumber,types){const columns=this.getters.getListColumns(listId);let[col,row]=anchor;this._resizeSheet(sheetId,columns.length,linesNumber+1,anchor);for(const field_name of columns){this.dispatch("ADD_ODOO_LIST_FORMULA",{col,row,sheetId,formula:"LIST.HEADER",args:[listId,field_name],});col++;}
row++;for(let i=1;i<=linesNumber;i++){col=anchor[0];for(const field_name of columns){this.dispatch("ADD_ODOO_LIST_FORMULA",{col,row,sheetId,formula:"LIST",args:[listId,i,field_name],});col++;}
row++;}
this.dispatch("SET_FORMATTING",{sheetId,style:TOP_LEVEL_STYLE,target:[{top:anchor[1],bottom:anchor[1],left:anchor[0],right:anchor[0]+columns.length-1,},],});col=anchor[0];for(const field_name of columns){const type=types[field_name];if(["integer","float","monetary"].includes(type)){this.dispatch("SET_FORMATTING",{sheetId,format:"#,##0.00",target:[{top:anchor[1],bottom:anchor[1]+linesNumber,left:col,right:col,},],});}
col++;}}
_getDataSource(listId){return this.dataSources.get(`LIST_${listId}`);}
_resizeSheet(sheetId,columns,rows,anchor){const sheet=this.getters.getSheet(sheetId);const numberCols=sheet.cols.length;const deltaCol=numberCols-anchor[0];if(deltaCol<columns){this.dispatch("ADD_COLUMNS_ROWS",{dimension:"COL",base:numberCols-1,sheetId:sheetId,quantity:columns-deltaCol,position:"after",});}
const numberRows=sheet.rows.length;const deltaRow=numberRows-anchor[1];if(deltaRow<rows){this.dispatch("ADD_COLUMNS_ROWS",{dimension:"ROW",base:numberRows-1,sheetId:sheetId,quantity:rows-deltaRow,position:"after",});}}}
ListStructurePlugin.modes=["normal","headless"];ListStructurePlugin.getters=["getListComputedDomain","getListDisplayName","getListFieldName","getListFields","getListField","getListHeader","getListLastUpdate","getListModelDisplayName","getListValue","getSelectedListId",];return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/plugins/ui/pivot_autofill_plugin.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/plugins/ui/pivot_autofill_plugin',async function(require){'use strict';let __exports={};const core=require("web.core");const spreadsheet=require("documents_spreadsheet.spreadsheet");const{formats}=require("@documents_spreadsheet/js/o_spreadsheet/constants");const{getFirstPivotFunction,getNumberOfPivotFormulas,}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/odoo_functions_helpers");const{astToFormula}=spreadsheet;const _t=core._t;const PivotAutofillPlugin=__exports[Symbol.for("default")]=class PivotAutofillPlugin extends spreadsheet.UIPlugin{getPivotNextAutofillValue(formula,isColumn,increment){if(getNumberOfPivotFormulas(formula)!==1){return formula;}
const{functionName,args}=getFirstPivotFunction(formula);const evaluatedArgs=args.map(astToFormula).map((arg)=>this.getters.evaluateFormula(arg));const pivotId=evaluatedArgs[0];let builder;if(functionName==="PIVOT"){builder=this._autofillPivotValue.bind(this);}else if(functionName==="PIVOT.HEADER"){if(evaluatedArgs.length===1){if(isColumn){builder=this._autofillPivotRowHeader.bind(this);}else{builder=this._autofillPivotColHeader.bind(this);}}else if(this.getters.getPivotRowGroupBys(pivotId).includes(evaluatedArgs[1])){builder=this._autofillPivotRowHeader.bind(this);}else{builder=this._autofillPivotColHeader.bind(this);}}
if(builder){return builder(pivotId,evaluatedArgs,isColumn,increment);}
return formula;}
getTooltipFormula(formula,isColumn){if(getNumberOfPivotFormulas(formula)!==1){return[];}
const{functionName,args}=getFirstPivotFunction(formula);const evaluatedArgs=args.map(astToFormula).map((arg)=>this.getters.evaluateFormula(arg));const pivotId=evaluatedArgs[0];if(functionName==="PIVOT"){return this._tooltipFormatPivot(pivotId,evaluatedArgs,isColumn);}else if(functionName==="PIVOT.HEADER"){return this._tooltipFormatPivotHeader(pivotId,evaluatedArgs);}
return[];}
_isGroupedByDate(pivotId,groupBys){if(groupBys.length!==1){return{isDate:false};}
const[fieldName,group]=groupBys[0].split(":");return{isDate:this.getters.isPivotFieldDate(pivotId,fieldName),group,};}
_autofillPivotValue(pivotId,args,isColumn,increment){const currentElement=this._getCurrentValueElement(pivotId,args);const pivotData=this.getters.getPivotStructureData(pivotId);const date=this._isGroupedByDate(pivotId,isColumn?this.getters.getPivotColGroupBys(pivotId):this.getters.getPivotRowGroupBys(pivotId));let cols=[];let rows=[];let measure;if(isColumn){rows=currentElement.rows;if(date.isDate){cols=currentElement.cols;cols[0]=this._incrementDate(cols[0],date.group,increment);measure=cols.pop();}else{const currentColIndex=pivotData.getTopGroupIndex(currentElement.cols);if(currentColIndex===-1){return"";}
const nextColIndex=currentColIndex+increment;if(nextColIndex===-1){return this._autofillRowFromValue(pivotId,currentElement);}
if(nextColIndex<-1||nextColIndex>=pivotData.getTopHeaderCount()){return"";}
cols=pivotData.getColumnValues(nextColIndex);measure=pivotData.getMeasureName(nextColIndex);}}else{cols=currentElement.cols;if(date.isDate){if(currentElement.rows.length===0){return"";}
rows=currentElement.rows;rows[0]=this._incrementDate(rows[0],date.group,increment);}else{const currentRowIndex=pivotData.getRowIndex(currentElement.rows);if(currentRowIndex===-1){return"";}
const nextRowIndex=currentRowIndex+increment;if(nextRowIndex<0){return this._autofillColFromValue(pivotId,nextRowIndex,currentElement);}
if(nextRowIndex>=pivotData.getRowCount()){return"";}
rows=pivotData.getRowValues(nextRowIndex);}
measure=cols.pop();}
return this._buildValueFormula(this._buildArgs(pivotId,measure,rows,cols));}
_autofillPivotColHeader(pivotId,args,isColumn,increment){const pivotData=this.getters.getPivotStructureData(pivotId);const currentElement=this._getCurrentHeaderElement(pivotId,args);const currentIndex=pivotData.getTopGroupIndex(currentElement.cols);const date=this._isGroupedByDate(pivotId,this.getters.getPivotColGroupBys(pivotId));if(isColumn){let groupValues;if(date.isDate){groupValues=currentElement.cols;groupValues[0]=this._incrementDate(groupValues[0],date.group,increment);}else{const colIndex=pivotData.getSubgroupLevel(currentElement.cols);const nextIndex=currentIndex+increment;if(currentIndex===-1||nextIndex<0||nextIndex>=pivotData.getTopHeaderCount()){return"";}
groupValues=pivotData.getColGroupHierarchy(nextIndex,colIndex);}
return this._buildHeaderFormula(this._buildArgs(pivotId,undefined,[],groupValues));}else{const colIndex=pivotData.getSubgroupLevel(currentElement.cols);const nextIndex=colIndex+increment;const groupLevels=pivotData.getColGroupByLevels();if(nextIndex<0||nextIndex>=groupLevels+1+pivotData.getRowCount()){return"";}
if(nextIndex>=groupLevels+1){const rowIndex=nextIndex-groupLevels-1;const measure=pivotData.getMeasureName(currentIndex);const cols=pivotData.getColumnValues(currentIndex);const rows=pivotData.getRowValues(rowIndex);return this._buildValueFormula(this._buildArgs(pivotId,measure,rows,cols));}else{const cols=pivotData.getColGroupHierarchy(currentIndex,nextIndex);return this._buildHeaderFormula(this._buildArgs(pivotId,undefined,[],cols));}}}
_autofillPivotRowHeader(pivotId,args,isColumn,increment){const pivotData=this.getters.getPivotStructureData(pivotId);const currentElement=this._getCurrentHeaderElement(pivotId,args);const currentIndex=pivotData.getRowIndex(currentElement.rows);const date=this._isGroupedByDate(pivotId,this.getters.getPivotRowGroupBys(pivotId));if(isColumn){if(increment<0||increment>pivotData.getTopHeaderCount()){return"";}
const values=pivotData.getColumnValues(increment-1);const measure=pivotData.getMeasureName(increment-1);return this._buildValueFormula(this._buildArgs(pivotId,measure,currentElement.rows,values));}else{let rows;if(date.isDate){rows=currentElement.rows;rows[0]=this._incrementDate(rows[0],date.group,increment);}else{const nextIndex=currentIndex+increment;if(currentIndex===-1||nextIndex<0||nextIndex>=pivotData.getRowCount()){return"";}
rows=pivotData.getRowValues(nextIndex);}
return this._buildHeaderFormula(this._buildArgs(pivotId,undefined,rows,[]));}}
_autofillColFromValue(pivotId,nextIndex,currentElement){const pivotData=this.getters.getPivotStructureData(pivotId);const groupIndex=pivotData.getTopGroupIndex(currentElement.cols);if(groupIndex<0){return"";}
const levels=pivotData.getColGroupByLevels();const index=levels+1+nextIndex;if(index<0||index>=levels+1){return"";}
const cols=pivotData.getColGroupHierarchy(groupIndex,index);return this._buildHeaderFormula(this._buildArgs(pivotId,undefined,[],cols));}
_autofillRowFromValue(pivotId,currentElement){const rows=currentElement.rows;if(!rows){return"";}
return this._buildHeaderFormula(this._buildArgs(pivotId,undefined,rows,[]));}
_getCurrentHeaderElement(pivotId,args){const values=this._parseArgs(args.slice(1));const cols=this._getFieldValues([...this.getters.getPivotColGroupBys(pivotId),"measure"],values);const rows=this._getFieldValues(this.getters.getPivotRowGroupBys(pivotId),values);return{cols,rows};}
_getCurrentValueElement(pivotId,args){const values=this._parseArgs(args.slice(2));const colGroupBys=this.getters.getPivotColGroupBys(pivotId);const cols=this._getFieldValues(colGroupBys,values);cols.push(args[1]);const rowGroupBys=this.getters.getPivotRowGroupBys(pivotId);const rows=this._getFieldValues(rowGroupBys,values);return{cols,rows};}
_getFieldValues(fields,values){return fields.filter((field)=>field in values).map((field)=>values[field]);}
_incrementDate(date,group,increment){const format=formats[group].out;const interval=formats[group].interval;const dateMoment=moment(date,format);return dateMoment.isValid()?dateMoment.add(increment,interval).format(format):date;}
_parseArgs(args){const values={};for(let i=0;i<args.length;i+=2){values[args[i]]=args[i+1];}
return values;}
_tooltipFormatPivot(pivotId,args,isColumn){const tooltips=[];const values=this._parseArgs(args.slice(2));const colGroupBys=this.getters.getPivotColGroupBys(pivotId);const rowGroupBys=this.getters.getPivotRowGroupBys(pivotId);for(let[field,value]of Object.entries(values)){if((colGroupBys.includes(field)&&isColumn)||(rowGroupBys.includes(field)&&!isColumn)){tooltips.push({title:this.getters.getFormattedGroupBy(pivotId,field),value:this.getters.getFormattedHeader(pivotId,field,value),});}}
if(this.getters.getPivotMeasures(pivotId).length!==1&&isColumn){const measure=args[1];tooltips.push({title:_t("Measure"),value:this.getters.getFormattedHeader(pivotId,"measure",measure),});}
return tooltips;}
_tooltipFormatPivotHeader(pivotId,args){const tooltips=[];const values=this._parseArgs(args.slice(1));if(Object.keys(values).length===0){return[{title:_t("Total"),value:_t("Total")}];}
for(let[field,value]of Object.entries(values)){tooltips.push({title:field==="measure"?_t("Measure"):this.getters.getFormattedGroupBy(pivotId,field),value:this.getters.getFormattedHeader(pivotId,field,value),});}
return tooltips;}
_buildArgs(pivotId,measure,rows,cols){const args=[pivotId];if(measure){args.push(measure);}
const rowGroupBys=this.getters.getPivotRowGroupBys(pivotId);for(let index in rows){args.push(rowGroupBys[index]);args.push(rows[index]);}
const measures=this.getters.getPivotMeasures(pivotId);if(cols.length===1&&measures.map((x)=>x.field).includes(cols[0])){args.push("measure");args.push(cols[0]);}else{const pivotData=this.getters.getPivotStructureData(pivotId);for(let index in cols){args.push(pivotData.getColLevelIdentifier(index));args.push(cols[index]);}}
return args;}
_buildHeaderFormula(args){return`=PIVOT.HEADER("${args
            .map((arg) => arg.toString().replace(/"/g, '\\"'))
            .join('","')}")`;}
_buildValueFormula(args){return`=PIVOT("${args.map((arg) => arg.toString().replace(/"/g, '\\"')).join('","')}")`;}}
PivotAutofillPlugin.modes=["normal","headless"];PivotAutofillPlugin.getters=["getPivotNextAutofillValue","getTooltipFormula"];return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/plugins/ui/pivot_structure_plugin.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/plugins/ui/pivot_structure_plugin',async function(require){'use strict';let __exports={};const{_t}=require("web.core");const Domain=require("web.Domain");const pyUtils=require("web.py_utils");const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const PivotDataSource=require("@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_data_source")[Symbol.for("default")];const{HEADER_STYLE,TOP_LEVEL_STYLE,MEASURE_STYLE}=require("@documents_spreadsheet/js/o_spreadsheet/constants");const PivotCache=require("@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_cache")[Symbol.for("default")];const{PERIODS,formatDate}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_helpers");const PivotStructurePlugin=__exports[Symbol.for("default")]=class PivotStructurePlugin extends spreadsheet.UIPlugin{constructor(getters,history,dispatch,config){super(getters,history,dispatch,config);this.dataSources=config.dataSources;this.selectedPivotId=undefined;}
handle(cmd){switch(cmd.type){case"BUILD_PIVOT":this._handleBuildPivot(cmd.sheetId,cmd.anchor,cmd.pivot,cmd.cache);break;case"REBUILD_PIVOT":this._rebuildPivot(cmd.id,cmd.anchor);break;case"SELECT_PIVOT":this._selectPivot(cmd.pivotId);break;case"ADD_PIVOT_DOMAIN":this._addDomain(cmd.id,cmd.domain,cmd.refresh);break;case"START":this._refreshOdooPivots();break;case"REFRESH_PIVOT":this._refreshOdooPivot(cmd.id);break;case"REFRESH_ALL_DATA_SOURCES":this._refreshOdooPivots();break;}}
getFormattedGroupBy(pivotId,groupBy){let[name,period]=groupBy.split(":");period=PERIODS[period];return this.getPivotFieldName(pivotId,name)+(period?` (${period})`:"");}
getFormattedHeader(pivotId,fieldName,value){if(fieldName==="measure"){return value==="__count"?_t("Count"):this.getPivotFieldName(pivotId,value);}
const undef=_t("(Undefined)");const pivotData=this.getPivotStructureData(pivotId);const dataSource=this._getDataSource(pivotId);const field=dataSource.getField(fieldName.split(":")[0])
if(field&&field.relation&&!pivotData.isGroupLabelLoaded(fieldName,value)&&value!=="false"){dataSource._fetchLabel(field,value).then(()=>dataSource.trigger("data-loaded"));return undefined;}
if(this.getters.isPivotFieldDate(pivotId,fieldName.split(":")[0])){return formatDate(fieldName,value);}
const result=pivotData.getGroupLabel(fieldName,value)||undef;if(result instanceof Error){throw result;}
return result;}
getPivotComputedDomain(pivotId){return this._getDataSource(pivotId).getComputedDomain();}
getPivotDisplayName(pivotId){const model=this._getDataSource(pivotId).getModelName()||this.getters.getPivotModel(pivotId);return`(#${pivotId}) ${model}`;}
getPivotField(pivotId,fieldName){return this._getDataSource(pivotId).getField(fieldName);}
getPivotFieldName(pivotId,fieldName){return this._getDataSource(pivotId).getFieldName(fieldName)||fieldName;}
getPivotFields(pivotId){return this._getDataSource(pivotId).getFields();}
getPivotFieldValues(pivotId,fieldName){return this.getPivotStructureData(pivotId).getFieldValues(fieldName);}
getPivotHeaderValue(pivotId,domain){const pivotData=this.getPivotStructureData(pivotId);if(!pivotData){this.waitForPivotDataReady(pivotId);return _t("Loading...");}
pivotData.markAsHeaderUsed(domain);const len=domain.length;if(len===0){return _t("Total");}
const field=domain[len-2];const value=domain[len-1];return this.getFormattedHeader(pivotId,field,value);}
getPivotLastUpdate(pivotId){return this._getDataSource(pivotId).getLastUpdate();}
getPivotRelationalFields(){return[...new Set(this.getters.getPivotIds().map((pivotId)=>Object.values(this.getPivotFields(pivotId))).flat().filter((field)=>field.type==="many2one").map((field)=>field.relation)),];}
getPivotModelDisplayName(pivotId){return this._getDataSource(pivotId).getModelName()||this.getters.getPivotModel(pivotId);}
getPivotStructureData(pivotId){return this._getDataSource(pivotId).getSync();}
getPivotValue(pivotId,measure,domain){const pivotData=this.getPivotStructureData(pivotId);if(!pivotData){this.waitForPivotDataReady(pivotId);return"Loading...";}
const measures=this.getters.getPivotMeasures(pivotId);const operator=measures.filter((m)=>m.field===measure)[0].operator;pivotData.markAsValueUsed(domain,measure);return pivotData.getMeasureValue(measure,operator,domain);}
getSelectedPivotId(){return this.selectedPivotId;}
isPivotFieldDate(pivotId,fieldName){const field=this.getPivotField(pivotId,fieldName);return field?["date","datetime"].includes(field.type):false;}
validatePivotArguments(pivotId,measure,domain){this.getters.validatePivotHeaderArguments(pivotId,domain);const measures=this.getters.getPivotMeasures(pivotId).map((elt)=>elt.field);if(!measures.includes(measure)){const validMeasures=`(${measures})`;throw new Error(_.str.sprintf(_t("The argument %s is not a valid measure. Here are the measures: %s"),measure,validMeasures));}}
validatePivotHeaderArguments(pivotId,domain){if(!this.getters.isExistingPivot(pivotId)){throw new Error(_.str.sprintf(_t('There is no pivot with id "%s"'),pivotId));}
if(domain.length%2!==0){throw new Error(_t("Function PIVOT takes an even number of arguments."));}}
async waitForPivotDataReady(pivotId,params={}){if(params.initialDomain){params.force=true;}
await this._getDataSource(pivotId).get({forceFetch:params.force,initialDomain:params.initialDomain,});}
async waitForPivotMetaData(pivotId){await this._getDataSource(pivotId).loadMetadata();}
_getDataSource(pivotId){return this.dataSources.get(`PIVOT_${pivotId}`);}
_handleBuildPivot(sheetId,anchor,pivot,cache){this.dispatch("ADD_PIVOT",{pivot});this._buildPivot(sheetId,pivot.id,anchor,cache);const cols=[];for(let col=anchor[0];col<=anchor[0]+cache.getTopHeaderCount();col++){cols.push(col);}
const dataSource=this._getDataSource(pivot.id);dataSource.on("data-loaded",this,()=>{this.dispatch("EVALUATE_CELLS",{sheetId:this.getters.getActiveSheetId()});this.dispatch("AUTORESIZE_COLUMNS",{sheetId,cols,});dataSource.off("data-loaded",this);});}
_rebuildPivot(pivotId,anchor){const sheetId=this.getters.getActiveSheetId();const cache=this._getDataSource(pivotId).getSync();this._buildPivot(sheetId,pivotId,anchor,cache);}
_selectPivot(pivotId){this.selectedPivotId=pivotId;}
_refreshOdooPivot(pivotId){this.waitForPivotDataReady(pivotId,{force:true});}
_refreshOdooPivots(){for(const pivotId of this.getters.getPivotIds()){this._refreshOdooPivot(pivotId);}}
_addDomain(pivotId,domain,refresh=true){domain=pyUtils.assembleDomains([Domain.prototype.arrayToString(this.getters.getPivotDomain(pivotId)),Domain.prototype.arrayToString(domain),],"AND");const computedDomain=pyUtils.eval("domain",domain,{});this._getDataSource(pivotId).setComputedDomain(computedDomain);if(refresh){this._refreshOdooPivot(pivotId);}}
_buildPivot(sheetId,pivotId,anchor,cache){this._resizeSheet(sheetId,pivotId,anchor,cache);this._buildColHeaders(sheetId,pivotId,anchor,cache);this._buildRowHeaders(sheetId,pivotId,anchor,cache);this._buildValues(sheetId,pivotId,anchor,cache);}
_buildColHeaders(sheetId,pivotId,anchor,cache){const[colAnchor,rowAnchor]=anchor;const bold=[];const levels=cache.getColGroupByLevels();const measures=this.getters.getPivotMeasures(pivotId);this._applyStyle(sheetId,HEADER_STYLE,[{top:rowAnchor,bottom:rowAnchor+levels,left:colAnchor,right:colAnchor,},]);let col=colAnchor+1;let length=cache.getTopHeaderCount()-measures.length;if(length===0){length=cache.getTopHeaderCount();}
for(let i=0;i<length;i++){let row=rowAnchor;for(let level=0;level<=levels;level++){const args=[pivotId];const values=cache.getColGroupHierarchy(i,level);for(const index in values){args.push(cache.getColLevelIdentifier(index));args.push(values[index]);}
this._applyFormula(sheetId,col,row,args,true);if(level<=levels-1){bold.push({top:row,bottom:row,left:col,right:col});}
row++;}
col++;}
let row=rowAnchor+levels-1;for(let i=length;i<cache.getTopHeaderCount();i++){this._applyFormula(sheetId,col,row,[pivotId],true);bold.push({top:row,bottom:row,left:col,right:col});const args=[pivotId,"measure",cache.getColGroupHierarchy(i,1)[0]];this._applyFormula(sheetId,col,row+1,args,true);col++;}
col=colAnchor+1;let value;let first;for(let index=0;index<cache.getColGroupByLevels();index++){let row=rowAnchor+index;for(let i=0;i<length;i++){const next=JSON.stringify(cache.getColGroupHierarchy(i,index));if(!value){value=next;first=col+i;}else if(value!==next){this._merge(sheetId,{top:row,bottom:row,left:first,right:col+i-1,});value=next;first=col+i;}}
if(first&&first!==col+length-1){this._merge(sheetId,{top:row,bottom:row,left:first,right:col+length-1,});}
first=undefined;value=undefined;}
for(let index=0;index<cache.getColGroupByLevels();index++){const row=rowAnchor+index;const colStart=cache.getTopHeaderCount()-measures.length+1;this._merge(sheetId,{top:row,bottom:row,left:colStart,right:colStart+measures.length-1,});}
this._applyStyle(sheetId,HEADER_STYLE,[{top:rowAnchor,bottom:rowAnchor+cache.getColGroupByLevels()-1,left:colAnchor,right:colAnchor+cache.getTopHeaderCount(),},]);for(let zone of bold){this._applyStyle(sheetId,TOP_LEVEL_STYLE,[zone]);}
this._applyStyle(sheetId,MEASURE_STYLE,[{top:rowAnchor+cache.getColGroupByLevels(),bottom:rowAnchor+cache.getColGroupByLevels(),left:colAnchor+1,right:colAnchor+cache.getTopHeaderCount(),},]);}
_buildRowHeaders(sheetId,pivotId,anchor,cache){const col=anchor[0];const anchorRow=anchor[1]+cache.getColGroupByLevels()+1;const levelOne=[];const levelTwo=[];const rowCount=cache.getRowCount();const rowGroupBys=this.getters.getPivotRowGroupBys(pivotId);for(let index=0;index<rowCount;index++){const args=[pivotId];const row=anchorRow+parseInt(index,10);const current=cache.getRowValues(index);for(let i in current){args.push(rowGroupBys[i]);args.push(current[i]);}
this._applyFormula(sheetId,col,row,args,true);if(current.length<=1){levelOne.push({top:row,bottom:row,left:col,right:col});}
if(current.length==2){levelTwo.push({top:row,bottom:row,left:col,right:col});}}
this._applyStyle(sheetId,TOP_LEVEL_STYLE,levelOne);this._applyStyle(sheetId,HEADER_STYLE,levelTwo);}
_buildValues(sheetId,pivotId,anchor,cache){const anchorCol=anchor[0]+1;const anchorRow=anchor[1]+cache.getColGroupByLevels()+1;const measures=this.getters.getPivotMeasures(pivotId);const rowGroupBys=this.getters.getPivotRowGroupBys(pivotId);let col=anchorCol;let row=anchorRow;const length=cache.getTopHeaderCount()-measures.length;for(let i=0;i<length;i++){const colElement=[...cache.getColumnValues(i),cache.getMeasureName(i)];row=anchorRow;for(let rowElement of cache.getRows()){const args=[];for(let index in rowElement){args.push(rowGroupBys[index]);args.push(rowElement[index]);}
for(let index in colElement){const field=cache.getColLevelIdentifier(index);if(field==="measure"){args.unshift(colElement[index]);}else{args.push(cache.getColLevelIdentifier(index));args.push(colElement[index]);}}
args.unshift(pivotId);this._applyFormula(sheetId,col,row,args,false);row++;}
col++;}
row=anchorRow;for(let i=length;i<cache.getTopHeaderCount();i++){const colElement=[...cache.getColumnValues(i),cache.getMeasureName(i)];row=anchorRow;for(let rowElement of cache.getRows()){const args=[];for(let index in rowElement){args.push(rowGroupBys[index]);args.push(rowElement[index]);}
args.unshift(colElement[0]);args.unshift(pivotId);this._applyFormula(sheetId,col,row,args,false);row++;}
col++;}
this._applyFormat(sheetId,"#,##0.00",[{top:anchorRow,bottom:anchorRow+cache.getRowCount()-1,left:anchorCol,right:anchorCol+cache.getTopHeaderCount()-1,},]);}
_resizeSheet(sheetId,pivotId,anchor,cache){const measures=this.getters.getPivotMeasures(pivotId);const colLimit=cache.getTopHeaderCount()+measures.length+1;const sheet=this.getters.getSheet(sheetId);const numberCols=sheet.cols.length;const deltaCol=numberCols-anchor[0];if(deltaCol<colLimit){this.dispatch("ADD_COLUMNS_ROWS",{dimension:"COL",base:numberCols-1,sheetId:sheetId,quantity:colLimit-deltaCol,position:"after",});}
const rowLimit=cache.getRowCount()+cache.getColGroupByLevels()+2;const numberRows=sheet.rows.length;const deltaRow=numberRows-anchor[1];if(deltaRow<rowLimit){this.dispatch("ADD_COLUMNS_ROWS",{dimension:"ROW",base:numberRows-1,sheetId:sheetId,quantity:rowLimit-deltaRow,position:"after",});}}
_applyFormula(sheetId,col,row,args,isHeader){this.dispatch("ADD_PIVOT_FORMULA",{sheetId,col,row,formula:isHeader?"PIVOT.HEADER":"PIVOT",args,});}
_applyFormat(sheetId,format,target){this.dispatch("SET_FORMATTING",{sheetId,target,format});}
_applyStyle(sheetId,style,target){this.dispatch("SET_FORMATTING",{sheetId,target,style});}
_merge(sheetId,zone){this.dispatch("ADD_MERGE",{sheetId,target:[zone],force:true});}}
PivotStructurePlugin.modes=["normal","headless"];PivotStructurePlugin.getters=["getPivotComputedDomain","getPivotDisplayName","getPivotField","getPivotFieldName","getPivotFields","getPivotHeaderValue","getPivotValue","getFormattedGroupBy","getFormattedHeader","getPivotModelDisplayName","getPivotStructureData","isPivotFieldDate","validatePivotArguments","validatePivotHeaderArguments","waitForPivotDataReady","waitForPivotMetaData","getSelectedPivotId","getPivotLastUpdate","getPivotFieldValues","getPivotRelationalFields",];return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/plugins/ui/pivot_template_plugin.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.PivotTemplatePlugin",function(require){"use strict";const spreadsheet=require("documents_spreadsheet.spreadsheet");const CommandResult=require("documents_spreadsheet.CommandResult");const{pivotFormulaRegex}=require("documents_spreadsheet.pivot_utils");const{parse,astToFormula}=spreadsheet;class PivotTemplatePlugin extends spreadsheet.UIPlugin{constructor(getters,history,dispatch,config){super(getters,history,dispatch,config);this.rpc=config.evalContext.env?config.evalContext.env.services.rpc:undefined;}
allowDispatch(cmd){switch(cmd.type){case"CONVERT_PIVOT_TO_TEMPLATE":case"CONVERT_PIVOT_FROM_TEMPLATE":{const caches=this.getters.getPivotIds().map(this.getters.getPivotStructureData);if(caches.includes(undefined)){return CommandResult.PivotCacheNotLoaded;}
break;}}
return CommandResult.Success;}
handle(cmd){switch(cmd.type){case"CONVERT_PIVOT_TO_TEMPLATE":this._convertFormulas(this._getCells(pivotFormulaRegex),this._absoluteToRelative.bind(this),this.getters.getPivotIds().map(this.getters.getPivotForRPC));break;case"CONVERT_PIVOT_FROM_TEMPLATE":this._convertFormulas(this._getCells(pivotFormulaRegex),this._relativeToAbsolute.bind(this),this.getters.getPivotIds().map(this.getters.getPivotForRPC));this._removeInvalidPivotRows();break;}}
_convertFormulas(cells,convertFunction,...args){cells.forEach((cell)=>{if(cell.isFormula()){const{col,row,sheetId}=this.getters.getCellPosition(cell.id);const ast=convertFunction(parse(cell.normalizedText),cell.dependencies,...args);if(ast){const dependencies={...cell.dependencies,references:cell.dependencies.references.map((range)=>this.getters.getRangeString(range,range.sheetId)),};const content=this.getters.buildFormulaContent(sheetId,`=${astToFormula(ast, dependencies)}`,cell.dependencies);this.dispatch("UPDATE_CELL",{content,sheetId,col,row,});}else{this.dispatch("CLEAR_CELL",{sheetId,col,row,});}}});}
_getCells(regex){return this.getters.getSheets().map((sheet)=>Object.values(this.getters.getCells(sheet.id)).filter((cell)=>cell.isFormula()&&regex.test(this.getters.getFormulaCellContent(sheet.id,cell)))).flat();}
_relativeToAbsolute(ast,dependencies){switch(ast.type){case"FUNCALL":switch(ast.value){case"PIVOT.POSITION":return this._pivotPositionToAbsolute(ast,dependencies);default:return Object.assign({},ast,{args:ast.args.map((child)=>this._relativeToAbsolute(child,dependencies)),});}
case"UNARY_OPERATION":return Object.assign({},ast,{right:this._relativeToAbsolute(ast.right,dependencies),});case"BIN_OPERATION":return Object.assign({},ast,{right:this._relativeToAbsolute(ast.right,dependencies),left:this._relativeToAbsolute(ast.left,dependencies),});}
return ast;}
_absoluteToRelative(ast,dependencies){switch(ast.type){case"FUNCALL":switch(ast.value){case"PIVOT":return this._pivot_absoluteToRelative(ast,dependencies);case"PIVOT.HEADER":return this._pivotHeader_absoluteToRelative(ast,dependencies);default:return Object.assign({},ast,{args:ast.args.map((child)=>this._absoluteToRelative(child,dependencies)),});}
case"UNARY_OPERATION":return Object.assign({},ast,{right:this._absoluteToRelative(ast.right,dependencies),});case"BIN_OPERATION":return Object.assign({},ast,{right:this._absoluteToRelative(ast.right,dependencies),left:this._absoluteToRelative(ast.left,dependencies),});}
return ast;}
fetchValueOfAst(ast,dependencies){switch(ast.type){case"NORMALIZED_NUMBER":return dependencies.numbers[ast.value];case"NORMALIZED_STRING":return dependencies.strings[ast.value]
case"NORMALIZED_REFERENCE":return dependencies.references[ast.value];default:return ast.value}}
_pivotPositionToAbsolute(ast,dependencies){const[pivotIdAst,fieldAst,positionAst]=ast.args;const pivotId=this.fetchValueOfAst(pivotIdAst,dependencies);const fieldName=this.fetchValueOfAst(fieldAst,dependencies);const position=this.fetchValueOfAst(positionAst,dependencies);const values=this.getters.getPivotFieldValues(pivotId,fieldName);const id=values[position-1];return{value:id?`"${id}"`:`"#IDNOTFOUND"`,type:id?"STRING":"UNKNOWN",};}
_pivotHeader_absoluteToRelative(ast,dependencies){ast=Object.assign({},ast);const[pivotIdAst,...domainAsts]=ast.args;if(pivotIdAst.type!=="NORMALIZED_STRING")return ast;ast.args=[pivotIdAst,...this._domainToRelative(pivotIdAst,domainAsts,dependencies)];return ast;}
_pivot_absoluteToRelative(ast,dependencies){ast=Object.assign({},ast);const[pivotIdAst,measureAst,...domainAsts]=ast.args;if(pivotIdAst.type!=="NORMALIZED_STRING")return ast;ast.args=[pivotIdAst,measureAst,...this._domainToRelative(pivotIdAst,domainAsts,dependencies)];return ast;}
_domainToRelative(pivotIdAst,domainAsts,dependencies){let relativeDomain=[];for(let i=0;i<=domainAsts.length-1;i+=2){const fieldAst=domainAsts[i];const valueAst=domainAsts[i+1];const pivotId=this.fetchValueOfAst(pivotIdAst,dependencies);const fieldName=this.fetchValueOfAst(fieldAst,dependencies);if(fieldAst.type==="NORMALIZED_STRING"&&["NORMALIZED_STRING","NORMALIZED_NUMBER"].includes(valueAst.type)&&this._isAbsolute(pivotId,fieldName)){const id=this.fetchValueOfAst(valueAst,dependencies);const values=this.getters.getPivotFieldValues(pivotId,fieldName);const index=values.indexOf(id.toString());relativeDomain=relativeDomain.concat([fieldAst,{type:"FUNCALL",value:"PIVOT.POSITION",args:[pivotIdAst,fieldAst,{type:"NUMBER",value:index+1}],},]);}else{relativeDomain=relativeDomain.concat([fieldAst,valueAst]);}}
return relativeDomain;}
_isAbsolute(pivotId,fieldName){const field=this.getters.getPivotField(pivotId,fieldName.split(":")[0]);return field&&field.type==="many2one";}
_removeInvalidPivotRows(){for(let sheet of this.getters.getSheets()){const invalidRows=[];for(let rowIndex=0;rowIndex<sheet.rows.length;rowIndex++){const{cells}=this.getters.getRow(sheet.id,rowIndex);const[valid,invalid]=Object.values(cells).filter((cell)=>cell.isFormula()&&/^\s*=.*PIVOT/.test(cell.content)).reduce(([valid,invalid],cell)=>{const isInvalid=/^\s*=.*PIVOT(\.HEADER)?.*#IDNOTFOUND/.test(cell.content);return[isInvalid?valid:valid+1,isInvalid?invalid+1:invalid,];},[0,0]);if(invalid>0&&valid===0){invalidRows.push(rowIndex);}}
this.dispatch("REMOVE_COLUMNS_ROWS",{dimension:"ROW",elements:invalidRows,sheetId:sheet.id,});}
this._convertFormulas(this._getCells(/^\s*=.*PIVOT.*#IDNOTFOUND/),()=>null);}}
PivotTemplatePlugin.modes=["headless"];PivotTemplatePlugin.getters=[];return PivotTemplatePlugin;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/registries/autofill.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/registries/autofill',async function(require){'use strict';let __exports={};const{getNumberOfListFormulas}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/odoo_functions_helpers");const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{autofillModifiersRegistry,autofillRulesRegistry}=spreadsheet.registries;const UP=0;const DOWN=1;const LEFT=2;const RIGHT=3;class AutofillTooltip extends owl.Component{}
AutofillTooltip.template="documents_spreadsheet.AutofillTooltip";autofillRulesRegistry.add("autofill_pivot",{condition:(cell)=>cell&&cell.isFormula()&&cell.content.match(/=\s*PIVOT/),generateRule:(cell,cells)=>{const increment=cells.filter((cell)=>cell&&cell.isFormula()&&cell.content.match(/=\s*PIVOT/)).length;return{type:"PIVOT_UPDATER",increment,current:0};},sequence:2,}).add("autofill_pivot_position",{condition:(cell)=>cell&&cell.isFormula()&&cell.content.match(/=.*PIVOT.*PIVOT\.POSITION/),generateRule:()=>({type:"PIVOT_POSITION_UPDATER",current:0}),sequence:1,}).add("autofill_list",{condition:(cell)=>cell&&cell.isFormula()&&getNumberOfListFormulas(cell.content)===1,generateRule:(cell,cells)=>{const increment=cells.filter((cell)=>cell&&cell.isFormula()&&getNumberOfListFormulas(cell.content)===1).length;return{type:"LIST_UPDATER",increment,current:0};},sequence:3,});autofillModifiersRegistry.add("PIVOT_UPDATER",{apply:(rule,data,getters,direction)=>{rule.current+=rule.increment;let isColumn;let steps;switch(direction){case UP:isColumn=false;steps=-rule.current;break;case DOWN:isColumn=false;steps=rule.current;break;case LEFT:isColumn=true;steps=-rule.current;break;case RIGHT:isColumn=true;steps=rule.current;}
const content=getters.getPivotNextAutofillValue(getters.getFormulaCellContent(data.sheetId,data.cell),isColumn,steps);let tooltip={props:{content:data.content,},};if(content&&content!==data.content){tooltip={props:{content:getters.getTooltipFormula(content,isColumn),},component:AutofillTooltip,};}
if(!content){tooltip=undefined;}
return{cellData:{style:undefined,format:undefined,border:undefined,content,},tooltip,};},}).add("PIVOT_POSITION_UPDATER",{apply:(rule,data,getters,direction)=>{const formulaString=data.cell.content;const pivotId=formulaString.match(/PIVOT\.POSITION\(\s*"(\w+)"\s*,/)[1];if(!getters.isExistingPivot(pivotId))
return{cellData:{...data.cell,content:formulaString}};const fields=[UP,DOWN].includes(direction)?getters.getPivotRowGroupBys(pivotId).slice():getters.getPivotColGroupBys(pivotId).slice();const step=[RIGHT,DOWN].includes(direction)?1:-1;const field=fields.reverse().find((field)=>new RegExp(`PIVOT\\.POSITION.*${field}.*\\)`).test(formulaString));const content=formulaString.replace(new RegExp(`(.*PIVOT\\.POSITION\\(\\s*"\\w"\\s*,\\s*"${field}"\\s*,\\s*"?)(\\d+)(.*)`),(match,before,position,after)=>{rule.current+=step;return before+Math.max(parseInt(position)+rule.current,1)+after;});return{cellData:{...data.cell,content},tooltip:content?{props:{content},}:undefined,};},}).add("LIST_UPDATER",{apply:(rule,data,getters,direction)=>{rule.current+=rule.increment;let isColumn;let steps;switch(direction){case UP:isColumn=false;steps=-rule.current;break;case DOWN:isColumn=false;steps=rule.current;break;case LEFT:isColumn=true;steps=-rule.current;break;case RIGHT:isColumn=true;steps=rule.current;}
const content=getters.getNextListValue(getters.getFormulaCellContent(data.sheetId,data.cell),isColumn,steps);let tooltip={props:{content,},};if(content&&content!==data.content){tooltip={props:{content:getters.getTooltipListFormula(content,isColumn),},};}
return{cellData:{style:undefined,format:undefined,border:undefined,content,},tooltip,};},});return __exports;});odoo.define(`documents_spreadsheet.Autofill`,async function(require){return require('@documents_spreadsheet/js/o_spreadsheet/registries/autofill')[Symbol.for("default")];});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/registries/filter_component.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/registries/filter_component',async function(require){'use strict';let __exports={};const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{Component}=owl;const{Menu}=spreadsheet;const{topbarComponentRegistry}=spreadsheet.registries;class FilterComponent extends Component{get activeFilter(){return this.env.getters.getActiveFilterCount();}
toggleDropdown(){this.env.toggleSidePanel("GLOBAL_FILTERS_SIDE_PANEL");}}
FilterComponent.template="documents_spreadsheet.FilterComponent";FilterComponent.components={Menu};topbarComponentRegistry.add("filter_component",{component:FilterComponent,isVisible:(env)=>{return(!env.getters.isReadonly()&&(env.getters.getPivotIds().length+env.getters.getListIds().length))||(env.getters.isReadonly()&&env.getters.getGlobalFilters().length)},});return __exports;});odoo.define(`documents_spreadsheet.filter_component`,async function(require){return require('@documents_spreadsheet/js/o_spreadsheet/registries/filter_component')[Symbol.for("default")];});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/registries/list_actions.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/registries/list_actions',async function(require){'use strict';let __exports={};const{MAXIMUM_CELLS_TO_INSERT}=require("@documents_spreadsheet/js/o_spreadsheet/constants");const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{createFullMenuItem}=spreadsheet.helpers;const REINSERT_LIST_CHILDREN=__exports.REINSERT_LIST_CHILDREN=(env)=>env.getters.getListIds().map((listId,index)=>{return createFullMenuItem(`reinsert_list_${listId}`,{name:env.getters.getListDisplayName(listId),sequence:index,action:async(env)=>{const zone=env.getters.getSelectedZone();const columns=env.getters.getListColumns(listId);env.getLinesNumber((linesNumber)=>{linesNumber=Math.min(linesNumber,Math.floor(MAXIMUM_CELLS_TO_INSERT/columns.length));env.dispatch("REBUILD_ODOO_LIST",{listId:listId,anchor:[zone.left,zone.top],sheetId:env.getters.getActiveSheetId(),linesNumber,});});},});});return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/registries/list_functions.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/registries/list_functions',async function(require){'use strict';let __exports={};const{_t}=require("web.core");const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{args,toString,toNumber}=spreadsheet.helpers;const{functionRegistry}=spreadsheet.registries;functionRegistry.add("LIST",{description:_t("Get the value from a list."),compute:function(listId,index,fieldName){const id=toString(listId);const position=toNumber(index)-1;const field=toString(fieldName);return this.getters.getListValue(id,position,field);},args:args(`
        list_id (string) ${_t("ID of the list.")}
        index (string) ${_t("Position of the record in the list.")}
        field_name (string) ${_t("Name of the field.")}
    `),returns:["NUMBER","STRING"],});functionRegistry.add("LIST_HEADER",{description:_t("Get the header of a list."),compute:function(listId,fieldName){const id=toString(listId);const field=toString(fieldName);return this.getters.getListHeader(id,field);},args:args(`
        list_id (string) ${_t("ID of the list.")}
        field_name (string) ${_t("Name of the field.")}
    `),returns:["NUMBER","STRING"],});return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/registries/menu_item_registry.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/registries/menu_item_registry',async function(require){'use strict';let __exports={};const{_t,_lt}=require("web.core");const{getFirstPivotFunction,getNumberOfPivotFormulas}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/odoo_functions_helpers");const{pivotFormulaRegex}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_helpers");const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{REINSERT_LIST_CHILDREN}=require("@documents_spreadsheet/js/o_spreadsheet/registries/list_actions");const{INSERT_PIVOT_CELL_CHILDREN,REINSERT_PIVOT_CHILDREN}=require("@documents_spreadsheet/js/o_spreadsheet/registries/pivot_actions");const{cellMenuRegistry,topbarMenuRegistry}=spreadsheet.registries;const{createFullMenuItem}=spreadsheet.helpers;const{astToFormula}=spreadsheet;topbarMenuRegistry.add("file",{name:_t("File"),sequence:10});topbarMenuRegistry.addChild("new_sheet",["file"],{name:_lt("New"),sequence:10,action:(env)=>env.newSpreadsheet(),});topbarMenuRegistry.addChild("make_copy",["file"],{name:_lt("Make a copy"),sequence:20,action:(env)=>env.makeCopy(),});topbarMenuRegistry.addChild("save_as_template",["file"],{name:_lt("Save as Template"),sequence:40,action:(env)=>env.saveAsTemplate(),});topbarMenuRegistry.addChild("download",["file"],{name:_lt("Download"),sequence:50,action:(env)=>env.download(),isReadonlyAllowed:true,});topbarMenuRegistry.add("data",{name:_lt("Data"),sequence:60,children:function(env){const pivots=env.getters.getPivotIds();const children=pivots.map((pivotId,index)=>createFullMenuItem(`item_pivot_${pivotId}`,{name:env.getters.getPivotDisplayName(pivotId),sequence:index,action:(env)=>{env.dispatch("SELECT_PIVOT",{pivotId:pivotId});env.openSidePanel("PIVOT_PROPERTIES_PANEL",{});},icon:"fa fa-table",separator:index===env.getters.getPivotIds().length-1,}));const lists=env.getters.getListIds().map((listId,index)=>{return createFullMenuItem(`item_list_${listId}`,{name:env.getters.getListDisplayName(listId),sequence:index+pivots.length,action:(env)=>{env.dispatch("SELECT_ODOO_LIST",{listId:listId});env.openSidePanel("LIST_PROPERTIES_PANEL",{});},icon:"fa fa-list",separator:index===env.getters.getListIds().length-1,});});return children.concat(lists).concat([createFullMenuItem(`refresh_all_data`,{name:_t("Refresh all data"),sequence:1000,action:(env)=>{env.dispatch("REFRESH_ALL_DATA_SOURCES");},separator:true,}),createFullMenuItem(`reinsert_pivot`,{name:_t("Re-insert pivot"),sequence:1010,children:REINSERT_PIVOT_CHILDREN,isVisible:(env)=>env.getters.getPivotIds().length,}),createFullMenuItem(`insert_pivot_cell`,{name:_t("Insert pivot cell"),sequence:1020,children:INSERT_PIVOT_CELL_CHILDREN,isVisible:(env)=>env.getters.getPivotIds().length,separator:true,}),createFullMenuItem(`reinsert_list`,{name:_t("Re-insert list"),sequence:1020,children:REINSERT_LIST_CHILDREN,isVisible:(env)=>env.getters.getListIds().length,}),]);},isVisible:(env)=>env.getters.getPivotIds().length||env.getters.getListIds().length,});cellMenuRegistry.add("reinsert_pivot",{name:_lt("Re-insert pivot"),sequence:185,children:REINSERT_PIVOT_CHILDREN,isVisible:(env)=>env.getters.getPivotIds().length,separator:true,}).add("insert_pivot_cell",{name:_lt("Insert pivot cell"),sequence:180,children:INSERT_PIVOT_CELL_CHILDREN,isVisible:(env)=>env.getters.getPivotIds().length,}).add("pivot_properties",{name:_lt("Pivot properties"),sequence:170,action(env){const[col,row]=env.getters.getPosition();const sheetId=env.getters.getActiveSheetId();const pivotId=env.getters.getPivotIdFromPosition(sheetId,col,row);env.dispatch("SELECT_PIVOT",{pivotId});env.openSidePanel("PIVOT_PROPERTIES_PANEL",{});},isVisible:(env)=>{const cell=env.getters.getActiveCell();return cell&&cell.isFormula()&&cell.content.match(pivotFormulaRegex);},}).add("listing_properties",{name:_lt("List properties"),sequence:190,action(env){const[col,row]=env.getters.getPosition();const sheetId=env.getters.getActiveSheetId();const listId=env.getters.getListIdFromPosition(sheetId,col,row);env.dispatch("SELECT_ODOO_LIST",{listId});env.openSidePanel("LIST_PROPERTIES_PANEL",{});},isVisible:(env)=>{const[col,row]=env.getters.getPosition();const sheetId=env.getters.getActiveSheetId();return env.getters.getListIdFromPosition(sheetId,col,row)!==undefined;},}).add("reinsert_list",{name:_lt("Re-insert list"),sequence:195,children:REINSERT_LIST_CHILDREN,isVisible:(env)=>env.getters.getListIds().length,separator:true,}).add("see records",{name:_lt("See records"),sequence:175,async action(env){const[col,row]=env.getters.getPosition();const sheetId=env.getters.getActiveSheetId();const cell=env.getters.getCell(sheetId,col,row);const{args}=getFirstPivotFunction(cell.content);const evaluatedArgs=args.map(astToFormula).map((arg)=>env.getters.evaluateFormula(arg));const pivotId=env.getters.getPivotIdFromPosition(sheetId,col,row);const model=env.getters.getPivotModel(pivotId);await env.getters.waitForPivotMetaData(pivotId);const cache=env.getters.getPivotStructureData(pivotId);const domain=cache.getDomainFromFormula(evaluatedArgs);const name=env.getters.getPivotModelDisplayName(pivotId);await env.services.action.doAction({type:"ir.actions.act_window",name,res_model:model,view_mode:"list",views:[[false,"list"]],target:"current",domain,});},isVisible:(env)=>{const cell=env.getters.getActiveCell();return(cell&&cell.evaluated.value!==""&&getNumberOfPivotFormulas(cell.content)===1);},});return __exports;});odoo.define(`documents_spreadsheet.MenuItemRegistry`,async function(require){return require('@documents_spreadsheet/js/o_spreadsheet/registries/menu_item_registry')[Symbol.for("default")];});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/registries/odoo_menu_link_cell.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/registries/odoo_menu_link_cell',async function(require){'use strict';let __exports={};const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{_lt}=require("@web/core/l10n/translation");const{IrMenuSelector}=require("@documents_spreadsheet/js/components/ir_menu_selector/ir_menu_selector");const{cellRegistry,linkMenuRegistry}=spreadsheet.registries;const{LinkCell}=spreadsheet.cellTypes;const{isMarkdownLink,parseMarkdownLink}=spreadsheet.helpers;const VIEW_PREFIX="odoo://view/";const IR_MENU_ID_PREFIX="odoo://ir_menu_id/";const IR_MENU_XML_ID_PREFIX="odoo://ir_menu_xml_id/";function isMarkdownViewLink(str){if(!isMarkdownLink(str)){return false;}
const{url}=parseMarkdownLink(str);return url.startsWith(VIEW_PREFIX);}
function parseViewLink(viewLink){if(viewLink.startsWith(VIEW_PREFIX)){return JSON.parse(viewLink.substr(VIEW_PREFIX.length))}
throw new Error(`${viewLink} is not a valid view link`);}
__exports.buildViewLink=buildViewLink;function buildViewLink(viewDescription){return`${VIEW_PREFIX}${JSON.stringify(viewDescription)}`;}
function isMarkdownIrMenuIdLink(str){if(!isMarkdownLink(str)){return false;}
const{url}=parseMarkdownLink(str);return url.startsWith(IR_MENU_ID_PREFIX);}
function parseIrMenuIdLink(irMenuLink){if(irMenuLink.startsWith(IR_MENU_ID_PREFIX)){return parseInt(irMenuLink.substr(IR_MENU_ID_PREFIX.length),10);}
throw new Error(`${irMenuLink} is not a valid menu id link`);}
__exports.buildIrMenuIdLink=buildIrMenuIdLink;function buildIrMenuIdLink(menuId){return`${IR_MENU_ID_PREFIX}${menuId}`;}
function isMarkdownIrMenuXmlLink(str){if(!isMarkdownLink(str)){return false;}
const{url}=parseMarkdownLink(str);return url.startsWith(IR_MENU_XML_ID_PREFIX);}
function parseIrMenuXmlLink(irMenuLink){if(irMenuLink.startsWith(IR_MENU_XML_ID_PREFIX)){return irMenuLink.substr(IR_MENU_XML_ID_PREFIX.length);}
throw new Error(`${irMenuLink} is not a valid menu xml link`);}
function buildIrMenuXmlLink(menuXmlId){return`${IR_MENU_XML_ID_PREFIX}${menuXmlId}`;}
class OdooMenuLinkCell extends LinkCell{constructor(id,content,menuId,menuName,properties={}){super(id,content,properties);this.urlRepresentation=menuName;this.isUrlEditable=false;this._irMenuId=menuId;}
action(env){env.services.menu.selectMenu(this._irMenuId);}}
class OdooViewLinkCell extends LinkCell{constructor(id,content,actionDescription,properties={}){super(id,content,properties);this.urlRepresentation=actionDescription.name;this.isUrlEditable=false;this._viewType=actionDescription.viewType;this._action=actionDescription.action;}
action(env){env.services.action.doAction({type:"ir.actions.act_window",name:this.urlRepresentation,res_model:this._action.modelName,views:this._action.views,target:'current',domain:this._action.domain,context:this._action.context,},{viewType:this._viewType,});}}
cellRegistry.add("OdooMenuIdLink",{sequence:65,match:isMarkdownIrMenuIdLink,createCell:(id,content,properties,sheetId,getters)=>{const{url}=parseMarkdownLink(content);const menuId=parseIrMenuIdLink(url);const menuName=getters.getIrMenuNameById(menuId);return new OdooMenuLinkCell(id,content,menuId,menuName,properties);},}).add("OdooMenuXmlLink",{sequence:66,match:isMarkdownIrMenuXmlLink,createCell:(id,content,properties,sheetId,getters)=>{const{url}=parseMarkdownLink(content);const xmlId=parseIrMenuXmlLink(url);const menuId=getters.getIrMenuIdByXmlId(xmlId);const menuName=getters.getIrMenuNameByXmlId(xmlId);return new OdooMenuLinkCell(id,content,menuId,menuName,properties);},}).add("OdooIrFilterLink",{sequence:67,match:isMarkdownViewLink,createCell:(id,content,properties,sheetId,getters)=>{const{url}=parseMarkdownLink(content);const actionDescription=parseViewLink(url);return new OdooViewLinkCell(id,content,actionDescription,properties);},});linkMenuRegistry.add("odooMenu",{name:_lt("Link an Odoo menu"),sequence:20,action:async(env)=>{return new Promise((resolve)=>{const closeDialog=env.services.dialog.add(IrMenuSelector,{onMenuSelected:(menuId)=>{closeDialog();const menu=env.services.menu.getMenu(menuId);const xmlId=menu.xmlid;const url=xmlId?buildIrMenuXmlLink(xmlId):buildIrMenuIdLink(menuId);const name=menu.name;const link={url,label:name};resolve({link,isUrlEditable:false,urlRepresentation:name,});},});});},});return __exports;});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/registries/pivot_actions.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/registries/pivot_actions',async function(require){'use strict';let __exports={};const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{createFullMenuItem}=spreadsheet.helpers;const REINSERT_PIVOT_CHILDREN=__exports.REINSERT_PIVOT_CHILDREN=(env)=>env.getters.getPivotIds().map((pivotId,index)=>createFullMenuItem(`reinsert_pivot_${pivotId}`,{name:env.getters.getPivotDisplayName(pivotId),sequence:index,action:async(env)=>{await env.getters.waitForPivotDataReady(pivotId,{initialDomain:true,force:true,});const zone=env.getters.getSelectedZone();env.dispatch("REBUILD_PIVOT",{id:pivotId,anchor:[zone.left,zone.top],});if(env.getters.getActiveFilterCount()){await env.getters.waitForPivotDataReady(pivotId,{initialDomain:false,force:true,});}
env.dispatch("EVALUATE_CELLS",{sheetId:env.getters.getActiveSheetId()});},}));const INSERT_PIVOT_CELL_CHILDREN=__exports.INSERT_PIVOT_CELL_CHILDREN=(env)=>env.getters.getPivotIds().map((pivotId,index)=>createFullMenuItem(`insert_pivot_cell_${pivotId}`,{name:env.getters.getPivotDisplayName(pivotId),sequence:index,action:async(env)=>{const sheetId=env.getters.getActiveSheetId();const[col,row]=env.getters.getMainCell(sheetId,...env.getters.getPosition());const insertPivotValueCallback=(formula)=>{env.dispatch("UPDATE_CELL",{sheetId,col,row,content:formula,});};await env.getters.waitForPivotDataReady(pivotId,{force:true});env.dispatch("EVALUATE_CELLS",{sheetId:env.getters.getActiveSheetId()});env.openPivotDialog({pivotId:pivotId,insertPivotValueCallback});},}));return __exports;});odoo.define(`documents_spreadsheet.pivot_actions`,async function(require){return require('@documents_spreadsheet/js/o_spreadsheet/registries/pivot_actions');});;

/* /documents_spreadsheet/static/src/js/o_spreadsheet/registries/pivot_functions.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/o_spreadsheet/registries/pivot_functions',async function(require){'use strict';let __exports={};const{_t}=require("web.core");const spreadsheet=require("@documents_spreadsheet/js/o_spreadsheet/o_spreadsheet_loader")[Symbol.for("default")];const{args,toString}=spreadsheet.helpers;const{functionRegistry}=spreadsheet.registries;functionRegistry.add("FILTER_VALUE",{description:_t("Return the current value of a spreadsheet filter."),compute:function(filterName){return this.getters.getFilterDisplayValue(filterName);},args:args(`
            filter_name (string) ${_t("The label of the filter whose value to return.")}
        `),returns:["STRING"],}).add("PIVOT",{description:_t("Get the value from a pivot."),compute:function(pivotId,measureName,...domain){pivotId=toString(pivotId);const measure=toString(measureName);const args=domain.map(toString);this.getters.validatePivotArguments(pivotId,measure,args);return this.getters.getPivotValue(pivotId,measure,args,this);},args:args(`
        pivot_id (string) ${_t("ID of the pivot.")}
        measure_name (string) ${_t("Name of the measure.")}
        domain_field_name (string,optional,repeating) ${_t("Field name.")}
        domain_value (string,optional,repeating) ${_t("Value.")}
    `),returns:["NUMBER","STRING"],}).add("PIVOT_HEADER",{description:_t("Get the header of a pivot."),compute:function(pivotId,...domain){pivotId=toString(pivotId);const args=domain.map(toString);this.getters.validatePivotHeaderArguments(pivotId,args);return this.getters.getPivotHeaderValue(pivotId,args);},args:args(`
        pivot_id (string) ${_t("ID of the pivot.")}
        domain_field_name (string,optional,repeating) ${_t("Field name.")}
        domain_value (string,optional,repeating) ${_t("Value.")}
    `),returns:["NUMBER","STRING"],}).add("PIVOT.POSITION",{description:_t("Get the absolute ID of an element in the pivot"),compute:function(){throw new Error(_t(`[[FUNCTION_NAME]] cannot be called from the spreadsheet.`));},args:args(`
            pivot_id (string) ${_t("ID of the pivot.")}
            field_name (string) ${_t("Name of the field.")}
            position (number) ${_t("Position in the pivot")}
        `),returns:["STRING"],});return __exports;});;

/* /documents_spreadsheet/static/src/js/pivot_view.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/pivot_view',async function(require){'use strict';let __exports={};const{createEmptySpreadsheet}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/helpers");const{helpers}=require("documents_spreadsheet.spreadsheet_extended");const PivotDataSource=require("@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_data_source")[Symbol.for("default")];const{PivotView}=require("@web/views/pivot/pivot_view");const{sanitizePivot}=require("@documents_spreadsheet/js/o_spreadsheet/helpers/pivot_helpers");const SpreadsheetSelectorDialog=require("documents_spreadsheet.SpreadsheetSelectorDialog");const{sprintf}=require("@web/core/utils/strings");const{patch}=require("@web/core/utils/patch");const{useService}=require("@web/core/utils/hooks");const uuidGenerator=new helpers.UuidGenerator();const{hooks}=owl;const{onWillStart}=hooks;patch(PivotView.prototype,"pivot_spreadsheet",{setup(){this._super.apply(this,arguments);this.userService=useService("user");this.orm=useService("orm");this.notification=useService("notification");this.actionService=useService("action");onWillStart(async()=>{this.canInsertPivot=await this.userService.hasGroup("documents.group_documents_user");});},async onInsertInSpreadsheet(){const spreadsheets=await this.orm.call("documents.document","get_spreadsheets_to_display",[],[]);const params={spreadsheets,title:this.env._t("Select a spreadsheet to insert your pivot"),};const dialog=new SpreadsheetSelectorDialog(this,params).open();dialog.on("confirm",this,this.insertInSpreadsheet);},async getCallbackBuildPivot(isEmptySpreadsheet){const pivot=this.getPivotForSpreadsheet();const cache=await this.getPivotCache(pivot);return(model)=>{if(!isEmptySpreadsheet){const sheetId=uuidGenerator.uuidv4();const sheetIdFrom=model.getters.getActiveSheetId();model.dispatch("CREATE_SHEET",{sheetId,position:model.getters.getVisibleSheets().length,});model.dispatch("ACTIVATE_SHEET",{sheetIdFrom,sheetIdTo:sheetId});}
pivot.id=model.getters.getNextPivotId();model.dispatch("BUILD_PIVOT",{sheetId:model.getters.getActiveSheetId(),pivot,cache,anchor:[0,0],});};},getPivotForSpreadsheet(){return sanitizePivot(this.model);},async getPivotCache(pivot){const dataSource=new PivotDataSource({rpc:this.orm,definition:pivot,model:pivot.model,});return dataSource.get({domain:pivot.domain});},async insertInSpreadsheet({id:spreadsheet}){let documentId;let notificationMessage;if(!spreadsheet){documentId=await createEmptySpreadsheet(this.orm);notificationMessage=this.env._t("New spreadsheet created in Documents");}else{documentId=spreadsheet.id;notificationMessage=notificationMessage=sprintf(this.env._t("New sheet inserted in '%s'"),spreadsheet.name);}
this.notification.add(notificationMessage,{type:"info"});this.actionService.doAction({type:"ir.actions.client",tag:"action_open_spreadsheet",params:{active_id:documentId,initCallback:await this.getCallbackBuildPivot(!spreadsheet),},});},});PivotView.buttonTemplate="documents_spreadsheet.PivotView.buttons";return __exports;});;

/* /documents_spreadsheet/static/src/js/spreadsheet_kanban_view.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.KanbanView",function(require){"use strict";const SpreadsheetKanbanController=require("documents_spreadsheet.KanbanController");const KanbanView=require("documents.DocumentsKanbanView");const viewRegistry=require("web.view_registry");const SpreadsheetKanbanView=KanbanView.extend({config:Object.assign({},KanbanView.prototype.config,{Controller:SpreadsheetKanbanController,}),});viewRegistry.add("documents_kanban",SpreadsheetKanbanView);return SpreadsheetKanbanView;});;

/* /documents_spreadsheet/static/src/js/spreadsheet_list_view.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.ListView",function(require){"use strict";const SpreadsheetListController=require("spreadsheet.DocumentsListController");const ListView=require("documents.DocumentsListView");const viewRegistry=require("web.view_registry");const DocumentsListView=ListView.extend({config:Object.assign({},ListView.prototype.config,{Controller:SpreadsheetListController,}),});viewRegistry.add("documents_list",DocumentsListView);return DocumentsListView;});;

/* /documents_spreadsheet/static/src/js/spreadsheet_selector_dialog.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.SpreadsheetSelectorDialog",function(require){"use strict";const core=require("web.core");const Dialog=require("web.Dialog");const _t=core._t;const SpreadsheetSelectorDialog=Dialog.extend({template:"documents_spreadsheet.SpreadsheetSelectorDialog",init:function(parent,params){this.spreadsheets=params.spreadsheets;this.threshold=params.threshold;this.maxThreshold=params.maxThreshold;const options={title:params.title||_t("Select a spreadsheet to insert your pivot"),buttons:[{text:_t("Confirm"),classes:"btn-primary",click:this._onConfirm.bind(this),close:true,},{text:_t("Cancel"),click:this._onCancel.bind(this),close:true,},],};this._super(parent,options);},_onConfirm:function(){const id=this.el.querySelector("select[name='spreadsheet']").value;let selectedSpreadsheet=false;if(id!==""){selectedSpreadsheet=this.spreadsheets.find((s)=>s.id===parseInt(id,10));}
const threshold=this.threshold?Math.min(this.el.querySelector("input[id='threshold']").value,this.maxThreshold):0;this.trigger("confirm",{id:selectedSpreadsheet,threshold});},_onCancel:function(){this.trigger("cancel");},});return SpreadsheetSelectorDialog;});;

/* /documents_spreadsheet/static/src/js/spreadsheet_template_list_view.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.TemplateListView",function(require){"use strict";const ListController=require("web.ListController");const ListView=require("web.ListView");const viewRegistry=require("web.view_registry");const{getDataFromTemplate}=require("documents_spreadsheet.pivot_utils");const TemplateController=ListController.extend({_callButtonAction(attrs,record){if(attrs.name==="create_spreadsheet"){this._createSpreadsheet(record);}else if(attrs.name==="edit_template"){this._editTemplate(record);}else{return this._super(...arguments);}},async _createSpreadsheet(record){const data=await getDataFromTemplate(this._rpc.bind(this),record.data.id);const spreadsheetId=await this._rpc({model:"documents.document",method:"create",args:[{name:record.data.name,mimetype:"application/o-spreadsheet",handler:"spreadsheet",raw:JSON.stringify(data),},],});this.do_action({type:"ir.actions.client",tag:"action_open_spreadsheet",params:{spreadsheet_id:spreadsheetId,},});},async _editTemplate(record){this.do_action({type:"ir.actions.client",tag:"action_open_template",params:{spreadsheet_id:record.data.id,showFormulas:true,},});},});const TemplateListView=ListView.extend({config:Object.assign({},ListView.prototype.config,{Controller:TemplateController,}),});viewRegistry.add("spreadsheet_template_list",TemplateListView);return TemplateListView;});;

/* /documents_spreadsheet/static/src/js/widgets/field_selector_widget.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.field_selector_widget",function(require){const config=require("web.config");const FieldSelectorWidget=require("web.ModelFieldSelector");const{ComponentAdapter}=require("web.OwlCompatibility");const filters={text:["many2one","text","char"],date:["datetime","date"],relation:["many2one","many2many","one2many"],};class FieldSelectorAdapter extends ComponentAdapter{setup(){this.env=owl.Component.env;}
filter(fields,typeFilter,relatedModel){const _fields={};for(let[key,value]of Object.entries(fields)){if(filters[typeFilter].includes(value.type)){if(!relatedModel||value.relation===relatedModel){_fields[key]=value;}}}
return _fields;}
get widgetArgs(){const fields=this.filter(this.props.fields,this.props.type,this.props.relatedModel);const chain=this.props.selected?[this.props.selected.field]:[];return[this.props.model,chain,{fields,readonly:false,followRelations:false,debugMode:config.isDebug(),},];}}
return{FieldSelectorWidget,FieldSelectorAdapter};});;

/* /documents_spreadsheet/static/src/js/widgets/model_selector_widget.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.model_selector_widget",function(require){const{ComponentAdapter}=require("web.OwlCompatibility");class ModelSelectorWidgetAdapter extends ComponentAdapter{setup(){this.env=owl.Component.env;}
get widgetArgs(){return["ir.model",this.props.modelID,[["model","in",this.props.models]],];}}
return{ModelSelectorWidgetAdapter};});;

/* /documents_spreadsheet/static/src/js/widgets/standalone_many2one_field.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/js/widgets/standalone_many2one_field',async function(require){'use strict';let __exports={};const Widget=require("web.Widget");const StandaloneFieldManagerMixin=require("web.StandaloneFieldManagerMixin");const{FieldMany2One}=require("web.relational_fields");const{qweb}=require("web.core");const StandaloneMany2OneField=Widget.extend(StandaloneFieldManagerMixin,{init:function(parent,modelName,value,domain,attrs={}){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.widget=undefined;this.modelName=modelName;this.value=value;this.domain=domain;this.attrs=attrs;},willStart:async function(){await this._super.apply(this,arguments);await this._createM2OWidget();},start:function(){const $content=$(qweb.render("documents_spreadsheet.StandaloneMany2OneField",{}));this.$el.append($content);this.widget.appendTo($content);return this._super.apply(this,arguments);},getFocusableElement(){return this.widget.getFocusableElement()[0];},_confirmChange:async function(){const result=await StandaloneFieldManagerMixin._confirmChange.apply(this,arguments);this.trigger_up("value-changed",{value:this.widget.value.res_id});return result;},_createM2OWidget:async function(){const recordID=await this.model.makeRecord(this.modelName,[{name:this.modelName,relation:this.modelName,type:"many2one",value:this.value,domain:this.domain,},]);this.widget=new FieldMany2One(this,this.modelName,this.model.get(recordID),{mode:"edit",attrs:{can_create:false,can_write:false,options:{no_open:true},...this.attrs,},});this._registerWidget(recordID,this.modelName,this.widget);},});Object.assign(__exports,{StandaloneMany2OneField});return __exports;});;

/* /documents_spreadsheet/static/src/js/widgets/tag_selector_widget.js defined in bundle 'web.assets_backend' */
odoo.define("documents_spreadsheet.tag_selector_widget",function(require){"use strict";const core=require("web.core");const{ComponentAdapter}=require("web.OwlCompatibility");const{FieldMany2ManyTags}=require("web.relational_fields");const StandaloneFieldManagerMixin=require("web.StandaloneFieldManagerMixin");const Widget=require("web.Widget");const QWeb=core.qweb;const TagSelectorWidget=Widget.extend(StandaloneFieldManagerMixin,{init:function(parent,relatedModel,selectedValues){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.relatedModel=relatedModel;this.selectedValues=selectedValues;this.widget=undefined;},willStart:async function(){await this._super.apply(this,arguments);await this._makeM2MWidget();},start:function(){const $content=$(QWeb.render("documents_spreadsheet.RelationTags",{}));this.$el.append($content);this.widget.appendTo($content);return this._super.apply(this,arguments);},_confirmChange:async function(){const result=await StandaloneFieldManagerMixin._confirmChange.apply(this,arguments);this.trigger_up("value_changed",{value:this.widget.value.data.map((record)=>record.data)});return result;},_makeM2MWidget:async function(){const options={};options[this.relatedModel]={options:{no_create_edit:true,no_create:true,},};const recordID=await this.model.makeRecord(this.relatedModel,[{fields:[{name:"id",type:"integer",},{name:"display_name",type:"char",},],name:this.relatedModel,relation:this.relatedModel,type:"many2many",value:this.selectedValues,},],options);this.widget=new FieldMany2ManyTags(this,this.relatedModel,this.model.get(recordID),{mode:"edit"});this._registerWidget(recordID,this.relatedModel,this.widget);},});class TagSelectorWidgetAdapter extends ComponentAdapter{setup(){this.env=owl.Component.env;}
get widgetArgs(){return[this.props.relatedModel,this.props.selectedValues];}}
return{TagSelectorWidget,TagSelectorWidgetAdapter};});;

/* /documents_spreadsheet/static/src/side_panels/domain_component_adapter.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/side_panels/domain_component_adapter',async function(require){'use strict';let __exports={};const{ComponentAdapter}=require("web.OwlCompatibility");const DomainComponentAdapter=__exports[Symbol.for("default")]=class DomainComponentAdapter extends ComponentAdapter{setup(){this.env=owl.Component.env;}
get widgetArgs(){return[this.props.model,this.props.domain,{readonly:true,filters:{}}];}}
return __exports;});;

/* /documents_spreadsheet/static/src/side_panels/list/listing_all_side_panel.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/side_panels/list/listing_all_side_panel',async function(require){'use strict';let __exports={};const{ListingDetailsSidePanel}=require("@documents_spreadsheet/side_panels/list/listing_details_side_panel");const ListingAllSidePanel=__exports[Symbol.for("default")]=class ListingAllSidePanel extends owl.Component{constructor(){super(...arguments);this.getters=this.env.getters;}
selectListing(listId){this.env.dispatch("SELECT_ODOO_LIST",{listId});}
resetListingSelection(){this.env.dispatch("SELECT_ODOO_LIST");}}
ListingAllSidePanel.template="documents_spreadsheet.ListingAllSidePanel";ListingAllSidePanel.components={ListingDetailsSidePanel};return __exports;});;

/* /documents_spreadsheet/static/src/side_panels/list/listing_details_side_panel.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/side_panels/list/listing_details_side_panel',async function(require){'use strict';let __exports={};const DomainSelector=require("web.DomainSelector");const{_t}=require("web.core");const{time_to_str}=require("web.time");const DomainComponentAdapter=require("@documents_spreadsheet/side_panels/domain_component_adapter")[Symbol.for("default")];const ListingDetailsSidePanel=__exports.ListingDetailsSidePanel=class ListingDetailsSidePanel extends owl.Component{constructor(){super(...arguments);this.getters=this.env.getters;this.DomainSelector=DomainSelector;}
get listDefinition(){const listId=this.props.listId;return{model:this.getters.getListModel(listId),modelDisplayName:this.getters.getListModelDisplayName(listId),domain:this.getters.getListDomain(listId),orderBy:this.getters.getListOrderBy(listId),};}
formatSort(sort){return`${this.getters.getListFieldName(this.props.listId, sort.name)} (${
            sort.asc ? _t("ascending") : _t("descending")
        })`;}
getLastUpdate(){const lastUpdate=this.getters.getListLastUpdate(this.props.listId);if(lastUpdate){return time_to_str(new Date(lastUpdate));}
return _t("never");}
async refresh(){this.env.dispatch("REFRESH_ODOO_LIST",{listId:this.props.listId});this.env.dispatch("EVALUATE_CELLS",{sheetId:this.getters.getActiveSheetId()});}}
ListingDetailsSidePanel.template="documents_spreadsheet.ListingDetailsSidePanel";ListingDetailsSidePanel.components={DomainComponentAdapter};ListingDetailsSidePanel.props={listId:{type:String,optional:true,},};return __exports;});;

/* /documents_spreadsheet/static/src/side_panels/pivot/pivot_details_side_panel.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/side_panels/pivot/pivot_details_side_panel',async function(require){'use strict';let __exports={};const{_t}=require("web.core");const DomainSelector=require("web.DomainSelector");const{time_to_str}=require("web.time");const DomainComponentAdapter=require("@documents_spreadsheet/side_panels/domain_component_adapter")[Symbol.for("default")];const PivotDetailsSidePanel=__exports.PivotDetailsSidePanel=class PivotDetailsSidePanel extends owl.Component{constructor(){super(...arguments);this.getters=this.env.getters;this.DomainSelector=DomainSelector;}
get pivotDefinition(){const pivotId=this.props.pivotId;return{model:this.getters.getPivotModel(pivotId),modelDisplayName:this.getters.getPivotModelDisplayName(pivotId),domain:this.getters.getPivotDomain(pivotId),dimensions:this.getters.getPivotRowGroupBys(pivotId).concat(this.getters.getPivotColGroupBys(pivotId)),measures:this.getters.getPivotMeasures(pivotId),};}
getLastUpdate(){const lastUpdate=this.getters.getPivotLastUpdate(this.props.pivotId);if(lastUpdate){return time_to_str(new Date(lastUpdate));}
return _t("never");}
refresh(){this.env.dispatch("REFRESH_PIVOT",{id:this.props.pivotId});}}
PivotDetailsSidePanel.template="documents_spreadsheet.PivotDetailsSidePanel";PivotDetailsSidePanel.components={DomainComponentAdapter};PivotDetailsSidePanel.props={pivotId:{type:String,optional:true,},};return __exports;});;

/* /documents_spreadsheet/static/src/side_panels/pivot/pivot_list_side_panel.js defined in bundle 'web.assets_backend' */
odoo.define('@documents_spreadsheet/side_panels/pivot/pivot_list_side_panel',async function(require){'use strict';let __exports={};const{PivotDetailsSidePanel}=require("@documents_spreadsheet/side_panels/pivot/pivot_details_side_panel");const PivotSidePanel=__exports[Symbol.for("default")]=class PivotSidePanel extends owl.Component{constructor(){super(...arguments);this.getters=this.env.getters;}
selectPivot(pivotId){this.env.dispatch("SELECT_PIVOT",{pivotId});}
resetSelectedPivot(){this.env.dispatch("SELECT_PIVOT");}}
PivotSidePanel.template="documents_spreadsheet.PivotSidePanel";PivotSidePanel.components={PivotDetailsSidePanel};return __exports;});;

/* /iap/static/src/js/iap_buy_more_credits.js defined in bundle 'web.assets_backend' */
odoo.define('iap.buy_more_credits',function(require){'use strict';var widgetRegistry=require('web.widget_registry');var Widget=require('web.Widget');var core=require('web.core');var rpc=require('web.rpc');const utils=require('web.utils');var QWeb=core.qweb;var IAPBuyMoreCreditsWidget=Widget.extend({className:'o_field_iap_buy_more_credits',init:function(parent,data,options){this._super.apply(this,arguments);this.service_name=options.attrs.service_name;this.hideService=utils.toBoolElse(options.attrs.hide_service||'',false);},start:function(){this.$widget=$(QWeb.render('iap.buy_more_credits',{'hideService':this.hideService}));this.$buyLink=this.$widget.find('.buy_credits');this.$widget.appendTo(this.$el);this.$buyLink.click(this._getLink.bind(this));if(!this.hideService){this.el.querySelector('.o_iap_view_my_services').addEventListener('click',this._getMyServices.bind(this));}},_getLink:function(){var self=this;return rpc.query({model:'iap.account',method:'get_credits_url',args:[this.service_name],},{shadow:true,}).then(function(url){return self.do_action({type:'ir.actions.act_url',url:url,});});},_getMyServices(){return this._rpc({model:'iap.account',method:'get_account_url',}).then(url=>{this.do_action({type:'ir.actions.act_url',url:url});});},});widgetRegistry.add('iap_buy_more_credits',IAPBuyMoreCreditsWidget);return IAPBuyMoreCreditsWidget;});;

/* /iap/static/src/js/insufficient_credit_error_handler.js defined in bundle 'web.assets_backend' */
odoo.define('@iap/js/insufficient_credit_error_handler',async function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");class InsufficientCreditDialog extends Dialog{setup(){super.setup(...arguments);this.orm=useService("orm");}
async willStart(){const{errorData}=this.props;this.url=await this.orm.call("iap.account","get_credits_url",[],{base_url:errorData.base_url,service_name:errorData.service_name,credit:errorData.credit,trial:errorData.trial,});this.style=errorData.body?"padding:0;":"";const{_t}=this.env;const{isEnterprise}=odoo.info;if(errorData.trial&&isEnterprise){this.buttonMessage=_t("Start a Trial at Odoo");}else{this.buttonMessage=_t("Buy credits");}}
buyCredits(){window.open(this.url,"_blank");this.close();}}
InsufficientCreditDialog.bodyTemplate="iap.redirect_to_odoo_credit";InsufficientCreditDialog.footerTemplate="iap.InsufficientCreditFooter";function insufficientCreditHandler(env,error,originalError){if(!originalError){return false;}
const{data}=originalError;if(data&&data.name==="odoo.addons.iap.tools.iap_tools.InsufficientCreditError"){env.services.dialog.add(InsufficientCreditDialog,{errorData:JSON.parse(data.message),});return true;}
return false;}
registry.category("error_handlers").add("insufficientCreditHandler",insufficientCreditHandler,{sequence:0});return __exports;});;

/* /mail_bot/static/src/models/messaging_initializer/messaging_initializer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail_bot/models/messaging_initializer/messaging_initializer',async function(require){'use strict';let __exports={};const{registerInstancePatchModel}=require('@mail/model/model_core');registerInstancePatchModel('mail.messaging_initializer','mail_bot/static/src/models/messaging_initializer/messaging_initializer.js',{async _initializeOdooBot(){const data=await this.async(()=>this.env.services.rpc({model:'mail.channel',method:'init_odoobot',}));if(!data){return;}
this.env.session.odoobot_initialized=true;},async start(){await this.async(()=>this._super());if('odoobot_initialized'in this.env.session&&!this.env.session.odoobot_initialized){this._initializeOdooBot();}},});return __exports;});;

/* /web_mobile/static/src/js/core/dialog.js defined in bundle 'web.assets_backend' */
odoo.define("web_mobile.Dialog",function(require){"use strict";var Dialog=require("web.Dialog");var mobileMixins=require("web_mobile.mixins");Dialog.include(_.extend({},mobileMixins.BackButtonEventMixin,{_onBackButton:function(){this.close();},}));});odoo.define("web_mobile.OwlDialog",function(require){"use strict";const OwlDialog=require("web.OwlDialog");const{useBackButton}=require("web_mobile.hooks");const{patch}=require("web.utils");patch(OwlDialog.prototype,"web_mobile",{setup(){this._super(...arguments);useBackButton(this._onBackButton.bind(this));},_onBackButton(){this._close();},});});odoo.define("web_mobile.Popover",function(require){"use strict";const Popover=require("web.Popover");const{useBackButton}=require("web_mobile.hooks");const{patch}=require("web.utils");patch(Popover.prototype,"web_mobile",{setup(){this._super(...arguments);useBackButton(this._onBackButton.bind(this),()=>this.state.displayed);},_onBackButton(){this._close();},});});odoo.define("web_mobile.ControlPanel",function(require){"use strict";const{device}=require("web.config");if(!device.isMobile){return;}
const ControlPanel=require("web.ControlPanel");const{useBackButton}=require("web_mobile.hooks");const{patch}=require("web.utils");patch(ControlPanel.prototype,"web_mobile",{setup(){this._super(...arguments);useBackButton(this._onBackButton.bind(this),()=>this.state.showMobileSearch);},_onBackButton(){this._resetSearchState();},});});;

/* /web_mobile/static/src/js/core/mixins.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.mixins',function(require){"use strict";const session=require('web.session');const mobile=require('web_mobile.core');var BackButtonEventMixin={on_attach_callback:function(){mobile.backButtonManager.addListener(this,this._onBackButton);},on_detach_callback:function(){mobile.backButtonManager.removeListener(this,this._onBackButton);},_onBackButton:function(){},};const UpdateDeviceAccountControllerMixin={async saveRecord(){const changedFields=await this._super(...arguments);this.savingDef=this.savingDef.then(()=>session.updateAccountOnMobileDevice());return changedFields;},};session.is_bound.then(()=>session.updateAccountOnMobileDevice());return{BackButtonEventMixin:BackButtonEventMixin,UpdateDeviceAccountControllerMixin,};});odoo.define('web_mobile.hooks',function(require){"use strict";const{backButtonManager}=require('web_mobile.core');const{Component,hooks}=owl;const{onWillUnmount,onMounted,onPatched}=hooks;function useBackButton(func,shouldEnable){const component=Component.current;let isEnabled=false;function enable(){backButtonManager.addListener(component,func);isEnabled=true;}
function disable(){backButtonManager.removeListener(component);isEnabled=false;}
onMounted(()=>{if(shouldEnable&&!shouldEnable()){return;}
enable();});onPatched(()=>{if(!shouldEnable){return;}
const shouldBeEnabled=shouldEnable();if(shouldBeEnabled&&!isEnabled){enable();}else if(!shouldBeEnabled&&isEnabled){disable();}});onWillUnmount(()=>{if(isEnabled){disable();}});}
return{useBackButton,};});;

/* /web_mobile/static/src/js/core/network/download.js defined in bundle 'web.assets_backend' */
odoo.define('@web_mobile/js/core/network/download',async function(require){'use strict';let __exports={};const mobile=require("web_mobile.core");const{download}=require("@web/core/network/download");const _download=download._download;download._download=async function(options){if(mobile.methods.downloadFile){if(odoo.csrf_token){options.csrf_token=odoo.csrf_token;}
mobile.methods.downloadFile(options);return Promise.resolve();}else{return _download.apply(this,arguments);}};return __exports;});;

/* /web_mobile/static/src/js/core/session.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.Session',function(require){"use strict";const core=require('web.core');const Session=require('web.Session');const utils=require('web.utils');const mobile=require('web_mobile.core');Session.include({get_file:function(options){if(mobile.methods.downloadFile){if(core.csrf_token){options.csrf_token=core.csrf_token;}
mobile.methods.downloadFile(options);if(options.success){options.success();}
if(options.complete){options.complete();}
return true;}else{return this._super.apply(this,arguments);}},async updateAccountOnMobileDevice(){if(!mobile.methods.updateAccount){return;}
const avatar=await this.fetchAvatar();const base64Avatar=await utils.getDataURLFromFile(avatar);return mobile.methods.updateAccount({avatar:base64Avatar.substring(base64Avatar.indexOf(',')+1),name:this.name,username:this.username,});},async fetchAvatar(){const url=this.url('/web/image',{model:'res.users',field:'image_medium',id:this.uid,});const response=await fetch(url);return response.blob();},});});;

/* /web_mobile/static/src/js/crash_manager.js defined in bundle 'web.assets_backend' */
odoo.define('@web_mobile/js/crash_manager',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const mobile=require("web_mobile.core");function mobileErrorHandler(env,error,originalError){if(mobile.methods.crashManager){error.originalError=originalError;mobile.methods.crashManager(error);}}
registry.category("error_handlers").add("web_mobile.errorHandler",mobileErrorHandler,{sequence:3});return __exports;});;

/* /web_mobile/static/src/js/datepicker.js defined in bundle 'web.assets_backend' */
odoo.define("web_mobile.datepicker",function(require){"use strict";const config=require("web.config");const mobile=require("web_mobile.core");const web_datepicker=require("web.datepicker");const Widget=require("web.Widget");web_datepicker.DateWidget.include({start(){if(!mobile.methods.requestDateTimePicker||(this.type_of_date==='datetime'&&config.device.isIOS)){return this._super(...arguments);}
this.$input=this.$("input.o_datepicker_input");this.$input.removeClass('datetimepicker-input')
this._setupMobilePicker();},destroy(){if(!mobile.methods.requestDateTimePicker||(this.type_of_date==='datetime'&&config.device.isIOS)){return this._super(...arguments);}
Widget.prototype.destroy.apply(this,arguments);},maxDate(){if(!mobile.methods.requestDateTimePicker||(this.type_of_date==='datetime'&&config.device.isIOS)){return this._super(...arguments);}
console.warn("Unsupported in the mobile applications");},minDate(){if(!mobile.methods.requestDateTimePicker||(this.type_of_date==='datetime'&&config.device.isIOS)){return this._super(...arguments);}
console.warn("Unsupported in the mobile applications");},_setLibInputValue(){if(!mobile.methods.requestDateTimePicker||(this.type_of_date==='datetime'&&config.device.isIOS)){return this._super(...arguments);}},_setupMobilePicker(){this.$el.on("click",async()=>{const{data}=await mobile.methods.requestDateTimePicker({value:this.getValue()?this.getValue().format("YYYY-MM-DD HH:mm:ss"):false,type:this.type_of_date,ignore_timezone:true,});this.$input.val(data);this.changeDatetime();});},_onInputClicked:function(){if(!mobile.methods.requestDateTimePicker||(this.type_of_date==='datetime'&&config.device.isIOS)){return this._super(...arguments);}},});});;

/* /web_mobile/static/src/js/mobile_service.js defined in bundle 'web.assets_backend' */
odoo.define('@web_mobile/js/mobile_service',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const mobile=require("web_mobile.core");const{shortcutItem,switchAccountItem}=require("@web_mobile/js/user_menu_items");const serviceRegistry=registry.category("services");const userMenuRegistry=registry.category("user_menuitems");const mobileService={start(){if(mobile.methods.addHomeShortcut){userMenuRegistry.add("web_mobile.shortcut",shortcutItem);}
if(mobile.methods.switchAccount){userMenuRegistry.remove('log_out');userMenuRegistry.remove('odoo_account');userMenuRegistry.add("web_mobile.switch",switchAccountItem);}},};serviceRegistry.add("mobile",mobileService);return __exports;});;

/* /web_mobile/static/src/js/services/core.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.core',function(){"use strict";var available=typeof OdooDeviceUtility!=='undefined';var DeviceUtility;var deferreds={};var methods={};if(available){DeviceUtility=OdooDeviceUtility;delete window.OdooDeviceUtility;}
function native_invoke(name,args){if(_.isUndefined(args)){args={};}
var id=_.uniqueId();args=JSON.stringify(args);DeviceUtility.execute(name,args,id);return new Promise(function(resolve,reject){deferreds[id]={successCallback:resolve,errorCallback:reject};});}
window.odoo.native_notify=function(id,result){if(deferreds.hasOwnProperty(id)){if(result.success){deferreds[id].successCallback(result);}else{deferreds[id].errorCallback(result);}}};var plugins=available?JSON.parse(DeviceUtility.list_plugins()):[];_.each(plugins,function(plugin){methods[plugin.name]=function(args){return native_invoke(plugin.action,args);};});if(methods.hashChange){var currentHash;$(window).bind('hashchange',function(event){var hash=event.getState();if(!_.isEqual(currentHash,hash)){methods.hashChange(hash);}
currentHash=hash;});}
class BackButtonListenerError extends Error{}
class BackButtonManager{constructor(){this._listeners=new Map();this._onGlobalBackButton=this._onGlobalBackButton.bind(this);}
addListener(listener,func){if(!methods.overrideBackButton){return;}
if(this._listeners.has(listener)){throw new BackButtonListenerError("This listener was already registered.");}
this._listeners.set(listener,func);if(this._listeners.size===1){document.addEventListener('backbutton',this._onGlobalBackButton);methods.overrideBackButton({enabled:true});}}
removeListener(listener){if(!methods.overrideBackButton){return;}
if(!this._listeners.has(listener)){throw new BackButtonListenerError("This listener has already been unregistered.");}
this._listeners.delete(listener);if(this._listeners.size===0){document.removeEventListener('backbutton',this._onGlobalBackButton);methods.overrideBackButton({enabled:false});}}
_onGlobalBackButton(){const[listener,func]=[...this._listeners].pop();if(listener){func.apply(listener,arguments);}}}
const backButtonManager=new BackButtonManager();return{BackButtonManager,BackButtonListenerError,backButtonManager,methods,};});;

/* /web_mobile/static/src/js/user_menu_items.js defined in bundle 'web.assets_backend' */
odoo.define('@web_mobile/js/user_menu_items',async function(require){'use strict';let __exports={};const mobile=require("web_mobile.core");__exports.shortcutItem=shortcutItem;function shortcutItem(env){return{type:"item",id:"web_mobile.shortcut",description:env._t("Add to Home Screen"),callback:()=>{const{hash}=env.services.router.current;if(hash.menu_id){const menu=env.services.menu.getMenu(hash.menu_id);mobile.methods.addHomeShortcut({title:document.title,shortcut_url:document.URL,web_icon:menu&&menu.webIconData,});}else{env.services.notification.notify({message:env._t("No shortcut for Home Menu"),});}},sequence:100,};}
__exports.switchAccountItem=switchAccountItem;function switchAccountItem(env){return{type:"item",id:"web_mobile.switch",description:env._t("Switch/Add Account"),callback:()=>{mobile.methods.switchAccount();},sequence:100,};}
return __exports;});;

/* /web_mobile/static/src/js/user_preferences_form_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.UserPreferencesFormView',function(require){'use strict';const FormView=require('web.FormView');const viewRegistry=require('web.view_registry');const{UpdateDeviceAccountControllerMixin}=require('web_mobile.mixins');const UserPreferencesFormView=FormView.extend({config:Object.assign({},FormView.prototype.config,{Controller:FormView.prototype.config.Controller.extend(UpdateDeviceAccountControllerMixin),}),});viewRegistry.add('res_users_preferences_form',UserPreferencesFormView);return UserPreferencesFormView;});;

/* /mail_enterprise/static/src/components/chat_window/chat_window.js defined in bundle 'web.assets_backend' */
odoo.define('@mail_enterprise/components/chat_window/chat_window',async function(require){'use strict';let __exports={};const{ChatWindow}=require('@mail/components/chat_window/chat_window');const{useBackButton}=require('web_mobile.hooks');const{patch}=require('web.utils');patch(ChatWindow.prototype,'mail_enterprise/static/src/components/chat_window/chat_window.js',{_constructor(){this._super(...arguments);this._onBackButtonGlobal=this._onBackButtonGlobal.bind(this);useBackButton(this._onBackButtonGlobal);},_onBackButtonGlobal(ev){if(!this.chatWindow){return;}
this.chatWindow.close();},});return __exports;});;

/* /mail_enterprise/static/src/components/chatter_container/chatter_container.js defined in bundle 'web.assets_backend' */
odoo.define('@mail_enterprise/components/chatter_container/chatter_container',async function(require){'use strict';let __exports={};const{ChatterContainer}=require('@mail/components/chatter_container/chatter_container');Object.assign(ChatterContainer,{defaultProps:Object.assign(ChatterContainer.defaultProps||{},{isInFormSheetBg:false,}),props:Object.assign(ChatterContainer.props,{isInFormSheetBg:{type:Boolean,},})});return __exports;});;

/* /mail_enterprise/static/src/components/dialog/dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@mail_enterprise/components/dialog/dialog',async function(require){'use strict';let __exports={};const{Dialog}=require('@mail/components/dialog/dialog');const{useBackButton}=require('web_mobile.hooks');const{patch}=require('web.utils');patch(Dialog.prototype,'mail_enterprise/static/src/components/dialog/dialog.js',{_constructor(){this._super(...arguments);this._onBackButtonGlobal=this._onBackButtonGlobal.bind(this);this._backButtonHandler=useBackButton(this._onBackButtonGlobal);},_onBackButtonGlobal(ev){if(!this.dialog){return;}
this.dialog.delete();},});return __exports;});;

/* /mail_enterprise/static/src/components/messaging_menu/messaging_menu.js defined in bundle 'web.assets_backend' */
odoo.define('@mail_enterprise/components/messaging_menu/messaging_menu',async function(require){'use strict';let __exports={};const{MessagingMenu}=require('@mail/components/messaging_menu/messaging_menu');const{useBackButton}=require('web_mobile.hooks');const{patch}=require('web.utils');patch(MessagingMenu.prototype,'mail_enterprise/static/src/components/chat_window/chat_window.js',{_constructor(){this._super(...arguments);this._onBackButtonGlobal=this._onBackButtonGlobal.bind(this);useBackButton(this._onBackButtonGlobal,()=>this.messagingMenu&&this.messagingMenu.isOpen);},_onBackButtonGlobal(ev){if(!this.messagingMenu){return;}
this.messagingMenu.close();},});return __exports;});;

/* /mail_enterprise/static/src/models/chatter/chatter.js defined in bundle 'web.assets_backend' */
odoo.define('@mail_enterprise/models/chatter/chatter',async function(require){'use strict';let __exports={};const{attr}=require('@mail/model/model_field');const{registerFieldPatchModel}=require('@mail/model/model_core');registerFieldPatchModel('mail.chatter','mail/static/src/models/chatter/chatter.js',{isInFormSheetBg:attr({default:false,}),});return __exports;});;

/* /mail_enterprise/static/src/js/attachment_viewer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail_enterprise/js/attachment_viewer',async function(require){'use strict';let __exports={};const core=require('web.core');const Widget=require('web.Widget');const{hidePDFJSButtons}=require('@web/legacy/js/libs/pdfjs');var QWeb=core.qweb;var AttachmentViewer=Widget.extend({className:'o_attachment_preview_container',events:{'click .arrow.o_move_next':'_onClickNext','click .arrow.o_move_previous':'_onClickPrevious',},init:function(parent,attachments){this._super.apply(this,arguments);this.attachments=attachments;this._setActive();},start:function(){this._renderAttachment();return this._super.apply(this,arguments);},updateContents:function(attachments,order){this.attachments=attachments;this._setActive();this._renderAttachment();},_renderAttachment:function(){this.$el.empty();this.$el.append(QWeb.render('mail_enterprise.AttachmentPreview',{widget:this}));if(this.activeAttachment.type==='pdf'){hidePDFJSButtons(this.el);}},_setActive:function(){this.activeAttachment=_.find(this.attachments,function(attachment){return attachment.is_main;});if(!this.activeAttachment&&this.attachments.length){this.activeAttachment=this.attachments[0];this._rpc({model:'ir.attachment',method:'register_as_main_attachment',args:[[this.activeAttachment.id],this.activeAttachment.is_main===false],});}},_switch_main_attachment:function(index){var self=this;this.activeAttachment=this.attachments[index];this._rpc({model:'ir.attachment',method:'register_as_main_attachment',args:[[this.activeAttachment['id']]],}).then(function(){self._renderAttachment();});},_onClickNext:function(ev){ev.preventDefault();var index=_.findIndex(this.attachments,this.activeAttachment);index=index===this.attachments.length-1?0:index+1;this._switch_main_attachment(index);},_onClickPrevious:function(ev){ev.preventDefault();var index=_.findIndex(this.attachments,this.activeAttachment);index=index===0?this.attachments.length-1:index-1;this._switch_main_attachment(index);},});__exports[Symbol.for("default")]=AttachmentViewer;return __exports;});;

/* /mail_enterprise/static/src/widgets/form_renderer/form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('@mail_enterprise/widgets/form_renderer/form_renderer',async function(require){'use strict';let __exports={};const config=require('web.config');const dom=require('web.dom');const pyUtils=require('web.py_utils');const FormRenderer=require('web.FormRenderer');const AttachmentViewer=require('@mail_enterprise/js/attachment_viewer')[Symbol.for("default")];require('@mail/widgets/form_renderer/form_renderer');FormRenderer.include({init:function(){this._super.apply(this,arguments);this.$attachmentPreview=undefined;this.attachmentPreviewResID=undefined;this.attachmentViewer=undefined;this._attachmentViewerThread=undefined;this._isChatterInFormSheetBg=false;this._onResizeWindow=_.debounce(this._onResizeWindow.bind(this),200);},destroy(){window.removeEventListener('resize',this._onResizeWindow);this._super();},start(){window.addEventListener('resize',this._onResizeWindow);return this._super(...arguments);},_isChatterAside(){const parent=this._chatterContainerTarget&&this._chatterContainerTarget.parentNode;return(config.device.size_class>=config.device.SIZES.XXL&&!this.attachmentViewer&&!(parent&&parent.classList&&parent.classList.contains('o_form_sheet')));},_interchangeChatter(enablePreview){if(config.device.size_class<config.device.SIZES.XXL){return;}
if(!this.$attachmentPreview){return;}
const $sheet=this.$('.o_form_sheet_bg');this._updateChatterContainerTarget();if(enablePreview){this.$attachmentPreview.insertAfter($sheet);dom.append($sheet,$(this._chatterContainerTarget),{callbacks:[{widget:this.chatter}],in_DOM:this._isInDom,});this._chatterContainerTarget.classList.add('o-isInFormSheetBg');this._isChatterInFormSheetBg=true;}else{$(this._chatterContainerTarget).insertAfter($sheet);dom.append($sheet,this.$attachmentPreview,{callbacks:[],in_DOM:this._isInDom,});this._chatterContainerTarget.classList.remove('o-isInFormSheetBg');this._isChatterInFormSheetBg=false;}
this._updateChatterContainerComponent();},_makeChatterContainerProps(){const props=this._super(...arguments);const isChatterAside=this._isChatterAside();return Object.assign(props,{hasExternalBorder:!isChatterAside,hasMessageListScrollAdjust:isChatterAside,isInFormSheetBg:this._isChatterInFormSheetBg,});},_makeChatterContainerTarget(){const $el=this._super(...arguments);this._updateChatterContainerTarget();return $el;},_renderNode:function(node){if(node.tag==='div'&&node.attrs.class==='o_attachment_preview'){if(this.attachmentViewer){if(this.attachmentPreviewResID!==this.state.res_id){this.attachmentViewer.destroy();this.attachmentViewer=undefined;}}else{this.$attachmentPreview=$('<div>',{class:'o_attachment_preview'});}
this._handleAttributes(this.$attachmentPreview,node);this._registerModifiers(node,this.state,this.$attachmentPreview);if(node.attrs.options){this.$attachmentPreview.data(pyUtils.py_eval(node.attrs.options));}
if(this.attachmentPreviewWidth){this.$attachmentPreview.css('width',this.attachmentPreviewWidth);}
return this.$attachmentPreview;}else{return this._super.apply(this,arguments);}},async _renderView(){await this._super(...arguments);if(!this._hasChatter()){return;}
this._updateChatterContainerTarget();const enablePreview=this.attachmentPreviewResID&&this.attachmentPreviewResID===this.state.res_id&&this.$attachmentPreview&&!this.$attachmentPreview.hasClass('o_invisible_modifier');this._interchangeChatter(enablePreview);},_updateChatterContainerTarget(){if(this._isChatterAside()){$(this._chatterContainerTarget).addClass('o-aside');}else{$(this._chatterContainerTarget).removeClass('o-aside');}},_onChatterRendered(ev){if(config.device.size_class<config.device.SIZES.XXL){return;}
if(!this.$attachmentPreview||this.$attachmentPreview.hasClass('o_invisible_modifier')){return;}
var self=this;var options=_.defaults(this.$attachmentPreview.data(),{types:['pdf','image'],order:'asc'});var attachments=$.extend(true,{},ev.data.attachments);attachments=_.filter(attachments,function(attachment){var match=attachment.mimetype.match(options.types.join('|'));attachment.update({type:match?match[0]:false});return match&&!attachment.isUploading;});const thread=ev.data.thread;if(options.order==='asc'){attachments.reverse();}
if(attachments.length||this.attachmentViewer){if(this.attachmentViewer){if(this._attachmentViewerThread!==thread||this.attachmentViewer.attachments.length!==attachments.length){if(!attachments.length){this.attachmentViewer.destroy();this.attachmentViewer=undefined;this.attachmentPreviewResID=undefined;this._interchangeChatter(false);}
else{this.attachmentViewer.updateContents(attachments,options.order);}}
this.trigger_up('preview_attachment_validation');this._updateChatterContainerTarget();}else{this.attachmentPreviewResID=this.state.res_id;this.attachmentViewer=new AttachmentViewer(this,attachments);this.attachmentViewer.appendTo(this.$attachmentPreview).then(function(){self.trigger_up('preview_attachment_validation');self.$attachmentPreview.resizable({handles:'w',minWidth:400,maxWidth:900,resize:function(event,ui){self.attachmentPreviewWidth=ui.size.width;},});self._interchangeChatter(true);});}}
this._attachmentViewerThread=thread;},_onResizeWindow(ev){if(this._chatterContainerComponent){this._updateChatterContainerComponent();this._updateChatterContainerTarget();}
this._applyFormSizeClass();}});return __exports;});;

/* /mail_mobile/static/src/js/mobile_device_register.js defined in bundle 'web.assets_backend' */
odoo.define('mail_mobile.ocn',function(require){"use strict";const mobile=require('web_mobile.core');var ajax=require('web.ajax');const{session}=require('@web/session');if(mobile.methods.getFCMKey){var registerDevice=function(fcm_project_id){mobile.methods.getFCMKey({project_id:fcm_project_id,inbox_action:session.inbox_action,}).then(function(response){if(response.success){ajax.rpc('/web/dataset/call_kw/res.config.settings/register_device',{model:'res.config.settings',method:'register_device',args:[response.data.subscription_id,response.data.device_name],kwargs:{},}).then(function(ocn_token){if(mobile.methods.setOCNToken){mobile.methods.setOCNToken({ocn_token:ocn_token});}});}});};if(session.fcm_project_id){registerDevice(session.fcm_project_id);}else{ajax.rpc('/web/dataset/call_kw/res.config.settings/get_fcm_project_id',{model:'res.config.settings',method:'get_fcm_project_id',args:[],kwargs:{},}).then(function(response){if(response){registerDevice(response);}});}}});;

/* /partner_autocomplete/static/src/js/partner_autocomplete_core.js defined in bundle 'web.assets_backend' */
odoo.define('partner.autocomplete.Mixin',function(require){'use strict';var concurrency=require('web.concurrency');var core=require('web.core');var Qweb=core.qweb;var utils=require('web.utils');var _t=core._t;var PartnerAutocompleteMixin={_dropPreviousOdoo:new concurrency.DropPrevious(),_dropPreviousClearbit:new concurrency.DropPrevious(),_timeout:1000,_autocomplete:function(value){var self=this;value=value.trim();var isVAT=this._isVAT(value);var odooSuggestions=[];var clearbitSuggestions=[];return new Promise(function(resolve,reject){var odooPromise=self._getOdooSuggestions(value,isVAT).then(function(suggestions){odooSuggestions=suggestions;});var clearbitPromise=isVAT?false:self._getClearbitSuggestions(value).then(function(suggestions){clearbitSuggestions=suggestions;});var concatResults=function(){if(clearbitSuggestions&&clearbitSuggestions.length){var websites=odooSuggestions.map(function(suggestion){return suggestion.website;});clearbitSuggestions.forEach(function(suggestion){if(websites.indexOf(suggestion.domain)<0){websites.push(suggestion.domain);odooSuggestions.push(suggestion);}});}
odooSuggestions=_.filter(odooSuggestions,function(suggestion){return!suggestion.ignored;});_.each(odooSuggestions,function(suggestion){delete suggestion.ignored;});return resolve(odooSuggestions);};self._whenAll([odooPromise,clearbitPromise]).then(concatResults,concatResults);});},_enrichCompany:function(company){return this._rpc({model:'res.partner',method:'enrich_company',args:[company.website,company.partner_gid,company.vat],});},_getCompanyLogo:function(url){return this._getBase64Image(url).then(function(base64Image){return base64Image?base64Image.replace(/^data:image[^;]*;base64,?/,''):false;}).catch(function(){return false;});},_getCreateData:function(company){var self=this;var removeUselessFields=function(company){var fields='label,description,domain,logo,legal_name,ignored,email'.split(',');fields.forEach(function(field){delete company[field];});var notEmptyFields="country_id,state_id".split(',');notEmptyFields.forEach(function(field){if(!company[field])delete company[field];});};return new Promise(function(resolve){var enrichPromise=self._enrichCompany(company);var logoPromise=company.logo?self._getCompanyLogo(company.logo):false;self._whenAll([enrichPromise,logoPromise]).then(function(result){var company_data=result[0];var logo_data=result[1];if(company_data.error&&company_data.vat){company.vat=company_data.vat;}
if(company_data.error){if(company_data.error_message==='Insufficient Credit'){self._notifyNoCredits();}else if(company_data.error_message==='No Account Token'){self._notifyAccountToken();}else{self.displayNotification({message:company_data.error_message});}
company_data=company;}
if(_.isEmpty(company_data)){company_data=company;}
removeUselessFields(company_data);if(company.vat){company_data.vat=company.vat;}
resolve({company:company_data,logo:logo_data});});});},_isOnline:function(){return navigator&&navigator.onLine;},_validateSearchTerm:function(search_val,onlyVAT){if(onlyVAT)return this._isVAT(search_val);else return search_val&&search_val.length>2;},_getBase64Image:function(url){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest();xhr.onload=function(){utils.getDataURLFromFile(xhr.response).then(resolve);};xhr.open('GET',url);xhr.responseType='blob';xhr.onerror=reject;xhr.send();});},_getClearbitSuggestions:function(value){var url='https://autocomplete.clearbit.com/v1/companies/suggest?query='+value;var def=$.ajax({url:url,dataType:'json',timeout:this._timeout,success:function(suggestions){suggestions.map(function(suggestion){suggestion.label=suggestion.name;suggestion.website=suggestion.domain;suggestion.description=suggestion.website;return suggestion;});return suggestions;},});return this._dropPreviousClearbit.add(def);},_getOdooSuggestions:function(value,isVAT){var method=isVAT?'read_by_vat':'autocomplete';var def=this._rpc({model:'res.partner',method:method,args:[value],},{shadow:true,}).then(function(suggestions){suggestions.map(function(suggestion){suggestion.logo=suggestion.logo||'';suggestion.label=suggestion.legal_name||suggestion.name;if(suggestion.vat)suggestion.description=suggestion.vat;else if(suggestion.website)suggestion.description=suggestion.website;if(suggestion.country_id&&suggestion.country_id.display_name){if(suggestion.description)suggestion.description+=_.str.sprintf(' (%s)',suggestion.country_id.display_name);else suggestion.description+=suggestion.country_id.display_name;}
return suggestion;});return suggestions;});return this._dropPreviousOdoo.add(def);},_isVAT:function(search_val){var str=this._sanitizeVAT(search_val);return checkVATNumber(str);},_sanitizeVAT:function(search_value){return search_value?search_value.replace(/[^A-Za-z0-9]/g,''):'';},_whenAll:function(promises){return Promise.all(promises.map(function(p){return Promise.resolve(p);}));},_notifyNoCredits:function(){var self=this;return this._rpc({model:'iap.account',method:'get_credits_url',args:['partner_autocomplete'],}).then(function(url){var title=_t('Not enough credits for Partner Autocomplete');var content=Qweb.render('partner_autocomplete.insufficient_credit_notification',{credits_url:url});self.displayNotification({title,message:utils.Markup(content),className:'o_partner_autocomplete_no_credits_notify',});});},_notifyAccountToken:function(){var self=this;return this._rpc({model:'iap.account',method:'get_config_account_url',args:[]}).then(function(url){var title=_t('IAP Account Token missing');if(url){var content=Qweb.render('partner_autocomplete.account_token',{account_url:url});self.displayNotification({title,message:utils.Markup(content),className:'o_partner_autocomplete_no_credits_notify',});}
else{self.displayNotification({title});}});},};return PartnerAutocompleteMixin;});;

/* /partner_autocomplete/static/src/js/partner_autocomplete_fieldchar.js defined in bundle 'web.assets_backend' */
odoo.define('partner.autocomplete.fieldchar',function(require){'use strict';var basic_fields=require('web.basic_fields');var core=require('web.core');var field_registry=require('web.field_registry');var AutocompleteMixin=require('partner.autocomplete.Mixin');var QWeb=core.qweb;var FieldChar=basic_fields.FieldChar;var FieldAutocomplete=FieldChar.extend(AutocompleteMixin,{className:'o_field_partner_autocomplete',debounceSuggestions:400,resetOnAnyFieldChange:true,jsLibs:['/partner_autocomplete/static/lib/jsvat.js'],events:_.extend({},FieldChar.prototype.events,{'keyup':'_onKeyup','mousedown .o_partner_autocomplete_suggestion':'_onMousedown','focusout':'_onFocusout','mouseenter .o_partner_autocomplete_suggestion':'_onHoverDropdown','click .o_partner_autocomplete_suggestion':'_onSuggestionClicked',}),init:function(){this._super.apply(this,arguments);this.onlyVAT=this.name==='vat';if(this.mode==='edit'){this.tagName='div';this.className+=' dropdown open w-100';}
if(this.debounceSuggestions>0){this._suggestCompanies=_.debounce(this._suggestCompanies.bind(this),this.debounceSuggestions);}},_isActive:function(){return this.model==='res.company'||(this.model==='res.partner'&&this.record.data.is_company&&!(this.record.data&&this.record.data.id));},_removeDropdown:function(){if(this.$dropdown){this.$dropdown.remove();this.$dropdown=undefined;}},_renderEdit:function(){this.$el.empty();this._prepareInput().appendTo(this.$el);},_selectCompany:function(company){var self=this;this._getCreateData(company).then(function(data){if(data.logo){var logoField=self.model==='res.partner'?'image_1920':'logo';data.company[logoField]=data.logo;}
if(self.model==='res.company'){var fields='comment,child_ids,bank_ids,additional_info'.split(',');fields.forEach(function(field){delete data.company[field];});}
self._setOne2ManyField('bank_ids',data.company.bank_ids);delete data.company.bank_ids;self.trigger_up('field_changed',{dataPointID:self.dataPointID,changes:data.company,onSuccess:function(){if(self.onlyVAT)
self.$input.val(self._formatValue(company.vat));else
self.$input.val(self._formatValue(company.name));},});});this._removeDropdown();},_setOne2ManyField:function(field,list){var self=this;var viewType=this.record.viewType;if(list&&this.record.fieldsInfo[viewType]&&this.record.fieldsInfo[viewType][field]){list.forEach(function(item){var changes={};changes[field]={operation:'CREATE',data:item,};self.trigger_up('field_changed',{dataPointID:self.dataPointID,changes:changes,});});}},_showDropdown:function(){this._removeDropdown();if(this.suggestions.length>0){this.$dropdown=$(QWeb.render('partner_autocomplete.dropdown',{suggestions:this.suggestions,}));this.$dropdown.appendTo(this.$el);this.$el.removeClass('o_text_overflow');this.$input.addClass('o_text_overflow');}},_suggestCompanies:function(value){var self=this;if(this._validateSearchTerm(value,this.onlyVAT)&&this._isOnline()){return this._autocomplete(value).then(function(suggestions){if(suggestions&&suggestions.length){self.suggestions=suggestions;self._showDropdown();}else{self._removeDropdown();}});}else{this._removeDropdown();}},_onFocusout:function(){this._removeDropdown();},_onHoverDropdown:function(e){this.$dropdown.find('.active').removeClass('active');$(e.currentTarget).parent().addClass('active');},_onInput:function(){this._super.apply(this,arguments);if(this._isActive()){this._suggestCompanies(this.$input.val());}},_onKeydown:function(e){switch(e.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:if(!this.$dropdown){break;}
e.preventDefault();var $suggestions=this.$dropdown.children();var $active=$suggestions.filter('.active');var $to;if($active.length){$to=e.which===$.ui.keyCode.DOWN?$active.next():$active.prev();}else{$to=$suggestions.first();}
if($to.length){$active.removeClass('active');$to.addClass('active');}
return;}
this._super.apply(this,arguments);},_onKeyup:function(e){switch(e.which){case $.ui.keyCode.ESCAPE:e.preventDefault();this._removeDropdown();break;case $.ui.keyCode.ENTER:if(!this.$dropdown){break;}
e.preventDefault();var $active=this.$dropdown.find('.o_partner_autocomplete_suggestion.active');if(!$active.length){return;}
this._selectCompany(this.suggestions[$active.data('index')]);break;}},_onMousedown:function(e){e.preventDefault();},_onSuggestionClicked:function(e){e.preventDefault();this._selectCompany(this.suggestions[$(e.currentTarget).data('index')]);},});field_registry.add('field_partner_autocomplete',FieldAutocomplete);return FieldAutocomplete;});;

/* /partner_autocomplete/static/src/js/partner_autocomplete_many2one.js defined in bundle 'web.assets_backend' */
odoo.define('partner.autocomplete.many2one',function(require){'use strict';var FieldMany2One=require('web.relational_fields').FieldMany2One;var core=require('web.core');var AutocompleteMixin=require('partner.autocomplete.Mixin');var field_registry=require('web.field_registry');var _t=core._t;var PartnerField=FieldMany2One.extend(AutocompleteMixin,{jsLibs:['/partner_autocomplete/static/lib/jsvat.js'],init:function(){this._super.apply(this,arguments);this._addAutocompleteSource(this._searchSuggestions,{placeholder:_t('Searching Autocomplete...'),order:20,validation:this._validateSearchTerm,});this.additionalContext['show_vat']=true;},_createPartner:function(company){var self=this;self.$('input').val('');return self._getCreateData(company).then(function(data){var context={'default_is_company':true};_.each(data.company,function(val,key){context['default_'+key]=val&&val.id?val.id:val;});if(data.logo)context.default_image_1920=data.logo;return self._searchCreatePopup("form",false,context);});},_getDisplayNameWithoutVAT:function(value){return value.split(' ‒ ')[0];},_modifyAutompleteRendering:function(){var api=this.$input.data('ui-autocomplete');if(!api){return;}
api._renderItem=function(ul,item){ul.addClass('o_partner_autocomplete_dropdown');var $a=$('<a/>')["html"](item.label);if(item.logo){var $img=$('<img/>').attr('src',item.logo);$a.append($img);}
return $("<li></li>").data("item.autocomplete",item).append($a).appendTo(ul).addClass(item.classname);};},_renderEdit:function(){this.m2o_value=this._getDisplayNameWithoutVAT(this.m2o_value);this._super.apply(this,arguments);this._modifyAutompleteRendering();},_searchSuggestions:function(search_val){var self=this;return new Promise(function(resolve,reject){if(self._isOnline()){self._autocomplete(search_val).then(function(suggestions){var choices=[];if(suggestions&&suggestions.length){_.each(suggestions,function(suggestion){var label='<i class="fa fa-magic text-muted"/> ';label+=_.str.sprintf('%s, <span class="text-muted">%s</span>',suggestion.label,suggestion.description);choices.push({label:label,action:function(){self._createPartner(suggestion);},logo:suggestion.logo,classname:'o_partner_autocomplete_dropdown_item',});});}
resolve(choices);});}else{resolve([]);}});},});field_registry.add('res_partner_many2one',PartnerField);return PartnerField;});;

/* /partner_autocomplete/static/src/js/web_company_autocomplete.js defined in bundle 'web.assets_backend' */
odoo.define('@partner_autocomplete/js/web_company_autocomplete',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{session}=require("@web/session");const companyAutocompleteService=__exports.companyAutocompleteService={dependencies:["orm","company"],start(env,{orm,company}){if(session.iap_company_enrich){const currentCompanyId=company.currentCompany.id;orm.silent.call("res.company","iap_enrich_auto",[currentCompanyId],{});}},};registry.category("services").add("partner_autocomplete.companyAutocomplete",companyAutocompleteService);return __exports;});;

/* /sms/static/src/js/fields_phone_widget.js defined in bundle 'web.assets_backend' */
odoo.define('sms.fields',function(require){"use strict";var basic_fields=require('web.basic_fields');var core=require('web.core');var session=require('web.session');var _t=core._t;var Phone=basic_fields.FieldPhone;Phone.include({init(){this._super.apply(this,arguments);this.enableSMS='enable_sms'in this.attrs.options?this.attrs.options.enable_sms:true;this.attrs.options.enable_sms=this.enableSMS;},getFocusableElement(){if(this.enableSMS&&this.mode==='readonly'){return this.$el.filter('.'+this.className).find('a');}
return this._super.apply(this,arguments);},_onClickSMS:function(ev){ev.preventDefault();ev.stopPropagation();var context=session.user_context;context=_.extend({},context,{default_res_model:this.model,default_res_id:parseInt(this.res_id),default_number_field_name:this.name,default_composition_mode:'comment',});var self=this;return this.do_action({title:_t('Send SMS Text Message'),type:'ir.actions.act_window',res_model:'sms.composer',target:'new',views:[[false,'form']],context:context,},{on_close:function(){self.trigger_up('reload');}});},_renderReadonly:function(){var def=this._super.apply(this,arguments);if(this.enableSMS&&this.value){var $composerButton=$('<a>',{title:_t('Send SMS Text Message'),href:'',class:'ml-3 d-inline-flex align-items-center o_field_phone_sms',html:$('<small>',{class:'font-weight-bold ml-1',html:'SMS'}),});$composerButton.prepend($('<i>',{class:'fa fa-mobile'}));$composerButton.on('click',this._onClickSMS.bind(this));this.$el=this.$el.add($composerButton);}
return def;},});return Phone;});;

/* /sms/static/src/js/fields_sms_widget.js defined in bundle 'web.assets_backend' */
odoo.define('@sms/js/fields_sms_widget',async function(require){'use strict';let __exports={};const{_t}=require('web.core');const fieldRegistry=require('web.field_registry');const FieldTextEmojis=require('@mail/js/field_text_emojis')[Symbol.for("default")];var SmsWidget=FieldTextEmojis.extend({className:'o_field_text',enableEmojis:false,init:function(){this._super.apply(this,arguments);this.nbrChar=0;this.nbrSMS=0;this.encoding='GSM7';this.enableEmojis=!!this.nodeOptions.enable_emojis;},on_attach_callback:function(){if(this.enableEmojis){this._super.apply(this,arguments);}},_renderEdit:function(){var def=this._super.apply(this,arguments);this._compute();$('.o_sms_container').remove();var $sms_container=$('<div class="o_sms_container"/>');$sms_container.append(this._renderSMSInfo());$sms_container.append(this._renderIAPButton());this.$el=this.$el.add($sms_container);return def;},_compute:function(){var content=this._getValue();this.encoding=this._extractEncoding(content);this.nbrChar=content.length;this.nbrChar+=(content.match(/\n/g)||[]).length;this.nbrSMS=this._countSMS(this.nbrChar,this.encoding);},_countSMS:function(){if(this.nbrChar===0){return 0;}
if(this.encoding==='UNICODE'){if(this.nbrChar<=70){return 1;}
return Math.ceil(this.nbrChar/67);}
if(this.nbrChar<=160){return 1;}
return Math.ceil(this.nbrChar/153);},_extractEncoding:function(content){if(String(content).match(RegExp("^[@£$¥èéùìòÇ\\nØø\\rÅåΔ_ΦΓΛΩΠΨΣΘΞÆæßÉ !\\\"#¤%&'()*+,-./0123456789:;<=>?¡ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÑÜ§¿abcdefghijklmnopqrstuvwxyzäöñüà]*$"))){return'GSM7';}
return'UNICODE';},_renderIAPButton:function(){return $('<a>',{'href':'https://iap-services.odoo.com/iap/sms/pricing','target':'_blank','title':_t('SMS Pricing'),'aria-label':_t('SMS Pricing'),'class':'fa fa-lg fa-info-circle',});},_renderSMSInfo:function(){var string=_.str.sprintf(_t('%s characters, fits in %s SMS (%s) '),this.nbrChar,this.nbrSMS,this.encoding);var $span=$('<span>',{'class':'text-muted o_sms_count',});$span.text(string);return $span;},_updateSMSInfo:function(){this._compute();var string=_.str.sprintf(_t('%s characters, fits in %s SMS (%s) '),this.nbrChar,this.nbrSMS,this.encoding);this.$('.o_sms_count').text(string);},_onBlur:function(){var content=this._getValue();if(!content.trim().length&&content.length>0){this.displayNotification({title:_t("Your SMS Text Message must include at least one non-whitespace character"),type:'danger'});this.$input.val(content.trim());this._updateSMSInfo();}},_onChange:function(){this._super.apply(this,arguments);this._updateSMSInfo();},_onInput:function(){this._super.apply(this,arguments);this._updateSMSInfo();},});fieldRegistry.add('sms_widget',SmsWidget);__exports[Symbol.for("default")]=SmsWidget;return __exports;});;

/* /sms/static/src/components/notification_group/notification_group.js defined in bundle 'web.assets_backend' */
odoo.define('@sms/components/notification_group/notification_group',async function(require){'use strict';let __exports={};const{NotificationGroup}=require('@mail/components/notification_group/notification_group');const{patch}=require('web.utils');patch(NotificationGroup.prototype,'sms/static/src/components/notification_group/notification_group.js',{image(){if(this.group.notification_type==='sms'){return'/sms/static/img/sms_failure.svg';}
return this._super(...arguments);},});return __exports;});;

/* /sms/static/src/models/message/message.js defined in bundle 'web.assets_backend' */
odoo.define('@sms/models/message/message',async function(require){'use strict';let __exports={};const{registerInstancePatchModel,}=require('@mail/model/model_core');registerInstancePatchModel('mail.message','sms/static/src/models/message/message.js',{openResendAction(){if(this.message_type==='sms'){this.env.bus.trigger('do-action',{action:'sms.sms_resend_action',options:{additional_context:{default_mail_message_id:this.id,},},});}else{this._super(...arguments);}},});return __exports;});;

/* /sms/static/src/models/notification_group/notification_group.js defined in bundle 'web.assets_backend' */
odoo.define('@sms/models/notification_group/notification_group',async function(require){'use strict';let __exports={};const{registerInstancePatchModel,}=require('@mail/model/model_core');registerInstancePatchModel('mail.notification_group','sms/static/src/models/notification_group/notification_group.js',{openCancelAction(){if(this.notification_type!=='sms'){return this._super(...arguments);}
this.env.bus.trigger('do-action',{action:'sms.sms_cancel_action',options:{additional_context:{default_model:this.res_model,unread_counter:this.notifications.length,},},});},_openDocuments(){if(this.notification_type!=='sms'){return this._super(...arguments);}
this.env.bus.trigger('do-action',{action:{name:this.env._t("SMS Failures"),type:'ir.actions.act_window',view_mode:'kanban,list,form',views:[[false,'kanban'],[false,'list'],[false,'form']],target:'current',res_model:this.res_model,domain:[['message_has_sms_error','=',true]],},});if(this.messaging.device.isMobile){this.messaging.messagingMenu.close();}},});return __exports;});;

/* /snailmail/static/src/components/message/message.js defined in bundle 'web.assets_backend' */
odoo.define('@snailmail/components/message/message',async function(require){'use strict';let __exports={};const{Message}=require('@mail/components/message/message');const{patch}=require('web.utils');const{useState}=owl;patch(Message.prototype,'snailmail/static/src/components/message/message.js',{_constructor(){this._super(...arguments);this.snailmailState=useState({hasDialog:false,});},_onClickFailure(){if(this.messageView.message.message_type==='snailmail'){switch(this.messageView.message.notifications[0].failure_type){case'sn_credit':this.messaging.fetchSnailmailCreditsUrl();this.snailmailState.hasDialog=true;break;case'sn_error':this.snailmailState.hasDialog=true;break;case'sn_fields':this.messageView.message.openMissingFieldsLetterAction();break;case'sn_format':this.messageView.message.openFormatLetterAction();break;case'sn_price':this.snailmailState.hasDialog=true;break;case'sn_trial':this.messaging.fetchSnailmailCreditsUrlTrial();this.snailmailState.hasDialog=true;break;}}else{this._super(...arguments);}},_onDialogClosedSnailmailError(){this.snailmailState.hasDialog=false;},});return __exports;});;

/* /snailmail/static/src/components/notification_group/notification_group.js defined in bundle 'web.assets_backend' */
odoo.define('@snailmail/components/notification_group/notification_group',async function(require){'use strict';let __exports={};const{NotificationGroup}=require('@mail/components/notification_group/notification_group');const{patch}=require('web.utils');patch(NotificationGroup.prototype,'snailmail/static/src/components/notification_group/notification_group.js',{image(){if(this.group.notification_type==='snail'){return'/snailmail/static/img/snailmail_failure.png';}
return this._super(...arguments);},});return __exports;});;

/* /snailmail/static/src/components/snailmail_error_dialog/snailmail_error_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('@snailmail/components/snailmail_error_dialog/snailmail_error_dialog',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const Dialog=require('web.OwlDialog');const{Component}=owl;const{useRef}=owl.hooks;class SnailmailErrorDialog extends Component{constructor(...args){super(...args);this._dialogRef=useRef('dialog');}
get hasCreditsError(){return(this.notification.failure_type==='sn_credit'||this.notification.failure_type==='sn_trial');}
get message(){return this.messaging&&this.messaging.models['mail.message'].get(this.props.messageLocalId);}
get notification(){return this.message.notifications[0];}
get title(){return this.env._t("Failed letter");}
_onClickCancelLetter(){this._dialogRef.comp._close();this.message.cancelLetter();}
_onClickClose(){this._dialogRef.comp._close();}
_onClickResendLetter(){this._dialogRef.comp._close();this.message.resendLetter();}}
Object.assign(SnailmailErrorDialog,{components:{Dialog},props:{messageLocalId:String,},template:'snailmail.SnailmailErrorDialog',});registerMessagingComponent(SnailmailErrorDialog);__exports[Symbol.for("default")]=SnailmailErrorDialog;return __exports;});;

/* /snailmail/static/src/components/snailmail_notification_popover/snailmail_notification_popover.js defined in bundle 'web.assets_backend' */
odoo.define('@snailmail/components/snailmail_notification_popover/snailmail_notification_popover',async function(require){'use strict';let __exports={};const{registerMessagingComponent}=require('@mail/utils/messaging_component');const{Component}=owl;class SnailmailNotificationPopover extends Component{get iconClass(){switch(this.notification.notification_status){case'sent':return'fa fa-check';case'ready':return'fa fa-clock-o';case'canceled':return'fa fa-trash-o';default:return'fa fa-exclamation text-danger';}}
get iconTitle(){switch(this.notification.notification_status){case'sent':return this.env._t("Sent");case'ready':return this.env._t("Awaiting Dispatch");case'canceled':return this.env._t("Canceled");default:return this.env._t("Error");}}
get message(){return this.messaging&&this.messaging.models['mail.message'].get(this.props.messageLocalId);}
get notification(){return this.message.notifications[0];}}
Object.assign(SnailmailNotificationPopover,{props:{messageLocalId:String,},template:'snailmail.SnailmailNotificationPopover',});registerMessagingComponent(SnailmailNotificationPopover);__exports[Symbol.for("default")]=SnailmailNotificationPopover;return __exports;});;

/* /snailmail/static/src/models/message/message.js defined in bundle 'web.assets_backend' */
odoo.define('@snailmail/models/message/message',async function(require){'use strict';let __exports={};const{registerInstancePatchModel}=require('@mail/model/model_core');registerInstancePatchModel('mail.message','snailmail/static/src/models/message.message.js',{async cancelLetter(){await this.async(()=>this.env.services.rpc({model:'mail.message',method:'cancel_letter',args:[[this.id]],}));},openFormatLetterAction(){this.env.bus.trigger('do-action',{action:'snailmail.snailmail_letter_format_error_action',options:{additional_context:{message_id:this.id,},},});},async openMissingFieldsLetterAction(){const letterIds=await this.async(()=>this.env.services.rpc({model:'snailmail.letter',method:'search',args:[[['message_id','=',this.id]]],}));this.env.bus.trigger('do-action',{action:'snailmail.snailmail_letter_missing_required_fields_action',options:{additional_context:{default_letter_id:letterIds[0],},},});},async resendLetter(){await this.async(()=>this.env.services.rpc({model:'mail.message',method:'send_letter',args:[[this.id]],}));},});return __exports;});;

/* /snailmail/static/src/models/messaging/messaging.js defined in bundle 'web.assets_backend' */
odoo.define('@snailmail/models/messaging/messaging',async function(require){'use strict';let __exports={};const{registerInstancePatchModel,registerFieldPatchModel,}=require('@mail/model/model_core');const{attr}=require('@mail/model/model_field');registerInstancePatchModel('mail.messaging','snailmail/static/src/models/messaging/messaging.js',{async fetchSnailmailCreditsUrl(){const snailmail_credits_url=await this.async(()=>this.env.services.rpc({model:'iap.account',method:'get_credits_url',args:['snailmail'],}));this.update({snailmail_credits_url,});},async fetchSnailmailCreditsUrlTrial(){const snailmail_credits_url_trial=await this.async(()=>this.env.services.rpc({model:'iap.account',method:'get_credits_url',args:['snailmail','',0,true],}));this.update({snailmail_credits_url_trial,});},});registerFieldPatchModel('mail.messaging','snailmail/static/src/models/messaging/messaging.js',{snailmail_credits_url:attr(),snailmail_credits_url_trial:attr(),});return __exports;});;

/* /snailmail/static/src/models/notification_group/notification_group.js defined in bundle 'web.assets_backend' */
odoo.define('@snailmail/models/notification_group/notification_group',async function(require){'use strict';let __exports={};const{registerInstancePatchModel,}=require('@mail/model/model_core');registerInstancePatchModel('mail.notification_group','snailmail/static/src/models/notification_group/notification_group.js',{openCancelAction(){if(this.notification_type!=='snail'){return this._super(...arguments);}
this.env.bus.trigger('do-action',{action:'snailmail.snailmail_letter_cancel_action',options:{additional_context:{default_model:this.res_model,unread_counter:this.notifications.length,},},});},_openDocuments(){if(this.notification_type!=='snail'){return this._super(...arguments);}
this.env.bus.trigger('do-action',{action:{name:this.env._t("Snailmail Failures"),type:'ir.actions.act_window',view_mode:'kanban,list,form',views:[[false,'kanban'],[false,'list'],[false,'form']],target:'current',res_model:this.res_model,domain:[['message_ids.snailmail_error','=',true]],},});if(this.messaging.device.isMobile){this.messaging.messagingMenu.close();}},});return __exports;});;

/* /web_cohort/static/src/cohort_arch_parser.js defined in bundle 'web.assets_backend' */
odoo.define('@web_cohort/cohort_arch_parser',async function(require){'use strict';let __exports={};const{XMLParser}=require("@web/core/utils/xml");const{_t}=require("@web/core/l10n/translation");const{evaluateExpr}=require("@web/core/py_js/py");const{INTERVALS,MODES,TIMELINES}=require("@web_cohort/cohort_model");const{sprintf}=require("@web/core/utils/strings");const CohortArchParser=__exports.CohortArchParser=class CohortArchParser extends XMLParser{parse(arch,fields){const archInfo={fieldAttrs:{},};this.visitXML(arch,(node)=>{switch(node.tagName){case"cohort":{const title=node.getAttribute("string");if(title){archInfo.title=title;}
const dateStart=node.getAttribute("date_start");if(dateStart){archInfo.dateStart=dateStart;archInfo.dateStartString=fields[dateStart].string;}else{throw new Error(_t('Cohort view has not defined "date_start" attribute.'));}
const dateStop=node.getAttribute("date_stop");if(dateStop){archInfo.dateStop=dateStop;archInfo.dateStopString=fields[dateStop].string;}else{throw new Error(_t('Cohort view has not defined "date_stop" attribute.'));}
const mode=node.getAttribute("mode")||"retention";if(mode&&MODES.includes(mode)){archInfo.mode=mode;}else{throw new Error(sprintf("The argument %s is not a valid mode. Here are the modes: %s",mode,MODES));}
const timeline=node.getAttribute("timeline")||"forward";if(timeline&&TIMELINES.includes(timeline)){archInfo.timeline=timeline;}else{throw new Error(sprintf("The argument %s is not a valid timeline. Here are the timelines: %s",timeline,TIMELINES));}
archInfo.measure=node.getAttribute("measure")||"__count";const interval=node.getAttribute("interval")||"day";if(interval&&interval in INTERVALS){archInfo.interval=interval;}else{throw new Error(sprintf("The argument %s is not a valid interval. Here are the intervals: %s",interval,INTERVALS));}
break;}
case"field":{let fieldName=node.getAttribute("name");archInfo.fieldAttrs[fieldName]={};if(node.hasAttribute("string")){archInfo.fieldAttrs[fieldName].string=node.getAttribute("string");}
if(node.hasAttribute("invisible")){const isInvisible=Boolean(evaluateExpr(node.getAttribute("invisible")));if(isInvisible){archInfo.fieldAttrs[fieldName].isInvisible=true;break;}}}}});return archInfo;}}
return __exports;});;

/* /web_cohort/static/src/cohort_model.js defined in bundle 'web.assets_backend' */
odoo.define('@web_cohort/cohort_model',async function(require){'use strict';let __exports={};const{_lt}=require("@web/core/l10n/translation");const{KeepLast,Race}=require("@web/core/utils/concurrency");const{Model}=require("@web/views/helpers/model");const{computeReportMeasures,processMeasure}=require("@web/views/helpers/utils");const MODES=__exports.MODES=["retention","churn"];const TIMELINES=__exports.TIMELINES=["forward","backward"];const INTERVALS=__exports.INTERVALS={day:_lt("Day"),week:_lt("Week"),month:_lt("Month"),year:_lt("Year"),};const CohortModel=__exports.CohortModel=class CohortModel extends Model{setup(params){this.keepLast=new KeepLast();this.race=new Race();const _load=this._load.bind(this);this._load=(...args)=>{return this.race.add(_load(...args));};this.metaData=params;this.data=null;this.searchParams=null;this.intervals=INTERVALS;}
load(searchParams){const{comparison,context,domain}=searchParams;this.searchParams={context};if(comparison){this.searchParams.domains=comparison.domains;}else{this.searchParams.domains=[{arrayRepr:domain,description:null}];}
const{cohort_interval,cohort_measure}=searchParams.context;this.metaData.interval=cohort_interval||this.metaData.interval;this.metaData.measure=processMeasure(cohort_measure)||this.metaData.measure;this.metaData.measures=computeReportMeasures(this.metaData.fields,this.metaData.fieldAttrs,[this.metaData.measure],this.metaData.additionalMeasures);return this._load(this.metaData);}
hasData(){return this.data.some((data)=>data.rows.length>0);}
async updateMetaData(params){Object.assign(this.metaData,params);await this._load(this.metaData);this.notify();}
async _load(metaData){this.data=await this.keepLast.add(this._fetchData(metaData));for(const i in this.data){this.data[i].title=this.searchParams.domains[i].description;}}
async _fetchData(metaData){return Promise.all(this.searchParams.domains.map(({arrayRepr:domain})=>{return this.orm.call(metaData.resModel,"get_cohort_data",[],{date_start:metaData.dateStart,date_stop:metaData.dateStop,measure:metaData.measure,interval:metaData.interval,domain:domain,mode:metaData.mode,timeline:metaData.timeline,context:this.searchParams.context,});}));}}
return __exports;});;

/* /web_cohort/static/src/cohort_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('@web_cohort/cohort_renderer',async function(require){'use strict';let __exports={};const{formatFloat,formatPercentage}=require("@web/fields/formatters");const{Component}=owl;const CohortRenderer=__exports.CohortRenderer=class CohortRenderer extends Component{setup(){this.model=this.props.model;}
range(n){return Array.from({length:n},(_,i)=>i);}
formatFloat(value){return formatFloat(value,{digits:[false,1]});}
formatPercentage(value){return formatPercentage(value,{digits:[false,1]});}}
CohortRenderer.template="web_cohort.CohortRenderer";CohortRenderer.props=["model","onRowClicked"];return __exports;});;

/* /web_cohort/static/src/cohort_view.js defined in bundle 'web.assets_backend' */
odoo.define('@web_cohort/cohort_view',async function(require){'use strict';let __exports={};const{download}=require("@web/core/network/download");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{useModel}=require("@web/views/helpers/model");const{standardViewProps}=require("@web/views/helpers/standard_view_props");const{useSetupView}=require("@web/views/helpers/view_hook");const{Layout}=require("@web/views/layout");const{CohortArchParser}=require("@web_cohort/cohort_arch_parser");const{CohortModel}=require("@web_cohort/cohort_model");const{CohortRenderer}=require("@web_cohort/cohort_renderer");class CohortView extends owl.Component{setup(){this.actionService=useService("action");let modelParams;if(this.props.state){modelParams=this.props.state.metaData;}else{const{arch,fields}=this.props;const archInfo=new this.constructor.ArchParser().parse(arch,fields);modelParams={additionalMeasures:this.props.additionalMeasures,dateStart:archInfo.dateStart,dateStartString:archInfo.dateStartString,dateStop:archInfo.dateStop,dateStopString:archInfo.dateStopString,fieldAttrs:archInfo.fieldAttrs,fields:this.props.fields,interval:archInfo.interval,measure:archInfo.measure,mode:archInfo.mode,resModel:this.props.resModel,timeline:archInfo.timeline,title:archInfo.title,};}
this.model=useModel(this.constructor.Model,modelParams);useSetupView({getLocalState:()=>{return{metaData:this.model.metaData};},getContext:()=>this.getContext(),});}
getContext(){const{measure,interval}=this.model.metaData;return{cohort_measure:measure,cohort_interval:interval};}
onRowClicked(row){if(row.value===undefined){return;}
const context=Object.assign({},this.model.searchParams.context);const domain=row.domain;const views={};for(const[viewId,viewType]of this.env.config.views||[]){views[viewType]=viewId;}
function getView(viewType){return[context[`${viewType}_view_id`]||views[viewType]||false,viewType];}
const actionViews=[getView("list"),getView("form")];this.actionService.doAction({type:"ir.actions.act_window",name:this.model.metaData.title,res_model:this.model.metaData.resModel,views:actionViews,view_mode:"list",target:"current",context:context,domain:domain,});}
async downloadExcel(){const{title,resModel,interval,measure,measures,dateStartString,dateStopString,timeline,}=this.model.metaData;const{domains}=this.model.searchParams;const data={title:title,model:resModel,interval_string:this.model.intervals[interval].toString(),measure_string:measures[measure].string,date_start_string:dateStartString,date_stop_string:dateStopString,timeline:timeline,rangeDescription:domains[0].description,report:this.model.data[0],comparisonRangeDescription:domains[1]&&domains[1].description,comparisonReport:this.model.data[1],};this.env.services.ui.block();try{await download({url:"/web/cohort/export",data:{data:JSON.stringify(data)},});}finally{this.env.services.ui.unblock();}}
onDropDownSelected(ev){this.model.updateMetaData(ev.detail.payload);}}
CohortView.type="cohort";CohortView.display_name="Cohort";CohortView.icon="fa-signal";CohortView.multiRecord=true;CohortView.template="web_cohort.CohortView";CohortView.buttonTemplate="web_cohort.CohortView.Buttons";CohortView.components={Layout,Renderer:CohortRenderer};CohortView.props={...standardViewProps,additionalMeasures:{type:Array,elements:String,optional:1},};CohortView.defaultProps={additionalMeasures:[],};CohortView.searchMenuTypes=["filter","comparison","favorite"];CohortView.Model=CohortModel;CohortView.ArchParser=CohortArchParser;registry.category("views").add("cohort",CohortView);return __exports;});;

/* /web_cohort/static/src/cohort_view_sample_server.js defined in bundle 'web.assets_backend' */
odoo.define('@web_cohort/cohort_view_sample_server',async function(require){'use strict';let __exports={};const{SampleServer}=require("@web/views/helpers/sample_server");const{parseDate}=require("@web/core/l10n/dates");const{registry}=require("@web/core/registry");function _mockGetCohortData(params){const{model,date_start,interval,measure,mode,timeline}=params;const columns_avg={};const rows=[];let initialChurnValue=0;const groups=this._mockReadGroup({model,fields:[date_start],groupBy:[date_start+":"+interval],});const totalCount=groups.length;let totalValue=0;for(const group of groups){const format=SampleServer.FORMATS[interval];const displayFormat=SampleServer.DISPLAY_FORMATS[interval];const date=parseDate(group[date_start+":"+interval],{format});const now=luxon.DateTime.local();let colStartDate=date;if(timeline==="backward"){colStartDate=colStartDate.plus({[`${interval}s`]:-15});}
let value=measure==="__count"?this._getRandomInt(SampleServer.MAX_INTEGER):this._generateFieldValue(model,measure);value=value||25;totalValue+=value;let initialValue=value;let max=value;const columns=[];for(let column=0;column<=15;column++){if(!columns_avg[column]){columns_avg[column]={percentage:0,count:0};}
if(colStartDate.plus({[`${interval}s`]:column})>now){columns.push({value:"-",churn_value:"-",percentage:""});continue;}
let colValue=0;if(max>0){colValue=Math.min(Math.round(Math.random()*max),max);max-=colValue;}
if(timeline==="backward"&&column===0){initialValue=Math.min(Math.round(Math.random()*value),value);initialChurnValue=value-initialValue;}
const previousValue=column===0?initialValue:columns[column-1].value;const remainingValue=previousValue-colValue;const previousChurnValue=column===0?initialChurnValue:columns[column-1].churn_value;const churn_value=colValue+previousChurnValue;let percentage=value?parseFloat(remainingValue/value):0;if(mode==="churn"){percentage=1-percentage;}
percentage=Number((100*percentage).toFixed(1));columns_avg[column].percentage+=percentage;columns_avg[column].count+=1;columns.push({value:remainingValue,churn_value,percentage,period:column,});}
const keepRow=columns.some((c)=>c.percentage!=="");if(keepRow){rows.push({date:date.toFormat(displayFormat),value,columns});}}
const avg_value=totalCount?totalValue/totalCount:0;const avg={avg_value,columns_avg};return{rows,avg};}
registry.category("sample_server").add("get_cohort_data",_mockGetCohortData);return __exports;});;

/* /web_dashboard/static/src/dashboard_arch_parser.js defined in bundle 'web.assets_backend' */
odoo.define('@web_dashboard/dashboard_arch_parser',async function(require){'use strict';let __exports={};const{XMLParser}=require("@web/core/utils/xml");const CompileHelpers=require("@web_dashboard/dashboard_compiler/compile_helpers");const SUPPORTED_VIEW_TYPES=["graph","pivot","cohort"];const DashboardArchParser=__exports.DashboardArchParser=class DashboardArchParser extends XMLParser{parse(arch,fields){const subViewRefs={};const aggregates=[];const formulae=[];const nodeIdentifier=CompileHelpers.nodeIdentifier();this.visitXML(arch,(node)=>{if(node.tagName==="view"){const type=node.getAttribute("type");if(!SUPPORTED_VIEW_TYPES.includes(type)){throw new Error(`Unsupported viewtype "${type}" in DashboardView`);}
if(type in subViewRefs){throw new Error(`multiple views of the same type is not allowed. Duplicated type: "${type}".`);}
subViewRefs[type]=node.getAttribute("ref")||false;}
if(node.tagName==="aggregate"){const fieldName=node.getAttribute("field");const field=fields[fieldName];let groupOperator=node.getAttribute("group_operator");if(!groupOperator&&field.group_operator){groupOperator=field.group_operator;}
if(field.type==="many2one"){groupOperator="count_distinct";}
let measure=node.getAttribute("measure");if(measure&&measure==="__count__"){measure="__count";}
aggregates.push({name:node.getAttribute("name"),field:fieldName,domain:node.getAttribute("domain"),domainLabel:node.getAttribute("domain_label")||node.getAttribute("string")||node.getAttribute("name"),measure:measure||fieldName,groupOperator,});}
if(node.tagName==="formula"){nodeIdentifier(node);formulae.push({name:node.getAttribute("name")||nodeIdentifier.idFor(),operation:node.getAttribute("value"),domain:node.getAttribute("domain"),});}});return{subViewRefs,aggregates,formulae};}}
return __exports;});;

/* /web_dashboard/static/src/dashboard_compiler/compile_helpers.js defined in bundle 'web.assets_backend' */
odoo.define('@web_dashboard/dashboard_compiler/compile_helpers',async function(require){'use strict';let __exports={};const{evaluateExpr}=require("@web/core/py_js/py");__exports.nodeIdentifier=nodeIdentifier;function nodeIdentifier(){const mapping={};let lastNode;function add(node){const nodeMap=mapping[node.tagName]||{current:null,id:1,};mapping[node.tagName]=nodeMap;if(node!==nodeMap.current){nodeMap.id++;}
nodeMap.current=node;lastNode=node;}
function idFor(node){node=node||lastNode;const nodeMap=mapping[node.tagName];return`${node.tagName}_${nodeMap.id}`;}
return Object.assign(add,{idFor(node){return idFor(node);},});}
__exports.addLegacyNodeInfo=addLegacyNodeInfo;function addLegacyNodeInfo(node,compiled){const modifiers=getAllModifiers(node);if(modifiers){const legacyNode={attrs:{modifiers},};compiled.setAttribute("_legacyNode_",`"${encodeObjectForTemplate(legacyNode)}"`);}}
__exports.encodeObjectForTemplate=encodeObjectForTemplate;function encodeObjectForTemplate(obj){return encodeURI(JSON.stringify(obj));}
__exports.decodeObjectForTemplate=decodeObjectForTemplate;function decodeObjectForTemplate(str){return JSON.parse(decodeURI(str));}
__exports.tranformStringForExpression=tranformStringForExpression;function tranformStringForExpression(str){const delimiter=`"`;const newStr=str.replaceAll(delimiter,`\\${delimiter}`);return`${delimiter}${newStr}${delimiter}`;}
const combineAttributes=__exports.combineAttributes=(node,attr,parts,glue=" ")=>{const allValues=[];if(node.hasAttribute(attr)){allValues.push(node.getAttribute(attr));}
allValues.push(...(Array.isArray(parts)?parts:[parts]));node.setAttribute(attr,allValues.join(glue));};function evalIrUiViewModifier(expr){if(!expr){return false;}
return evaluateExpr(expr,{true:true,false:false,});}
__exports.getAllModifiers=getAllModifiers;function getAllModifiers(node){const modifiers=node.getAttribute("modifiers");if(!modifiers){return null;}
const parsed=JSON.parse(modifiers);return parsed;}
__exports.getModifier=getModifier;function getModifier(node,modifierName){let mod=node.getAttribute(modifierName);if(mod===null){const modifiers=getAllModifiers(node);mod=modifiers&&modifierName in modifiers?modifiers[modifierName]:null;}
if(!Array.isArray(mod)&&!(typeof mod==="boolean")){mod=!!evalIrUiViewModifier(mod);}
return mod;}
function getInvisible(node){const invisible=getModifier(node,"invisible");return invisible||false;}
__exports.isAlwaysInvisible=isAlwaysInvisible;function isAlwaysInvisible(node,compilationContext){const invisibleModifer=getInvisible(node);return(!compilationContext.enableInvisible&&typeof invisibleModifer==="boolean"&&invisibleModifer);}
__exports.appendTo=appendTo;function appendTo(parent,node){if(!node){return;}
if(Array.isArray(node)&&node.length){parent.append(...node);}else{parent.append(node);}}
function appendToStringifiedObject(originalTattr,string){const re=/{(.*)}/;const oldString=re.exec(originalTattr);if(oldString){string=`${oldString[1]}, ${string}`;}
return`{ ${string} }`;}
__exports.appendAttr=appendAttr;function appendAttr(node,attr,string){const attrKey=`t-att-${attr}`;const attrVal=node.getAttribute(attrKey);node.setAttribute(attrKey,appendToStringifiedObject(attrVal,string));}
__exports.applyInvisibleModifier=applyInvisibleModifier;function applyInvisibleModifier({node,compiled},compilationContext,invisible){if(invisible===undefined&&node){invisible=getInvisible(node);}
if(!invisible){return compiled;}
if(typeof invisible==="boolean"&&!compilationContext.enableInvisible){return;}
const notInvisibleExpr=`!model.evalDomain(record,${JSON.stringify(invisible)})`;if(!compilationContext.enableInvisible){combineAttributes(compiled,"t-if",`${notInvisibleExpr}`," and ");}else{let expr;if(Array.isArray(invisible)){expr=`${notInvisibleExpr}`;}else{expr=invisible;}
appendAttr(compiled,"class",`o_invisible_modifier: ${expr}`);}
return compiled;}
return __exports;});;

/* /web_dashboard/static/src/dashboard_compiler/dashboard_compiler.js defined in bundle 'web.assets_backend' */
odoo.define('@web_dashboard/dashboard_compiler/dashboard_compiler',async function(require){'use strict';let __exports={};const{XMLParser}=require("@web/core/utils/xml");const{addLegacyNodeInfo,appendAttr,appendTo,applyInvisibleModifier,encodeObjectForTemplate,getAllModifiers,getModifier,isAlwaysInvisible,nodeIdentifier,tranformStringForExpression,}=require("@web_dashboard/dashboard_compiler/compile_helpers");function makeGroupTitleRow(node){const titleDiv=this.document.createElement("div");titleDiv.classList.add("o_horizontal_separator");titleDiv.textContent=node.getAttribute("string");return titleDiv;}
function compileGroup({document,compileNode,outerGroupCol},{node,compilationContext}){outerGroupCol=outerGroupCol||2;const group=document.createElement("div");group.setAttribute("class","o_group");if(node.hasAttribute("string")){appendTo(group,makeGroupTitleRow(node));}
const nbCols="col"in node.attributes?parseInt(node.getAttribute("col"),10):outerGroupCol;const colSize=Math.max(1,Math.round(12/nbCols));compilationContext=Object.create(compilationContext);compilationContext.groupLevel=(compilationContext.groupLevel||1)+1;for(let child of node.children){if(child.tagName==="newline"){appendTo(group,this.doc.createElement("br"));continue;}
const compiled=compileNode(child,compilationContext);if(!compiled){continue;}
const colspan="colspan"in child.attributes?parseInt(node.getAttribute("colspan"),10):1;compiled.classList.add(`o_group_col_${colSize * colspan}`);appendTo(group,compiled);}
return group;}
function compileWidget({document},{node}){const viewWidget=document.createElement("ViewWidget");viewWidget.setAttribute("model","model");viewWidget.setAttribute("widgetName",`"${node.getAttribute("name")}"`);if("title"in node.attributes){viewWidget.setAttribute("title",`"${node.getAttribute("title")}"`);}
addLegacyNodeInfo(node,viewWidget);return viewWidget;}
function setSampleDisable(node){appendAttr(node,"class","o_sample_data_disabled: model.useSampleModel");}
const DashboardCompiler=__exports.DashboardCompiler=class DashboardCompiler{constructor(){this.doc=new DOMParser().parseFromString("<templates />","text/xml");this.OUTER_GROUP_COL=6;this.nodeIdentifier=nodeIdentifier();}
compileArch(arch){const node=new XMLParser().parseXML(arch);const compiled=this.compile(node,{});return new XMLSerializer().serializeToString(compiled);}
compile(node,params={}){const newRoot=this.doc.createElement("t");const child=this.compileNode(node,params);appendTo(newRoot,child);return newRoot;}
compileDashboard(node,params){const dash=this.doc.createElement("t");for(const child of node.children){appendTo(dash,this.compileNode(child,params));}
return dash;}
compileNode(node,params){this.nodeIdentifier(node);if(isAlwaysInvisible(node,params)){return;}
switch(node.tagName){case"dashboard":{return this.compileDashboard(node,params);}
case"group":{return this.compileGroup(node,params);}
case"aggregate":{return this.compileStatistic(node,params);}
case"view":{return this.compileView(node,params);}
case"formula":{return this.compileStatistic(node,params);}
case"widget":{return compileWidget({document:this.doc},{node});}}}
compileGroup(node,params){const group=compileGroup({compileNode:this.compileNode.bind(this),outerGroupCol:this.OUTER_GROUP_COL,document:this.doc,},{node,compilationContext:params});if(node.children.length&&node.children[0].tagName==="widget"){group.classList.add("o_has_widget");}
setSampleDisable(group);return group;}
compileView(node){const view=this.doc.createElement("ViewWrapper");const type=node.getAttribute("type");view.setAttribute("t-props",`getViewWrapperProps("${type}")`);view.setAttribute("t-key","subViewsRenderKey");view.setAttribute("class","o_subview");return view;}
compileStatistic(node,params){const agg=this.doc.createElement("DashboardStatistic");let aggName;if("name"in node.attributes){aggName=node.getAttribute("name");}else{aggName=this.nodeIdentifier.idFor(node);}
const displayName=node.getAttribute("string")||aggName;agg.setAttribute("displayName",tranformStringForExpression(displayName));agg.setAttribute("model","model");agg.setAttribute("name",`"${aggName}"`);agg.setAttribute("statisticType",`"${node.tagName}"`);if("value_label"in node.attributes){agg.setAttribute("valueLabel",tranformStringForExpression(node.getAttribute("value_label")));}
if("widget"in node.attributes){agg.setAttribute("widget",`"${node.getAttribute("widget")}"`);}
if("help"in node.attributes){agg.setAttribute("help",tranformStringForExpression(node.getAttribute("help")));}
const modifiers=getAllModifiers(node);if(modifiers){agg.setAttribute("modifiers",`"${encodeObjectForTemplate(modifiers)}"`);}
if(node.tagName==="aggregate"){let clickable;if(!("clickable"in node.attributes)){clickable=true;}else{clickable=getModifier(node,"clickable");}
if(clickable){agg.setAttribute("t-on-change-statistic",`onStatisticChange("${aggName}")`);}
agg.setAttribute("clickable",`model.evalDomain(record, ${clickable})`);}
let compiled=agg;if(params.groupLevel){const div=this.doc.createElement("div");div.setAttribute("class","o_aggregate_col");appendTo(div,agg);compiled=div;}
return applyInvisibleModifier({node,compiled},params);}}
return __exports;});;

/* /web_dashboard/static/src/dashboard_model.js defined in bundle 'web.assets_backend' */
odoo.define('@web_dashboard/dashboard_model',async function(require){'use strict';let __exports={};const BasicModel=require("web.BasicModel");const{computeVariation}=require("@web/core/utils/numbers");const{Domain}=require("@web/core/domain");const{evaluateExpr}=require("@web/core/py_js/py");const{KeepLast}=require("@web/core/utils/concurrency");const{Model}=require("@web/views/helpers/model");function getPseudoRecords(meta,data){const records=[];for(let i=0;i<meta.domains.length;i++){const record={};for(const[statName,statInfo]of Object.entries(data)){const{values}=statInfo;record[statName]=values[i];}
records.push(record);}
return records;}
function getVariationAsRecords(data){const periods=[];Object.entries(data).forEach(([fName,{variations}])=>{for(const varIndex in variations){periods[varIndex]=periods[varIndex]||{};periods[varIndex][fName]=variations[varIndex];}});return periods;}
function setupBasicModel(resModel,{getFieldsInfo,postProcessRecord}){const basicModel=new BasicModel();const mkDatapoint=basicModel._makeDataPoint;const{viewFieldsInfo,fieldsInfo}=getFieldsInfo();let legacyModelParams;basicModel._makeDataPoint=(params)=>{params=Object.assign({},params,legacyModelParams);return mkDatapoint.call(basicModel,params);};return{makeRecord:async(params,data)=>{legacyModelParams=params;const recId=await basicModel.makeRecord(resModel,viewFieldsInfo,fieldsInfo);const record=basicModel.get(recId);postProcessRecord(record,data);return record;},set isSample(bool){basicModel.isSample=bool;},};}
const DashboardModel=__exports.DashboardModel=class DashboardModel extends Model{setup(params){super.setup(...arguments);this.keepLast=new KeepLast();const{aggregates,fields,formulae,resModel}=params;this.metaData={fields,formulae,resModel};this.metaData.aggregates=[];for(const agg of aggregates){const enrichedCopy=Object.assign({},agg);const groupOperator=agg.groupOperator||"sum";enrichedCopy.measureSpec=`${agg.name}:${groupOperator}(${agg.field})`;const field=fields[agg.field];enrichedCopy.fieldType=field.type;this.metaData.aggregates.push(enrichedCopy);}
this.metaData.statistics=this._statisticsAsFields();this.basicModel=setupBasicModel(this.metaData.resModel,{getFieldsInfo:()=>{const legFieldsInfo={dashboard:{},};this.metaData.aggregates.forEach((agg)=>{legFieldsInfo.dashboard[agg.name]=Object.assign({},agg,{type:agg.fieldType,});});Object.entries(this.metaData.fields).forEach(([fName,f])=>{legFieldsInfo.dashboard[fName]=Object.assign({},f);});let formulaId=1;this.metaData.formulae.forEach((formula)=>{const formulaName=formula.name||`formula_${formulaId++}`;const fakeField=Object.assign({},formula,{type:"float",name:formulaName,});legFieldsInfo.dashboard[formulaName]=fakeField;legFieldsInfo.formulas=Object.assign(legFieldsInfo.formulas||{},{[formulaName]:fakeField,});});legFieldsInfo.default=legFieldsInfo.dashboard;return{viewFieldsInfo:legFieldsInfo.dashboard,fieldsInfo:legFieldsInfo};},postProcessRecord:(record,data)=>{record.context=this.env.searchModel.context;record.viewType="dashboard";const pseudoRecords=getPseudoRecords(this.metaData,data);record.data=pseudoRecords[0];if(this.metaData.domains.length>1){const comparison=this.env.searchModel.getFullComparison();record.comparisonData=pseudoRecords[1];record.comparisonTimeRange=comparison.comparisonRange;record.timeRange=comparison.range;record.timeRanges=comparison;record.variationData=getVariationAsRecords(data)[0];}},});}
async load(searchParams){const{comparison,domain,context}=searchParams;const metaData=Object.assign({},this.metaData,{context,domain});if(comparison){metaData.domains=comparison.domains;}else{metaData.domains=[{arrayRepr:domain,description:null}];}
await this.keepLast.add(this._load(metaData));this.basicModel.isSample=metaData.useSampleModel;this.metaData=metaData;const legacyParams={domain:metaData.domain,compare:metaData.domains.length>1,};this._legacyRecord_=await this.keepLast.add(this.basicModel.makeRecord(legacyParams,this.data));}
hasData(){return this.count>0;}
evalDomain(record,expr){if(!Array.isArray(expr)){return!!expr;}
const domain=new Domain(expr);return domain.contains(getPseudoRecords(this.metaData,this.data)[0]);}
getStatisticDescription(statName){return this.metaData.statistics[statName];}
_computeVariations(meta,data){const n=meta.domains.length-1;for(const statInfo of Object.values(data)){const{values}=statInfo;statInfo.variations=new Array(n);for(let i=0;i<n;i++){statInfo.variations[i]=computeVariation(values[i],values[i+1]);}}}
_evalFormulae(meta,data){const records=getPseudoRecords(meta,data);for(const formula of meta.formulae){const{name,operation}=formula;data[name]={values:new Array(meta.domains.length).fill(NaN),};for(let i=0;i<meta.domains.length;i++){try{const value=evaluateExpr(operation,{record:records[i]});if(isFinite(value)){data[name].values[i]=value;}}catch(e){}}}}
async _load(meta){const domainMapping={};if(this.useSampleModel){domainMapping["[]"]=[];}
for(const agg of meta.aggregates){const domain=agg.domain||"[]";if(domain in domainMapping){domainMapping[domain].push(agg);}else{domainMapping[domain]=[agg];}}
const proms=[];const data={};let count=0;for(const[domain,aggregates]of Object.entries(domainMapping)){for(let i=0;i<meta.domains.length;i++){const{arrayRepr}=meta.domains[i];proms.push(this.orm.readGroup(meta.resModel,Domain.and([domain,arrayRepr]).toList(),aggregates.map((agg)=>agg.measureSpec),[],{lazy:true},meta.context).then((groups)=>{const group=groups[0];if(domain==="[]"){count+=group.__count;}
for(const agg of aggregates){if(!data[agg.name]){data[agg.name]={values:new Array(meta.domains.length),};}
const{type:fieldType}=meta.fields[agg.field];data[agg.name].values[i]=group[agg.name]||(["date","datetime"].includes(fieldType)?NaN:0);}}));}}
await Promise.all(proms);this._evalFormulae(meta,data);this._computeVariations(meta,data);this.data=data;this.count=count;}
_statisticsAsFields(){const fakeFields={};for(const agg of this.metaData.aggregates){fakeFields[agg.name]=agg;}
for(const formula of this.metaData.formulae){fakeFields[formula.name]=Object.assign({},formula,{fieldType:"float"});}
return fakeFields;}}
return __exports;});;

/* /web_dashboard/static/src/dashboard_statistic/dashboard_statistic.js defined in bundle 'web.assets_backend' */
odoo.define('@web_dashboard/dashboard_statistic/dashboard_statistic',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{session}=require("@web/session");const{Field}=require("@web/fields/fields");const DashboardStatistic=__exports.DashboardStatistic=class DashboardStatistic extends owl.Component{setup(){let currencyId=this.props.currencyId;if(!currencyId){const company=useService("company");const currentCompanyId=company.currentCompany.id;currencyId=session.companies_currency_id[currentCompanyId];}
const formatterOptions={monetary:{currencyId,humanReadable:true,},default:{minDigits:3,digits:2,},};const widget="widget"in this.props&&this.props.widget;const formatters=registry.category("formatters");let statType;if(!widget||formatters.contains(widget)){statType=widget;if(!statType){const stat=this.props.model.getStatisticDescription(this.props.name);statType=stat.fieldType;}
statType=statType==="many2one"?"integer":statType;this.formatOpts=formatterOptions[statType]||formatterOptions.default;this.formatter=statType&&formatters.get(statType);}
if(!this.formatter){this.widgetName=widget;}
this.formatterString=statType||this.widgetName;}
getNodeAttributes(){if(this.env.debug||this.props.help){return{"data-tooltip-template":"web_dashboard.DashboardStatisticTooltip","data-tooltip-info":JSON.stringify(this.getTooltipInfo()),};}
return null;}
getTooltipInfo(){const props=this.props;return{displayName:props.displayName,formatter:this.formatterString,help:props.help,modifiers:props.modifiers,name:props.name,statistic:props.model.getStatisticDescription(props.name),statisticType:props.statisticType,valueLabel:props.valueLabel,};}
get hasComparison(){return this.props.model.data[this.props.name].variations.length;}
getRawValue(index){return this.props.model.data[this.props.name].values[index];}
formatValue(value){if(isNaN(value)){return" - ";}
return this.formatter(value,this.formatOpts);}
getFakeRecord(index){if(!this.recordId){this.recordId=1;}else{this.recordId++;}
const fakeData={};for(const[fName,data]of Object.entries(this.props.model.data)){fakeData[fName]=data.values[index];}
const allFields=Object.assign({},this.props.model.metaData.fields,this.props.model.metaData.statistics);for(const field of Object.values(allFields)){field.type=field.fieldType;}
return{id:this.recordId,viewtype:"dashboard",fields:allFields,fieldsInfo:{dashboard:allFields,},data:fakeData,};}
get rawVariation(){return this.props.model.data[this.props.name].variations[0];}
get variationSign(){if(!isNaN(this.rawVariation)){return Math.sign(this.rawVariation);}
return false;}
get variation(){if(isNaN(this.rawVariation)){return false;}
const percentage=registry.category("formatters").get("percentage");return percentage(this.rawVariation);}
getBorderClass(){if(this.hasComparison){const varSign=this.variationSign;if(varSign===1){return{"border-success":true};}else if(varSign===-1){return{"border-danger":true};}}}
getAttClass(){const{statisticType,clickable}=this.props;return Object.assign({o_aggregate:statisticType==="aggregate",o_formula:statisticType==="formula",o_clickable:clickable,},this.getBorderClass());}
get variationClass(){if(this.hasComparison){const varSign=this.variationSign;if(varSign===1){return{"o_positive text-success":true};}else if(varSign===-1){return{"o_negative text-danger":true};}else if(varSign===0){return{o_null:true};}}}
onClicked(){if(this.props.clickable){this.trigger("change-statistic");}}}
DashboardStatistic.template="web_dashboard.DashboardStatistic";DashboardStatistic.components={Field};return __exports;});;

/* /web_dashboard/static/src/dashboard_view.js defined in bundle 'web.assets_backend' */
odoo.define('@web_dashboard/dashboard_view',async function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useEffect,useService}=require("@web/core/utils/hooks");const{capitalize,sprintf}=require("@web/core/utils/strings");const{useModel}=require("@web/views/helpers/model");const{standardViewProps}=require("@web/views/helpers/standard_view_props");const{useSetupView,useViewArch}=require("@web/views/helpers/view_hook");const{Layout}=require("@web/views/layout");const{OnboardingBanner}=require("@web/views/onboarding_banner");const{CallbackRecorder}=require("@web/webclient/actions/action_hook");const{DashboardArchParser}=require("@web_dashboard/dashboard_arch_parser");const{DashboardCompiler}=require("@web_dashboard/dashboard_compiler/dashboard_compiler");const{DashboardModel}=require("@web_dashboard/dashboard_model");const{DashboardStatistic}=require("@web_dashboard/dashboard_statistic/dashboard_statistic");const{ViewWidget}=require("@web_dashboard/view_widget");const{ViewWrapper}=require("@web_dashboard/view_wrapper/view_wrapper");const{Component}=owl;const viewRegistry=registry.category("views");const SUB_VIEW_CONTROL_PANEL_DISPLAY={"bottom-right":false,"top-left":false,"top-right":false,adaptToScroll:false,};const GRAPH_VIEW_PROPS={displayGroupByMenu:true,displayScaleLabels:false,};const VIEW_PROPS={graph:GRAPH_VIEW_PROPS,};const DashboardView=__exports.DashboardView=class DashboardView extends Component{setup(){this._viewService=useService("view");this.action=useService("action");this.subViewsRenderKey=1;const{resModel,arch,fields}=this.props;const processedArch=useViewArch(arch,{compile:(arch)=>new this.constructor.Compiler().compileArch(arch),extract:(arch)=>new this.constructor.ArchParser().parse(arch,fields),});this.template=processedArch.template;const{subViewRefs,aggregates,formulae}=processedArch.extracted;this.subViews={};Object.keys(subViewRefs).forEach((viewType)=>{this.subViews[viewType]={ref:subViewRefs[viewType],callbackRecorders:{__getLocalState__:new CallbackRecorder(),__getGlobalState__:new CallbackRecorder(),__getContext__:new CallbackRecorder(),},props:null,};if(this.props.state){this.subViews[viewType].state=this.props.state.subViews[viewType];}});this.aggregates=aggregates;this.formulae=formulae;useSetupView({getLocalState:()=>{return{subViews:this.callRecordedCallbacks("__getLocalState__"),};},getContext:()=>{return this.callRecordedCallbacks("__getContext__");},});this.model=useModel(this.constructor.Model,{resModel,fields,aggregates:this.aggregates,formulae:this.formulae,});useEffect(()=>{this.subViewsRenderKey++;});}
async willStart(){let loadViewProms=[];let additionalMeasures=this.aggregates.filter((a)=>{const{type}=this.props.fields[a.field];return type==="many2one";}).map((a)=>a.field);const allViews=Object.entries(this.subViews);if(!allViews.length){return;}
const resModel=this.props.resModel;const loadViewsContext=Object.assign({},this.props.context);const falseRefs={context:{},views:[],};const withRefs={context:{},views:[],};for(const[type,{ref}]of allViews){if(!ref){falseRefs.views.push([false,type]);}else{const viewRef=`${type}_view_ref`;withRefs.views.push([false,type]);withRefs.context[viewRef]=ref;}}
[falseRefs,withRefs].forEach((params)=>{const views=params.views;if(!views.length){return;}
const context=Object.assign(loadViewsContext,params.context);loadViewProms.push(this._viewService.loadViews({context,views,resModel},{}).then((viewDescriptions)=>{Object.entries(viewDescriptions).forEach(([type,viewInfo])=>{const subView=this.subViews[type];if(!subView){return;}
const context=Object.assign(this.props.context,this.props.context[type]||{});delete context[type];const{viewId,arch,fields}=viewInfo;subView.props={viewId,arch,fields,additionalMeasures,context,type,};});}));});await Promise.all(loadViewProms);}
async willUpdateProps(nextProps){if(this.currentMeasure){const states=this.callRecordedCallbacks("__getLocalState__");Object.entries(this.subViews).forEach(([viewType,subView])=>{subView.state=states[viewType];subView.state.metaData=Object.assign({},subView.state.metaData);if(viewType==="graph"||viewType==="cohort"){subView.state.metaData.measure=this.currentMeasure;}else if(viewType==="pivot"){subView.state.metaData.activeMeasures=[this.currentMeasure];}});}
const{comparison,domain}=nextProps;for(const[type,subView]of Object.entries(this.subViews)){const context=Object.assign(nextProps.context,nextProps.context[type]||{});delete context[type];Object.assign(subView.props,{comparison,context,domain});}
const globalStates=this.callRecordedCallbacks("__getGlobalState__");for(const[type,subView]of Object.entries(this.subViews)){subView.props=Object.assign({},subView.props,{globalState:globalStates[type]});}}
callRecordedCallbacks(name){const result={};for(const[viewType,subView]of Object.entries(this.subViews)){const callbacks=subView.callbackRecorders[name]._callbacks;if(callbacks.length){result[viewType]=callbacks.reduce((res,c)=>{return{...res,...c.callback()};},{});}}
return result;}
getViewWrapperProps(viewType){return{callbackRecorders:this.subViews[viewType].callbackRecorders,switchView:()=>this.openFullscreen(viewType),type:viewType,viewProps:this.getViewProps(viewType),};}
getViewProps(viewType){const subView=this.subViews[viewType];return Object.assign({domain:this.props.domain,comparison:this.props.comparison,resModel:this.props.resModel,context:Object.assign({},this.props.context),searchViewArch:this.props.info.searchViewArch,searchViewFields:this.props.info.searchViewFields,type:viewType,display:{controlPanel:SUB_VIEW_CONTROL_PANEL_DISPLAY},},VIEW_PROPS[viewType],subView.props,{noContentHelp:this.model.useSampleModel?false:undefined,useSampleModel:this.model.useSampleModel,state:subView.state,});}
openFullscreen(viewType){const action={domain:this.env.searchModel.globalDomain,context:this.props.context,name:sprintf(this.env._t("%s Analysis"),capitalize(viewType)),res_model:this.model.metaData.resModel,type:"ir.actions.act_window",views:[[false,viewType]],useSampleModel:false,};return this.action.doAction(action,{props:{state:this.callRecordedCallbacks("__getLocalState__")[viewType],globalState:{searchModel:JSON.stringify(this.env.searchModel.exportState())},},});}
onStatisticChange(statName){const stat=this.model.getStatisticDescription(statName);this.currentMeasure=stat.measure;if(stat.domain){this.env.searchModel.setDomainParts({dashboardMeasure:{domain:stat.domain,facetLabel:stat.domainLabel,},});}else{this.env.searchModel.setDomainParts({dashboardMeasure:null});}}}
DashboardView.template="web_dashboard.DashboardView";DashboardView.props=standardViewProps;DashboardView.components={Layout,DashboardStatistic,ViewWidget,ViewWrapper};DashboardView.Model=DashboardModel;DashboardView.ArchParser=DashboardArchParser;DashboardView.Compiler=DashboardCompiler;DashboardView.Banner=OnboardingBanner;DashboardView.type="dashboard";DashboardView.display_name="dashboard";DashboardView.icon="fa-tachometer";DashboardView.multiRecord=true;DashboardView.searchMenuTypes=["filter","comparison","favorite"];viewRegistry.add("dashboard",DashboardView);return __exports;});;

/* /web_dashboard/static/src/view_widget.js defined in bundle 'web.assets_backend' */
odoo.define('@web_dashboard/view_widget',async function(require){'use strict';let __exports={};const widgetRegistry=require("web.widget_registry");const widgetRegistryOwl=require("web.widgetRegistry");const{registry}=require("@web/core/registry");const{useEffect}=require("@web/core/utils/hooks");const{ComponentAdapter}=require("web.OwlCompatibility");const{decodeObjectForTemplate}=require("@web_dashboard/dashboard_compiler/compile_helpers");const ViewWidget=__exports.ViewWidget=class ViewWidget extends owl.Component{setup(){this.wowlEnv=this.env;this.renderId=1;useEffect(()=>{this.renderId++;});const widgetName=this.props.widgetName;const Widget=registry.category("view_widgets").get(widgetName,null);if(!Widget){this.isLegacyOwl=true;this.env=owl.Component.env;}
this.Widget=Widget||widgetRegistryOwl.get(widgetName)||widgetRegistry.get(widgetName);this.isLegacy=!(this.Widget instanceof owl.Component);}
get widgetProps(){if(!this.isLegacyOwl){return this.props;}else{throw new Error("To implement ....");}}
get widgetArgs(){const record=this.props.model._legacyRecord_;const node=this.props._legacyNode_?decodeObjectForTemplate(this.props._legacyNode_):{};node.name=this.props.widgetName;if(this.props.title){node.attrs=Object.assign(node.attrs||{},{title:this.props.title});}
return[record,node];}}
ViewWidget.template=owl.tags.xml`<t>
    <ComponentAdapter t-if="isLegacy" Component="Widget" widgetArgs="widgetArgs" t-key="renderId" class="o_widget" />
    <t t-else="" t-component="Widget" t-props="widgetProps" class="o_widget" />
</t>
`;ViewWidget.components={ComponentAdapter};return __exports;});;

/* /web_dashboard/static/src/view_wrapper/view_wrapper.js defined in bundle 'web.assets_backend' */
odoo.define('@web_dashboard/view_wrapper/view_wrapper',async function(require){'use strict';let __exports={};const{useEffect}=require("@web/core/utils/hooks");const{View}=require("@web/views/view");const{Component,hooks}=owl;const{useSubEnv}=hooks;const ViewWrapper=__exports.ViewWrapper=class ViewWrapper extends Component{setup(){useSubEnv(this.props.callbackRecorders);useEffect(()=>{const btns=this.el.querySelectorAll(".btn-primary, .btn-secondary");btns.forEach((btn)=>{btn.classList.remove("btn-primary","btn-secondary");btn.classList.add("btn-outline-secondary");});if(this.props.type==="cohort"){this.el.querySelectorAll("[class*=interval_button]").forEach((el)=>el.classList.add("text-muted"));}});}}
ViewWrapper.template="web_dashboard.ViewWrapper";ViewWrapper.components={View};return __exports;});;

/* /web_gantt/static/src/js/gantt_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_gantt.GanttController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var config=require('web.config');var dialogs=require('web.view_dialogs');var confirmDialog=require('web.Dialog').confirm;var QWeb=core.qweb;var _t=core._t;var GanttController=AbstractController.extend({events:_.extend({},AbstractController.prototype.events,{'click .o_gantt_button_add':'_onAddClicked','click .o_gantt_button_scale':'_onScaleClicked','click .o_gantt_button_prev':'_onPrevPeriodClicked','click .o_gantt_button_next':'_onNextPeriodClicked','click .o_gantt_button_today':'_onTodayClicked','click .o_gantt_button_expand_rows':'_onExpandClicked','click .o_gantt_button_collapse_rows':'_onCollapseClicked',}),custom_events:_.extend({},AbstractController.prototype.custom_events,{add_button_clicked:'_onCellAddClicked',plan_button_clicked:'_onCellPlanClicked',collapse_row:'_onCollapseRow',expand_row:'_onExpandRow',pill_clicked:'_onPillClicked',pill_resized:'_onPillResized',pill_dropped:'_onPillDropped',updating_pill_started:'_onPillUpdatingStarted',updating_pill_stopped:'_onPillUpdatingStopped',}),buttonTemplateName:'GanttView.buttons',init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.model=model;this.context=params.context;this.dialogViews=params.dialogViews;this.SCALES=params.SCALES;this.allowedScales=params.allowedScales;this.collapseFirstLevel=params.collapseFirstLevel;this.createAction=params.createAction;this.actionDomain=params.actionDomain;this.isRTL=_t.database.parameters.direction==="rtl";},renderButtons:function($node){this.$buttons=this._renderButtonsQWeb();if($node){this.$buttons.appendTo($node);}},_renderButtonsQWeb:function(){return $(QWeb.render(this.buttonTemplateName,this._renderButtonQWebParameter()));},_renderButtonQWebParameter:function(){var state=this.model.get();var nbGroups=state.groupedBy.length;var minNbGroups=this.collapseFirstLevel?0:1;var displayExpandCollapseButtons=nbGroups>minNbGroups;return{groupedBy:state.groupedBy,widget:this,SCALES:this.SCALES,activateScale:state.scale,allowedScales:this.allowedScales,displayExpandCollapseButtons:displayExpandCollapseButtons,isMobile:config.device.isMobile,};},updateButtons:function(){if(!this.$buttons){return;}
this.$buttons.html(this._renderButtonsQWeb());},_copy:function(id,schedule){return this._executeAsyncOperation(this.model.copy.bind(this.model),[id,schedule]);},_executeAsyncOperation:function(operation,args){const self=this;var prom=new Promise(function(resolve,reject){var asyncOp=operation(...args);asyncOp.then(resolve).guardedCatch(resolve);self.dp.add(asyncOp).guardedCatch(reject);});return prom.then(this.reload.bind(this,{}));},_getDialogContext:function(date,rowId){var state=this.model.get();var context={};context[state.dateStartField]=date.clone();context[state.dateStopField]=date.clone().endOf(this.SCALES[state.scale].interval);if(rowId){_.each(state.groupedBy,function(fieldName){const groupValue=Object.assign({},...JSON.parse(rowId));var value=groupValue[fieldName];if(Array.isArray(value)){const{type:fieldType}=state.fields[fieldName];if(fieldType==="many2many"){value=[value[0]];}else if(fieldType==="many2one"){value=value[0];}}
if(value!==undefined){context[fieldName]=value;}});}
for(var k in context){var type=state.fields[k].type;if(context[k]&&(type==='datetime'||type==='date')){context[k]=this.model.convertToServerTime(context[k]);}}
return context;},_openDialog:function(resID,context){var title=resID?_t("Open"):_t("Create");return new dialogs.FormViewDialog(this,{title:_.str.sprintf(title),res_model:this.modelName,view_id:this.dialogViews[0][0],res_id:resID,readonly:!this.is_action_enabled('edit'),deletable:this.is_action_enabled('delete')&&resID,context:_.extend({},this.context,context),on_saved:this.reload.bind(this,{}),on_remove:this._onDialogRemove.bind(this,resID),}).open();},_onDialogRemove:function(resID){var controller=this;var confirm=new Promise(function(resolve){confirmDialog(this,_t('Are you sure to delete this record?'),{confirm_callback:function(){resolve(true);},cancel_callback:function(){resolve(false);},});});return confirm.then(function(confirmed){if((!confirmed)){return Promise.resolve();}
return controller._rpc({model:controller.modelName,method:'unlink',args:[[resID,],],}).then(function(){return controller.reload();})});},_openPlanDialog:function(context){var self=this;var state=this.model.get();var domain=['|',[state.dateStartField,'=',false],[state.dateStopField,'=',false],];new dialogs.SelectCreateDialog(this,{title:_t("Plan"),res_model:this.modelName,domain:this.actionDomain.concat(domain),views:this.dialogViews,context:_.extend({},this.context,context),on_selected:function(records){var ids=_.pluck(records,'id');if(ids.length){self._reschedule(ids,context,true,self.openPlanDialogCallback);}},}).open();},_onCreate:function(context){if(this.createAction){var fullContext=_.extend({},this.context,context);this.do_action(this.createAction,{additional_context:fullContext,on_close:this.reload.bind(this,{})});}else{this._openDialog(undefined,context);}},_reschedule:function(ids,schedule,isUTC,callback){return this._executeAsyncOperation(this.model.reschedule.bind(this.model),[ids,schedule,isUTC,callback]);},_onCellAddClicked:function(ev){ev.stopPropagation();const context=this._getDialogContext(ev.data.date,ev.data.rowId);for(var k in context){context[_.str.sprintf('default_%s',k)]=context[k];}
this._onCreate(context);},_onAddClicked:function(ev){ev.preventDefault();var context={};var state=this.model.get();context[state.dateStartField]=this.model.convertToServerTime(state.focusDate.clone().startOf(state.scale));context[state.dateStopField]=this.model.convertToServerTime(state.focusDate.clone().endOf(state.scale));for(var k in context){context[_.str.sprintf('default_%s',k)]=context[k];}
this._onCreate(context);},_onCollapseClicked:function(ev){ev.preventDefault();this.model.collapseRows();this.update({},{reload:false});},_onCollapseRow:function(ev){ev.stopPropagation();this.model.collapseRow(ev.data.rowId);this.renderer.updateRow(this.model.get(ev.data.rowId));},_onExpandClicked:function(ev){ev.preventDefault();this.model.expandRows();this.update({},{reload:false});},_onExpandRow:function(ev){ev.stopPropagation();this.model.expandRow(ev.data.rowId);this.renderer.updateRow(this.model.get(ev.data.rowId));},_onNextPeriodClicked:function(ev){ev.preventDefault();var state=this.model.get();this.update({date:state.focusDate.add(1,state.scale)});},_onPillClicked:async function(ev){if(!this._updating){ev.data.target.addClass('o_gantt_pill_editing');await this.model.mutex.getUnlockedDef();var dialog=this._openDialog(ev.data.target.data('id'));dialog.on('closed',this,function(){ev.data.target.removeClass('o_gantt_pill_editing');});}},_onPillDropped:function(ev){ev.stopPropagation();var state=this.model.get();var schedule={};var diff=ev.data.diff;diff=this.isRTL?-diff:diff;if(diff){var pill=_.findWhere(state.records,{id:ev.data.pillId});schedule[state.dateStartField]=this.model.dateAdd(pill[state.dateStartField],diff,this.SCALES[state.scale].time);schedule[state.dateStopField]=this.model.dateAdd(pill[state.dateStopField],diff,this.SCALES[state.scale].time);}else if(ev.data.action==='copy'){const pill=_.findWhere(state.records,{id:ev.data.pillId});schedule[state.dateStartField]=pill[state.dateStartField].clone();schedule[state.dateStopField]=pill[state.dateStopField].clone();}
if(ev.data.newRowId&&ev.data.newRowId!==ev.data.oldRowId){const groupValue=Object.assign({},...JSON.parse(ev.data.newRowId));var fieldsToWrite=state.groupedBy.slice(0,ev.data.groupLevel+1);_.each(fieldsToWrite,function(fieldName){let valueToWrite=groupValue[fieldName];if(Array.isArray(valueToWrite)){const{type:fieldType}=state.fields[fieldName];if(fieldType==="many2many"){valueToWrite=[valueToWrite[0]];}else if(fieldType==="many2one"){valueToWrite=valueToWrite[0];}}
schedule[fieldName]=valueToWrite;});}
if(ev.data.action==='copy'){this._copy(ev.data.pillId,schedule);}else{this._reschedule(ev.data.pillId,schedule);}},_onPillResized:function(ev){ev.stopPropagation();var schedule={};schedule[ev.data.field]=ev.data.date;this._reschedule(ev.data.id,schedule);},_onPillUpdatingStarted:function(ev){ev.stopPropagation();this._updating=true;},_onPillUpdatingStopped:function(ev){ev.stopPropagation();this._updating=false;},_onCellPlanClicked:function(ev){ev.stopPropagation();const context=this._getDialogContext(ev.data.date,ev.data.rowId);this._openPlanDialog(context);},_onPrevPeriodClicked:function(ev){ev.preventDefault();var state=this.model.get();this.update({date:state.focusDate.subtract(1,state.scale)});},_onScaleClicked:function(ev){ev.preventDefault();var $button=$(ev.currentTarget);if($button.hasClass('active')){return;}
this.update({scale:$button.data('value')});},_onTodayClicked:function(ev){ev.preventDefault();this.update({date:moment()});},});return GanttController;});;

/* /web_gantt/static/src/js/gantt_model.js defined in bundle 'web.assets_backend' */
odoo.define('web_gantt.GanttModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var core=require('web.core');var fieldUtils=require('web.field_utils');const{findWhere,groupBy}=require('web.utils');var session=require('web.session');var _t=core._t;var GanttModel=AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.dp=new concurrency.DropPrevious();this.mutex=new concurrency.Mutex();},collapseRow:function(rowId){this.allRows[rowId].isOpen=false;},collapseRows:function(){this.ganttData.rows.forEach(function(group){group.isOpen=false;});},convertToServerTime:function(date){var result=date.clone();if(!result.isUTC()){result.subtract(session.getTZOffset(date),'minutes');}
return result.locale('en').format('YYYY-MM-DD HH:mm:ss');},dateAdd:function(date,offset,unit){var result=date.clone().add(offset,unit);if(Math.abs(result.diff(date,'hours'))>=24){var tzOffsetDiff=result.clone().local().utcOffset()-date.clone().local().utcOffset();if(tzOffsetDiff!==0){result.subtract(tzOffsetDiff,'minutes');}}
return result;},__get:function(rowId){if(rowId){return this.allRows[rowId];}else{return Object.assign({isSample:this.isSampleModel},this.ganttData);}},expandRow:function(rowId){this.allRows[rowId].isOpen=true;},expandRows:function(){var self=this;Object.keys(this.allRows).forEach(function(rowId){var row=self.allRows[rowId];if(row.isGroup){self.allRows[rowId].isOpen=true;}});},__load:async function(params){await this._super(...arguments);this.modelName=params.modelName;this.fields=params.fields;this.domain=params.domain;this.context=params.context;this.decorationFields=params.decorationFields;this.colorField=params.colorField;this.progressField=params.progressField;this.consolidationParams=params.consolidationParams;this.collapseFirstLevel=params.collapseFirstLevel;this.displayUnavailability=params.displayUnavailability;this.SCALES=params.SCALES;this.defaultGroupBy=params.defaultGroupBy?[params.defaultGroupBy]:[];let groupedBy=params.groupedBy;if(!groupedBy||!groupedBy.length){groupedBy=this.defaultGroupBy;}
groupedBy=this._filterDateInGroupedBy(groupedBy);this.ganttData={dateStartField:params.dateStartField,dateStopField:params.dateStopField,groupedBy,fields:params.fields,dynamicRange:params.dynamicRange,};this._setRange(params.initialDate,params.scale);return this._fetchData().then(function(){return Promise.resolve();});},__reload:async function(handle,params){await this._super(...arguments);if('scale'in params){this._setRange(this.ganttData.focusDate,params.scale);}
if('date'in params){this._setRange(params.date,this.ganttData.scale);}
if('domain'in params){this.domain=params.domain;}
if('groupBy'in params){if(params.groupBy&&params.groupBy.length){this.ganttData.groupedBy=this._filterDateInGroupedBy(params.groupBy);if(this.ganttData.groupedBy.length!==params.groupBy.length){this.displayNotification({message:_t('Grouping by date is not supported'),type:'danger'});}}else{this.ganttData.groupedBy=this.defaultGroupBy;}}
return this._fetchData().then(function(){return Promise.resolve();});},copy:function(id,schedule){var self=this;const defaults=this.rescheduleData(schedule);return this.mutex.exec(function(){return self._rpc({model:self.modelName,method:'copy',args:[id,defaults],context:self.context,});});},reschedule:function(ids,schedule,isUTC,callback){var self=this;if(!_.isArray(ids)){ids=[ids];}
const data=this.rescheduleData(schedule,isUTC);return this.mutex.exec(function(){return self._rpc({model:self.modelName,method:'write',args:[ids,data],context:self.context,}).then((result)=>{if(callback){callback(result);}});});},rescheduleData:function(schedule,isUTC){const allowedFields=[this.ganttData.dateStartField,this.ganttData.dateStopField,...this.ganttData.groupedBy];const data=_.pick(schedule,allowedFields);let type;for(let k in data){type=this.fields[k].type;if(data[k]&&(type==='datetime'||type==='date')&&!isUTC){data[k]=this.convertToServerTime(data[k]);}};return data},_fetchData:function(){var self=this;var domain=this._getDomain();var context=Object.assign({},this.context,{group_by:this.ganttData.groupedBy});var groupsDef;if(this.ganttData.groupedBy.length){groupsDef=this._rpc({model:this.modelName,method:'read_group',fields:this._getFields(),domain:domain,context:context,groupBy:this.ganttData.groupedBy,orderBy:this.ganttData.groupedBy.map(function(f){return{name:f};}),lazy:this.ganttData.groupedBy.length===1,});}
var dataDef=this._rpc({route:'/web/dataset/search_read',model:this.modelName,fields:this._getFields(),context:context,domain:domain,});return this.dp.add(Promise.all([groupsDef,dataDef])).then(function(results){const groups=results[0]||[];groups.forEach((g)=>(g.fromServer=true));var searchReadResult=results[1];var oldRows=self.allRows;self.allRows={};self.ganttData.records=self._parseServerData(searchReadResult.records);self.ganttData.rows=self._generateRows({groupedBy:self.ganttData.groupedBy,groups:groups,oldRows:oldRows,parentPath:[],records:self.ganttData.records,});var unavailabilityProm;if(self.displayUnavailability&&!self.isSampleModel){unavailabilityProm=self._fetchUnavailability();}
return unavailabilityProm;});},_computeUnavailabilityRows:function(rows){var self=this;return _.map(rows,function(r){if(r){return{groupedBy:r.groupedBy,records:r.records,name:r.name,resId:r.resId,rows:self._computeUnavailabilityRows(r.rows)}}else{return r;}});},_fetchUnavailability:function(){var self=this;return this._rpc({model:this.modelName,method:'gantt_unavailability',args:[this.convertToServerTime(this.ganttData.startDate),this.convertToServerTime(this.ganttData.stopDate),this.ganttData.scale,this.ganttData.groupedBy,this._computeUnavailabilityRows(this.ganttData.rows),],context:this.context,}).then(function(enrichedRows){self._updateUnavailabilityRows(self.ganttData.rows,enrichedRows);});},_updateUnavailabilityRows:function(original,enriched){var self=this;_.zip(original,enriched).forEach(function(rowPair){var o=rowPair[0];var e=rowPair[1];o.unavailabilities=_.map(e.unavailabilities,function(u){u.start=self._parseServerValue({type:'datetime'},u.start);u.stop=self._parseServerValue({type:'datetime'},u.stop);return u;});if(o.rows&&e.rows){self._updateUnavailabilityRows(o.rows,e.rows);}});},_generateRows(params){const{groupedBy,groups,oldRows,parentPath,records}=params;const groupLevel=this.ganttData.groupedBy.length-groupedBy.length;if(!groupedBy.length||!groups.length){const row={groupLevel,id:JSON.stringify([...parentPath,{}]),isGroup:false,name:"",records,};this.allRows[row.id]=row;return[row];}
const rows=[];const groupedByField=groupedBy[0];const currentLevelGroups=groupBy(groups,group=>{if(group[groupedByField]===undefined){group[groupedByField]=false;}
return group[groupedByField];});const isM2MGrouped=this.ganttData.fields[groupedByField].type==="many2many";let groupedRecords;if(isM2MGrouped){groupedRecords={};for(const[key,currentGroup]of Object.entries(currentLevelGroups)){groupedRecords[key]=[];const value=currentGroup[0][groupedByField];for(const r of records||[]){if(!value&&r[groupedByField].length===0||value&&r[groupedByField].includes(value[0])){groupedRecords[key].push(r)}}}}else{groupedRecords=groupBy(records||[],groupedByField);}
for(const key in currentLevelGroups){const subGroups=currentLevelGroups[key];const groupRecords=groupedRecords[key]||[];let value;if(groupRecords&&groupRecords.length&&!isM2MGrouped){value=groupRecords[0][groupedByField];}else{value=subGroups[0][groupedByField];}
const part={};part[groupedByField]=value;const path=[...parentPath,part];const id=JSON.stringify(path);const resId=Array.isArray(value)?value[0]:value;const minNbGroups=this.collapseFirstLevel?0:1;const isGroup=groupedBy.length>minNbGroups;const fromServer=subGroups.some((g)=>g.fromServer);const row={name:this._getRowName(groupedByField,value),groupedBy,groupedByField,groupLevel,id,resId,isGroup,fromServer,isOpen:!findWhere(oldRows,{id:JSON.stringify(parentPath),isOpen:false}),records:groupRecords,};if(isGroup){row.rows=this._generateRows({...params,groupedBy:groupedBy.slice(1),groups:subGroups,oldRows,parentPath:path,records:groupRecords,});row.childrenRowIds=[];row.rows.forEach(function(subRow){row.childrenRowIds.push(subRow.id);row.childrenRowIds=row.childrenRowIds.concat(subRow.childrenRowIds||[]);});}
rows.push(row);this.allRows[row.id]=row;}
return rows;},_getDomain:function(){var domain=[[this.ganttData.dateStartField,'<=',this.convertToServerTime(this.ganttData.stopDate)],[this.ganttData.dateStopField,'>=',this.convertToServerTime(this.ganttData.startDate)],];return this.domain.concat(domain);},_getFields:function(){var fields=['display_name',this.ganttData.dateStartField,this.ganttData.dateStopField];fields=fields.concat(this.ganttData.groupedBy,this.decorationFields);if(this.progressField){fields.push(this.progressField);}
if(this.colorField){fields.push(this.colorField);}
if(this.consolidationParams.field){fields.push(this.consolidationParams.field);}
if(this.consolidationParams.excludeField){fields.push(this.consolidationParams.excludeField);}
return _.uniq(fields);},_getFieldFormattedValue:function(value,field){var options={};if(field.type==='boolean'){options={forceString:true};}
let label;if(field.type==="many2many"){label=Array.isArray(value)?value[1]:value;}else{label=fieldUtils.format[field.type](value,field,options);}
return label||_.str.sprintf(_t('Undefined %s'),field.string);},_getRowName(groupedByField,value){const field=this.fields[groupedByField];return this._getFieldFormattedValue(value,field);},_isEmpty(){return!this.ganttData.records.length;},_parseServerData:function(data){var self=this;data.forEach(function(record){Object.keys(record).forEach(function(fieldName){record[fieldName]=self._parseServerValue(self.fields[fieldName],record[fieldName]);});});return data;},_setRange:function(focusDate,scale){this.ganttData.scale=scale;this.ganttData.focusDate=focusDate;if(this.ganttData.dynamicRange){this.ganttData.startDate=focusDate.clone().startOf(this.SCALES[scale].interval);this.ganttData.stopDate=this.ganttData.startDate.clone().add(1,scale);}else{this.ganttData.startDate=focusDate.clone().startOf(scale);this.ganttData.stopDate=focusDate.clone().endOf(scale);}},_filterDateInGroupedBy(groupedBy){return groupedBy.filter(groupedByField=>{var fieldName=groupedByField.split(':')[0];return fieldName in this.fields&&this.fields[fieldName].type.indexOf('date')===-1;});},});return GanttModel;});;

/* /web_gantt/static/src/js/gantt_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_gantt.GanttRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var GanttRow=require('web_gantt.GanttRow');var qweb=require('web.QWeb');var session=require('web.session');var utils=require('web.utils');var QWeb=core.qweb;var _t=core._t;var GanttRenderer=AbstractRenderer.extend({config:{GanttRow:GanttRow},custom_events:_.extend({},AbstractRenderer.prototype.custom_events,{'start_dragging':'_onStartDragging','start_no_dragging':'_onStartNoDragging','stop_dragging':'_onStopDragging','stop_no_dragging':'_onStopNoDragging',}),DECORATIONS:['decoration-secondary','decoration-success','decoration-info','decoration-warning','decoration-danger',],sampleDataTargets:['.o_gantt_row',],init:function(parent,state,params){var self=this;this._super.apply(this,arguments);this.$draggedPill=null;this.$draggedPillClone=null;this.canCreate=params.canCreate;this.canCellCreate=params.canCellCreate;this.canEdit=params.canEdit;this.canPlan=params.canPlan;this.cellPrecisions=params.cellPrecisions;this.colorField=params.colorField;this.disableDragdrop=params.disableDragdrop;this.progressField=params.progressField;this.consolidationParams=params.consolidationParams;this.fieldsInfo=params.fieldsInfo;this.SCALES=params.SCALES;this.string=params.string;this.totalRow=params.totalRow;this.collapseFirstLevel=params.collapseFirstLevel;this.thumbnails=params.thumbnails;this.rowWidgets={};this.pillDecorations=_.chain(this.arch.attrs).pick(function(value,key){return self.DECORATIONS.indexOf(key)>=0;}).mapObject(function(value){return py.parse(py.tokenize(value));}).value();if(params.popoverTemplate){this.popoverQWeb=new qweb(config.isDebug(),{_s:session.origin});this.popoverQWeb.add_template(utils.json_node_to_xml(params.popoverTemplate));}else{this.popoverQWeb=QWeb;}
this.isRTL=_t.database.parameters.direction==="rtl";this.template_to_use="GanttView";},on_attach_callback:function(){this._isInDom=true;core.bus.on("keydown",this,this._onKeydown);core.bus.on("keyup",this,this._onKeyup);if(!this.disableDragdrop){this._setRowsDroppable();}},on_detach_callback:function(){this._isInDom=false;core.bus.off("keydown",this,this._onKeydown);core.bus.off("keyup",this,this._onKeyup);_.invoke(this.rowWidgets,'on_detach_callback');},updateRow:function(rowState){var self=this;var oldRowIds=[rowState.id].concat(rowState.childrenRowIds);var oldRows=[];oldRowIds.forEach(function(rowId){if(self.rowWidgets[rowId]){oldRows.push(self.rowWidgets[rowId]);delete self.rowWidgets[rowId];}});this.proms=[];var rows=this._renderRows([rowState],rowState.groupedBy);var proms=this.proms;delete this.proms;return Promise.all(proms).then(function(){var $previousRow=oldRows[0].$el;rows.forEach(function(row){row.$el.insertAfter($previousRow);$previousRow=row.$el;});_.invoke(oldRows,'destroy');if(!self.disableDragdrop){self._setRowsDroppable();}});},_getAction:function(event){return event.ctrlKey||event.metaKey?'copy':'reschedule';},_getFocusDateFormat:function(){var focusDate=this.state.focusDate;switch(this.state.scale){case'day':return focusDate.format('dddd, MMMM DD, YYYY');case'week':var dateStart=focusDate.clone().startOf('week').format('DD MMMM YYYY');var dateEnd=focusDate.clone().endOf('week').format('DD MMMM YYYY');return _.str.sprintf('%s - %s',dateStart,dateEnd);case'month':return focusDate.format('MMMM YYYY');case'year':return focusDate.format('YYYY');default:break;}},_getSlotsDates:function(){var token=this.SCALES[this.state.scale].interval;var stopDate=this.state.stopDate;var day=this.state.startDate;var dates=[];while(day<=stopDate){dates.push(day);day=day.clone().add(1,token);}
return dates;},_prepareViewInfo:function(){return{colorField:this.colorField,progressField:this.progressField,consolidationParams:this.consolidationParams,state:this.state,fieldsInfo:this.fieldsInfo,slots:this._getSlotsDates(),pillDecorations:this.pillDecorations,popoverQWeb:this.popoverQWeb,activeScaleInfo:{precision:this.cellPrecisions[this.state.scale],interval:this.SCALES[this.state.scale].cellPrecisions[this.cellPrecisions[this.state.scale]],time:this.SCALES[this.state.scale].time,},};},async _renderView(){var self=this;var oldRowWidgets=Object.keys(this.rowWidgets).map(function(rowId){return self.rowWidgets[rowId];});this.rowWidgets={};this.viewInfo=this._prepareViewInfo();this.proms=[];var rows=this._renderRows(this.state.rows,this.state.groupedBy);var totalRow;if(this.totalRow){totalRow=this._renderTotalRow();}
this.proms.push(this._super.apply(this,arguments));var proms=this.proms;delete this.proms;return Promise.all(proms).then(function(){_.invoke(oldRowWidgets,'destroy');self.$el.empty();self._replaceElement(QWeb.render(self.template_to_use,{widget:self,isMobile:config.device.isMobile}));const $containment=$('<div id="o_gantt_containment"/>');const $rowContainer=self.$('.o_gantt_row_container');$rowContainer.append($containment);if(!self.state.groupedBy.length){$containment.css(self.isRTL?{right:0}:{left:0});}
rows.forEach(function(row){row.$el.appendTo($rowContainer);});if(totalRow){totalRow.$el.appendTo(self.$('.o_gantt_total_row_container'));}
if(self._isInDom&&!self.disableDragdrop){self._setRowsDroppable();}
if(self.state.isSample){self._renderNoContentHelper();}});},_renderRows:function(rows,groupedBy){var self=this;var rowWidgets=[];var disableResize=this.state.scale==='year';var groupLevel=this.state.groupedBy.length-groupedBy.length;var hideSidebar=groupedBy.length===0;if(this.collapseFirstLevel){hideSidebar=self.state.groupedBy.length===0;}
rows.forEach(function(row){const pillsInfo=self._getPillsInfo(row,groupLevel);if(groupedBy.length){pillsInfo.groupName=row.name;pillsInfo.groupedByField=row.groupedByField;}
var params={canCreate:self.canCreate,canCellCreate:self.canCellCreate,canEdit:self.canEdit,canPlan:self.canPlan,isGroup:row.isGroup,consolidate:(groupLevel===0)&&(self.state.groupedBy[0]===self.consolidationParams.maxField),hideSidebar:hideSidebar,isOpen:row.isOpen,disableResize:disableResize,disableDragdrop:self.disableDragdrop,rowId:row.id,fromServer:row.fromServer,scales:self.SCALES,unavailabilities:row.unavailabilities,};if(self.thumbnails&&row.groupedByField&&row.groupedByField in self.thumbnails){params.thumbnail={model:self.fieldsInfo[row.groupedByField].relation,field:self.thumbnails[row.groupedByField],};}
rowWidgets.push(self._renderRow(pillsInfo,params));if(row.isGroup&&row.isOpen){var subRowWidgets=self._renderRows(row.rows,groupedBy.slice(1));rowWidgets=rowWidgets.concat(subRowWidgets);}});return rowWidgets;},_renderRow:function(pillsInfo,params){var ganttRow=new this.config.GanttRow(this,pillsInfo,this.viewInfo,params);this.rowWidgets[ganttRow.rowId]=ganttRow;this.proms.push(ganttRow._widgetRenderAndInsert(function(){}));return ganttRow;},_renderTotalRow:function(){var pillsInfo={pills:this.state.records,groupLevel:0,groupName:"Total"};var params={canCreate:this.canCreate,canCellCreate:this.canCellCreate,canEdit:this.canEdit,canPlan:this.canPlan,hideSidebar:this.state.groupedBy.length===0,isGroup:true,rowId:'__total_row__',scales:this.SCALES,};return this._renderRow(pillsInfo,params);},_setRowsDroppable:function(){const firstCell=this.$('.o_gantt_header_scale .o_gantt_header_cell:first')[0];_.invoke(this.rowWidgets,'setDroppable',firstCell);},_getPillsInfo:function(row,groupLevel){return{resId:row.resId,pills:row.records,groupLevel:groupLevel,};},_onKeydown:function(ev){this.action=this._getAction(ev);if(this.$draggedPill&&this.action==='copy'){this.$el.addClass('o_copying');this.$el.removeClass('o_grabbing');}},_onKeyup:function(ev){this.action=this._getAction(ev);if(this.$draggedPill&&this.action==='reschedule'){this.$el.addClass('o_grabbing');this.$el.removeClass('o_copying');}},_onStartDragging:function(event){this.$draggedPill=event.data.$draggedPill;this.$draggedPill.addClass('o_dragged_pill');if(this.action==='copy'){this.$el.addClass('o_copying');}else{this.$el.addClass('o_grabbing');}},_onStartNoDragging:function(){this.$el.addClass('o_no_dragging');},_onStopDragging:function(){this.$draggedPill.removeClass('o_dragged_pill');this.$draggedPill=null;this.$draggedPillClone=null;this.$el.removeClass('o_grabbing');this.$el.removeClass('o_copying');},_onStopNoDragging:function(){this.$el.removeClass('o_no_dragging');},});return GanttRenderer;});;

/* /web_gantt/static/src/js/gantt_row.js defined in bundle 'web.assets_backend' */
odoo.define('web_gantt.GanttRow',function(require){"use strict";var core=require('web.core');var config=require('web.config');var session=require('web.session');var Widget=require('web.Widget');const pyUtils=require('web.py_utils');let pyUtilsContext=null;var QWeb=core.qweb;var _t=core._t;var GanttRow=Widget.extend({template:'GanttView.Row',events:{'mouseleave':'_onMouseLeave','mousemove .o_gantt_cell':'_onMouseMove','mouseenter .o_gantt_pill':'_onPillEntered','click .o_gantt_pill':'_onPillClicked','click':'_onRowSidebarClicked','click .o_gantt_cell_buttons > div > .o_gantt_cell_add':'_onButtonAddClicked','click .o_gantt_cell_buttons > div > .o_gantt_cell_plan':'_onButtonPlanClicked',},NB_GANTT_RECORD_COLORS:12,LEVEL_LEFT_OFFSET:16,LEVEL_TOP_OFFSET:31,POPOVER_DELAY:260,init:function(parent,pillsInfo,viewInfo,options){this._super.apply(this,arguments);var self=this;this.name=pillsInfo.groupName;this.groupLevel=pillsInfo.groupLevel;this.groupedByField=pillsInfo.groupedByField;this.pills=_.map(pillsInfo.pills,_.clone);this.resId=pillsInfo.resId;this.viewInfo=viewInfo;this.fieldsInfo=viewInfo.fieldsInfo;this.state=viewInfo.state;this.colorField=viewInfo.colorField;this.options=options;this.SCALES=options.scales;this.isGroup=options.isGroup;this.isOpen=options.isOpen;this.rowId=options.rowId;this.fromServer=options.fromServer;this.unavailabilities=(options.unavailabilities||[]).map(u=>{return{startDate:self._convertToUserTime(u.start),stopDate:self._convertToUserTime(u.stop)};});this.consolidate=options.consolidate;this.consolidationParams=viewInfo.consolidationParams;if(options.thumbnail){this.thumbnailUrl=session.url('/web/image',{model:options.thumbnail.model,id:this.resId,field:this.options.thumbnail.field,});}
this.isTotal=this.rowId==='__total_row__';this._adaptPills();this._snapToGrid(this.pills);this._calculateLevel();if(this.isGroup&&this.pills.length){this._aggregateGroupedPills();}else{this.progressField=viewInfo.progressField;this._evaluateDecoration();}
this._calculateMarginAndWidth();this.leftPadding=(this.groupLevel+1)*this.LEVEL_LEFT_OFFSET;this.cellHeight=this.level*(this.LEVEL_TOP_OFFSET+3)+(this.level>0?this.level:0);this.MIN_WIDTHS={full:100,half:50,quarter:25};this.PARTS={full:1,half:2,quarter:4};this.cellMinWidth=this.MIN_WIDTHS[this.viewInfo.activeScaleInfo.precision];this.cellPart=this.PARTS[this.viewInfo.activeScaleInfo.precision];this._prepareSlots();this._insertIntoSlot();this.childrenRows=[];this._onButtonAddClicked=_.debounce(this._onButtonAddClicked,500,true);this._onButtonPlanClicked=_.debounce(this._onButtonPlanClicked,500,true);this._onPillClicked=_.debounce(this._onPillClicked,500,true);if(this.isTotal){const maxCount=Math.max(...this.pills.map(p=>p.count));const factor=maxCount?(90/maxCount):0;for(let p of this.pills){p.totalHeight=factor*p.count;}}
this.isRTL=_t.database.parameters.direction==="rtl";},destroy:function(){if(this.$el){this.$('.o_gantt_pill').popover('dispose');}
this._super();},setDroppable:function(firstCell){if(this.isTotal){return;}
var self=this;const resizeSnappingWidth=this._getResizeSnappingWidth(firstCell);this.$el.droppable({drop:function(event,ui){var diff=self._getDiff(resizeSnappingWidth,ui.position.left);var $pill=ui.draggable;const oldRowId=$pill.closest('.o_gantt_row')[0].dataset.rowId;if(diff||(self.rowId!==oldRowId)){const action=event.ctrlKey||event.metaKey?'copy':'reschedule';self._saveDragChanges($pill.data('id'),diff,oldRowId,self.rowId,action);}else{ui.helper.animate({left:0,top:0,});}},tolerance:'intersect',});},_bindPillPopover:function(target){var self=this;var $target=$(target);if(!$target.hasClass('o_gantt_pill')){$target=this.$(target.offsetParent);}
$target.popover({container:this.$el,trigger:'hover',delay:{show:this.POPOVER_DELAY},html:true,placement:'auto',content:function(){return self.viewInfo.popoverQWeb.render('gantt-popover',self._getPopoverContext($(this).data('id')));},}).popover("show");},_calculateLevel:function(){if(this.isGroup||!this.pills.length){this.level=0;this.pills.forEach(function(pill){pill.level=0;});}else{this.pills=_.sortBy(this.pills,'startDate');this.pills[0].level=0;var levels=[{pills:[this.pills[0]],maxStopDate:this.pills[0].stopDate,}];for(var i=1;i<this.pills.length;i++){var currentPill=this.pills[i];for(var l=0;l<levels.length;l++){if(currentPill.startDate>=levels[l].maxStopDate){currentPill.level=l;levels[l].pills.push(currentPill);if(currentPill.stopDate>levels[l].maxStopDate){levels[l].maxStopDate=currentPill.stopDate;}
break;}}
if(!currentPill.level&&currentPill.level!=0){currentPill.level=levels.length;levels.push({pills:[currentPill],maxStopDate:currentPill.stopDate,});}}
this.level=levels.length;}},_adaptPills:function(){var self=this;var dateStartField=this.state.dateStartField;var dateStopField=this.state.dateStopField;var ganttStartDate=this.state.startDate;var ganttStopDate=this.state.stopDate;this.pills.forEach(function(pill){var pillStartDate=self._convertToUserTime(pill[dateStartField]);var pillStopDate=self._convertToUserTime(pill[dateStopField]);if(pillStartDate<ganttStartDate){pill.startDate=ganttStartDate;pill.disableStartResize=true;}else{pill.startDate=pillStartDate;}
if(pillStopDate>ganttStopDate){pill.stopDate=ganttStopDate;pill.disableStopResize=true;}else{pill.stopDate=pillStopDate;}
if(self.isGroup){pill.disableStartResize=true;pill.disableStopResize=true;}});},_aggregateGroupedPills:function(){var self=this;var sortedPills=_.sortBy(_.map(this.pills,_.clone),'startDate');var firstPill=sortedPills[0];firstPill.count=1;var timeToken=this.SCALES[this.state.scale].time;var precision=this.viewInfo.activeScaleInfo.precision;var cellTime=this.SCALES[this.state.scale].cellPrecisions[precision];var intervals=_.reduce(this.viewInfo.slots,function(intervals,slotStart){intervals.push(slotStart);if(precision==='half'){intervals.push(slotStart.clone().add(cellTime,timeToken));}
return intervals;},[]);this.pills=_.reduce(intervals,function(pills,intervalStart){var intervalStop=intervalStart.clone().add(cellTime,timeToken);var pillsInThisInterval=_.filter(self.pills,function(pill){return pill.startDate<intervalStop&&pill.stopDate>intervalStart;});if(pillsInThisInterval.length){var previousPill=pills[pills.length-1];var isContinuous=previousPill&&_.intersection(previousPill.aggregatedPills,pillsInThisInterval).length;if(isContinuous&&previousPill.count===pillsInThisInterval.length){previousPill.stopDate=intervalStop;previousPill.aggregatedPills=previousPill.aggregatedPills.concat(pillsInThisInterval);}else{var newPill={id:0,count:pillsInThisInterval.length,aggregatedPills:pillsInThisInterval,startDate:moment.max(_.min(pillsInThisInterval,'startDate').startDate,intervalStart),stopDate:moment.min(_.max(pillsInThisInterval,'stopDate').stopDate,intervalStop),};if(self.consolidate&&self.consolidationParams.field){newPill.consolidationValue=pillsInThisInterval.reduce(function(sum,pill){if(!pill[self.consolidationParams.excludeField]){return sum+pill[self.consolidationParams.field];}
return sum;},0);newPill.consolidationMaxValue=self.consolidationParams.maxValue;newPill.consolidationExceeded=newPill.consolidationValue>newPill.consolidationMaxValue;}
pills.push(newPill);}}
return pills;},[]);var maxCount=_.max(this.pills,function(pill){return pill.count;}).count;var minColor=215;var maxColor=100;this.pills.forEach(function(pill){pill.consolidated=true;if(self.consolidate&&self.consolidationParams.maxValue){pill.status=pill.consolidationExceeded?'danger':'success';pill.display_name=pill.consolidationValue;}else{var color=minColor-((pill.count-1)/maxCount)*(minColor-maxColor);pill.style=_.str.sprintf("background-color: rgba(%s, %s, %s, 0.6)",color,color,color);pill.display_name=pill.count;}});},_calculateMarginAndWidth:function(){var self=this;var left;var diff;this.pills.forEach(function(pill){let widthPill;let margin;switch(self.state.scale){case'day':left=pill.startDate.diff(pill.startDate.clone().startOf('hour'),'minutes');pill.leftMargin=(left/60)*100;diff=pill.stopDate.diff(pill.startDate,'minutes');var gapSize=pill.stopDate.diff(pill.startDate,'hours')-1;widthPill=(diff/60)*100;margin=pill.aggregatedPills?0:4;pill.width=gapSize>0?`calc(${widthPill}% + ${gapSize}px - ${margin}px)`:`calc(${widthPill}% - ${margin}px)`;break;case'week':case'month':left=pill.startDate.diff(pill.startDate.clone().startOf('day'),'hours');pill.leftMargin=(left/24)*100;diff=pill.stopDate.diff(pill.startDate,'hours');var gapSize=pill.stopDate.diff(pill.startDate,'days')-1;widthPill=(diff/24)*100;margin=pill.aggregatedPills?0:4;pill.width=gapSize>0?`calc(${widthPill}% + ${gapSize}px - ${margin}px)`:`calc(${widthPill}% - ${margin}px)`;break;case'year':var startDateMonthStart=pill.startDate.clone().startOf('month');var stopDateMonthEnd=pill.stopDate.clone().endOf('month');left=pill.startDate.diff(startDateMonthStart,'days');pill.leftMargin=(left/30)*100;var monthsDiff=stopDateMonthEnd.diff(startDateMonthStart,'months',true);margin=pill.aggregatedPills?0:4;if(monthsDiff<1){diff=Math.max(Math.ceil(pill.stopDate.diff(pill.startDate,'days',true)),2);pill.width=`calc(${(diff / pill.startDate.daysInMonth()) * 100}% - ${margin}px)`;}else{var startDateMonthEnd=pill.startDate.clone().endOf('month');var diffMonthStart=Math.ceil(startDateMonthEnd.diff(pill.startDate,'days',true));var widthMonthStart=(diffMonthStart/pill.startDate.daysInMonth());var stopDateMonthStart=pill.stopDate.clone().startOf('month');var diffMonthStop=Math.ceil(pill.stopDate.diff(stopDateMonthStart,'days',true));var widthMonthStop=(diffMonthStop/pill.stopDate.daysInMonth());var width=Math.max((widthMonthStart+widthMonthStop),(2/30))*100;if(monthsDiff>2){width+=(monthsDiff-2)*100;}
pill.width=`calc(${width}% - ${margin}px)`;}
break;default:break;}
pill.topPadding=pill.level*(self.LEVEL_TOP_OFFSET+4)+2;});},_convertToUserTime:function(date){return date.clone().local();},_evaluateDecoration:function(){var self=this;this.pills.forEach(function(pill){var pillDecorations=[];_.each(self.viewInfo.pillDecorations,function(expr,decoration){if(py.PY_isTrue(py.evaluate(expr,self._getDecorationEvalContext(pill)))){pillDecorations.push(decoration);}});pill.decorations=pillDecorations;if(self.colorField){pill._color=self._getColor(pill[self.colorField]);}
if(self.progressField){pill._progress=pill[self.progressField]||0;}});},_getColor:function(value){if(_.isNumber(value)){return Math.round(value)%this.NB_GANTT_RECORD_COLORS;}else if(_.isArray(value)){return value[0]%this.NB_GANTT_RECORD_COLORS;}
return 0;},_getDecorationEvalContext:function(pillData){return Object.assign({},this._getPyUtilsContext(),session.user_context,this._getPillEvalContext(pillData),);},_getDiff:function(resizeSnappingWidth,gridOffset){return Math.round(gridOffset/resizeSnappingWidth)*this.viewInfo.activeScaleInfo.interval;},_getPillEvalContext:function(pillData){var pillContext=_.clone(pillData);for(var fieldName in pillContext){const field=this.fieldsInfo[fieldName];if(field){const pillCurrentField=pillContext[fieldName];if(pillCurrentField instanceof moment){pillContext[fieldName]=pillCurrentField._i;}
else if(field.type==='date'||field.type==='datetime'){if(pillCurrentField){pillContext[fieldName]=JSON.parse(JSON.stringify(pillCurrentField));}
continue;}}}
return pillContext;},_getPopoverContext:function(pillID){var data=_.clone(_.findWhere(this.pills,{id:pillID}));data.userTimezoneStartDate=this._convertToUserTime(data[this.state.dateStartField]);data.userTimezoneStopDate=this._convertToUserTime(data[this.state.dateStopField]);return data;},_getPyUtilsContext(){if(!pyUtilsContext){pyUtilsContext=pyUtils.context();Promise.resolve().then(()=>{pyUtilsContext=null;});}
return pyUtilsContext;},_getResizeSnappingWidth:function(firstCell){if(!this.firstCell){this.firstCell=firstCell||$('.o_gantt_view .o_gantt_header_scale .o_gantt_header_cell:first')[0];}
return this.firstCell.getBoundingClientRect().width/this.cellPart;},_insertIntoSlot:function(){var slotsToFill=this.slots;this.pills.forEach(function(currentPill){var skippedSlots=[];slotsToFill.some(function(currentSlot){var fitsInThisSlot=currentPill.startDate<currentSlot.stop;if(fitsInThisSlot){currentSlot.pills.push(currentPill);}else{skippedSlots.push(currentSlot);}
return fitsInThisSlot;});slotsToFill=_.difference(slotsToFill,skippedSlots);});},_prepareSlots:function(){const{interval,time,cellPrecisions}=this.SCALES[this.state.scale];const precision=this.viewInfo.activeScaleInfo.precision;const cellTime=cellPrecisions[precision];function getSlotStyle(cellPart,subSlotUnavailabilities,isToday){function color(d){if(isToday){return d?'#e9ecef':'#fffaeb';}
return d?'#e9ecef':'#ffffff';}
const sum=subSlotUnavailabilities.reduce((acc,d)=>acc+d);if(!sum){return'';}
if(cellPart===sum){return`background: ${color(1)}`;}
if(cellPart===2){const[c0,c1]=subSlotUnavailabilities.map(color);return`background: linear-gradient(90deg, ${c0} 49%, ${c1} 50%);`}
if(cellPart===4){const[c0,c1,c2,c3]=subSlotUnavailabilities.map(color);return`background: linear-gradient(90deg, ${c0} 24%, ${c1} 25%, ${c1} 49%, ${c2} 50%, ${c2} 74%, ${c3} 75%);`}}
this.slots=[];let index=0;for(const date of this.viewInfo.slots){const slotStart=date;const slotStop=date.clone().add(1,interval);const isToday=date.isSame(new Date(),'day')&&this.state.scale!=='day';let slotStyle='';if(!this.isGroup&&this.unavailabilities.slice(index).length){let subSlotUnavailabilities=[];for(let j=0;j<this.cellPart;j++){const subSlotStart=date.clone().add(j*cellTime,time);const subSlotStop=date.clone().add((j+1)*cellTime,time).subtract(1,'seconds');let subSlotUnavailable=0;for(let i=index;i<this.unavailabilities.length;i++){let u=this.unavailabilities[i];if(subSlotStop>u.stopDate){index++;}else if(u.startDate<=subSlotStart){subSlotUnavailable=1;break;}}
subSlotUnavailabilities.push(subSlotUnavailable);}
slotStyle=getSlotStyle(this.cellPart,subSlotUnavailabilities,isToday);}
this.slots.push({isToday:isToday,style:slotStyle,hasButtons:!this.isGroup&&!this.isTotal,start:slotStart,stop:slotStop,pills:[],});}},_saveDragChanges:function(pillId,diff,oldRowId,newRowId,action){this.trigger_up('pill_dropped',{pillId:pillId,diff:diff,oldRowId:oldRowId,newRowId:newRowId,groupLevel:this.groupLevel,action:action,});},_saveResizeChanges:function(pillID,resizeDiff,direction){var pill=_.findWhere(this.pills,{id:pillID});var data={id:pillID};if(direction==='left'){data.field=this.state.dateStartField;data.date=pill[this.state.dateStartField].clone().subtract(resizeDiff,this.viewInfo.activeScaleInfo.time);}else{data.field=this.state.dateStopField;data.date=pill[this.state.dateStopField].clone().add(resizeDiff,this.viewInfo.activeScaleInfo.time);}
this.trigger_up('pill_resized',data);},_setDraggable:function($pill){if($pill.hasClass('ui-draggable-dragging')){return;}
var self=this;var pill=_.findWhere(this.pills,{id:$pill.data('id')});if(this.options.canEdit&&!pill.disableStartResize&&!pill.disableStopResize&&!this.isGroup){const resizeSnappingWidth=this._getResizeSnappingWidth();if($pill.draggable("instance")){return;}
if(!this.$containment){this.$containment=$('#o_gantt_containment');}
$pill.draggable({containment:this.$containment,start:function(event,ui){self.trigger_up('updating_pill_started');const pillWidth=$pill[0].getBoundingClientRect().width;ui.helper.css({width:pillWidth});ui.helper.removeClass('position-relative');self.trigger_up('start_dragging',{$draggedPill:$pill,$draggedPillClone:ui.helper,});self.$el.addClass('o_gantt_dragging');$pill.popover('hide');self.$('.o_gantt_pill').popover('disable');},drag:function(event,ui){if($(event.target).hasClass('o_gantt_pill_editing')){return false;}
var diff=self._getDiff(resizeSnappingWidth,ui.position.left);self._updateResizeBadge(ui.helper,diff,ui);const pointObject={x:event.pageX,y:event.pageY};const options={container:document.body};const $el=$.nearest(pointObject,'.o_gantt_hoverable',options).first();if($el.length){$('.o_gantt_hoverable').removeClass('ui-drag-hover');$el.addClass('ui-drag-hover');}},stop:function(){self.trigger_up('updating_pill_stopped');self.trigger_up('stop_dragging');self.$('.ui-drag-hover').removeClass('ui-drag-hover');self.$el.removeClass('o_gantt_dragging');self.$('.o_gantt_pill').popover('enable').popover('dispose');},helper:'clone',});}else{if($pill.draggable("instance")){return;}
if(!this.$lockIndicator){this.$lockIndicator=$('<div class="fa fa-lock"/>').css({'z-index':20,position:'absolute',top:'4px',right:'4px',});}
$pill.draggable({grid:[0,0],start:function(){self.trigger_up('updating_pill_started');self.trigger_up('start_no_dragging');$pill.popover('hide');self.$('.o_gantt_pill').popover('disable');self.$lockIndicator.appendTo($pill);},drag:function(ev){if($(ev.target).hasClass('o_gantt_pill_editing')){return false;}},stop:function(){self.trigger_up('updating_pill_stopped');self.trigger_up('stop_no_dragging');self.$('.o_gantt_pill').popover('enable').popover('dispose');self.$lockIndicator.detach();},});$pill.addClass('o_fake_draggable');}},_setResizable:function($pill){if($pill.hasClass('ui-resizable')){return;}
var self=this;var pillHeight=this.$('.o_gantt_pill:first').height();var pill=_.findWhere(self.pills,{id:$pill.data('id')});const resizeSnappingWidth=this._getResizeSnappingWidth();var handles=[];if(!pill.disableStartResize){handles.push('w');}
if(!pill.disableStopResize){handles.push('e');}
if(handles.length&&!self.options.disableResize&&!self.isGroup&&self.options.canEdit){$pill.resizable({handles:handles.join(', '),odoo_isRTL:this.isRTL,grid:[resizeSnappingWidth,pillHeight],start:function(){$pill.popover('hide');self.$('.o_gantt_pill').popover('disable');self.trigger_up('updating_pill_started');self.$el.addClass('o_gantt_dragging');},resize:function(event,ui){var diff=Math.round((ui.size.width-ui.originalSize.width)/resizeSnappingWidth*self.viewInfo.activeScaleInfo.interval);self._updateResizeBadge($pill,diff,ui);},stop:function(event,ui){setTimeout(()=>{self.trigger_up('updating_pill_stopped');self.$el.removeClass('o_gantt_dragging');self.$('.o_gantt_pill').popover('enable').popover('dispose');});var diff=Math.round((ui.size.width-ui.originalSize.width)/resizeSnappingWidth*self.viewInfo.activeScaleInfo.interval);var direction=ui.position.left?'left':'right';if(diff){self._saveResizeChanges(pill.id,diff,direction);}},});}},_snapToGrid:function(timeSpans){var self=this;var interval=this.viewInfo.activeScaleInfo.interval;switch(this.state.scale){case'day':timeSpans.forEach(function(span){var snappedStartDate=self._snapMinutes(span.startDate,interval);var snappedStopDate=self._snapMinutes(span.stopDate,interval);var minuteDiff=snappedStartDate.diff(snappedStopDate,'minute');if(minuteDiff===0){if(snappedStartDate>span.startDate){span.startDate=snappedStartDate.subtract(interval,'minute');span.stopDate=snappedStopDate;}else{span.startDate=snappedStartDate;span.stopDate=snappedStopDate.add(interval,'minute');}}else{span.startDate=snappedStartDate;span.stopDate=snappedStopDate;}});break;case'week':case'month':timeSpans.forEach(function(span){var snappedStartDate=self._snapHours(span.startDate,interval);var snappedStopDate=self._snapHours(span.stopDate,interval);var hourDiff=snappedStartDate.diff(snappedStopDate,'hour');if(hourDiff===0){if(snappedStartDate.diff(span.startDate,'hours')>2&&span.stopDate.diff(snappedStopDate,'hours')>2){span.startDate=snappedStartDate.subtract(interval,'hour');span.stopDate=snappedStopDate.add(interval,'hour');}else if(snappedStartDate>span.startDate){span.startDate=snappedStartDate.subtract(interval,'hour');span.stopDate=snappedStopDate;}else{span.startDate=snappedStartDate;span.stopDate=snappedStopDate.add(interval,'hour');}}else{if(snappedStartDate.diff(span.startDate,'hours')>2){snappedStartDate=snappedStartDate.subtract(interval,'hour');}
if(span.stopDate.diff(snappedStopDate,'hours')>2){snappedStopDate=snappedStopDate.add(interval,'hour');}
span.startDate=snappedStartDate;span.stopDate=snappedStopDate;}});break;case'year':timeSpans.forEach(function(span){span.startDate=span.startDate.clone().startOf('month');span.stopDate=span.stopDate.clone().endOf('month');});break;default:break;}},_snapHours:function(date,interval){var snappedHours=Math.round(date.clone().hour()/interval)*interval;return date.clone().hour(snappedHours).minute(0).second(0);},_snapMinutes:function(date,interval){var snappedMinutes=Math.round(date.clone().minute()/interval)*interval;return date.clone().minute(snappedMinutes).second(0);},_updateResizeBadge:function($pill,diff,ui){$pill.find('.o_gantt_pill_resize_badge').remove();if(diff){var direction=ui.position.left?'left':'right';$(QWeb.render('GanttView.ResizeBadge',{diff:diff,direction:direction,time:this.viewInfo.activeScaleInfo.time,}),{css:{'z-index':2}}).appendTo($pill);}},_onButtonAddClicked:function(ev){var date=moment($(ev.currentTarget).closest('.o_gantt_cell').data('date'));this.trigger_up('add_button_clicked',{date:date,rowId:this.rowId,});},_onButtonPlanClicked:function(ev){var date=moment($(ev.currentTarget).closest('.o_gantt_cell').data('date'));this.trigger_up('plan_button_clicked',{date:date,rowId:this.rowId,});},_onMouseMove:function(ev){if((this.options.canCreate||this.options.canEdit)&&!this.$el[0].classList.contains('o_gantt_dragging')){var elementsFromPoint=function(x,y){if(document.elementsFromPoint)
return document.elementsFromPoint(x,y);if(document.msElementsFromPoint){return Array.prototype.slice.call(document.msElementsFromPoint(x,y));}};var hoveredCell;if(ev.target.classList.contains('o_gantt_pill')||ev.target.parentNode.classList.contains('o_gantt_pill')){elementsFromPoint(ev.pageX,ev.pageY).some(function(element){return element.classList.contains('o_gantt_cell')?((hoveredCell=element),true):false;});}else{hoveredCell=ev.currentTarget;}
if(hoveredCell&&hoveredCell!=this.lastHoveredCell){if(this.lastHoveredCell){this.lastHoveredCell.classList.remove('o_hovered');}
hoveredCell.classList.add('o_hovered');this.lastHoveredCell=hoveredCell;}}},_onMouseLeave:function(){this.$(".o_gantt_cell.o_hovered").removeClass('o_hovered');this.lastHoveredCell=undefined;},_onPillClicked:function(ev){if(!this.isGroup){this.trigger_up('pill_clicked',{target:$(ev.currentTarget),});}},_onPillEntered:function(ev){var $pill=$(ev.currentTarget);this._setResizable($pill);if(!this.isTotal&&!this.options.disableDragdrop){this._setDraggable($pill);}
if(!this.isGroup&&!config.device.isMobile){this._bindPillPopover(ev.target);}},_onRowSidebarClicked:function(){if(this.isGroup&!this.isTotal){if(this.isOpen){this.trigger_up('collapse_row',{rowId:this.rowId});}else{this.trigger_up('expand_row',{rowId:this.rowId});}}},});return GanttRow;});;

/* /web_gantt/static/src/js/gantt_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_gantt.GanttView',function(require){"use strict";var AbstractView=require('web.AbstractView');var core=require('web.core');var GanttModel=require('web_gantt.GanttModel');var GanttRenderer=require('web_gantt.GanttRenderer');var GanttController=require('web_gantt.GanttController');var pyUtils=require('web.py_utils');var view_registry=require('web.view_registry');var _t=core._t;var _lt=core._lt;var GanttView=AbstractView.extend({display_name:_lt('Gantt'),icon:'fa-tasks',config:_.extend({},AbstractView.prototype.config,{Model:GanttModel,Controller:GanttController,Renderer:GanttRenderer,}),jsLibs:['/web/static/lib/nearest/jquery.nearest.js',],viewType:'gantt',init:function(viewInfo,params){this._super.apply(this,arguments);const{domain}=params.action||{};this.controllerParams.actionDomain=domain||[];this.SCALES={day:{string:_t('Day'),cellPrecisions:{full:60,half:30,quarter:15},defaultPrecision:'full',time:'minutes',interval:'hour'},week:{string:_t('Week'),cellPrecisions:{full:24,half:12},defaultPrecision:'half',time:'hours',interval:'day'},month:{string:_t('Month'),cellPrecisions:{full:24,half:12},defaultPrecision:'half',time:'hours',interval:'day'},year:{string:_t('Year'),cellPrecisions:{full:1},defaultPrecision:'full',time:'months',interval:'month'},};var arch=this.arch;var decorationFields=[];_.each(arch.children,function(child){if(child.tag==='field'){decorationFields.push(child.attrs.name);}});var collapseFirstLevel=!!arch.attrs.collapse_first_level;var displayUnavailability=!!arch.attrs.display_unavailability;var colorField=arch.attrs.color;var precisionAttrs=arch.attrs.precision?pyUtils.py_eval(arch.attrs.precision):{};var cellPrecisions={};_.each(this.SCALES,function(vals,key){if(precisionAttrs[key]){var precision=precisionAttrs[key].split(':');if(precision[1]&&_.contains(_.keys(vals.cellPrecisions),precision[1])){cellPrecisions[key]=precision[1];}}
cellPrecisions[key]=cellPrecisions[key]||vals.defaultPrecision;});var consolidationMaxField;var consolidationMaxValue;var consolidationMax=arch.attrs.consolidation_max?pyUtils.py_eval(arch.attrs.consolidation_max):{};if(Object.keys(consolidationMax).length>0){consolidationMaxField=Object.keys(consolidationMax)[0];consolidationMaxValue=consolidationMax[consolidationMaxField];collapseFirstLevel=!!consolidationMaxField||collapseFirstLevel;}
var consolidationParams={field:arch.attrs.consolidation,maxField:consolidationMaxField,maxValue:consolidationMaxValue,excludeField:arch.attrs.consolidation_exclude,};var formViewId=arch.attrs.form_view_id?parseInt(arch.attrs.form_view_id,10):false;if(params.action&&!formViewId){var result=_.findWhere(params.action.views,{type:'form'});formViewId=result?result.viewID:false;}
var dialogViews=[[formViewId,'form']];var allowedScales;if(arch.attrs.scales){var possibleScales=Object.keys(this.SCALES);allowedScales=_.reduce(arch.attrs.scales.split(','),function(allowedScales,scale){if(possibleScales.indexOf(scale)>=0){allowedScales.push(scale.trim());}
return allowedScales;},[]);}else{allowedScales=Object.keys(this.SCALES);}
var scale=params.context.default_scale||arch.attrs.default_scale||'month';var initialDate=moment(params.context.initialDate||params.initialDate||arch.attrs.initial_date||new Date());var offset=arch.attrs.offset;if(offset&&scale){initialDate.add(offset,scale);}
var thumbnails=this.arch.attrs.thumbnails?pyUtils.py_eval(this.arch.attrs.thumbnails):{};var canPlan=this.arch.attrs.plan?!!JSON.parse(this.arch.attrs.plan):true;const canCellCreate=this.arch.attrs.cell_create?!!JSON.parse(this.arch.attrs.cell_create):true;this.controllerParams.context=params.context||{};this.controllerParams.dialogViews=dialogViews;this.controllerParams.SCALES=this.SCALES;this.controllerParams.allowedScales=allowedScales;this.controllerParams.collapseFirstLevel=collapseFirstLevel;this.controllerParams.createAction=arch.attrs.on_create||null;this.loadParams.initialDate=initialDate;this.loadParams.collapseFirstLevel=collapseFirstLevel;this.loadParams.colorField=colorField;this.loadParams.dateStartField=arch.attrs.date_start;this.loadParams.dateStopField=arch.attrs.date_stop;this.loadParams.progressField=arch.attrs.progress;this.loadParams.decorationFields=decorationFields;this.loadParams.defaultGroupBy=this.arch.attrs.default_group_by;this.loadParams.dynamicRange=this.arch.attrs.dynamic_range;this.loadParams.displayUnavailability=displayUnavailability;this.loadParams.fields=this.fields;this.loadParams.scale=scale;this.loadParams.SCALES=this.SCALES;this.loadParams.consolidationParams=consolidationParams;this.rendererParams.canCreate=this.controllerParams.activeActions.create;this.rendererParams.canCellCreate=canCellCreate;this.rendererParams.canEdit=this.controllerParams.activeActions.edit;this.rendererParams.canPlan=canPlan&&this.rendererParams.canEdit;this.rendererParams.fieldsInfo=viewInfo.fields;this.rendererParams.SCALES=this.SCALES;this.rendererParams.cellPrecisions=cellPrecisions;this.rendererParams.totalRow=arch.attrs.total_row||false;this.rendererParams.string=arch.attrs.string||_t('Gantt View');this.rendererParams.popoverTemplate=_.findWhere(arch.children,{tag:'templates'});this.rendererParams.colorField=colorField;this.rendererParams.disableDragdrop=arch.attrs.disable_drag_drop?!!JSON.parse(arch.attrs.disable_drag_drop):false;this.rendererParams.progressField=arch.attrs.progress;this.rendererParams.displayUnavailability=displayUnavailability;this.rendererParams.collapseFirstLevel=collapseFirstLevel;this.rendererParams.consolidationParams=consolidationParams;this.rendererParams.thumbnails=thumbnails;},});view_registry.add('gantt',GanttView);return GanttView;});;

/* /web_grid/static/src/js/grid_component_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web_grid.component_registry',function(require){"use strict";const Registry=require('web.Registry');return new Registry();});odoo.define('web_grid._component_registry',function(require){"use strict";const components=require('web_grid.components');const registry=require('web_grid.component_registry');registry.add('float_factor',components.FloatFactorComponent).add('float_time',components.FloatTimeComponent).add('float_toggle',components.FloatToggleComponent);});;

/* /web_grid/static/src/js/grid_components.js defined in bundle 'web.assets_backend' */
odoo.define('web_grid.components',function(require){"use strict";const fieldUtils=require('web.field_utils');const utils=require('web.utils');const{useRef,useState}=owl.hooks;const{debounce}=owl.utils;class BaseGridComponent extends owl.Component{constructor(){super(...arguments);this.currentInput=useRef("currentInput");this.state=useState({error:false,});}
willUpdateProps(nextProps){if(nextProps.date!==this.props.date){this.state.error=false;}}
patched(){if(this.currentInput.el){this.currentInput.el.select();}}
get fieldOptions(){return this.props.nodeOptions;}
get formatType(){return this.constructor.formatType||this.props.fieldInfo.type;}
_format(value){return fieldUtils.format[this.formatType](value,{},this.fieldOptions);}
_parse(value){return fieldUtils.parse[this.formatType](value,{},this.fieldOptions);}
_onBlurCell(ev){let value;try{value=this._parse(ev.target.value);this.state.error=false;}catch(_){this.state.error=ev.target.value;}finally{this.trigger('grid-cell-update',{path:this.props.path,value});}}
_onFocusCell(){this.trigger('grid-cell-focus',{path:this.props.path});}}
BaseGridComponent.defaultProps={cellHeight:0,cellValue:0,hasBarChartTotal:false,readonly:false,isTotal:false,nodeOptions:{}};BaseGridComponent.props={cellHeight:{type:Number,optional:true},cellValue:{type:Number,optional:true},fieldInfo:Object,hasBarChartTotal:Boolean,isInput:Boolean,nodeOptions:Object,path:{type:String,optional:true},readonly:Boolean,isTotal:{type:Boolean,optional:true},date:{type:String,optional:true},};BaseGridComponent.template='web_grid.BaseGridComponent';BaseGridComponent.formatType='float_factor';class FloatFactorComponent extends BaseGridComponent{}
class FloatTimeComponent extends BaseGridComponent{get fieldOptions(){return Object.assign({},super.fieldOptions,{noLeadingZeroHour:true,});}}
FloatTimeComponent.formatType='float_time';class FloatToggleComponent extends BaseGridComponent{constructor(){super(...arguments);this.state=useState({disabled:false,value:this.initialValue,});this._onClickButton=debounce(this._onClickButton,200,true);}
willUpdateProps(nextProps){if(nextProps.cellValue!==this.initialValue){this.state.value=nextProps.cellValue;}}
get fieldOptions(){const fieldOptions=Object.assign({},this.props.nodeOptions);if(!fieldOptions.factor){fieldOptions.factor=1;}
const range=[0.0,0.5,1.0];if(!fieldOptions.range){fieldOptions.range=range;}
return fieldOptions;}
get initialValue(){return this.props.cellValue;}
_onClickButton(){const range=this.fieldOptions.range;const currentFloat=fieldUtils.parse.float(this._format(this.state.value));const closest=utils.closestNumber(currentFloat,range);const closestIndex=range.indexOf(closest);const nextIndex=closestIndex+1<range.length?closestIndex+1:0;this.state.value=this._parse(fieldUtils.format.float(range[nextIndex]));this.state.disabled=true;this.trigger('grid-cell-update',{path:this.props.path,value:this.state.value,doneCallback:()=>{this.state.disabled=false;}});}}
FloatToggleComponent.template='web_grid.FloatToggleComponent';return{BaseGridComponent,FloatFactorComponent,FloatTimeComponent,FloatToggleComponent,};});;

/* /web_grid/static/src/js/grid_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_grid.GridController',function(require){"use strict";var AbstractController=require('web.AbstractController');var config=require('web.config');var core=require('web.core');var dialogs=require('web.view_dialogs');var utils=require('web.utils');var concurrency=require('web.concurrency');var qweb=core.qweb;var _t=core._t;var GridController=AbstractController.extend({custom_events:Object.assign({},AbstractController.prototype.custom_events,{'create_inline':'_addLine','cell_edited':'_onCellEdited','open_cell_information':'_onOpenCellInformation',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.context=params.context;this.navigationButtons=params.navigationButtons;this.ranges=params.ranges;this.currentRange=params.currentRange;this.formViewID=params.formViewID;this.listViewID=params.listViewID;this.adjustment=params.adjustment;this.adjustName=params.adjustName;this.canCreate=params.activeActions.create;this.createInline=params.createInline;this.displayEmpty=params.displayEmpty;this.mutex=new concurrency.Mutex();},renderButtons:function($node){this.$buttons=$(qweb.render('grid.GridArrows',{widget:{_ranges:this.ranges,_buttons:this.navigationButtons,allowCreate:this.canCreate,},isMobile:config.device.isMobile}));this.$buttons.on('click','.o_grid_button_add',this._onAddLine.bind(this));this.$buttons.on('click','.grid_arrow_previous',this._onPaginationChange.bind(this,'prev'));this.$buttons.on('click','.grid_button_initial',this._onPaginationChange.bind(this,'initial'));this.$buttons.on('click','.grid_arrow_next',this._onPaginationChange.bind(this,'next'));this.$buttons.on('click','.grid_arrow_range',this._onRangeChange.bind(this));this.$buttons.on('click','.grid_arrow_button',this._onButtonClicked.bind(this));this.updateButtons();if($node){this.$buttons.appendTo($node);}},updateButtons:function(){if(!this.$buttons){return;}
const state=this.model.get();this.$buttons.find('.o_grid_button_add').toggleClass('d-none',this.createInline&&(!!state.data[0].rows.length||this.displayEmpty));this.$buttons.find('.grid_arrow_previous').toggleClass('d-none',!state.data[0].prev);this.$buttons.find('.grid_arrow_next').toggleClass('d-none',!state.data[0].next);this.$buttons.find('.grid_button_initial').toggleClass('d-none',!state.data[0].initial);this.$buttons.find('.grid_arrow_range').removeClass('active');this.$buttons.find('.grid_arrow_range[data-name='+this.currentRange+']').addClass('active');},_addLine:function(){var context=this.model.getContext();var formContext=_.extend({},context,{view_grid_add_line:true});var formViewID=context.quick_create_view||this.formViewID||false;new dialogs.FormViewDialog(this,{res_model:this.modelName,res_id:false,context:formContext,view_id:formViewID,title:_t("Add a Line"),disable_multiple_selection:true,on_saved:this.reload.bind(this,{}),}).open();},_adjust:function(cell,newValue){var difference=newValue-cell.value;if(Math.abs(difference)<1e-6){return Promise.resolve();}
var state=this.model.get();var domain=this.model.domain.concat(cell.row.domain);utils.into(state.data,cell.cell_path).value=newValue;var self=this;return this.mutex.exec(function(){if(self.adjustment==='action'){const actionData={type:self.adjustment,name:self.adjustName,context:self.model.getContext({grid_adjust:{row_domain:domain,column_field:state.colField,column_value:cell.col.values[state.colField][0],cell_field:state.cellField,change:difference,},}),};return self.trigger_up('execute_action',{action_data:actionData,env:{context:self.model.getContext(),model:self.modelName},on_success:async function(){let state=self.model.get();await self.model.reloadCell(cell,state.cellField,state.colField);state=self.model.get();await self.renderer.update(state);self.updateButtons(state);},});}
return self._rpc({model:self.modelName,method:self.adjustName,args:[[],domain,state.colField,cell.col.values[state.colField][0],state.cellField,difference],context:self.model.getContext()}).then(function(){return self.model.reloadCell(cell,state.cellField,state.colField);}).then(function(){var state=self.model.get();return self.renderer.update(state);}).then(function(){self.updateButtons(state);});});},_update:function(){return this._super.apply(this,arguments).then(this.updateButtons.bind(this));},_onAddLine:function(event){event.preventDefault();this._addLine();},_cellHasBeenUpdated(ev){},_onCellEdited:function(event){var state=this.model.get();this._adjust({row:utils.into(state.data,event.data.row_path),col:utils.into(state.data,event.data.col_path),value:utils.into(state.data,event.data.cell_path).value,cell_path:event.data.cell_path,},event.data.value).then(()=>{if(event.data.doneCallback!==undefined){event.data.doneCallback();}
this._cellHasBeenUpdated(event);}).guardedCatch(function(){if(event.data.doneCallback!==undefined){event.data.doneCallback();}});},_onButtonClicked:function(e){var self=this;e.stopPropagation();var button=this.navigationButtons[$(e.target).attr('data-index')];var actionData=_.extend({},button,{context:this.model.getContext(button.context),});this.model.getIds().then(function(ids){self.trigger_up('execute_action',{action_data:actionData,env:{context:self.model.getContext(),model:self.modelName,resIDs:ids,},on_closed:self.reload.bind(self,{}),});});},_onOpenCellInformation:function(ev){var self=this;var cell_path=ev.data.path.split('.');var row_path=cell_path.slice(0,-3).concat(['rows'],cell_path.slice(-2,-1));var state=this.model.get();var cell=utils.into(state.data,cell_path);var row=utils.into(state.data,row_path);var groupFields=state.groupBy.slice(state.isGrouped?1:0);var label=_.filter(_.map(groupFields,function(g){return row.values[g][1];}),function(g){return g;}).join(' - ');var cols_path=cell_path.slice(0,-3).concat(['cols'],cell_path.slice(-1));var col=utils.into(state.data,cols_path);var column_value=col.values[state.colField][0];if(!column_value){column_value=false;}else if(!_.isNumber(column_value)){column_value=column_value.split("/")[0];}
var ctx=_.extend({},this.context);var sectionField=_.find(this.renderer.fields,function(res){return self.model.sectionField===res.name;});if(this.model.sectionField&&state.groupBy&&state.groupBy[0]===this.model.sectionField){var value=state.data[parseInt(cols_path[0])].__label;ctx['default_'+this.model.sectionField]=_.isArray(value)?value[0]:value;}
_.each(groupFields,function(field){ctx['default_'+field]=row.values[field][0]||false;});ctx['default_'+state.colField]=column_value;ctx['create']=this.canCreate&&!cell.readonly;ctx['edit']=this.activeActions.edit&&!cell.readonly;this.do_action({type:'ir.actions.act_window',name:label,res_model:this.modelName,views:[[this.listViewID,'list'],[this.formViewID,'form']],domain:cell.domain,context:ctx,help:"<p class='o_view_nocontent_smiling_face'>No activities found</p>",});},_onPaginationChange:function(dir){var state=this.model.get();this.update({pagination:state.data[0][dir]});},_onRangeChange:function(e){e.stopPropagation();var $target=$(e.target);if(config.device.isMobile){$target.closest(".dropdown-menu").prev().dropdown("toggle");}
if($target.hasClass('active')){return;}
this.currentRange=$target.attr('data-name');this.update({range:this.currentRange});},});return GridController;});;

/* /web_grid/static/src/js/grid_model.js defined in bundle 'web.assets_backend' */
odoo.define('web_grid.GridModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var utils=require('web.utils');const{_t}=require('web.core');const GridModel=AbstractModel.extend({init:function(){this._super.apply(this,arguments);this._gridData=null;this.dp=new concurrency.DropPrevious();},computeAllTotals:function(state){state.data.forEach((group,groupIndex)=>{state.data[groupIndex].totals=this._computeTotals(group.grid);});state.totals=this._computeTotals(_.flatten(_.pluck(state.data,'grid'),true));return state;},__get:function(){return this._gridData;},getContext:function(context){var c=_.extend({},this.context,context);return c;},getIds:function(){var data=this._gridData.data;if(!_.isArray(data)){data=[data];}
var domain=[];var cells=0;for(var i=0;i<data.length;i++){var grid=data[i].grid;for(var j=0;j<grid.length;j++){var row=grid[j];for(var k=0;k<row.length;k++){var cell=row[k];if(cell.size!==0){cells++;domain.push.apply(domain,cell.domain);}}}}
if(cells===0){return Promise.resolve([]);}
while(--cells>0){domain.unshift('|');}
return this._rpc({model:this.modelName,method:'search',args:[domain],context:this.getContext(),});},__load:function(params){this.fields=params.fields;this.modelName=params.modelName;this.rowFields=params.rowFields;this.sectionField=params.sectionField;this.colField=params.colField;this.cellField=params.cellField;this.ranges=params.ranges;this.currentRange=params.currentRange;this.domain=params.domain;this.context=params.context;var groupedBy=(params.groupedBy&&params.groupedBy.length)?params.groupedBy:this.rowFields;this.groupedBy=Array.isArray(groupedBy)?groupedBy:[groupedBy];this.readonlyField=params.readonlyField;return this._fetch(this.groupedBy);},__reload:function(handle,params){if(params==='special'){return Promise.resolve();}
params=params||{};if('context'in params){var old_context=this.context;this.context=params.context;if(old_context.grid_anchor!==undefined||params.context.grid_anchor!==undefined){this.context.grid_anchor=old_context.grid_anchor||params.context.grid_anchor;}}
if('domain'in params){this.domain=params.domain;}
if('pagination'in params){_.extend(this.context,params.pagination);}
if('range'in params){this.currentRange=_.findWhere(this.ranges,{name:params.range});}
if('groupBy'in params){if(params.groupBy.length){this.groupedBy=Array.isArray(params.groupBy)?params.groupBy:[params.groupBy];}else{this.groupedBy=this.rowFields;}}
return this._fetch(this.groupedBy);},reloadCell:function(cell,cellField,colField){var self=this;var domain=cell.col.domain.concat(this.domain);var domainRow=cell.row.values;for(var value in domainRow){domain=domain.concat([[value.toString(),'=',domainRow[value][0]]]);}
if(this._gridData.isGrouped){var groupLabel=this._gridData.data[cell.cell_path[0]].__label;if(groupLabel!==undefined)
domain=domain.concat([[this._gridData.groupBy[0],'=',groupLabel[0]]]);else{return self._fetch(self._gridData.groupBy);}}
return this._rpc({model:this.modelName,method:'read_group',kwargs:{domain:domain,fields:[cellField],groupby:[colField],},context:this.getContext()}).then(function(result){if(result.length===0||!(cellField in result[0])){return Promise.resolve();}
var currentCell=utils.into(self._gridData.data,cell.cell_path);currentCell.value=result[0][cellField];currentCell.size=result[0][colField+'_count'];currentCell.domain=domain;self._gridData=self.computeAllTotals(self._gridData);});},_computeTotals:function(grid){const totals={super:0,rows:{},columns:{}};for(let i=0;i<grid.length;i++){const row=grid[i];for(let j=0;j<row.length;j++){const cell=row[j];totals.super+=cell.value;totals.rows[i]=(totals.rows[i]||0)+cell.value;totals.columns[j]=(totals.columns[j]||0)+cell.value;}}
return totals;},_getRowInfo(row,grouped){let groupBy=this.groupedBy;if(grouped){groupBy=groupBy.slice(1);}
const rowValues=[];const rowIds=[];for(let i=0;i<groupBy.length;i++){const rowField=groupBy[i];let value=row.values[rowField];const fieldName=rowField.split(':')[0];const fieldType=this.fields[fieldName].type;if(fieldType==='selection'){value=this.fields[fieldName].selection.find(function(choice){return choice[0]===value;});}
const id=value&&["many2one","selection"].includes(fieldType)?value[0]:value;value=value&&["many2one","selection"].includes(fieldType)?value[1]:value;rowValues.push(value);rowIds.push(id);}
return{id:rowIds.join(','),label:rowValues};},_fetch:function(groupBy){if(!this.currentRange){return Promise.resolve();}
if(this.sectionField&&this.sectionField===groupBy[0]){return this._fetchGroupedData(groupBy);}else{return this._fetchUngroupedData(groupBy);}},_fetchGroupedData:async function(groupBy){const d=await this.dp.add(this._rpc({model:this.modelName,method:'read_grid_domain',kwargs:{field:this.colField,range:this.currentRange,},context:this.getContext(),}));const groups=await this.dp.add(this._rpc({model:this.modelName,method:'read_group',kwargs:{domain:d.concat(this.domain||[]),fields:[this.sectionField],groupby:[this.sectionField],},context:this.getContext()}));let prom;if(!groups.length){prom=Promise.all([this._fetchSectionGrid(groupBy,{__domain:this.domain||[],})]);}else{prom=Promise.all((groups||[]).map(group=>{return this._fetchSectionGrid(groupBy,group);}));}
const results=await this.dp.add(prom);if(!(_.isEmpty(results)||_.reduce(results,function(m,it){return _.isEqual(m.cols,it.cols)&&m;}))){throw new Error(_t("The sectioned grid view can't handle groups with different columns sets"));}
results.forEach((group,groupIndex)=>{results[groupIndex].totals=this._computeTotals(group.grid);group.rows.forEach((row,rowIndex)=>{const{id,label}=this._getRowInfo(row,true);results[groupIndex].rows[rowIndex].id=id;results[groupIndex].rows[rowIndex].label=label;});});this._gridData={isGrouped:true,data:results,totals:this._computeTotals(_.flatten(_.pluck(results,'grid'),true)),groupBy,colField:this.colField,cellField:this.cellField,range:this.currentRange.name,context:this.context,};},_fetchSectionGrid:function(groupBy,sectionGroup,additionalContext){var self=this;var rpcProm=this._rpc({model:this.modelName,method:'read_grid',kwargs:{row_fields:groupBy.slice(1),col_field:this.colField,cell_field:this.cellField,range:this.currentRange,domain:sectionGroup.__domain,readonly_field:this.readonlyField,},context:this.getContext(additionalContext),})
rpcProm.then(function(grid){grid.__label=sectionGroup[self.sectionField];});return rpcProm;},_fetchUngroupedData:async function(groupBy){const result=await this.dp.add(this._rpc({model:this.modelName,method:'read_grid',kwargs:{row_fields:groupBy,col_field:this.colField,cell_field:this.cellField,domain:this.domain,range:this.currentRange,readonly_field:this.readonlyField,},context:this.getContext(),}));const rows=result.rows;rows.forEach((row,rowIndex)=>{const{id,label}=this._getRowInfo(row,false);result.rows[rowIndex].label=label;result.rows[rowIndex].id=id;});this._gridData={isGrouped:false,data:[result],totals:this._computeTotals(result.grid),groupBy,colField:this.colField,cellField:this.cellField,range:this.currentRange.name,context:this.context,};},});return GridModel;});;

/* /web_grid/static/src/js/grid_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_grid.GridRenderer',function(require){"use strict";const AbstractRenderer=require('web.AbstractRendererOwl');const fieldUtils=require('web.field_utils');const utils=require('web.utils');const gridComponentRegistry=require('web_grid.component_registry');const{useListener}=require('web.custom_hooks');const{useRef,useState}=owl.hooks;class GridRenderer extends AbstractRenderer{constructor(parent,props){super(parent,props);this.state=useState({editMode:false,currentPath:"",errors:{},});this.currentInput=useRef("currentInput");useListener('mouseover','td:not(:first-child), th:not(:first-child)',this._onMouseEnter);useListener('mouseout','td:not(:first-child), th:not(:first-child)',this._onMouseLeave);}
willUpdateProps(nextProps){if(nextProps.data[0].next.grid_anchor!==this.props.data[0].next.grid_anchor){this.state.errors={};}}
patched(){if(this.currentInput.el){this.currentInput.el.select();}}
get columns(){return this.props.data.length?this.props.data[0].cols:[];}
get component(){return gridComponentRegistry.get(this.props.cellComponent);}
get gridAnchorNext(){return this.props.data[0].next.grid_anchor;}
get emptyRows(){return Array.from({length:Math.max(5-this.props.data[0].rows.length,0)},(_,i)=>i);}
get formatType(){if(this.hasComponent){return this.component.formatType;}
return this.props.fields[this.props.cellField].type;}
get hasComponent(){return gridComponentRegistry.contains(this.props.cellComponent);}
get gridTotal(){if(this.props.totals.super){const classMap={'o_grid_super':true,'text-danger':this.props.totals.super<0,};const value=this.props.totals.super;return{classMap,value};}else{return{classMap:{o_grid_super:true},value:0.0};}}
get measureLabel(){if(this.props.measureLabel){return _.str.sprintf("%s",this.props.measureLabel);}else{return this.env._t("Total");}}
get noContentHelper(){return utils.json_node_to_xml(this.props.noContentHelper);}
get showNoContentHelp(){const stateRow=Array.isArray(this.props.data)?this.props.data.find(data=>data.rows[0]):this.props.data.rows[0];return stateRow===undefined&&!!this.props.noContentHelp;}
_cellEdited(path,value,doneCallback){const cell_path=path.split('.');const grid_path=cell_path.slice(0,-3);const row_path=grid_path.concat(['rows'],cell_path.slice(-2,-1));const col_path=grid_path.concat(['cols'],cell_path.slice(-1));this.trigger('cell-edited',{cell_path,row_path,col_path,value,doneCallback,});}
_format(value){if(value===undefined){return'';}
const cellField=this.props.fields[this.props.cellField];return fieldUtils.format[this.formatType](value,cellField,this.props.cellComponentOptions);}
_formatCellContentTotals(index){if(this.props.totals){return{value:this.props.totals.columns[index],smallerThanZero:this.props.totals.columns[index]<0,muted:!this.props.totals.columns||!this.props.totals.columns[index]};}else{return{};}}
_getCellClassMap(cell){const classmap={o_grid_cell_container:true,o_grid_cell_empty:!cell.size,o_grid_cell_readonly:!this.props.editableCells||cell.readonly,};for(const cls of cell.classes||[]){if(!(cls in classmap)){classmap[cls]=true;}}
return classmap;}
_parse(value){const cellField=this.props.fields[this.props.cellField];return fieldUtils.parse[this.formatType](value,cellField,this.props.cellComponentOptions);}
_totalHeight(index){const maxCount=Math.max(...Object.values(this.props.totals.columns));const factor=maxCount?(90/maxCount):0;return factor*this.props.totals.columns[index];}
_onClickCreateInline(ev){this.trigger('create-inline');}
_onClickCellInformation(path){this.state.editMode=false;this.trigger('open-cell-information',{path});}
_onFocusComponent(ev){this.state.editMode=true;this.state.currentPath=ev.detail.path;}
_onFocusGridCell(path){this.state.editMode=true;this.state.currentPath=path;}
_onGridInputBlur(ev){this.state.editMode=false;let hasError=false;let value=ev.target.value;try{value=this._parse(value);}catch(_){hasError=true;}
const path=this.state.currentPath;if(hasError){this.state.errors[path]=value;}else{delete this.state.errors[path];this._cellEdited(path,value);}}
_onUpdateValue(ev){this.state.editMode=false;const value=ev.detail.value;const doneCallback=ev.detail.doneCallback;const path=ev.detail.path;if(value!==undefined){this._cellEdited(path,value,doneCallback);}}
_onMouseEnter(ev){const cellParent=ev.target.closest('td,th');const rowParent=ev.target.closest('tr');const index=[...rowParent.children].indexOf(cellParent)+1;this.el.querySelectorAll(`td:nth-child(${index}), th:nth-child(${index})`).forEach(el=>{if(cellParent.querySelector('.o_grid_total_title')){el.classList.add('o_cell_highlight');}
el.classList.add('o_cell_hover');});}
_onMouseLeave(){this.el.querySelectorAll('.o_cell_hover').forEach(el=>el.classList.remove('o_cell_hover','o_cell_highlight'));}}
GridRenderer.defaultProps={cellComponentOptions:{},hasBarChartTotal:false,hideColumnTotal:false,hideLineTotal:false,};GridRenderer.props={editableCells:{type:Boolean,optional:true},canCreate:Boolean,cellComponent:{type:String,optional:true},cellComponentOptions:Object,cellField:String,colField:String,createInline:Boolean,displayEmpty:Boolean,fields:Object,groupBy:Array,hasBarChartTotal:Boolean,hideColumnTotal:Boolean,hideLineTotal:Boolean,measureLabel:{type:String,optional:true},noContentHelp:{type:String,optional:true},range:String,context:Object,arch:Object,isEmbedded:Boolean,isGrouped:Boolean,data:[{cols:[{values:Object,domain:Array,is_current:Boolean,is_unavailable:Boolean,}],grid:[{size:Number,domain:Array,value:Number,readonly:{type:Boolean,optional:true},is_current:Boolean,is_unavailable:Boolean,}],initial:Object,next:Object,prev:Object,rows:[{values:Object,domain:Array,project:Object,label:Array}],totals:{columns:Object,rows:Object,super:Number},__label:Array}],totals:Object,};GridRenderer.template='web_grid.GridRenderer';return GridRenderer;});;

/* /web_grid/static/src/js/grid_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_grid.GridView',function(require){"use strict";var AbstractView=require('web.AbstractView');var config=require('web.config');var core=require('web.core');var GridModel=require('web_grid.GridModel');var GridController=require('web_grid.GridController');var GridRenderer=require('web_grid.GridRenderer');var viewRegistry=require('web.view_registry');var pyUtils=require('web.py_utils');const RendererWrapper=require('web.RendererWrapper');var session=require('web.session');var _t=core._t;var _lt=core._lt;var GridView=AbstractView.extend({display_name:_lt('Grid'),mobile_friendly:true,icon:'fa-th',config:_.extend({},AbstractView.prototype.config,{Model:GridModel,Controller:GridController,Renderer:GridRenderer,}),viewType:'grid',init:function(viewInfo,params){var self=this;this._super.apply(this,arguments);var arch=this.arch;var fields=this.fields;var rowFields=[];var sectionField,colField,cellField,ranges,cellComponent,cellComponentOptions,measureLabel,readonlyField;_.each(arch.children,function(child){if(child.tag==='field'){if(child.attrs.type==='row'){if(child.attrs.section==='1'&&!sectionField){sectionField=child.attrs.name;}
rowFields.push(child.attrs.name);}
if(child.attrs.type==='col'){colField=child.attrs.name;ranges=self._extract_ranges(child,params.context);}
if(child.attrs.type==='measure'){cellField=child.attrs.name;cellComponent=child.attrs.widget;if(child.attrs.options){cellComponentOptions=JSON.parse(child.attrs.options.replace(/'/g,'"'));}
measureLabel=child.attrs.string;}
if(child.attrs.type==='readonly'){readonlyField=child.attrs.name;}}});this.loadParams.ranges=ranges;var contextRangeName=params.context.grid_range;var contextRange=contextRangeName&&_.findWhere(ranges,{name:contextRangeName});this.loadParams.fields=this.fields;this.loadParams.currentRange=contextRange||ranges[0];this.loadParams.rowFields=rowFields;this.loadParams.sectionField=sectionField;this.loadParams.colField=colField;this.loadParams.cellField=cellField;this.loadParams.groupedBy=params.groupBy;this.loadParams.readonlyField=readonlyField;this.rendererParams.canCreate=this.controllerParams.activeActions.create;this.rendererParams.fields=fields;this.rendererParams.measureLabel=measureLabel;this.rendererParams.editableCells=!!(this.controllerParams.activeActions.edit&&arch.attrs.adjustment);this.rendererParams.cellComponent=cellComponent;this.rendererParams.cellComponentOptions=cellComponentOptions;this.rendererParams.hideLineTotal=!!JSON.parse(arch.attrs.hide_line_total||'0');this.rendererParams.hideColumnTotal=!!JSON.parse(arch.attrs.hide_column_total||'0');this.rendererParams.hasBarChartTotal=!!JSON.parse(arch.attrs.barchart_total||'0');this.rendererParams.createInline=!!JSON.parse(arch.attrs.create_inline||'false');this.rendererParams.displayEmpty=!!JSON.parse(arch.attrs.display_empty||'false');this.rendererParams.noContentHelp=(!this.rendererParams.displayEmpty&&this.rendererParams.noContentHelp)||"";this.controllerParams.formViewID=false;this.controllerParams.listViewID=false;_.each(params.actionViews,function(view){if(view.type==='form'){self.controllerParams.formViewID=view.viewID;}
if(view.type==='list'){self.controllerParams.listViewID=view.viewID;}});this.controllerParams.context=params.context;this.controllerParams.ranges=ranges;this.controllerParams.currentRange=this.loadParams.currentRange.name;this.controllerParams.navigationButtons=arch.children.filter(function(c){return c.tag==='button';}).map(function(c){return c.attrs;});this.controllerParams.adjustment=arch.attrs.adjustment;this.controllerParams.adjustName=arch.attrs.adjust_name;this.controllerParams.createInline=this.rendererParams.createInline;this.controllerParams.displayEmpty=this.rendererParams.displayEmpty;},getRenderer(parent,state){state=Object.assign({},state,this.rendererParams);return new RendererWrapper(null,this.config.Renderer,state);},_extract_ranges:function(col_node,context){var ranges=[];if(config.device.isMobile){ranges.push({name:'day',string:_t('Day'),span:'day',step:'day',});}
var pyevalContext=py.dict.fromJSON(context||{});_.each(_.pluck(col_node.children,'attrs'),function(range){if(range.invisible&&pyUtils.py_eval(range.invisible,{'context':pyevalContext})){return;}
ranges.push(range);});return ranges;},});viewRegistry.add('grid',GridView);return GridView;});;

/* /web_kanban_gauge/static/src/js/kanban_gauge.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban_gauge.widget',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var utils=require('web.utils');var _t=core._t;var GaugeWidget=AbstractField.extend({className:"oe_gauge",jsLibs:['/web/static/lib/Chart/Chart.js',],_render:function(){var val=this.value;if(_.isArray(JSON.parse(val))){val=JSON.parse(val);}
var gauge_value=_.isArray(val)&&val.length?val[val.length-1].value:val;if(this.nodeOptions.gauge_value_field){gauge_value=this.recordData[this.nodeOptions.gauge_value_field];}
var max_value=this.nodeOptions.max_value||100;if(this.nodeOptions.max_field){max_value=this.recordData[this.nodeOptions.max_field];}
max_value=Math.max(gauge_value,max_value);var label=this.nodeOptions.label||"";if(this.nodeOptions.label_field){label=this.recordData[this.nodeOptions.label_field];}
var title=this.nodeOptions.title||this.field.string;var maxLabel=max_value;if(gauge_value===0&&max_value===0){max_value=1;maxLabel=0;}
var config={type:'doughnut',data:{datasets:[{data:[gauge_value,max_value-gauge_value],backgroundColor:["#1f77b4","#dddddd"],label:title}],},options:{circumference:Math.PI,rotation:-Math.PI,responsive:true,tooltips:{displayColors:false,callbacks:{label:function(tooltipItems){if(tooltipItems.index===0){return _t('Value: ')+gauge_value;}
return _t('Max: ')+maxLabel;},},},title:{display:true,text:title,padding:4,},layout:{padding:{bottom:5}},maintainAspectRatio:false,cutoutPercentage:70,}};this.$canvas=$('<canvas/>');this.$el.empty();this.$el.append(this.$canvas);this.$el.attr('style',this.nodeOptions.style);this.$el.css({position:'relative'});var context=this.$canvas[0].getContext('2d');this.chart=new Chart(context,config);var humanValue=utils.human_number(gauge_value,1);var $value=$('<span class="o_gauge_value">').text(humanValue);$value.css({'text-align':'center',position:'absolute',left:0,right:0,bottom:'6px','font-weight':'bold'});this.$el.append($value);},});field_registry.add("gauge",GaugeWidget);return GaugeWidget;});;

/* /web_map/static/src/js/map_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_map.MapController',function(require){"use strict";const AbstractController=require('web.AbstractController');const core=require('web.core');const qweb=core.qweb;const MapController=AbstractController.extend({custom_events:_.extend({},AbstractController.prototype.custom_events,{'pin_clicked':'_onPinClick','get_itinerary_clicked':'_onGetItineraryClicked','open_clicked':'_onOpenClicked','pager_changed':'_onPagerChanged','coordinate_fetched':'_onCoordinateFetched',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.actionName=params.actionName;},renderButtons:function($node){this.$buttons=$(qweb.render("MapView.buttons"),{widget:this});this._updateGoogleMapUrl();this.$buttons.appendTo($node);},update:async function(){await this._super(...arguments);this._updatePaging();this._updateGoogleMapUrl();},_updateGoogleMapUrl:function(){var url='https://www.google.com/maps/dir/?api=1';if(this.model.data.records.length){url+='&waypoints=';var all_coord=this.model.data.records.filter((record)=>record.partner&&record.partner.partner_latitude&&record.partner.partner_longitude);_.uniq(all_coord,function(record){return record.partner.partner_latitude+'_'+record.partner.partner_longitude;}).forEach((record)=>{url+=record.partner.partner_latitude+','+record.partner.partner_longitude+'|';});url=url.slice(0,-1);}
this.$buttons.find('a.btn.btn-primary').attr('href',url);},_getPagingInfo:function(){const state=this.model.get();return{currentMinimum:state.offset+1,limit:state.limit,size:state.count,};},_onCoordinateFetched:function(ev){ev.stopPropagation();this.update({},{reload:false});},_onGetItineraryClicked:function(ev){window.open(`https://www.google.com/maps/dir/?api=1&destination=${ev.data.lat},${ev.data.lon}`);},_onOpenClicked:function(ev){if(ev.data.ids.length>1){this.do_action({type:'ir.actions.act_window',name:this.actionName,views:[[false,'list'],[false,'form']],res_model:this.modelName,domain:[['id','in',ev.data.ids]],});}else{this.trigger_up('switch_view',{view_type:'form',res_id:ev.data.ids[0],mode:'readonly',model:this.modelName});}},async _onPagerChanged(ev){const{currentMinimum,limit}=ev.data;await this.reload({limit,offset:currentMinimum-1});},});return MapController;});;

/* /web_map/static/src/js/map_model.js defined in bundle 'web.assets_backend' */
odoo.define('web_map.MapModel',function(require){"use strict";const AbstractModel=require('web.AbstractModel');const session=require('web.session');const core=require('web.core');const _t=core._t;const MapModel=AbstractModel.extend({COORDINATE_FETCH_DELAY:1000,init:function(){this._super.apply(this,arguments);this.data={};this.data.mapBoxToken=session.map_box_token;},__get:function(){return this.data;},__load:function(params){this.data.count=0;this.data.offset=0;this.data.limit=params.limit;this.partnerToCache=[];this.partnerIds=[];this.resPartnerField=params.resPartnerField;this.model=params.modelName;this.context=params.context;this.fields=params.fieldNames;this.fieldsInfo=params.fieldsInfo;this.domain=params.domain;this.params=params;this.orderBy=params.orderBy;this.routing=params.routing;this.numberOfLocatedRecords=0;this.coordinateFetchingTimeoutHandle=undefined;this.data.shouldUpdatePosition=true;this.data.fetchingCoordinates=false;this.data.groupBy=params.groupedBy.length?params.groupedBy[0]:false;return this._fetchData();},__reload:function(handle,params){const options=params||{};this.partnerToCache=[];this.partnerIds=[];this.numberOfLocatedRecords=0;this.data.shouldUpdatePosition=true;this.data.fetchingCoordinates=false;if(this.coordinateFetchingTimeoutHandle!==undefined){clearInterval(this.coordinateFetchingTimeoutHandle);this.coordinateFetchingTimeoutHandle=undefined;}
if(options.domain!==undefined){this.domain=options.domain;}
if(options.limit!==undefined){this.data.limit=options.limit;}
if(options.offset!==undefined){this.data.offset=options.offset;}
if(options.groupBy!==undefined&&options.groupBy[0]!==this.data.groupBy){this.data.groupBy=options.groupBy.length?options.groupBy[0]:false;}
return this._fetchData();},_addPartnerToRecord:function(){this.data.records.forEach((record)=>{this.data.partners.forEach((partner)=>{let recordPartnerId;if(this.model==="res.partner"&&this.resPartnerField==="id"){recordPartnerId=record.id;}else{recordPartnerId=record[this.resPartnerField][0];}
if(recordPartnerId==partner.id){record.partner=partner;this.numberOfLocatedRecords++;}});});},_checkCoordinatesValidity:function(partner){if(partner.partner_latitude&&partner.partner_longitude&&partner.partner_latitude>=-90&&partner.partner_latitude<=90&&partner.partner_longitude>=-180&&partner.partner_longitude<=180){return true;}
return false;},_fetchCoordinatesFromAddressMB:function(record){const address=encodeURIComponent(record.contact_address_complete);const token=this.data.mapBoxToken;const encodedUrl=`https://api.mapbox.com/geocoding/v5/mapbox.places/${address}.json?access_token=${token}&cachebuster=1552314159970&autocomplete=true`;return new Promise((resolve,reject)=>{$.get(encodedUrl).then(resolve).catch(reject);});},_fetchCoordinatesFromAddressOSM:function(record){const address=encodeURIComponent(record.contact_address_complete.replace('/',' '));const encodedUrl=`https://nominatim.openstreetmap.org/search/${address}?format=jsonv2`;return new Promise(function(resolve,reject){$.get(encodedUrl).then(resolve).catch(reject);});},_fetchData:async function(){if(!this.resPartnerField){this.data.recordGroups=[];this.data.records=[];this.data.routeInfo={routes:[]};return;}
const results=await this._fetchRecordData();this.data.records=results.records;this.data.count=results.length;if(this.data.groupBy){this.data.recordGroups=this._getRecordGroups();}else{this.data.recordGroups={};}
this.partnerIds=[];if(this.model==="res.partner"&&this.resPartnerField==="id"){this.data.records.forEach((record)=>{this.partnerIds.push(record.id);record.partner_id=[record.id];});}else{this._fillPartnerIds(this.data.records);}
this.partnerIds=_.uniq(this.partnerIds);return this._partnerFetching(this.partnerIds);},async _fetchRecordData(){const groupBy=this.data.groupBy?this.data.groupBy.split(':')[0]:false;const results=await this._rpc({route:'/web/dataset/search_read',model:this.model,context:this.context,fields:groupBy?this.fields.concat(groupBy):this.fields,domain:this.domain,orderBy:this.orderBy,limit:this.data.limit,offset:this.data.offset})
if(results&&groupBy&&["one2many","many2many"].includes(this.fieldsInfo[groupBy].type)){const ids=new Set(results.records.flatMap((record)=>record[groupBy]));const groupbyRecords=await this._rpc({method:'name_get',model:this.fieldsInfo[groupBy].relation,context:this.context,args:[[...ids]],})
const labelPerRecordId=Object.fromEntries(groupbyRecords);for(const record of results.records){record[groupBy]=record[groupBy].map(val=>val&&val in labelPerRecordId?[val,labelPerRecordId[val]]:false);}}
return results;},_getRecordGroups:function(){const[fieldName,subGroup]=this.data.groupBy.split(':');const dateGroupFormats={year:'YYYY',quarter:'[Q]Q YYYY',month:'MMMM YYYY',week:'[W]WW YYYY',day:'DD MMM YYYY',};const groups={};for(const record of this.data.records){const vals=["one2many","many2many"].includes(this.fieldsInfo[fieldName].type)?record[fieldName]:[record[fieldName]];for(const val of vals){let id,name;if(['date','datetime'].includes(this.fieldsInfo[fieldName].type)){const date=moment(val);id=name=date.format(dateGroupFormats[subGroup]);}else{id=Array.isArray(val)?val[0]:val;name=Array.isArray(val)?val[1]:val;}
if(!groups[id]){groups[id]={name,records:[],};}
groups[id].records.push(record);}}
return groups;},_fetchRecordsPartner:function(ids){return this._rpc({model:'res.partner',method:'search_read',fields:['contact_address_complete','partner_latitude','partner_longitude'],domain:[['contact_address_complete','!=','False'],['id','in',ids]],});},_fetchRoute:function(){const coordinatesParam=this.data.records.filter(record=>record.partner.partner_latitude&&record.partner.partner_longitude).map(record=>record.partner.partner_longitude+','+record.partner.partner_latitude);const address=encodeURIComponent(coordinatesParam.join(';'));const token=this.data.mapBoxToken;const encodedUrl=`https://api.mapbox.com/directions/v5/mapbox/driving/${address}?access_token=${token}&steps=true&geometries=geojson`;return new Promise(function(resolve,reject){$.get(encodedUrl).then(resolve).catch(reject);});},_fillPartnerIds:function(records){return records.forEach(record=>{if(record[this.resPartnerField]){this.partnerIds.push(record[this.resPartnerField][0]);}});},_getErrorMessage:function(message){const ERROR_MESSAGES={'Too many coordinates; maximum number of coordinates is 25':_t("Too many routing points (maximum 25)"),'Route exceeds maximum distance limitation':_t("Some routing points are too far apart"),'Too Many Requests':_t("Too many requests, try again in a few minutes"),};return ERROR_MESSAGES[message];},_maxBoxAPI:function(){const promises=[];this.data.partners.forEach(partner=>{if(partner.contact_address_complete&&(!partner.partner_latitude||!partner.partner_longitude)){promises.push(this._fetchCoordinatesFromAddressMB(partner).then(coordinates=>{if(coordinates.features.length){partner.partner_longitude=coordinates.features[0].geometry.coordinates[0];partner.partner_latitude=coordinates.features[0].geometry.coordinates[1];this.partnerToCache.push(partner);}}));}else if(!this._checkCoordinatesValidity(partner)){partner.partner_latitude=undefined;partner.partner_longitude=undefined;}});return Promise.all(promises).then(()=>{this.data.routeInfo={routes:[]};if(this.numberOfLocatedRecords>1&&this.routing&&!this.data.groupBy){return this._fetchRoute().then(routeResult=>{if(routeResult.routes){this.data.routeInfo=routeResult;}else{this.data.routingError=this._getErrorMessage(routeResult.message);}});}else{return Promise.resolve();}});},_mapBoxErrorHandling:function(err){switch(err.status){case 401:this.displayNotification({title:_t('Token invalid'),message:_t('The view has switched to another provider but functionalities will be limited'),type:'danger',});break;case 403:this.displayNotification({title:_t('Unauthorized connection'),message:_t('The view has switched to another provider but functionalities will be limited'),type:'danger',});break;case 422:case 429:this.data.routingError=this._getErrorMessage(err.responseJSON.message);break;case 500:this.displayNotification({title:_t('MapBox servers unreachable'),message:_t('The view has switched to another provider but functionalities will be limited'),type:'danger',});}},_notifyFetchedCoordinate:function(){this._writeCoordinatesUsers();this.data.shouldUpdatePosition=false;this.trigger_up('coordinate_fetched');},_openStreetMapAPI:function(){this._openStreetMapAPIAsync();return Promise.resolve();},_openStreetMapAPIAsync:function(){const addressPartnerMap=new Map();for(const partner of this.data.partners){if(partner.contact_address_complete&&(!partner.partner_latitude||!partner.partner_longitude)){if(!addressPartnerMap.has(partner.contact_address_complete)){addressPartnerMap.set(partner.contact_address_complete,[]);}
addressPartnerMap.get(partner.contact_address_complete).push(partner);partner.fetchingCoordinate=true;}else if(!this._checkCoordinatesValidity(partner)){partner.partner_latitude=undefined;partner.partner_longitude=undefined;}}
this.data.fetchingCoordinates=addressPartnerMap.size>0;const fetch=async()=>{const partnersList=Array.from(addressPartnerMap.values());for(let i=0;i<partnersList.length;i++){const partners=partnersList[i];try{const coordinates=await this._fetchCoordinatesFromAddressOSM(partners[0]);if(coordinates.length){for(const partner of partners){partner.partner_longitude=coordinates[0].lon;partner.partner_latitude=coordinates[0].lat;this.partnerToCache.push(partner);}}}finally{for(const partner of partners){partner.fetchingCoordinate=false;}
this.data.fetchingCoordinates=(i<partnersList.length-1);this._notifyFetchedCoordinate();await new Promise((resolve)=>{this.coordinateFetchingTimeoutHandle=setTimeout(resolve,this.COORDINATE_FETCH_DELAY);});}}}
return fetch();},_partnerFetching:async function(partnerIds){this.data.partners=partnerIds.length?await this._fetchRecordsPartner(partnerIds):[];this._addPartnerToRecord();if(this.data.mapBoxToken){return this._maxBoxAPI().then(()=>{this._writeCoordinatesUsers();}).catch((err)=>{this._mapBoxErrorHandling(err);this.data.mapBoxToken='';return this._openStreetMapAPI();});}else{return this._openStreetMapAPI().then(()=>{this._writeCoordinatesUsers();});}},_writeCoordinatesUsers:function(){if(this.partnerToCache.length){this._rpc({model:'res.partner',method:'update_latitude_longitude',context:this.context,args:[this.partnerToCache]});this.partnerToCache=[];}},});return MapModel;});;

/* /web_map/static/src/js/map_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_map.MapRenderer',function(require){"use strict";const AbstractRendererOwl=require('web.AbstractRendererOwl');const{useRef,useState}=owl.hooks;const apiTilesRouteWithToken='https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}';const apiTilesRouteWithoutToken='https://a.tile.openstreetmap.org/{z}/{x}/{y}.png';const colors=['#F06050','#6CC1ED','#F7CD1F','#814968','#30C381','#D6145F','#475577','#F4A460','#EB7E7F','#2C8397',];const mapTileAttribution=`
        © <a href="https://www.mapbox.com/about/maps/">Mapbox</a>
        © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>
        <strong>
            <a href="https://www.mapbox.com/map-feedback/" target="_blank">
                Improve this map
            </a>
        </strong>`;class MapRenderer extends AbstractRendererOwl{constructor(){super(...arguments);this.leafletMap=null;this.markers=[];this.polylines=[];this.mapContainerRef=useRef('mapContainer');this.state=useState({closedGroupIds:[],});}
async willStart(){const p={method:'GET'};[this._pinCircleSVG,this._pinNoCircleSVG]=await Promise.all([this.env.services.httpRequest('web_map/static/img/pin-circle.svg',p,'text'),this.env.services.httpRequest('web_map/static/img/pin-no-circle.svg',p,'text'),]);return super.willStart(...arguments);}
mounted(){this.leafletMap=L.map(this.mapContainerRef.el,{maxBounds:[L.latLng(180,-180),L.latLng(-180,180)],});L.tileLayer(this.apiTilesRoute,{attribution:mapTileAttribution,tileSize:512,zoomOffset:-1,minZoom:2,maxZoom:19,id:'mapbox/streets-v11',accessToken:this.props.mapBoxToken,}).addTo(this.leafletMap);this._updateMap();super.mounted(...arguments);}
patched(){this._updateMap();super.patched(...arguments);}
willUpdateProps(nextProps){if(this.props.groupBy!==nextProps.groupBy){this.state.closedGroupIds=[];}
return super.willUpdateProps(...arguments);}
willUnmount(){for(const marker of this.markers){marker.off('click');}
for(const polyline of this.polylines){polyline.off('click');}
this.leafletMap.remove();super.willUnmount(...arguments);}
get apiTilesRoute(){return this.props.mapBoxToken?apiTilesRouteWithToken:apiTilesRouteWithoutToken;}
_addMarkers(){this._removeMarkers();const markersInfo={};let records=this.props.records;if(this.props.groupBy){records=Object.entries(this.props.recordGroups).filter(([key])=>!this.state.closedGroupIds.includes(key)).flatMap(([,value])=>value.records);}
for(const record of records){const partner=record.partner;if(partner&&partner.partner_latitude&&partner.partner_longitude){const key=`${partner.partner_latitude}-${partner.partner_longitude}`;if(key in markersInfo){markersInfo[key].record=record;markersInfo[key].ids.push(record.id);}else{markersInfo[key]={record:record,ids:[record.id]};}}}
for(const markerInfo of Object.values(markersInfo)){const params={count:markerInfo.ids.length,isMulti:markerInfo.ids.length>1,number:this.props.records.indexOf(markerInfo.record)+1,numbering:this.props.numbering,pinSVG:(this.props.numbering?this._pinNoCircleSVG:this._pinCircleSVG),};if(this.props.groupBy){const group=Object.entries(this.props.recordGroups).find(([,value])=>value.records.includes(markerInfo.record));params.color=this._getGroupColor(group[0]);params.number=group[1].records.indexOf(markerInfo.record)+1;}
const iconInfo={className:'o_map_marker',html:this.env.qweb.renderToString('web_map.marker',params),};const marker=L.marker([markerInfo.record.partner.partner_latitude,markerInfo.record.partner.partner_longitude],{icon:L.divIcon(iconInfo)});marker.addTo(this.leafletMap);marker.on('click',()=>{this._createMarkerPopup(markerInfo);});this.markers.push(marker);}}
_addRoutes(){this._removeRoutes();if(!this.props.mapBoxToken||!this.props.routeInfo.routes.length){return;}
for(const leg of this.props.routeInfo.routes[0].legs){const latLngs=[];for(const step of leg.steps){for(const coordinate of step.geometry.coordinates){latLngs.push(L.latLng(coordinate[1],coordinate[0]));}}
const polyline=L.polyline(latLngs,{color:'blue',weight:5,opacity:0.3,}).addTo(this.leafletMap);const polylines=this.polylines;polyline.on('click',function(){for(const polyline of polylines){polyline.setStyle({color:'blue',opacity:0.3});}
this.setStyle({color:'darkblue',opacity:1.0});});this.polylines.push(polyline);}}
_createMarkerPopup(markerInfo){const popupFields=this._getMarkerPopupFields(markerInfo);const partner=markerInfo.record.partner;const popupHtml=this.env.qweb.renderToString('web_map.markerPopup',{fields:popupFields,hasFormView:this.props.hasFormView,url:`https://www.google.com/maps/dir/?api=1&destination=${partner.partner_latitude},${partner.partner_longitude}`,});const popup=L.popup({offset:[0,-30]}).setLatLng([partner.partner_latitude,partner.partner_longitude]).setContent(popupHtml).openOn(this.leafletMap);const openBtn=popup.getElement().querySelector('button.o_open');if(openBtn){openBtn.onclick=()=>{this.trigger('open_clicked',{ids:markerInfo.ids});};}
return popup;}
_getGroupColor(groupId){const index=Object.keys(this.props.recordGroups).indexOf(groupId);return colors[index%colors.length];}
_getLatLng(){const tabLatLng=[];for(const record of this.props.records){const partner=record.partner;if(partner&&partner.partner_latitude&&partner.partner_longitude){tabLatLng.push(L.latLng(partner.partner_latitude,partner.partner_longitude));}}
if(!tabLatLng.length){return false;}
return L.latLngBounds(tabLatLng);}
_getMarkerPopupFields(markerInfo){const record=markerInfo.record;const fieldsView=[];if(markerInfo.ids.length>1){if(!this.props.hideAddress){fieldsView.push({value:record.partner.contact_address_complete,string:this.env._t("Address"),});}
return fieldsView;}
if(!this.props.hideName){fieldsView.push({value:record.display_name,string:this.env._t("Name"),});}
if(!this.props.hideAddress){fieldsView.push({value:record.partner.contact_address_complete,string:this.env._t("Address"),});}
for(const field of this.props.fieldNamesMarkerPopup){if(record[field.fieldName]){const fieldName=record[field.fieldName]instanceof Array?record[field.fieldName][1]:record[field.fieldName];fieldsView.push({value:fieldName,string:field.string,});}}
return fieldsView;}
_removeMarkers(){for(const marker of this.markers){this.leafletMap.removeLayer(marker);}
this.markers=[];}
_removeRoutes(){for(const polyline of this.polylines){this.leafletMap.removeLayer(polyline);}
this.polylines=[];}
_updateMap(){if(this.props.shouldUpdatePosition){const initialCoord=this._getLatLng();if(initialCoord){this.leafletMap.flyToBounds(initialCoord,{animate:false});}else{this.leafletMap.fitWorld();}
this.leafletMap.closePopup();}
this._addMarkers();this._addRoutes();}
_centerAndOpenPin(record){const popup=this._createMarkerPopup({record:record,ids:[record.id],});const px=this.leafletMap.project([record.partner.partner_latitude,record.partner.partner_longitude]);const popupHeight=popup.getElement().offsetHeight;px.y-=popupHeight/2;const latlng=this.leafletMap.unproject(px);this.leafletMap.panTo(latlng,{animate:true});}
_toggleGroup(id){if(this.state.closedGroupIds.includes(id)){const index=this.state.closedGroupIds.indexOf(id);this.state.closedGroupIds.splice(index,1);}else{this.state.closedGroupIds.push(id);}}}
MapRenderer.props={arch:Object,count:Number,defaultOrder:{type:String,optional:true,},fetchingCoordinates:Boolean,fieldNamesMarkerPopup:{type:Array,element:{type:Object,shape:{fieldName:String,string:String,},},},groupBy:[String,Boolean],hasFormView:Boolean,hideAddress:Boolean,hideName:Boolean,isEmbedded:Boolean,limit:Number,mapBoxToken:{type:[Boolean,String],optional:1},noContentHelp:{type:String,optional:true,},numbering:Boolean,hideTitle:Boolean,panelTitle:String,offset:Number,partners:{type:[Array,Boolean],optional:1},recordGroups:Object,records:Array,routeInfo:{type:Object,optional:true,},routing:Boolean,routingError:{type:String,optional:true,},shouldUpdatePosition:Boolean,};MapRenderer.template='web_map.MapRenderer';return MapRenderer;});;

/* /web_map/static/src/js/map_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_map.MapView',function(require){"use strict";const MapModel=require('web_map.MapModel');const MapController=require('web_map.MapController');const MapRenderer=require('web_map.MapRenderer');const AbstractView=require('web.AbstractView');const RendererWrapper=require('web.RendererWrapper');const utils=require('web.utils');const viewRegistry=require('web.view_registry');const _t=require('web.core')._t;const MapView=AbstractView.extend({jsLibs:['/web_map/static/lib/leaflet/leaflet.js',],config:_.extend({},AbstractView.prototype.config,{Model:MapModel,Controller:MapController,Renderer:MapRenderer,}),icon:'fa-map-marker',display_name:'Map',viewType:'map',mobile_friendly:true,searchMenuTypes:['filter','groupBy','favorite'],init:function(viewInfo,params){this._super.apply(this,arguments);const fieldNames=[];const fieldNamesMarkerPopup=[];this.loadParams.resPartnerField=this.arch.attrs.res_partner;fieldNames.push(this.arch.attrs.res_partner);fieldNames.push('display_name');if(this.arch.attrs.default_order){this.loadParams.orderBy=[{name:this.arch.attrs.default_order||'display_name',asc:true}];}
const routing=["true","True","1"].includes(this.arch.attrs.routing);this.loadParams.limit=this.arch.attrs.limit?parseInt(this.arch.attrs.limit,10):params.limit||80;this.loadParams.routing=routing;this.rendererParams.routing=routing;this.rendererParams.numbering=this.arch.attrs.routing?true:false;this.rendererParams.defaultOrder=this.arch.attrs.default_order;this.rendererParams.panelTitle=this.arch.attrs.panel_title||params.displayName||_t('Items');this.rendererParams.hideTitle=utils.toBoolElse(this.arch.attrs.hide_title||'',false);const hideName=utils.toBoolElse(this.arch.attrs.hide_name||'',false);this.rendererParams.hideName=hideName;if(!hideName){fieldNames.push('display_name');}
this.rendererParams.hideAddress=utils.toBoolElse(this.arch.attrs.hide_address||'',false);this.arch.children.forEach(node=>{if(node.tag==='field'){fieldNames.push(node.attrs.name);fieldNamesMarkerPopup.push({fieldName:node.attrs.name,string:node.attrs.string});}});this.loadParams.fieldsInfo=this.fields;this.loadParams.fieldNames=_.uniq(fieldNames);this.rendererParams.fieldNamesMarkerPopup=fieldNamesMarkerPopup;this.rendererParams.hasFormView=params.actionViews.some(view=>view.type==="form");this.controllerParams.actionName=params.action?params.action.name:_t("Untitled");},getRenderer(parent,state){state=Object.assign({},state,this.rendererParams);return new RendererWrapper(null,this.config.Renderer,state);},});viewRegistry.add('map',MapView);return MapView;});